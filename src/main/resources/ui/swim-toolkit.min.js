// swim-toolkit-4.0.0-dev.20210927.1; copyright 2015-2021 Swim Inc.
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@swim/runtime"),require("@swim/runtime"),require("@swim/runtime"),require("@swim/runtime"),require("@swim/runtime"),require("@swim/runtime"),require("@swim/runtime"),require("@swim/runtime"),require("@swim/runtime"),require("@swim/runtime"),require("@swim/runtime")):"function"==typeof define&&define.amd?define(["exports","@swim/runtime","@swim/runtime","@swim/runtime","@swim/runtime","@swim/runtime","@swim/runtime","@swim/runtime","@swim/runtime","@swim/runtime","@swim/runtime","@swim/runtime"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).swim=t.swim||{},t.swim,t.swim,t.swim,t.swim,t.swim,t.swim,t.swim,t.swim,t.swim,t.swim,t.swim)}(this,(function(t,e,i,n,s,o,r,l,a,h,d,c){"use strict";function u(t,e,i,n){var s,o=arguments.length,r=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,n);else for(var l=t.length-1;l>=0;l--)(s=t[l])&&(r=(o<3?s(r):o>3?s(e,i,r):s(e,i))||r);return o>3&&r&&Object.defineProperty(e,i,r),r}const p=function(){const t={current:null,create:function(){return{updateTime:performance.now()}}};return t}();class f extends e.Service{constructor(){super(),this.flags=0,this.modelContext=p.create(),this.updateDelay=f.MinUpdateDelay,this.analyzeTimer=0,this.refreshTimer=0,this.runAnalyzePass=this.runAnalyzePass.bind(this),this.runRefreshPass=this.runRefreshPass.bind(this),this.onVisibilityChange=this.onVisibilityChange.bind(this)}setFlags(t){this.flags=t}updatedModelContext(){const t=this.modelContext;return t.updateTime=performance.now(),t}needsUpdate(t,e){return t}requestUpdate(t,e,i){e=this.needsUpdate(e,i);let n=this.flags&~e&w.UpdateMask;0!=(e&w.AnalyzeMask)&&(n|=w.NeedsAnalyze),0!=(e&w.RefreshMask)&&(n|=w.NeedsRefresh),this.setFlags(this.flags|n),i&&0==(this.flags&w.TraversingFlag)&&this.updateDelay<=f.MaxAnalyzeInterval?this.runImmediatePass():this.scheduleUpdate()}scheduleUpdate(){const t=this.flags;0==(t&w.AnalyzingFlag)&&0!=(t&w.AnalyzeMask)?this.scheduleAnalyzePass(this.updateDelay):0==(t&w.RefreshingFlag)&&0!=(t&w.RefreshMask)&&this.scheduleRefreshPass(f.MinAnalyzeInterval)}cancelUpdate(){this.cancelAnalyzePass(),this.cancelRefreshPass()}runImmediatePass(){0!=(this.flags&w.AnalyzeMask)&&(this.cancelUpdate(),this.runAnalyzePass(!0)),0!=(this.flags&w.RefreshMask)&&this.updateDelay<=f.MaxAnalyzeInterval&&(this.cancelUpdate(),this.runRefreshPass(!0))}scheduleAnalyzePass(t){0===this.analyzeTimer&&(this.analyzeTimer=setTimeout(this.runAnalyzePass,t))}cancelAnalyzePass(){0!==this.analyzeTimer&&(clearTimeout(this.analyzeTimer),this.analyzeTimer=0)}runAnalyzePass(t=!1){this.setFlags(this.flags&~w.AnalyzeMask|w.TraversingFlag|w.AnalyzingFlag);try{const e=performance.now(),i=this.roots,n=this.modelContext;n.updateTime=e;for(let t=0;t<i.length;t+=1){const e=i[t];0!=(e.flags&w.AnalyzeMask)&&e.cascadeAnalyze(0,n)}const s=performance.now();let o=Math.max(f.MinAnalyzeInterval,this.updateDelay);this.updateDelay=s-e>o?Math.min(Math.max(2,2*this.updateDelay),f.MaxUpdateDelay):Math.min(f.MinUpdateDelay,this.updateDelay/2),this.cancelAnalyzePass(),0!=(this.flags&w.RefreshMask)?this.scheduleRefreshPass(f.MinRefreshInterval):0!=(this.flags&w.AnalyzeMask)&&(t&&(o=Math.max(f.MaxAnalyzeInterval,o)),this.cancelRefreshPass(),this.scheduleAnalyzePass(o))}finally{this.setFlags(this.flags&~(w.TraversingFlag|w.AnalyzingFlag))}}scheduleRefreshPass(t){0===this.refreshTimer&&(this.refreshTimer=setTimeout(this.runRefreshPass,t))}cancelRefreshPass(){0!==this.refreshTimer&&(clearTimeout(this.refreshTimer),this.refreshTimer=0)}runRefreshPass(t=!1){this.setFlags(this.flags&~w.RefreshMask|w.TraversingFlag|w.RefreshingFlag);try{const e=performance.now(),i=this.modelContext;i.updateTime=e;const n=this.roots;for(let t=0;t<n.length;t+=1){const e=n[t];0!=(e.flags&w.RefreshMask)&&e.cascadeRefresh(0,i)}if(this.cancelRefreshPass(),0!=(this.flags&w.AnalyzeMask)){let e=this.updateDelay;t&&(e=Math.max(f.MaxAnalyzeInterval,e)),this.scheduleAnalyzePass(e)}else 0!=(this.flags&w.RefreshMask)&&(this.cancelAnalyzePass(),this.scheduleRefreshPass(f.MaxRefreshInterval))}finally{this.setFlags(this.flags&~(w.TraversingFlag|w.RefreshingFlag))}}get powerFlags(){return 0}power(){const t=this.roots;for(let e=0,i=t.length;e<i;e+=1){t[e].requireUpdate(this.powerFlags)}}unpower(){this.cancelUpdate(),this.updateDelay=f.MinUpdateDelay}onAttachRoot(t){super.onAttachRoot(t),this.requestUpdate(t,t.flags&w.UpdateMask,!1)}onAttach(){super.onAttach(),this.attachEvents()}onDetach(){this.detachEvents(),super.onDetach()}attachEvents(){"undefined"!=typeof document&&document.addEventListener("visibilitychange",this.onVisibilityChange)}detachEvents(){"undefined"!=typeof document&&document.removeEventListener("visibilitychange",this.onVisibilityChange)}onVisibilityChange(){"visible"===document.visibilityState?this.power():this.unpower()}static global(){return new f}}f.MinUpdateDelay=0,f.MaxUpdateDelay=167,f.MinAnalyzeInterval=12,f.MaxAnalyzeInterval=33,f.MinRefreshInterval=4,f.MaxRefreshInterval=16,u([e.Lazy],f,"global",null);const g=function(t){const e=t.extend("RefreshProvider");return Object.defineProperty(e.prototype,"modelContext",{get(){let t=this.service;return null==t&&(t=f.global()),t.modelContext},configurable:!0}),e.prototype.updatedModelContext=function(){let t=this.service;return null==t&&(t=f.global()),t.updatedModelContext()},e.prototype.requestUpdate=function(t,e,i){let n=this.service;null==n&&(n=f.global()),n.requestUpdate(t,e,i)},e.prototype.createService=function(){return f.global()},e}(i.Provider);class v extends e.Service{constructor(){super(),this.selections=[]}isSelected(t){return this.selections.indexOf(t)>=0}select(t,e,i){const n=this.selections;if(n.indexOf(t)<0){void 0===e&&(e=null),null!==e&&e.multi||this.unselectAll(),void 0===i?i=n.length:(i<0&&(i=n.length+1+i),i=Math.min(Math.max(0,i,n.length)));const s=t.getTrait(P);this.willSelect(t,i,e),null!==s&&s.willSelect(e),n.splice(i,0,t),this.onSelect(t,i,e),null!==s&&(s.onSelect(e),s.didSelect(e)),this.didSelect(t,i,e)}}willSelect(t,e,i){const n=this.observers;for(let s=0,o=n.length;s<o;s+=1){const o=n[s];void 0!==o.serviceWillSelect&&o.serviceWillSelect(t,e,i,this)}}onSelect(t,e,i){}didSelect(t,e,i){const n=this.observers;for(let s=0,o=n.length;s<o;s+=1){const o=n[s];void 0!==o.serviceDidSelect&&o.serviceDidSelect(t,e,i,this)}}unselect(t){const e=this.selections,i=e.indexOf(t);if(i>=0){const n=t.getTrait(P);this.willUnselect(t),null!==n&&n.willUnselect(),e.splice(i,1),this.onUnselect(t),null!==n&&(n.onUnselect(),n.didUnselect()),this.didUnselect(t)}}willUnselect(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.serviceWillUnselect&&n.serviceWillUnselect(t,this)}}onUnselect(t){}didUnselect(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.serviceDidUnselect&&n.serviceDidUnselect(t,this)}}unselectAll(){const t=this.selections;for(;0!==t.length;)this.unselect(t[0])}toggle(t,e,i){const n=this.selections,s=n.indexOf(t);if(s<0){void 0===e&&(e=null),null!==e&&e.multi||this.unselectAll(),void 0===i?i=n.length:(i<0&&(i=n.length+1+i),i=Math.min(Math.max(0,i,n.length)));const s=t.getTrait(P);this.willSelect(t,i,e),null!==s&&s.willSelect(e),n.splice(i,0,t),this.onSelect(t,i,e),null!==s&&(s.onSelect(e),s.didSelect(e)),this.didSelect(t,i,e)}else{const e=t.getTrait(P);this.willUnselect(t),null!==e&&e.willUnselect(),n.splice(s,1),this.onUnselect(t),null!==e&&(e.onUnselect(),e.didUnselect()),this.didUnselect(t)}}static global(){return new v}}u([e.Lazy],v,"global",null);const y=function(t){const e=t.extend("SelectionProvider");return Object.defineProperty(e.prototype,"selections",{get(){let t=this.service;return null==t&&(t=v.global()),t.selections},configurable:!0}),e.prototype.select=function(t,e,i){let n=this.service;null==n&&(n=v.global()),n.select(t,e,i)},e.prototype.unselect=function(t){let e=this.service;null==e&&(e=v.global()),e.unselect(t)},e.prototype.unselectAll=function(){let t=this.service;null==t&&(t=v.global()),t.unselectAll()},e.prototype.createService=function(){return v.global()},e}(i.Provider);class w extends i.Hierarchy{constructor(){super(),this.consumers=e.Arrays.empty,this.parent=null,this.traits=[],this.traitMap=null}setFlags(t){this.flags=t}attachParent(t){this.willAttachParent(t),this.parent=t,t.mounted&&this.cascadeMount(),this.onAttachParent(t),this.didAttachParent(t)}willAttachParent(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.modelWillAttachParent&&n.modelWillAttachParent(t,this)}const i=this.traits;for(let e=0,n=i.length;e<n;e+=1)i[e].willAttachParent(t)}onAttachParent(t){const e=this.traits;for(let i=0,n=e.length;i<n;i+=1)e[i].onAttachParent(t)}didAttachParent(t){const e=this.traits;for(let i=0,n=e.length;i<n;i+=1)e[i].didAttachParent(t);const i=this.observers;for(let e=0,n=i.length;e<n;e+=1){const n=i[e];void 0!==n.modelDidAttachParent&&n.modelDidAttachParent(t,this)}}detachParent(t){this.willDetachParent(t),this.mounted&&this.cascadeUnmount(),this.onDetachParent(t),this.parent=null,this.didDetachParent(t)}willDetachParent(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.modelWillDetachParent&&n.modelWillDetachParent(t,this)}const i=this.traits;for(let e=0,n=i.length;e<n;e+=1)i[e].willDetachParent(t)}onDetachParent(t){const e=this.traits;for(let i=0,n=e.length;i<n;i+=1)e[i].onDetachParent(t)}didDetachParent(t){const e=this.traits;for(let i=0,n=e.length;i<n;i+=1)e[i].didDetachParent(t);const i=this.observers;for(let e=0,n=i.length;e<n;e+=1){const n=i[e];void 0!==n.modelDidDetachParent&&n.modelDidDetachParent(t,this)}}get insertChildFlags(){return this.constructor.InsertChildFlags}willInsertChild(t,e){super.willInsertChild(t,e);const i=this.observers;for(let n=0,s=i.length;n<s;n+=1){const s=i[n];void 0!==s.modelWillInsertChild&&s.modelWillInsertChild(t,e,this)}const n=this.traits;for(let i=0,s=n.length;i<s;i+=1)n[i].willInsertChild(t,e)}onInsertChild(t,e){super.onInsertChild(t,e),this.bindChildFasteners(t,e);const i=this.traits;for(let n=0,s=i.length;n<s;n+=1)i[n].onInsertChild(t,e)}didInsertChild(t,e){const i=this.traits;for(let n=0,s=i.length;n<s;n+=1)i[n].didInsertChild(t,e);const n=this.observers;for(let i=0,s=n.length;i<s;i+=1){const s=n[i];void 0!==s.modelDidInsertChild&&s.modelDidInsertChild(t,e,this)}super.didInsertChild(t,e)}cascadeInsert(t,e){0!=(this.flags&w.MountedFlag)&&(void 0===t&&(t=0),0!=((t|=this.flags&w.UpdateMask)&w.AnalyzeMask)&&(void 0===e&&(e=this.superModelContext),this.cascadeAnalyze(t,e)))}get removeChildFlags(){return this.constructor.RemoveChildFlags}willRemoveChild(t){super.willRemoveChild(t);const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.modelWillRemoveChild&&n.modelWillRemoveChild(t,this)}const i=this.traits;for(let e=0,n=i.length;e<n;e+=1)i[e].willRemoveChild(t)}onRemoveChild(t){super.onRemoveChild(t);const e=this.traits;for(let i=0,n=e.length;i<n;i+=1)e[i].onRemoveChild(t);this.unbindChildFasteners(t)}didRemoveChild(t){const e=this.traits;for(let i=0,n=e.length;i<n;i+=1)e[i].didRemoveChild(t);const i=this.observers;for(let e=0,n=i.length;e<n;e+=1){const n=i[e];void 0!==n.modelDidRemoveChild&&n.modelDidRemoveChild(t,this)}super.didRemoveChild(t)}get traitCount(){return this.traits.length}firstTrait(){const t=this.traits;return 0!==t.length?t[0]:null}lastTrait(){const t=this.traits,e=t.length;return 0!==e?t[e-1]:null}nextTrait(t){const e=this.traits,i=e.indexOf(t);return i>=0&&i+1<e.length?e[i+1]:null}previousTrait(t){const e=this.traits,i=e.indexOf(t);return i-1>=0?e[i-1]:null}forEachTrait(t,e){let i;const n=this.traits;let s=0;for(;s<n.length;){const o=n[s];if(i=t.call(e,o),void 0!==i)break;n[s]===o&&(s+=1)}return i}insertTraitMap(t){const e=t.key;if(void 0!==e){let i=this.traitMap;null===i&&(i={},this.traitMap=i),i[e]=t}}removeTraitMap(t){const e=t.key;if(void 0!==e){const t=this.traitMap;null!==t&&delete t[e]}}replaceTraitMap(t,e){const i=e.key;if(void 0!==i){let e=this.traitMap;null===e&&(e={},this.traitMap=e),e[i]=t}}getTrait(t,e){if("string"==typeof t){const i=this.traitMap;if(null!==i){const n=i[t];if(void 0!==n&&(void 0===e||n instanceof e))return n}}else{const e=this.traits;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];if(n instanceof t)return n}}return null}setTrait(t,e){null!==e&&(e=A.fromAny(e));const i=this.getTrait(t),n=this.traits;let s=-1,o=null;return null!==i&&null!==e&&i!==e?(e.remove(),s=n.indexOf(i),o=s+1<n.length?n[s+1]:null,e.setKey(i.key),this.willRemoveTrait(i),this.willInsertTrait(e,o),i.detachModel(this),n[s]=e,this.replaceTraitMap(e,i),e.attachModel(this),this.onRemoveTrait(i),this.onInsertTrait(e,o),this.didRemoveTrait(i),this.didInsertTrait(e,o),i.setKey(void 0)):(e!==i||null!==e&&e.key!==t)&&(null!==i&&(this.willRemoveTrait(i),i.detachModel(this),this.removeTraitMap(i),s=n.indexOf(i),n.splice(s,1),this.onRemoveTrait(i),this.didRemoveTrait(i),i.setKey(void 0),s<n.length&&(o=n[s])),null!==e&&(e.remove(),e.setKey(t),this.willInsertTrait(e,o),s>=0?n.splice(s,0,e):n.push(e),this.insertTraitMap(e),e.attachModel(this),this.onInsertTrait(e,o),this.didInsertTrait(e,o))),i}appendTrait(t,e){return(t=A.fromAny(t)).remove(),void 0!==e&&(this.removeChild(e),t.setKey(e)),this.willInsertTrait(t,null),this.traits.push(t),this.insertTraitMap(t),t.attachModel(this),this.onInsertTrait(t,null),this.didInsertTrait(t,null),t}prependTrait(t,e){(t=A.fromAny(t)).remove(),void 0!==e&&(this.removeChild(e),t.setKey(e));const i=this.traits,n=0!==i.length?i[0]:null;return this.willInsertTrait(t,n),i.unshift(t),this.insertTraitMap(t),t.attachModel(this),this.onInsertTrait(t,n),this.didInsertTrait(t,n),t}insertTrait(t,e,i){if(null!==e&&e.model!==this)throw new TypeError(""+e);(t=A.fromAny(t)).remove(),void 0!==i&&(this.removeChild(i),t.setKey(i)),this.willInsertTrait(t,e);const n=this.traits,s=null!==e?n.indexOf(e):-1;return s>=0?n.splice(s,0,t):n.push(t),this.insertTraitMap(t),t.attachModel(this),this.onInsertTrait(t,e),this.didInsertTrait(t,e),t}replaceTrait(t,e){const i=this.traits;let n;if(e.model!==this||(n=i.indexOf(e),n<0))throw new TypeError(""+e);if((t=A.fromAny(t))!==e){t.remove(),t.setKey(e.key);const s=n+1<i.length?i[n+1]:null;this.willRemoveTrait(e),this.willInsertTrait(t,s),e.detachModel(this),i[n]=t,this.replaceTraitMap(t,e),t.attachModel(this),this.onRemoveTrait(e),this.onInsertTrait(t,s),this.didRemoveTrait(e),this.didInsertTrait(t,s),e.setKey(void 0)}return e}get insertTraitFlags(){return this.constructor.InsertTraitFlags}willInsertTrait(t,e){const i=this.observers;for(let n=0,s=i.length;n<s;n+=1){const s=i[n];void 0!==s.modelWillInsertTrait&&s.modelWillInsertTrait(t,e,this)}const n=this.traits;for(let i=0,s=n.length;i<s;i+=1)n[i].willInsertTrait(t,e)}onInsertTrait(t,e){this.requireUpdate(this.insertTraitFlags),this.bindTraitFasteners(t,e);const i=this.traits;for(let n=0,s=i.length;n<s;n+=1)i[n].onInsertTrait(t,e)}didInsertTrait(t,e){const i=this.traits;for(let n=0,s=i.length;n<s;n+=1)i[n].didInsertTrait(t,e);const n=this.observers;for(let i=0,s=n.length;i<s;i+=1){const s=n[i];void 0!==s.modelDidInsertTrait&&s.modelDidInsertTrait(t,e,this)}}removeTrait(t){let e;if("string"==typeof t){if(e=this.getTrait(t),null===e)return null}else e=t;if(e.model!==this)throw new Error("not a member trait");this.willRemoveTrait(e),e.detachModel(this),this.removeTraitMap(e);const i=this.traits,n=i.indexOf(e);if(n>=0&&i.splice(n,1),this.onRemoveTrait(e),this.didRemoveTrait(e),e.setKey(void 0),"string"==typeof t)return e}get removeTraitFlags(){return this.constructor.RemoveTraitFlags}willRemoveTrait(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.modelWillRemoveTrait&&n.modelWillRemoveTrait(t,this)}const i=this.traits;for(let e=0,n=i.length;e<n;e+=1)i[e].willRemoveTrait(t)}onRemoveTrait(t){this.requireUpdate(this.removeTraitFlags);const e=this.traits;for(let i=0,n=e.length;i<n;i+=1)e[i].onRemoveTrait(t);this.unbindTraitFasteners(t)}didRemoveTrait(t){const e=this.traits;for(let i=0,n=e.length;i<n;i+=1)e[i].didRemoveTrait(t);const i=this.observers;for(let e=0,n=i.length;e<n;e+=1){const n=i[e];void 0!==n.modelDidRemoveTrait&&n.modelDidRemoveTrait(t,this)}}mountTraits(){const t=this.traits;for(let e=0,i=t.length;e<i;e+=1)t[e].mountTrait()}unmountTraits(){const t=this.traits;for(let e=0,i=t.length;e<i;e+=1)t[e].unmountTrait()}getSuperTrait(t){const e=this.parent;if(null===e)return null;{const i=e.getTrait(t);return null!==i?i:e.getSuperTrait(t)}}getBaseTrait(t){const e=this.parent;if(null===e)return null;{const i=e.getBaseTrait(t);return null!==i?i:e.getTrait(t)}}get mountFlags(){return this.constructor.MountFlags}mount(){this.mounted||null!==this.parent||(this.cascadeMount(),this.cascadeInsert())}cascadeMount(){if(0!=(this.flags&w.MountedFlag))throw new Error("already mounted");this.setFlags(this.flags|w.MountedFlag|w.TraversingFlag);try{this.willMount(),this.onMount(),this.mountTraits(),this.mountChildren(),this.didMount()}finally{this.setFlags(this.flags&~w.TraversingFlag)}}willMount(){super.willMount();const t=this.observers;for(let e=0,i=t.length;e<i;e+=1){const i=t[e];void 0!==i.modelWillMount&&i.modelWillMount(this)}}onMount(){this.requestUpdate(this,this.flags&w.UpdateMask,!1),this.requireUpdate(this.mountFlags),null!==this.decoherent&&0!==this.decoherent.length&&this.requireUpdate(w.NeedsMutate),this.mountFasteners(),0!==this.consumers.length&&this.startConsuming()}didMount(){const t=this.observers;for(let e=0,i=t.length;e<i;e+=1){const i=t[e];void 0!==i.modelDidMount&&i.modelDidMount(this)}super.didMount()}cascadeUnmount(){if(0==(this.flags&w.MountedFlag))throw new Error("already unmounted");this.setFlags(this.flags&~w.MountedFlag|w.TraversingFlag);try{this.willUnmount(),this.unmountChildren(),this.unmountTraits(),this.onUnmount(),this.didUnmount()}finally{this.setFlags(this.flags&~w.TraversingFlag)}}willUnmount(){super.willUnmount();const t=this.observers;for(let e=0,i=t.length;e<i;e+=1){const i=t[e];void 0!==i.modelWillUnmount&&i.modelWillUnmount(this)}}onUnmount(){this.stopConsuming(),super.onUnmount()}didUnmount(){const t=this.observers;for(let e=0,i=t.length;e<i;e+=1){const i=t[e];void 0!==i.modelDidUnmount&&i.modelDidUnmount(this)}super.didUnmount()}requireUpdate(t,e=!1){const i=this.flags,n=t&~i&w.UpdateMask;0!==n&&(this.setFlags(i|n),this.requestUpdate(this,n,e))}needsUpdate(t,e){const i=this.traits;for(let n=0,s=i.length;n<s;n+=1)t=i[n].needsUpdate(t,e);return t}requestUpdate(t,e,i){e=this.needsUpdate(e,i);let n=this.flags&~e&w.UpdateMask;if(0!=(e&w.AnalyzeMask)&&(n|=w.NeedsAnalyze),0!=(e&w.RefreshMask)&&(n|=w.NeedsRefresh),0!==n||i){this.setFlags(this.flags|n);const s=this.parent;if(null!==s)s.requestUpdate(t,e,i);else if(this.mounted){const n=this.refreshProvider.service;null!=n&&n.requestUpdate(t,e,i)}}}get updating(){return 0!=(this.flags&w.UpdatingMask)}get analyzing(){return 0!=(this.flags&w.AnalyzingFlag)}needsAnalyze(t,e){const i=this.traits;for(let n=0,s=i.length;n<s;n+=1)t=i[n].needsAnalyze(t,e);return t}cascadeAnalyze(t,e){const i=this.extendModelContext(e),n=p.current;try{if(p.current=i,t&=~w.NeedsAnalyze,t|=this.flags&w.UpdateMask,0!=((t=this.needsAnalyze(t,i))&w.AnalyzeMask)){let e=t;this.setFlags(this.flags&~w.NeedsAnalyze|w.TraversingFlag|w.AnalyzingFlag|w.ContextualFlag),this.willAnalyze(e,i),0!=((this.flags|t)&w.NeedsMutate)&&(e|=w.NeedsMutate,this.setFlags(this.flags&~w.NeedsMutate),this.willMutate(i)),0!=((this.flags|t)&w.NeedsAggregate)&&(e|=w.NeedsAggregate,this.setFlags(this.flags&~w.NeedsAggregate),this.willAggregate(i)),0!=((this.flags|t)&w.NeedsCorrelate)&&(e|=w.NeedsCorrelate,this.setFlags(this.flags&~w.NeedsCorrelate),this.willCorrelate(i)),this.onAnalyze(e,i),0!=(e&w.NeedsMutate)&&this.onMutate(i),0!=(e&w.NeedsAggregate)&&this.onAggregate(i),0!=(e&w.NeedsCorrelate)&&this.onCorrelate(i),0!=(e&w.AnalyzeMask)&&(this.setFlags(this.flags&~w.ContextualFlag),this.analyzeChildren(e,i,this.analyzeChild),this.setFlags(this.flags|w.ContextualFlag)),0!=(e&w.NeedsCorrelate)&&this.didCorrelate(i),0!=(e&w.NeedsAggregate)&&this.didAggregate(i),0!=(e&w.NeedsMutate)&&this.didMutate(i),this.didAnalyze(e,i)}}finally{this.setFlags(this.flags&~(w.TraversingFlag|w.AnalyzingFlag|w.ContextualFlag)),p.current=n}}willAnalyze(t,e){const i=this.traits;for(let n=0,s=i.length;n<s;n+=1)i[n].willAnalyze(t,e)}onAnalyze(t,e){const i=this.traits;for(let n=0,s=i.length;n<s;n+=1)i[n].onAnalyze(t,e)}didAnalyze(t,e){const i=this.traits;for(let n=0,s=i.length;n<s;n+=1)i[n].didAnalyze(t,e)}willMutate(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.modelWillMutate&&n.modelWillMutate(t,this)}const i=this.traits;for(let e=0,n=i.length;e<n;e+=1)i[e].willMutate(t)}onMutate(t){this.recohereFasteners(t.updateTime);const e=this.traits;for(let i=0,n=e.length;i<n;i+=1)e[i].onMutate(t)}didMutate(t){const e=this.traits;for(let i=0,n=e.length;i<n;i+=1)e[i].didMutate(t);const i=this.observers;for(let e=0,n=i.length;e<n;e+=1){const n=i[e];void 0!==n.modelDidMutate&&n.modelDidMutate(t,this)}}willAggregate(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.modelWillAggregate&&n.modelWillAggregate(t,this)}const i=this.traits;for(let e=0,n=i.length;e<n;e+=1)i[e].willAggregate(t)}onAggregate(t){const e=this.traits;for(let i=0,n=e.length;i<n;i+=1)e[i].onAggregate(t)}didAggregate(t){const e=this.traits;for(let i=0,n=e.length;i<n;i+=1)e[i].didAggregate(t);const i=this.observers;for(let e=0,n=i.length;e<n;e+=1){const n=i[e];void 0!==n.modelDidAggregate&&n.modelDidAggregate(t,this)}}willCorrelate(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.modelWillCorrelate&&n.modelWillCorrelate(t,this)}const i=this.traits;for(let e=0,n=i.length;e<n;e+=1)i[e].willCorrelate(t)}onCorrelate(t){const e=this.traits;for(let i=0,n=e.length;i<n;i+=1)e[i].onCorrelate(t)}didCorrelate(t){const e=this.traits;for(let i=0,n=e.length;i<n;i+=1)e[i].didCorrelate(t);const i=this.observers;for(let e=0,n=i.length;e<n;e+=1){const n=i[e];void 0!==n.modelDidCorrelate&&n.modelDidCorrelate(t,this)}}analyzeOwnChildren(t,e,i){this.forEachChild((function(n){i.call(this,n,t,e),0!=(n.flags&w.RemovingFlag)&&(n.setFlags(n.flags&~w.RemovingFlag),this.removeChild(n))}),this)}analyzeTraitChildren(t,e,i,n,s){e<t.length?t[e].analyzeChildren(i,n,s,this.analyzeTraitChildren.bind(this,t,e+1)):this.analyzeOwnChildren(i,n,s)}analyzeChildren(t,e,i){const n=this.traits;0!==n.length?this.analyzeTraitChildren(n,0,t,e,i):this.analyzeOwnChildren(t,e,i)}analyzeChild(t,e,i){t.cascadeAnalyze(e,i)}get refreshing(){return 0!=(this.flags&w.RefreshingFlag)}needsRefresh(t,e){const i=this.traits;for(let n=0,s=i.length;n<s;n+=1)t=i[n].needsRefresh(t,e);return t}cascadeRefresh(t,e){const i=this.extendModelContext(e),n=p.current;try{if(p.current=i,t&=~w.NeedsRefresh,t|=this.flags&w.UpdateMask,0!=((t=this.needsRefresh(t,i))&w.RefreshMask)){let e=t;this.setFlags(this.flags&~w.NeedsRefresh|w.TraversingFlag|w.RefreshingFlag|w.ContextualFlag),this.willRefresh(e,i),0!=((this.flags|t)&w.NeedsValidate)&&(e|=w.NeedsValidate,this.setFlags(this.flags&~w.NeedsValidate),this.willValidate(i)),0!=((this.flags|t)&w.NeedsReconcile)&&(e|=w.NeedsReconcile,this.setFlags(this.flags&~w.NeedsReconcile),this.willReconcile(i)),this.onRefresh(e,i),0!=(e&w.NeedsValidate)&&this.onValidate(i),0!=(e&w.NeedsReconcile)&&this.onReconcile(i),e&w.RefreshMask&&(this.setFlags(this.flags&~w.ContextualFlag),this.refreshChildren(e,i,this.refreshChild),this.setFlags(this.flags|w.ContextualFlag)),0!=(e&w.NeedsReconcile)&&this.didReconcile(i),0!=(e&w.NeedsValidate)&&this.didValidate(i),this.didRefresh(e,i)}}finally{this.setFlags(this.flags&~(w.TraversingFlag|w.RefreshingFlag|w.ContextualFlag)),p.current=n}}willRefresh(t,e){const i=this.traits;for(let n=0,s=i.length;n<s;n+=1)i[n].willRefresh(t,e)}onRefresh(t,e){const i=this.traits;for(let n=0,s=i.length;n<s;n+=1)i[n].onRefresh(t,e)}didRefresh(t,e){const i=this.traits;for(let n=0,s=i.length;n<s;n+=1)i[n].didRefresh(t,e)}willValidate(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.modelWillValidate&&n.modelWillValidate(t,this)}const i=this.traits;for(let e=0,n=i.length;e<n;e+=1)i[e].willValidate(t)}onValidate(t){const e=this.traits;for(let i=0,n=e.length;i<n;i+=1)e[i].onValidate(t)}didValidate(t){const e=this.traits;for(let i=0,n=e.length;i<n;i+=1)e[i].didValidate(t);const i=this.observers;for(let e=0,n=i.length;e<n;e+=1){const n=i[e];void 0!==n.modelDidValidate&&n.modelDidValidate(t,this)}}willReconcile(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.modelWillReconcile&&n.modelWillReconcile(t,this)}const i=this.traits;for(let e=0,n=i.length;e<n;e+=1)i[e].willReconcile(t)}onReconcile(t){this.recohereDownlinks(t.updateTime);const e=this.traits;for(let i=0,n=e.length;i<n;i+=1)e[i].onReconcile(t)}didReconcile(t){const e=this.traits;for(let i=0,n=e.length;i<n;i+=1)e[i].didReconcile(t);const i=this.observers;for(let e=0,n=i.length;e<n;e+=1){const n=i[e];void 0!==n.modelDidReconcile&&n.modelDidReconcile(t,this)}}refreshOwnChildren(t,e,i){this.forEachChild((function(n){i.call(this,n,t,e),0!=(n.flags&w.RemovingFlag)&&(n.setFlags(n.flags&~w.RemovingFlag),this.removeChild(n))}),this)}refreshTraitChildren(t,e,i,n,s){e<t.length?t[e].refreshChildren(i,n,s,this.refreshTraitChildren.bind(this,t,e+1)):this.refreshOwnChildren(i,n,s)}refreshChildren(t,e,i){const n=this.traits;0!==n.length?this.refreshTraitChildren(n,0,t,e,i):this.refreshOwnChildren(t,e,i)}refreshChild(t,e,i){t.cascadeRefresh(e,i)}onAttachFastener(t,e){super.onAttachFastener(t,e),this.bindFastener(e)}bindFastener(t){(t instanceof b||t instanceof x)&&t.binds&&this.forEachChild((function(e){t.bindModel(e,null)}),this),t instanceof x&&t.binds&&this.forEachTrait((function(e){t.bindTrait(e,null)}),this),t instanceof n.DownlinkFastener&&!0===t.consumed&&this.consuming&&t.consume(this)}bindChildFasteners(t,e){const i=this.fasteners;for(const n in i){const s=i[n];this.bindChildFastener(s,t,e)}}bindChildFastener(t,e,i){(t instanceof b||t instanceof x)&&t.bindModel(e,i)}unbindChildFasteners(t){const e=this.fasteners;for(const i in e){const n=e[i];this.unbindChildFastener(n,t)}}unbindChildFastener(t,e){(t instanceof b||t instanceof x)&&t.unbindModel(e)}bindTraitFasteners(t,e){const i=this.fasteners;for(const n in i){const s=i[n];this.bindTraitFastener(s,t,e)}}bindTraitFastener(t,e,i){t instanceof x&&t.bindTrait(e,i)}unbindTraitFasteners(t){const e=this.fasteners;for(const i in e){const n=e[i];this.unbindTraitFastener(n,t)}}unbindTraitFastener(t,e){t instanceof x&&t.unbindTrait(e)}decohereFastener(t){super.decohereFastener(t),t instanceof n.DownlinkFastener?this.requireUpdate(w.NeedsReconcile):this.requireUpdate(w.NeedsMutate)}recohereFasteners(t){const e=this.decoherent;if(null!==e){const i=e.length;if(0!==i){void 0===t&&(t=performance.now()),this.decoherent=null;for(let s=0;s<i;s+=1){const i=e[s];i instanceof n.DownlinkFastener?this.decohereFastener(i):i.recohere(t)}}}}recohereDownlinks(t){const e=this.decoherent;if(null!==e){const i=e.length;if(0!==i){this.decoherent=null;for(let s=0;s<i;s+=1){const i=e[s];i instanceof n.DownlinkFastener?i.recohere(t):this.decohereFastener(i)}}}}consume(t){const i=this.consumers,n=e.Arrays.inserted(t,i);i!==n&&(this.willConsume(t),this.consumers=n,this.onConsume(t),this.didConsume(t),0===i.length&&this.mounted&&this.startConsuming())}willConsume(t){}onConsume(t){}didConsume(t){}unconsume(t){const i=this.consumers,n=e.Arrays.removed(t,i);i!==n&&(this.willUnconsume(t),this.consumers=n,this.onUnconsume(t),this.didUnconsume(t),0===n.length&&this.stopConsuming())}willUnconsume(t){}onUnconsume(t){}didUnconsume(t){}get consuming(){return 0!=(this.flags&w.ConsumingFlag)}get startConsumingFlags(){return this.constructor.StartConsumingFlags}startConsuming(){0==(this.flags&w.ConsumingFlag)&&(this.willStartConsuming(),this.setFlags(this.flags|w.ConsumingFlag),this.onStartConsuming(),this.didStartConsuming())}willStartConsuming(){const t=this.observers;for(let e=0,i=t.length;e<i;e+=1){const i=t[e];void 0!==i.modelWillStartConsuming&&i.modelWillStartConsuming(this)}}onStartConsuming(){this.requireUpdate(this.startConsumingFlags),this.startConsumingFasteners()}didStartConsuming(){const t=this.observers;for(let e=0,i=t.length;e<i;e+=1){const i=t[e];void 0!==i.modelDidStartConsuming&&i.modelDidStartConsuming(this)}}get stopConsumingFlags(){return this.constructor.StopConsumingFlags}stopConsuming(){0!=(this.flags&w.ConsumingFlag)&&(this.willStopConsuming(),this.setFlags(this.flags&~w.ConsumingFlag),this.onStopConsuming(),this.didStopConsuming())}willStopConsuming(){const t=this.observers;for(let e=0,i=t.length;e<i;e+=1){const i=t[e];void 0!==i.modelWillStopConsuming&&i.modelWillStopConsuming(this)}}onStopConsuming(){this.requireUpdate(this.stopConsumingFlags),this.stopConsumingFasteners()}didStopConsuming(){const t=this.observers;for(let e=0,i=t.length;e<i;e+=1){const i=t[e];void 0!==i.modelDidStopConsuming&&i.modelDidStopConsuming(this)}}startConsumingFasteners(){const t=this.fasteners;for(const e in t){const i=t[e];i instanceof n.DownlinkFastener&&!0===i.consumed&&i.consume(this)}}stopConsumingFasteners(){const t=this.fasteners;for(const e in t){const i=t[e];i instanceof n.DownlinkFastener&&!0===i.consumed&&i.unconsume(this)}}get superModelContext(){const t=this.parent;return null!==t?t.modelContext:this.refreshProvider.updatedModelContext()}extendModelContext(t){return t}get modelContext(){return 0!=(this.flags&w.ContextualFlag)?p.current:this.extendModelContext(this.superModelContext)}init(t){}static create(){return new this}static fromInit(t){let i;i=("object"==typeof t&&null!==t||"function"==typeof t)&&e.Creatable.is(t.type)?t.type:this;const n=i.create();return n.init(t),n}static fromAny(t){if(null==t)return t;if(t instanceof w){if(t instanceof this)return t;throw new TypeError(t+" not an instance of "+this)}return e.Creatable.is(t)?t.create():this.fromInit(t)}}w.uid=function(){let t=1;return function(){const e=~~t;return t+=1,e}}(),w.MountedFlag=i.Hierarchy.MountedFlag,w.RemovingFlag=i.Hierarchy.RemovingFlag,w.TraversingFlag=i.Hierarchy.TraversingFlag,w.AnalyzingFlag=1<<i.Hierarchy.FlagShift+0,w.RefreshingFlag=1<<i.Hierarchy.FlagShift+1,w.ContextualFlag=1<<i.Hierarchy.FlagShift+2,w.ConsumingFlag=1<<i.Hierarchy.FlagShift+3,w.UpdatingMask=w.AnalyzingFlag|w.RefreshingFlag,w.StatusMask=w.MountedFlag|w.RemovingFlag|w.TraversingFlag|w.AnalyzingFlag|w.RefreshingFlag|w.ContextualFlag|w.ConsumingFlag,w.NeedsAnalyze=1<<i.Hierarchy.FlagShift+4,w.NeedsMutate=1<<i.Hierarchy.FlagShift+5,w.NeedsAggregate=1<<i.Hierarchy.FlagShift+6,w.NeedsCorrelate=1<<i.Hierarchy.FlagShift+7,w.AnalyzeMask=w.NeedsAnalyze|w.NeedsMutate|w.NeedsAggregate|w.NeedsCorrelate,w.NeedsRefresh=1<<i.Hierarchy.FlagShift+8,w.NeedsValidate=1<<i.Hierarchy.FlagShift+9,w.NeedsReconcile=1<<i.Hierarchy.FlagShift+10,w.RefreshMask=w.NeedsRefresh|w.NeedsValidate|w.NeedsReconcile,w.UpdateMask=w.AnalyzeMask|w.RefreshMask,w.FlagShift=i.Hierarchy.FlagShift+11,w.FlagMask=(1<<w.FlagShift)-1,w.MountFlags=0,w.InsertChildFlags=0,w.RemoveChildFlags=0,w.InsertTraitFlags=0,w.RemoveTraitFlags=0,w.StartConsumingFlags=0,w.StopConsumingFlags=0,u([i.Provider({extends:g,type:f,observes:!1,service:f.global()})],w.prototype,"refreshProvider",void 0),u([i.Provider({extends:y,type:v,observes:!1,service:v.global()})],w.prototype,"selectionProvider",void 0),u([i.Provider({extends:n.WarpProvider,type:n.WarpService,observes:!1,service:n.WarpService.global()})],w.prototype,"warpProvider",void 0),u([i.Property({type:Object,inherits:!0,state:null,updateFlags:w.NeedsReconcile})],w.prototype,"warpRef",void 0);class m extends w{constructor(){super(),this.children=[],this.childMap=null}get childCount(){return this.children.length}firstChild(){const t=this.children;return 0!==t.length?t[0]:null}lastChild(){const t=this.children,e=t.length;return 0!==e?t[e-1]:null}nextChild(t){const e=this.children,i=e.indexOf(t);return i>=0&&i+1<e.length?e[i+1]:null}previousChild(t){const e=this.children,i=e.indexOf(t);return i-1>=0?e[i-1]:null}forEachChild(t,e){let i;const n=this.children;let s=0;for(;s<n.length;){const o=n[s];if(i=t.call(e,o),void 0!==i)break;n[s]===o&&(s+=1)}return i}insertChildMap(t){const e=t.key;if(void 0!==e){let i=this.childMap;null===i&&(i={},this.childMap=i),i[e]=t}}removeChildMap(t){const e=t.key;if(void 0!==e){const t=this.childMap;null!==t&&delete t[e]}}replaceChildMap(t,e){const i=e.key;if(void 0!==i){let e=this.childMap;null===e&&(e={},this.childMap=e),e[i]=t}}getChild(t,e){const i=this.childMap;if(null!==i){const n=i[t];if(void 0!==n&&(void 0===e||n instanceof e))return n}return null}setChild(t,e){null!==e&&(e=w.fromAny(e));const i=this.getChild(t),n=this.children;let s=-1,o=null;return null!==i&&null!==e&&i!==e?(e.remove(),s=n.indexOf(i),o=s+1<n.length?n[s+1]:null,e.setKey(i.key),this.willRemoveChild(i),this.willInsertChild(e,o),i.detachParent(this),n[s]=e,this.replaceChildMap(e,i),e.attachParent(this),this.onRemoveChild(i),this.onInsertChild(e,o),this.didRemoveChild(i),this.didInsertChild(e,o),i.setKey(void 0),e.cascadeInsert()):(e!==i||null!==e&&e.key!==t)&&(null!==i&&(this.willRemoveChild(i),i.detachParent(this),this.removeChildMap(i),s=n.indexOf(i),n.splice(s,1),this.onRemoveChild(i),this.didRemoveChild(i),i.setKey(void 0),s<n.length&&(o=n[s])),null!==e&&(e.remove(),e.setKey(t),this.willInsertChild(e,o),s>=0?n.splice(s,0,e):n.push(e),this.insertChildMap(e),e.attachParent(this),this.onInsertChild(e,o),this.didInsertChild(e,o),e.cascadeInsert())),i}appendChild(t,e){return(t=w.fromAny(t)).remove(),void 0!==e&&(this.removeChild(e),t.setKey(e)),this.willInsertChild(t,null),this.children.push(t),this.insertChildMap(t),t.attachParent(this),this.onInsertChild(t,null),this.didInsertChild(t,null),t.cascadeInsert(),t}prependChild(t,e){(t=w.fromAny(t)).remove(),void 0!==e&&(this.removeChild(e),t.setKey(e));const i=this.children,n=0!==i.length?i[0]:null;return this.willInsertChild(t,n),i.unshift(t),this.insertChildMap(t),t.attachParent(this),this.onInsertChild(t,n),this.didInsertChild(t,n),t.cascadeInsert(),t}insertChild(t,e,i){if(null!==e&&e.parent!==this)throw new TypeError(""+e);(t=w.fromAny(t)).remove(),void 0!==i&&(this.removeChild(i),t.setKey(i)),this.willInsertChild(t,e);const n=this.children,s=null!==e?n.indexOf(e):-1;return s>=0?n.splice(s,0,t):n.push(t),this.insertChildMap(t),t.attachParent(this),this.onInsertChild(t,e),this.didInsertChild(t,e),t.cascadeInsert(),t}replaceChild(t,e){const i=this.children;if(e.parent!==this)throw new TypeError(""+e);if((t=w.fromAny(t))!==e){t.remove();const n=i.indexOf(e),s=n+1<i.length?i[n+1]:null;t.setKey(e.key),this.willRemoveChild(e),this.willInsertChild(t,s),e.detachParent(this),i[n]=t,this.replaceChildMap(t,e),t.attachParent(this),this.onRemoveChild(e),this.onInsertChild(t,s),this.didRemoveChild(e),this.didInsertChild(t,s),e.setKey(void 0),t.cascadeInsert()}return e}removeChild(t){let e;if("string"==typeof t){if(e=this.getChild(t),null===e)return null}else if(e=t,e.parent!==this)throw new Error("not a child model");this.willRemoveChild(e),e.detachParent(this),this.removeChildMap(e);const i=this.children,n=i.indexOf(e);return i.splice(n,1),this.onRemoveChild(e),this.didRemoveChild(e),e.setKey(void 0),e}removeChildren(){const t=this.children;let e;for(;e=t.length,0!==e;){const i=t[e-1];this.willRemoveChild(i),i.detachParent(this),this.removeChildMap(i),t.pop(),this.onRemoveChild(i),this.didRemoveChild(i),i.setKey(void 0)}}mountChildren(){const t=this.children;let e=0;for(;e<t.length;){const i=t[e];i.cascadeMount(),0==(i.flags&w.RemovingFlag)?e+=1:(i.setFlags(i.flags&~w.RemovingFlag),this.removeChild(i))}}unmountChildren(){const t=this.children;let e=0;for(;e<t.length;){const i=t[e];i.cascadeUnmount(),0==(i.flags&w.RemovingFlag)?e+=1:(i.setFlags(i.flags&~w.RemovingFlag),this.removeChild(i))}}analyzeOwnChildren(t,e,i){const n=this.children;let s=0;for(;s<n.length;){const o=n[s];i.call(this,o,t,e),0==(o.flags&w.RemovingFlag)?s+=1:(o.setFlags(o.flags&~w.RemovingFlag),this.removeChild(o))}}refreshOwnChildren(t,e,i){const n=this.children;let s=0;for(;s<n.length;){const o=n[s];i.call(this,o,t,e),0==(o.flags&w.RemovingFlag)?s+=1:(o.setFlags(o.flags&~w.RemovingFlag),this.removeChild(o))}}}const b=function(t){const e=t.extend("ModelRelation");return Object.defineProperty(e.prototype,"familyType",{get:function(){return e},configurable:!0}),e.prototype.initModel=function(t){},e.prototype.willAttachModel=function(t,e){},e.prototype.onAttachModel=function(t,e){!0===this.observes&&t.observe(this)},e.prototype.didAttachModel=function(t,e){},e.prototype.deinitModel=function(t){},e.prototype.willDetachModel=function(t){},e.prototype.onDetachModel=function(t){!0===this.observes&&t.unobserve(this)},e.prototype.didDetachModel=function(t){},Object.defineProperty(e.prototype,"parentModel",{get(){const t=this.owner;return t instanceof w?t:t instanceof A?t.model:null},configurable:!0}),e.prototype.insertChild=function(t,e,i,n){t.insertChild(e,i,n)},e.prototype.bindModel=function(t,e){},e.prototype.unbindModel=function(t){},e.prototype.detectModel=function(t){return null},e.prototype.createModel=function(){let t;const e=this.type;if(void 0!==e&&(t=e.create()),null==t){let t="Unable to create ";throw 0!==this.name.length&&(t+=this.name+" "),t+="model",new Error(t)}return t},e.prototype.fromAny=function(t){const e=this.type;return void 0!==e?e.fromAny(t):w.fromAny(t)},Object.defineProperty(e.prototype,"lazy",{get:function(){return!1},configurable:!0}),Object.defineProperty(e.prototype,"static",{get:function(){return!0},configurable:!0}),e.construct=function(e,i,n){return i=t.construct(e,i,n)},e.define=function(t,e){let i=e.extends;const n=e.affinity,s=e.inherits;delete e.extends,delete e.affinity,delete e.inherits,null==i&&(i=this);const o=i.extend(t,e);return o.construct=function(t,e,o){return e=i.construct(t,e,o),void 0!==n&&e.initAffinity(n),void 0!==s&&e.initInherits(s),e},o},e}(i.Fastener),C=function(t){const e=t.extend("ModelRef");return Object.defineProperty(e.prototype,"familyType",{get:function(){return e},configurable:!0}),e.prototype.onInherit=function(t){this.setModel(t.model)},e.prototype.getModel=function(){const t=this.model;if(null===t){let e=t+" ";throw 0!==this.name.length&&(e+=this.name+" "),e+="model",new TypeError(e)}return t},e.prototype.setModel=function(t,e,i){null!==t&&(t=this.fromAny(t));let n=this.model;if(n!==t){let s;void 0===e&&(e=null),this.binds&&(s=this.parentModel,null!==s)&&(null!==n&&n.parent===s&&(null===e&&(e=s.nextChild(n)),n.remove()),null!==t&&(void 0===i&&(i=this.key),this.insertChild(s,t,e,i)),n=this.model),n!==t&&(null!==n&&(this.willDetachModel(n),this.model=null,this.onDetachModel(n),this.deinitModel(n),this.didDetachModel(n)),null!==t&&(this.willAttachModel(t,e),this.model=t,this.onAttachModel(t,e),this.initModel(t),this.didAttachModel(t,e)))}return n},e.prototype.attachModel=function(t,e){const i=this.model;return(t=null!=t?this.fromAny(t):null===i?this.createModel():i)!==i&&(void 0===e&&(e=null),null!==i&&(this.willDetachModel(i),this.model=null,this.onDetachModel(i),this.deinitModel(i),this.didDetachModel(i)),this.willAttachModel(t,e),this.model=t,this.onAttachModel(t,e),this.initModel(t),this.didAttachModel(t,e)),t},e.prototype.detachModel=function(){const t=this.model;return null!==t&&(this.willDetachModel(t),this.model=null,this.onDetachModel(t),this.deinitModel(t),this.didDetachModel(t)),t},e.prototype.insertModel=function(t,e,i,n){if(null!=e)e=this.fromAny(e);else{const t=this.model;e=null===t?this.createModel():t}null==t&&(t=this.parentModel),void 0===i&&(i=null),void 0===n&&(n=this.key),null===t||e.parent===t&&e.key===n||this.insertChild(t,e,i,n);const s=this.model;return e!==s&&(null!==s&&(this.willDetachModel(s),this.model=null,this.onDetachModel(s),this.deinitModel(s),this.didDetachModel(s),s.remove()),this.willAttachModel(e,i),this.model=e,this.onAttachModel(e,i),this.initModel(e),this.didAttachModel(e,i)),e},e.prototype.removeModel=function(){const t=this.model;return null!==t&&t.remove(),t},e.prototype.deleteModel=function(){const t=this.detachModel();return null!==t&&t.remove(),t},e.prototype.bindModel=function(t,e){if(this.binds&&null===this.model){const i=this.detectModel(t);null!==i&&(this.willAttachModel(i,e),this.model=i,this.onAttachModel(i,e),this.initModel(i),this.didAttachModel(i,e))}},e.prototype.unbindModel=function(t){if(this.binds){const e=this.detectModel(t);null!==e&&this.model===e&&(this.willDetachModel(e),this.model=null,this.onDetachModel(e),this.deinitModel(e),this.didDetachModel(e))}},e.prototype.detectModel=function(t){const e=this.key;return void 0!==e&&e===t.key?t:null},e.construct=function(e,i,n){return null===i&&(delete(i=function(t,e,n){return void 0===t?i.model:(i.setModel(t,e,n),i.owner)}).name,Object.setPrototypeOf(i,e.prototype)),(i=t.construct(e,i,n)).model=null,i},e.define=function(t,e){let i=e.extends;const n=e.affinity,s=e.inherits;delete e.extends,delete e.affinity,delete e.inherits,!0===e.key?Object.defineProperty(e,"key",{value:t,configurable:!0}):!1===e.key&&Object.defineProperty(e,"key",{value:void 0,configurable:!0}),null==i&&(i=this);const o=i.extend(t,e);return o.construct=function(t,e,o){return e=i.construct(t,e,o),void 0!==n&&e.initAffinity(n),void 0!==s&&e.initInherits(s),e},o},e}(b),S=function(t){const e=t.extend("ModelSet");return Object.defineProperty(e.prototype,"familyType",{get:function(){return e},configurable:!0}),e.prototype.hasModel=function(t){return void 0!==this.models[t.uid]},e.prototype.addModel=function(t,e,i){let n;t=null!=t?this.fromAny(t):this.createModel(),void 0===e&&(e=null),this.binds&&(n=this.parentModel,null!==n)&&(void 0===i&&(i=this.key(t)),this.insertChild(n,t,e,i));const s=this.models;return void 0===s[t.uid]&&(this.willAttachModel(t,e),s[t.uid]=t,this.modelCount+=1,this.onAttachModel(t,e),this.initModel(t),this.didAttachModel(t,e)),t},e.prototype.attachModel=function(t,e){t=null!=t?this.fromAny(t):this.createModel();const i=this.models;return void 0===i[t.uid]&&(void 0===e&&(e=null),this.willAttachModel(t,e),i[t.uid]=t,this.modelCount+=1,this.onAttachModel(t,e),this.initModel(t),this.didAttachModel(t,e)),t},e.prototype.detachModel=function(t){const e=this.models;return void 0!==e[t.uid]?(this.willDetachModel(t),this.modelCount-=1,delete e[t.uid],this.onDetachModel(t),this.deinitModel(t),this.didDetachModel(t),t):null},e.prototype.insertModel=function(t,e,i,n){e=null!=e?this.fromAny(e):this.createModel(),null==t&&(t=this.parentModel),void 0===i&&(i=null),void 0===n&&(n=this.key(e)),null===t||e.parent===t&&e.key===n||this.insertChild(t,e,i,n);const s=this.models;return void 0===s[e.uid]&&(this.willAttachModel(e,i),s[e.uid]=e,this.modelCount+=1,this.onAttachModel(e,i),this.initModel(e),this.didAttachModel(e,i)),e},e.prototype.removeModel=function(t){return this.hasModel(t)?(t.remove(),t):null},e.prototype.deleteModel=function(t){const e=this.detachModel(t);return null!==e&&e.remove(),e},e.prototype.bindModel=function(t,e){if(this.binds){const i=this.detectModel(t),n=this.models;null!==i&&void 0===n[i.uid]&&(this.willAttachModel(i,e),n[i.uid]=i,this.modelCount+=1,this.onAttachModel(i,e),this.initModel(i),this.didAttachModel(i,e))}},e.prototype.unbindModel=function(t){if(this.binds){const e=this.detectModel(t),i=this.models;null!==e&&void 0!==i[e.uid]&&(this.willDetachModel(e),this.modelCount-=1,delete i[e.uid],this.onDetachModel(e),this.deinitModel(e),this.didDetachModel(e))}},e.prototype.detectModel=function(t){return"function"==typeof this.type&&t instanceof this.type?t:null},e.prototype.key=function(t){},e.construct=function(e,i,n){return null===i&&(delete(i=function(t){return i.addModel(t),i.owner}).name,Object.setPrototypeOf(i,e.prototype)),(i=t.construct(e,i,n)).models={},i.modelCount=0,i},e.define=function(t,e){let i=e.extends;const n=e.affinity,s=e.inherits;delete e.extends,delete e.affinity,delete e.inherits,null==i&&(i=this);const o=i.extend(t,e);return o.construct=function(t,e,o){return e=i.construct(t,e,o),void 0!==n&&e.initAffinity(n),void 0!==s&&e.initInherits(s),e},o},e}(b);class A{constructor(){this.uid=this.constructor.uid(),this.key=void 0,this.flags=0,this.fasteners=null,this.decoherent=null,this.observers=e.Arrays.empty,this.consumers=e.Arrays.empty,this.model=null}setKey(t){this.key=t}setFlags(t){this.flags=t}attachModel(t){this.willAttachModel(t),this.model=t,t.mounted&&this.mountTrait(),this.onAttachModel(t),this.didAttachModel(t)}willAttachModel(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.traitWillAttachModel&&n.traitWillAttachModel(t,this)}}onAttachModel(t){this.bindModelFasteners(t)}didAttachModel(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.traitDidAttachModel&&n.traitDidAttachModel(t,this)}}detachModel(t){this.willDetachModel(t),this.mounted&&this.unmountTrait(),this.onDetachModel(t),this.model=null,this.didDetachModel(t)}willDetachModel(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.traitWillDetachModel&&n.traitWillDetachModel(t,this)}}onDetachModel(t){this.unbindModelFasteners(t)}didDetachModel(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.traitDidDetachModel&&n.traitDidDetachModel(t,this)}}get modelFlags(){const t=this.model;return null!==t?t.flags:0}setModelFlags(t){const e=this.model;if(null===e)throw new Error("no model");e.setFlags(t)}remove(){const t=this.model;null!==t&&t.removeTrait(this)}get parent(){const t=this.model;return null!==t?t.parent:null}willAttachParent(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.traitWillAttachParent&&n.traitWillAttachParent(t,this)}}onAttachParent(t){}didAttachParent(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.traitDidAttachParent&&n.traitDidAttachParent(t,this)}}willDetachParent(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.traitWillDetachParent&&n.traitWillDetachParent(t,this)}}onDetachParent(t){}didDetachParent(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.traitDidDetachParent&&n.traitDidDetachParent(t,this)}}get childCount(){const t=this.model;return null!==t?t.childCount:0}get children(){const t=this.model;return null!==t?t.children:[]}firstChild(){const t=this.model;return null!==t?t.firstChild():null}lastChild(){const t=this.model;return null!==t?t.lastChild():null}nextChild(t){const e=this.model;return null!==e?e.nextChild(t):null}previousChild(t){const e=this.model;return null!==e?e.previousChild(t):null}forEachChild(t,e){const i=this.model;return null!==i?i.forEachChild(t,e):void 0}getChild(t,e){const i=this.model;return null!==i?i.getChild(t,e):null}setChild(t,e){const i=this.model;if(null!==i)return i.setChild(t,e);throw new Error("no model")}appendChild(t,e){const i=this.model;if(null!==i)return i.appendChild(t,e);throw new Error("no model")}prependChild(t,e){const i=this.model;if(null!==i)return i.prependChild(t,e);throw new Error("no model")}insertChild(t,e,i){const n=this.model;if(null!==n)return n.insertChild(t,e,i);throw new Error("no model")}replaceChild(t,e){const i=this.model;if(null!==i)return i.replaceChild(t,e);throw new Error("no model")}get insertChildFlags(){return this.constructor.InsertChildFlags}willInsertChild(t,e){const i=this.observers;for(let n=0,s=i.length;n<s;n+=1){const s=i[n];void 0!==s.traitWillInsertChild&&s.traitWillInsertChild(t,e,this)}}onInsertChild(t,e){this.requireUpdate(this.insertChildFlags),this.bindChildFasteners(t,e)}didInsertChild(t,e){const i=this.observers;for(let n=0,s=i.length;n<s;n+=1){const s=i[n];void 0!==s.traitDidInsertChild&&s.traitDidInsertChild(t,e,this)}}removeChild(t){const e=this.model;if("string"==typeof t)return null!==e?e.removeChild(t):null;null!==e&&e.removeChild(t)}get removeChildFlags(){return this.constructor.RemoveChildFlags}willRemoveChild(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.traitWillRemoveChild&&n.traitWillRemoveChild(t,this)}this.requireUpdate(this.removeChildFlags)}onRemoveChild(t){this.unbindChildFasteners(t)}didRemoveChild(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.traitDidRemoveChild&&n.traitDidRemoveChild(t,this)}}getSuper(t){const e=this.model;return null!==e?e.getSuper(t):null}getBase(t){const e=this.model;return null!==e?e.getBase(t):null}get traitCount(){const t=this.model;return null!==t?t.traitCount:0}get traits(){const t=this.model;return null!==t?t.traits:[]}firstTrait(){const t=this.model;return null!==t?t.firstTrait():null}lastTrait(){const t=this.model;return null!==t?t.lastTrait():null}nextTrait(t){const e=this.model;return null!==e?e.nextTrait(t):null}previousTrait(t){const e=this.model;return null!==e?e.previousTrait(t):null}forEachTrait(t,e){const i=this.model;return null!==i?i.forEachTrait(t,e):void 0}getTrait(t,e){const i=this.model;return null!==i?i.getTrait(t,e):null}setTrait(t,e){const i=this.model;if(null!==i)return i.setTrait(t,e);throw new Error("no model")}appendTrait(t,e){const i=this.model;if(null!==i)return i.appendTrait(t,e);throw new Error("no model")}prependTrait(t,e){const i=this.model;if(null!==i)return i.prependTrait(t,e);throw new Error("no model")}insertTrait(t,e,i){const n=this.model;if(null!==n)return n.insertTrait(t,e,i);throw new Error("no model")}replaceTraitt(t,e){const i=this.model;if(null!==i)return i.replaceTrait(t,e);throw new Error("no model")}get insertTraitFlags(){return this.constructor.InsertTraitFlags}willInsertTrait(t,e){const i=this.observers;for(let n=0,s=i.length;n<s;n+=1){const s=i[n];void 0!==s.traitWillInsertTrait&&s.traitWillInsertTrait(t,e,this)}}onInsertTrait(t,e){this.requireUpdate(this.insertTraitFlags),this.bindTraitFasteners(t,e)}didInsertTrait(t,e){const i=this.observers;for(let n=0,s=i.length;n<s;n+=1){const s=i[n];void 0!==s.traitDidInsertTrait&&s.traitDidInsertTrait(t,e,this)}}removeTrait(t){const e=this.model;if("string"==typeof t)return null!==e?e.removeTrait(t):null;null!==e&&e.removeTrait(t)}get removeTraitFlags(){return this.constructor.RemoveTraitFlags}willRemoveTrait(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.traitWillRemoveTrait&&n.traitWillRemoveTrait(t,this)}}onRemoveTrait(t){this.requireUpdate(this.removeTraitFlags),this.unbindTraitFasteners(t)}didRemoveTrait(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.traitDidRemoveTrait&&n.traitDidRemoveTrait(t,this)}}getSuperTrait(t){const e=this.model;return null!==e?e.getSuperTrait(t):null}getBaseTrait(t){const e=this.model;return null!==e?e.getBaseTrait(t):null}get mounted(){return 0!=(this.flags&A.MountedFlag)}get mountFlags(){return this.constructor.MountFlags}mountTrait(){if(0!=(this.flags&A.MountedFlag))throw new Error("already mounted");this.setFlags(this.flags|A.MountedFlag),this.willMount(),this.onMount(),this.didMount()}willMount(){const t=this.observers;for(let e=0,i=t.length;e<i;e+=1){const i=t[e];void 0!==i.traitWillMount&&i.traitWillMount(this)}}onMount(){this.requireUpdate(this.mountFlags),null!==this.decoherent&&0!==this.decoherent.length&&this.requireUpdate(w.NeedsMutate),this.mountFasteners(),0!==this.consumers.length&&this.startConsuming()}didMount(){const t=this.observers;for(let e=0,i=t.length;e<i;e+=1){const i=t[e];void 0!==i.traitDidMount&&i.traitDidMount(this)}}unmountTrait(){if(0==(this.flags&A.MountedFlag))throw new Error("already unmounted");this.setFlags(this.flags&~A.MountedFlag),this.willUnmount(),this.onUnmount(),this.didUnmount()}willUnmount(){const t=this.observers;for(let e=0,i=t.length;e<i;e+=1){const i=t[e];void 0!==i.traitWillUnmount&&i.traitWillUnmount(this)}}onUnmount(){this.stopConsuming(),this.unmountFasteners()}didUnmount(){const t=this.observers;for(let e=0,i=t.length;e<i;e+=1){const i=t[e];void 0!==i.traitDidUnmount&&i.traitDidUnmount(this)}}requireUpdate(t,e=!1){const i=this.model;null!==i&&i.requireUpdate(t,e)}needsUpdate(t,e){return t}requestUpdate(t,e,i){const n=this.model;if(null===n)throw new TypeError("no model");n.requestUpdate(t,e,i)}get traversing(){const t=this.model;return null!==t&&t.traversing}get updating(){const t=this.model;return null!==t&&t.updating}get analyzing(){const t=this.model;return null!==t&&t.analyzing}needsAnalyze(t,e){return t}willAnalyze(t,e){}onAnalyze(t,e){}didAnalyze(t,e){}willMutate(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.traitWillMutate&&n.traitWillMutate(t,this)}}onMutate(t){this.recohereFasteners(t.updateTime)}didMutate(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.traitDidMutate&&n.traitDidMutate(t,this)}}willAggregate(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.traitWillAggregate&&n.traitWillAggregate(t,this)}}onAggregate(t){}didAggregate(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.traitDidAggregate&&n.traitDidAggregate(t,this)}}willCorrelate(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.traitWillCorrelate&&n.traitWillCorrelate(t,this)}}onCorrelate(t){}didCorrelate(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.traitDidCorrelate&&n.traitDidCorrelate(t,this)}}analyzeChildren(t,e,i,n){const s=this.model;n.call(s,t,e,i)}get refreshing(){const t=this.model;return null!==t&&t.refreshing}needsRefresh(t,e){return t}willRefresh(t,e){}onRefresh(t,e){}didRefresh(t,e){}willValidate(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.traitWillValidate&&n.traitWillValidate(t,this)}}onValidate(t){}didValidate(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.traitDidValidate&&n.traitDidValidate(t,this)}}willReconcile(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.traitWillReconcile&&n.traitWillReconcile(t,this)}}onReconcile(t){this.recohereDownlinks(t.updateTime)}didReconcile(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.traitDidReconcile&&n.traitDidReconcile(t,this)}}refreshChildren(t,e,i,n){const s=this.model;n.call(s,t,e,i)}hasFastener(t,e){const i=this.fasteners;if(null!==i){const n=i[t];if(void 0!==n&&(null==e||n instanceof e))return!0}return!1}getFastener(t,e){const i=this.fasteners;if(null!==i){const n=i[t];if(void 0!==n&&(null==e||n instanceof e))return n}return null}setFastener(t,e){var i;const n=this.fasteners,s=null!==n&&null!==(i=n[t])&&void 0!==i?i:null;s!==e&&(null!==s&&this.detachFastener(t,s),null!==e&&this.attachFastener(t,e))}attachFastener(t,e){let i=this.fasteners;null===i&&(i={},this.fasteners=i),this.willAttachFastener(t,e),i[t]=e,this.mounted&&e.mount(),this.onAttachFastener(t,e),this.didAttachFastener(t,e)}willAttachFastener(t,e){}onAttachFastener(t,e){this.bindFastener(e)}didAttachFastener(t,e){}detachFastener(t,e){const i=this.fasteners;this.willDetachFastener(t,e),this.onDetachFastener(t,e),this.mounted&&e.unmount(),delete i[t],this.didDetachFastener(t,e)}willDetachFastener(t,e){}onDetachFastener(t,e){}didDetachFastener(t,e){}getLazyFastener(t,e){return i.FastenerContext.getLazyFastener(this,t,e)}getSuperFastener(t,e){const i=this.model;if(null===i)return null;{const n=i.getLazyFastener(t,e);return null!==n?n:i.getSuperFastener(t,e)}}mountFasteners(){const t=this.fasteners;for(const e in t){t[e].mount()}i.FastenerContext.init(this)}unmountFasteners(){const t=this.fasteners;for(const e in t){t[e].unmount()}}bindFastener(t){(t instanceof b||t instanceof x)&&t.binds&&this.forEachChild((function(e){t.bindModel(e,null)}),this),t instanceof x&&t.binds&&this.forEachTrait((function(e){t.bindTrait(e,null)}),this),t instanceof n.DownlinkFastener&&!0===t.consumed&&this.consuming&&t.consume(this)}bindModelFasteners(t){const e=this.fasteners;t.forEachChild((function(t){for(const i in e){const n=e[i];this.bindChildFastener(n,t,null)}}),this),t.forEachTrait((function(t){for(const i in e){const n=e[i];this.bindTraitFastener(n,t,null)}}),this)}unbindModelFasteners(t){const e=this.fasteners;t.forEachTrait((function(t){for(const i in e){const n=e[i];this.unbindTraitFastener(n,t)}}),this),t.forEachChild((function(t){for(const i in e){const n=e[i];this.unbindChildFastener(n,t)}}),this)}bindChildFasteners(t,e){const i=this.fasteners;for(const n in i){const s=i[n];this.bindChildFastener(s,t,e)}}bindChildFastener(t,e,i){(t instanceof b||t instanceof x)&&t.bindModel(e,i)}unbindChildFasteners(t){const e=this.fasteners;for(const i in e){const n=e[i];this.unbindChildFastener(n,t)}}unbindChildFastener(t,e){(t instanceof b||t instanceof x)&&t.unbindModel(e)}bindTraitFasteners(t,e){const i=this.fasteners;for(const n in i){const s=i[n];this.bindTraitFastener(s,t,e)}}bindTraitFastener(t,e,i){t instanceof x&&t.bindTrait(e,i)}unbindTraitFasteners(t){const e=this.fasteners;for(const i in e){const n=e[i];this.unbindTraitFastener(n,t)}}unbindTraitFastener(t,e){t instanceof x&&t.unbindTrait(e)}decohereFastener(t){let e=this.decoherent;null===e&&(e=[],this.decoherent=e),e.push(t),t instanceof n.DownlinkFastener?this.requireUpdate(w.NeedsReconcile):this.requireUpdate(w.NeedsMutate)}recohereFasteners(t){const e=this.decoherent;if(null!==e){const i=e.length;if(0!==i){void 0===t&&(t=performance.now()),this.decoherent=null;for(let s=0;s<i;s+=1){const i=e[s];i instanceof n.DownlinkFastener?this.decohereFastener(i):i.recohere(t)}}}}recohereDownlinks(t){const e=this.decoherent;if(null!==e){const i=e.length;if(0!==i){this.decoherent=null;for(let s=0;s<i;s+=1){const i=e[s];i instanceof n.DownlinkFastener?i.recohere(t):this.decohereFastener(i)}}}}observe(t){const i=this.observers,n=e.Arrays.inserted(t,i);i!==n&&(this.willObserve(t),this.observers=n,this.onObserve(t),this.didObserve(t))}willObserve(t){}onObserve(t){}didObserve(t){}unobserve(t){const i=this.observers,n=e.Arrays.removed(t,i);i!==n&&(this.willUnobserve(t),this.observers=n,this.onUnobserve(t),this.didUnobserve(t))}willUnobserve(t){}onUnobserve(t){}didUnobserve(t){}forEachObserver(t){let e;const i=this.observers;for(let n=0,s=i.length;n<s;n+=1){const s=i[n];if(e=t.call(this,s),void 0!==e)return e}return e}callObservers(t,...e){const i=this.observers;for(let n=0,s=i.length;n<s;n+=1){const s=i[n],o=s[t];"function"==typeof o&&o.call(s,...e)}}consume(t){const i=this.consumers,n=e.Arrays.inserted(t,i);i!==n&&(this.willConsume(t),this.consumers=n,this.onConsume(t),this.didConsume(t),0===i.length&&this.mounted&&this.startConsuming())}willConsume(t){}onConsume(t){}didConsume(t){}unconsume(t){const i=this.consumers,n=e.Arrays.removed(t,i);i!==n&&(this.willUnconsume(t),this.consumers=n,this.onUnconsume(t),this.didUnconsume(t),0===n.length&&this.stopConsuming())}willUnconsume(t){}onUnconsume(t){}didUnconsume(t){}get consuming(){return 0!=(this.flags&A.ConsumingFlag)}get startConsumingFlags(){return this.constructor.StartConsumingFlags}startConsuming(){0==(this.flags&A.ConsumingFlag)&&(this.willStartConsuming(),this.setFlags(this.flags|A.ConsumingFlag),this.onStartConsuming(),this.didStartConsuming())}willStartConsuming(){const t=this.observers;for(let e=0,i=t.length;e<i;e+=1){const i=t[e];void 0!==i.traitWillStartConsuming&&i.traitWillStartConsuming(this)}}onStartConsuming(){this.requireUpdate(this.startConsumingFlags),this.startConsumingFasteners()}didStartConsuming(){const t=this.observers;for(let e=0,i=t.length;e<i;e+=1){const i=t[e];void 0!==i.traitDidStartConsuming&&i.traitDidStartConsuming(this)}}get stopConsumingFlags(){return this.constructor.StopConsumingFlags}stopConsuming(){0!=(this.flags&A.ConsumingFlag)&&(this.willStopConsuming(),this.setFlags(this.flags&~A.ConsumingFlag),this.onStopConsuming(),this.didStopConsuming())}willStopConsuming(){const t=this.observers;for(let e=0,i=t.length;e<i;e+=1){const i=t[e];void 0!==i.traitWillStopConsuming&&i.traitWillStopConsuming(this)}}onStopConsuming(){this.requireUpdate(this.stopConsumingFlags),this.stopConsumingFasteners()}didStopConsuming(){const t=this.observers;for(let e=0,i=t.length;e<i;e+=1){const i=t[e];void 0!==i.traitDidStopConsuming&&i.traitDidStopConsuming(this)}}startConsumingFasteners(){const t=this.fasteners;for(const e in t){const i=t[e];i instanceof n.DownlinkFastener&&!0===i.consumed&&i.consume(this)}}stopConsumingFasteners(){const t=this.fasteners;for(const e in t){const i=t[e];i instanceof n.DownlinkFastener&&!0===i.consumed&&i.unconsume(this)}}get modelContext(){const t=this.model;return null!==t?t.modelContext:null}equals(t){return this===t}hashCode(){return this.uid}init(t){}static create(){return new this}static fromInit(t){let i;i=("object"==typeof t&&null!==t||"function"==typeof t)&&e.Creatable.is(t.type)?t.type:this;const n=i.create();return n.init(t),n}static fromAny(t){if(null==t)return t;if(t instanceof A){if(t instanceof this)return t;throw new TypeError(t+" not an instance of "+this)}return e.Creatable.is(t)?t.create():this.fromInit(t)}}A.uid=function(){let t=1;return function(){const e=~~t;return t+=1,e}}(),A.MountedFlag=1,A.ConsumingFlag=2,A.FlagShift=2,A.FlagMask=(1<<A.FlagShift)-1,A.MountFlags=0,A.InsertChildFlags=0,A.RemoveChildFlags=0,A.InsertTraitFlags=0,A.RemoveTraitFlags=0,A.StartConsumingFlags=0,A.StopConsumingFlags=0,u([i.Provider({extends:n.WarpProvider,type:n.WarpService,observes:!1,service:n.WarpService.global()})],A.prototype,"warpProvider",void 0),u([i.Property({type:Object,inherits:!0,state:null,updateFlags:w.NeedsReconcile})],A.prototype,"warpRef",void 0);const x=function(t){const e=t.extend("TraitRelation");return Object.defineProperty(e.prototype,"familyType",{get:function(){return e},configurable:!0}),e.prototype.initTrait=function(t){},e.prototype.willAttachTrait=function(t,e){},e.prototype.onAttachTrait=function(t,e){!0===this.observes&&t.observe(this)},e.prototype.didAttachTrait=function(t,e){},e.prototype.deinitTrait=function(t){},e.prototype.willDetachTrait=function(t){},e.prototype.onDetachTrait=function(t){!0===this.observes&&t.unobserve(this)},e.prototype.didDetachTrait=function(t){},Object.defineProperty(e.prototype,"parentModel",{get(){const t=this.owner;return t instanceof w?t:t instanceof A?t.model:null},configurable:!0}),e.prototype.insertChild=function(t,e,i,n){t.insertTrait(e,i,n)},e.prototype.bindModel=function(t,e){},e.prototype.unbindModel=function(t){},e.prototype.detectModel=function(t){return null},e.prototype.bindTrait=function(t,e){},e.prototype.unbindTrait=function(t){},e.prototype.detectTrait=function(t){return null},e.prototype.createTrait=function(){const t=this.type;if(void 0!==t)return t.create();{let t="Unable to create ";throw 0!==this.name.length&&(t+=this.name+" "),t+="trait",new Error(t)}},e.prototype.fromAny=function(t){const e=this.type;return void 0!==e?e.fromAny(t):A.fromAny(t)},Object.defineProperty(e.prototype,"lazy",{get:function(){return!1},configurable:!0}),Object.defineProperty(e.prototype,"static",{get:function(){return!0},configurable:!0}),e.construct=function(e,i,n){return i=t.construct(e,i,n)},e.define=function(t,e){let i=e.extends;const n=e.affinity,s=e.inherits;delete e.extends,delete e.affinity,delete e.inherits,null==i&&(i=this);const o=i.extend(t,e);return o.construct=function(t,e,o){return e=i.construct(t,e,o),void 0!==n&&e.initAffinity(n),void 0!==s&&e.initInherits(s),e},o},e}(i.Fastener),D=function(t){const e=t.extend("TraitRef");return Object.defineProperty(e.prototype,"familyType",{get:function(){return e},configurable:!0}),e.prototype.onInherit=function(t){this.setTrait(t.trait)},e.prototype.getTrait=function(){const t=this.trait;if(null===t){let e=t+" ";throw 0!==this.name.length&&(e+=this.name+" "),e+="trait",new TypeError(e)}return t},e.prototype.setTrait=function(t,e,i){null!==t&&(t=this.fromAny(t));let n=this.trait;if(n!==t){let s;void 0===e&&(e=null),this.binds&&(s=this.parentModel,null!==s)&&(null!==n&&n.model===s&&(null===e&&(e=s.nextTrait(n)),n.remove()),null!==t&&(void 0===i&&(i=this.key),this.insertChild(s,t,e,i)),n=this.trait),n!==t&&(null!==n&&(this.willDetachTrait(n),this.trait=null,this.onDetachTrait(n),this.deinitTrait(n),this.didDetachTrait(n)),null!==t&&(this.willAttachTrait(t,e),this.trait=t,this.onAttachTrait(t,e),this.initTrait(t),this.didAttachTrait(t,e)))}return n},e.prototype.attachTrait=function(t,e){const i=this.trait;return(t=null!=t?this.fromAny(t):null===i?this.createTrait():i)!==i&&(void 0===e&&(e=null),null!==i&&(this.willDetachTrait(i),this.trait=null,this.onDetachTrait(i),this.deinitTrait(i),this.didDetachTrait(i)),this.willAttachTrait(t,e),this.trait=t,this.onAttachTrait(t,e),this.initTrait(t),this.didAttachTrait(t,e)),t},e.prototype.detachTrait=function(){const t=this.trait;return null!==t&&(this.willDetachTrait(t),this.trait=null,this.onDetachTrait(t),this.deinitTrait(t),this.didDetachTrait(t)),t},e.prototype.insertTrait=function(t,e,i,n){if(null!=e)e=this.fromAny(e);else{const t=this.trait;e=null===t?this.createTrait():t}null==t&&(t=this.parentModel),void 0===i&&(i=null),void 0===n&&(n=this.key),null===t||e.parent===t&&e.key===n||this.insertChild(t,e,i,n);const s=this.trait;return e!==s&&(null!==s&&(this.willDetachTrait(s),this.trait=null,this.onDetachTrait(s),this.deinitTrait(s),this.didDetachTrait(s),s.remove()),this.willAttachTrait(e,i),this.trait=e,this.onAttachTrait(e,i),this.initTrait(e),this.didAttachTrait(e,i)),e},e.prototype.removeTrait=function(){const t=this.trait;return null!==t&&t.remove(),t},e.prototype.deleteTrait=function(){const t=this.detachTrait();return null!==t&&t.remove(),t},e.prototype.bindModel=function(t,e){if(this.binds&&null===this.trait){const e=this.detectModel(t);null!==e&&(this.willAttachTrait(e,null),this.trait=e,this.onAttachTrait(e,null),this.initTrait(e),this.didAttachTrait(e,null))}},e.prototype.unbindModel=function(t){if(this.binds){const e=this.detectModel(t);null!==e&&this.trait===e&&(this.willDetachTrait(e),this.trait=null,this.onDetachTrait(e),this.deinitTrait(e),this.didDetachTrait(e))}},e.prototype.detectModel=function(t){return null},e.prototype.bindTrait=function(t,e){if(this.binds&&null===this.trait){const i=this.detectTrait(t);null!==i&&(this.willAttachTrait(i,e),this.trait=i,this.onAttachTrait(i,e),this.initTrait(i),this.didAttachTrait(i,e))}},e.prototype.unbindTrait=function(t){if(this.binds){const e=this.detectTrait(t);null!==e&&this.trait===e&&(this.willDetachTrait(e),this.trait=null,this.onDetachTrait(e),this.deinitTrait(e),this.didDetachTrait(e))}},e.prototype.detectTrait=function(t){const e=this.key;return void 0!==e&&e===t.key?t:null},e.construct=function(e,i,n){return null===i&&(delete(i=function(t,e,n){return void 0===t?i.trait:(i.setTrait(t,e,n),i.owner)}).name,Object.setPrototypeOf(i,e.prototype)),(i=t.construct(e,i,n)).trait=null,i},e.define=function(t,e){let i=e.extends;const n=e.affinity,s=e.inherits;delete e.extends,delete e.affinity,delete e.inherits,!0===e.key?Object.defineProperty(e,"key",{value:t,configurable:!0}):!1===e.key&&Object.defineProperty(e,"key",{value:void 0,configurable:!0}),null==i&&(i=this);const o=i.extend(t,e);return o.construct=function(t,e,o){return e=i.construct(t,e,o),void 0!==n&&e.initAffinity(n),void 0!==s&&e.initInherits(s),e},o},e}(x),T=function(t){const e=t.extend("TraitSet");return Object.defineProperty(e.prototype,"familyType",{get:function(){return e},configurable:!0}),e.prototype.hasTrait=function(t){return void 0!==this.traits[t.uid]},e.prototype.addTrait=function(t,e,i){let n;t=null!=t?this.fromAny(t):this.createTrait(),void 0===e&&(e=null),this.binds&&(n=this.parentModel,null!==n)&&(void 0===i&&(i=this.key(t)),this.insertChild(n,t,e,i));const s=this.traits;return void 0===s[t.uid]&&(this.willAttachTrait(t,e),s[t.uid]=t,this.traitCount+=1,this.onAttachTrait(t,e),this.initTrait(t),this.didAttachTrait(t,e)),t},e.prototype.attachTrait=function(t,e){t=null!=t?this.fromAny(t):this.createTrait();const i=this.traits;return void 0===i[t.uid]&&(void 0===e&&(e=null),this.willAttachTrait(t,e),i[t.uid]=t,this.traitCount+=1,this.onAttachTrait(t,e),this.initTrait(t),this.didAttachTrait(t,e)),t},e.prototype.detachTrait=function(t){const e=this.traits;return void 0!==e[t.uid]?(this.willDetachTrait(t),this.traitCount-=1,delete e[t.uid],this.onDetachTrait(t),this.deinitTrait(t),this.didDetachTrait(t),t):null},e.prototype.insertTrait=function(t,e,i,n){e=null!=e?this.fromAny(e):this.createTrait(),null==t&&(t=this.parentModel),void 0===i&&(i=null),void 0===n&&(n=this.key(e)),null===t||e.model===t&&e.key===n||this.insertChild(t,e,i,n);const s=this.traits;return void 0===s[e.uid]&&(this.willAttachTrait(e,i),s[e.uid]=e,this.traitCount+=1,this.onAttachTrait(e,i),this.initTrait(e),this.didAttachTrait(e,i)),e},e.prototype.removeTrait=function(t){return this.hasTrait(t)?(t.remove(),t):null},e.prototype.deleteTrait=function(t){const e=this.detachTrait(t);return null!==e&&e.remove(),e},e.prototype.bindModel=function(t,e){if(this.binds){const e=this.detectModel(t),i=this.traits;null!==e&&void 0===i[e.uid]&&(this.willAttachTrait(e,null),i[e.uid]=e,this.traitCount+=1,this.onAttachTrait(e,null),this.initTrait(e),this.didAttachTrait(e,null))}},e.prototype.unbindModel=function(t){if(this.binds){const e=this.detectModel(t),i=this.traits;null!==e&&void 0!==i[e.uid]&&(this.willDetachTrait(e),this.traitCount-=1,delete i[e.uid],this.onDetachTrait(e),this.deinitTrait(e),this.didDetachTrait(e))}},e.prototype.detectModel=function(t){return null},e.prototype.bindTrait=function(t,e){if(this.binds){const i=this.detectTrait(t),n=this.traits;null!==i&&void 0===n[i.uid]&&(this.willAttachTrait(i,e),n[i.uid]=i,this.traitCount+=1,this.onAttachTrait(i,e),this.initTrait(i),this.didAttachTrait(i,e))}},e.prototype.unbindTrait=function(t){if(this.binds){const e=this.detectTrait(t),i=this.traits;null!==e&&void 0!==i[e.uid]&&(this.willDetachTrait(e),this.traitCount-=1,delete i[e.uid],this.onDetachTrait(e),this.deinitTrait(e),this.didDetachTrait(e))}},e.prototype.detectTrait=function(t){return"function"==typeof this.type&&t instanceof this.type?t:null},e.prototype.key=function(t){},e.construct=function(e,i,n){return null===i&&(delete(i=function(t){return i.addTrait(t),i.owner}).name,Object.setPrototypeOf(i,e.prototype)),(i=t.construct(e,i,n)).traits={},i.traitCount=0,i},e.define=function(t,e){let i=e.extends;const n=e.affinity,s=e.inherits;delete e.extends,delete e.affinity,delete e.inherits,null==i&&(i=this);const o=i.extend(t,e);return o.construct=function(t,e,o){return e=i.construct(t,e,o),void 0!==n&&e.initAffinity(n),void 0!==s&&e.initInherits(s),e},o},e}(x);class P extends A{constructor(){super(),this.selected=!1}select(t){if(!this.selected&&(this.selected=!0,this.mounted)){const e=this.selectionProvider.service;null!=e&&e.select(this.model,t)}}willSelect(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.traitWillSelect&&n.traitWillSelect(t,this)}}onSelect(t){this.selected=!0}didSelect(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.traitDidSelect&&n.traitDidSelect(t,this)}}unselect(){if(this.selected&&(this.selected=!1,this.mounted)){const t=this.selectionProvider.service;null!=t&&t.unselect(this.model)}}willUnselect(){const t=this.observers;for(let e=0,i=t.length;e<i;e+=1){const i=t[e];void 0!==i.traitWillUnselect&&i.traitWillUnselect(this)}}onUnselect(){this.selected=!1}didUnselect(){const t=this.observers;for(let e=0,i=t.length;e<i;e+=1){const i=t[e];void 0!==i.traitDidUnselect&&i.traitDidUnselect(this)}}unselectAll(){const t=this.selectionProvider.service;null!=t&&t.unselectAll()}toggle(t){this.selected?this.unselect():this.select(t)}didMount(){if(this.selected){const t=this.selectionProvider.service;null!=t&&t.select(this.model)}super.didMount()}willUnmount(){super.willUnmount();const t=this.selectionProvider.service;null!=t&&t.unselect(this.model)}}u([i.Provider({extends:y,type:v,observes:!1,service:v.global()})],P.prototype,"selectionProvider",void 0);class V extends A{}u([D({type:A,observes:!0,didAttachTrait(t){t.consuming&&this.owner.consume(t)},willDetachTrait(t){t.consuming&&this.owner.unconsume(t)},traitDidStartConsuming(t){this.owner.consume(t)},traitWillStopConsuming(t){this.owner.unconsume(t)}})],V.prototype,"driver",void 0);class I extends V{downlinkDidSet(t,e){}}u([n.ValueDownlinkFastener({lazy:!1,consumed:!0,didSet(t,e){this.owner.consuming&&this.owner.downlinkDidSet(t,e)}})],I.prototype,"downlink",void 0);class M extends V{downlinkDidUpdate(t,e,i){}downlinkDidRemove(t,e){}}u([n.MapDownlinkFastener({lazy:!1,consumed:!0,didUpdate(t,e,i){this.owner.consuming&&this.owner.downlinkDidUpdate(t,e,i)},didRemove(t,e){this.owner.consuming&&this.owner.downlinkDidRemove(t,e)}})],M.prototype,"downlink",void 0);const R=function(){const t={fromAny:function(t){return"string"!=typeof t||"large"!==t&&"larger"!==t&&"medium"!==t&&"small"!==t&&"smaller"!==t&&"x-large"!==t&&"x-small"!==t&&"xx-large"!==t&&"xx-small"!==t?s.Length.fromAny(t):t},fromValue:function(e){const i=e.stringValue(null);if(null!==i)return t.fromAny(i);{const t=s.Length.form().cast(e);return void 0!==t?t:null}}};return t}(),F=function(){const t={fromAny:function(t){return"string"==typeof t&&"normal"===t?t:s.Length.fromAny(t)},fromValue:function(e){const i=e.stringValue(null);if(null!==i)return t.fromAny(i);{const t=s.Length.form().cast(e);return void 0!==t?t:null}}};return t}(),k=function(){const t={fromValue:function(t){let e=null;return t.forEach((function(t){if(t instanceof r.Value){const i=t.stringValue(void 0);void 0!==i&&(null===e?e=i:"string"==typeof e?e=[e,i]:e.push(i))}})),e},format:function(t){const i=t.length;let n;if(i>0){n=o.Unicode.isAlpha(t.charCodeAt(0));for(let s=e.Strings.offsetByCodePoints(t,0,1);n&&s<i;s=e.Strings.offsetByCodePoints(t,s,1)){const e=t.charCodeAt(s);n=o.Unicode.isAlpha(e)||45===e}}else n=!1;if(n)return t;{let n=o.Unicode.stringOutput();n=n.write(34);for(let s=0;s<i;s=e.Strings.offsetByCodePoints(t,s,1)){const e=t.charCodeAt(s);if(10===e||34===e||39===e)n=n.write(92).write(e);else if(e>=32)n=n.write(e);else{const t=o.Base16.uppercase;n=n.write(92).write(t.encodeDigit(e>>>20&15)).write(t.encodeDigit(e>>>16&15)).write(t.encodeDigit(e>>>12&15)).write(t.encodeDigit(e>>>8&15)).write(t.encodeDigit(e>>>4&15)).write(t.encodeDigit(15&e))}}return n=n.write(34),n.toString()}}};return t}();class O extends o.Parser{constructor(t,e,i,n){super(),this.output=t,this.quote=e,this.code=i,this.step=n}feed(t){return O.parse(t,this.output,this.quote,this.code,this.step)}static parse(t,e,i=0,n=0,s=1){let r=0;if(1===s){for(;t.isCont()&&(r=t.head(),o.Unicode.isSpace(r));)t=t.step();if(t.isCont())if(o.Unicode.isAlpha(r)||45===r)e=e||o.Unicode.stringOutput(),s=2;else{if(34!==r&&(39!==r||i!==r&&0!==i))return o.Parser.error(o.Diagnostic.expected("font family",t));t=t.step(),e=e||o.Unicode.stringOutput(),i=r,s=3}else if(t.isDone())return o.Parser.error(o.Diagnostic.expected("font family",t))}if(2===s){for(;t.isCont()&&(r=t.head(),o.Unicode.isAlpha(r)||45===r);)t=t.step(),e.write(r);if(!t.isEmpty())return o.Parser.done(e.bind())}t:for(;;){if(3===s){for(;t.isCont()&&(r=t.head(),r>=32&&r!==i&&92!==r);)t=t.step(),e.write(r);if(t.isCont()){if(r===i)return t=t.step(),o.Parser.done(e.bind());if(92!==r)return o.Parser.error(o.Diagnostic.expected(i,t));t=t.step(),s=4}else if(t.isDone())return o.Parser.error(o.Diagnostic.expected(i,t))}if(4===s)if(t.isCont()){if(r=t.head(),!o.Base16.isDigit(r)){if(10===r){t.step(),s=3;continue}t.step(),e.write(r),s=3;continue}s=5}else if(t.isDone())return o.Parser.error(o.Diagnostic.expected("escape character",t));if(s>=5)for(;;){if(t.isCont()&&(r=t.head(),o.Base16.isDigit(r))){if(t=t.step(),n=16*n+o.Base16.decodeDigit(r),s<=11){s+=1;continue}if(0===n)return o.Parser.error(o.Diagnostic.message("zero escape",t));e.write(n),n=0,s=3;continue t}if(!t.isEmpty())return o.Parser.error(o.Diagnostic.unexpected(t));break}break}return new O(e,i,n,s)}}class E{constructor(t,e,i,n,s,o,r){this.style=t,this.variant=e,this.weight=i,this.stretch=n,this.size=s,this.height=o,this.family=r,this.stringValue=void 0}withStyle(t){return t===this.style?this:new E(t,this.variant,this.weight,this.stretch,this.size,this.height,this.family)}withVariant(t){return t===this.variant?this:new E(this.style,t,this.weight,this.stretch,this.size,this.height,this.family)}withWeight(t){return t===this.weight?this:new E(this.style,this.variant,t,this.stretch,this.size,this.height,this.family)}withStretch(t){return t===this.stretch?this:new E(this.style,this.variant,this.weight,t,this.size,this.height,this.family)}withSize(t){return null!==t&&(t=R.fromAny(t)),e.Values.equal(t,this.size)?this:new E(this.style,this.variant,this.weight,this.stretch,t,this.height,this.family)}withHeight(t){return null!==t&&(t=F.fromAny(t)),e.Values.equal(t,this.height)?this:new E(this.style,this.variant,this.weight,this.stretch,this.size,t,this.family)}withFamily(t){return Array.isArray(t)&&1===t.length&&(t=t[0]),e.Values.equal(t,this.family)?this:new E(this.style,this.variant,this.weight,this.stretch,this.size,this.height,t)}toAny(){return{style:this.style,variant:this.variant,weight:this.weight,stretch:this.stretch,size:this.size,height:this.height,family:Array.isArray(this.family)?this.family.slice(0):this.family}}interpolateTo(t){return t instanceof E?W(this,t):null}equivalentTo(t,i){return this===t||t instanceof E&&(this.style===t.style&&this.variant===t.variant&&this.weight===t.weight&&this.stretch===t.stretch&&e.Values.equivalent(this.size,t.size,i)&&e.Values.equivalent(this.height,t.height,i)&&e.Values.equivalent(this.family,t.family,i))}equals(t){return this===t||t instanceof E&&(this.style===t.style&&this.variant===t.variant&&this.weight===t.weight&&this.stretch===t.stretch&&e.Values.equal(this.size,t.size)&&e.Values.equal(this.height,t.height)&&e.Values.equal(this.family,t.family))}debug(t){if(t=t.write("Font").write(46).write("family").write(40),"string"==typeof this.family)t=t.debug(this.family);else if(Array.isArray(this.family)&&0!==this.family.length){t=t.debug(this.family[0]);for(let e=1;e<this.family.length;e+=1)t=t.write(", ").debug(this.family[e])}return t=t.write(41),void 0!==this.style&&(t=t.write(46).write("style").write(40).debug(this.style).write(41)),void 0!==this.variant&&(t=t.write(46).write("variant").write(40).debug(this.variant).write(41)),void 0!==this.weight&&(t=t.write(46).write("weight").write(40).debug(this.weight).write(41)),void 0!==this.stretch&&(t=t.write(46).write("stretch").write(40).debug(this.stretch).write(41)),void 0!==this.size&&(t=t.write(46).write("size").write(40).debug(this.size).write(41)),void 0!==this.height&&(t=t.write(46).write("height").write(40).debug(this.height).write(41)),t}toString(){var t,e,i;let n=this.stringValue;if(void 0===n){if(n="",void 0===this.style&&"normal"!==this.variant&&"normal"!==this.weight&&"normal"!==this.stretch||(n+=null!==(t=this.style)&&void 0!==t?t:"normal"),void 0===this.variant&&"normal"!==this.weight&&"normal"!==this.stretch||(0!==n.length&&(n+=" "),n+=null!==(e=this.variant)&&void 0!==e?e:"normal"),void 0===this.weight&&"normal"!==this.stretch||(0!==n.length&&(n+=" "),n+=null!==(i=this.weight)&&void 0!==i?i:"normal"),void 0!==this.stretch&&(0!==n.length&&(n+=" "),n+=this.stretch),null!==this.size&&(0!==n.length&&(n+=" "),n+=this.size.toString(),null!==this.height&&(n+="/",n+=this.height.toString())),"string"==typeof this.family)0!==n.length&&(n+=" "),n+=k.format(this.family);else if(Array.isArray(this.family)&&0!==this.family.length){0!==n.length&&(n+=" "),n+=k.format(this.family[0]);for(let t=1;t<this.family.length;t+=1)n+=", ",n+=k.format(this.family[t])}this.stringValue=n}return n}static style(t,e){return Array.isArray(e)&&1===e.length&&(e=e[0]),new E(t,void 0,void 0,void 0,null,null,e)}static variant(t,e){return Array.isArray(e)&&1===e.length&&(e=e[0]),new E(void 0,t,void 0,void 0,null,null,e)}static weight(t,e){return Array.isArray(e)&&1===e.length&&(e=e[0]),new E(void 0,void 0,t,void 0,null,null,e)}static stretch(t,e){return Array.isArray(e)&&1===e.length&&(e=e[0]),new E(void 0,void 0,void 0,t,null,null,e)}static size(t,e){return t=null!==t?R.fromAny(t):null,Array.isArray(e)&&1===e.length&&(e=e[0]),new E(void 0,void 0,void 0,void 0,t,null,e)}static family(t){return Array.isArray(t)&&1===t.length&&(t=t[0]),new E(void 0,void 0,void 0,void 0,null,null,t)}static create(t,e,i,n,s,o,r){return s=null!=s?R.fromAny(s):null,o=null!=o?F.fromAny(o):null,Array.isArray(r)&&1===r.length&&(r=r[0]),new E(t,e,i,n,s,o,r)}static fromInit(t){return E.create(t.style,t.variant,t.weight,t.stretch,t.size,t.height,t.family)}static fromValue(t){const e=t.header("font");if(e.isDefined()){const t=e.get("style").stringValue(void 0),i=e.get("variant").stringValue(void 0),n=e.get("weight").stringValue(void 0),s=e.get("stretch").stringValue(void 0),o=R.fromValue(e.get("size")),r=F.fromValue(e.get("height")),l=k.fromValue(e.get("family"));if(null!==l)return E.create(t,i,n,s,o,r,l)}return null}static fromAny(t){if(null==t||t instanceof E)return t;if("object"==typeof t&&null!==t)return E.fromInit(t);if("string"==typeof t)return E.parse(t);throw new TypeError(""+t)}static parse(t){let e=o.Unicode.stringInput(t);for(;e.isCont()&&o.Unicode.isWhitespace(e.head());)e=e.step();let i=B.parse(e);if(i.isDone())for(;e.isCont()&&o.Unicode.isWhitespace(e.head());)e=e.step();return e.isCont()&&!i.isError()&&(i=o.Parser.error(o.Diagnostic.unexpected(e))),i.bind()}static isInit(t){if("object"==typeof t&&null!==t){return void 0!==t.family}return!1}static isAny(t){return t instanceof E||E.isInit(t)}static form(t){return new N(void 0)}}u([e.Lazy],E,"form",null);const W=function(t){const i=function(t,n){const s=function(t){const e=s.styleInterpolator(t),i=s.variantInterpolator(t),n=s.weightInterpolator(t),o=s.stretchInterpolator(t),r=s.sizeInterpolator(t),l=s.heightInterpolator(t),a=s.familyInterpolator(t);return new E(e,i,n,o,r,l,a)};return Object.setPrototypeOf(s,i.prototype),s.styleInterpolator=e.Interpolator(t.style,n.style),s.variantInterpolator=e.Interpolator(t.variant,n.variant),s.weightInterpolator=e.Interpolator(t.weight,n.weight),s.stretchInterpolator=e.Interpolator(t.stretch,n.stretch),s.sizeInterpolator=e.Interpolator(t.size,n.size),s.heightInterpolator=e.Interpolator(t.height,n.height),s.familyInterpolator=e.Interpolator(t.family,n.family),s};return i.prototype=Object.create(t.prototype),i.prototype.constructor=i,Object.defineProperty(i.prototype,0,{get(){const t=this.styleInterpolator[0],e=this.variantInterpolator[0],i=this.weightInterpolator[0],n=this.stretchInterpolator[0],s=this.sizeInterpolator[0],o=this.heightInterpolator[0],r=this.familyInterpolator[0];return new E(t,e,i,n,s,o,r)},configurable:!0}),Object.defineProperty(i.prototype,1,{get(){const t=this.styleInterpolator[1],e=this.variantInterpolator[1],i=this.weightInterpolator[1],n=this.stretchInterpolator[1],s=this.sizeInterpolator[1],o=this.heightInterpolator[1],r=this.familyInterpolator[1];return new E(t,e,i,n,s,o,r)},configurable:!0}),i.prototype.equals=function(t){return this===t||t instanceof i&&(this.styleInterpolator.equals(t.styleInterpolator)&&this.variantInterpolator.equals(t.variantInterpolator)&&this.weightInterpolator.equals(t.weightInterpolator)&&this.stretchInterpolator.equals(t.stretchInterpolator)&&this.sizeInterpolator.equals(t.sizeInterpolator)&&this.heightInterpolator.equals(t.heightInterpolator)&&this.familyInterpolator.equals(t.familyInterpolator))},i}(e.Interpolator);class N extends r.Form{constructor(t){super(),Object.defineProperty(this,"unit",{value:t,enumerable:!0})}withUnit(t){return t!==this.unit?new N(t):this}mold(t){t=E.fromAny(t);const e=r.Record.create(7);if(void 0!==t.style&&e.slot("style",t.style),void 0!==t.variant&&e.slot("variant",t.variant),void 0!==t.weight&&e.slot("weight",t.weight),void 0!==t.stretch&&e.slot("stretch",t.stretch),t.size instanceof s.Length?e.slot("size",s.Length.form().mold(t.size)):void 0!==t.size&&e.slot("size",t.size),t.height instanceof s.Length?e.slot("height",s.Length.form().mold(t.height)):void 0!==t.height&&e.slot("height",t.height),Array.isArray(t.family)){const i=r.Record.create(t.family.length);for(let e=0;e<t.family.length;e+=1)i.push(t.family[e]);e.slot("family",i)}else e.slot("family",t.family);return r.Record.of(r.Attr.of("font",e))}cast(t){const e=t.toValue();let i=null;try{if(i=E.fromValue(e),null===i){const t=e.stringValue();void 0!==t&&(i=E.parse(t))}}catch(t){}return null!==i?i:void 0}}class B extends o.Parser{constructor(t,e,i,n,s,o,r,l,a,h,d){super(),this.style=t,this.variant=e,this.weight=i,this.stretch=n,this.size=s,this.height=o,this.family=r,this.identOutput=l,this.lengthParser=a,this.familyParser=h,this.step=d}feed(t){return B.parse(t,this.style,this.variant,this.weight,this.stretch,this.size,this.height,this.family,this.identOutput,this.lengthParser,this.familyParser,this.step)}static parse(t,e,i,n,r,l,a,h,d,c,u,p=1){let f=0;for(;;){if(1===p){for(;t.isCont()&&(f=t.head(),o.Unicode.isSpace(f));)t.step();if(t.isCont())p=o.Unicode.isAlpha(f)?2:34===f||39===f?11:4;else if(!t.isEmpty())return o.Parser.error(o.Diagnostic.unexpected(t))}if(2===p){for(d=d||o.Unicode.stringOutput();t.isCont()&&(f=t.head(),o.Unicode.isAlpha(f)||45===f);)t=t.step(),d.write(f);if(!t.isEmpty()){const s=d.bind();switch(d=void 0,s){case"italic":case"oblique":if(void 0!==e)return o.Parser.error(o.Diagnostic.message("reapeated font style: "+s,t));e=s,p=3;break;case"small-caps":if(void 0!==i)return o.Parser.error(o.Diagnostic.message("reapeated font variant: "+s,t));i=s,p=3;break;case"bold":case"bolder":case"lighter":if(void 0!==n)return o.Parser.error(o.Diagnostic.message("reapeated font weight: "+s,t));n=s,p=3;break;case"ultra-condensed":case"extra-condensed":case"semi-condensed":case"condensed":case"expanded":case"semi-expanded":case"extra-expanded":case"ultra-expanded":if(void 0!==r)return o.Parser.error(o.Diagnostic.message("reapeated font stretch: "+s,t));r=s,p=3;break;case"normal":if(void 0===e)e=s;else if(void 0===i)i=s;else if(void 0===n)n=s;else{if(void 0!==r)return o.Parser.error(o.Diagnostic.message("reapeated font property: "+s,t));r=s}p=3;break;case"large":case"larger":case"medium":case"small":case"smaller":case"x-large":case"x-small":case"xx-large":case"xx-small":l=s,p=5;break;default:h=s,p=12}}}if(3===p){if(t.isCont()){if(f=t.head(),o.Unicode.isSpace(f)){t.step(),p=1;continue}return o.Parser.error(o.Diagnostic.expected("font property, size, or family",t))}if(!t.isEmpty())return o.Parser.error(o.Diagnostic.unexpected(t))}if(4===p)if((c=void 0===c?s.LengthParser.parse(t):c.feed(t)).isDone()){const e=c.bind();if(""===e.units){const i=e.value;switch(i){case 100:case 200:case 300:case 400:case 500:case 600:case 700:case 800:case 900:if(void 0!==n)return o.Parser.error(o.Diagnostic.message("reapeated font weight: "+i,t));n=String(i);break;default:return o.Parser.error(o.Diagnostic.message("unknown font property: "+i,t))}p=3;continue}l=e,c=void 0,p=5}else if(c.isError())return c.asError();if(5===p)if(t.isCont())if(f=t.head(),o.Unicode.isSpace(f))t.step(),p=6;else{if(47!==f)return o.Parser.error(o.Diagnostic.expected("font family",t));t.step(),p=7}else if(!t.isEmpty())return o.Parser.error(o.Diagnostic.unexpected(t));if(6===p){for(;t.isCont()&&(f=t.head(),o.Unicode.isSpace(f));)t.step();if(t.isCont())47===f?(t.step(),p=7):p=11;else if(!t.isEmpty())return o.Parser.error(o.Diagnostic.unexpected(t))}if(7===p){for(;t.isCont()&&(f=t.head(),o.Unicode.isSpace(f));)t.step();if(t.isCont())p=o.Unicode.isAlpha(f)?8:9;else if(!t.isEmpty())return o.Parser.error(o.Diagnostic.unexpected(t))}if(8===p){for(d=d||o.Unicode.stringOutput();t.isCont()&&(f=t.head(),o.Unicode.isAlpha(f));)t=t.step(),d.write(f);if(!t.isEmpty()){const e=d.bind();if(d=void 0,"normal"!==e)return o.Parser.error(o.Diagnostic.message("unknown line height: "+e,t));a=e,p=10}}if(9===p)if((c=void 0===c?s.LengthParser.parse(t):c.feed(t)).isDone())a=c.bind(),c=void 0,p=10;else if(c.isError())return c.asError();if(10===p)if(t.isCont()){if(f=t.head(),!o.Unicode.isSpace(f))return o.Parser.error(o.Diagnostic.expected("font family",t));t.step(),p=11}else if(!t.isEmpty())return o.Parser.error(o.Diagnostic.unexpected(t));if(11===p)if((u=void 0===u?O.parse(t):u.feed(t)).isDone())Array.isArray(h)?h.push(u.bind()):h=void 0!==h?[h,u.bind()]:u.bind(),u=void 0,p=12;else if(u.isError())return u.asError();if(12===p){for(;t.isCont()&&(f=t.head(),o.Unicode.isSpace(f));)t.step();if(t.isCont()&&44===f){t.step(),p=11;continue}if(!t.isEmpty())return o.Parser.done(E.create(e,i,n,r,l,a,h))}break}return new B(e,i,n,r,l,a,h,d,c,u,p)}static parseRest(t,e,i,n,s,o,r,l){const a=void 0!==l?12:void 0!==o?5:3;return B.parse(t,e,i,n,s,o,r,l,void 0,void 0,void 0,a)}}class z{contrast(t){return this.lightness<.67?this.lighter(t):this.darker(t)}interpolateTo(t){return t instanceof z?Y(this.rgb(),t.rgb()):null}static transparent(){return j.transparent()}static black(t){return j.black(t)}static white(t){return j.white(t)}static rgb(t,e,i,n){return new j(t,e,i,n)}static hsl(t,e,i,n){return"number"!=typeof t&&(t=s.Angle.fromAny(t).degValue()),new Z(t,e,i,n)}static forName(t){switch(t){case"transparent":return z.transparent();case"black":return z.black();case"white":return z.white();default:return null}}static fromInit(t){if(j.isInit(t))return j.fromInit(t);if(Z.isInit(t))return Z.fromInit(t);throw new TypeError(""+t)}static fromAny(t){if(null==t||t instanceof z)return t;if("string"==typeof t)return z.parse(t);if(j.isInit(t))return j.fromInit(t);if(Z.isInit(t))return Z.fromInit(t);throw new TypeError(""+t)}static fromValue(t){let e;return e=j.fromValue(t),void 0===e&&(e=Z.fromValue(t)),e}static parse(t){let e=o.Unicode.stringInput(t);for(;e.isCont()&&o.Unicode.isWhitespace(e.head());)e=e.step();let i=H.parse(e);if(i.isDone())for(;e.isCont()&&o.Unicode.isWhitespace(e.head());)e=e.step();return e.isCont()&&!i.isError()&&(i=o.Parser.error(o.Diagnostic.unexpected(e))),i.bind()}static isInit(t){return j.isInit(t)||Z.isInit(t)}static isAny(t){return t instanceof z||z.isInit(t)||"string"==typeof t}static form(){return new U(z.transparent())}}z.Darker=.7,z.Brighter=1/z.Darker,u([e.Lazy],z,"form",null);class U extends r.Form{constructor(t){super(),Object.defineProperty(this,"unit",{value:t,enumerable:!0})}withUnit(t){return t!==this.unit?new U(t):this}mold(t){return t=z.fromAny(t),r.Text.from(t.toString())}cast(t){const e=t.toValue();let i=null;try{if(i=z.fromValue(e),void 0===i){const t=e.stringValue(void 0);void 0!==t&&(i=z.parse(t))}}catch(t){}return null!==i?i:void 0}}class H extends o.Parser{constructor(t,e){super(),this.identOutput=t,this.step=e}feed(t){return H.parse(t,this.identOutput,this.step)}static parse(t,e,i=1){let n=0;if(1===i)if(t.isCont()){if(35===t.head())return X.parse(t);i=2}else if(t.isDone())return o.Parser.error(o.Diagnostic.unexpected(t));if(2===i){for(e=e||o.Unicode.stringOutput();t.isCont()&&(n=t.head(),o.Unicode.isAlpha(n));)t=t.step(),e.write(n);if(!t.isEmpty()){const i=e.bind();switch(i){case"rgb":case"rgba":return K.parseRest(t);case"hsl":case"hsla":return Q.parseRest(t);default:{const e=z.forName(i);return null!==e?o.Parser.done(e):o.Parser.error(o.Diagnostic.message("unknown color: "+i,t))}}}}return new H(e,i)}}class q{constructor(t,e){this.value=t,this.units=void 0!==e?e:""}scale(t){return"%"===this.units?this.value*t/100:this.value}}class G extends o.Parser{constructor(t,e){super(),this.valueParser=t,this.step=e}feed(t){return G.parse(t,this.valueParser,this.step)}static parse(t,e,i=1){if(1===i)if((e=void 0===e?o.Base10.parseNumber(t):e.feed(t)).isDone())i=2;else if(e.isError())return e.asError();if(2===i){if(t.isCont()&&37===t.head())return t=t.step(),o.Parser.done(new q(e.bind(),"%"));if(!t.isEmpty())return o.Parser.done(new q(e.bind()))}return new G(e,i)}}class j extends z{constructor(t,e,i,n=1){super(),this.r=t,this.g=e,this.b=i,this.a=n,this.stringValue=void 0}isDefined(){return isFinite(this.r)&&isFinite(this.g)&&isFinite(this.b)&&isFinite(this.a)}alpha(t){return void 0===t?this.a:this.a!==t?new j(this.r,this.g,this.b,t):this}get lightness(){const t=this.r/255,e=this.g/255,i=this.b/255,n=Math.min(t,e,i);return(Math.max(t,e,i)+n)/2}plus(t){return t=z.fromAny(t).rgb(),new j(this.r+t.r,this.g+t.g,this.b+t.b,this.a+t.a)}times(t){return new j(this.r*t,this.g*t,this.b*t,this.a*t)}combine(t,e=1){return t=z.fromAny(t).rgb(),new j(this.r+t.r*e,this.g+t.g*e,this.b+t.b*e,this.a+t.a*e)}lighter(t){return 1!==(t=void 0===t?z.Brighter:Math.pow(z.Brighter,t))?new j(this.r*t,this.g*t,this.b*t,this.a):this}darker(t){return 1!==(t=void 0===t?z.Darker:Math.pow(z.Darker,t))?new j(this.r*t,this.g*t,this.b*t,this.a):this}rgb(){return this}hsl(){const t=this.r/255,e=this.g/255,i=this.b/255,n=Math.min(t,e,i),s=Math.max(t,e,i);let o=NaN,r=s-n;const l=(s+n)/2;return 0!==r?(o=t===s?(e-i)/r+6*+(e<i):e===s?(i-t)/r+2:(t-e)/r+4,r/=l<.5?s+n:2-(s+n),o*=60):r=l>0&&l<1?0:o,new Z(o,r,l,this.a)}interpolateTo(t){return t instanceof j?Y(this,t):super.interpolateTo(t)}equivalentTo(t,i){return this===t||t instanceof z&&(t=t.rgb(),e.Numbers.equivalent(this.r,t.r,i)&&e.Numbers.equivalent(this.g,t.g,i)&&e.Numbers.equivalent(this.b,t.b,i)&&e.Numbers.equivalent(this.a,t.a,i))}equals(t){return this===t||t instanceof j&&(this.r===t.r&&this.g===t.g&&this.b===t.b&&this.a===t.a)}hashCode(){return e.Murmur3.mash(e.Murmur3.mix(e.Murmur3.mix(e.Murmur3.mix(e.Murmur3.mix(e.Constructors.hash(j),e.Numbers.hash(this.r)),e.Numbers.hash(this.g)),e.Numbers.hash(this.b)),e.Numbers.hash(this.a)))}debug(t){return t=t.write("Color").write(46).write("rgb").write(40).debug(this.r).write(", ").debug(this.g).write(", ").debug(this.b),1!==this.a&&(t=t.write(", ").debug(this.a)),t=t.write(41)}toHexString(){const t=Math.min(Math.max(0,Math.round(this.r||0)),255),e=Math.min(Math.max(0,Math.round(this.g||0)),255),i=Math.min(Math.max(0,Math.round(this.b||0)),255);let n="#";const s=o.Base16.lowercase.alphabet;return n+=s.charAt(t>>>4&15),n+=s.charAt(15&t),n+=s.charAt(e>>>4&15),n+=s.charAt(15&e),n+=s.charAt(i>>>4&15),n+=s.charAt(15&i),n}toString(){let t=this.stringValue;if(void 0===t){let e=this.a;e=isNaN(e)?1:Math.max(0,Math.min(this.a,1)),1===e?t=this.toHexString():(t=1===e?"rgb":"rgba",t+="(",t+=Math.max(0,Math.min(Math.round(this.r)||0,255)),t+=",",t+=Math.max(0,Math.min(Math.round(this.g)||0,255)),t+=",",t+=Math.max(0,Math.min(Math.round(this.b)||0,255)),1!==e&&(t+=",",t+=e),t+=")"),this.stringValue=t}return t}static transparent(){return new j(0,0,0,0)}static black(t=1){return new j(0,0,0,t)}static white(t=1){return new j(255,255,255,t)}static fromInit(t){return new j(t.r,t.g,t.b,t.a)}static fromAny(t){if(null==t||t instanceof j)return t;if("string"==typeof t)return j.parse(t);if(j.isInit(t))return j.fromInit(t);throw new TypeError(""+t)}static fromValue(t){const e=t.tag;let i,n,s,o,l;return"rgb"===e||"rgba"===e?(t=t.header(e),i=!0):i=!1,t.forEach((function(t,e){const a=t.key.stringValue();void 0!==a?"r"===a?n=t.toValue().numberValue(n):"g"===a?s=t.toValue().numberValue(s):"b"===a?o=t.toValue().numberValue(o):"a"===a&&(l=t.toValue().numberValue(l)):t instanceof r.Value&&i&&(0===e?n=t.numberValue(n):1===e?s=t.numberValue(s):2===e?o=t.numberValue(o):3===e&&(l=t.numberValue(l)))})),void 0!==n&&void 0!==s&&void 0!==o?new j(n,s,o,l):null}static parse(t){return z.parse(t).rgb()}static isInit(t){if("object"==typeof t&&null!==t){const e=t;return"number"==typeof e.r&&"number"==typeof e.g&&"number"==typeof e.b&&("number"==typeof e.a||void 0===e.a)}return!1}static isAny(t){return t instanceof j||j.isInit(t)||"string"==typeof t}}u([e.Lazy],j,"transparent",null);const Y=function(t){const e=function(t,i){const n=function(t){const e=n[0],i=n[1],s=e.r+t*(i.r-e.r),o=e.g+t*(i.g-e.g),r=e.b+t*(i.b-e.b),l=e.a+t*(i.a-e.a);return new j(s,o,r,l)};return Object.setPrototypeOf(n,e.prototype),n[0]=t,n[1]=i,n};return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e}(e.Interpolator);class X extends o.Parser{constructor(t,e){super(),this.value=t,this.step=e}feed(t){return X.parse(t,this.value,this.step)}static parse(t,e=0,i=1){let n=0;if(1===i)if(t.isCont()&&35===t.head())t=t.step(),i=2;else if(!t.isEmpty())return o.Parser.error(o.Diagnostic.expected("#",t));if(i>=2){for(;i<=9&&t.isCont()&&(n=t.head(),o.Base16.isDigit(n));)t=t.step(),e=e<<4|o.Base16.decodeDigit(n),i+=1;if(!t.isEmpty())return 5===i?o.Parser.done(new j(e>>8&15|e>>4&240,e>>4&15|240&e,e<<4&240|15&e)):6===i?o.Parser.done(new j(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|240&e,(e<<4&240|15&e)/255)):8===i?o.Parser.done(new j(e>>16&255,e>>8&255,255&e)):10===i?o.Parser.done(new j(e>>24&255,e>>16&255,e>>8&255,(255&e)/255)):o.Parser.error(o.Diagnostic.unexpected(t))}return new X(e,i)}}class K extends o.Parser{constructor(t,e,i,n,s){super(),this.rParser=t,this.gParser=e,this.bParser=i,this.aParser=n,this.step=s}feed(t){return K.parse(t,this.rParser,this.gParser,this.bParser,this.aParser,this.step)}static parse(t,e,i,n,s,r){let l=0;if(1===r)if(t.isCont()&&114===t.head())t=t.step(),r=2;else if(!t.isEmpty())return o.Parser.error(o.Diagnostic.expected("r",t));if(2===r)if(t.isCont()&&103===t.head())t=t.step(),r=3;else if(!t.isEmpty())return o.Parser.error(o.Diagnostic.expected("g",t));if(3===r)if(t.isCont()&&98===t.head())t=t.step(),r=4;else if(!t.isEmpty())return o.Parser.error(o.Diagnostic.expected("b",t));if(4===r&&(t.isCont()&&97===t.head()?(t=t.step(),r=5):t.isEmpty()||(r=5)),5===r){for(;t.isCont()&&(l=t.head(),o.Unicode.isSpace(l));)t=t.step();if(t.isCont()&&40===l)t=t.step(),r=6;else if(!t.isEmpty())return o.Parser.error(o.Diagnostic.expected("(",t))}if(6===r){if(void 0===e){for(;t.isCont()&&o.Unicode.isSpace(t.head());)t=t.step();t.isEmpty()||(e=G.parse(t))}else e=e.feed(t);if(void 0!==e)if(e.isDone())r=7;else if(e.isError())return e.asError()}if(7===r){for(;t.isCont()&&(l=t.head(),o.Unicode.isSpace(l));)t=t.step();if(t.isCont())44===l&&(t=t.step()),r=8;else if(t.isDone())return o.Parser.error(o.Diagnostic.unexpected(t))}if(8===r){if(void 0===i){for(;t.isCont()&&o.Unicode.isSpace(t.head());)t=t.step();t.isEmpty()||(i=G.parse(t))}else i=i.feed(t);if(void 0!==i)if(i.isDone())r=9;else if(i.isError())return i.asError()}if(9===r){for(;t.isCont()&&(l=t.head(),o.Unicode.isSpace(l));)t=t.step();if(t.isCont())44===l&&(t=t.step()),r=10;else if(t.isDone())return o.Parser.error(o.Diagnostic.unexpected(t))}if(10===r){if(void 0===n){for(;t.isCont()&&o.Unicode.isSpace(t.head());)t=t.step();t.isEmpty()||(n=G.parse(t))}else n=n.feed(t);if(void 0!==n)if(n.isDone())r=11;else if(n.isError())return n.asError()}if(11===r){for(;t.isCont()&&(l=t.head(),o.Unicode.isSpace(l));)t=t.step();if(t.isCont()){if(41===l)return t=t.step(),o.Parser.done(new j(e.bind().scale(255),i.bind().scale(255),n.bind().scale(255)));44!==l&&47!==l||(t=t.step()),r=12}else if(t.isDone())return o.Parser.error(o.Diagnostic.unexpected(t))}if(12===r){if(void 0===s){for(;t.isCont()&&o.Unicode.isSpace(t.head());)t=t.step();t.isEmpty()||(s=G.parse(t))}else s=s.feed(t);if(void 0!==s)if(s.isDone())r=13;else if(s.isError())return s.asError()}if(13===r){for(;t.isCont()&&(l=t.head(),o.Unicode.isSpace(l));)t=t.step();if(t.isCont()&&41===l)return t=t.step(),o.Parser.done(new j(e.bind().scale(255),i.bind().scale(255),n.bind().scale(255),s.bind().scale(1)));if(!t.isEmpty())return o.Parser.error(o.Diagnostic.expected(")",t))}return new K(e,i,n,s,r)}static parseRest(t){return K.parse(t,void 0,void 0,void 0,void 0,5)}}class Z extends z{constructor(t,e,i,n=1){super(),this.h=t,this.s=e,this.l=i,this.a=n,this.stringValue=void 0}isDefined(){return isFinite(this.h)&&isFinite(this.s)&&isFinite(this.l)&&isFinite(this.a)}alpha(t){return void 0===t?this.a:this.a!==t?new Z(this.h,this.s,this.l,t):this}get lightness(){return this.l}plus(t){return t=z.fromAny(t).hsl(),new Z(this.h+t.h,this.s+t.s,this.l+t.l,this.a+t.a)}times(t){return new Z(this.h*t,this.s*t,this.l*t,this.a*t)}combine(t,e=1){return t=z.fromAny(t).hsl(),new Z(this.h+t.h*e,this.s+t.s*e,this.l+t.l*e,this.a+t.a*e)}lighter(t){return 1!==(t=void 0===t?z.Brighter:Math.pow(z.Brighter,t))?new Z(this.h,this.s,this.l*t,this.a):this}darker(t){return 1!==(t=void 0===t?z.Darker:Math.pow(z.Darker,t))?new Z(this.h,this.s,this.l*t,this.a):this}static toRgb(t,e,i){return 255*(t<60?e+(i-e)*t/60:t<180?i:t<240?e+(i-e)*(240-t)/60:e)}rgb(){const t=this.h%360+360*+(this.h<0),e=isNaN(t)||isNaN(this.s)?0:this.s,i=this.l,n=i+(i<.5?i:1-i)*e,s=2*i-n;return new j(Z.toRgb(t>=240?t-240:t+120,s,n),Z.toRgb(t,s,n),Z.toRgb(t<120?t+240:t-120,s,n),this.a)}hsl(){return this}interpolateTo(t){return t instanceof Z?_(this,t):super.interpolateTo(t)}equivalentTo(t,i){return this===t||t instanceof z&&(t=t.hsl(),e.Numbers.equivalent(this.h,t.h,i)&&e.Numbers.equivalent(this.s,t.s,i)&&e.Numbers.equivalent(this.l,t.l,i)&&e.Numbers.equivalent(this.a,t.a,i))}equals(t){return this===t||t instanceof Z&&(this.h===t.h&&this.s===t.s&&this.l===t.l&&this.a===t.a)}hashCode(){return e.Murmur3.mash(e.Murmur3.mix(e.Murmur3.mix(e.Murmur3.mix(e.Murmur3.mix(e.Constructors.hash(Z),e.Numbers.hash(this.h)),e.Numbers.hash(this.s)),e.Numbers.hash(this.l)),e.Numbers.hash(this.a)))}debug(t){return t=t.write("Color").write(46).write("hsl").write(40).debug(this.h).write(", ").debug(this.s).write(", ").debug(this.l),1!==this.a&&(t=t.write(", ").debug(this.a)),t=t.write(41)}toHexString(){return this.rgb().toHexString()}toString(){let t=this.stringValue;if(void 0===t){let e=this.a;e=isNaN(e)?1:Math.max(0,Math.min(this.a,1)),t=1===e?"hsl":"hsla",t+="(",t+=Math.max(0,Math.min(Math.round(this.h)||0,360)),t+=",",t+=Math.max(0,Math.min(100*Math.round(this.s)||0,100))+"%",t+=",",t+=Math.max(0,Math.min(100*Math.round(this.l)||0,100))+"%",1!==e&&(t+=",",t+=e),t+=")",this.stringValue=t}return t}static transparent(){return new Z(0,0,0,0)}static black(t=1){return new Z(0,0,0,t)}static white(t=1){return new Z(0,1,1,t)}static fromInit(t){const e="number"==typeof t.h?t.h:s.Angle.fromAny(t.h).degValue();return new Z(e,t.s,t.l,t.a)}static fromAny(t){if(null==t||t instanceof Z)return t;if("string"==typeof t)return Z.parse(t);if(Z.isInit(t))return Z.fromInit(t);throw new TypeError(""+t)}static fromValue(t){const e=t.tag;let i,n,o,l,a;return"hsl"===e||"hsla"===e?(t=t.header(e),i=!0):i=!1,t.forEach((function(t,e){const h=t.key.stringValue();void 0!==h?"h"===h?n=t.toValue().cast(s.Angle.form(),n):"s"===h?o=t.toValue().numberValue(o):"l"===h?l=t.toValue().numberValue(l):"a"===h&&(a=t.toValue().numberValue(a)):t instanceof r.Value&&i&&(0===e?n=t.cast(s.Angle.form(),n):1===e?o=t.numberValue(o):2===e?l=t.numberValue(l):3===e&&(a=t.numberValue(a)))})),void 0!==n&&void 0!==o&&void 0!==l?new Z(n.degValue(),o,l,a):null}static parse(t){return z.parse(t).hsl()}static isInit(t){if("object"==typeof t&&null!==t){const e=t;return s.Angle.isAny(e.h)&&"number"==typeof e.s&&"number"==typeof e.l&&("number"==typeof e.a||void 0===e.a)}return!1}static isAny(t){return t instanceof Z||Z.isInit(t)||"string"==typeof t}}u([e.Lazy],Z,"transparent",null);const _=function(t){const e=function(t,i){const n=function(t){const e=n[0],i=n[1],s=e.h+t*(i.h-e.h),o=e.s+t*(i.s-e.s),r=e.l+t*(i.l-e.l),l=e.a+t*(i.a-e.a);return new Z(s,o,r,l)};return Object.setPrototypeOf(n,e.prototype),n[0]=t,n[1]=i,n};return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e}(e.Interpolator);class Q extends o.Parser{constructor(t,e,i,n,s){super(),this.hParser=t,this.sParser=e,this.lParser=i,this.aParser=n,this.step=s}feed(t){return Q.parse(t,this.hParser,this.sParser,this.lParser,this.aParser,this.step)}static parse(t,e,i,n,r,l){let a=0;if(1===l)if(t.isCont()&&104===t.head())t=t.step(),l=2;else if(!t.isEmpty())return o.Parser.error(o.Diagnostic.expected("h",t));if(2===l)if(t.isCont()&&115===t.head())t=t.step(),l=3;else if(!t.isEmpty())return o.Parser.error(o.Diagnostic.expected("s",t));if(3===l)if(t.isCont()&&108===t.head())t=t.step(),l=4;else if(!t.isEmpty())return o.Parser.error(o.Diagnostic.expected("l",t));if(4===l&&(t.isCont()&&97===t.head()?(t=t.step(),l=5):t.isEmpty()||(l=5)),5===l){for(;t.isCont()&&(a=t.head(),o.Unicode.isSpace(a));)t=t.step();if(t.isCont()&&40===a)t=t.step(),l=6;else if(!t.isEmpty())return o.Parser.error(o.Diagnostic.expected("(",t))}if(6===l){if(void 0===e){for(;t.isCont()&&o.Unicode.isSpace(t.head());)t=t.step();t.isEmpty()||(e=s.AngleParser.parse(t,"deg"))}else e=e.feed(t);if(void 0!==e)if(e.isDone())l=7;else if(e.isError())return e.asError()}if(7===l){for(;t.isCont()&&(a=t.head(),o.Unicode.isSpace(a));)t=t.step();if(t.isCont())44===a&&(t=t.step()),l=8;else if(t.isDone())return o.Parser.error(o.Diagnostic.unexpected(t))}if(8===l){if(void 0===i){for(;t.isCont()&&o.Unicode.isSpace(t.head());)t=t.step();t.isEmpty()||(i=G.parse(t))}else i=i.feed(t);if(void 0!==i)if(i.isDone()){if("%"!==i.bind().units)return o.Parser.error(o.Diagnostic.expected("%",t));l=9}else if(i.isError())return i.asError()}if(9===l){for(;t.isCont()&&(a=t.head(),o.Unicode.isSpace(a));)t=t.step();if(t.isCont())44===a&&(t=t.step()),l=10;else if(t.isDone())return o.Parser.error(o.Diagnostic.unexpected(t))}if(10===l){if(void 0===n){for(;t.isCont()&&o.Unicode.isSpace(t.head());)t=t.step();t.isCont()&&(n=G.parse(t))}else n=n.feed(t);if(void 0!==n)if(n.isDone()){if("%"!==n.bind().units)return o.Parser.error(o.Diagnostic.expected("%",t));l=11}else if(n.isError())return n.asError()}if(11===l){for(;t.isCont()&&(a=t.head(),o.Unicode.isSpace(a));)t=t.step();if(t.isCont()){if(41===a)return t=t.step(),o.Parser.done(new Z(e.bind().degValue(),i.bind().scale(1),n.bind().scale(1)));44!==a&&47!==a||(t=t.step()),l=12}else if(t.isDone())return o.Parser.error(o.Diagnostic.unexpected(t))}if(12===l){if(void 0===r){for(;t.isCont()&&o.Unicode.isSpace(t.head());)t=t.step();t.isEmpty()||(r=G.parse(t))}else r=r.feed(t);if(void 0!==r)if(r.isDone())l=13;else if(r.isError())return r.asError()}if(13===l){for(;t.isCont()&&(a=t.head(),o.Unicode.isSpace(a));)t=t.step();if(t.isCont()&&41===a)return t=t.step(),o.Parser.done(new Z(e.bind().degValue(),i.bind().scale(1),n.bind().scale(1),r.bind().scale(1)));if(!t.isEmpty())return o.Parser.error(o.Diagnostic.expected(")",t))}return new Q(e,i,n,r,l)}static parseRest(t){return Q.parse(t,void 0,void 0,void 0,void 0,5)}}class J{constructor(t,e,i){this.color=t,this.stop=e,this.hint=i}withColor(t){return t=z.fromAny(t),new J(t,this.stop,this.hint)}withStop(t){return null!==t&&(t=s.Length.fromAny(t,"%")),new J(this.color,t,this.hint)}withHint(t){return null!==t&&(t=s.Length.fromAny(t,"%")),new J(this.color,this.stop,t)}interpolateTo(t){return t instanceof J?$(this,t):null}equivalentTo(t,i){return this===t||t instanceof J&&(e.Equivalent(this.color,t.color,i)&&e.Equivalent(this.stop,t.stop,i)&&e.Equivalent(this.hint,t.hint,i))}equals(t){return this===t||t instanceof J&&(this.color.equals(t.color)&&e.Equals(this.stop,t.stop)&&e.Equals(this.hint,t.hint))}toString(){let t="";return null!==this.hint&&(t+=this.hint.toString(),t+=", "),t+=this.color.toString(),null!==this.stop&&(t+=" ",t+=this.stop.toString()),t}static create(t,e=null,i=null){return t=z.fromAny(t),null!==e&&(e=s.Length.fromAny(e,"%")),null!==i&&(i=s.Length.fromAny(i,"%")),new J(t,e,i)}static fromInit(t){const e=z.fromAny(t.color),i=void 0!==t.stop?s.Length.fromAny(t.stop,"%"):null,n=void 0!==t.hint?s.Length.fromAny(t.hint,"%"):null;return new J(e,i,n)}static fromTuple(t){const e=z.fromAny(t[0]),i=null!==t[1]?s.Length.fromAny(t[1],"%"):null;return new J(e,i,null)}static fromAny(t){if(null==t||t instanceof J)return t;if("string"==typeof t)return J.parse(t);if(J.isInit(t))return J.fromInit(t);if(J.isTuple(t))return J.fromTuple(t);throw new TypeError(""+t)}static parse(t){let e=o.Unicode.stringInput(t);for(;e.isCont()&&o.Unicode.isWhitespace(e.head());)e=e.step();let i=tt.parse(e);if(i.isDone())for(;e.isCont()&&o.Unicode.isWhitespace(e.head());)e=e.step();return e.isCont()&&!i.isError()&&(i=o.Parser.error(o.Diagnostic.unexpected(e))),i.bind()}static parseHint(t){let e=o.Unicode.stringInput(t);for(;e.isCont()&&o.Unicode.isWhitespace(e.head());)e=e.step();let i=tt.parseHint(e);if(i.isDone())for(;e.isCont()&&o.Unicode.isWhitespace(e.head());)e=e.step();return e.isCont()&&!i.isError()&&(i=o.Parser.error(o.Diagnostic.unexpected(e))),i.bind()}static parseList(t){let e=o.Unicode.stringInput(t);for(;e.isCont()&&o.Unicode.isWhitespace(e.head());)e=e.step();let i=et.parse(e);if(i.isDone())for(;e.isCont()&&o.Unicode.isWhitespace(e.head());)e=e.step();return e.isCont()&&!i.isError()&&(i=o.Parser.error(o.Diagnostic.unexpected(e))),i.bind()}static isInit(t){if("object"==typeof t&&null!==t){return void 0!==t.color}return!1}static isTuple(t){return Array.isArray(t)&&2===t.length&&z.isAny(t[0])&&(null===t[1]||s.Length.isAny(t[1]))}static isAny(t){return t instanceof J||J.isInit(t)||J.isTuple(t)||"string"==typeof t}}const $=function(t){const i=function(t,n){const s=function(t){const e=s.colorInterpolator(t),i=s.stopInterpolator(t),n=s.hintInterpolator(t);return new J(e,i,n)};return Object.setPrototypeOf(s,i.prototype),s.colorInterpolator=t.color.interpolateTo(n.color),s.stopInterpolator=e.Interpolator(t.stop,n.stop),s.hintInterpolator=e.Interpolator(t.hint,n.hint),s};return i.prototype=Object.create(t.prototype),i.prototype.constructor=i,Object.defineProperty(i.prototype,0,{get(){const t=this.colorInterpolator[0],e=this.stopInterpolator[0],i=this.hintInterpolator[0];return new J(t,e,i)},configurable:!0}),Object.defineProperty(i.prototype,1,{get(){const t=this.colorInterpolator[1],e=this.stopInterpolator[1],i=this.hintInterpolator[1];return new J(t,e,i)},configurable:!0}),i.prototype.equals=function(t){return this===t||t instanceof i&&(this.colorInterpolator.equals(t.colorInterpolator)&&this.stopInterpolator.equals(t.stopInterpolator)&&this.hintInterpolator.equals(t.hintInterpolator))},i}(e.Interpolator);class tt extends o.Parser{constructor(t,e,i,n){super(),this.colorParser=t,this.stopParser=e,this.hintParser=i,this.step=n}feed(t){return tt.parse(t,this.colorParser,this.stopParser,this.hintParser,this.step)}static parse(t,e,i,n,r=4){let l=0;if(1===r){for(;t.isCont()&&(l=t.head(),o.Unicode.isSpace(l));)t.step();if(t.isCont())r=45===l||46===l||l>=48&&l<=57?2:7;else if(!t.isEmpty())return o.Parser.error(o.Diagnostic.unexpected(t))}if(2===r&&void 0!==(n=void 0===n?s.LengthParser.parse(t):n.feed(t)))if(n.isDone())r=3;else if(n.isError())return n.asError();if(3===r){for(;t.isCont()&&(l=t.head(),o.Unicode.isSpace(l));)t.step();if(t.isCont())44===l?(t.step(),r=4):(i=n,n=void 0,r=7);else if(t.isDone())return o.Parser.error(o.Diagnostic.unexpected(t))}if(4===r){for(;t.isCont()&&(l=t.head(),o.Unicode.isSpace(l));)t.step();if(t.isCont())r=45===l||46===l||l>=48&&l<=57?5:7;else if(!t.isEmpty())return o.Parser.error(o.Diagnostic.unexpected(t))}if(5===r&&void 0!==(i=void 0===i?s.LengthParser.parse(t):i.feed(t)))if(i.isDone())r=6;else if(i.isError())return i.asError();if(6===r)if(t.isCont()){if(!o.Unicode.isSpace(t.head()))return o.Parser.error(o.Diagnostic.expected("color",t));t.step(),r=7}else if(t.isDone())return o.Parser.error(o.Diagnostic.unexpected(t));if(7===r&&void 0!==(e=void 0===e?H.parse(t):e.feed(t)))if(e.isDone()){if(void 0!==i){const t=void 0!==n?n.bind():null;return o.Parser.done(new J(e.bind(),i.bind(),t))}r=8}else if(e.isError())return e.asError();if(8===r)if(t.isCont()&&o.Unicode.isSpace(t.head()))t.step(),r=9;else if(!t.isEmpty()){const t=void 0!==n?n.bind():null;return o.Parser.done(new J(e.bind(),null,t))}if(9===r&&void 0!==(i=void 0===i?s.LengthParser.parse(t):i.feed(t))){if(i.isDone()){const t=void 0!==n?n.bind():null;return o.Parser.done(new J(e.bind(),i.bind(),t))}if(i.isError())return i.asError()}return new tt(e,i,n,r)}static parseHint(t){return tt.parse(t,void 0,void 0,void 0,1)}}class et extends o.Parser{constructor(t,e,i){super(),this.stops=t,this.stopParser=e,this.step=i}feed(t){return et.parse(t,void 0!==this.stops?this.stops.slice(0):void 0,this.stopParser,this.step)}static parse(t,e,i,n=1){let s=0;if(1===n){if(void 0===i){for(;t.isCont()&&(s=t.head(),o.Unicode.isSpace(s));)t.step();t.isEmpty()||(i=tt.parse(t))}else i=i.feed(t);if(void 0!==i)if(i.isDone())void 0===e&&(e=[]),e.push(i.bind()),i=void 0,n=2;else if(i.isError())return i.asError()}for(;;){if(2===n){for(;t.isCont()&&(s=t.head(),o.Unicode.isSpace(s));)t=t.step();if(!t.isCont()||44!==s)return o.Parser.done(e);t=t.step(),n=3}if(3===n){if(void 0===i){for(;t.isCont()&&o.Unicode.isSpace(t.head());)t.step();t.isEmpty()||(i=tt.parseHint(t))}else i=i.feed(t);if(void 0!==i){if(i.isDone()){e.push(i.bind()),i=void 0,n=2;continue}if(i.isError())return i.asError()}}break}return new et(e,i,n)}}class it{constructor(t,e){this.angle=t,this.stops=e,this.stringValue=void 0}withAngle(t){return(t instanceof s.Angle||"number"==typeof t)&&(t=s.Angle.fromAny(t,"deg")),new it(t,this.stops)}withStops(t){const e=t.length,i=new Array(e);for(let n=0;n<e;n+=1)i[n]=J.fromAny(t[n]);return new it(this.angle,i)}interpolateTo(t){return t instanceof it?nt(this,t):null}equivalentTo(t,i){return this===t||t instanceof it&&(e.Values.equivalent(this.angle,t.angle,i)&&e.Arrays.equivalent(this.stops,t.stops,i))}equals(t){return this===t||t instanceof it&&(e.Values.equal(this.angle,t.angle)&&e.Arrays.equal(this.stops,t.stops))}toString(){let t=this.stringValue;if(void 0===t){if(t="linear-gradient(",this.angle instanceof s.Angle)t+=this.angle.toString();else if(t+="to","string"==typeof this.angle)t+=" ",t+=this.angle;else for(let e=0,i=this.angle.length;e<i;e+=1)t+=" ",t+=this.angle[e];for(let e=0,i=this.stops.length;e<i;e+=1)t+=", ",t+=this.stops[e].toString();t+=")",this.stringValue=t}return t}static create(t,...e){(t instanceof s.Angle||"number"==typeof t)&&(t=s.Angle.fromAny(t,"deg"));const i=e.length,n=new Array(i);for(let t=0;t<i;t+=1){const i=e[t];n[t]="string"==typeof i?0===t?J.parse(i):J.parseHint(i):J.fromAny(e[t])}return new it(t,n)}static fromInit(t){let e=t.angle;(e instanceof s.Angle||"number"==typeof e)&&(e=s.Angle.fromAny(e,"deg"));const i=t.stops.length,n=new Array(i);for(let e=0;e<i;e+=1)n[e]=J.fromAny(t.stops[e]);return new it(e,n)}static fromAny(t){if(null==t||t instanceof it)return t;if("string"==typeof t)return it.parse(t);if("object"==typeof t&&null!==t)return it.fromInit(t);throw new TypeError(""+t)}static parse(t){let e=o.Unicode.stringInput(t);for(;e.isCont()&&o.Unicode.isWhitespace(e.head());)e=e.step();let i=ot.parse(e);if(i.isDone())for(;e.isCont()&&o.Unicode.isWhitespace(e.head());)e=e.step();return e.isCont()&&!i.isError()&&(i=o.Parser.error(o.Diagnostic.unexpected(e))),i.bind()}static parseAngle(t){let e=o.Unicode.stringInput(t);for(;e.isCont()&&o.Unicode.isWhitespace(e.head());)e=e.step();let i=st.parse(e);if(i.isDone())for(;e.isCont()&&o.Unicode.isWhitespace(e.head());)e=e.step();return e.isCont()&&!i.isError()&&(i=o.Parser.error(o.Diagnostic.unexpected(e))),i.bind()}static isInit(t){if("object"==typeof t&&null!==t){const e=t;return void 0!==e.angle&&void 0!==e.stops}return!1}static isAny(t){return t instanceof it||it.isInit(t)||"string"==typeof t}}const nt=function(t){const i=function(t,n){const s=function(t){const e=s.angleInterpolator(t),i=s.stopInterpolators,n=i.length,o=new Array(n);for(let e=0;e<n;e+=1)o[e]=i[e](t);return new it(e,o)};Object.setPrototypeOf(s,i.prototype),s.angleInterpolator=e.Interpolator(t.angle,n.angle);const o=t.stops,r=n.stops,l=Math.min(o.length,r.length),a=new Array(l);for(let t=0;t<l;t+=1)a[t]=o[t].interpolateTo(r[t]);return s.stopInterpolators=a,s};return i.prototype=Object.create(t.prototype),i.prototype.constructor=i,Object.defineProperty(i.prototype,0,{get(){const t=this.angleInterpolator[0],e=this.stopInterpolators,i=e.length,n=new Array(i);for(let t=0;t<i;t+=1)n[t]=e[t][0];return new it(t,n)},configurable:!0}),Object.defineProperty(i.prototype,1,{get(){const t=this.angleInterpolator[1],e=this.stopInterpolators,i=e.length,n=new Array(i);for(let t=0;t<i;t+=1)n[t]=e[t][1];return new it(t,n)},configurable:!0}),i.prototype.equals=function(t){if(this===t)return!0;if(t instanceof i&&this.angleInterpolator.equals(t.angleInterpolator)){const e=this.stopInterpolators.length;if(e===t.stopInterpolators.length){for(let i=0;i<e;i+=1)if(!this.stopInterpolators[i].equals(t.stopInterpolators[i]))return!1;return!0}}return!1},i}(e.Interpolator);class st extends o.Parser{constructor(t,e,i,n){super(),this.identOutput=t,this.angleParser=e,this.side=i,this.step=n}feed(t){return st.parse(t,this.identOutput,this.angleParser,this.side,this.step)}static parse(t,e,i,n,r=1){let l=0;if(1===r){for(;t.isCont()&&(l=t.head(),o.Unicode.isSpace(l));)t.step();if(t.isCont())r=45===l||46===l||l>=48&&l<=57?2:3;else if(!t.isEmpty())return o.Parser.error(o.Diagnostic.unexpected(t))}if(2===r&&void 0!==(i=void 0===i?s.AngleParser.parse(t,"deg"):i.feed(t))){if(i.isDone())return i;if(i.isError())return i.asError()}if(3===r){for(void 0===e&&(e=o.Unicode.stringOutput());t.isCont()&&(l=t.head(),o.Unicode.isAlpha(l));)t=t.step(),e.write(l);if(!t.isEmpty()){const i=e.bind();if("to"!==i)return o.Parser.error(o.Diagnostic.message("unexpected "+i,t));e=void 0,r=4}}if(4===r)if(t.isCont()){if(!o.Unicode.isSpace(t.head()))return o.Parser.error(o.Diagnostic.expected("side or corner",t));t.step(),r=5}else if(t.isDone())return o.Parser.error(o.Diagnostic.unexpected(t));if(5===r){for(void 0===e&&(e=o.Unicode.stringOutput());t.isCont()&&(l=t.head(),o.Unicode.isAlpha(l));)t=t.step(),e.write(l);if(!t.isEmpty()){const i=e.bind();switch(e=void 0,i){case"left":case"right":n=i,r=6;break;case"top":case"bottom":n=i,r=7;break;default:return o.Parser.error(o.Diagnostic.message("unknown side: "+i,t))}}}if(6===r){if(void 0===e){for(;t.isCont()&&(l=t.head(),o.Unicode.isSpace(l));)t=t.step();if(t.isCont()&&o.Unicode.isAlpha(l))e=o.Unicode.stringOutput();else if(!t.isEmpty())return o.Parser.done(n)}if(void 0!==e){for(;t.isCont()&&(l=t.head(),o.Unicode.isAlpha(l));)t=t.step(),e.write(l);if(!t.isEmpty()){const i=e.bind();switch(e=void 0,i){case"top":case"bottom":return o.Parser.done([n,i]);default:return o.Parser.error(o.Diagnostic.message("unknown side: "+i,t))}}}}if(7===r){if(void 0===e){for(;t.isCont()&&(l=t.head(),o.Unicode.isSpace(l));)t=t.step();if(t.isCont()&&o.Unicode.isAlpha(l))e=o.Unicode.stringOutput();else if(!t.isEmpty())return o.Parser.done(n)}if(void 0!==e){for(;t.isCont()&&(l=t.head(),o.Unicode.isAlpha(l));)t=t.step(),e.write(l);if(!t.isEmpty()){const i=e.bind();switch(e=void 0,i){case"left":case"right":return o.Parser.done([n,i]);default:return o.Parser.error(o.Diagnostic.message("unknown side: "+i,t))}}}}return new st(e,i,n,r)}}class ot extends o.Parser{constructor(t,e,i,n){super(),this.identOutput=t,this.angleParser=e,this.stopsParser=i,this.step=n}feed(t){return ot.parse(t,this.identOutput,this.angleParser,this.stopsParser,this.step)}static parse(t,e,i,n,s=1){let r=0;if(1===s){for(void 0===e&&(e=o.Unicode.stringOutput());t.isCont()&&(r=t.head(),o.Unicode.isAlpha(r)||45===r);)t=t.step(),e.write(r);if(!t.isEmpty()){const i=e.bind();if("linear-gradient"!==i)return o.Parser.error(o.Diagnostic.message("unexpected "+i,t));e=void 0,s=2}}if(2===s){for(;t.isCont()&&(r=t.head(),o.Unicode.isSpace(r));)t=t.step();if(t.isCont()&&40===r)t.step(),s=3;else if(!t.isEmpty())return o.Parser.error(o.Diagnostic.expected("(",t))}if(3===s&&void 0!==(i=void 0===i?st.parse(t):i.feed(t)))if(i.isDone())s=4;else if(i.isError())return i.asError();if(4===s){for(;t.isCont()&&(r=t.head(),o.Unicode.isSpace(r));)t=t.step();if(!t.isCont()||44!==r)return o.Parser.error(o.Diagnostic.expected("color stops",t));t=t.step(),s=5}if(5===s&&void 0!==(n=void 0===n?et.parse(t):n.feed(t)))if(n.isDone())s=6;else if(n.isError())return n.asError();if(6===s){for(;t.isCont()&&o.Unicode.isSpace(t.head());)t.step();if(t.isCont()&&41===t.head())return t.step(),o.Parser.done(new it(i.bind(),n.bind()));if(!t.isEmpty())return o.Parser.error(o.Diagnostic.expected(")",t))}return new ot(e,i,n,s)}static parseRest(t,e){return ot.parse(t,e,void 0,void 0,2)}}class rt{constructor(t,e,i,n,s,o,r){this.inset=t,this.offsetX=e,this.offsetY=i,this.blurRadius=n,this.spreadRadius=s,this.color=o,this.next=r,this.stringValue=void 0}withInset(t){return t===this.inset?this:new rt(t,this.offsetX,this.offsetY,this.blurRadius,this.spreadRadius,this.color,this.next)}withOffsetX(t){return(t=s.Length.fromAny(t)).equals(this.offsetX)?this:new rt(this.inset,t,this.offsetY,this.blurRadius,this.spreadRadius,this.color,this.next)}withOffsetY(t){return(t=s.Length.fromAny(t)).equals(this.offsetY)?this:new rt(this.inset,this.offsetX,t,this.blurRadius,this.spreadRadius,this.color,this.next)}withBlurRadius(t){return(t=s.Length.fromAny(t)).equals(this.blurRadius)?this:new rt(this.inset,this.offsetX,this.offsetY,t,this.spreadRadius,this.color,this.next)}withSpreadRadius(t){return(t=s.Length.fromAny(t)).equals(this.spreadRadius)?this:new rt(this.inset,this.offsetX,this.offsetY,this.blurRadius,t,this.color,this.next)}withColor(t){return(t=z.fromAny(t)).equals(this.color)?this:new rt(this.inset,this.offsetX,this.offsetY,this.blurRadius,this.spreadRadius,t,this.next)}and(t,e,i,n,s,o){let r;return r=null!==this.next?this.next.and.apply(this.next,arguments):rt.create.apply(rt,arguments),new rt(this.inset,this.offsetX,this.offsetY,this.blurRadius,this.spreadRadius,this.color,r)}interpolateTo(t){return t instanceof rt?lt(this,t):null}equivalentTo(t,i){return this===t||t instanceof rt&&(this.inset===t.inset&&this.offsetX.equivalentTo(t.offsetX,i)&&this.offsetY.equivalentTo(t.offsetY,i)&&this.blurRadius.equivalentTo(t.blurRadius,i)&&this.spreadRadius.equivalentTo(t.spreadRadius,i)&&this.color.equivalentTo(t.color,i)&&e.Equivalent(this.next,t.next,i))}equals(t){return this===t||t instanceof rt&&(this.inset===t.inset&&this.offsetX.equals(t.offsetX)&&this.offsetY.equals(t.offsetY)&&this.blurRadius.equals(t.blurRadius)&&this.spreadRadius.equals(t.spreadRadius)&&this.color.equals(t.color)&&e.Equals(this.next,t.next))}toString(){let t=this.stringValue;return void 0===t&&(t="",this.inset&&(t+="inset",t+=" "),t+=this.offsetX.toString(),t+=" ",t+=this.offsetY.toString(),t+=" ",t+=this.blurRadius.toString(),t+=" ",t+=this.spreadRadius.toString(),t+=" ",t+=this.color.toString(),null!==this.next&&(t+=", ",t+=this.next.toString()),this.stringValue=t),t}static create(t,e,i,n,o,r){if(1===arguments.length)return rt.fromAny(t);if("boolean"!=typeof t){if(3===arguments.length)r=z.fromAny(i),o=s.Length.zero(),n=s.Length.zero(),i=s.Length.fromAny(e),e=s.Length.fromAny(t);else if(4===arguments.length)r=z.fromAny(n),o=s.Length.zero(),n=s.Length.fromAny(i),i=s.Length.fromAny(e),e=s.Length.fromAny(t);else{if(5!==arguments.length)throw new Error(t+", "+e+", "+i+", "+n+", "+o+", "+r);r=z.fromAny(o),o=s.Length.fromAny(n),n=s.Length.fromAny(i),i=s.Length.fromAny(e),e=s.Length.fromAny(t)}t=!1}else if(4===arguments.length)r=z.fromAny(n),o=s.Length.zero(),n=s.Length.zero(),i=s.Length.fromAny(i),e=s.Length.fromAny(e);else if(5===arguments.length)r=z.fromAny(o),o=s.Length.zero(),n=s.Length.fromAny(n),i=s.Length.fromAny(i),e=s.Length.fromAny(e);else{if(6!==arguments.length)throw new Error(t+", "+e+", "+i+", "+n+", "+o+", "+r);r=z.fromAny(r),o=s.Length.fromAny(o),n=s.Length.fromAny(n),i=s.Length.fromAny(i),e=s.Length.fromAny(e)}return new rt(t,e,i,n,o,r,null)}static fromInit(t){const e=t.inset||!1,i=void 0!==t.offsetX?s.Length.fromAny(t.offsetX):s.Length.zero(),n=void 0!==t.offsetY?s.Length.fromAny(t.offsetY):s.Length.zero(),o=void 0!==t.blurRadius?s.Length.fromAny(t.blurRadius):s.Length.zero(),r=void 0!==t.spreadRadius?s.Length.fromAny(t.spreadRadius):s.Length.zero(),l=void 0!==t.color?z.fromAny(t.color):z.black();return new rt(e,i,n,o,r,l,null)}static fromArray(t){let e=rt.fromAny(t[0]);for(let i=1;i<t.length;i+=1)e=e.and(t[i]);return e}static fromAny(...t){let e;if(0===arguments.length)return null;if(e=1===arguments.length?t[0]:t,null==e||e instanceof rt)return e;if("string"==typeof e)return rt.parse(e);if("object"==typeof e&&null!==e&&void 0===e.length)return rt.fromInit(e);if("object"==typeof e&&null!==e&&e.length>0)return rt.fromArray(e);throw new TypeError(""+e)}static fromValue(t){let e=null;return t.forEach((function(t,i){const n=t.header("boxShadow");if(n.isDefined()){let t,i,o,l,a,h;n.forEach((function(e,n){const d=e.key.stringValue();void 0!==d?"inset"===d?t=e.toValue().booleanValue(t):"offsetX"===d?i=e.toValue().cast(s.Length.form(),i):"offsetY"===d?o=e.toValue().cast(s.Length.form(),o):"blurRadius"===d?l=e.toValue().cast(s.Length.form(),l):"spreadRadius"===d?a=e.toValue().cast(s.Length.form(),a):"color"===d&&(h=e.toValue().cast(z.form(),h)):e instanceof r.Value&&(0===n&&e instanceof r.Text&&"inset"===e.value?t=!0:0===n||1===n&&void 0!==t?i=e.cast(s.Length.form(),i):1===n||2===n&&void 0!==t?o=e.cast(s.Length.form(),o):2===n||3===n&&void 0!==t?(l=e.cast(s.Length.form(),l),void 0===l&&(h=e.cast(z.form(),h))):(3===n||4===n&&void 0===t)&&void 0===h?(a=e.cast(s.Length.form(),a),void 0===a&&(h=e.cast(z.form(),h))):(4===n||5===n&&void 0===t)&&void 0===h&&(h=e.cast(z.form(),h)))})),t=void 0!==t&&t,i=void 0!==i?i:s.Length.zero(),o=void 0!==o?o:s.Length.zero(),l=void 0!==l?l:s.Length.zero(),a=void 0!==a?a:s.Length.zero(),h=void 0!==h?h:z.black();const d=new rt(t||!1,i,o,l,a,h,null);e=null!==e?e.and(d):d}})),e}static parse(t){let e=o.Unicode.stringInput(t);for(;e.isCont()&&o.Unicode.isWhitespace(e.head());)e=e.step();let i=ht.parse(e);if(i.isDone())for(;e.isCont()&&o.Unicode.isWhitespace(e.head());)e=e.step();return e.isCont()&&!i.isError()&&(i=o.Parser.error(o.Diagnostic.unexpected(e))),i.bind()}static isInit(t){if("object"==typeof t&&null!==t){const e=t;return void 0!==e.offsetX&&void 0!==e.offsetY&&void 0!==e.color}return!1}static isArray(t){if(Array.isArray(t)){const e=t.length;if(0!==e){for(let i=0;i<e;i+=1)if(!rt.isAny(t))return!1;return!0}}return!1}static isAny(t){return t instanceof rt||rt.isArray(t)||rt.isInit(t)||"string"==typeof t}static form(){return new at(null)}}u([e.Lazy],rt,"form",null);const lt=function(t){const i=function(t,n){const s=function(t){const e=s.insetInterpolator(t),i=s.offsetXInterpolator(t),n=s.offsetYInterpolator(t),o=s.blurRadiusInterpolator(t),r=s.spreadRadiusInterpolator(t),l=s.colorInterpolator(t),a=s.nextInterpolator(t);return new rt(e,i,n,o,r,l,a)};return Object.setPrototypeOf(s,i.prototype),s.insetInterpolator=e.Interpolator(t.inset,n.inset),s.offsetXInterpolator=t.offsetX.interpolateTo(n.offsetX),s.offsetYInterpolator=t.offsetY.interpolateTo(n.offsetY),s.blurRadiusInterpolator=t.blurRadius.interpolateTo(n.blurRadius),s.spreadRadiusInterpolator=t.spreadRadius.interpolateTo(n.spreadRadius),s.colorInterpolator=t.color.interpolateTo(n.color),s.nextInterpolator=e.Interpolator(t.next,n.next),s};return i.prototype=Object.create(t.prototype),i.prototype.constructor=i,Object.defineProperty(i.prototype,0,{get(){const t=this.insetInterpolator[0],e=this.offsetXInterpolator[0],i=this.offsetYInterpolator[0],n=this.blurRadiusInterpolator[0],s=this.spreadRadiusInterpolator[0],o=this.colorInterpolator[0],r=this.nextInterpolator[0];return new rt(t,e,i,n,s,o,r)},configurable:!0}),Object.defineProperty(i.prototype,1,{get(){const t=this.insetInterpolator[1],e=this.offsetXInterpolator[1],i=this.offsetYInterpolator[1],n=this.blurRadiusInterpolator[1],s=this.spreadRadiusInterpolator[1],o=this.colorInterpolator[1],r=this.nextInterpolator[1];return new rt(t,e,i,n,s,o,r)},configurable:!0}),i.prototype.equals=function(t){return this===t||t instanceof i&&(this.insetInterpolator.equals(t.insetInterpolator)&&this.offsetXInterpolator.equals(t.offsetXInterpolator)&&this.offsetYInterpolator.equals(t.offsetYInterpolator)&&this.blurRadiusInterpolator.equals(t.blurRadiusInterpolator)&&this.spreadRadiusInterpolator.equals(t.spreadRadiusInterpolator)&&this.colorInterpolator.equals(t.colorInterpolator)&&this.nextInterpolator.equals(t.nextInterpolator))},i}(e.Interpolator);class at extends r.Form{constructor(t){super(),Object.defineProperty(this,"unit",{value:t,enumerable:!0})}withUnit(t){return t!==this.unit?new at(t):this}mold(t){let e=rt.fromAny(t);const i=r.Record.create();for(;;){const t=r.Record.create(5);if(e.inset&&t.push("inset"),t.push(s.Length.form().mold(e.offsetX)),t.push(s.Length.form().mold(e.offsetY)),t.push(s.Length.form().mold(e.blurRadius)),t.push(s.Length.form().mold(e.spreadRadius)),t.push(z.form().mold(e.color)),i.attr("boxShadow",t),null===e.next)break;e=e.next}return i}cast(t){const e=t.toValue();let i;try{if(i=rt.fromValue(e),void 0===i){const t=e.stringValue();void 0!==t&&(i=rt.parse(t))}}catch(t){}return i}}class ht extends o.Parser{constructor(t,e,i,n,s,o,r,l){super(),this.boxShadow=t,this.identOutput=e,this.offsetXParser=i,this.offsetYParser=n,this.blurRadiusParser=s,this.spreadRadiusParser=o,this.colorParser=r,this.step=l}feed(t){return ht.parse(t,this.boxShadow,this.identOutput,this.offsetXParser,this.offsetYParser,this.blurRadiusParser,this.spreadRadiusParser,this.colorParser,this.step)}static parse(t,e,i,n,r,l,a,h,d=1){let c=0;for(;;){if(1===d){for(;t.isCont()&&(c=t.head(),o.Unicode.isSpace(c));)t.step();if(t.isCont())d=o.Unicode.isAlpha(c)?2:4;else if(!t.isEmpty())return o.Parser.error(o.Diagnostic.unexpected(t))}if(2===d){for(i=i||o.Unicode.stringOutput();t.isCont()&&(c=t.head(),o.Unicode.isAlpha(c));)t=t.step(),i.write(c);if(!t.isEmpty()){const e=i.bind();switch(e){case"inset":d=3;break;case"none":return o.Parser.done(null);default:return o.Parser.error(o.Diagnostic.message("unknown box-shadow: "+e,t))}}}if(3===d)if(t.isCont()){if(!o.Unicode.isSpace(t.head()))return o.Parser.error(o.Diagnostic.expected("space",t));t.step(),d=4}else if(t.isDone())return o.Parser.error(o.Diagnostic.unexpected(t));if(4===d){if(void 0===n){for(;t.isCont()&&o.Unicode.isSpace(t.head());)t.step();t.isEmpty()||(n=s.LengthParser.parse(t))}else n=n.feed(t);if(void 0!==n)if(n.isDone())d=5;else if(n.isError())return n.asError()}if(5===d)if(t.isCont()){if(!o.Unicode.isSpace(t.head()))return o.Parser.error(o.Diagnostic.expected("space",t));t.step(),d=6}else if(!t.isEmpty())return o.Parser.error(o.Diagnostic.unexpected(t));if(6===d){if(void 0===r){for(;t.isCont()&&o.Unicode.isSpace(t.head());)t.step();t.isEmpty()||(r=s.LengthParser.parse(t))}else r=r.feed(t);if(void 0!==r)if(r.isDone())d=7;else if(r.isError())return r.asError()}if(7===d)if(t.isCont()){if(!o.Unicode.isSpace(t.head()))return o.Parser.error(o.Diagnostic.expected("space",t));t.step(),d=8}else if(!t.isEmpty())return o.Parser.error(o.Diagnostic.unexpected(t));if(8===d){if(void 0===l){for(;t.isCont()&&(c=t.head(),o.Unicode.isSpace(c));)t.step();t.isCont()&&(45===c||c>=48&&c<=57)?l=s.LengthParser.parse(t):t.isEmpty()||(d=12)}else l=l.feed(t);if(void 0!==l)if(l.isDone())d=9;else if(l.isError())return l.asError()}if(9===d)if(t.isCont()){if(!o.Unicode.isSpace(t.head()))return o.Parser.error(o.Diagnostic.expected("space",t));t.step(),d=10}else if(!t.isEmpty())return o.Parser.error(o.Diagnostic.unexpected(t));if(10===d){if(void 0===a){for(;t.isCont()&&(c=t.head(),o.Unicode.isSpace(c));)t.step();t.isCont()&&(45===c||c>=48&&c<=57)?a=s.LengthParser.parse(t):t.isEmpty()||(d=12)}else a=a.feed(t);if(void 0!==a)if(a.isDone())d=11;else if(a.isError())return a.asError()}if(11===d)if(t.isCont()){if(!o.Unicode.isSpace(t.head()))return o.Parser.error(o.Diagnostic.expected("space",t));t.step(),d=12}else if(!t.isEmpty())return o.Parser.error(o.Diagnostic.unexpected(t));if(12===d){if(void 0===h){for(;t.isCont()&&o.Unicode.isSpace(t.head());)t.step();t.isEmpty()||(h=H.parse(t))}else h=h.feed(t);if(void 0!==h)if(h.isDone()){const t=void 0!==i&&"inset"===i.bind(),o=n.bind(),c=r.bind(),u=void 0!==l?l.bind():s.Length.zero(),p=void 0!==a?a.bind():s.Length.zero(),f=h.bind(),g=new rt(t,o,c,u,p,f,null);e=void 0===e?g:e.and(g),i=void 0,n=void 0,r=void 0,l=void 0,a=void 0,h=void 0,d=13}else if(h.isError())return h.asError()}if(13===d){for(;t.isCont()&&(c=t.head(),o.Unicode.isSpace(c));)t.step();if(t.isCont()&&44===c){t.step(),d=1;continue}if(!t.isEmpty())return o.Parser.done(e)}break}return new ht(e,i,n,r,l,a,h,d)}}const dt=function(t){const e=function(t,i){const n=function(t){const e=n[0],i=n[1],s=e.phase+t*(i.phase-e.phase),o=1!==t?e.direction:0;return ct.create(s,o)};return Object.setPrototypeOf(n,e.prototype),n[0]=t,n[1]=i,n};return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e}(e.Interpolator);class ct{constructor(t,e){this.phase=t,this.direction=e}withPhase(t){return t!==this.phase?ct.create(t,this.direction):this}withDirection(t){return t!==this.direction?ct.create(this.phase,t):this}get unfocused(){return 0===this.phase&&0===this.direction}get focused(){return 1===this.phase&&0===this.direction}get focusing(){return this.direction>0}get unfocusing(){return this.direction<0}asFocusing(){return this.focusing?this:ct.focusing(this.phase)}asUnfocusing(){return this.unfocusing?this:ct.unfocusing(this.phase)}asToggling(){return this.direction>0||this.phase>=.5?ct.unfocusing(this.phase):this.direction<0||this.phase<.5?ct.focusing(this.phase):this}asToggled(){return this.direction>0||this.phase>=.5?ct.unfocused():this.direction<0||this.phase<.5?ct.focused():this}interpolateTo(t){return t instanceof ct?dt(this,t):null}equivalentTo(t,i){return this===t||t instanceof ct&&(e.Numbers.equivalent(this.phase,t.phase,i)&&e.Numbers.equivalent(this.direction,t.direction,i))}equals(t){return this===t||t instanceof ct&&(this.phase===t.phase&&this.direction===t.direction)}hashCode(){return e.Murmur3.mash(e.Murmur3.mix(e.Murmur3.mix(e.Constructors.hash(ct),e.Numbers.hash(this.phase)),e.Numbers.hash(this.direction)))}debug(t){return t=t.write("Focus").write(46),0===this.phase&&0===this.direction?t=t.write("unfocused").write(40):1===this.phase&&0===this.direction?t=t.write("focused").write(40):1===this.direction?(t=t.write("focusing").write(40),0!==this.phase&&(t=t.debug(this.phase))):-1===this.direction?(t=t.write("unfocusing").write(40),1!==this.phase&&(t=t.debug(this.phase))):(t=t.write("create").write(40).debug(this.phase),0!==this.direction&&(t=t.write(", ").debug(this.direction))),t=t.write(41)}toString(){return o.Format.debug(this)}static unfocused(){return new ct(0,0)}static focused(){return new ct(1,0)}static focusing(t){return void 0===t&&(t=0),new ct(t,1)}static unfocusing(t){return void 0===t&&(t=1),new ct(t,-1)}static create(t,e){return void 0===e&&(e=0),0===t&&0===e?ct.unfocused():1===t&&0===e?ct.focused():new ct(t,e)}static fromInit(t){return new ct(t.phase,t.direction)}static fromAny(t){if(null==t||t instanceof ct)return t;if(ct.isInit(t))return ct.fromInit(t);throw new TypeError(""+t)}static isInit(t){if("object"==typeof t&&null!==t){const e=t;return"number"==typeof e.phase&&"number"==typeof e.direction}return!1}static isAny(t){return t instanceof ct||ct.isInit(t)}}u([e.Lazy],ct,"unfocused",null),u([e.Lazy],ct,"focused",null);const ut=function(t){const e=function(t,i){const n=function(t){const e=n[0],i=n[1],s=e.phase+t*(i.phase-e.phase),o=1!==t?e.direction:0;return pt.create(s,o)};return Object.setPrototypeOf(n,e.prototype),n[0]=t,n[1]=i,n};return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e}(e.Interpolator);class pt{constructor(t,e){this.phase=t,this.direction=e}withPhase(t){return t!==this.phase?pt.create(t,this.direction):this}withDirection(t){return t!==this.direction?pt.create(this.phase,t):this}get modalState(){return 0===this.phase&&0===this.direction?"hidden":1===this.phase&&0===this.direction?"shown":this.direction>0?"showing":this.direction<0?"hiding":void 0}get dismissed(){return 0===this.phase&&0===this.direction}get presented(){return 1===this.phase&&0===this.direction}get presenting(){return this.direction>0}get dismissing(){return this.direction<0}asPresenting(){return this.presenting?this:pt.presenting(this.phase)}asDismissing(){return this.dismissing?this:pt.dismissing(this.phase)}asToggling(){return this.direction>0||this.phase>=.5?pt.dismissing(this.phase):this.direction<0||this.phase<.5?pt.presenting(this.phase):this}asToggled(){return this.direction>0||this.phase>=.5?pt.dismissed():this.direction<0||this.phase<.5?pt.presented():this}interpolateTo(t){return t instanceof pt?ut(this,t):null}equivalentTo(t,i){return this===t||t instanceof pt&&(e.Numbers.equivalent(this.phase,t.phase,i)&&e.Numbers.equivalent(this.direction,t.direction,i))}equals(t){return this===t||t instanceof pt&&(this.phase===t.phase&&this.direction===t.direction)}hashCode(){return e.Murmur3.mash(e.Murmur3.mix(e.Murmur3.mix(e.Constructors.hash(pt),e.Numbers.hash(this.phase)),e.Numbers.hash(this.direction)))}debug(t){return t=t.write("Presence").write(46),0===this.phase&&0===this.direction?t=t.write("dismissed").write(40):1===this.phase&&0===this.direction?t=t.write("presented").write(40):1===this.direction?(t=t.write("presenting").write(40),0!==this.phase&&(t=t.debug(this.phase))):-1===this.direction?(t=t.write("dismissing").write(40),1!==this.phase&&(t=t.debug(this.phase))):(t=t.write("create").write(40).debug(this.phase),0!==this.direction&&(t=t.write(", ").debug(this.direction))),t=t.write(41)}toString(){return o.Format.debug(this)}static dismissed(){return new pt(0,0)}static presented(){return new pt(1,0)}static presenting(t){return void 0===t&&(t=0),new pt(t,1)}static dismissing(t){return void 0===t&&(t=1),new pt(t,-1)}static create(t,e){return void 0===e&&(e=0),0===t&&0===e?pt.dismissed():1===t&&0===e?pt.presented():new pt(t,e)}static fromInit(t){return new pt(t.phase,t.direction)}static fromAny(t){if(null==t||t instanceof pt)return t;if(pt.isInit(t))return pt.fromInit(t);throw new TypeError(""+t)}static isInit(t){if("object"==typeof t&&null!==t){const e=t;return"number"==typeof e.phase&&"number"==typeof e.direction}return!1}static isAny(t){return t instanceof pt||pt.isInit(t)}}u([e.Lazy],pt,"dismissed",null),u([e.Lazy],pt,"presented",null);const ft=function(t){const e=function(t,i){const n=function(t){const e=n[0],i=n[1],s=e.phase+t*(i.phase-e.phase),o=1!==t?e.direction:0;return gt.create(s,o)};return Object.setPrototypeOf(n,e.prototype),n[0]=t,n[1]=i,n};return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e}(e.Interpolator);class gt{constructor(t,e){this.phase=t,this.direction=e}withPhase(t){return t!==this.phase?gt.create(t,this.direction):this}withDirection(t){return t!==this.direction?gt.create(this.phase,t):this}get modalState(){return 0===this.phase&&0===this.direction?"hidden":1===this.phase&&0===this.direction?"shown":this.direction>0?"showing":this.direction<0?"hiding":void 0}get collapsed(){return 0===this.phase&&0===this.direction}get expanded(){return 1===this.phase&&0===this.direction}get expanding(){return this.direction>0}get collapsing(){return this.direction<0}asExpanding(){return this.expanding?this:gt.expanding(this.phase)}asCollapsing(){return this.collapsing?this:gt.collapsing(this.phase)}asToggling(){return this.direction>0||this.phase>=.5?gt.collapsing(this.phase):this.direction<0||this.phase<.5?gt.expanding(this.phase):this}asToggled(){return this.direction>0||this.phase>=.5?gt.collapsed():this.direction<0||this.phase<.5?gt.expanded():this}interpolateTo(t){return t instanceof gt?ft(this,t):null}equivalentTo(t,i){return this===t||t instanceof gt&&(e.Numbers.equivalent(this.phase,t.phase,i)&&e.Numbers.equivalent(this.direction,t.direction,i))}equals(t){return this===t||t instanceof gt&&(this.phase===t.phase&&this.direction===t.direction)}hashCode(){return e.Murmur3.mash(e.Murmur3.mix(e.Murmur3.mix(e.Constructors.hash(gt),e.Numbers.hash(this.phase)),e.Numbers.hash(this.direction)))}debug(t){return t=t.write("Expansion").write(46),0===this.phase&&0===this.direction?t=t.write("collapsed").write(40):1===this.phase&&0===this.direction?t=t.write("expanded").write(40):1===this.direction?(t=t.write("expanding").write(40),0!==this.phase&&(t=t.debug(this.phase))):-1===this.direction?(t=t.write("collapsing").write(40),1!==this.phase&&(t=t.debug(this.phase))):(t=t.write("create").write(40).debug(this.phase),0!==this.direction&&(t=t.write(", ").debug(this.direction))),t=t.write(41)}toString(){return o.Format.debug(this)}static collapsed(){return new gt(0,0)}static expanded(){return new gt(1,0)}static expanding(t){return void 0===t&&(t=0),new gt(t,1)}static collapsing(t){return void 0===t&&(t=1),new gt(t,-1)}static create(t,e){return void 0===e&&(e=0),0===t&&0===e?gt.collapsed():1===t&&0===e?gt.expanded():new gt(t,e)}static fromInit(t){return new gt(t.phase,t.direction)}static fromAny(t){if(null==t||t instanceof gt)return t;if(gt.isInit(t))return gt.fromInit(t);throw new TypeError(""+t)}static isInit(t){if("object"==typeof t&&null!==t){const e=t;return"number"==typeof e.phase&&"number"==typeof e.direction}return!1}static isAny(t){return t instanceof gt||gt.isInit(t)}}u([e.Lazy],gt,"collapsed",null),u([e.Lazy],gt,"expanded",null);const vt=function(){const t={fromAny:function(i){if(i instanceof l.DateTime||i instanceof s.Angle||i instanceof s.Length||i instanceof z||i instanceof E||i instanceof rt||i instanceof it||i instanceof s.Transform||i instanceof e.Interpolator||"number"==typeof i||"boolean"==typeof i)return i;if(i instanceof Date||l.DateTime.isInit(i))return l.DateTime.fromAny(i);if(E.isInit(i))return E.fromAny(i);if(z.isInit(i))return z.fromAny(i);if(rt.isInit(i))return rt.fromAny(i);if("string"==typeof i)return t.parse(i);throw new TypeError(""+i)},parse:function(t){for("string"==typeof t&&(t=o.Unicode.stringInput(t));t.isCont()&&o.Unicode.isWhitespace(t.head());)t=t.step();let e=wt.parse(t);if(e.isDone())for(;t.isCont()&&o.Unicode.isWhitespace(t.head());)t=t.step();return t.isCont()&&!e.isError()&&(e=o.Parser.error(o.Diagnostic.unexpected(t))),e.bind()}};return Object.defineProperty(t,"form",{value:function(){const e=new yt(void 0);return Object.defineProperty(t,"form",{value:function(){return e},enumerable:!0,configurable:!0}),e},enumerable:!0,configurable:!0}),t}();class yt extends r.Form{constructor(t){super(),Object.defineProperty(this,"unit",{value:t,enumerable:!0})}withUnit(t){return t!==this.unit?new yt(t):this}mold(t){if(void 0!==t){if((t=vt.fromAny(t))instanceof l.DateTime)return l.DateTime.form().mold(t);if(t instanceof s.Angle)return s.Angle.form().mold(t);if(t instanceof s.Length)return s.Length.form().mold(t);if(t instanceof E)return E.form().mold(t);if(t instanceof z)return z.form().mold(t);if(t instanceof rt)return rt.form().mold(t);if(t instanceof s.Transform)return s.Transform.form().mold(t);if("number"==typeof t)return r.Num.from(t);throw new TypeError(""+t)}return r.Item.extant()}cast(t){const e=t.toValue();if(e instanceof r.Num)return e.numberValue();if(e instanceof r.Bool)return e.booleanValue();const i=e.stringValue(void 0);if(void 0!==i)try{return vt.parse(i)}catch(t){}if(e instanceof r.Record){const t=l.DateTime.fromValue(e);if(null!==t)return t;const i=s.Angle.fromValue(e);if(null!==i)return i;const n=s.Length.fromValue(e);if(null!==n)return n;const o=E.fromValue(e);if(null!==o)return o;const r=z.fromValue(e);if(null!==r)return r;const a=rt.fromValue(e);if(null!==a)return a;const h=s.Transform.fromValue(e);if(null!==h)return h}}}class wt extends o.Parser{constructor(t,e,i,n){super(),this.identOutput=t,this.valueParser=e,this.unitsOutput=i,this.step=n}feed(t){return wt.parse(t,this.identOutput,this.valueParser,this.unitsOutput,this.step)}static parse(t,e,i,n,r=1){let a=0;if(1===r){for(;t.isCont()&&(a=t.head(),o.Unicode.isSpace(a));)t.step();if(t.isCont()){if(35===a)return X.parse(t);r=o.Unicode.isAlpha(a)?2:3}else if(!t.isEmpty())return o.Parser.error(o.Diagnostic.unexpected(t))}if(2===r){for(e=e||o.Unicode.stringOutput();t.isCont()&&(a=t.head(),o.Unicode.isAlpha(a)||o.Unicode.isDigit(a)||45===a);)t=t.step(),e.write(a);if(!t.isEmpty()){const i=e.bind();switch(i){case"rgb":case"rgba":return K.parseRest(t);case"hsl":case"hsla":return Q.parseRest(t);case"linear-gradient":return ot.parseRest(t,e);case"normal":case"italic":case"oblique":return B.parseRest(t,i);case"small-caps":return B.parseRest(t,void 0,i);case"bold":case"bolder":case"lighter":return B.parseRest(t,void 0,void 0,i);case"ultra-condensed":case"extra-condensed":case"semi-condensed":case"condensed":case"expanded":case"semi-expanded":case"extra-expanded":case"ultra-expanded":return B.parseRest(t,void 0,void 0,void 0,i);case"large":case"larger":case"medium":case"small":case"smaller":case"x-large":case"x-small":case"xx-large":case"xx-small":return B.parseRest(t,void 0,void 0,void 0,void 0,i);case"translate3d":case"translateX":case"translateY":case"translate":return s.TranslateTransformParser.parseRest(t,e);case"scaleX":case"scaleY":case"scale":return s.ScaleTransformParser.parseRest(t,e);case"rotate":return s.RotateTransformParser.parseRest(t,e);case"skewX":case"skewY":case"skew":return s.SkewTransformParser.parseRest(t,e);case"matrix":return s.AffineTransformParser.parseRest(t,e);case"none":return o.Parser.done(s.Transform.identity());case"true":return o.Parser.done(!0);case"false":return o.Parser.done(!1);default:{const e=z.forName(i);return null!==e?o.Parser.done(e):o.Parser.error(o.Diagnostic.message("unknown style value: "+i,t))}}}}if(3===r)if((i=void 0===i?o.Base10.parseDecimal(t):i.feed(t)).isDone())r=4;else if(i.isError())return i.asError();if(4===r){if(t.isCont()&&(a=t.head(),45===a)){t.step();const e={};return e.year=i.bind(),l.DateTimeFormat.pattern("%m-%dT%H:%M:%S.%LZ").parseDate(t,e)}t.isEmpty()||(r=5)}if(5===r){for(n=n||o.Unicode.stringOutput();t.isCont()&&(a=t.head(),o.Unicode.isAlpha(a)||37===a);)t.step(),n.push(a);t.isEmpty()||(r=6)}if(6===r&&!t.isEmpty()){const e=i.bind(),r=n.bind();let l;switch(r){case"deg":l=s.Angle.deg(e);break;case"rad":l=s.Angle.rad(e);break;case"grad":l=s.Angle.grad(e);break;case"turn":l=s.Angle.turn(e);break;case"px":l=s.Length.px(e);break;case"em":l=s.Length.em(e);break;case"rem":l=s.Length.rem(e);break;case"%":l=s.Length.pct(e);break;case"":l=e;break;default:return o.Parser.error(o.Diagnostic.message("unknown style units: "+r,t))}if(t.isCont()&&(a=t.head(),o.Unicode.isSpace(a)||47===a)){if(l instanceof s.Length)return B.parseRest(t,void 0,void 0,void 0,void 0,l);if("number"==typeof l)switch(e){case 100:case 200:case 300:case 400:case 500:case 600:case 700:case 800:case 900:return B.parseRest(t,void 0,void 0,String(e))}}return o.Parser.done(l)}return new wt(e,i,n,r)}}function mt(t){return"object"==typeof t&&null!==t?"function"==typeof t.toAttributeString?t.toAttributeString():t.toString():""+t}function bt(t){return"object"==typeof t&&null!==t?"function"==typeof t.toStyleString?t.toStyleString():t.toString():""+t}const Ct=function(){let t;return t="undefined"!=typeof CSSStyleValue?function(t){return"object"==typeof t&&null!==t&&"function"==typeof t.toCssValue?t.toCssValue():"number"==typeof t?new CSSUnitValue(t,"number"):null}:bt,t}();class St{constructor(t,e){this.array=t,this.index=e}get size(){return this.array.length}isEmpty(){return 0===this.array.length}has(t){return("object"==typeof t&&null!==t||"function"==typeof t)&&(t=t.name),void 0!==this.index[t]}get(t){("object"==typeof t&&null!==t||"function"==typeof t)&&(t=t.name),"string"==typeof t&&(t=this.index[t]);const e="number"==typeof t?this.array[t]:void 0;return void 0!==e?e[1]:void 0}getOr(t,e){("object"==typeof t&&null!==t||"function"==typeof t)&&(t=t.name),"string"==typeof t&&(t=this.index[t]);const i="number"==typeof t?this.array[t]:void 0;return void 0!==i?i[1]:e}updated(t,e){let i,n=this.array,s=this.index;const o=Array.isArray(t)?t.length:1;for(let r=0;r<o;r+=1){0!==r||Array.isArray(t)?[i,e]=t[r]:i=t;const o=s[i.name];if(void 0!==e&&void 0!==o){const t=n.slice(0);t[o]=[i,e],n=t}else if(void 0!==e){const t=n.slice(0),o={};for(const t in s)o[t]=s[t];o[i.name]=t.length,t.push([i,e]),n=t,s=o}else if(void 0!==o){const t=new Array,e={};let o=0;for(let s=0,r=n.length;s<r;s+=1){const r=n[s];r[0]!==i&&(t[o]=r,e[r[0].name]=o,o+=1)}n=t,s=e}}return this}copy(t,e){return St.fromArray(t,e)}forEach(t,e){const i=this.array;for(let n=0,s=i.length;n<s;n+=1){const s=i[n],o=t.call(e,s[1],s[0]);if(void 0!==o)return o}}equals(t){return this===t||t instanceof St&&e.Arrays.equal(this.array,t.array)}debug(t){const e=this.array,i=e.length;t=t.write("LookVector").write(46).write(0!==i?"of":"empty").write(40);for(let n=0;n<i;n+=1){const[i,s]=e[n];0!==n&&(t=t.write(", ")),t=t.write(91).debug(i).write(", ").debug(s).write(93)}return t=t.write(41)}toString(){return o.Format.debug(this)}static empty(){return new St(e.Arrays.empty,{})}static of(...t){return new St(t,St.index(t))}static fromArray(t,e){return void 0===e&&(e=St.index(t)),new St(t,e)}static fromAny(t){if(null==t||t instanceof St)return t;if(Array.isArray(t))return St.fromArray(t);throw new TypeError(""+t)}static index(t){const e={};for(let i=0,n=t.length;i<n;i+=1){e[t[i][0].name]=i}return e}}u([e.Lazy],St,"empty",null);class At{constructor(t){this.name=t}add(t,e){const i=t.array,n=e.array,s=new Array,o={};for(let t=0,n=i.length;t<n;t+=1){const n=i[t],r=n[0],l=e.get(r);o[r.name]=s.length,s.push(void 0===l?n:[r,r.combine(this,n[1],l)])}for(let t=0,e=n.length;t<e;t+=1){const e=n[t],i=e[0];void 0===o[i.name]&&(o[i.name]=s.length,s.push(e))}return this.fromArray(s,o)}negate(t){const e=t.array,i=e.length,n=new Array(i);for(let t=0;t<i;t+=1){const[i,s]=e[t];n[t]=[i,i.combine(this,void 0,s,-1)]}return this.fromArray(n,t.index)}subtract(t,e){const i=t.array,n=e.array,s=new Array,o={};for(let t=0,n=i.length;t<n;t+=1){const n=i[t],r=n[0],l=e.get(r);o[r.name]=s.length,s.push(void 0===l?n:[r,r.combine(this,n[1],l,-1)])}for(let t=0,e=n.length;t<e;t+=1){const[e,i]=n[t];void 0===o[e.name]&&(o[e.name]=s.length,s.push([e,e.combine(this,void 0,i,-1)]))}return this.fromArray(s,o)}multiply(t,e){const i=t.array,n=i.length,s=new Array(n);for(let t=0;t<n;t+=1){const[n,o]=i[t];s[t]=[n,n.combine(this,void 0,o,e)]}return this.fromArray(s,t.index)}dot(t,e){const i=t.array;let n;for(let t=0,s=i.length;t<s;t+=1){const[s,o]=i[t],r=e.get(s);void 0!==r&&0!==r&&(n=s.combine(this,n,o,r))}return n}dotOr(t,e,i){const n=t.array;if(0!==n.length){let t;for(let i=0,s=n.length;i<s;i+=1){const[s,o]=n[i],r=e.get(s);void 0!==r&&0!==r&&(t=s.combine(this,t,o,r))}return t}return i}empty(){return St.empty()}of(...t){const e=t.length,i=new Array(e),n={};for(let s=0;s<e;s+=1){const[e,o]=t[s];i[s]=[e,this.coerce(o)],n[e.name]=s}return this.fromArray(i,n)}fromArray(t,e){return St.fromArray(t,e)}toString(){return"Look."+this.name}}class xt extends At{combine(t,e,i){return void 0!==t?void 0===i||1===i?e:0===i?t:(1-i)*t+i*e:void 0!==i&&1!==i?e*i:e}between(t,i){return e.NumberInterpolator(t,i)}coerce(t){return t}}class Dt extends At{combine(t,e,i){return void 0!==t?void 0===i||1===i?e:0===i?t:s.LengthInterpolator(t,e)(i):void 0!==i&&1!==i?e.times(i):e}between(t,e){return s.LengthInterpolator(t,e)}coerce(t){return s.Length.fromAny(t)}}class Tt extends At{combine(t,e,i){return void 0!==t?void 0===i||1===i?e:0===i?t:t.interpolateTo(e)(i):void 0!==i&&1!==i?e.times(i):e}between(t,e){return t.interpolateTo(e)}coerce(t){return z.fromAny(t)}}class Pt extends At{combine(t,e,i){return void 0===i||0!==i?e:void 0!==t?t:E.family(e.family)}between(t,e){return W(t,e)}coerce(t){return E.fromAny(t)}}class Vt extends At{combine(t,e,i){return void 0===i||0!==i?e:void 0!==t?t:e}between(t,e){return lt(t,e)}coerce(t){return rt.fromAny(t)}}class It extends At{combine(t,e,i){return void 0===i||0!==i?e:void 0!==t?t:e}between(t,i){return e.Interpolator(t,i)}coerce(t){return e.Timing.fromAny(t)}}class Mt{constructor(t,e){this.array=t,this.index=e}get size(){return this.array.length}isEmpty(){return 0===this.array.length}has(t){return("object"==typeof t&&null!==t||"function"==typeof t)&&(t=t.name),void 0!==this.index[t]}get(t){("object"==typeof t&&null!==t||"function"==typeof t)&&(t=t.name),"string"==typeof t&&(t=this.index[t]);const e="number"==typeof t?this.array[t]:void 0;return void 0!==e?e[1]:void 0}getOr(t,e){("object"==typeof t&&null!==t||"function"==typeof t)&&(t=t.name),"string"==typeof t&&(t=this.index[t]);const i="number"==typeof t?this.array[t]:void 0;return void 0!==i?i[1]:e}updated(t,e){let i,n=this.array,s=this.index;const o=Array.isArray(t)?t.length:1;for(let r=0;r<o;r+=1){0!==r||Array.isArray(t)?[i,e]=t[r]:i=t;const o=s[i.name];if(void 0!==e&&void 0!==o){const t=n.slice(0);t[o]=[i,e],n=t}else if(void 0!==e){const t=n.slice(0),o={};for(const t in s)o[t]=s[t];o[i.name]=t.length,t.push([i,e]),n=t,s=o}else if(void 0!==o){const t=new Array,e={};let o=0;for(let s=0,r=n.length;s<r;s+=1){const r=n[s];r[0]!==i&&(t[o]=r,e[r[0].name]=o,o+=1)}n=t,s=e}}return this}plus(t){const e=this.array,i=t.array,n=new Array,s={};for(let i=0,o=e.length;i<o;i+=1){const o=e[i],r=o[0],l=t.get(r);s[r.name]=n.length,n.push(void 0===l?o:[r,r.combine(o[1],l)])}for(let t=0,e=i.length;t<e;t+=1){const e=i[t],o=e[0];void 0===s[o.name]&&(s[o.name]=n.length,n.push(e))}return this.copy(n,s)}negative(){const t=this.array,e=t.length,i=new Array(e);for(let n=0;n<e;n+=1){const[e,s]=t[n];i[n]=[e,e.combine(void 0,s,-1)]}return this.copy(i,this.index)}minus(t){const e=this.array,i=t.array,n=new Array,s={};for(let i=0,o=e.length;i<o;i+=1){const o=e[i],r=o[0],l=t.get(r);s[r.name]=n.length,n.push(void 0===l?o:[r,r.combine(o[1],l,-1)])}for(let t=0,e=i.length;t<e;t+=1){const[e,o]=i[t];void 0===s[e.name]&&(s[e.name]=n.length,n.push([e,e.combine(void 0,o,-1)]))}return this.copy(n,s)}times(t){const e=this.array,i=e.length,n=new Array(i);for(let s=0;s<i;s+=1){const[i,o]=e[s];n[s]=[i,i.combine(void 0,o,t)]}return this.copy(n,this.index)}copy(t,e){return Mt.fromArray(t,e)}forEach(t,e){const i=this.array;for(let n=0,s=i.length;n<s;n+=1){const s=i[n],o=t.call(e,s[1],s[0]);if(void 0!==o)return o}}interpolateTo(t){return t instanceof Mt?Ft(this,t):null}equals(t){return this===t||t instanceof Mt&&e.Arrays.equal(this.array,t.array)}debug(t){const e=this.array,i=e.length;t=t.write("FeelVector").write(46).write(0!==i?"of":"empty").write(40);for(let n=0;n<i;n+=1){const[i,s]=e[n];0!==n&&(t=t.write(", ")),t=t.write(91).debug(i).write(", ").debug(s).write(93)}return t=t.write(41)}toString(){return o.Format.debug(this)}static empty(){return new Mt([],{})}static of(...t){const e=t.length,i=new Array(e),n={};for(let s=0;s<e;s+=1){const[e,o]=t[s];i[s]=[e,e.coerce(o)],n[e.name]=s}return new Mt(i,n)}static fromArray(t,e){return void 0===e&&(e=Mt.index(t)),new Mt(t,e)}static fromAny(t){if(null==t||t instanceof Mt)return t;if(Array.isArray(t))return Mt.of(...t);throw new TypeError(""+t)}static index(t){const e={};for(let i=0,n=t.length;i<n;i+=1){e[t[i][0].name]=i}return e}}u([e.Lazy],Mt,"empty",null);class Rt{constructor(t){this.name=t}empty(){return Mt.empty()}of(...t){return Mt.of(...t)}from(t,e){return Mt.fromArray(t,e)}toString(){return"Feel."+this.name}}const Ft=function(t){const i=function(t,e){const n=function(t){const e=n.interpolators,i=e.length,s=new Array(i),o=n.index;for(let n=0;n<i;n+=1){const[i,o]=e[n],r=o(t);s[n]=[i,r]}return Mt.fromArray(s,o)};Object.setPrototypeOf(n,i.prototype);const s=new Array,o={};return t.forEach((function(t,i){const n=e.get(i);if(void 0!==n){const e=i.between(t,n);o[i.name]=s.length,s.push([i,e])}})),n.interpolators=s,n.index=o,n};return i.prototype=Object.create(t.prototype),i.prototype.constructor=i,Object.defineProperty(i.prototype,0,{get(){const t=this.interpolators,e=t.length,i=new Array(e),n=this.index;for(let n=0;n<e;n+=1){const[e,s]=t[n],o=s[0];i[n]=[e,o]}return Mt.fromArray(i,n)},configurable:!0}),Object.defineProperty(i.prototype,1,{get(){const t=this.interpolators,e=t.length,i=new Array(e),n=this.index;for(let n=0;n<e;n+=1){const[e,s]=t[n],o=s[1];i[n]=[e,o]}return Mt.fromArray(i,n)},configurable:!0}),i.prototype.equals=function(t){if(this===t)return!0;if(t instanceof i){const i=this.interpolators.length;if(i===t.interpolators.length){for(let n=0;n<i;n+=1)if(!e.Arrays.equal(this.interpolators[n],t.interpolators[n]))return!1;return!0}}return!1},i}(e.Interpolator);class Lt extends Rt{combine(t,e,i,n){return t.combine(e,i,n)}}class kt extends Rt{combine(t,e,i,n){if(e instanceof z&&i instanceof z){const t=void 0===n?i.alpha():i.alpha()*n;return t>=0?e.darker(t):e.lighter(-t)}return t.combine(e,i,n)}}class Ot extends Rt{combine(t,e,i,n){if(e instanceof z&&i instanceof z){if(void 0===n||1===n)return e.alpha(i.alpha());if(0===n)return e;{const t=(1-n)*e.alpha()+n*i.alpha();return e.alpha(t)}}return t.combine(e,i,n)}}const Et={};class Wt{constructor(t,e){this.array=t,this.index=e}get size(){return this.array.length}isEmpty(){return 0===this.array.length}has(t){return("object"==typeof t&&null!==t||"function"==typeof t)&&(t=t.name),void 0!==this.index[t]}get(t){("object"==typeof t&&null!==t||"function"==typeof t)&&(t=t.name),"string"==typeof t&&(t=this.index[t]);const e="number"==typeof t?this.array[t]:void 0;return void 0!==e?e[1]:void 0}getOr(t,e){("object"==typeof t&&null!==t||"function"==typeof t)&&(t=t.name),"string"==typeof t&&(t=this.index[t]);const i="number"==typeof t?this.array[t]:void 0;return void 0!==i?i[1]:e}updated(t,e){let i,n,s,o=this.array,r=this.index;const l=Array.isArray(t)?t.length:1;for(let a=0;a<l;a+=1){0!==a||Array.isArray(t)?[i,e]=t[a]:i=t;const l=r[i.name];if(void 0!==e&&void 0!==l)n=o.slice(0),s=r,n[l]=[i,e],o=n;else if(void 0!==e){n=o.slice(0),s={};for(const t in r)s[t]=r[t];s[i.name]=n.length,n.push([i,e]),o=n,r=s}else if(void 0!==l){n=new Array,s={};let t=0;for(let e=0,r=o.length;e<r;e+=1){const r=o[e];r[0]!==i&&(n[t]=r,s[r[0].name]=t,t+=1)}o=n,r=s}}return void 0!==n&&void 0!==s?this.copy(n,s):this}plus(t){const e=this.array,i=t.array,n=new Array,s={};for(let i=0,o=e.length;i<o;i+=1){const o=e[i],r=o[0],l=t.get(r);s[r.name]=n.length,n.push(void 0===l?o:[r,o[1]+l])}for(let t=0,e=i.length;t<e;t+=1){const e=i[t],o=e[0];void 0===s[o.name]&&(s[o.name]=n.length,n.push(e))}return this.copy(n,s)}negative(){const t=this.array,e=t.length,i=new Array(e);for(let n=0;n<e;n+=1){const[e,s]=t[n];i[n]=[e,-s]}return this.copy(i,this.index)}minus(t){const e=this.array,i=t.array,n=new Array,s={};for(let i=0,o=e.length;i<o;i+=1){const o=e[i],r=o[0],l=t.get(r);s[r.name]=n.length,n.push(void 0===l?o:[r,o[1]-l])}for(let t=0,e=i.length;t<e;t+=1){const[e,o]=i[t];void 0===s[e.name]&&(s[e.name]=n.length,n.push([e,-o]))}return this.copy(n,s)}times(t){const e=this.array,i=e.length,n=new Array(i);for(let s=0;s<i;s+=1){const[i,o]=e[s];n[s]=[i,o*t]}return this.copy(n,this.index)}dot(t){const e=this.array;let i;for(let n=0,s=e.length;n<s;n+=1){const[s,o]=e[n],r=t.get(s);void 0!==r&&(void 0===i?i=o*r:i+=o*r)}return i}copy(t,e){return Wt.fromArray(t,e)}forEach(t,e){const i=this.array;for(let n=0,s=i.length;n<s;n+=1){const s=i[n],o=t.call(e,s[1],s[0]);if(void 0!==o)return o}}equals(t){return this===t||t instanceof Wt&&e.Arrays.equal(this.array,t.array)}debug(t){const e=this.array,i=e.length;t=t.write("MoodVector").write(46).write(0!==i?"of":"empty").write(40);for(let n=0;n<i;n+=1){const[i,s]=e[n];0!==n&&(t=t.write(", ")),t=t.write(91).debug(i).write(", ").debug(s).write(93)}return t=t.write(41)}toString(){return o.Format.debug(this)}static empty(){return new Wt([],{})}static of(...t){return new Wt(t,Wt.index(t))}static fromArray(t,e){return void 0===e&&(e=Wt.index(t)),new Wt(t,e)}static fromAny(t){if(null==t||t instanceof Wt)return t;if(Array.isArray(t))return Wt.fromArray(t);throw new TypeError(""+t)}static index(t){const e={};for(let i=0,n=t.length;i<n;i+=1){e[t[i][0].name]=i}return e}}u([e.Lazy],Wt,"empty",null);class Nt{constructor(t,e,i,n){this.rowArray=t,this.rowIndex=e,this.colArray=i,this.colIndex=n}get rowCount(){return this.rowArray.length}get colCount(){return this.colArray.length}hasRow(t){return("object"==typeof t&&null!==t||"function"==typeof t)&&(t=t.name),void 0!==this.rowIndex[t]}hasCol(t){return("object"==typeof t&&null!==t||"function"==typeof t)&&(t=t.name),void 0!==this.colIndex[t]}getRow(t){("object"==typeof t&&null!==t||"function"==typeof t)&&(t=t.name),"string"==typeof t&&(t=this.rowIndex[t]);const e="number"==typeof t?this.rowArray[t]:void 0;return void 0!==e?e[1]:void 0}getCol(t){("object"==typeof t&&null!==t||"function"==typeof t)&&(t=t.name),"string"==typeof t&&(t=this.colIndex[t]);const e="number"==typeof t?this.colArray[t]:void 0;return void 0!==e?e[1]:void 0}plus(t){const e=this.colArray,i=t.colArray,n=new Array,s={};for(let i=0,o=e.length;i<o;i+=1){const o=e[i],r=o[0],l=t.getCol(r);s[r.name]=n.length,n.push(void 0===l?o:[r,o[1].plus(l)])}for(let t=0,e=i.length;t<e;t+=1){const e=i[t],o=e[0];void 0===s[o.name]&&(s[o.name]=n.length,n.push(e))}return Nt.fromColArray(n,s)}negative(){const t=this.colArray,e=t.length,i=new Array(e);for(let n=0;n<e;n+=1){const[e,s]=t[n];i[n]=[e,s.negative()]}return Nt.fromColArray(i,this.colIndex)}minus(t){const e=this.colArray,i=t.colArray,n=new Array,s={};for(let i=0,o=e.length;i<o;i+=1){const o=e[i],r=o[0],l=t.getCol(r);s[r.name]=n.length,n.push(void 0===l?o:[r,o[1].minus(l)])}for(let t=0,e=i.length;t<e;t+=1){const[e,o]=i[t];void 0===s[e.name]&&(s[e.name]=n.length,n.push([e,o.negative()]))}return Nt.fromColArray(n,s)}times(t){const e=this.colArray,i=e.length,n=new Array(i);for(let s=0;s<i;s+=1){const[i,o]=e[s];n[s]=[i,o.times(t)]}return Nt.fromColArray(n,this.colIndex)}dot(t,e){("object"==typeof t&&null!==t||"function"==typeof t)&&(t=t.name),"string"==typeof t&&(t=this.rowIndex[t]);const i="number"==typeof t?this.rowArray[t]:void 0;if(void 0!==i){t=i[0];return i[1].dot(e)}}timesCol(t,e=!1){const i=this.rowArray,n=new Array,s={};for(let e=0,o=i.length;e<o;e+=1){const[o,r]=i[e],l=r.dot(t);void 0!==l&&(s[o.name]=n.length,n.push([o,l]))}if(e){const e=t.array;for(let t=0,i=e.length;t<i;t+=1){const i=e[t][0];this.hasRow(i)||(s[i.name]=n.length,n.push(e[t]))}}return Wt.fromArray(n,s)}timesRow(t,e=!1){const i=this.colArray,n=new Array,s={};for(let e=0,o=i.length;e<o;e+=1){const[o,r]=i[e],l=t.dot(r);void 0!==l&&(s[o.name]=n.length,n.push([o,l]))}if(e){const e=t.array;for(let t=0,i=e.length;t<i;t+=1){const i=e[t][0];this.hasCol(i)||(s[i.name]=n.length,n.push(e[t]))}}return Wt.fromArray(n,s)}transform(t,e=!0){const i=this.rowArray,n=this.colArray,s=new Array,o={},r=new Array,l={};for(let a=0,h=n.length;a<h;a+=1){const h=n[a][0];let d=t.getCol(h);if(void 0===d&&e&&(d=Wt.of([h,1])),void 0!==d)for(let t=0,e=i.length;t<e;t+=1){const[e,n]=i[t],a=n.dot(d);if(void 0!==a){const t=o[e.name];if(void 0!==t){const i=s[t][1];i.index[e.name]=i.array.length,i.array.push([h,a])}else o[e.name]=s.length,s.push([e,Wt.of([h,a])]);const i=l[h.name];if(void 0!==i){const t=r[i][1];t.index[h.name]=t.array.length,t.array.push([e,a])}else l[h.name]=r.length,r.push([h,Wt.of([e,a])])}}}return new Nt(s,o,r,l)}identityFor(t){const e=this.rowArray,i=t.colArray;let n,s;for(let t=0,o=i.length;t<o;t+=1){const o=i[t][0];if(!this.hasRow(o)){if(void 0===n&&(n=e.slice(0)),void 0===s){s={};for(const t in this.rowIndex)s[t]=this.rowIndex[t]}s[o.name]=n.length,n.push([o,Wt.of([o,1])])}}return void 0!==n&&void 0!==s?Nt.fromRowArray(n,s):this}row(t,e){void 0!==e&&(e=Wt.fromAny(e));const i=this.rowArray,n=this.rowIndex,s=n[t.name];if(void 0!==e&&void 0!==s){const o=i.slice(0);return o[s]=[t,e],Nt.fromRowArray(o,n)}if(void 0!==e){const s=i.slice(0),o={};for(const t in n)o[t]=n[t];return o[t.name]=s.length,s.push([t,e]),Nt.fromRowArray(s,o)}if(void 0!==s){const e=new Array,n={};let s=0;for(let o=0,r=i.length;o<r;o+=1){const r=i[o];r[0]!==t&&(e[s]=r,n[r[0].name]=s,s+=1)}return Nt.fromRowArray(e,n)}return this}col(t,e){void 0!==e&&(e=Wt.fromAny(e));const i=this.colArray,n=this.colIndex,s=n[t.name];if(void 0!==e&&void 0!==s){const o=i.slice(0);return o[s]=[t,e],Nt.fromColArray(o,n)}if(void 0!==e){const s=i.slice(0),o={};for(const t in n)o[t]=n[t];return o[t.name]=s.length,s.push([t,e]),Nt.fromColArray(s,o)}if(void 0!==s){const e=new Array,n={};let s=0;for(let o=0,r=i.length;o<r;o+=1){const r=i[o];r[0]!==t&&(e[s]=r,n[r[0].name]=s,s+=1)}return Nt.fromColArray(e,n)}return this}updatedRow(t,e,i){const n=this.getRow(t);let s=n;return void 0===s&&(!0===i?i=Wt.of([t,1]):!1===i&&(i=void 0),s=i=void 0!==i?Wt.fromAny(i):Wt.empty()),s=s.updated(e),s.equals(n)?this:this.row(t,s)}updatedCol(t,e,i){const n=this.getCol(t);let s=n;return void 0===s&&(!0===i?i=Wt.of([t,1]):!1===i&&(i=void 0),s=i=void 0!==i?Wt.fromAny(i):Wt.empty()),s=s.updated(e),s.equals(n)?this:this.col(t,s)}equals(t){if(this===t)return!0;if(t instanceof Nt){return e.Arrays.equal(this.colArray,t.colArray)}return!1}debug(t){const e=this.colArray,i=e.length;t=t.write("MoodMatrix").write(46).write(0!==i?"forCols":"empty").write(40);for(let n=0;n<i;n+=1){const[i,s]=e[n];0!==n&&(t=t.write(", ")),t=t.write(91).debug(i).write(", ").debug(s).write(93)}return t=t.write(41)}toString(){return o.Format.debug(this)}static empty(){return new Nt([],{},[],{})}static forRows(...t){const e=t.length,i=new Array(e);for(let n=0;n<e;n+=1){const[e,s]=t[n];i[n]=[e,Wt.fromAny(s)]}return this.fromRowArray(i)}static forCols(...t){const e=t.length,i=new Array(e);for(let n=0;n<e;n+=1){const[e,s]=t[n];i[n]=[e,Wt.fromAny(s)]}return this.fromColArray(i)}static fromRowArray(t,e){void 0===e&&(e=Wt.index(t));const i=new Array,n={};for(let e=0,s=t.length;e<s;e+=1){t[e][1].forEach((function(t,e){void 0===n[e.name]&&(n[e.name]=i.length,i.push([e,void 0]))}),this)}for(let e=0,n=i.length;e<n;e+=1){const n=i[e],s=n[0],o=new Array,r={};for(let e=0,i=t.length;e<i;e+=1){const[i,n]=t[e],l=n.get(s);void 0!==l&&(r[i.name]=o.length,o.push([i,l]))}const l=Wt.fromArray(o,r);n[1]=l}return new Nt(t,e,i,n)}static fromColArray(t,e){void 0===e&&(e=Wt.index(t));const i=new Array,n={};for(let e=0,s=t.length;e<s;e+=1){t[e][1].forEach((function(t,e){void 0===n[e.name]&&(n[e.name]=i.length,i.push([e,void 0]))}),this)}for(let e=0,n=i.length;e<n;e+=1){const n=i[e],s=n[0],o=new Array,r={};for(let e=0,i=t.length;e<i;e+=1){const[i,n]=t[e],l=n.get(s);void 0!==l&&(r[i.name]=o.length,o.push([i,l]))}const l=Wt.fromArray(o,r);n[1]=l}return new Nt(i,n,t,e)}}u([e.Lazy],Nt,"empty",null);const Bt={};class zt{constructor(t,e,i,n){this.rowArray=t,this.rowIndex=e,this.colArray=i,this.colIndex=n}get rowCount(){return this.rowArray.length}get colCount(){return this.colArray.length}hasRow(t){return("object"==typeof t&&null!==t||"function"==typeof t)&&(t=t.name),void 0!==this.rowIndex[t]}hasCol(t){return("object"==typeof t&&null!==t||"function"==typeof t)&&(t=t.name),void 0!==this.colIndex[t]}getRow(t){("object"==typeof t&&null!==t||"function"==typeof t)&&(t=t.name),"string"==typeof t&&(t=this.rowIndex[t]);const e="number"==typeof t?this.rowArray[t]:void 0;return void 0!==e?e[1]:void 0}getCol(t){("object"==typeof t&&null!==t||"function"==typeof t)&&(t=t.name),"string"==typeof t&&(t=this.colIndex[t]);const e="number"==typeof t?this.colArray[t]:void 0;return void 0!==e?e[1]:void 0}get(t,e){return this.dot(t,e)}getOr(t,e,i){return this.dotOr(t,e,i)}plus(t){const e=this.colArray,i=t.colArray,n=new Array,s={};for(let i=0,o=e.length;i<o;i+=1){const o=e[i],r=o[0],l=t.getCol(r);s[r.name]=n.length,n.push(void 0===l?o:[r,o[1].plus(l)])}for(let t=0,e=i.length;t<e;t+=1){const e=i[t],o=e[0];void 0===s[o.name]&&(s[o.name]=n.length,n.push(e))}return zt.fromColArray(n,s)}negative(){const t=this.colArray,e=t.length,i=new Array(e);for(let n=0;n<e;n+=1){const[e,s]=t[n];i[n]=[e,s.negative()]}return zt.fromColArray(i,this.colIndex)}minus(t){const e=this.colArray,i=t.colArray,n=new Array,s={};for(let i=0,o=e.length;i<o;i+=1){const o=e[i],r=o[0],l=t.getCol(r);s[r.name]=n.length,n.push(void 0===l?o:[r,o[1].minus(l)])}for(let t=0,e=i.length;t<e;t+=1){const[e,o]=i[t];void 0===s[e.name]&&(s[e.name]=n.length,n.push([e,o.negative()]))}return zt.fromColArray(n,s)}times(t){const e=this.colArray,i=e.length,n=new Array(i);for(let s=0;s<i;s+=1){const[i,o]=e[s];n[s]=[i,o.times(t)]}return zt.fromColArray(n,this.colIndex)}dot(t,e){("object"==typeof t&&null!==t||"function"==typeof t)&&(t=t.name),"string"==typeof t&&(t=this.rowIndex[t]);const i="number"==typeof t?this.rowArray[t]:void 0;if(void 0!==i){t=i[0];const n=i[1];return t.dot(n,e)}}dotOr(t,e,i){("object"==typeof t&&null!==t||"function"==typeof t)&&(t=t.name),"string"==typeof t&&(t=this.rowIndex[t]);const n="number"==typeof t?this.rowArray[t]:void 0;if(void 0!==n){t=n[0];const s=n[1];return t.dotOr(s,e,i)}return i}timesCol(t){const e=this.rowArray,i=new Array,n={};for(let s=0,o=e.length;s<o;s+=1){const[o,r]=e[s],l=o.dot(r,t);void 0!==l&&(n[o.name]=i.length,i.push([o,l]))}return Mt.fromArray(i,n)}transform(t,e=!0){const i=this.rowArray,n=this.colArray,s=new Array,o={},r=new Array,l={};for(let a=0,h=n.length;a<h;a+=1){const h=n[a][0];let d=t.getCol(h);if(void 0===d&&e&&(d=Wt.of([h,1])),void 0!==d)for(let t=0,e=i.length;t<e;t+=1){const[e,n]=i[t],a=e.dot(n,d);if(void 0!==a){const t=o[e.name];if(void 0!==t){const i=s[t][1];i.index[e.name]=i.array.length,i.array.push([h,a])}else o[e.name]=s.length,s.push([e,St.of([h,a])]);const i=l[h.name];if(void 0!==i){const t=r[i][1];t.index[h.name]=t.array.length,t.array.push([e,a])}else l[h.name]=r.length,r.push([h,Mt.of([e,a])])}}}return new zt(s,o,r,l)}row(t,e){void 0!==e&&(e=St.fromAny(e));const i=this.rowArray,n=this.rowIndex,s=n[t.name];if(void 0!==e&&void 0!==s){const o=i.slice(0);return o[s]=[t,e],zt.fromRowArray(o,n)}if(void 0!==e){const s=i.slice(0),o={};for(const t in n)o[t]=n[t];return o[t.name]=s.length,s.push([t,e]),zt.fromRowArray(s,o)}if(void 0!==s){const e=new Array,n={};let s=0;for(let o=0,r=i.length;o<r;o+=1){const r=i[o];r[0]!==t&&(e[s]=r,n[r[0].name]=s,s+=1)}return zt.fromRowArray(e,n)}return this}col(t,e){void 0!==e&&(e=Mt.fromAny(e));const i=this.colArray,n=this.colIndex,s=n[t.name];if(void 0!==e&&void 0!==s){const o=i.slice(0);return o[s]=[t,e],zt.fromColArray(o,n)}if(void 0!==e){const s=i.slice(0),o={};for(const t in n)o[t]=n[t];return o[t.name]=s.length,s.push([t,e]),zt.fromColArray(s,o)}if(void 0!==s){const e=new Array,n={};let s=0;for(let o=0,r=i.length;o<r;o+=1){const r=i[o];r[0]!==t&&(e[s]=r,n[r[0].name]=s,s+=1)}return zt.fromColArray(e,n)}return this}updatedRow(t,e,i){const n=this.getRow(t);let s=n;return void 0===s&&(s=i=void 0!==i?St.fromAny(i):St.empty()),s=s.updated(e),s.equals(n)?this:this.row(t,s)}updatedCol(t,e,i){const n=this.getCol(t);let s=n;return void 0===s&&(s=i=void 0!==i?Mt.fromAny(i):Mt.empty()),s=s.updated(e),s.equals(n)?this:this.col(t,s)}equals(t){return this===t||t instanceof zt&&e.Arrays.equal(this.colArray,t.colArray)}debug(t){const e=this.colArray,i=e.length;t=t.write("ThemeMatrix").write(46).write(0!==i?"forCols":"empty").write(40);for(let n=0;n<i;n+=1){const[i,s]=e[n];0!==n&&(t=t.write(", ")),t=t.write(91).debug(i).write(", ").debug(s).write(93)}return t=t.write(41)}toString(){return o.Format.debug(this)}static empty(){return new zt([],{},[],{})}static forRows(...t){const e=t.length,i=new Array(e);for(let n=0;n<e;n+=1){const[e,s]=t[n];i[n]=[e,St.fromAny(s)]}return this.fromRowArray(i)}static forCols(...t){const e=t.length,i=new Array(e);for(let n=0;n<e;n+=1){const[e,s]=t[n];i[n]=[e,Mt.fromAny(s)]}return this.fromColArray(i)}static fromRowArray(t,e){void 0===e&&(e=Mt.index(t));const i=new Array,n={};for(let e=0,s=t.length;e<s;e+=1){t[e][1].forEach((function(t,e){void 0===n[e.name]&&(n[e.name]=i.length,i.push([e,void 0]))}),this)}for(let e=0,n=i.length;e<n;e+=1){const n=i[e],s=n[0],o=new Array,r={};for(let e=0,i=t.length;e<i;e+=1){const[i,n]=t[e],l=n.get(s);void 0!==l&&(r[i.name]=o.length,o.push([i,l]))}const l=Mt.fromArray(o,r);n[1]=l}return new zt(t,e,i,n)}static fromColArray(t,e){void 0===e&&(e=St.index(t));const i=new Array,n={};for(let e=0,s=t.length;e<s;e+=1){t[e][1].forEach((function(t,e){void 0===n[e.name]&&(n[e.name]=i.length,i.push([e,void 0]))}),this)}for(let e=0,n=i.length;e<n;e+=1){const n=i[e],s=n[0],o=new Array,r={};for(let e=0,i=t.length;e<i;e+=1){const[i,n]=t[e],l=n.get(s);void 0!==l&&(r[i.name]=o.length,o.push([i,l]))}const l=St.fromArray(o,r);n[1]=l}return new zt(i,n,t,e)}}u([e.Lazy],zt,"empty",null);const Ut=function(){const t={is:function(t){if("object"==typeof t&&null!==t||"function"==typeof t){return"getLook"in t}return!1}};return t}(),Ht=function(t){const n=t.extend("ThemeAnimator");return n.prototype.onSetAffinity=function(e,n){e>i.Affinity.Intrinsic&&this.setLook(null,e),t.prototype.onSetAffinity.call(this,e,n)},n.prototype.onInherit=function(e){e instanceof n?this.setLook(e.look,e.timing,i.Affinity.Reflexive):this.setLook(null,i.Affinity.Reflexive),null===this.look&&t.prototype.onInherit.call(this,e)},Object.defineProperty(n.prototype,"superLook",{get:function(){const t=this.superFastener;return t instanceof n?t.look:null},configurable:!0}),n.prototype.getSuperLook=function(){const t=this.superLook;if(null===t)throw new TypeError(t+" "+this.name+" super look");return t},n.prototype.getSuperLookOr=function(t){let e=this.superLook;return null===e&&(e=t),e},n.prototype.getLook=function(){const t=this.look;if(null===t)throw new TypeError(t+" "+this.name+" look");return t},n.prototype.getLookOr=function(t){let e=this.look;return null===e&&(e=t),e},n.prototype.setLook=function(t,i,n){if("number"==typeof i&&(n=i,i=void 0),this.minAffinity(n)){const n=this.look;t!==n&&(i=null!=i&&e.Timing.fromAny(i),this.willSetLook(t,n,i),this.look=t,this.onSetLook(t,n,i),this.didSetLook(t,n,i))}},n.prototype.willSetLook=function(t,e,i){},n.prototype.onSetLook=function(t,e,i){null!==t&&this.applyLook(t,i)},n.prototype.didSetLook=function(t,e,i){},n.prototype.applyLook=function(t,e){const n=this.owner;if(this.mounted&&Ut.is(n)){const s=n.getLook(t);void 0!==s&&(!0===e&&(e=n.getLookOr(At.timing,!0)),this.setState(s,e,i.Affinity.Reflexive))}},n.prototype.applyTheme=function(t,e,n){const s=this.look;if(null!==s){const o=t.get(s,e);void 0!==o&&(!0===n&&void 0===(n=t.get(At.timing,e))&&(n=!0),this.setState(o,n,i.Affinity.Reflexive))}},n.prototype.tweenInherited=function(e){const s=this.superFastener;s instanceof n?this.setLook(s.look,s.timing,i.Affinity.Reflexive):this.setLook(null,i.Affinity.Reflexive),null!==this.look?t.prototype.tween.call(this,e):t.prototype.tweenInherited.call(this,e)},n.prototype.onMount=function(){t.prototype.onMount.call(this);const e=this.look;null!==e&&this.applyLook(e,!1)},n.construct=function(e,i,n){return(i=t.construct(e,i,n)).look=null,i},n.specialize=function(t){return t===String?qt:t===Number?Gt:t===Boolean?jt:t===s.Angle?Yt:t===s.Length?Xt:t===s.Transform?Kt:t===z?Zt:t===E?_t:t===ct?Qt:t===pt?Jt:t===gt?$t:null},n.define=function(t,i){let n=i.extends;const s=i.affinity,o=i.inherits,r=i.look,l=i.state,a=i.initState;delete i.extends,delete i.affinity,delete i.inherits,delete i.look,delete i.state,delete i.initState,null==n&&(n=this.specialize(i.type)),null===n&&(n=this,void 0===i.fromAny&&e.FromAny.is(i.type)&&(i.fromAny=i.type.fromAny));const h=n.extend(t,i);return h.construct=function(t,e,i){return e=n.construct(t,e,i),void 0!==s&&e.initAffinity(s),void 0!==o&&e.initInherits(o),void 0!==r&&(e.look=r),void 0!==a?(e.state=e.fromAny(a()),e.value=e.state):void 0!==l&&(e.state=e.fromAny(l),e.value=e.state),e},h},n}(i.Animator),qt=function(t){const e=t.extend("StringThemeAnimator");return e.prototype.fromAny=function(t){return t},e.prototype.equalState=function(t,e){return t===e},e}(Ht),Gt=function(t){const e=t.extend("NumberThemeAnimator");return e.prototype.fromAny=function(t){if("string"==typeof t){const e=+t;if(isFinite(e))return e;throw new Error(t)}return t},e.prototype.equalState=function(t,e){return t===e},e}(Ht),jt=function(t){const e=t.extend("BooleanThemeAnimator");return e.prototype.fromAny=function(t){return!!t},e.prototype.equalState=function(t,e){return t===e},e}(Ht),Yt=function(t){const e=t.extend("AngleThemeAnimator");return e.prototype.fromAny=function(t){return null!=t?s.Angle.fromAny(t):t},e.prototype.equalState=function(t,e){return null!=t?t.equals(e):t===e},e}(Ht),Xt=function(t){const e=t.extend("LengthThemeAnimator");return e.prototype.fromAny=function(t){return null!=t?s.Length.fromAny(t):null},e.prototype.equalState=function(t,e){return null!=t?t.equals(e):t===e},e}(Ht),Kt=function(t){const e=t.extend("TransformThemeAnimator");return e.prototype.fromAny=function(t){return null!=t?s.Transform.fromAny(t):null},e.prototype.equalState=function(t,e){return null!=t?t.equals(e):t===e},e}(Ht),Zt=function(t){const e=t.extend("ColorThemeAnimator");return e.prototype.fromAny=function(t){return null!=t?z.fromAny(t):t},e.prototype.equalState=function(t,e){return null!=t?t.equals(e):t===e},e}(Ht),_t=function(t){const e=t.extend("FontThemeAnimator");return e.prototype.fromAny=function(t){return null!=t?E.fromAny(t):t},e.prototype.equalState=function(t,e){return null!=t?t.equals(e):t===e},e}(Ht),Qt=function(t){const e=t.extend("FocusThemeAnimator");return Object.defineProperty(e.prototype,"phase",{get(){const t=this.value;return null!=t?t.phase:void 0},configurable:!0}),e.prototype.getPhase=function(){return this.getValue().phase},e.prototype.getPhaseOr=function(t){const e=this.value;return null!=e?e.phase:t},e.prototype.setPhase=function(t,e,i){const n=this.value;null!=n&&("number"==typeof e&&(i=e,e=void 0),this.setState(n.withPhase(t),e,i))},Object.defineProperty(e.prototype,"direction",{get(){const t=this.value;return null!=t?t.direction:0},configurable:!0}),e.prototype.setDirection=function(t,e,i){const n=this.value;null!=n&&("number"==typeof e&&(i=e,e=void 0),this.setState(n.withDirection(t),e,i))},Object.defineProperty(e.prototype,"unfocused",{get(){const t=this.value;return null!=t&&t.unfocused},configurable:!0}),Object.defineProperty(e.prototype,"focused",{get(){const t=this.value;return null!=t&&t.focused},configurable:!0}),Object.defineProperty(e.prototype,"focusing",{get(){const t=this.value;return null!=t&&t.focusing},configurable:!0}),Object.defineProperty(e.prototype,"unfocusing",{get(){const t=this.value;return null!=t&&t.unfocusing},configurable:!0}),e.prototype.focus=function(t,e){const i=this.value;if(null==i||!i.focused){if("number"==typeof t&&(e=t,t=void 0),void 0===t||!0===t){const e=this.owner;this.mounted&&Ut.is(e)&&(t=e.getLook(At.timing))}null!=i&&this.setValue(i.asFocusing(),i),this.setState(ct.focused(),t,e)}},e.prototype.unfocus=function(t,e){const i=this.value;if(null==i||!i.unfocused){if("number"==typeof t&&(e=t,t=void 0),void 0===t||!0===t){const e=this.owner;this.mounted&&Ut.is(e)&&(t=e.getLook(At.timing))}null!=i&&this.setValue(i.asUnfocusing(),i),this.setState(ct.unfocused(),t,e)}},e.prototype.toggle=function(t,e){const i=this.value;if(null!=i){if("number"==typeof t&&(e=t,t=void 0),void 0===t||!0===t){const e=this.owner;this.mounted&&Ut.is(e)&&(t=e.getLook(At.timing))}this.setValue(i.asToggling(),i),this.setState(i.asToggled(),t,e)}},e.prototype.onSetValue=function(e,i){t.prototype.onSetValue.call(this,e,i),null!=e&&null!=i&&(e.focusing&&!i.focusing?this.willFocus():e.focused&&!i.focused?this.didFocus():e.unfocusing&&!i.unfocusing?this.willUnfocus():e.unfocused&&!i.unfocused&&this.didUnfocus())},e.prototype.willFocus=function(){},e.prototype.didFocus=function(){},e.prototype.willUnfocus=function(){},e.prototype.didUnfocus=function(){},e.prototype.fromAny=function(t){return null!=t?ct.fromAny(t):null},e.prototype.equalState=function(t,e){return null!=t?t.equals(e):t===e},e}(Ht),Jt=function(t){const e=t.extend("PresenceThemeAnimator");return Object.defineProperty(e.prototype,"phase",{get(){const t=this.value;return null!=t?t.phase:void 0},configurable:!0}),e.prototype.getPhase=function(){return this.getValue().phase},e.prototype.getPhaseOr=function(t){const e=this.value;return null!=e?e.phase:t},e.prototype.setPhase=function(t,e,i){const n=this.value;null!=n&&("number"==typeof e&&(i=e,e=void 0),this.setState(n.withPhase(t),e,i))},Object.defineProperty(e.prototype,"direction",{get(){const t=this.value;return null!=t?t.direction:0},configurable:!0}),e.prototype.setDirection=function(t,e,i){const n=this.value;null!=n&&("number"==typeof e&&(i=e,e=void 0),this.setState(n.withDirection(t),e,i))},Object.defineProperty(e.prototype,"modalState",{get(){const t=this.value;return null!=t?t.modalState:void 0},configurable:!0}),Object.defineProperty(e.prototype,"dismissed",{get(){const t=this.value;return null!=t&&t.dismissed},configurable:!0}),Object.defineProperty(e.prototype,"presented",{get(){const t=this.value;return null!=t&&t.presented},configurable:!0}),Object.defineProperty(e.prototype,"presenting",{get(){const t=this.value;return null!=t&&t.presenting},configurable:!0}),Object.defineProperty(e.prototype,"dismissing",{get(){const t=this.value;return null!=t&&t.dismissing},configurable:!0}),e.prototype.present=function(t,e){const i=this.value;if(null==i||!i.presented){if("number"==typeof t&&(e=t,t=void 0),void 0===t||!0===t){const e=this.owner;this.mounted&&Ut.is(e)&&(t=e.getLook(At.timing))}null!=i&&this.setValue(i.asPresenting(),i),this.setState(pt.presented(),t,e)}},e.prototype.dismiss=function(t,e){const i=this.value;if(null==i||!i.dismissed){if("number"==typeof t&&(e=t,t=void 0),void 0===t||!0===t){const e=this.owner;this.mounted&&Ut.is(e)&&(t=e.getLook(At.timing))}null!=i&&this.setValue(i.asDismissing(),i),this.setState(pt.dismissed(),t,e)}},e.prototype.toggle=function(t,e){const i=this.value;if(null!=i){if("number"==typeof t&&(e=t,t=void 0),void 0===t||!0===t){const e=this.owner;this.mounted&&Ut.is(e)&&(t=e.getLook(At.timing))}this.setValue(i.asToggling(),i),this.setState(i.asToggled(),t,e)}},e.prototype.onSetValue=function(e,i){t.prototype.onSetValue.call(this,e,i),null!=e&&null!=i&&(e.presenting&&!i.presenting?this.willPresent():e.presented&&!i.presented?this.didPresent():e.dismissing&&!i.dismissing?this.willDismiss():e.dismissed&&!i.dismissed&&this.didDismiss())},e.prototype.willPresent=function(){},e.prototype.didPresent=function(){},e.prototype.willDismiss=function(){},e.prototype.didDismiss=function(){},e.prototype.fromAny=function(t){return null!=t?pt.fromAny(t):null},e.prototype.equalState=function(t,e){return null!=t?t.equals(e):t===e},e}(Ht),$t=function(t){const e=t.extend("ExpansionThemeAnimator");return Object.defineProperty(e.prototype,"phase",{get(){const t=this.value;return null!=t?t.phase:void 0},configurable:!0}),e.prototype.getPhase=function(){return this.getValue().phase},e.prototype.getPhaseOr=function(t){const e=this.value;return null!=e?e.phase:t},e.prototype.setPhase=function(t,e,i){const n=this.value;null!=n&&("number"==typeof e&&(i=e,e=void 0),this.setState(n.withPhase(t),e,i))},Object.defineProperty(e.prototype,"direction",{get(){const t=this.value;return null!=t?t.direction:0},configurable:!0}),e.prototype.setDirection=function(t,e,i){const n=this.value;null!=n&&("number"==typeof e&&(i=e,e=void 0),this.setState(n.withDirection(t),e,i))},Object.defineProperty(e.prototype,"modalState",{get(){const t=this.value;return null!=t?t.modalState:void 0},configurable:!0}),Object.defineProperty(e.prototype,"collapsed",{get(){const t=this.value;return null!=t&&t.collapsed},configurable:!0}),Object.defineProperty(e.prototype,"expanded",{get(){const t=this.value;return null!=t&&t.expanded},configurable:!0}),Object.defineProperty(e.prototype,"expanding",{get(){const t=this.value;return null!=t&&t.expanding},configurable:!0}),Object.defineProperty(e.prototype,"collapsing",{get(){const t=this.value;return null!=t&&t.collapsing},configurable:!0}),e.prototype.expand=function(t,e){const i=this.value;if(null==i||!i.expanded){if("number"==typeof t&&(e=t,t=void 0),void 0===t||!0===t){const e=this.owner;this.mounted&&Ut.is(e)&&(t=e.getLook(At.timing))}null!=i&&this.setValue(i.asExpanding(),i),this.setState(gt.expanded(),t,e)}},e.prototype.collapse=function(t,e){const i=this.value;if(null==i||!i.collapsed){if("number"==typeof t&&(e=t,t=void 0),void 0===t||!0===t){const e=this.owner;this.mounted&&Ut.is(e)&&(t=e.getLook(At.timing))}null!=i&&this.setValue(i.asCollapsing(),i),this.setState(gt.collapsed(),t,e)}},e.prototype.toggle=function(t,e){const i=this.value;if(null!=i){if("number"==typeof t&&(e=t,t=void 0),void 0===t||!0===t){const e=this.owner;this.mounted&&Ut.is(e)&&(t=e.getLook(At.timing))}this.setValue(i.asToggling(),i),this.setState(i.asToggled(),t,e)}},e.prototype.onSetValue=function(e,i){t.prototype.onSetValue.call(this,e,i),null!=e&&null!=i&&(e.expanding&&!i.expanding?this.willExpand():e.expanded&&!i.expanded?this.didExpand():e.collapsing&&!i.collapsing?this.willCollapse():e.collapsed&&!i.collapsed&&this.didCollapse())},e.prototype.willExpand=function(){},e.prototype.didExpand=function(){},e.prototype.willCollapse=function(){},e.prototype.didCollapse=function(){},e.prototype.fromAny=function(t){return null!=t?gt.fromAny(t):null},e.prototype.equalState=function(t,e){return null!=t?t.equals(e):t===e},e}(Ht),te=function(t){const n=t.extend("ThemeConstraintAnimator");return n.prototype.isExternal=function(){return!0},n.prototype.isDummy=function(){return!1},n.prototype.isInvalid=function(){return!1},n.prototype.isConstant=function(){return!1},n.prototype.evaluateConstraintVariable=function(){},n.prototype.updateConstraintSolution=function(t){this.constrained&&this.toNumber(this.state)!==t&&this.setState(t,i.Affinity.Reflexive)},n.prototype.setStrength=function(t){this.strength=a.ConstraintStrength.fromAny(t)},Object.defineProperty(n.prototype,"coefficient",{get:()=>1,configurable:!0}),Object.defineProperty(n.prototype,"variable",{get(){return this},configurable:!0}),Object.defineProperty(n.prototype,"terms",{get(){const t=new a.ConstraintMap;return t.set(this,1),t},configurable:!0}),Object.defineProperty(n.prototype,"constant",{get:()=>0,configurable:!0}),n.prototype.plus=function(t){return this===(t=a.ConstraintExpression.fromAny(t))?a.ConstraintExpression.product(2,this):a.ConstraintExpression.sum(this,t)},n.prototype.negative=function(){return a.ConstraintExpression.product(-1,this)},n.prototype.minus=function(t){return this===(t=a.ConstraintExpression.fromAny(t))?a.ConstraintExpression.zero:a.ConstraintExpression.sum(this,t.negative())},n.prototype.times=function(t){return a.ConstraintExpression.product(t,this)},n.prototype.divide=function(t){return a.ConstraintExpression.product(1/t,this)},Object.defineProperty(n.prototype,"constrained",{get(){return 0!=(this.flags&n.ConstrainedFlag)},configurable:!0}),n.prototype.constrain=function(t){void 0===t&&(t=!0);const e=this.flags;return t&&0==(e&n.ConstrainedFlag)?(this.setFlags(e|n.ConstrainedFlag),0!==this.conditionCount&&this.mounted&&this.stopConstraining()):t||0==(e&n.ConstrainedFlag)||(this.setFlags(e&~n.ConstrainedFlag),0!==this.conditionCount&&this.mounted&&(this.startConstraining(),this.updateConstraintVariable())),this},n.prototype.addConstraintCondition=function(t,e){this.conditionCount+=1,!this.constrained&&1===this.conditionCount&&this.mounted&&(this.startConstraining(),this.updateConstraintVariable())},n.prototype.removeConstraintCondition=function(t,e){this.conditionCount-=1,!this.constrained&&0===this.conditionCount&&this.mounted&&this.stopConstraining()},Object.defineProperty(n.prototype,"constraining",{get(){return 0!=(this.flags&n.ConstrainingFlag)},configurable:!0}),n.prototype.startConstraining=function(){0==(this.flags&n.ConstrainingFlag)&&(this.willStartConstraining(),this.setFlags(this.flags|n.ConstrainingFlag),this.onStartConstraining(),this.didStartConstraining())},n.prototype.willStartConstraining=function(){},n.prototype.onStartConstraining=function(){const t=this.owner;a.ConstraintScope.is(t)&&t.addConstraintVariable(this)},n.prototype.didStartConstraining=function(){},n.prototype.stopConstraining=function(){0!=(this.flags&n.ConstrainingFlag)&&(this.willStopConstraining(),this.setFlags(this.flags&~n.ConstrainingFlag),this.onStopConstraining(),this.didStopConstraining())},n.prototype.willStopConstraining=function(){},n.prototype.onStopConstraining=function(){const t=this.owner;a.ConstraintScope.is(t)&&t.removeConstraintVariable(this)},n.prototype.didStopConstraining=function(){},n.prototype.updateConstraintVariable=function(){const t=this.owner,e=this.value;void 0!==e&&a.ConstraintScope.is(t)&&t.setConstraintVariable(this,this.toNumber(e))},n.prototype.onSetValue=function(e,i){t.prototype.onSetValue.call(this,e,i);const n=this.owner;this.constraining&&a.ConstraintScope.is(n)&&n.setConstraintVariable(this,null!=e?this.toNumber(e):0)},n.prototype.onMount=function(){t.prototype.onMount.call(this),this.constrained||0===this.conditionCount||this.startConstraining()},n.prototype.onUnmount=function(){this.constrained||0===this.conditionCount||this.stopConstraining(),t.prototype.onUnmount.call(this)},n.prototype.fromAny=function(t){if("string"==typeof t){const e=+t;if(isFinite(e))return e}return t},n.prototype.toNumber=function(t){return null!=t?+t:0},n.construct=function(e,i,n){return(i=t.construct(e,i,n)).id=a.ConstraintId.next(),i.strength=a.ConstraintStrength.Strong,i.conditionCount=0,i},n.specialize=function(t){return t===Number?ee:t===s.Length?ie:null},n.define=function(t,i){let n=i.extends;const s=i.affinity,o=i.inherits,r=void 0!==i.strength?a.ConstraintStrength.fromAny(i.strength):void 0,l=i.constrain,h=i.look,d=i.state,c=i.initState;delete i.extends,delete i.affinity,delete i.inherits,delete i.strength,delete i.constrain,delete i.look,delete i.state,delete i.initState,null==n&&(n=this.specialize(i.type)),null===n&&(n=this,void 0===i.fromAny&&e.FromAny.is(i.type)&&(i.fromAny=i.type.fromAny));const u=n.extend(t,i);return u.construct=function(t,e,i){return e=n.construct(t,e,i),void 0!==s&&e.initAffinity(s),void 0!==o&&e.initInherits(o),void 0!==r&&(e.strength=r),void 0!==h&&(e.look=h),void 0!==c?(e.state=e.fromAny(c()),e.value=e.state):void 0!==d&&(e.state=e.fromAny(d),e.value=e.state),!0===l&&e.constrain(),e},u},n.ConstrainedFlag=1<<t.FlagShift+0,n.ConstrainingFlag=1<<t.FlagShift+1,n.FlagShift=t.FlagShift+2,n.FlagMask=(1<<n.FlagShift)-1,n}(Ht),ee=function(t){const e=t.extend("NumberThemeConstraintAnimator");return e.prototype.toNumber=function(t){return"number"==typeof t?t:0},e.prototype.fromAny=function(t){if("string"==typeof t){const e=+t;if(isFinite(e))return e;throw new Error(t)}return t},e.prototype.equalState=function(t,e){return t===e},e}(te),ie=function(t){const e=t.extend("LengthThemeConstraintAnimator");return e.prototype.toNumber=function(t){try{return null!=t?t.pxValue():0}catch(t){return 0}},e.prototype.fromAny=function(t){return null!=t?s.Length.fromAny(t):null},e.prototype.equalState=function(t,e){return null!=t?t.equals(e):t===e},e}(te);At.font=new Pt("font"),At.color=new Tt("color"),At.iconColor=new Tt("iconColor"),At.statusColor=new Tt("statusColor"),At.accentColor=new Tt("accentColor"),At.mutedColor=new Tt("mutedColor"),At.neutralColor=new Tt("neutralColor"),At.subduedColor=new Tt("subduedColor"),At.faintColor=new Tt("faintColor"),At.highlightColor=new Tt("highlightColor"),At.backgroundColor=new Tt("backgroundColor"),At.borderColor=new Tt("borderColor"),At.opacity=new xt("opacity"),At.shadow=new Vt("shadow"),At.spacing=new Dt("spacing"),At.timing=new It("timing"),Rt.ambient=new Lt("ambient"),Rt.default=new Lt("default"),Rt.primary=new Lt("primary"),Rt.secondary=new Lt("secondary"),Rt.unselected=new Lt("unselected"),Rt.selected=new Lt("selected"),Rt.disabled=new Lt("disabled"),Rt.inactive=new Lt("inactive"),Rt.warning=new Lt("warning"),Rt.alert=new Lt("alert"),Rt.darker=new kt("darker"),Rt.lighter=new kt("lighter"),Rt.contrasted=new kt("contrasted"),Rt.raised=new Lt("raised"),Rt.covered=new Lt("covered"),Rt.opaque=new Lt("opaque"),Rt.floating=new Lt("floating"),Rt.transparent=new Lt("transparent"),Rt.translucent=new Ot("translucent"),Rt.embossed=new kt("embossed"),Rt.nested=new kt("nested"),Rt.hovering=new kt("hovering"),Rt.navigating=new Lt("navigating"),Et.ambient=Wt.of([Rt.ambient,1]),Et.default=Wt.of([Rt.default,1]),Et.primary=Wt.of([Rt.primary,1]),Et.secondary=Wt.of([Rt.secondary,1]),Et.selected=Wt.of([Rt.selected,1]),Et.disabled=Wt.of([Rt.disabled,1]),Et.inactive=Wt.of([Rt.inactive,1]),Et.warning=Wt.of([Rt.warning,1]),Et.alert=Wt.of([Rt.alert,1]),Et.darker=Wt.of([Rt.darker,1]),Et.lighter=Wt.of([Rt.lighter,1]),Et.contrasted=Wt.of([Rt.contrasted,1]),Et.raised=Wt.of([Rt.raised,1]),Et.covered=Wt.of([Rt.covered,1]),Et.opaque=Wt.of([Rt.opaque,1]),Et.floating=Wt.of([Rt.floating,1]),Et.transparent=Wt.of([Rt.transparent,1]),Et.translucent=Wt.of([Rt.translucent,1]),Et.embossed=Wt.of([Rt.embossed,1]),Et.nested=Wt.of([Rt.nested,1]),Et.hovering=Wt.of([Rt.hovering,1]),Et.navigating=Wt.of([Rt.navigating,1]);const ne=E.parse("14px -apple-system, system-ui, sans-serif"),se=z.parse("#d8d8d8"),oe=z.parse("#d8d8d8"),re=z.parse("#6c6d6e"),le=z.parse("#989898"),ae=z.parse("#808080"),he=z.parse("#28292a"),de=z.parse("#1f2123"),ce=z.white(.1),ue=z.parse("#161719"),pe=ue.lighter(2/3),fe=z.parse("#18191b"),ge=z.parse("#1e2022"),ve=z.parse("#66ffdd"),ye=z.parse("#32c5ff"),we=z.parse("#7b7c7d"),me=z.parse("#7b7c7d"),be=z.parse("#f9f070"),Ce=z.parse("#f6511d"),Se=s.Length.px(10),Ae=Mt.of([At.font,ne],[At.color,se],[At.iconColor,oe],[At.statusColor,se],[At.accentColor,re],[At.mutedColor,le],[At.neutralColor,ae],[At.subduedColor,he],[At.faintColor,de],[At.highlightColor,ce],[At.backgroundColor,ue],[At.borderColor,pe],[At.spacing,Se],[At.timing,e.Easing.linear.withDuration(1e3)]),xe=Mt.of([At.font,ne],[At.color,se],[At.iconColor,oe],[At.statusColor,se],[At.accentColor,re],[At.mutedColor,le],[At.neutralColor,ae],[At.subduedColor,he],[At.faintColor,de],[At.highlightColor,ce],[At.backgroundColor,ue],[At.borderColor,pe],[At.spacing,Se],[At.timing,e.Easing.cubicOut.withDuration(250)]),De=Mt.of([At.accentColor,ve]),Te=Mt.of([At.accentColor,ye]),Pe=Mt.of([At.color,le],[At.iconColor,le],[At.backgroundColor,ue.darker(1)]),Ve=Mt.of([At.color,se],[At.iconColor,oe],[At.backgroundColor,ue.darker(1)]),Ie=Mt.of([At.color,we],[At.iconColor,we],[At.statusColor,we],[At.accentColor,we]),Me=Mt.of([At.statusColor,me],[At.accentColor,me]),Re=Mt.of([At.statusColor,be],[At.accentColor,be]),Fe=Mt.of([At.statusColor,Ce],[At.accentColor,Ce]),Le=Mt.of([At.mutedColor,le.darker(1/3)],[At.neutralColor,ae.darker(1/3)],[At.backgroundColor,fe]),ke=Mt.of([At.mutedColor,le.darker(1/3)],[At.neutralColor,ae.darker(1/3)],[At.backgroundColor,ge]),Oe=Mt.of([At.backgroundColor,ue],[At.borderColor,pe]),Ee=Mt.of([At.shadow,rt.create(0,2,4,0,z.black(.5))]),We=Mt.of([At.backgroundColor,ue.alpha(0)],[At.borderColor,pe.alpha(0)]),Ne=Mt.of([At.iconColor,z.black(.8)],[At.statusColor,z.black(.8)],[At.accentColor,z.black(.8)],[At.backgroundColor,z.black(.8)],[At.borderColor,z.black(.8)]),Be=Mt.of([At.iconColor,z.black(1)],[At.statusColor,z.black(1)],[At.accentColor,z.black(1)]),ze=Mt.of([At.iconColor,z.black(-1)],[At.statusColor,z.black(-1)],[At.accentColor,z.black(-1)]),Ue=Mt.of([At.iconColor,z.black(-1)],[At.statusColor,z.black(-1)],[At.accentColor,z.black(-1)]),He=Mt.of([At.iconColor,z.black(2)],[At.statusColor,z.black(2)],[At.accentColor,z.black(2)]),qe=Mt.of([At.backgroundColor,z.black(1/3)],[At.borderColor,z.black(1/3)]),Ge=Mt.of([At.statusColor,z.black(1)],[At.accentColor,z.black(1)],[At.backgroundColor,z.black(-2)]),je=Mt.of([At.timing,e.Easing.cubicOut.withDuration(350)]),Ye=zt.forCols([Rt.ambient,Ae],[Rt.default,xe],[Rt.primary,De],[Rt.secondary,Te],[Rt.unselected,Pe],[Rt.selected,Ve],[Rt.disabled,Ie],[Rt.inactive,Me],[Rt.warning,Re],[Rt.alert,Fe],[Rt.darker,Be],[Rt.lighter,ze],[Rt.contrasted,Ue],[Rt.raised,Le],[Rt.covered,ke],[Rt.opaque,Oe],[Rt.floating,Ee],[Rt.transparent,We],[Rt.translucent,Ne],[Rt.embossed,He],[Rt.nested,qe],[Rt.hovering,Ge],[Rt.navigating,je]);Bt.dark=Ye;const Xe=E.parse("14px -apple-system, system-ui, sans-serif"),Ke=z.parse("#4a4a4a"),Ze=z.parse("#4a4a4a"),_e=z.parse("#5c5d5e"),Qe=z.parse("#989898"),Je=z.parse("#808080"),$e=z.parse("#d7d6d5"),ti=z.parse("#e0dedc"),ei=z.black(.05),ii=z.parse("#f9f8f6"),ni=ii.darker(.5),si=z.parse("#f7f6f4"),oi=z.parse("#f1efed"),ri=z.parse("#4fcfb3"),li=z.parse("#008cc7"),ai=z.parse("#7b7c7d"),hi=z.parse("#7b7c7d"),di=z.parse("#e6de65"),ci=z.parse("#df4616"),ui=s.Length.px(10),pi=Mt.of([At.font,Xe],[At.color,Ke],[At.iconColor,Ze],[At.statusColor,Ke],[At.accentColor,_e],[At.mutedColor,Qe],[At.neutralColor,Je],[At.subduedColor,$e],[At.faintColor,ti],[At.highlightColor,ei],[At.backgroundColor,ii],[At.borderColor,ni],[At.spacing,ui],[At.timing,e.Easing.linear.withDuration(1e3)]),fi=Mt.of([At.font,Xe],[At.color,Ke],[At.iconColor,Ze],[At.statusColor,Ke],[At.accentColor,_e],[At.mutedColor,Qe],[At.neutralColor,Je],[At.subduedColor,$e],[At.faintColor,ti],[At.highlightColor,ei],[At.backgroundColor,ii],[At.borderColor,ni],[At.spacing,ui],[At.timing,e.Easing.cubicOut.withDuration(250)]),gi=Mt.of([At.accentColor,ri]),vi=Mt.of([At.accentColor,li]),yi=Mt.of([At.color,Qe],[At.iconColor,Qe],[At.backgroundColor,ii.darker(.5)]),wi=Mt.of([At.color,Ke],[At.iconColor,Ze],[At.backgroundColor,ii.darker(.5)]),mi=Mt.of([At.color,ai],[At.iconColor,ai],[At.statusColor,ai],[At.accentColor,ai]),bi=Mt.of([At.statusColor,hi],[At.accentColor,hi]),Ci=Mt.of([At.statusColor,di],[At.accentColor,di]),Si=Mt.of([At.statusColor,ci],[At.accentColor,ci]),Ai=Mt.of([At.mutedColor,Qe.darker(1/3)],[At.neutralColor,Je.darker(1/3)],[At.backgroundColor,si]),xi=Mt.of([At.mutedColor,Qe.darker(1/3)],[At.neutralColor,Je.darker(1/3)],[At.backgroundColor,oi]),Di=Mt.of([At.backgroundColor,ii],[At.borderColor,ni]),Ti=Mt.of([At.shadow,rt.create(0,2,4,0,z.black(.5))]),Pi=Mt.of([At.backgroundColor,ii.alpha(0)],[At.borderColor,ni.alpha(0)]),Vi=Mt.of([At.iconColor,z.black(.8)],[At.statusColor,z.black(.8)],[At.accentColor,z.black(.8)],[At.backgroundColor,z.black(.8)],[At.borderColor,z.black(.8)]),Ii=Mt.of([At.iconColor,z.black(1)],[At.statusColor,z.black(1)],[At.accentColor,z.black(1)]),Mi=Mt.of([At.iconColor,z.black(-1)],[At.statusColor,z.black(-1)],[At.accentColor,z.black(-1)]),Ri=Mt.of([At.iconColor,z.black(1)],[At.statusColor,z.black(1)],[At.accentColor,z.black(1)]),Fi=Mt.of([At.iconColor,z.black(1)],[At.statusColor,z.black(1)],[At.accentColor,z.black(1)]),Li=Mt.of([At.backgroundColor,z.black(1/24)],[At.borderColor,z.black(1/24)]),ki=Mt.of([At.statusColor,z.black(1/4)],[At.accentColor,z.black(1/4)],[At.backgroundColor,z.black(1/4)]),Oi=Mt.of([At.timing,e.Easing.cubicOut.withDuration(350)]),Ei=zt.forCols([Rt.ambient,pi],[Rt.default,fi],[Rt.primary,gi],[Rt.secondary,vi],[Rt.unselected,yi],[Rt.selected,wi],[Rt.disabled,mi],[Rt.inactive,bi],[Rt.warning,Ci],[Rt.alert,Si],[Rt.darker,Ii],[Rt.lighter,Mi],[Rt.contrasted,Ri],[Rt.raised,Ai],[Rt.covered,xi],[Rt.opaque,Di],[Rt.floating,Ti],[Rt.transparent,Pi],[Rt.translucent,Vi],[Rt.embossed,Fi],[Rt.nested,Li],[Rt.hovering,ki],[Rt.navigating,Oi]);Bt.light=Ei;const Wi=function(){const t={detect:function(){let t=0,e=0,i=0,n=0;const s=document.documentElement.style.width,o=document.documentElement.style.height;document.documentElement.style.width="100%",document.documentElement.style.height="100%";const r=document.createElement("div");r.style.setProperty("position","fixed"),r.style.setProperty("top","0"),r.style.setProperty("right","0"),r.style.setProperty("width",window.innerWidth===document.documentElement.offsetWidth?"100%":"100vw"),r.style.setProperty("height",window.innerHeight===document.documentElement.offsetHeight?"100%":"100vh"),r.style.setProperty("box-sizing","border-box"),r.style.setProperty("padding-top","env(safe-area-inset-top)"),r.style.setProperty("padding-right","env(safe-area-inset-right)"),r.style.setProperty("padding-bottom","env(safe-area-inset-bottom)"),r.style.setProperty("padding-left","env(safe-area-inset-left)"),r.style.setProperty("overflow","hidden"),r.style.setProperty("visibility","hidden"),document.body.appendChild(r);const l=window.getComputedStyle(r),a=parseFloat(l.getPropertyValue("width")),h=parseFloat(l.getPropertyValue("height"));let d=a,c=h,u=0,p=0,f=0,g=0,v=1;void 0!==window.visualViewport&&(d=window.visualViewport.width,c=window.visualViewport.height,u=window.visualViewport.offsetLeft,p=window.visualViewport.offsetTop,f=window.visualViewport.pageLeft,g=window.visualViewport.pageTop,v=window.visualViewport.scale);const y={width:d,height:c,offsetLeft:u,offsetTop:p,pageLeft:f,pageTop:g,scale:v};"undefined"!=typeof CSS&&"function"==typeof CSS.supports&&CSS.supports("padding-top: env(safe-area-inset-top)")&&(t=parseFloat(l.getPropertyValue("padding-top")),e=parseFloat(l.getPropertyValue("padding-right")),i=parseFloat(l.getPropertyValue("padding-bottom")),n=parseFloat(l.getPropertyValue("padding-left"))),document.body.removeChild(r),document.documentElement.style.width=s,document.documentElement.style.height=o;const w={insetTop:t,insetRight:e,insetBottom:i,insetLeft:n};let m,b=screen.msOrientation||screen.mozOrientation||(screen.orientation||{}).type;if(void 0===b)switch(window.orientation){case 0:b="portrait-primary";break;case 180:b="portrait-secondary";break;case-90:b="landscape-primary";break;case 90:b="landscape-secondary";break;default:b="landscape-primary"}return m=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":window.matchMedia("(prefers-color-scheme: light)").matches?"light":"no-preference",{width:a,height:h,visual:y,safeArea:w,orientation:b,colorScheme:m}}};return t}(),Ni=function(){const t={current:null,create:function(){const t=Wi.detect(),e=new s.R2Box(0,0,t.width,t.height);return{updateTime:performance.now(),viewportIdiom:"unspecified",viewport:t,viewFrame:e}}};return t}();class Bi extends e.Service{constructor(){super(),this.viewContext=Ni.create(),this.viewportResizeTimer=0,this.reorientationTimer=0,this.throttleScroll=this.throttleScroll.bind(this),this.throttleResize=this.throttleResize.bind(this),this.debounceViewportResize=this.debounceViewportResize.bind(this),this.throttleViewportResize=this.throttleViewportResize.bind(this),this.debounceReorientation=this.debounceReorientation.bind(this),this.throttleReorientation=this.throttleReorientation.bind(this)}get viewport(){return this.viewContext.viewport}get viewportIdiom(){return this.viewContext.viewportIdiom}detectViewportIdiom(t){return t.width<960||t.height<480?"mobile":"desktop"}updateViewportIdiom(t){let e;const i=this.observers;for(let n=0,s=i.length;n<s;n+=1){const s=i[n];if(void 0!==s.detectViewportIdiom&&(e=s.detectViewportIdiom(t,this),void 0!==e))break}void 0===e&&(e=this.detectViewportIdiom(t)),void 0!==e&&this.setViewportIdiom(e)}setViewportIdiom(t){const e=this.viewContext,i=e.viewportIdiom;i!==t&&(this.willSetViewportIdiom(t,i),e.viewportIdiom=t,this.onSetViewportIdiom(t,i),this.didSetViewportIdiom(t,i))}willSetViewportIdiom(t,e){const i=this.observers;for(let n=0,s=i.length;n<s;n+=1){const s=i[n];void 0!==s.serviceWillSetViewportIdiom&&s.serviceWillSetViewportIdiom(t,e,this)}}onSetViewportIdiom(t,e){const i=this.roots;for(let t=0,e=i.length;t<e;t+=1)i[t].requireUpdate(fn.NeedsLayout)}didSetViewportIdiom(t,e){const i=this.observers;for(let n=0,s=i.length;n<s;n+=1){const s=i[n];void 0!==s.serviceDidSetViewportIdiom&&s.serviceDidSetViewportIdiom(t,e,this)}}willReorient(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.serviceWillReorient&&n.serviceWillReorient(t,this)}}onReorient(t){}didReorient(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.serviceDidReorient&&n.serviceDidReorient(t,this)}}onObserve(t){super.onObserve(t),this.attached&&this.updateViewportIdiom(this.viewport)}onAttach(){super.onAttach(),this.attachEvents(),this.updateViewportIdiom(this.viewport)}onDetach(){this.detachEvents(),super.onDetach()}attachEvents(){"undefined"!=typeof window&&(window.addEventListener("scroll",this.throttleScroll,{passive:!0}),window.addEventListener("resize",this.throttleResize),window.addEventListener("orientationchange",this.debounceReorientation),void 0!==window.visualViewport&&window.visualViewport.addEventListener("resize",this.debounceViewportResize))}detachEvents(){"undefined"!=typeof window&&(window.removeEventListener("scroll",this.throttleScroll),window.removeEventListener("resize",this.throttleResize),window.removeEventListener("orientationchange",this.debounceReorientation),void 0!==window.visualViewport&&window.visualViewport.removeEventListener("resize",this.debounceViewportResize))}throttleScroll(){const t=this.roots;for(let e=0,i=t.length;e<i;e+=1)t[e].requireUpdate(fn.NeedsScroll)}throttleResize(){const t=Wi.detect(),e=new s.R2Box(0,0,t.width,t.height);this.viewContext.viewport=t,this.viewContext.viewFrame=e,this.updateViewportIdiom(t);const i=this.roots;for(let t=0,e=i.length;t<e;t+=1)i[t].requireUpdate(fn.NeedsResize|fn.NeedsLayout)}debounceViewportResize(){0!==this.viewportResizeTimer&&(clearTimeout(this.viewportResizeTimer),this.viewportResizeTimer=0),this.viewportResizeTimer=setTimeout(this.throttleViewportResize,Bi.ViewportResizeDelay)}throttleViewportResize(){0!==this.viewportResizeTimer&&(clearTimeout(this.viewportResizeTimer),this.viewportResizeTimer=0);const t=Wi.detect(),e=new s.R2Box(0,0,t.width,t.height);this.viewContext.viewport=t,this.viewContext.viewFrame=e,this.updateViewportIdiom(t);const i=this.roots;for(let t=0,e=i.length;t<e;t+=1)i[t].requireUpdate(fn.NeedsResize|fn.NeedsScroll|fn.NeedsLayout)}debounceReorientation(){0!==this.reorientationTimer&&(clearTimeout(this.reorientationTimer),this.reorientationTimer=0),this.reorientationTimer=setTimeout(this.throttleReorientation,Bi.ReorientationDelay)}throttleReorientation(){0!==this.reorientationTimer&&(clearTimeout(this.reorientationTimer),this.reorientationTimer=0);const t=Wi.detect(),e=new s.R2Box(0,0,t.width,t.height);this.viewContext.viewport=t,this.viewContext.viewFrame=e,this.willReorient(t.orientation),this.updateViewportIdiom(t),this.onReorient(t.orientation),this.didReorient(t.orientation);const i=this.roots;for(let t=0,e=i.length;t<e;t+=1)i[t].requireUpdate(fn.NeedsResize|fn.NeedsScroll|fn.NeedsLayout)}static global(){return new Bi}}Bi.ViewportResizeDelay=200,Bi.ReorientationDelay=100,u([e.Lazy],Bi,"global",null);const zi=function(t){const e=t.extend("ViewportProvider");return Object.defineProperty(e.prototype,"viewContext",{get(){let t=this.service;return null==t&&(t=Bi.global()),t.viewContext},configurable:!0}),Object.defineProperty(e.prototype,"viewport",{get(){let t=this.service;return null==t&&(t=Bi.global()),t.viewport},configurable:!0}),Object.defineProperty(e.prototype,"viewportIdiom",{get(){let t=this.service;return null==t&&(t=Bi.global()),t.viewportIdiom},configurable:!0}),e.prototype.setViewportIdiom=function(t){let e=this.service;null==e&&(e=Bi.global()),e.setViewportIdiom(t)},e.prototype.createService=function(){return Bi.global()},e}(i.Provider);class Ui extends e.Service{constructor(){super(),this.flags=0,this.updateDelay=Ui.MinUpdateDelay,this.processTimer=0,this.displayFrame=0,this.runProcessPass=this.runProcessPass.bind(this),this.runDisplayPass=this.runDisplayPass.bind(this),this.onVisibilityChange=this.onVisibilityChange.bind(this)}setFlags(t){this.flags=t}updatedViewContext(t){return t.updateTime=performance.now(),t}needsUpdate(t,e){return t}requestUpdate(t,e,i){e=this.needsUpdate(e,i);let n=this.flags&~e&fn.UpdateMask;0!=(e&fn.ProcessMask)&&(n|=fn.NeedsProcess),0!=(e&fn.DisplayMask)&&(n|=fn.NeedsDisplay),this.setFlags(this.flags|n),i&&0==(this.flags&fn.TraversingFlag)&&this.updateDelay<=Ui.MaxProcessInterval?this.runImmediatePass():this.scheduleUpdate()}scheduleUpdate(){const t=this.flags;0==(t&fn.ProcessingFlag)&&0!=(t&fn.ProcessMask)?this.scheduleProcessPass(this.updateDelay):0==(t&fn.DisplayingFlag)&&0!=(t&fn.DisplayMask)&&this.scheduleDisplayPass()}cancelUpdate(){this.cancelProcessPass(),this.cancelDisplayPass()}runImmediatePass(){0!=(this.flags&fn.ProcessMask)&&(this.cancelUpdate(),this.runProcessPass(!0)),0!=(this.flags&fn.DisplayMask)&&this.updateDelay<=Ui.MaxProcessInterval&&(this.cancelUpdate(),this.runDisplayPass(void 0,!0))}scheduleProcessPass(t){0===this.processTimer&&(this.processTimer=setTimeout(this.runProcessPass,t))}cancelProcessPass(){0!==this.processTimer&&(clearTimeout(this.processTimer),this.processTimer=0)}runProcessPass(t=!1){this.setFlags(this.flags&~fn.ProcessMask|fn.TraversingFlag|fn.ProcessingFlag);try{const e=performance.now(),i=this.roots;for(let t=0;t<i.length;t+=1){const n=i[t];if(0!=(n.flags&fn.ProcessMask)){const t=n.viewportProvider.viewContext;t.updateTime=e,n.cascadeProcess(0,t)}}const n=performance.now();let s=Math.max(Ui.MinProcessInterval,this.updateDelay);this.updateDelay=n-e>s?Math.min(Math.max(2,2*this.updateDelay),Ui.MaxUpdateDelay):Math.min(Ui.MinUpdateDelay,this.updateDelay/2),this.cancelProcessPass(),0!=(this.flags&fn.DisplayMask)?this.scheduleDisplayPass():0!=(this.flags&fn.ProcessMask)&&(t&&(s=Math.max(Ui.MaxProcessInterval,s)),this.cancelDisplayPass(),this.scheduleProcessPass(s))}finally{this.setFlags(this.flags&~(fn.TraversingFlag|fn.ProcessingFlag))}}scheduleDisplayPass(){0===this.displayFrame&&(this.displayFrame=requestAnimationFrame(this.runDisplayPass))}cancelDisplayPass(){0!==this.displayFrame&&(cancelAnimationFrame(this.displayFrame),this.displayFrame=0)}runDisplayPass(t,e=!1){this.setFlags(this.flags&~fn.DisplayMask|fn.TraversingFlag|fn.DisplayingFlag);try{void 0===t&&(t=performance.now());const i=this.roots;for(let e=0;e<i.length;e+=1){const n=i[e];if(0!=(n.flags&fn.DisplayMask)){const e=n.viewportProvider.viewContext;e.updateTime=t,n.cascadeDisplay(0,e)}}if(this.cancelDisplayPass(),0!=(this.flags&fn.ProcessMask)){let t=this.updateDelay;e&&(t=Math.max(Ui.MaxProcessInterval,t)),this.scheduleProcessPass(t)}else 0!=(this.flags&fn.DisplayMask)&&(this.cancelProcessPass(),this.scheduleDisplayPass())}finally{this.setFlags(this.flags&~(fn.TraversingFlag|fn.DisplayingFlag))}}get powerFlags(){return fn.NeedsResize|fn.NeedsScroll}power(){const t=this.roots;for(let e=0,i=t.length;e<i;e+=1){t[e].requireUpdate(this.powerFlags)}}unpower(){this.cancelUpdate(),this.updateDelay=Ui.MinUpdateDelay}onAttachRoot(t){super.onAttachRoot(t),this.requestUpdate(t,t.flags&fn.UpdateMask,!1)}onAttach(){super.onAttach(),this.attachEvents()}onDetach(){this.detachEvents(),super.onDetach()}attachEvents(){"undefined"!=typeof document&&document.addEventListener("visibilitychange",this.onVisibilityChange)}detachEvents(){"undefined"!=typeof document&&document.removeEventListener("visibilitychange",this.onVisibilityChange)}onVisibilityChange(){"visible"===document.visibilityState?this.power():this.unpower()}static global(){return new Ui}}Ui.MinUpdateDelay=0,Ui.MaxUpdateDelay=167,Ui.MinProcessInterval=12,Ui.MaxProcessInterval=33,u([e.Lazy],Ui,"global",null);const Hi=function(t){const e=t.extend("DisplayProvider");return e.prototype.updatedViewContext=function(t){let e=this.service;return null==e&&(e=Ui.global()),e.updatedViewContext(t)},e.prototype.requestUpdate=function(t,e,i){let n=this.service;null==n&&(n=Ui.global()),n.requestUpdate(t,e,i)},e.prototype.createService=function(){return Ui.global()},e}(i.Provider);class qi extends e.Service{constructor(){super(),this.solver=this.createSolver()}createSolver(){return new a.ConstraintSolver}activateConstraint(t){this.solver.addConstraint(t)}deactivateConstraint(t){this.solver.removeConstraint(t)}activateConstraintVariable(t){this.solver.addConstraintVariable(t)}deactivateConstraintVariable(t){this.solver.removeConstraintVariable(t)}setConstraintVariable(t,e){this.solver.setConstraintVariable(t,e)}static global(){return new qi}}u([e.Lazy],qi,"global",null);const Gi=function(t){const e=t.extend("LayoutProvider");return e.prototype.createService=function(){return qi.global()},e}(i.Provider);class ji extends e.Service{constructor(){super(),this.mood=this.initMood(),this.theme=this.initTheme()}initMood(){return Et.default}setMood(t){this.mood=t,this.applyTheme(this.theme,t);const e=this.roots;for(let n=0,s=e.length;n<s;n+=1){const s=e[n];s.mood.hasAffinity(i.Affinity.Intrinsic)&&(s.mood.setState(t,i.Affinity.Intrinsic),s.requireUpdate(fn.NeedsChange))}}initTheme(){return"dark"===Wi.detect().colorScheme?Bt.dark:Bt.light}setTheme(t){this.theme=t,this.applyTheme(t,this.mood);const e=this.roots;for(let n=0,s=e.length;n<s;n+=1){const s=e[n];s.theme.hasAffinity(i.Affinity.Intrinsic)&&(s.theme.setState(t,i.Affinity.Intrinsic),s.requireUpdate(fn.NeedsChange))}}applyTheme(t,i,n){n=void 0===n||!0===n?t.getOr(At.timing,Et.ambient,!1):e.Timing.fromAny(n),this.willApplyTheme(t,i,n),this.onApplyTheme(t,i,n),this.didApplyTheme(t,i,n)}willApplyTheme(t,e,i){const n=this.observers;for(let s=0,o=n.length;s<o;s+=1){const o=n[s];void 0!==o.serviceWillApplyTheme&&o.serviceWillApplyTheme(t,e,i,this)}}onApplyTheme(t,e,i){}didApplyTheme(t,e,i){const n=this.observers;for(let s=0,o=n.length;s<o;s+=1){const o=n[s];void 0!==o.serviceDidApplyTheme&&o.serviceDidApplyTheme(t,e,i,this)}}static global(){return new ji}}u([e.Lazy],ji,"global",null);const Yi=function(t){const e=t.extend("ThemeProvider");return Object.defineProperty(e.prototype,"mood",{get(){let t=this.service;return null==t&&(t=ji.global()),t.mood},configurable:!0}),e.prototype.setMood=function(t){let e=this.service;null==e&&(e=ji.global()),e.setMood(t)},Object.defineProperty(e.prototype,"theme",{get(){let t=this.service;return null==t&&(t=ji.global()),t.theme},configurable:!0}),e.prototype.setTheme=function(t){let e=this.service;null==e&&(e=ji.global()),e.setTheme(t)},e.prototype.createService=function(){return ji.global()},e}(i.Provider),Xi=function(){const t={is:function(t){if("object"==typeof t&&null!==t){const e=t;return"modalView"in e&&"modalState"in e&&"modality"in e&&"function"==typeof e.showModal&&"function"==typeof e.hideModal}return!1}};return t}();class Ki extends e.Service{constructor(){super(),this.modals=e.Arrays.empty,this.modality=0,this.matteView=null,this.onClick=this.onClick.bind(this)}isModal(){return 0!==this.modality}setMatteView(t){this.matteView=t}insertModalView(t){const e=this.matteView;if(null!==e)e.appendChild(t);else{this.constructor.insertModalView(t)}}presentModal(t,i={}){const n=this.modals,s=e.Arrays.inserted(t,n);if(n!==s){i.multi||this.dismissModals(),this.willPresentModal(t,i),this.modals=s;const e=t.modalView;null===e||e.mounted||this.insertModalView(e),t.showModal(i,!0),this.onPresentModal(t,i),this.updateModality(),this.didPresentModal(t,i)}}willPresentModal(t,e){const i=this.observers;for(let n=0,s=i.length;n<s;n+=1){const s=i[n];void 0!==s.serviceWillPresentModal&&s.serviceWillPresentModal(t,e,this)}}onPresentModal(t,e){}didPresentModal(t,e){const i=this.observers;for(let n=0,s=i.length;n<s;n+=1){const s=i[n];void 0!==s.serviceDidPresentModal&&s.serviceDidPresentModal(t,e,this)}}dismissModal(t){const i=this.modals,n=e.Arrays.removed(t,i);i!==n&&(this.willDismissModal(t),this.modals=n,t.hideModal(!0),this.onDismissModal(t),this.updateModality(),this.didDismissModal(t))}willDismissModal(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.serviceWillDismissModal&&n.serviceWillDismissModal(t,this)}}onDismissModal(t){}didDismissModal(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.serviceDidDismissModal&&n.serviceDidDismissModal(t,this)}}dismissModals(){for(let t=0,e=this.modals.length;t<e;t+=1)this.dismissModal(this.modals[t])}toggleModal(t,e){const i=t.modalState;"hidden"===i||"hiding"===i?this.presentModal(t,e):"shown"!==i&&"showing"!==i||this.dismissModal(t)}updateModality(){const t=this.modality;let e=0;const i=this.modals;for(let t=0,n=i.length;t<n;t+=1){const n=+i[t].modality;e=Math.min(Math.max(e,n),1)}t!==e&&(this.willUpdateModality(e,t),this.modality=e,this.onUpdateModality(e,t),this.didUpdateModality(e,t))}willUpdateModality(t,e){const i=this.observers;for(let n=0,s=i.length;n<s;n+=1){const s=i[n];void 0!==s.serviceWillUpdateModality&&s.serviceWillUpdateModality(t,e,this)}}onUpdateModality(t,e){}didUpdateModality(t,e){const i=this.observers;for(let n=0,s=i.length;n<s;n+=1){const s=i[n];void 0!==s.serviceDidUpdateModality&&s.serviceDidUpdateModality(t,e,this)}}displaceModals(t){this.willDisplaceModals(t)||(this.onDisplaceModals(t),this.didDisplaceModals(t))}willDisplaceModals(t){let e;const i=this.observers;for(let n=0,s=i.length;n<s;n+=1){const s=i[n];void 0!==s.serviceWillDisplaceModals&&(e=s.serviceWillDisplaceModals(t,this))}return void 0!==e&&e}onDisplaceModals(t){const e=this.modals;let i=0;for(;i<e.length;){const t=e[i];"shown"===t.modalState?this.dismissModal(t):i+=1}}didDisplaceModals(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.serviceDidDisplaceModals&&n.serviceDidDisplaceModals(t,this)}}onAttachRoot(t){super.onAttachRoot(t),this.attachEvents(t)}onDetachRoot(t){super.onDetachRoot(t),this.detachEvents(t)}attachEvents(t){t.on("click",this.onClick)}detachEvents(t){t.off("click",this.onClick)}onClick(t){this.displaceModals(t)}static insertModalView(t){throw new TypeError(""+t)}static global(){return new Ki}}u([e.Lazy],Ki,"global",null);const Zi=function(t){const e=t.extend("ModalProvider");return e.prototype.presentModal=function(t,e){let i=this.service;null==i&&(i=Ki.global()),i.presentModal(t,e)},e.prototype.dismissModal=function(t){let e=this.service;null==e&&(e=Ki.global()),e.dismissModal(t)},e.prototype.dismissModals=function(){let t=this.service;null==t&&(t=Ki.global()),t.dismissModals()},e.prototype.toggleModal=function(t,e){let i=this.service;null==i&&(i=Ki.global()),i.toggleModal(t,e)},e.prototype.updateModality=function(){let t=this.service;null==t&&(t=Ki.global()),t.updateModality()},e.prototype.displaceModals=function(t){let e=this.service;null==e&&(e=Ki.global()),e.displaceModals(t)},e.prototype.createService=function(){return Ki.global()},e}(i.Provider);class _i{constructor(t,e,i,n,s,o){this.inputId=t,this.inputType=e,this.isPrimary=i,this.target=null,this.button=0,this.buttons=0,this.altKey=!1,this.ctrlKey=!1,this.metaKey=!1,this.shiftKey=!1,this.width=0,this.height=0,this.tiltX=0,this.tiltY=0,this.twist=0,this.pressure=0,this.tangentialPressure=0,this.x0=n,this.y0=s,this.t0=o,this.dx=0,this.dy=0,this.dt=0,this.x=n,this.y=s,this.t=o,this.detail=void 0,this.defaultPrevented=!1}preventDefault(){this.defaultPrevented=!0}static pointerInputType(t){return"mouse"===t||"touch"===t||"pen"===t?t:"unknown"}}const Qi=function(t){const e=t.extend("Gesture");return Object.defineProperty(e.prototype,"familyType",{get:function(){return e},configurable:!0}),e.prototype.getView=function(){const t=this.view;if(null===t)throw new TypeError("null "+this.name+" view");return t},e.prototype.setView=function(t,e){const i=this.view;return i!==t&&(null!==i&&(this.willDetachView(i),this.view=null,this.onDetachView(i),this.didDetachView(i)),null!==t&&(void 0===e&&(e=null),this.willAttachView(t,e),this.view=t,this.onAttachView(t,e),this.didAttachView(t,e))),i},e.prototype.willAttachView=function(t,e){},e.prototype.onAttachView=function(t,e){this.attachEvents(t),!0===this.observes&&t.observe(this)},e.prototype.didAttachView=function(t,e){},e.prototype.willDetachView=function(t){},e.prototype.onDetachView=function(t){this.clearInputs(),!0===this.observes&&t.unobserve(this),this.detachEvents(t)},e.prototype.didDetachView=function(t){},e.prototype.attachEvents=function(t){},e.prototype.detachEvents=function(t){},e.prototype.getInput=function(t){"number"==typeof t&&(t=""+t);const e=this.inputs[t];return void 0!==e?e:null},e.prototype.createInput=function(t,e,i,n,s,o){return new _i(t,e,i,n,s,o)},e.prototype.getOrCreateInput=function(t,e,i,n,s,o){"number"==typeof t&&(t=""+t);const r=this.inputs;let l=r[t];return void 0===l&&(l=this.createInput(t,e,i,n,s,o),r[t]=l,this.inputCount+=1),l},e.prototype.clearInput=function(t){delete this.inputs[t.inputId],this.inputCount-=1},e.prototype.clearInputs=function(){this.inputs={},this.inputCount=0},e.prototype.bindView=function(t,e){if(this.binds&&null===this.view){const i=this.detectView(t);null!==i&&this.setView(i,e)}},e.prototype.unbindView=function(t){this.binds&&this.view===t&&this.setView(null)},e.prototype.detectView=function(t){return void 0!==this.key&&this.key===t.key?t:null},e.prototype.viewWillUnmount=function(t){this.clearInputs()},e.prototype.onMount=function(){t.prototype.onMount.call(this),!0===this.self&&this.owner instanceof fn&&this.setView(this.owner)},Object.defineProperty(e.prototype,"lazy",{get:function(){return!1},configurable:!0}),Object.defineProperty(e.prototype,"static",{get:function(){return!0},configurable:!0}),e.construct=function(e,i,n){return null===i&&(delete(i=function(t,e){return void 0===t?i.view:(i.setView(t,e),i.owner)}).name,Object.setPrototypeOf(i,e.prototype)),(i=t.construct(e,i,n)).view=null,i.inputs={},i.inputCount=0,i},e.specialize=function(t){return null},e.define=function(t,i){let n=i.extends;const s=i.affinity,o=i.inherits;let r=i.method;delete i.extends,delete i.affinity,delete i.inherits,delete i.method,!0===i.key?Object.defineProperty(i,"key",{value:t,configurable:!0}):!1===i.key&&Object.defineProperty(i,"key",{value:void 0,configurable:!0}),void 0===r&&(r="auto"),null==n&&(n=e.specialize(r)),null===n&&(n=this);const l=n.extend(t,i);return l.construct=function(t,e,i){return e=n.construct(t,e,i),void 0!==s&&e.initAffinity(s),void 0!==o&&e.initInherits(o),e},l},e}(i.Fastener);class Ji extends _i{constructor(t,e,i,n,s,o){super(t,e,i,n,s,o),this.hovering=!1,this.pressing=!1,this.holdTimer=0,this.holdDelay=400}isRunaway(){const t=this.x-this.x0,e=this.y-this.y0,i=this.t-this.t0;return"mouse"!==this.inputType&&i<100&&t*t+e*e>100}setHoldTimer(t){0!==this.holdDelay&&(this.clearHoldTimer(),this.holdTimer=setTimeout(t,this.holdDelay))}clearHoldTimer(){0!==this.holdTimer&&(clearTimeout(this.holdTimer),this.holdTimer=0)}}const $i=function(t){const e=t.extend("PositionGesture");return e.prototype.attachEvents=function(t){Qi.prototype.attachEvents.call(this,t),this.attachHoverEvents(t)},e.prototype.detachEvents=function(t){this.detachPressEvents(t),this.detachHoverEvents(t),Qi.prototype.detachEvents.call(this,t)},e.prototype.attachHoverEvents=function(t){},e.prototype.detachHoverEvents=function(t){},e.prototype.attachPressEvents=function(t){},e.prototype.detachPressEvents=function(t){},e.prototype.createInput=function(t,e,i,n,s,o){return new Ji(t,e,i,n,s,o)},e.prototype.clearInput=function(t){t.hovering||t.pressing||Qi.prototype.clearInput.call(this,t)},e.prototype.clearInputs=function(){Qi.prototype.clearInputs.call(this),this.hoverCount=0,this.pressCount=0},Object.defineProperty(e.prototype,"hovering",{get(){return 0!==this.hoverCount},configurable:!0}),e.prototype.startHovering=function(){this.willStartHovering(),this.onStartHovering(),this.didStartHovering()},e.prototype.willStartHovering=function(){},e.prototype.onStartHovering=function(){},e.prototype.didStartHovering=function(){},e.prototype.stopHovering=function(){this.willStopHovering(),this.onStopHovering(),this.didStopHovering()},e.prototype.willStopHovering=function(){},e.prototype.onStopHovering=function(){},e.prototype.didStopHovering=function(){},e.prototype.beginHover=function(t,e){t.hovering||(this.willBeginHover(t,e),t.hovering=!0,this.hoverCount+=1,this.onBeginHover(t,e),this.didBeginHover(t,e),1===this.hoverCount&&this.startHovering())},e.prototype.willBeginHover=function(t,e){},e.prototype.onBeginHover=function(t,e){},e.prototype.didBeginHover=function(t,e){},e.prototype.endHover=function(t,e){t.hovering&&(this.willEndHover(t,e),t.hovering=!1,this.hoverCount-=1,this.onEndHover(t,e),this.didEndHover(t,e),0===this.hoverCount&&this.stopHovering(),this.clearInput(t))},e.prototype.willEndHover=function(t,e){},e.prototype.onEndHover=function(t,e){},e.prototype.didEndHover=function(t,e){},Object.defineProperty(e.prototype,"pressing",{get(){return 0!==this.pressCount},configurable:!0}),e.prototype.startPressing=function(){this.willStartPressing(),this.onStartPressing(),this.didStartPressing()},e.prototype.willStartPressing=function(){},e.prototype.onStartPressing=function(){this.attachPressEvents(this.view)},e.prototype.didStartPressing=function(){},e.prototype.stopPressing=function(){this.willStopPressing(),this.onStopPressing(),this.didStopPressing()},e.prototype.willStopPressing=function(){},e.prototype.onStopPressing=function(){this.detachPressEvents(this.view)},e.prototype.didStopPressing=function(){},e.prototype.beginPress=function(t,e){if(!t.pressing){let i=this.willBeginPress(t,e);void 0===i&&(i=!0),i&&(t.pressing=!0,t.defaultPrevented=!1,this.pressCount+=1,this.onBeginPress(t,e),t.setHoldTimer(this.longPress.bind(this,t)),this.didBeginPress(t,e),1===this.pressCount&&this.startPressing())}},e.prototype.willBeginPress=function(t,e){},e.prototype.onBeginPress=function(t,e){t.x0=t.x,t.y0=t.y,t.t0=t.t,t.dx=0,t.dy=0,t.dt=0},e.prototype.didBeginPress=function(t,e){},e.prototype.movePress=function(t,e){t.pressing&&(this.willMovePress(t,e),this.onMovePress(t,e),this.didMovePress(t,e))},e.prototype.willMovePress=function(t,e){},e.prototype.onMovePress=function(t,e){},e.prototype.didMovePress=function(t,e){},e.prototype.endPress=function(t,e){t.clearHoldTimer(),t.pressing&&(this.willEndPress(t,e),t.pressing=!1,this.pressCount-=1,this.onEndPress(t,e),this.didEndPress(t,e),0===this.pressCount&&this.stopPressing(),this.clearInput(t))},e.prototype.willEndPress=function(t,e){},e.prototype.onEndPress=function(t,e){},e.prototype.didEndPress=function(t,e){},e.prototype.cancelPress=function(t,e){t.clearHoldTimer(),t.pressing&&(this.willCancelPress(t,e),t.pressing=!1,this.pressCount-=1,this.onCancelPress(t,e),this.didCancelPress(t,e),0===this.pressCount&&this.stopPressing(),this.clearInput(t))},e.prototype.willCancelPress=function(t,e){},e.prototype.onCancelPress=function(t,e){},e.prototype.didCancelPress=function(t,e){},e.prototype.press=function(t,e){this.willPress(t,e),this.onPress(t,e),this.didPress(t,e)},e.prototype.willPress=function(t,e){},e.prototype.onPress=function(t,e){},e.prototype.didPress=function(t,e){},e.prototype.longPress=function(t){t.clearHoldTimer();performance.now()-t.t0<1.5*t.holdDelay&&t.pressing&&(this.willLongPress(t),this.onLongPress(t),this.didLongPress(t))},e.prototype.willLongPress=function(t){},e.prototype.onLongPress=function(t){const e=performance.now();t.dt=e-t.t,t.t=e},e.prototype.didLongPress=function(t){},e.construct=function(e,i,n){return(i=t.construct(e,i,n)).hoverCount=0,i.pressCount=0,i},e.specialize=function(t){return"pointer"===t?tn:"touch"===t?en:"mouse"===t?nn:"undefined"!=typeof PointerEvent?tn:"undefined"!=typeof TouchEvent?en:nn},e.define=function(t,i){let n=i.extends;const s=i.affinity,o=i.inherits;let r=i.method;delete i.extends,delete i.affinity,delete i.inherits,delete i.method,!0===i.key?Object.defineProperty(i,"key",{value:t,configurable:!0}):!1===i.key&&Object.defineProperty(i,"key",{value:void 0,configurable:!0}),void 0===r&&(r="auto"),null==n&&(n=e.specialize(r)),null===n&&(n=this);const l=n.extend(t,i);return l.construct=function(t,e,i){return e=n.construct(t,e,i),void 0!==s&&e.initAffinity(s),void 0!==o&&e.initInherits(o),e},l},e}(Qi),tn=function(t){const e=t.extend("PointerPositionGesture");return e.prototype.attachHoverEvents=function(t){t.on("pointerenter",this.onPointerEnter),t.on("pointerleave",this.onPointerLeave),t.on("pointerdown",this.onPointerDown)},e.prototype.detachHoverEvents=function(t){t.off("pointerenter",this.onPointerEnter),t.off("pointerleave",this.onPointerLeave),t.off("pointerdown",this.onPointerDown)},e.prototype.attachPressEvents=function(t){document.body.addEventListener("pointermove",this.onPointerMove),document.body.addEventListener("pointerup",this.onPointerUp),document.body.addEventListener("pointercancel",this.onPointerCancel),document.body.addEventListener("pointerleave",this.onPointerLeaveDocument)},e.prototype.detachPressEvents=function(t){document.body.removeEventListener("pointermove",this.onPointerMove),document.body.removeEventListener("pointerup",this.onPointerUp),document.body.removeEventListener("pointercancel",this.onPointerCancel),document.body.removeEventListener("pointerleave",this.onPointerLeaveDocument)},e.prototype.updateInput=function(t,e){t.target=e.target,t.button=e.button,t.buttons=e.buttons,t.altKey=e.altKey,t.ctrlKey=e.ctrlKey,t.metaKey=e.metaKey,t.shiftKey=e.shiftKey,t.dx=e.clientX-t.x,t.dy=e.clientY-t.y,t.dt=e.timeStamp-t.t,t.x=e.clientX,t.y=e.clientY,t.t=e.timeStamp,t.width=e.width,t.height=e.height,t.tiltX=e.tiltX,t.tiltY=e.tiltY,t.twist=e.twist,t.pressure=e.pressure,t.tangentialPressure=e.tangentialPressure},e.prototype.onPointerEnter=function(t){if("mouse"===t.pointerType&&0===t.buttons){const e=this.getOrCreateInput(t.pointerId,_i.pointerInputType(t.pointerType),t.isPrimary,t.clientX,t.clientY,t.timeStamp);this.updateInput(e,t),e.hovering||this.beginHover(e,t)}},e.prototype.onPointerLeave=function(t){if("mouse"===t.pointerType){const e=this.getInput(t.pointerId);null!==e&&(this.updateInput(e,t),this.endHover(e,t))}},e.prototype.onPointerDown=function(t){const e=this.getOrCreateInput(t.pointerId,_i.pointerInputType(t.pointerType),t.isPrimary,t.clientX,t.clientY,t.timeStamp);this.updateInput(e,t),e.pressing||this.beginPress(e,t),"mouse"===t.pointerType&&0!==t.button&&this.cancelPress(e,t)},e.prototype.onPointerMove=function(t){const e=this.getInput(t.pointerId);null!==e&&(this.updateInput(e,t),this.movePress(e,t))},e.prototype.onPointerUp=function(t){const e=this.getInput(t.pointerId);null!==e&&(this.updateInput(e,t),this.endPress(e,t),e.defaultPrevented||0!==t.button||this.press(e,t))},e.prototype.onPointerCancel=function(t){const e=this.getInput(t.pointerId);null!==e&&(this.updateInput(e,t),this.cancelPress(e,t))},e.prototype.onPointerLeaveDocument=function(t){const e=this.getInput(t.pointerId);null!==e&&(this.updateInput(e,t),this.cancelPress(e,t),this.endHover(e,t))},e.construct=function(e,i,n){return(i=t.construct(e,i,n)).onPointerEnter=i.onPointerEnter.bind(i),i.onPointerLeave=i.onPointerLeave.bind(i),i.onPointerDown=i.onPointerDown.bind(i),i.onPointerMove=i.onPointerMove.bind(i),i.onPointerUp=i.onPointerUp.bind(i),i.onPointerCancel=i.onPointerCancel.bind(i),i.onPointerLeaveDocument=i.onPointerLeaveDocument.bind(i),i},e}($i),en=function(t){const e=t.extend("TouchPositionGesture");return e.prototype.attachHoverEvents=function(t){t.on("touchstart",this.onTouchStart)},e.prototype.detachHoverEvents=function(t){t.off("touchstart",this.onTouchStart)},e.prototype.attachPressEvents=function(t){t.on("touchmove",this.onTouchMove),t.on("touchend",this.onTouchEnd),t.on("touchcancel",this.onTouchCancel)},e.prototype.detachPressEvents=function(t){t.off("touchmove",this.onTouchMove),t.off("touchend",this.onTouchEnd),t.off("touchcancel",this.onTouchCancel)},e.prototype.updateInput=function(t,e,i){t.target=i.target,t.altKey=e.altKey,t.ctrlKey=e.ctrlKey,t.metaKey=e.metaKey,t.shiftKey=e.shiftKey,t.dx=i.clientX-t.x,t.dy=i.clientY-t.y,t.dt=e.timeStamp-t.t,t.x=i.clientX,t.y=i.clientY,t.t=e.timeStamp},e.prototype.onTouchStart=function(t){const e=t.targetTouches;for(let i=0;i<e.length;i+=1){const n=e[i],s=this.getOrCreateInput(n.identifier,"touch",!1,n.clientX,n.clientY,t.timeStamp);this.updateInput(s,t,n),s.pressing||this.beginPress(s,t)}},e.prototype.onTouchMove=function(t){const e=t.changedTouches;for(let i=0;i<e.length;i+=1){const n=e[i],s=this.getInput(n.identifier);null!==s&&(this.updateInput(s,t,n),this.movePress(s,t))}},e.prototype.onTouchEnd=function(t){const e=t.changedTouches;for(let i=0;i<e.length;i+=1){const n=e[i],s=this.getInput(n.identifier);null!==s&&(this.updateInput(s,t,n),this.endPress(s,t),s.defaultPrevented||this.press(s,t),this.endHover(s,t))}},e.prototype.onTouchCancel=function(t){const e=t.changedTouches;for(let i=0;i<e.length;i+=1){const n=e[i],s=this.getInput(n.identifier);null!==s&&(this.updateInput(s,t,n),this.cancelPress(s,t),this.endHover(s,t))}},e.construct=function(e,i,n){return(i=t.construct(e,i,n)).onTouchStart=i.onTouchStart.bind(i),i.onTouchMove=i.onTouchMove.bind(i),i.onTouchEnd=i.onTouchEnd.bind(i),i.onTouchCancel=i.onTouchCancel.bind(i),i},e}($i),nn=function(t){const e=t.extend("MousePositionGesture");return e.prototype.attachHoverEvents=function(t){t.on("mouseenter",this.onMouseEnter),t.on("mouseleave",this.onMouseLeave),t.on("mousedown",this.onMouseDown)},e.prototype.detachHoverEvents=function(t){t.off("mouseenter",this.onMouseEnter),t.off("mouseleave",this.onMouseLeave),t.off("mousedown",this.onMouseDown)},e.prototype.attachPressEvents=function(t){document.body.addEventListener("mousemove",this.onMouseMove),document.body.addEventListener("mouseup",this.onMouseUp),document.body.addEventListener("mouseleave",this.onMouseLeaveDocument)},e.prototype.detachPressEvents=function(t){document.body.removeEventListener("mousemove",this.onMouseMove),document.body.removeEventListener("mouseup",this.onMouseUp),document.body.removeEventListener("mouseleave",this.onMouseLeaveDocument)},e.prototype.updateInput=function(t,e){t.target=e.target,t.button=e.button,t.buttons=e.buttons,t.altKey=e.altKey,t.ctrlKey=e.ctrlKey,t.metaKey=e.metaKey,t.shiftKey=e.shiftKey,t.dx=e.clientX-t.x,t.dy=e.clientY-t.y,t.dt=e.timeStamp-t.y,t.x=e.clientX,t.y=e.clientY,t.t=e.timeStamp},e.prototype.onMouseEnter=function(t){if(0===t.buttons){const e=this.getOrCreateInput("mouse","mouse",!0,t.clientX,t.clientY,t.timeStamp);this.updateInput(e,t),e.hovering||this.beginHover(e,t)}},e.prototype.onMouseLeave=function(t){const e=this.getInput("mouse");null!==e&&(this.updateInput(e,t),this.endHover(e,t))},e.prototype.onMouseDown=function(t){const e=this.getOrCreateInput("mouse","mouse",!0,t.clientX,t.clientY,t.timeStamp);this.updateInput(e,t),e.pressing||this.beginPress(e,t),0!==t.button&&this.cancelPress(e,t)},e.prototype.onMouseMove=function(t){const e=this.getInput("mouse");null!==e&&(this.updateInput(e,t),this.movePress(e,t))},e.prototype.onMouseUp=function(t){const e=this.getInput("mouse");null!==e&&(this.updateInput(e,t),this.endPress(e,t),e.defaultPrevented||0!==t.button||this.press(e,t))},e.prototype.onMouseLeaveDocument=function(t){const e=this.getInput("mouse");null!==e&&(this.updateInput(e,t),this.cancelPress(e,t),this.endHover(e,t))},e.construct=function(e,i,n){return(i=t.construct(e,i,n)).onMouseEnter=i.onMouseEnter.bind(i),i.onMouseLeave=i.onMouseLeave.bind(i),i.onMouseDown=i.onMouseDown.bind(i),i.onMouseMove=i.onMouseMove.bind(i),i.onMouseUp=i.onMouseUp.bind(i),i.onMouseLeaveDocument=i.onMouseLeaveDocument.bind(i),i},e}($i);class sn extends Ji{constructor(t,e,i,n,s,o){super(t,e,i,n,s,o),this.vx=0,this.vy=0,this.ax=0,this.ay=0,this.path=[],this.coasting=!1}updatePosition(t){const e=this.path,i=this.x,n=this.y,s=this.t;for(e.push({x:i,y:n,t:s});e.length>1&&s-e[0].t>t;)e.shift()}deriveVelocity(t){const e=this.path[0],i=this.path[this.path.length-1];if(void 0!==i&&i!==e){const n=i.t-e.t;let s,o;if(0!==n){s=(i.x-e.x)/n,o=(i.y-e.y)/n;const r=s*s+o*o;if(t*t<r){const e=Math.sqrt(r);s=s*t/e,o=o*t/e}}else s=0,o=0;this.vx=s,this.vy=o}else void 0!==e&&(this.vx=0,this.vy=0)}integrateVelocity(t){const e=t-this.t;if(0!==e){let i,n=this.vx+this.ax*e;n<0==this.vx<0?i=this.x+this.vx*e+this.ax*e*e*.5:(i=this.x-this.vx*this.vx/(2*this.ax),n=0,this.ax=0);let s,o=this.vy+this.ay*e;o<0==this.vy<0?s=this.y+this.vy*e+this.ay*e*e*.5:(s=this.y-this.vy*this.vy/(2*this.ay),o=0,this.ay=0),this.dx=i-this.x,this.dy=s-this.y,this.dt=e,this.x=i,this.y=s,this.t=t,this.vx=n,this.vy=o}}}const on=function(t){const e=t.extend("MomentumGesture");return Object.defineProperty(e.prototype,"observes",{value:!0,enumerable:!0,configurable:!0}),e.prototype.createInput=function(t,e,i,n,s,o){return new sn(t,e,i,n,s,o)},e.prototype.clearInput=function(t){t.coasting||$i.prototype.clearInput.call(this,t)},e.prototype.clearInputs=function(){$i.prototype.clearInputs.call(this),this.coastCount=0},e.prototype.viewWillAnimate=function(t){this.doCoast(t.updateTime)},e.prototype.interrupt=function(t){const e=this.inputs;for(const i in e){const n=e[i];this.endCoast(n,t)}},e.prototype.cancel=function(t){const e=this.inputs;for(const i in e){const n=e[i];this.endPress(n,t),this.endCoast(n,t)}},e.prototype.startInteracting=function(){this.willStartInteracting(),this.onStartInteracting(),this.didStartInteracting()},e.prototype.willStartInteracting=function(){},e.prototype.onStartInteracting=function(){},e.prototype.didStartInteracting=function(){},e.prototype.stopInteracting=function(){this.willStopInteracting(),this.onStopInteracting(),this.didStopInteracting()},e.prototype.willStopInteracting=function(){},e.prototype.onStopInteracting=function(){},e.prototype.didStopInteracting=function(){},e.prototype.onStartPressing=function(){$i.prototype.onStartPressing.call(this),0===this.coastCount&&this.startInteracting()},e.prototype.onStopPressing=function(){$i.prototype.onStopPressing.call(this),0===this.coastCount&&this.stopInteracting()},e.prototype.beginPress=function(t,e){$i.prototype.beginPress.call(this,t,e),this.interrupt(e)},e.prototype.onBeginPress=function(t,e){$i.prototype.onBeginPress.call(this,t,e),t.updatePosition(this.hysteresis),t.deriveVelocity(this.velocityMax)},e.prototype.onMovePress=function(t,e){$i.prototype.onMovePress.call(this,t,e),t.updatePosition(this.hysteresis),t.deriveVelocity(this.velocityMax)},e.prototype.willEndPress=function(t,e){$i.prototype.willEndPress.call(this,t,e),this.beginCoast(t,e)},e.prototype.onEndPress=function(t,e){$i.prototype.onEndPress.call(this,t,e),t.updatePosition(this.hysteresis),t.deriveVelocity(this.velocityMax)},e.prototype.onCancelPress=function(t,e){$i.prototype.onCancelPress.call(this,t,e),t.updatePosition(this.hysteresis),t.deriveVelocity(this.velocityMax)},Object.defineProperty(e.prototype,"coasting",{get(){return 0!==this.coastCount},configurable:!0}),e.prototype.startCoasting=function(){this.willStartCoasting(),this.onStartCoasting(),this.didStartCoasting()},e.prototype.willStartCoasting=function(){},e.prototype.onStartCoasting=function(){0===this.pressCount&&this.startInteracting(),null!==this.view&&this.view.requireUpdate(fn.NeedsAnimate)},e.prototype.didStartCoasting=function(){},e.prototype.stopCoasting=function(){this.willStopCoasting(),this.onStopCoasting(),this.didStopCoasting()},e.prototype.willStopCoasting=function(){},e.prototype.onStopCoasting=function(){0===this.pressCount&&this.stopInteracting()},e.prototype.didStopCoasting=function(){},e.prototype.beginCoast=function(t,e){if(!t.coasting&&(0!==t.vx||0!==t.vy)){const i=Math.atan2(Math.abs(t.vy),Math.abs(t.vx)),n=this.acceleration,s=(t.vx<0?n:t.vx>0?-n:0)*Math.cos(i),o=(t.vy<0?n:t.vy>0?-n:0)*Math.sin(i);if(0!==s||0!==o){t.ax=s,t.ay=o;let i=this.willBeginCoast(t,e);void 0===i&&(i=!0),i&&(t.coasting=!0,this.coastCount+=1,this.onBeginCoast(t,e),this.didBeginCoast(t,e),1===this.coastCount&&this.startCoasting())}}},e.prototype.willBeginCoast=function(t,e){},e.prototype.onBeginCoast=function(t,e){t.x0=t.x,t.y0=t.y,t.t0=t.t,t.dx=0,t.dy=0,t.dt=0},e.prototype.didBeginCoast=function(t,e){},e.prototype.endCoast=function(t,e){t.coasting&&(this.willEndCoast(t,e),t.coasting=!1,this.coastCount-=1,this.onEndCoast(t,e),this.didEndCoast(t,e),0===this.coastCount&&this.stopCoasting(),this.clearInput(t))},e.prototype.willEndCoast=function(t,e){},e.prototype.onEndCoast=function(t,e){},e.prototype.didEndCoast=function(t,e){},e.prototype.doCoast=function(t){if(0!==this.coastCount){this.willCoast(),this.integrate(t),this.onCoast();const e=this.inputs;for(const t in e){const i=e[t];i.coasting&&0===i.ax&&0===i.ay&&this.endCoast(i,null)}this.didCoast(),0!==this.coastCount&&null!==this.view&&this.view.requireUpdate(fn.NeedsAnimate)}},e.prototype.willCoast=function(){},e.prototype.onCoast=function(){},e.prototype.didCoast=function(){},e.prototype.integrate=function(t){const e=this.inputs;for(const i in e){const n=e[i];n.coasting&&n.integrateVelocity(t)}},e.construct=function(i,n,s){return(n=t.construct(i,n,s)).coastCount=0,n.hysteresis=e.Hysteresis,n.acceleration=e.Acceleration,n.velocityMax=e.VelocityMax,n},e.specialize=function(t){return"pointer"===t?rn:"touch"===t?ln:"mouse"===t?an:"undefined"!=typeof PointerEvent?rn:"undefined"!=typeof TouchEvent?ln:an},e.define=function(t,i){let n=i.extends;const s=i.affinity,o=i.inherits;let r=i.method;const l=i.hysteresis,a=i.hysteresis,h=i.hysteresis;delete i.extends,delete i.affinity,delete i.inherits,delete i.method,delete i.hysteresis,delete i.acceleration,delete i.velocityMax,!0===i.key?Object.defineProperty(i,"key",{value:t,configurable:!0}):!1===i.key&&Object.defineProperty(i,"key",{value:void 0,configurable:!0}),void 0===r&&(r="auto"),null==n&&(n=e.specialize(r)),null===n&&(n=this);const d=n.extend(t,i);return d.construct=function(t,e,i){return e=n.construct(t,e,i),void 0!==s&&e.initAffinity(s),void 0!==o&&e.initInherits(o),void 0!==l&&(e.hysteresis=l),void 0!==a&&(e.acceleration=a),void 0!==h&&(e.velocityMax=h),e},d},e.Hysteresis=67,e.Acceleration=.00175,e.VelocityMax=1.75,e}($i),rn=function(t){const e=t.extend("PointerMomentumGesture");return e.prototype.attachHoverEvents=function(t){t.on("pointerenter",this.onPointerEnter),t.on("pointerleave",this.onPointerLeave),t.on("pointerdown",this.onPointerDown)},e.prototype.detachHoverEvents=function(t){t.off("pointerenter",this.onPointerEnter),t.off("pointerleave",this.onPointerLeave),t.off("pointerdown",this.onPointerDown)},e.prototype.attachPressEvents=function(t){document.body.addEventListener("pointermove",this.onPointerMove),document.body.addEventListener("pointerup",this.onPointerUp),document.body.addEventListener("pointercancel",this.onPointerCancel),document.body.addEventListener("pointerleave",this.onPointerLeaveDocument)},e.prototype.detachPressEvents=function(t){document.body.removeEventListener("pointermove",this.onPointerMove),document.body.removeEventListener("pointerup",this.onPointerUp),document.body.removeEventListener("pointercancel",this.onPointerCancel),document.body.removeEventListener("pointerleave",this.onPointerLeaveDocument)},e.prototype.updateInput=function(t,e){t.target=e.target,t.button=e.button,t.buttons=e.buttons,t.altKey=e.altKey,t.ctrlKey=e.ctrlKey,t.metaKey=e.metaKey,t.shiftKey=e.shiftKey,t.dx=e.clientX-t.x,t.dy=e.clientY-t.y,t.dt=e.timeStamp-t.t,t.x=e.clientX,t.y=e.clientY,t.t=e.timeStamp,t.width=e.width,t.height=e.height,t.tiltX=e.tiltX,t.tiltY=e.tiltY,t.twist=e.twist,t.pressure=e.pressure,t.tangentialPressure=e.tangentialPressure},e.prototype.onPointerEnter=function(t){if("mouse"===t.pointerType&&0===t.buttons){const e=this.getOrCreateInput(t.pointerId,_i.pointerInputType(t.pointerType),t.isPrimary,t.clientX,t.clientY,t.timeStamp);this.updateInput(e,t),e.hovering||this.beginHover(e,t)}},e.prototype.onPointerLeave=function(t){if("mouse"===t.pointerType){const e=this.getInput(t.pointerId);null!==e&&(this.updateInput(e,t),this.endHover(e,t))}},e.prototype.onPointerDown=function(t){const e=this.getOrCreateInput(t.pointerId,_i.pointerInputType(t.pointerType),t.isPrimary,t.clientX,t.clientY,t.timeStamp);this.updateInput(e,t),e.pressing||this.beginPress(e,t),"mouse"===t.pointerType&&0!==t.button&&this.cancelPress(e,t)},e.prototype.onPointerMove=function(t){const e=this.getInput(t.pointerId);null!==e&&(this.updateInput(e,t),this.movePress(e,t))},e.prototype.onPointerUp=function(t){const e=this.getInput(t.pointerId);null!==e&&(this.updateInput(e,t),this.endPress(e,t),e.defaultPrevented||0!==t.button||this.press(e,t))},e.prototype.onPointerCancel=function(t){const e=this.getInput(t.pointerId);null!==e&&(this.updateInput(e,t),this.cancelPress(e,t))},e.prototype.onPointerLeaveDocument=function(t){const e=this.getInput(t.pointerId);null!==e&&(this.updateInput(e,t),this.cancelPress(e,t),this.endHover(e,t))},e.construct=function(e,i,n){return(i=t.construct(e,i,n)).onPointerEnter=i.onPointerEnter.bind(i),i.onPointerLeave=i.onPointerLeave.bind(i),i.onPointerDown=i.onPointerDown.bind(i),i.onPointerMove=i.onPointerMove.bind(i),i.onPointerUp=i.onPointerUp.bind(i),i.onPointerCancel=i.onPointerCancel.bind(i),i.onPointerLeaveDocument=i.onPointerLeaveDocument.bind(i),i},e}(on),ln=function(t){const e=t.extend("TouchMomentumGesture");return e.prototype.attachHoverEvents=function(t){t.on("touchstart",this.onTouchStart)},e.prototype.detachHoverEvents=function(t){t.off("touchstart",this.onTouchStart)},e.prototype.attachPressEvents=function(t){t.on("touchmove",this.onTouchMove),t.on("touchend",this.onTouchEnd),t.on("touchcancel",this.onTouchCancel)},e.prototype.detachPressEvents=function(t){t.off("touchmove",this.onTouchMove),t.off("touchend",this.onTouchEnd),t.off("touchcancel",this.onTouchCancel)},e.prototype.updateInput=function(t,e,i){t.target=i.target,t.altKey=e.altKey,t.ctrlKey=e.ctrlKey,t.metaKey=e.metaKey,t.shiftKey=e.shiftKey,t.dx=i.clientX-t.x,t.dy=i.clientY-t.y,t.dt=e.timeStamp-t.t,t.x=i.clientX,t.y=i.clientY,t.t=e.timeStamp},e.prototype.onTouchStart=function(t){const e=t.targetTouches;for(let i=0;i<e.length;i+=1){const n=e[i],s=this.getOrCreateInput(n.identifier,"touch",!1,n.clientX,n.clientY,t.timeStamp);this.updateInput(s,t,n),s.pressing||this.beginPress(s,t)}},e.prototype.onTouchMove=function(t){const e=t.changedTouches;for(let i=0;i<e.length;i+=1){const n=e[i],s=this.getInput(n.identifier);null!==s&&(this.updateInput(s,t,n),this.movePress(s,t))}},e.prototype.onTouchEnd=function(t){const e=t.changedTouches;for(let i=0;i<e.length;i+=1){const n=e[i],s=this.getInput(n.identifier);null!==s&&(this.updateInput(s,t,n),this.endPress(s,t),s.defaultPrevented||this.press(s,t),this.endHover(s,t))}},e.prototype.onTouchCancel=function(t){const e=t.changedTouches;for(let i=0;i<e.length;i+=1){const n=e[i],s=this.getInput(n.identifier);null!==s&&(this.updateInput(s,t,n),this.cancelPress(s,t),this.endHover(s,t))}},e.construct=function(e,i,n){return(i=t.construct(e,i,n)).onTouchStart=i.onTouchStart.bind(i),i.onTouchMove=i.onTouchMove.bind(i),i.onTouchEnd=i.onTouchEnd.bind(i),i.onTouchCancel=i.onTouchCancel.bind(i),i},e}(on),an=function(t){const e=t.extend("MouseMomentumGesture");return e.prototype.attachHoverEvents=function(t){t.on("mouseenter",this.onMouseEnter),t.on("mouseleave",this.onMouseLeave),t.on("mousedown",this.onMouseDown)},e.prototype.detachHoverEvents=function(t){t.off("mouseenter",this.onMouseEnter),t.off("mouseleave",this.onMouseLeave),t.off("mousedown",this.onMouseDown)},e.prototype.attachPressEvents=function(t){document.body.addEventListener("mousemove",this.onMouseMove),document.body.addEventListener("mouseup",this.onMouseUp),document.body.addEventListener("mouseleave",this.onMouseLeaveDocument)},e.prototype.detachPressEvents=function(t){document.body.removeEventListener("mousemove",this.onMouseMove),document.body.removeEventListener("mouseup",this.onMouseUp),document.body.removeEventListener("mouseleave",this.onMouseLeaveDocument)},e.prototype.updateInput=function(t,e){t.target=e.target,t.button=e.button,t.buttons=e.buttons,t.altKey=e.altKey,t.ctrlKey=e.ctrlKey,t.metaKey=e.metaKey,t.shiftKey=e.shiftKey,t.dx=e.clientX-t.x,t.dy=e.clientY-t.y,t.dt=e.timeStamp-t.t,t.x=e.clientX,t.y=e.clientY,t.t=e.timeStamp},e.prototype.onMouseEnter=function(t){if(0===t.buttons){const e=this.getOrCreateInput("mouse","mouse",!0,t.clientX,t.clientY,t.timeStamp);this.updateInput(e,t),e.hovering||this.beginHover(e,t)}},e.prototype.onMouseLeave=function(t){const e=this.getInput("mouse");null!==e&&(this.updateInput(e,t),this.endHover(e,t))},e.prototype.onMouseDown=function(t){const e=this.getOrCreateInput("mouse","mouse",!0,t.clientX,t.clientY,t.timeStamp);this.updateInput(e,t),e.pressing||this.beginPress(e,t),0!==t.button&&this.cancelPress(e,t)},e.prototype.onMouseMove=function(t){const e=this.getInput("mouse");null!==e&&(this.updateInput(e,t),this.movePress(e,t))},e.prototype.onMouseUp=function(t){const e=this.getInput("mouse");null!==e&&(this.updateInput(e,t),this.endPress(e,t),e.defaultPrevented||0!==t.button||this.press(e,t))},e.prototype.onMouseLeaveDocument=function(t){const e=this.getInput("mouse");null!==e&&(this.updateInput(e,t),this.cancelPress(e,t),this.endHover(e,t))},e.construct=function(e,i,n){return(i=t.construct(e,i,n)).onMouseEnter=i.onMouseEnter.bind(i),i.onMouseLeave=i.onMouseLeave.bind(i),i.onMouseDown=i.onMouseDown.bind(i),i.onMouseMove=i.onMouseMove.bind(i),i.onMouseUp=i.onMouseUp.bind(i),i.onMouseLeaveDocument=i.onMouseLeaveDocument.bind(i),i},e}(on);class hn extends sn{constructor(t,e,i,n,s,o){super(t,e,i,n,s,o),this.xCoord=void 0,this.yCoord=void 0,this.disableX=!1,this.disableY=!1}}const dn=function(t){const e=t.extend("ScaleGesture");return e.prototype.createInput=function(t,e,i,n,s,o){return new hn(t,e,i,n,s,o)},e.prototype.clearInputs=function(){on.prototype.clearInputs.call(this),this.setFlags(this.flags&~e.NeedsRescale)},Object.defineProperty(e.prototype,"preserveAspectRatio",{get(){return 0!=(this.flags&e.PreserveAspectRatioFlag)},set(t){t?this.setFlags(this.flags|e.PreserveAspectRatioFlag):this.setFlags(this.flags&~e.PreserveAspectRatioFlag)},configurable:!0}),Object.defineProperty(e.prototype,"wheel",{get(){return 0!=(this.flags&e.WheelFlag)},set(t){t?this.setFlags(this.flags|e.WheelFlag):this.setFlags(this.flags&~e.WheelFlag)},configurable:!0}),e.prototype.getXScale=function(){return null},e.prototype.setXScale=function(t,e){},e.prototype.getYScale=function(){return null},e.prototype.setYScale=function(t,e){},e.prototype.clientToRangeX=function(t,e,i){const n=t-i.xMin,s=e.range;return s[0]<=s[1]?s[0]+n:i.xMax+n-s[0]},e.prototype.clientToRangeY=function(t,e,i){const n=t-i.yMin,s=e.range;return s[0]<=s[1]?s[0]+n:i.yMax+n-s[0]},e.prototype.unscaleX=function(t,e,i){return e.inverse(this.clientToRangeX(t,e,i))},e.prototype.unscaleY=function(t,e,i){return e.inverse(this.clientToRangeY(t,e,i))},e.prototype.viewWillAnimate=function(t){on.prototype.viewWillAnimate.call(this,t),0!=(this.flags&e.NeedsRescale)&&this.rescale()},e.prototype.onBeginPress=function(t,i){on.prototype.onBeginPress.call(this,t,i),this.updateInputDomain(t),this.view.requireUpdate(fn.NeedsAnimate),this.setFlags(this.flags|e.NeedsRescale)},e.prototype.onMovePress=function(t,i){on.prototype.onMovePress.call(this,t,i),this.view.requireUpdate(fn.NeedsAnimate),this.setFlags(this.flags|e.NeedsRescale)},e.prototype.onEndPress=function(t,i){on.prototype.onEndPress.call(this,t,i),this.updateInputDomain(t),this.view.requireUpdate(fn.NeedsAnimate),this.setFlags(this.flags|e.NeedsRescale)},e.prototype.onCancelPress=function(t,i){on.prototype.onCancelPress.call(this,t,i),this.updateInputDomain(t),this.view.requireUpdate(fn.NeedsAnimate),this.setFlags(this.flags|e.NeedsRescale)},e.prototype.beginCoast=function(t,e){this.coastCount<2&&on.prototype.beginCoast.call(this,t,e)},e.prototype.onBeginCoast=function(t,i){on.prototype.onBeginCoast.call(this,t,i),this.updateInputDomain(t),this.conserveMomentum(t),this.view.requireUpdate(fn.NeedsAnimate),this.setFlags(this.flags|e.NeedsRescale)},e.prototype.onEndCoast=function(t,i){on.prototype.onEndCoast.call(this,t,i),t.disableX=!1,t.disableY=!1,this.view.requireUpdate(fn.NeedsAnimate),this.setFlags(this.flags|e.NeedsRescale)},e.prototype.onCoast=function(){on.prototype.onCoast.call(this),this.view.requireUpdate(fn.NeedsAnimate),this.setFlags(this.flags|e.NeedsRescale)},e.prototype.updateInputDomain=function(t,e,i,n){void 0===e&&(e=this.getXScale()),null!==e&&(void 0===n&&(n=this.view.clientBounds),t.xCoord=this.unscaleX(t.x0,e,n)),void 0===i&&(i=this.getYScale()),null!==i&&(void 0===n&&(n=this.view.clientBounds),t.yCoord=this.unscaleY(t.y0,i,n))},e.prototype.neutralizeX=function(){const t=this.inputs;for(const e in t){const i=t[e];i.coasting&&(i.disableX=!0,i.vx=0,i.ax=0)}},e.prototype.neutralizeY=function(){const t=this.inputs;for(const e in t){const i=t[e];i.coasting&&(i.disableY=!0,i.vy=0,i.ay=0)}},e.prototype.rescale=function(){let t,i;const n=this.inputs;for(const e in n){const s=n[e];(s.pressing||s.coasting)&&(void 0===t?t=s:void 0===i?i=s:s.t0<t.t0?t=s:s.t0<i.t0&&(i=s))}if(void 0!==t){const e=this.view.clientBounds,n=this.getXScale(),s=this.getYScale();null!==n&&null!==s?void 0!==i&&this.preserveAspectRatio?this.rescaleRadial(n,s,t,i,e):this.rescaleXY(n,s,t,i,e):null!==n?this.rescaleX(n,t,i,e):null!==s&&this.rescaleY(s,t,i,e)}this.setFlags(this.flags&~e.NeedsRescale)},e.prototype.rescaleRadial=function(t,e,i,n,s){const o=i.xCoord,r=i.yCoord,l=this.clientToRangeX(i.x0,t,s),a=this.clientToRangeY(i.y0,e,s),h=this.clientToRangeX(i.x,t,s),d=this.clientToRangeY(i.y,e,s),c=i.vx,u=i.vy,p=i.ax,f=i.ay,g=n.xCoord,v=n.yCoord,y=this.clientToRangeX(n.x0,t,s),w=this.clientToRangeY(n.y0,e,s),m=this.clientToRangeX(n.x,t,s),b=this.clientToRangeY(n.y,e,s),C=n.vx,S=n.vy,A=n.ax,x=n.ay,D=y-l,T=w-a,P=Math.max(this.distanceMin,Math.sqrt(D*D+T*T)),V=D/P,I=T/P,M=h-l,R=d-a,F=m-y,L=b-w,k=M*V+R*I,O=F*V+L*I,E=M*I+R*-V,W=F*I+L*-V,N=(E*I+W*I)/2,B=(E*-V+W*-V)/2,z=l+k*V+N,U=a+k*I+B,H=y+O*V+N,q=w+O*I+B,G=c*V+u*I,j=C*V+S*I,Y=c*I+u*-V,X=C*I+S*-V,K=(Y*I+X*I)/2,Z=(Y*-V+X*-V)/2;let _=G*V+K,Q=G*I+Z,J=j*V+K,$=j*I+Z;const tt=Math.sqrt(_*_+Q*Q),et=Math.sqrt(J*J+$*$),it=0!==tt?_/tt:0,nt=0!==tt?Q/tt:0,st=0!==et?J/et:0,ot=0!==et?$/et:0;_=it*tt,Q=nt*tt,J=st*et,$=ot*et;const rt=Math.sqrt(p*p+f*f),lt=Math.sqrt(A*A+x*x),at=rt*-it,ht=rt*-nt,dt=lt*-st,ct=lt*-ot;let ut=null;const pt=t.solveDomain(o,z,g,H);pt.equals(t)||(ut=pt,this.setXScale(ut));let ft=null;const gt=e.solveDomain(r,U,v,q);if(gt.equals(e)||(ft=gt,this.setYScale(ft)),(null!==ut||null!==ft)&&(null!==ut&&(i.x0=i.x,i.dx=0,i.vx=_,i.ax=at,i.xCoord=this.unscaleX(i.x0,ut,s),n.x0=n.x,n.dx=0,n.vx=J,n.ax=dt,n.xCoord=this.unscaleX(n.x0,ut,s)),null!==ft&&(i.y0=i.y,i.dy=0,i.vy=Q,i.ay=ht,i.yCoord=this.unscaleY(i.y0,ft,s),n.y0=n.y,n.dy=0,n.vy=$,n.ay=ct,n.yCoord=this.unscaleY(n.y0,ft,s)),this.inputCount>2)){const t=this.inputs;for(const e in t){const o=t[e];o!==i&&o!==n&&(null!==ut&&(o.x0=o.x,o.dx=0,o.xCoord=this.unscaleX(o.x0,ut,s)),null!==ft&&(o.y0=o.y,o.dy=0,o.yCoord=this.unscaleY(o.y0,ft,s)))}}},e.prototype.rescaleXY=function(t,e,i,n,s){const o=i.xCoord,r=i.yCoord;let l,a,h,d,c=this.clientToRangeX(i.x,t,s),u=this.clientToRangeY(i.y,e,s),p=i.disableX,f=i.disableY;if(void 0!==n){l=n.xCoord,a=n.yCoord,h=this.clientToRangeX(n.x,t,s),d=this.clientToRangeY(n.y,e,s),p=p||n.disableX,f=f||n.disableY;const i=Math.abs(h-c),o=Math.abs(d-u),r=this.distanceMin;if(i<r){const t=(r-i)/2;c<=h?(c-=t,h+=t):(c+=t,h-=t)}if(o<r){const t=(r-o)/2;u<=d?(u-=t,d+=t):(u+=t,d-=t)}}let g=null;p||(g=t.solveDomain(o,c,l,h),g.equals(t)||this.setXScale(g));let v=null;if(f||(v=e.solveDomain(r,u,a,d),v.equals(e)||this.setYScale(v)),(null!==g||null!==v)&&this.preserveAspectRatio){const t=this.inputs;for(const e in t){const i=t[e];null!==g&&(i.x0=i.x,i.dx=0,i.xCoord=this.unscaleX(i.x0,g,s)),null!==v&&(i.y0=i.y,i.dy=0,i.yCoord=this.unscaleY(i.y0,v,s))}}},e.prototype.rescaleX=function(t,e,i,n){const s=e.xCoord;let o,r,l=this.clientToRangeX(e.x,t,n),a=e.disableX;if(void 0!==i){r=i.xCoord,o=this.clientToRangeX(i.x,t,n),a=a||i.disableX;const e=Math.abs(o-l),s=this.distanceMin;if(e<s){const t=(s-e)/2;l<=o?(l-=t,o+=t):(l+=t,o-=t)}}if(!a){const e=t.solveDomain(s,l,r,o);e.equals(t)||this.setXScale(e)}},e.prototype.rescaleY=function(t,e,i,n){const s=e.yCoord;let o,r,l=this.clientToRangeY(e.y,t,n),a=e.disableY;if(void 0!==i){r=i.yCoord,o=this.clientToRangeY(i.y,t,n),a=a||i.disableY;const e=Math.abs(o-l),s=this.distanceMin;if(e<s){const t=(s-e)/2;l<=o?(l-=t,o+=t):(l+=t,o-=t)}}if(!a){const e=t.solveDomain(s,l,r,o);e.equals(t)||this.setYScale(e)}},e.prototype.conserveMomentum=function(t){let e;const i=this.inputs;for(const t in i){const n=i[t];n.coasting&&(void 0===e||n.t0<e.t0)&&(e=n)}if(void 0!==e){const i=this.getXScale(),n=this.getYScale();null!==i&&null!==n?this.distributeXYMomentum(t,e):null!==i?this.distributeXMomentum(t,e):null!==n&&this.distributeYMomentum(t,e)}},e.prototype.distributeXYMomentum=function(t,e){const i=t.vx,n=t.vy,s=e.vx,o=e.vy,r=Math.sqrt(i*i+n*n),l=Math.sqrt(s*s+o*o),a=0!==r?i/r:0,h=0!==r?n/r:0,d=0!==l?s/l:0,c=0!==l?o/l:0,u=(r+l)/2;t.vx=a*u,t.vy=h*u,e.vx=d*u,e.vy=c*u;const p=t.ax,f=t.ay,g=e.ax,v=e.ay,y=Math.sqrt(p*p+f*f),w=Math.sqrt(g*g+v*v),m=0!==y?p/y:0,b=0!==y?f/y:0,C=0!==w?g/w:0,S=0!==w?v/w:0,A=(y+w)/2;t.ax=m*A,t.ay=b*A,e.ax=C*A,e.ay=S*A},e.prototype.distributeXMomentum=function(t,e){const i=t.vx,n=e.vx,s=Math.abs(i),o=Math.abs(n),r=0!==s?i/s:0,l=0!==o?n/o:0,a=(s+o)/2;t.vx=r*a,e.vx=l*a;const h=t.ax,d=e.ax,c=Math.abs(h),u=Math.abs(d),p=0!==c?h/c:0,f=0!==u?d/u:0,g=(c+u)/2;t.ax=p*g,e.ax=f*g},e.prototype.distributeYMomentum=function(t,e){const i=t.vy,n=e.vy,s=Math.sqrt(i),o=Math.sqrt(n),r=0!==s?i/s:0,l=0!==o?n/o:0,a=(s+o)/2;t.vy=r*a,e.vy=l*a;const h=t.ay,d=e.ay,c=Math.sqrt(h),u=Math.sqrt(d),p=0!==c?h/c:0,f=0!==u?d/u:0,g=(c+u)/2;t.ay=p*g,e.ay=f*g},e.prototype.integrate=function(t){let e,i;const n=this.inputs;for(const s in n){const o=n[s];if(o.coasting)if(void 0===e)e=o;else if(void 0===i){i=o;const n=i.x-e.x,s=i.y-e.y,r=Math.sqrt(n*n+s*s);e.integrateVelocity(t),i.integrateVelocity(t);const l=i.x-e.x,a=i.y-e.y,h=Math.sqrt(l*l+a*a)/r;e.vx*=h,e.vy*=h,e.ax*=h,e.ay*=h,i.vx*=h,i.vy*=h,i.ax*=h,i.ay*=h}else o.integrateVelocity(t)}void 0!==e&&void 0===i&&e.integrateVelocity(t)},e.prototype.zoom=function(t,e,i,n){if(0===i)return;const s=null!==n?n.timeStamp:performance.now(),o=this.acceleration;let r=o*Math.cos(Math.PI/4),l=o*Math.sin(Math.PI/4);const a=this.velocityMax,h=.5*a*Math.cos(Math.PI/4),d=.5*a*Math.sin(Math.PI/4),c=4*h*h/r,u=4*d*d/l,p=this.inputs;let f=p.zoom0,g=p.zoom1;if(void 0!==f&&void 0!==g){const t=s-f.t;if(t>0){const e=Math.abs(g.x-f.x)/2,n=Math.abs(g.y-f.y)/2,o=(i=Math.min(Math.max(-a*t,i),a*t))*e*Math.cos(Math.PI/4)/c,h=i*n*Math.sin(Math.PI/4)/u;r=r*e/c,l=l*n/u,f.x+=o,f.y+=h,f.t=s,f.dx=o,f.dy=h,f.dt=t,f.vx=o/t,f.vy=h/t,f.ax=f.vx<0?r:f.vx>0?-r:0,f.ay=f.vy<0?l:f.vy>0?-l:0,g.x-=o,g.y-=h,g.t=s,f.dx=-o,f.dy=-h,f.dt=t,g.vx=-o/t,g.vy=-h/t,g.ax=g.vx<0?r:g.vx>0?-r:0,g.ay=g.vy<0?l:g.vy>0?-l:0}}else this.interrupt(n),i<0?(f=this.createInput("zoom0","unknown",!1,t-c,e-u,s),f.vx=-h,f.vy=-d,f.ax=r,f.ay=l,g=this.createInput("zoom1","unknown",!1,t+c,e+u,s),g.vx=h,g.vy=d,g.ax=-r,g.ay=-l):(f=this.createInput("zoom0","unknown",!1,t-c,e-u,s),f.vx=h,f.vy=d,f.ax=-r,f.ay=-l,g=this.createInput("zoom1","unknown",!1,t+c,e+u,s),g.vx=-h,g.vy=-d,g.ax=r,g.ay=l),p.zoom0=f,p.zoom1=g,this.inputCount+=2,this.beginCoast(f,n),this.beginCoast(g,n)},Object.defineProperty(e.prototype,"observes",{value:!0,enumerable:!0,configurable:!0}),e.construct=function(i,n,s){return(n=t.construct(i,n,s)).distanceMin=e.DistanceMin,n.setFlags(n.flags|e.WheelFlag),n},e.specialize=function(t){return"pointer"===t?cn:"touch"===t?un:"mouse"===t?pn:"undefined"!=typeof PointerEvent?cn:"undefined"!=typeof TouchEvent?un:pn},e.define=function(t,i){let n=i.extends;const s=i.affinity,o=i.inherits;let r=i.method;const l=i.hysteresis,a=i.hysteresis,h=i.hysteresis,d=i.distanceMin,c=i.preserveAspectRatio,u=i.wheel;delete i.extends,delete i.affinity,delete i.inherits,delete i.method,delete i.hysteresis,delete i.acceleration,delete i.velocityMax,delete i.distanceMin,delete i.preserveAspectRatio,delete i.wheel,!0===i.key?Object.defineProperty(i,"key",{value:t,configurable:!0}):!1===i.key&&Object.defineProperty(i,"key",{value:void 0,configurable:!0}),void 0===r&&(r="auto"),null==n&&(n=e.specialize(r)),null===n&&(n=this);const p=n.extend(t,i);return p.construct=function(t,e,i){return e=n.construct(t,e,i),void 0!==s&&e.initAffinity(s),void 0!==o&&e.initInherits(o),void 0!==l&&(e.hysteresis=l),void 0!==a&&(e.acceleration=a),void 0!==h&&(e.velocityMax=h),void 0!==d&&(e.distanceMin=d),void 0!==c&&(e.preserveAspectRatio=c),void 0!==u&&(e.wheel=u),e},p},e.DistanceMin=10,e.PreserveAspectRatioFlag=1<<t.FlagShift+0,e.WheelFlag=1<<t.FlagShift+1,e.NeedsRescale=1<<t.FlagShift+2,e.FlagShift=t.FlagShift+3,e.FlagMask=(1<<e.FlagShift)-1,e}(on),cn=function(t){const e=t.extend("PointerScaleGesture");return e.prototype.attachHoverEvents=function(t){t.on("pointerenter",this.onPointerEnter),t.on("pointerleave",this.onPointerLeave),t.on("pointerdown",this.onPointerDown),t.on("wheel",this.onWheel)},e.prototype.detachHoverEvents=function(t){t.off("pointerenter",this.onPointerEnter),t.off("pointerleave",this.onPointerLeave),t.off("pointerdown",this.onPointerDown),t.off("wheel",this.onWheel)},e.prototype.attachPressEvents=function(t){document.body.addEventListener("pointermove",this.onPointerMove),document.body.addEventListener("pointerup",this.onPointerUp),document.body.addEventListener("pointercancel",this.onPointerCancel),document.body.addEventListener("pointerleave",this.onPointerLeaveDocument)},e.prototype.detachPressEvents=function(t){document.body.removeEventListener("pointermove",this.onPointerMove),document.body.removeEventListener("pointerup",this.onPointerUp),document.body.removeEventListener("pointercancel",this.onPointerCancel),document.body.removeEventListener("pointerleave",this.onPointerLeaveDocument)},e.prototype.updateInput=function(t,e){t.target=e.target,t.button=e.button,t.buttons=e.buttons,t.altKey=e.altKey,t.ctrlKey=e.ctrlKey,t.metaKey=e.metaKey,t.shiftKey=e.shiftKey,t.dx=e.clientX-t.x,t.dy=e.clientY-t.y,t.dt=e.timeStamp-t.t,t.x=e.clientX,t.y=e.clientY,t.t=e.timeStamp,t.width=e.width,t.height=e.height,t.tiltX=e.tiltX,t.tiltY=e.tiltY,t.twist=e.twist,t.pressure=e.pressure,t.tangentialPressure=e.tangentialPressure},e.prototype.onPointerEnter=function(t){if("mouse"===t.pointerType&&0===t.buttons){const e=this.getOrCreateInput(t.pointerId,_i.pointerInputType(t.pointerType),t.isPrimary,t.clientX,t.clientY,t.timeStamp);e.coasting||this.updateInput(e,t),e.hovering||this.beginHover(e,t)}},e.prototype.onPointerLeave=function(t){if("mouse"===t.pointerType){const e=this.getInput(t.pointerId);null!==e&&(e.coasting||this.updateInput(e,t),this.endHover(e,t))}},e.prototype.onPointerDown=function(t){const e=this.getOrCreateInput(t.pointerId,_i.pointerInputType(t.pointerType),t.isPrimary,t.clientX,t.clientY,t.timeStamp);this.updateInput(e,t),e.pressing||this.beginPress(e,t),"mouse"===t.pointerType&&0!==t.button&&this.cancelPress(e,t)},e.prototype.onPointerMove=function(t){const e=this.getInput(t.pointerId);null!==e&&(this.updateInput(e,t),this.movePress(e,t))},e.prototype.onPointerUp=function(t){const e=this.getInput(t.pointerId);null!==e&&(this.updateInput(e,t),this.endPress(e,t),e.defaultPrevented||0!==t.button||this.press(e,t))},e.prototype.onPointerCancel=function(t){const e=this.getInput(t.pointerId);null!==e&&(this.updateInput(e,t),this.cancelPress(e,t))},e.prototype.onPointerLeaveDocument=function(t){const e=this.getInput(t.pointerId);null!==e&&(this.updateInput(e,t),this.cancelPress(e,t),this.endHover(e,t))},e.prototype.onWheel=function(t){this.wheel&&(t.preventDefault(),this.zoom(t.clientX,t.clientY,t.deltaY,t))},e.construct=function(e,i,n){return(i=t.construct(e,i,n)).onPointerEnter=i.onPointerEnter.bind(i),i.onPointerLeave=i.onPointerLeave.bind(i),i.onPointerDown=i.onPointerDown.bind(i),i.onPointerMove=i.onPointerMove.bind(i),i.onPointerUp=i.onPointerUp.bind(i),i.onPointerCancel=i.onPointerCancel.bind(i),i.onPointerLeaveDocument=i.onPointerLeaveDocument.bind(i),i.onWheel=i.onWheel.bind(i),i},e}(dn),un=function(t){const e=t.extend("TouchScaleGesture");return e.prototype.attachHoverEvents=function(t){t.on("touchstart",this.onTouchStart)},e.prototype.detachHoverEvents=function(t){t.off("touchstart",this.onTouchStart)},e.prototype.attachPressEvents=function(t){t.on("touchmove",this.onTouchMove),t.on("touchend",this.onTouchEnd),t.on("touchcancel",this.onTouchCancel)},e.prototype.detachPressEvents=function(t){t.off("touchmove",this.onTouchMove),t.off("touchend",this.onTouchEnd),t.off("touchcancel",this.onTouchCancel)},e.prototype.updateInput=function(t,e,i){t.target=i.target,t.altKey=e.altKey,t.ctrlKey=e.ctrlKey,t.metaKey=e.metaKey,t.shiftKey=e.shiftKey,t.dx=i.clientX-t.x,t.dy=i.clientY-t.y,t.dt=e.timeStamp-t.t,t.x=i.clientX,t.y=i.clientY,t.t=e.timeStamp},e.prototype.onTouchStart=function(t){const e=t.targetTouches;for(let i=0;i<e.length;i+=1){const n=e[i],s=this.getOrCreateInput(n.identifier,"touch",!1,n.clientX,n.clientY,t.timeStamp);this.updateInput(s,t,n),s.pressing||this.beginPress(s,t)}},e.prototype.onTouchMove=function(t){const e=t.changedTouches;for(let i=0;i<e.length;i+=1){const n=e[i],s=this.getInput(n.identifier);null!==s&&(this.updateInput(s,t,n),this.movePress(s,t))}},e.prototype.onTouchEnd=function(t){const e=t.changedTouches;for(let i=0;i<e.length;i+=1){const n=e[i],s=this.getInput(n.identifier);null!==s&&(this.updateInput(s,t,n),this.endPress(s,t),s.defaultPrevented||this.press(s,t),this.endHover(s,t))}},e.prototype.onTouchCancel=function(t){const e=t.changedTouches;for(let i=0;i<e.length;i+=1){const n=e[i],s=this.getInput(n.identifier);null!==s&&(this.updateInput(s,t,n),this.cancelPress(s,t),this.endHover(s,t))}},e.construct=function(e,i,n){return(i=t.construct(e,i,n)).onTouchStart=i.onTouchStart.bind(i),i.onTouchMove=i.onTouchMove.bind(i),i.onTouchEnd=i.onTouchEnd.bind(i),i.onTouchCancel=i.onTouchCancel.bind(i),i},e}(dn),pn=function(t){const e=t.extend("MouseScaleGesture");return e.prototype.attachHoverEvents=function(t){t.on("mouseenter",this.onMouseEnter),t.on("mouseleave",this.onMouseLeave),t.on("mousedown",this.onMouseDown),t.on("wheel",this.onWheel)},e.prototype.detachHoverEvents=function(t){t.off("mouseenter",this.onMouseEnter),t.off("mouseleave",this.onMouseLeave),t.off("mousedown",this.onMouseDown),t.off("wheel",this.onWheel)},e.prototype.attachPressEvents=function(t){document.body.addEventListener("mousemove",this.onMouseMove),document.body.addEventListener("mouseup",this.onMouseUp),document.body.addEventListener("mouseleave",this.onMouseLeaveDocument)},e.prototype.detachPressEvents=function(t){document.body.removeEventListener("mousemove",this.onMouseMove),document.body.removeEventListener("mouseup",this.onMouseUp),document.body.removeEventListener("mouseleave",this.onMouseLeaveDocument)},e.prototype.updateInput=function(t,e){t.target=e.target,t.button=e.button,t.buttons=e.buttons,t.altKey=e.altKey,t.ctrlKey=e.ctrlKey,t.metaKey=e.metaKey,t.shiftKey=e.shiftKey,t.dx=e.clientX-t.x,t.dy=e.clientY-t.y,t.dt=e.timeStamp-t.t,t.x=e.clientX,t.y=e.clientY,t.t=e.timeStamp},e.prototype.onMouseEnter=function(t){if(0===t.buttons){const e=this.getOrCreateInput("mouse","mouse",!0,t.clientX,t.clientY,t.timeStamp);e.coasting||this.updateInput(e,t),e.hovering||this.beginHover(e,t)}},e.prototype.onMouseLeave=function(t){const e=this.getInput("mouse");null!==e&&(e.coasting||this.updateInput(e,t),this.endHover(e,t))},e.prototype.onMouseDown=function(t){const e=this.getOrCreateInput("mouse","mouse",!0,t.clientX,t.clientY,t.timeStamp);this.updateInput(e,t),e.pressing||this.beginPress(e,t),0!==t.button&&this.cancelPress(e,t)},e.prototype.onMouseMove=function(t){const e=this.getInput("mouse");null!==e&&(this.updateInput(e,t),this.movePress(e,t))},e.prototype.onMouseUp=function(t){const e=this.getInput("mouse");null!==e&&(this.updateInput(e,t),this.endPress(e,t),e.defaultPrevented||0!==t.button||this.press(e,t))},e.prototype.onMouseLeaveDocument=function(t){const e=this.getInput("mouse");null!==e&&(this.updateInput(e,t),this.cancelPress(e,t),this.endHover(e,t))},e.prototype.onWheel=function(t){this.wheel&&(t.preventDefault(),this.zoom(t.clientX,t.clientY,t.deltaY,t))},e.construct=function(e,i,n){return(i=t.construct(e,i,n)).onMouseEnter=i.onMouseEnter.bind(i),i.onMouseLeave=i.onMouseLeave.bind(i),i.onMouseDown=i.onMouseDown.bind(i),i.onMouseMove=i.onMouseMove.bind(i),i.onMouseUp=i.onMouseUp.bind(i),i.onMouseLeaveDocument=i.onMouseLeaveDocument.bind(i),i.onWheel=i.onWheel.bind(i),i},e}(dn);class fn extends i.Hierarchy{constructor(){super(),this.observerCache={},this.constraints=e.Arrays.empty,this.constraintVariables=e.Arrays.empty}setFlags(t){this.flags=t}attachParent(t){this.willAttachParent(t),t.mounted&&(t.culled&&this.cascadeCull(),this.cascadeMount()),this.onAttachParent(t),this.didAttachParent(t)}willAttachParent(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.viewWillAttachParent&&n.viewWillAttachParent(t,this)}}onAttachParent(t){}didAttachParent(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.viewDidAttachParent&&n.viewDidAttachParent(t,this)}}detachParent(t){this.willDetachParent(t),this.mounted&&this.cascadeUnmount(),this.onDetachParent(t),this.didDetachParent(t)}willDetachParent(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.viewWillDetachParent&&n.viewWillDetachParent(t,this)}}onDetachParent(t){}didDetachParent(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.viewDidDetachParent&&n.viewDidDetachParent(t,this)}}get insertChildFlags(){return this.constructor.InsertChildFlags}willInsertChild(t,e){super.willInsertChild(t,e);const i=this.observerCache.viewWillInsertChildObservers;if(void 0!==i)for(let n=0,s=i.length;n<s;n+=1){i[n].viewWillInsertChild(t,e,this)}}onInsertChild(t,e){super.onInsertChild(t,e),this.bindChildFasteners(t,e)}didInsertChild(t,e){const i=this.observerCache.viewDidInsertChildObservers;if(void 0!==i)for(let n=0,s=i.length;n<s;n+=1){i[n].viewDidInsertChild(t,e,this)}super.didInsertChild(t,e)}cascadeInsert(t,e){0!=(this.flags&fn.MountedFlag)&&(void 0===t&&(t=0),0!=((t|=this.flags&fn.UpdateMask)&fn.ProcessMask)&&(void 0===e&&(e=this.superViewContext),this.cascadeProcess(t,e)))}get removeChildFlags(){return this.constructor.RemoveChildFlags}willRemoveChild(t){super.willRemoveChild(t);const e=this.observerCache.viewWillRemoveChildObservers;if(void 0!==e)for(let i=0,n=e.length;i<n;i+=1){e[i].viewWillRemoveChild(t,this)}}onRemoveChild(t){super.onRemoveChild(t),this.unbindChildFasteners(t)}didRemoveChild(t){const e=this.observerCache.viewDidRemoveChildObservers;if(void 0!==e)for(let i=0,n=e.length;i<n;i+=1){e[i].viewDidRemoveChild(t,this)}super.didRemoveChild(t)}get mountFlags(){return this.constructor.MountFlags}willMount(){super.willMount();const t=this.observers;for(let e=0,i=t.length;e<i;e+=1){const i=t[e];void 0!==i.viewWillMount&&i.viewWillMount(this)}}onMount(){this.requestUpdate(this,this.flags&fn.UpdateMask,!1),this.requireUpdate(this.mountFlags),this.culled||null===this.decoherent||0===this.decoherent.length||this.requireUpdate(fn.NeedsChange|fn.NeedsAnimate),this.mountFasteners(),this.mountTheme(),this.updateTheme(!1)}didMount(){this.activateLayout();const t=this.observers;for(let e=0,i=t.length;e<i;e+=1){const i=t[e];void 0!==i.viewDidMount&&i.viewDidMount(this)}super.didMount()}willUnmount(){super.willUnmount();const t=this.observers;for(let e=0,i=t.length;e<i;e+=1){const i=t[e];void 0!==i.viewWillUnmount&&i.viewWillUnmount(this)}this.deactivateLayout()}didUnmount(){const t=this.observers;for(let e=0,i=t.length;e<i;e+=1){const i=t[e];void 0!==i.viewDidUnmount&&i.viewDidUnmount(this)}super.didUnmount()}get culled(){return 0!=(this.flags&fn.CulledMask)}setCulled(t){const e=this.flags;if(t&&0==(e&fn.CulledFlag)){if(this.setFlags(e|fn.CulledFlag),0==(e&fn.CullFlag)){this.setFlags(this.flags|fn.TraversingFlag);try{this.willCull(),this.onCull(),this.cullChildren(),this.didCull()}finally{this.setFlags(this.flags&~fn.TraversingFlag)}}}else if(!t&&0!=(e&fn.CulledFlag)&&(this.setFlags(e&~fn.CulledFlag),0==(e&fn.CullFlag))){this.setFlags(this.flags|fn.TraversingFlag);try{this.willUncull(),this.uncullChildren(),this.onUncull(),this.didUncull()}finally{this.setFlags(this.flags&~fn.TraversingFlag)}}}cascadeCull(){if(0==(this.flags&fn.CullFlag)&&(this.setFlags(this.flags|fn.CullFlag),0==(this.flags&fn.CulledFlag))){this.setFlags(this.flags|fn.TraversingFlag);try{this.willCull(),this.onCull(),this.cullChildren(),this.didCull()}finally{this.setFlags(this.flags&~fn.TraversingFlag)}}}willCull(){const t=this.observers;for(let e=0,i=t.length;e<i;e+=1){const i=t[e];void 0!==i.viewWillCull&&i.viewWillCull(this)}}onCull(){}didCull(){const t=this.observers;for(let e=0,i=t.length;e<i;e+=1){const i=t[e];void 0!==i.viewDidCull&&i.viewDidCull(this)}}cullChildren(){this.forEachChild((function(t){t.cascadeCull(),0!=(t.flags&fn.RemovingFlag)&&(t.setFlags(t.flags&~fn.RemovingFlag),this.removeChild(t))}),this)}cascadeUncull(){if(0!=(this.flags&fn.CullFlag)&&(this.setFlags(this.flags&~fn.CullFlag),0==(this.flags&fn.CulledFlag))){this.setFlags(this.flags|fn.TraversingFlag);try{this.willUncull(),this.uncullChildren(),this.onUncull(),this.didUncull()}finally{this.setFlags(this.flags&~fn.TraversingFlag)}}}get uncullFlags(){return this.constructor.UncullFlags}willUncull(){const t=this.observers;for(let e=0,i=t.length;e<i;e+=1){const i=t[e];void 0!==i.viewWillUncull&&i.viewWillUncull(this)}}onUncull(){this.requestUpdate(this,this.flags&fn.UpdateMask,!1),this.requireUpdate(this.uncullFlags),null!==this.decoherent&&0!==this.decoherent.length&&this.requireUpdate(fn.NeedsChange|fn.NeedsAnimate),this.mood.inherited&&this.mood.decohere(),this.theme.inherited&&this.theme.decohere()}didUncull(){const t=this.observers;for(let e=0,i=t.length;e<i;e+=1){const i=t[e];void 0!==i.viewDidUncull&&i.viewDidUncull(this)}}uncullChildren(){this.forEachChild((function(t){t.cascadeUncull(),0!=(t.flags&fn.RemovingFlag)&&(t.setFlags(t.flags&~fn.RemovingFlag),this.removeChild(t))}),this)}get unbounded(){return 0!=(this.flags&fn.UnboundedFlag)}setUnbounded(t){t!==(0!=(this.flags&fn.UnboundedFlag))&&(this.willSetUnbounded(t),t?this.setFlags(this.flags|fn.UnboundedFlag):this.setFlags(this.flags&~fn.UnboundedFlag),this.onSetUnbounded(t),this.didSetUnbounded(t))}willSetUnbounded(t){}onSetUnbounded(t){}didSetUnbounded(t){}get intangible(){return 0!=(this.flags&fn.IntangibleFlag)}setIntangible(t){t!==(0!=(this.flags&fn.IntangibleFlag))&&(this.willSetIntangible(t),t?this.setFlags(this.flags|fn.IntangibleFlag):this.setFlags(this.flags&~fn.IntangibleFlag),this.onSetIntangible(t),this.didSetIntangible(t))}willSetIntangible(t){}onSetIntangible(t){}didSetIntangible(t){}requireUpdate(t,e=!1){const i=this.flags,n=t&~i&fn.UpdateMask;0!==n&&(this.setFlags(i|n),this.requestUpdate(this,n,e))}needsUpdate(t,e){return t}requestUpdate(t,e,i){if((this.flags&fn.CulledMask)!==fn.CulledFlag){e=this.needsUpdate(e,i);let n=this.flags&~e&fn.UpdateMask;if(0!=(e&fn.ProcessMask)&&(n|=fn.NeedsProcess),0!=(e&fn.DisplayMask)&&(n|=fn.NeedsDisplay),0!==n||i){this.setFlags(this.flags|n);const s=this.parent;if(null!==s)s.requestUpdate(t,e,i);else if(this.mounted){const n=this.displayProvider.service;null!=n&&n.requestUpdate(t,e,i)}}}}get updating(){return 0!=(this.flags&fn.UpdatingMask)}get processing(){return 0!=(this.flags&fn.ProcessingFlag)}needsProcess(t,e){return t}willProcess(t,e){}onProcess(t,e){}didProcess(t,e){}willResize(t){const e=this.observerCache.viewWillResizeObservers;if(void 0!==e)for(let i=0,n=e.length;i<n;i+=1){e[i].viewWillResize(t,this)}this.evaluateConstraintVariables()}onResize(t){}didResize(t){const e=this.observerCache.viewDidResizeObservers;if(void 0!==e)for(let i=0,n=e.length;i<n;i+=1){e[i].viewDidResize(t,this)}}willScroll(t){const e=this.observerCache.viewWillScrollObservers;if(void 0!==e)for(let i=0,n=e.length;i<n;i+=1){e[i].viewWillScroll(t,this)}}onScroll(t){}didScroll(t){const e=this.observerCache.viewDidScrollObservers;if(void 0!==e)for(let i=0,n=e.length;i<n;i+=1){e[i].viewDidScroll(t,this)}}willChange(t){const e=this.observerCache.viewWillChangeObservers;if(void 0!==e)for(let i=0,n=e.length;i<n;i+=1){e[i].viewWillChange(t,this)}}onChange(t){this.updateTheme(),this.recohereFasteners(t.updateTime)}didChange(t){const e=this.observerCache.viewDidChangeObservers;if(void 0!==e)for(let i=0,n=e.length;i<n;i+=1){e[i].viewDidChange(t,this)}}willAnimate(t){const e=this.observerCache.viewWillAnimateObservers;if(void 0!==e)for(let i=0,n=e.length;i<n;i+=1){e[i].viewWillAnimate(t,this)}}onAnimate(t){this.recohereAnimators(t.updateTime)}didAnimate(t){const e=this.observerCache.viewDidAnimateObservers;if(void 0!==e)for(let i=0,n=e.length;i<n;i+=1){e[i].viewDidAnimate(t,this)}}processChildren(t,e,i){this.forEachChild((function(n){i.call(this,n,t,e),0!=(n.flags&fn.RemovingFlag)&&(n.setFlags(n.flags&~fn.RemovingFlag),this.removeChild(n))}),this)}processChild(t,e,i){t.cascadeProcess(e,i)}get displaying(){return 0!=(this.flags&fn.DisplayingFlag)}needsDisplay(t,e){return t}willDisplay(t,e){}onDisplay(t,e){}didDisplay(t,e){}willLayout(t){const e=this.observerCache.viewWillLayoutObservers;if(void 0!==e)for(let i=0,n=e.length;i<n;i+=1){e[i].viewWillLayout(t,this)}}onLayout(t){}didLayout(t){const e=this.observerCache.viewDidLayoutObservers;if(void 0!==e)for(let i=0,n=e.length;i<n;i+=1){e[i].viewDidLayout(t,this)}}displayChildren(t,e,i){this.forEachChild((function(n){i.call(this,n,t,e),0!=(n.flags&fn.RemovingFlag)&&(n.setFlags(n.flags&~fn.RemovingFlag),this.removeChild(n))}),this)}displayChild(t,e,i){t.cascadeDisplay(e,i)}getLook(t,e){const i=this.theme.state;let n;return null!==i&&(null==e&&(e=this.mood.state),null!==e&&(n=i.get(t,e))),n}getLookOr(t,e,i){2===arguments.length&&(i=e,e=null);const n=this.theme.state;let s;return null!==n?(null==e&&(e=this.mood.state),s=null!==e?n.getOr(t,e,i):i):s=i,s}applyTheme(t,i,n){n=void 0===n||!0===n?t.getOr(At.timing,Et.ambient,!1):e.Timing.fromAny(n),this.willApplyTheme(t,i,n),this.onApplyTheme(t,i,n),this.didApplyTheme(t,i,n)}willApplyTheme(t,e,i){const n=this.observers;for(let s=0,o=n.length;s<o;s+=1){const o=n[s];void 0!==o.viewWillApplyTheme&&o.viewWillApplyTheme(t,e,i,this)}}onApplyTheme(t,e,i){this.themeAnimators(t,e,i)}didApplyTheme(t,e,i){const n=this.observers;for(let s=0,o=n.length;s<o;s+=1){const o=n[s];void 0!==o.viewDidApplyTheme&&o.viewDidApplyTheme(t,e,i,this)}}themeAnimators(t,e,i){const n=this.fasteners;for(const s in n){const o=n[s];o instanceof Ht&&o.applyTheme(t,e,i)}}modifyMood(t,n,s){if(this.moodModifier.hasAffinity(i.Affinity.Intrinsic)){const o=this.moodModifier.getStateOr(Nt.empty()),r=o.updatedCol(t,n,!0);if(!r.equals(o))if(this.moodModifier.setState(r,i.Affinity.Intrinsic),this.changeMood(),void 0!==s){const t=this.theme.state,i=this.mood.state;null!==t&&null!==i&&(s=!0===s?t.getOr(At.timing,i,!1):e.Timing.fromAny(s),this.applyTheme(t,i,s))}else this.requireUpdate(fn.NeedsChange)}}modifyTheme(t,n,s){if(this.themeModifier.hasAffinity(i.Affinity.Intrinsic)){const o=this.themeModifier.getStateOr(Nt.empty()),r=o.updatedCol(t,n,!0);if(!r.equals(o))if(this.themeModifier.setState(r,i.Affinity.Intrinsic),this.changeTheme(),void 0!==s){const t=this.theme.state,i=this.mood.state;null!==t&&null!==i&&(s=!0===s?t.getOr(At.timing,i,!1):e.Timing.fromAny(s),this.applyTheme(t,i,s))}else this.requireUpdate(fn.NeedsChange)}}changeMood(){const t=this.getFastener("moodModifier",i.Property);if(null!==t&&this.mood.hasAffinity(i.Affinity.Intrinsic)){const e=t.state;if(null!==e){let t=this.mood.superState;if(null==t){const e=this.themeProvider.service;null!=e&&(t=e.mood)}if(null!=t){const n=e.timesCol(t,!0);this.mood.setState(n,i.Affinity.Intrinsic)}}else this.mood.setAffinity(i.Affinity.Inherited)}}changeTheme(){const t=this.getFastener("themeModifier",i.Property);if(null!==t&&this.theme.hasAffinity(i.Affinity.Intrinsic)){const e=t.state;if(null!==e){let t=this.theme.superState;if(null==t){const e=this.themeProvider.service;null!=e&&(t=e.theme)}if(null!=t){const n=t.transform(e,!0);this.theme.setState(n,i.Affinity.Intrinsic)}}else this.theme.setAffinity(i.Affinity.Inherited)}}updateTheme(t){this.changeMood(),this.changeTheme();const e=this.theme.state,i=this.mood.state;null!==e&&null!==i&&this.applyTheme(e,i,t)}mountTheme(){}onAttachFastener(t,e){super.onAttachFastener(t,e),this.bindFastener(e)}bindFastener(t){(t instanceof gn||t instanceof Qi)&&t.binds&&this.forEachChild((function(e){t.bindView(e,null)}),this)}bindChildFasteners(t,e){const i=this.fasteners;for(const n in i){const s=i[n];this.bindChildFastener(s,t,e)}}bindChildFastener(t,e,i){(t instanceof gn||t instanceof Qi)&&t.bindView(e,i)}unbindChildFasteners(t){const e=this.fasteners;for(const i in e){const n=e[i];this.unbindChildFastener(n,t)}}unbindChildFastener(t,e){(t instanceof gn||t instanceof Qi)&&t.unbindView(e)}decohereFastener(t){super.decohereFastener(t),t instanceof i.Animator?this.requireUpdate(fn.NeedsAnimate):this.requireUpdate(fn.NeedsChange)}recohereFasteners(t){const e=this.decoherent;if(null!==e){const n=e.length;if(0!==n){void 0===t&&(t=performance.now()),this.decoherent=null;for(let s=0;s<n;s+=1){const n=e[s];n instanceof i.Animator?this.decohereFastener(n):n.recohere(t)}}}}recohereAnimators(t){const e=this.decoherent;if(null!==e){const n=e.length;if(0!==n){this.decoherent=null;for(let s=0;s<n;s+=1){const n=e[s];n instanceof i.Animator?n.recohere(t):this.decohereFastener(n)}}}}constraint(t,e,i,n){t=a.ConstraintExpression.fromAny(t),void 0!==i&&(i=a.ConstraintExpression.fromAny(i));const s=void 0!==i?t.minus(i):t;n=void 0===n?a.ConstraintStrength.Required:a.ConstraintStrength.fromAny(n);const o=new a.Constraint(this,s,e,n);return this.addConstraint(o),o}hasConstraint(t){return this.constraints.indexOf(t)>=0}addConstraint(t){const i=this.constraints,n=e.Arrays.inserted(t,i);i!==n&&(this.constraints=n,this.activateConstraint(t))}removeConstraint(t){const i=this.constraints,n=e.Arrays.removed(t,i);i!==n&&(this.deactivateConstraint(t),this.constraints=n)}activateConstraint(t){const e=this.layoutProvider.service;null!=e&&(e.activateConstraint(t),this.requireUpdate(fn.NeedsLayout))}deactivateConstraint(t){const e=this.layoutProvider.service;null!=e&&(e.deactivateConstraint(t),this.requireUpdate(fn.NeedsLayout))}constraintVariable(t,e,i){void 0===e&&(e=0),i=void 0!==i?a.ConstraintStrength.fromAny(i):a.ConstraintStrength.Strong;const n=a.ConstraintProperty.create(this);return Object.defineProperty(n,"name",{value:t,configurable:!0}),void 0!==e&&n.setState(e),n.setStrength(i),n.mount(),n}hasConstraintVariable(t){return this.constraintVariables.indexOf(t)>=0}addConstraintVariable(t){const i=this.constraintVariables,n=e.Arrays.inserted(t,i);i!==n&&(this.constraintVariables=n,this.activateConstraintVariable(t))}removeConstraintVariable(t){const i=this.constraintVariables,n=e.Arrays.removed(t,i);i!==n&&(this.deactivateConstraintVariable(t),this.constraintVariables=n)}activateConstraintVariable(t){const e=this.layoutProvider.service;null!=e&&(e.activateConstraintVariable(t),this.requireUpdate(fn.NeedsLayout))}deactivateConstraintVariable(t){const e=this.layoutProvider.service;null!=e&&(e.deactivateConstraintVariable(t),this.requireUpdate(fn.NeedsLayout))}setConstraintVariable(t,e){const i=this.layoutProvider.service;null!=i&&i.setConstraintVariable(t,e)}evaluateConstraintVariables(){const t=this.constraintVariables;for(let e=0,i=t.length;e<i;e+=1){t[e].evaluateConstraintVariable()}}activateLayout(){const t=this.layoutProvider.service;if(null!=t){const e=this.constraints;for(let i=0,n=e.length;i<n;i+=1)t.activateConstraint(e[i])}}deactivateLayout(){const t=this.layoutProvider.service;if(null!=t){const e=this.constraints;for(let i=0,n=e.length;i<n;i+=1)t.deactivateConstraint(e[i])}}setProperty(t,e,n,s){const o=this.getLazyFastener(t,i.Property);null!==o&&(o instanceof i.Animator?o.setState(e,n,s):o.setState(e,s))}setProperties(t,e,i){"number"==typeof e&&(i=e,e=void 0);for(const n in t){const s=t[n];this.setProperty(n,s,e,i)}}get superViewContext(){const t=this.parent;if(null!==t)return t.viewContext;{const t=this.viewportProvider.viewContext;return this.displayProvider.updatedViewContext(t)}}extendViewContext(t){return t}get viewContext(){return 0!=(this.flags&fn.ContextualFlag)?Ni.current:this.extendViewContext(this.superViewContext)}get viewportIdiom(){return this.viewContext.viewportIdiom}get viewport(){return this.viewContext.viewport}get pageTransform(){const t=this.parent;return null!==t?t.pageTransform.transform(this.parentTransform):s.Transform.identity()}get pageBounds(){const t=this.clientBounds,e=this.clientTransform;return t.transform(e)}get popoverFrame(){return this.pageBounds}get clientTransform(){let t;const e=window.pageXOffset,i=window.pageYOffset;t=0!==e||0!==i?s.Transform.translate(e,i):s.Transform.identity();const n=this.pageTransform;return t.transform(n)}intersectsViewport(){const t=this.clientBounds,e=document.documentElement.clientWidth,i=document.documentElement.clientHeight;return(t.top<=0&&0<t.bottom||0<=t.top&&t.top<i)&&(t.left<=0&&0<t.right||0<=t.left&&t.left<e)}onObserve(t){super.onObserve(t),void 0!==t.viewWillInsertChild&&(this.observerCache.viewWillInsertChildObservers=e.Arrays.inserted(t,this.observerCache.viewWillInsertChildObservers)),void 0!==t.viewDidInsertChild&&(this.observerCache.viewDidInsertChildObservers=e.Arrays.inserted(t,this.observerCache.viewDidInsertChildObservers)),void 0!==t.viewWillRemoveChild&&(this.observerCache.viewWillRemoveChildObservers=e.Arrays.inserted(t,this.observerCache.viewWillRemoveChildObservers)),void 0!==t.viewDidRemoveChild&&(this.observerCache.viewDidRemoveChildObservers=e.Arrays.inserted(t,this.observerCache.viewDidRemoveChildObservers)),void 0!==t.viewWillResize&&(this.observerCache.viewWillResizeObservers=e.Arrays.inserted(t,this.observerCache.viewWillResizeObservers)),void 0!==t.viewDidResize&&(this.observerCache.viewDidResizeObservers=e.Arrays.inserted(t,this.observerCache.viewDidResizeObservers)),void 0!==t.viewWillScroll&&(this.observerCache.viewWillScrollObservers=e.Arrays.inserted(t,this.observerCache.viewWillScrollObservers)),void 0!==t.viewDidScroll&&(this.observerCache.viewDidScrollObservers=e.Arrays.inserted(t,this.observerCache.viewDidScrollObservers)),void 0!==t.viewWillChange&&(this.observerCache.viewWillChangeObservers=e.Arrays.inserted(t,this.observerCache.viewWillChangeObservers)),void 0!==t.viewDidChange&&(this.observerCache.viewDidChangeObservers=e.Arrays.inserted(t,this.observerCache.viewDidChangeObservers)),void 0!==t.viewWillAnimate&&(this.observerCache.viewWillAnimateObservers=e.Arrays.inserted(t,this.observerCache.viewWillAnimateObservers)),void 0!==t.viewDidAnimate&&(this.observerCache.viewDidAnimateObservers=e.Arrays.inserted(t,this.observerCache.viewDidAnimateObservers)),void 0!==t.viewWillLayout&&(this.observerCache.viewWillLayoutObservers=e.Arrays.inserted(t,this.observerCache.viewWillLayoutObservers)),void 0!==t.viewDidLayout&&(this.observerCache.viewDidLayoutObservers=e.Arrays.inserted(t,this.observerCache.viewDidLayoutObservers))}onUnobserve(t){super.onUnobserve(t),void 0!==t.viewWillInsertChild&&(this.observerCache.viewWillInsertChildObservers=e.Arrays.removed(t,this.observerCache.viewWillInsertChildObservers)),void 0!==t.viewDidInsertChild&&(this.observerCache.viewDidInsertChildObservers=e.Arrays.removed(t,this.observerCache.viewDidInsertChildObservers)),void 0!==t.viewWillRemoveChild&&(this.observerCache.viewWillRemoveChildObservers=e.Arrays.removed(t,this.observerCache.viewWillRemoveChildObservers)),void 0!==t.viewDidRemoveChild&&(this.observerCache.viewDidRemoveChildObservers=e.Arrays.removed(t,this.observerCache.viewDidRemoveChildObservers)),void 0!==t.viewWillResize&&(this.observerCache.viewWillResizeObservers=e.Arrays.removed(t,this.observerCache.viewWillResizeObservers)),void 0!==t.viewDidResize&&(this.observerCache.viewDidResizeObservers=e.Arrays.removed(t,this.observerCache.viewDidResizeObservers)),void 0!==t.viewWillScroll&&(this.observerCache.viewWillScrollObservers=e.Arrays.removed(t,this.observerCache.viewWillScrollObservers)),void 0!==t.viewDidScroll&&(this.observerCache.viewDidScrollObservers=e.Arrays.removed(t,this.observerCache.viewDidScrollObservers)),void 0!==t.viewWillChange&&(this.observerCache.viewWillChangeObservers=e.Arrays.removed(t,this.observerCache.viewWillChangeObservers)),void 0!==t.viewDidChange&&(this.observerCache.viewDidChangeObservers=e.Arrays.removed(t,this.observerCache.viewDidChangeObservers)),void 0!==t.viewWillAnimate&&(this.observerCache.viewWillAnimateObservers=e.Arrays.removed(t,this.observerCache.viewWillAnimateObservers)),void 0!==t.viewDidAnimate&&(this.observerCache.viewDidAnimateObservers=e.Arrays.removed(t,this.observerCache.viewDidAnimateObservers)),void 0!==t.viewWillLayout&&(this.observerCache.viewWillLayoutObservers=e.Arrays.removed(t,this.observerCache.viewWillLayoutObservers)),void 0!==t.viewDidLayout&&(this.observerCache.viewDidLayoutObservers=e.Arrays.removed(t,this.observerCache.viewDidLayoutObservers))}init(t){void 0!==t.mood&&this.mood(t.mood),void 0!==t.moodModifier&&this.moodModifier(t.moodModifier),void 0!==t.theme&&this.theme(t.theme),void 0!==t.themeModifier&&this.themeModifier(t.themeModifier)}static create(){return new this}static fromInit(t){let i;i=("object"==typeof t&&null!==t||"function"==typeof t)&&e.Creatable.is(t.type)?t.type:this;const n=i.create();return n.init(t),n}static fromAny(t){if(null==t)return t;if(t instanceof fn){if(t instanceof this)return t;throw new TypeError(t+" not an instance of "+this)}return e.Creatable.is(t)?t.create():this.fromInit(t)}}fn.uid=function(){let t=1;return function(){const e=~~t;return t+=1,e}}(),fn.MountedFlag=i.Hierarchy.MountedFlag,fn.RemovingFlag=i.Hierarchy.RemovingFlag,fn.TraversingFlag=i.Hierarchy.TraversingFlag,fn.ProcessingFlag=1<<i.Hierarchy.FlagShift+0,fn.DisplayingFlag=1<<i.Hierarchy.FlagShift+1,fn.ContextualFlag=1<<i.Hierarchy.FlagShift+2,fn.CullFlag=1<<i.Hierarchy.FlagShift+3,fn.CulledFlag=1<<i.Hierarchy.FlagShift+4,fn.HideFlag=1<<i.Hierarchy.FlagShift+5,fn.HiddenFlag=1<<i.Hierarchy.FlagShift+6,fn.UnboundedFlag=1<<i.Hierarchy.FlagShift+7,fn.IntangibleFlag=1<<i.Hierarchy.FlagShift+8,fn.CulledMask=fn.CullFlag|fn.CulledFlag,fn.HiddenMask=fn.HideFlag|fn.HiddenFlag,fn.UpdatingMask=fn.ProcessingFlag|fn.DisplayingFlag,fn.StatusMask=fn.MountedFlag|fn.RemovingFlag|fn.TraversingFlag|fn.ProcessingFlag|fn.DisplayingFlag|fn.ContextualFlag|fn.CullFlag|fn.CulledFlag|fn.HiddenFlag|fn.UnboundedFlag|fn.IntangibleFlag,fn.NeedsProcess=1<<i.Hierarchy.FlagShift+9,fn.NeedsResize=1<<i.Hierarchy.FlagShift+10,fn.NeedsScroll=1<<i.Hierarchy.FlagShift+11,fn.NeedsChange=1<<i.Hierarchy.FlagShift+12,fn.NeedsAnimate=1<<i.Hierarchy.FlagShift+13,fn.NeedsProject=1<<i.Hierarchy.FlagShift+14,fn.ProcessMask=fn.NeedsProcess|fn.NeedsResize|fn.NeedsScroll|fn.NeedsChange|fn.NeedsAnimate|fn.NeedsProject,fn.NeedsDisplay=1<<i.Hierarchy.FlagShift+15,fn.NeedsLayout=1<<i.Hierarchy.FlagShift+16,fn.NeedsRender=1<<i.Hierarchy.FlagShift+17,fn.NeedsRasterize=1<<i.Hierarchy.FlagShift+18,fn.NeedsComposite=1<<i.Hierarchy.FlagShift+19,fn.DisplayMask=fn.NeedsDisplay|fn.NeedsLayout|fn.NeedsRender|fn.NeedsRasterize|fn.NeedsComposite,fn.UpdateMask=fn.ProcessMask|fn.DisplayMask,fn.FlagShift=i.Hierarchy.FlagShift+20,fn.FlagMask=(1<<fn.FlagShift)-1,fn.MountFlags=i.Hierarchy.MountFlags|fn.NeedsResize|fn.NeedsChange|fn.NeedsLayout,fn.UncullFlags=fn.NeedsResize|fn.NeedsChange|fn.NeedsLayout,fn.InsertChildFlags=i.Hierarchy.InsertChildFlags|fn.NeedsLayout,fn.RemoveChildFlags=i.Hierarchy.RemoveChildFlags|fn.NeedsLayout,u([i.Provider({extends:zi,type:Bi,observes:!1,service:Bi.global()})],fn.prototype,"viewportProvider",void 0),u([i.Provider({extends:Hi,type:Ui,observes:!1,service:Ui.global()})],fn.prototype,"displayProvider",void 0),u([i.Provider({extends:Gi,type:qi,observes:!1,service:qi.global()})],fn.prototype,"layoutProvider",void 0),u([i.Provider({extends:Yi,type:ji,observes:!1,service:ji.global()})],fn.prototype,"themeProvider",void 0),u([i.Provider({extends:Zi,type:Ki,observes:!1,service:Ki.global()})],fn.prototype,"modalProvider",void 0),u([i.Property({type:Wt,state:null,inherits:!0})],fn.prototype,"mood",void 0),u([i.Property({type:zt,state:null,inherits:!0})],fn.prototype,"theme",void 0),u([i.Property({type:Nt,state:null})],fn.prototype,"moodModifier",void 0),u([i.Property({type:Nt,state:null})],fn.prototype,"themeModifier",void 0);const gn=function(t){const e=t.extend("ViewRelation");return Object.defineProperty(e.prototype,"familyType",{get:function(){return e},configurable:!0}),e.prototype.initView=function(t){},e.prototype.willAttachView=function(t,e){},e.prototype.onAttachView=function(t,e){!0===this.observes&&t.observe(this)},e.prototype.didAttachView=function(t,e){},e.prototype.deinitView=function(t){},e.prototype.willDetachView=function(t){},e.prototype.onDetachView=function(t){!0===this.observes&&t.unobserve(this)},e.prototype.didDetachView=function(t){},Object.defineProperty(e.prototype,"parentView",{get(){const t=this.owner;return t instanceof fn?t:null},configurable:!0}),e.prototype.insertChild=function(t,e,i,n){t.insertChild(e,i,n)},e.prototype.bindView=function(t,e){},e.prototype.unbindView=function(t){},e.prototype.detectView=function(t){return null},e.prototype.createView=function(){let t;const e=this.type;if(void 0!==e&&(t=e.create()),null==t){let t="Unable to create ";throw 0!==this.name.length&&(t+=this.name+" "),t+="view",new Error(t)}return t},e.prototype.fromAny=function(t){const e=this.type;return void 0!==e?e.fromAny(t):fn.fromAny(t)},Object.defineProperty(e.prototype,"lazy",{get:function(){return!1},configurable:!0}),Object.defineProperty(e.prototype,"static",{get:function(){return!0},configurable:!0}),e.construct=function(e,i,n){return i=t.construct(e,i,n)},e.define=function(t,e){let i=e.extends;const n=e.affinity,s=e.inherits;delete e.extends,delete e.affinity,delete e.inherits,null==i&&(i=this);const o=i.extend(t,e);return o.construct=function(t,e,o){return e=i.construct(t,e,o),void 0!==n&&e.initAffinity(n),void 0!==s&&e.initInherits(s),e},o},e}(i.Fastener),vn=function(t){const i=t.extend("ViewRef");return Object.defineProperty(i.prototype,"familyType",{get:function(){return i},configurable:!0}),i.prototype.onInherit=function(t){this.setView(t.view)},i.prototype.getView=function(){const t=this.view;if(null===t){let e=t+" ";throw 0!==this.name.length&&(e+=this.name+" "),e+="view",new TypeError(e)}return t},i.prototype.setView=function(t,e,i){null!==t&&(t=this.fromAny(t));let n=this.view;if(n!==t){let s;void 0===e&&(e=null),this.binds&&(s=this.parentView,null!==s)&&(null!==n&&n.parent===s&&(null===e&&(e=s.nextChild(n)),n.remove()),null!==t&&(void 0===i&&(i=this.key),this.insertChild(s,t,e,i)),n=this.view),n!==t&&(null!==n&&(this.deactivateLayout(),this.willDetachView(n),this.view=null,this.onDetachView(n),this.deinitView(n),this.didDetachView(n)),null!==t&&(this.willAttachView(t,e),this.view=t,this.onAttachView(t,e),this.initView(t),this.didAttachView(t,e)))}return n},i.prototype.attachView=function(t,e){const i=this.view;return(t=null!=t?this.fromAny(t):null===i?this.createView():i)!==i&&(void 0===e&&(e=null),null!==i&&(this.deactivateLayout(),this.willDetachView(i),this.view=null,this.onDetachView(i),this.deinitView(i),this.didDetachView(i)),this.willAttachView(t,e),this.view=t,this.onAttachView(t,e),this.initView(t),this.didAttachView(t,e)),t},i.prototype.detachView=function(){const t=this.view;return null!==t&&(this.deactivateLayout(),this.willDetachView(t),this.view=null,this.onDetachView(t),this.deinitView(t),this.didDetachView(t)),t},i.prototype.insertView=function(t,e,i,n){if(null!=e)e=this.fromAny(e);else{const t=this.view;e=null===t?this.createView():t}null==t&&(t=this.parentView),void 0===i&&(i=null),void 0===n&&(n=this.key),null===t||e.parent===t&&e.key===n||this.insertChild(t,e,i,n);const s=this.view;return e!==s&&(null!==s&&(this.deactivateLayout(),this.willDetachView(s),this.view=null,this.onDetachView(s),this.deinitView(s),this.didDetachView(s),s.remove()),this.willAttachView(e,i),this.view=e,this.onAttachView(e,i),this.initView(e),this.didAttachView(e,i)),e},i.prototype.removeView=function(){const t=this.view;return null!==t&&t.remove(),t},i.prototype.deleteView=function(){const t=this.detachView();return null!==t&&t.remove(),t},i.prototype.bindView=function(t,e){if(this.binds&&null===this.view){const i=this.detectView(t);null!==i&&(this.willAttachView(i,e),this.view=i,this.onAttachView(i,e),this.initView(i),this.didAttachView(i,e))}},i.prototype.unbindView=function(t){if(this.binds){const e=this.detectView(t);null!==e&&this.view===e&&(this.deactivateLayout(),this.willDetachView(e),this.view=null,this.onDetachView(e),this.deinitView(e),this.didDetachView(e))}},i.prototype.detectView=function(t){const e=this.key;return void 0!==e&&e===t.key?t:null},i.prototype.constraint=function(t,e,i,n){t=a.ConstraintExpression.fromAny(t),void 0!==i&&(i=a.ConstraintExpression.fromAny(i));const s=void 0!==i?t.minus(i):t;n=void 0===n?a.ConstraintStrength.Required:a.ConstraintStrength.fromAny(n);const o=new a.Constraint(this.owner,s,e,n);return this.addConstraint(o),o},i.prototype.hasConstraint=function(t){return this.constraints.indexOf(t)>=0},i.prototype.addConstraint=function(t){const i=this.constraints,n=e.Arrays.inserted(t,i);i!==n&&(this.constraints=n,this.activateConstraint(t))},i.prototype.removeConstraint=function(t){const i=this.constraints,n=e.Arrays.removed(t,i);i!==n&&(this.deactivateConstraint(t),this.constraints=n)},i.prototype.activateConstraint=function(t){this.owner.activateConstraint(t)},i.prototype.deactivateConstraint=function(t){this.owner.deactivateConstraint(t)},i.prototype.constraintVariable=function(t,e,i){void 0===e&&(e=0),i=void 0!==i?a.ConstraintStrength.fromAny(i):a.ConstraintStrength.Strong;const n=a.ConstraintProperty.create(this);return Object.defineProperty(n,"name",{value:t,configurable:!0}),void 0!==e&&n.setState(e),n.setStrength(i),n.mount(),n},i.prototype.hasConstraintVariable=function(t){return this.constraintVariables.indexOf(t)>=0},i.prototype.addConstraintVariable=function(t){const i=this.constraintVariables,n=e.Arrays.inserted(t,i);i!==n&&(this.constraintVariables=n,this.activateConstraintVariable(t))},i.prototype.removeConstraintVariable=function(t){const i=this.constraintVariables,n=e.Arrays.removed(t,i);i!==n&&(this.deactivateConstraintVariable(t),this.constraintVariables=n)},i.prototype.activateConstraintVariable=function(t){this.owner.activateConstraintVariable(t)},i.prototype.deactivateConstraintVariable=function(t){this.owner.deactivateConstraintVariable(t)},i.prototype.setConstraintVariable=function(t,e){this.owner.setConstraintVariable(t,e)},i.prototype.activateLayout=function(){const t=this.constraintVariables;for(let e=0,i=t.length;e<i;e+=1)this.owner.activateConstraintVariable(t[e]);const e=this.constraints;for(let t=0,i=e.length;t<i;t+=1)this.owner.activateConstraint(e[t])},i.prototype.deactivateLayout=function(){const t=this.constraints;for(let e=0,i=t.length;e<i;e+=1)this.owner.deactivateConstraint(t[e]);const e=this.constraintVariables;for(let t=0,i=e.length;t<i;t+=1)this.owner.deactivateConstraintVariable(e[t])},i.prototype.onMount=function(){t.prototype.onMount.call(this),this.activateLayout()},i.prototype.onUnmount=function(){this.deactivateLayout(),t.prototype.onUnmount.call(this)},i.construct=function(i,n,s){return null===n&&(delete(n=function(t,e,i){return void 0===t?n.view:(n.setView(t,e,i),n.owner)}).name,Object.setPrototypeOf(n,i.prototype)),(n=t.construct(i,n,s)).view=null,n.constraints=e.Arrays.empty,n.constraintVariables=e.Arrays.empty,n},i.define=function(t,e){let i=e.extends;const n=e.affinity,s=e.inherits;delete e.extends,delete e.affinity,delete e.inherits,!0===e.key?Object.defineProperty(e,"key",{value:t,configurable:!0}):!1===e.key&&Object.defineProperty(e,"key",{value:void 0,configurable:!0}),null==i&&(i=this);const o=i.extend(t,e);return o.construct=function(t,e,o){return e=i.construct(t,e,o),void 0!==n&&e.initAffinity(n),void 0!==s&&e.initInherits(s),e},o},i}(gn),yn=function(t){const e=t.extend("ViewSet");return Object.defineProperty(e.prototype,"familyType",{get:function(){return e},configurable:!0}),e.prototype.hasView=function(t){return void 0!==this.views[t.uid]},e.prototype.addView=function(t,e,i){let n;t=null!=t?this.fromAny(t):this.createView(),void 0===e&&(e=null),this.binds&&(n=this.parentView,null!==n)&&(void 0===i&&(i=this.key(t)),this.insertChild(n,t,e,i));const s=this.views;return void 0===s[t.uid]&&(this.willAttachView(t,e),s[t.uid]=t,this.viewCount+=1,this.onAttachView(t,e),this.initView(t),this.didAttachView(t,e)),t},e.prototype.attachView=function(t,e){t=null!=t?this.fromAny(t):this.createView();const i=this.views;return void 0===i[t.uid]&&(void 0===e&&(e=null),this.willAttachView(t,e),i[t.uid]=t,this.viewCount+=1,this.onAttachView(t,e),this.initView(t),this.didAttachView(t,e)),t},e.prototype.detachView=function(t){const e=this.views;return void 0!==e[t.uid]?(this.willDetachView(t),this.viewCount-=1,delete e[t.uid],this.onDetachView(t),this.deinitView(t),this.didDetachView(t),t):null},e.prototype.insertView=function(t,e,i,n){e=null!=e?this.fromAny(e):this.createView(),null==t&&(t=this.parentView),void 0===i&&(i=null),void 0===n&&(n=this.key(e)),null===t||e.parent===t&&e.key===n||this.insertChild(t,e,i,n);const s=this.views;return void 0===s[e.uid]&&(this.willAttachView(e,i),s[e.uid]=e,this.viewCount+=1,this.onAttachView(e,i),this.initView(e),this.didAttachView(e,i)),e},e.prototype.removeView=function(t){return this.hasView(t)?(t.remove(),t):null},e.prototype.deleteView=function(t){const e=this.detachView(t);return null!==e&&e.remove(),e},e.prototype.bindView=function(t,e){if(this.binds){const i=this.detectView(t),n=this.views;null!==i&&void 0===n[i.uid]&&(this.willAttachView(i,e),n[i.uid]=i,this.viewCount+=1,this.onAttachView(i,e),this.initView(i),this.didAttachView(i,e))}},e.prototype.unbindView=function(t){if(this.binds){const e=this.detectView(t),i=this.views;null!==e&&void 0!==i[e.uid]&&(this.willDetachView(e),this.viewCount-=1,delete i[e.uid],this.onDetachView(e),this.deinitView(e),this.didDetachView(e))}},e.prototype.detectView=function(t){return"function"==typeof this.type&&t instanceof this.type?t:null},e.prototype.key=function(t){},e.construct=function(e,i,n){return null===i&&(delete(i=function(t){return i.addView(t),i.owner}).name,Object.setPrototypeOf(i,e.prototype)),(i=t.construct(e,i,n)).views={},i.viewCount=0,i},e.define=function(t,e){let i=e.extends;const n=e.affinity,s=e.inherits;delete e.extends,delete e.affinity,delete e.inherits,null==i&&(i=this);const o=i.extend(t,e);return o.construct=function(t,e,o){return e=i.construct(t,e,o),void 0!==n&&e.initAffinity(n),void 0!==s&&e.initInherits(s),e},o},e}(gn);class wn extends e.Service{onAttachRoot(t){super.onAttachRoot(t),t instanceof Xn&&t.node.hasAttribute("swim-app")&&this.materializeView(t)}materializeView(t){const e=t.node.childNodes;for(let i=0;i<e.length;i+=1){const n=e[i],s=this.materializeNode(t,n);null!==s&&this.materializeView(s)}}materializeNode(t,e){return void 0!==e.view?e.view:e instanceof Element?this.materializeElement(t,e):e instanceof Text?this.materializeText(t,e):null}materializeElement(t,e){let i;const n=e.getAttribute("swim-view");if(null!==n&&(i=wn.eval(n),"function"!=typeof i))throw new TypeError(n);void 0===i&&(i=e instanceof HTMLElement?Kn:e instanceof SVGElement?Qn:Xn);const s=new i(e),o=e.getAttribute("key");return t.injectChild(s,null,null!==o?o:void 0),s}materializeText(t,e){return null}static global(){return new wn}static boot(){const t=[],e=document.querySelectorAll("[swim-app]");for(let i=0;i<e.length;i+=1){const n=e[i];if(n instanceof HTMLElement){const e=wn.bootElement(n);t.push(e)}}return t}static bootElement(t){let e=t.view;if(void 0===e){let i;const n=t.getAttribute("swim-app");if(null!==n&&""!==n&&(i=wn.eval(n),"function"!=typeof i))throw new TypeError(n);if(void 0===i&&(i=t instanceof HTMLElement?Kn:t instanceof SVGElement?Qn:Xn),e=new i(t),i.mount(e),void 0===e.domProvider)throw new Error("dom service not available")}return e}static eval(t){let e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:void 0;const i=t.split(".");for(let t=0,n=i.length;"object"==typeof e&&null!==e&&t<n;t+=1){e=e[i[t]]}return e}}u([e.Lazy],wn,"global",null);const mn=function(t){const e=t.extend("DomProvider");return e.prototype.createService=function(){return wn.global()},e}(i.Provider),bn=function(t){const n=t.extend("AttributeAnimator");return Object.defineProperty(n.prototype,"attributeName",{get(){throw new Error("no attribute name")},configurable:!0}),Object.defineProperty(n.prototype,"attributeValue",{get:function(){const t=this.owner;if(t instanceof Xn){const e=t.getAttribute(this.attributeName);if(null!==e)try{return this.parse(e)}catch(t){}}},configurable:!0}),Object.defineProperty(n.prototype,"value",{get(){let t=this.ownValue;if(!this.isDefined(t)){const e=this.attributeValue;void 0!==e&&(t=e,this.setAffinity(i.Affinity.Extrinsic))}return t},set(t){this.ownValue=t},configurable:!0}),n.prototype.onSetValue=function(e,i){const n=this.owner;n instanceof Xn&&n.setAttribute(this.attributeName,e),t.prototype.onSetValue.call(this,e,i)},n.prototype.parse=function(){throw new Error},n.construct=function(e,i,n){return i=t.construct(e,i,n)},n.specialize=function(t){return t===String?Cn:t===Number?Sn:t===Boolean?An:t===s.Length?xn:t===z?Dn:t===s.Transform?Tn:null},n.define=function(t,i){let n=i.extends;const s=i.affinity,o=i.inherits,r=i.look,l=i.state,a=i.initState;delete i.extends,delete i.affinity,delete i.inherits,delete i.look,delete i.state,delete i.initState,null==n&&(n=this.specialize(i.type)),null===n&&(n=this,void 0===i.fromAny&&e.FromAny.is(i.type)&&(i.fromAny=i.type.fromAny));const h=n.extend(t,i);return h.construct=function(t,e,i){return e=n.construct(t,e,i),void 0!==s&&e.initAffinity(s),void 0!==o&&e.initInherits(o),void 0!==r&&(e.look=r),void 0!==a?(e.state=e.fromAny(a()),e.value=e.state):void 0!==l&&(e.state=e.fromAny(l),e.value=e.state),e},h},n}(Ht),Cn=function(t){const e=t.extend("StringAttributeAnimator");return e.prototype.parse=function(t){return t},e.prototype.fromAny=function(t){return t},e.prototype.equalState=function(t,e){return t===e},e}(bn),Sn=function(t){const e=t.extend("NumberAttributeAnimator");return e.prototype.parse=function(t){const e=+t;return isFinite(e)?e:void 0},e.prototype.fromAny=function(t){if("number"==typeof t)return t;{const e=+t;return isFinite(e)?e:void 0}},e.prototype.equalState=function(t,e){return t===e},e}(bn),An=function(t){const e=t.extend("BooleanAttributeAnimator");return e.prototype.parse=function(t){return!!t},e.prototype.fromAny=function(t){return!!t},e.prototype.equalState=function(t,e){return t===e},e}(bn),xn=function(t){const e=t.extend("LengthAttributeAnimator");return e.prototype.parse=function(t){return s.Length.parse(t)},e.prototype.fromAny=function(t){try{return s.Length.fromAny(t)}catch(t){return null}},e.prototype.equalState=function(t,e){return null!=t?t.equals(e):t===e},e}(bn),Dn=function(t){const e=t.extend("ColorAttributeAnimator");return e.prototype.parse=function(t){return z.parse(t)},e.prototype.fromAny=function(t){try{return z.fromAny(t)}catch(t){return null}},e.prototype.equalState=function(t,e){return null!=t?t.equals(e):t===e},e}(bn),Tn=function(t){const e=t.extend("TransformAttributeAnimator");return e.prototype.parse=function(t){return s.Transform.parse(t)},e.prototype.fromAny=function(t){try{return s.Transform.fromAny(t)}catch(t){return null}},e.prototype.equalState=function(t,e){return null!=t?t.equals(e):t===e},e}(bn),Pn=function(t){const n=t.extend("StyleAnimator");return Object.defineProperty(n.prototype,"propertyNames",{get(){throw new Error("no property names")},configurable:!0}),Object.defineProperty(n.prototype,"propertyValue",{get:function(){let t;const e=this.owner;if(Nn.is(e)){let i=e.getStyle(this.propertyNames);if("undefined"!=typeof CSSStyleValue&&i instanceof CSSStyleValue){try{t=this.fromCssValue(i)}catch(t){}void 0===t&&(i=i.toString())}if("string"==typeof i&&0!==i.length)try{t=this.parse(i)}catch(t){}}return t},configurable:!0}),Object.defineProperty(n.prototype,"computedValue",{get:function(){let t;const e=this.owner;let i;if(Nn.is(e)&&(i=e.node,i instanceof Element)){const e=getComputedStyle(i),n=this.propertyNames;let s="";if("string"==typeof n)s=e.getPropertyValue(n);else for(let t=0,i=n.length;t<i&&0===s.length;t+=1)s=e.getPropertyValue(n[t]);if(0!==s.length)try{t=this.parse(s)}catch(t){}}return t},configurable:!0}),Object.defineProperty(n.prototype,"value",{get(){let t=this.ownValue;if(!this.isDefined(t)){const e=this.propertyValue;void 0!==e&&(t=e,this.setAffinity(i.Affinity.Extrinsic))}return t},set(t){this.ownValue=t},configurable:!0}),n.prototype.onSetValue=function(e,i){const n=this.owner;if(Nn.is(n)){const t=this.propertyNames;if("string"==typeof t)n.setStyle(t,e,this.priority);else for(let i=0,s=t.length;i<s;i+=1)n.setStyle(t[i],e,this.priority)}t.prototype.onSetValue.call(this,e,i)},n.prototype.setPriority=function(t){this.priority=t;const e=this.owner,i=this.value;if(Nn.is(e)&&this.isDefined(i)){const n=this.propertyNames;if("string"==typeof n)e.setStyle(n,i,t);else for(let s=0,o=n.length;s<o;s+=1)e.setStyle(n[s],i,t)}},n.prototype.parse=function(){throw new Error},n.prototype.fromCssValue=function(t){throw new Error},n.construct=function(e,i,n){return(i=t.construct(e,i,n)).priority=void 0,i},n.specialize=function(t){return t===String?Vn:t===Number?In:t===s.Length?Mn:t===z?Rn:t===k?Fn:t===rt?Ln:t===s.Transform?kn:null},n.define=function(t,i){let n=i.extends;const s=i.affinity,o=i.inherits,r=i.look,l=i.state,a=i.initState;delete i.extends,delete i.affinity,delete i.inherits,delete i.look,delete i.state,delete i.initState,null==n&&(n=this.specialize(i.type)),null===n&&(n=this,void 0===i.fromAny&&e.FromAny.is(i.type)&&(i.fromAny=i.type.fromAny));const h=n.extend(t,i);return h.construct=function(t,e,i){return e=n.construct(t,e,i),void 0!==s&&e.initAffinity(s),void 0!==o&&e.initInherits(o),void 0!==r&&(e.look=r),void 0!==a?(e.state=e.fromAny(a()),e.value=e.state):void 0!==l&&(e.state=e.fromAny(l),e.value=e.state),e},h},n}(Ht),Vn=function(t){const e=t.extend("StringStyleAnimator");return e.prototype.parse=function(t){return t},e.prototype.fromCssValue=function(t){return t.toString()},e.prototype.fromAny=function(t){return t},e.prototype.equalState=function(t,e){return t===e},e}(Pn),In=function(t){const e=t.extend("NumberStyleAnimator");return e.prototype.parse=function(t){const e=+t;return isFinite(e)?e:void 0},e.prototype.fromCssValue=function(t){return t instanceof CSSNumericValue?t.to("number").value:void 0},e.prototype.fromAny=function(t){if("number"==typeof t)return t;{const e=+t;return isFinite(e)?e:void 0}},e.prototype.equalState=function(t,e){return t===e},e}(Pn),Mn=function(t){const e=t.extend("LengthStyleAnimator");return e.prototype.parse=function(t){return s.Length.parse(t)},e.prototype.fromCssValue=function(t){return s.Length.fromCssValue(t)},e.prototype.fromAny=function(t){try{return s.Length.fromAny(t)}catch(t){return null}},e.prototype.equalState=function(t,e){return null!=t?t.equals(e):t===e},e}(Pn),Rn=function(t){const e=t.extend("ColorStyleAnimator");return e.prototype.parse=function(t){return z.parse(t)},e.prototype.fromAny=function(t){try{return z.fromAny(t)}catch(t){return null}},e.prototype.equalState=function(t,e){return null!=t?t.equals(e):t===e},e}(Pn),Fn=function(t){const e=t.extend("FontFamilyStyleAnimator");return e.prototype.parse=function(t){return E.parse(t).family},e.prototype.fromAny=function(t){return E.family(t).family},e}(Pn),Ln=function(t){const e=t.extend("BoxShadowStyleAnimator");return e.prototype.parse=function(t){return rt.parse(t)},e.prototype.fromAny=function(t){return rt.fromAny(t)},e.prototype.equalState=function(t,e){return null!=t?t.equals(e):t===e},e}(Pn),kn=function(t){const e=t.extend("TransformStyleAnimator");return e.prototype.parse=function(t){return s.Transform.parse(t)},e.prototype.fromCssValue=function(t){return s.Transform.fromCssValue(t)},e.prototype.fromAny=function(t){try{return s.Transform.fromAny(t)}catch(t){return null}},e.prototype.equalState=function(t,e){return null!=t?t.equals(e):t===e},e}(Pn),On=function(t){const n=t.extend("StyleConstraintAnimator");return n.prototype.isExternal=function(){return!0},n.prototype.isDummy=function(){return!1},n.prototype.isInvalid=function(){return!1},n.prototype.isConstant=function(){return!1},n.prototype.evaluateConstraintVariable=function(){const t=this.owner;if(a.ConstraintScope.is(t)&&!this.constrained&&this.constraining){const e=this.constraintValue;void 0!==e&&this.isDefined(e)&&t.setConstraintVariable(this,this.toNumber(e))}},n.prototype.updateConstraintSolution=function(t){this.constrained&&this.toNumber(this.state)!==t&&this.setState(t,i.Affinity.Reflexive)},n.prototype.setStrength=function(t){this.strength=a.ConstraintStrength.fromAny(t)},Object.defineProperty(n.prototype,"coefficient",{get:()=>1,configurable:!0}),Object.defineProperty(n.prototype,"variable",{get(){return this},configurable:!0}),Object.defineProperty(n.prototype,"terms",{get(){const t=new a.ConstraintMap;return t.set(this,1),t},configurable:!0}),Object.defineProperty(n.prototype,"constant",{get:()=>0,configurable:!0}),n.prototype.plus=function(t){return this===(t=a.ConstraintExpression.fromAny(t))?a.ConstraintExpression.product(2,this):a.ConstraintExpression.sum(this,t)},n.prototype.negative=function(){return a.ConstraintExpression.product(-1,this)},n.prototype.minus=function(t){return this===(t=a.ConstraintExpression.fromAny(t))?a.ConstraintExpression.zero:a.ConstraintExpression.sum(this,t.negative())},n.prototype.times=function(t){return a.ConstraintExpression.product(t,this)},n.prototype.divide=function(t){return a.ConstraintExpression.product(1/t,this)},Object.defineProperty(n.prototype,"constrained",{get(){return 0!=(this.flags&n.ConstrainedFlag)},configurable:!0}),n.prototype.constrain=function(t){void 0===t&&(t=!0);const e=this.flags;return t&&0==(e&n.ConstrainedFlag)?(this.setFlags(e|n.ConstrainedFlag),0!==this.conditionCount&&this.mounted&&this.stopConstraining()):t||0==(e&n.ConstrainedFlag)||(this.setFlags(e&~n.ConstrainedFlag),0!==this.conditionCount&&this.mounted&&(this.startConstraining(),this.updateConstraintVariable())),this},n.prototype.addConstraintCondition=function(t,e){this.conditionCount+=1,!this.constrained&&1===this.conditionCount&&this.mounted&&(this.startConstraining(),this.updateConstraintVariable())},n.prototype.removeConstraintCondition=function(t,e){this.conditionCount-=1,!this.constrained&&0===this.conditionCount&&this.mounted&&this.stopConstraining()},Object.defineProperty(n.prototype,"constraining",{get(){return 0!=(this.flags&n.ConstrainingFlag)},configurable:!0}),n.prototype.startConstraining=function(){0==(this.flags&n.ConstrainingFlag)&&(this.willStartConstraining(),this.setFlags(this.flags|n.ConstrainingFlag),this.onStartConstraining(),this.didStartConstraining())},n.prototype.willStartConstraining=function(){},n.prototype.onStartConstraining=function(){const t=this.owner;a.ConstraintScope.is(t)&&t.addConstraintVariable(this)},n.prototype.didStartConstraining=function(){},n.prototype.stopConstraining=function(){0!=(this.flags&n.ConstrainingFlag)&&(this.willStopConstraining(),this.setFlags(this.flags&~n.ConstrainingFlag),this.onStopConstraining(),this.didStopConstraining())},n.prototype.willStopConstraining=function(){},n.prototype.onStopConstraining=function(){const t=this.owner;a.ConstraintScope.is(t)&&t.removeConstraintVariable(this)},n.prototype.didStopConstraining=function(){},n.prototype.updateConstraintVariable=function(){const t=this.owner;if(a.ConstraintScope.is(t)){let e=this.value;this.isDefined(e)||(e=this.constraintValue),t.setConstraintVariable(this,this.toNumber(e))}},n.prototype.onSetValue=function(e,i){t.prototype.onSetValue.call(this,e,i);const n=this.owner;this.constraining&&a.ConstraintScope.is(n)&&n.setConstraintVariable(this,null!=e?this.toNumber(e):0)},n.prototype.onMount=function(){t.prototype.onMount.call(this),this.constrained||0===this.conditionCount||this.startConstraining()},n.prototype.onUnmount=function(){this.constrained||0===this.conditionCount||this.stopConstraining(),t.prototype.onUnmount.call(this)},n.prototype.fromAny=function(t){if("string"==typeof t){const e=+t;if(isFinite(e))return e}return t},n.prototype.toNumber=function(t){return null!=t?+t:0},n.construct=function(e,i,n){return(i=t.construct(e,i,n)).id=a.ConstraintId.next(),i.strength=a.ConstraintStrength.Strong,i.conditionCount=0,i},n.specialize=function(t){return t===Number?En:t===s.Length?Wn:null},n.define=function(t,i){let n=i.extends;const s=i.affinity,o=i.inherits,r=void 0!==i.strength?a.ConstraintStrength.fromAny(i.strength):void 0,l=i.constrain,h=i.look,d=i.state,c=i.initState;delete i.extends,delete i.affinity,delete i.inherits,delete i.strength,delete i.constrain,delete i.look,delete i.state,delete i.initState,null==n&&(n=this.specialize(i.type)),null===n&&(n=this,void 0===i.fromAny&&e.FromAny.is(i.type)&&(i.fromAny=i.type.fromAny));const u=n.extend(t,i);return u.construct=function(t,e,i){return e=n.construct(t,e,i),void 0!==s&&e.initAffinity(s),void 0!==o&&e.initInherits(o),void 0!==r&&(e.strength=r),void 0!==h&&(e.look=h),void 0!==c?(e.state=e.fromAny(c()),e.value=e.state):void 0!==d&&(e.state=e.fromAny(d),e.value=e.state),!0===l&&e.constrain(),e},u},n.ConstrainedFlag=1<<t.FlagShift+0,n.ConstrainingFlag=1<<t.FlagShift+1,n.FlagShift=t.FlagShift+2,n.FlagMask=(1<<n.FlagShift)-1,n}(Pn),En=function(t){const e=t.extend("NumberStyleConstraintAnimator");return e.prototype.toNumber=function(t){return"number"==typeof t?t:0},e.prototype.parse=function(t){const e=+t;return isFinite(e)?e:void 0},e.prototype.fromCssValue=function(t){return t instanceof CSSNumericValue?t.to("number").value:void 0},e.prototype.fromAny=function(t){if("number"==typeof t)return t;{const e=+t;return isFinite(e)?e:void 0}},e.prototype.equalState=function(t,e){return t===e},e}(On),Wn=function(t){const e=t.extend("LengthStyleConstraintAnimator");return e.prototype.toNumber=function(t){if(!(t instanceof s.PxLength)){const e=this.computedValue;null!=e&&(t=e)}return t instanceof s.PxLength?t.value:0},e.prototype.parse=function(t){return s.Length.parse(t)},e.prototype.fromCssValue=function(t){return s.Length.fromCssValue(t)},e.prototype.fromAny=function(t){try{return s.Length.fromAny(t)}catch(t){return null}},e.prototype.equalState=function(t,e){return null!=t?t.equals(e):t===e},e}(On),Nn=function(){const t={is:function(t){if("object"==typeof t&&null!==t||"function"==typeof t){return"getStyle"in t}return!1}};return t}(),Bn=function(){const t={};function i(t,i,n){if(void 0===t){const t=this.borderTopColor.value,i=this.borderRightColor.value,n=this.borderBottomColor.value,s=this.borderLeftColor.value;return e.Values.equal(t,i)&&e.Values.equal(i,n)&&e.Values.equal(n,s)?t:[t,i,n,s]}return Array.isArray(t)?(t.length>=1&&this.borderTopColor.setState(t[0],i,n),t.length>=2&&this.borderRightColor.setState(t[1],i,n),t.length>=3&&this.borderBottomColor.setState(t[2],i,n),t.length>=4&&this.borderLeftColor.setState(t[3],i,n)):(this.borderTopColor.setState(t,i,n),this.borderRightColor.setState(t,i,n),this.borderBottomColor.setState(t,i,n),this.borderLeftColor.setState(t,i,n)),this}function n(t,i,n){if(void 0===t){const t=this.borderTopLeftRadius.value,i=this.borderTopRightRadius.value,n=this.borderBottomRightRadius.value,s=this.borderBottomLeftRadius.value;return e.Equals(t,i)&&e.Equals(i,n)&&e.Equals(n,s)?t:[t,i,n,s]}return Array.isArray(t)?(t.length>=1&&this.borderTopLeftRadius.setState(t[0],i,n),t.length>=2&&this.borderTopRightRadius.setState(t[1],i,n),t.length>=3&&this.borderBottomRightRadius.setState(t[2],i,n),t.length>=4&&this.borderBottomLeftRadius.setState(t[3],i,n)):(this.borderTopLeftRadius.setState(t,i,n),this.borderTopRightRadius.setState(t,i,n),this.borderBottomRightRadius.setState(t,i,n),this.borderBottomLeftRadius.setState(t,i,n)),this}function o(t,e,i){if(void 0===t){const t=this.borderTopStyle.value,e=this.borderRightStyle.value,i=this.borderBottomStyle.value,n=this.borderLeftStyle.value;return t===e&&e===i&&i===n?t:[t,e,i,n]}return Array.isArray(t)?(t.length>=1&&this.borderTopStyle.setState(t[0],e,i),t.length>=2&&this.borderRightStyle.setState(t[1],e,i),t.length>=3&&this.borderBottomStyle.setState(t[2],e,i),t.length>=4&&this.borderLeftStyle.setState(t[3],e,i)):(this.borderTopStyle.setState(t,e,i),this.borderRightStyle.setState(t,e,i),this.borderBottomStyle.setState(t,e,i),this.borderLeftStyle.setState(t,e,i)),this}function r(t,i,n){if(void 0===t){const t=this.borderTopWidth.value,i=this.borderRightWidth.value,n=this.borderBottomWidth.value,s=this.borderLeftWidth.value;return e.Values.equal(t,i)&&e.Values.equal(i,n)&&e.Values.equal(n,s)?t:[t,i,n,s]}return Array.isArray(t)?(t.length>=1&&this.borderTopWidth.setState(t[0],i,n),t.length>=2&&this.borderRightWidth.setState(t[1],i,n),t.length>=3&&this.borderBottomWidth.setState(t[2],i,n),t.length>=4&&this.borderLeftWidth.setState(t[3],i,n)):(this.borderTopWidth.setState(t,i,n),this.borderRightWidth.setState(t,i,n),this.borderBottomWidth.setState(t,i,n),this.borderLeftWidth.setState(t,i,n)),this}function l(t,e,i){if(void 0===t){const t=this.fontStyle.value,e=this.fontVariant.value,i=this.fontWeight.value,n=this.fontStretch.value,s=this.fontSize.value,o=this.lineHeight.value,r=this.fontFamily.value;return void 0!==r?E.create(t,e,i,n,s,o,r):null}return null!==t?(void 0!==(t=E.fromAny(t)).style&&this.fontStyle.setState(t.style,e,i),void 0!==t.variant&&this.fontVariant.setState(t.variant,e,i),void 0!==t.weight&&this.fontWeight.setState(t.weight,e,i),void 0!==t.stretch&&this.fontStretch.setState(t.stretch,e,i),void 0!==t.size&&this.fontSize.setState(t.size,e,i),void 0!==t.height&&this.lineHeight.setState(t.height,e,i),this.fontFamily.setState(t.family,e,i)):(this.fontStyle.setState(void 0,e,i),this.fontVariant.setState(void 0,e,i),this.fontWeight.setState(void 0,e,i),this.fontStretch.setState(void 0,e,i),this.fontSize.setState(null,e,i),this.lineHeight.setState(null,e,i),this.fontFamily.setState(void 0,e,i)),this}function a(t,i,n){if(void 0===t){const t=this.marginTop.value,i=this.marginRight.value,n=this.marginBottom.value,s=this.marginLeft.value;return e.Values.equal(t,i)&&e.Values.equal(i,n)&&e.Values.equal(n,s)?t:[t,i,n,s]}return Array.isArray(t)?(t.length>=1&&this.marginTop.setState(t[0],i,n),t.length>=2&&this.marginRight.setState(t[1],i,n),t.length>=3&&this.marginBottom.setState(t[2],i,n),t.length>=4&&this.marginLeft.setState(t[3],i,n)):(this.marginTop.setState(t,i,n),this.marginRight.setState(t,i,n),this.marginBottom.setState(t,i,n),this.marginLeft.setState(t,i,n)),this}function h(t,e,i){if(void 0===t){const t=this.overflowX.value,e=this.overflowY.value;return t===e?t:[t,e]}return Array.isArray(t)?(t.length>=1&&this.overflowX.setState(t[0],e,i),t.length>=2&&this.overflowY.setState(t[1],e,i)):(this.overflowX.setState(t,e,i),this.overflowY.setState(t,e,i)),this}function d(t,e,i){if(void 0===t){const t=this.overscrollBehaviorX.value,e=this.overscrollBehaviorY.value;return t===e?t:[t,e]}return Array.isArray(t)?(t.length>=1&&this.overscrollBehaviorX.setState(t[0],e,i),t.length>=2&&this.overscrollBehaviorY.setState(t[1],e,i)):(this.overscrollBehaviorX.setState(t,e,i),this.overscrollBehaviorY.setState(t,e,i)),this}function c(t,i,n){if(void 0===t){const t=this.paddingTop.value,i=this.paddingRight.value,n=this.paddingBottom.value,s=this.paddingLeft.value;return e.Equals(t,i)&&e.Equals(i,n)&&e.Equals(n,s)?t:[t,i,n,s]}return Array.isArray(t)?(t.length>=1&&this.paddingTop.setState(t[0],i,n),t.length>=2&&this.paddingRight.setState(t[1],i,n),t.length>=3&&this.paddingBottom.setState(t[2],i,n),t.length>=4&&this.paddingLeft.setState(t[3],i,n)):(this.paddingTop.setState(t,i,n),this.paddingRight.setState(t,i,n),this.paddingBottom.setState(t,i,n),this.paddingLeft.setState(t,i,n)),this}return t.init=function(t,e){void 0!==e.alignContent&&(e.alignContent,t.alignContent(e.alignContent)),void 0!==e.alignItems&&t.alignItems(e.alignItems),void 0!==e.alignSelf&&t.alignSelf(e.alignSelf),void 0!==e.appearance&&t.appearance(e.appearance),void 0!==e.backdropFilter&&t.backdropFilter(e.backdropFilter),void 0!==e.backgroundClip&&t.backgroundClip(e.backgroundClip),void 0!==e.backgroundColor&&t.backgroundColor(e.backgroundColor),void 0!==e.backgroundImage&&t.backgroundImage(e.backgroundImage),void 0!==e.borderCollapse&&t.borderCollapse(e.borderCollapse),void 0!==e.borderColor&&t.borderColor(e.borderColor),void 0!==e.borderTopColor&&t.borderTopColor(e.borderTopColor),void 0!==e.borderRightColor&&t.borderRightColor(e.borderRightColor),void 0!==e.borderBottomColor&&t.borderBottomColor(e.borderBottomColor),void 0!==e.borderLeftColor&&t.borderLeftColor(e.borderLeftColor),void 0!==e.borderRadius&&t.borderRadius(e.borderRadius),void 0!==e.borderTopLeftRadius&&t.borderTopLeftRadius(e.borderTopLeftRadius),void 0!==e.borderTopRightRadius&&t.borderTopRightRadius(e.borderTopRightRadius),void 0!==e.borderBottomRightRadius&&t.borderBottomRightRadius(e.borderBottomRightRadius),void 0!==e.borderBottomLeftRadius&&t.borderBottomLeftRadius(e.borderBottomLeftRadius),void 0!==e.borderSpacing&&t.borderSpacing(e.borderSpacing),void 0!==e.borderStyle&&t.borderStyle(e.borderStyle),void 0!==e.borderTopStyle&&t.borderTopStyle(e.borderTopStyle),void 0!==e.borderRightStyle&&t.borderRightStyle(e.borderRightStyle),void 0!==e.borderBottomStyle&&t.borderBottomStyle(e.borderBottomStyle),void 0!==e.borderLeftStyle&&t.borderLeftStyle(e.borderLeftStyle),void 0!==e.borderWidth&&t.borderWidth(e.borderWidth),void 0!==e.borderTopWidth&&t.borderTopWidth(e.borderTopWidth),void 0!==e.borderRightWidth&&t.borderRightWidth(e.borderRightWidth),void 0!==e.borderBottomWidth&&t.borderBottomWidth(e.borderBottomWidth),void 0!==e.borderLeftWidth&&t.borderLeftWidth(e.borderLeftWidth),void 0!==e.bottom&&t.bottom(e.bottom),void 0!==e.boxShadow&&t.boxShadow(e.boxShadow),void 0!==e.boxSizing&&t.boxSizing(e.boxSizing),void 0!==e.color&&t.color(e.color),void 0!==e.cursor&&t.cursor(e.cursor),void 0!==e.display&&t.display(e.display),void 0!==e.filter&&t.filter(e.filter),void 0!==e.flexBasis&&t.flexBasis(e.flexBasis),void 0!==e.flexDirection&&t.flexDirection(e.flexDirection),void 0!==e.flexGrow&&t.flexGrow(e.flexGrow),void 0!==e.flexShrink&&t.flexShrink(e.flexShrink),void 0!==e.flexWrap&&t.flexWrap(e.flexWrap),void 0!==e.font&&t.font(e.font),void 0!==e.fontFamily&&t.fontFamily(e.fontFamily),void 0!==e.fontSize&&t.fontSize(e.fontSize),void 0!==e.fontStretch&&t.fontStretch(e.fontStretch),void 0!==e.fontStyle&&t.fontStyle(e.fontStyle),void 0!==e.fontVariant&&t.fontVariant(e.fontVariant),void 0!==e.fontWeight&&t.fontWeight(e.fontWeight),void 0!==e.height&&t.height(e.height),void 0!==e.justifyContent&&t.justifyContent(e.justifyContent),void 0!==e.left&&t.left(e.left),void 0!==e.lineHeight&&t.lineHeight(e.lineHeight),void 0!==e.margin&&t.margin(e.margin),void 0!==e.marginTop&&t.marginTop(e.marginTop),void 0!==e.marginRight&&t.marginRight(e.marginRight),void 0!==e.marginBottom&&t.marginBottom(e.marginBottom),void 0!==e.marginLeft&&t.marginLeft(e.marginLeft),void 0!==e.maxHeight&&t.maxHeight(e.maxHeight),void 0!==e.maxWidth&&t.maxWidth(e.maxWidth),void 0!==e.minHeight&&t.minHeight(e.minHeight),void 0!==e.minWidth&&t.minWidth(e.minWidth),void 0!==e.opacity&&t.opacity(e.opacity),void 0!==e.order&&t.order(e.order),void 0!==e.outlineColor&&t.outlineColor(e.outlineColor),void 0!==e.outlineStyle&&t.outlineStyle(e.outlineStyle),void 0!==e.outlineWidth&&t.outlineWidth(e.outlineWidth),void 0!==e.overflow&&t.overflow(e.overflow),void 0!==e.overflowX&&t.overflowX(e.overflowX),void 0!==e.overflowY&&t.overflowY(e.overflowY),void 0!==e.overflowScrolling&&t.overflowScrolling(e.overflowScrolling),void 0!==e.overscrollBehavior&&t.overscrollBehavior(e.overscrollBehavior),void 0!==e.overscrollBehaviorX&&t.overscrollBehaviorX(e.overscrollBehaviorX),void 0!==e.overscrollBehaviorY&&t.overscrollBehaviorY(e.overscrollBehaviorY),void 0!==e.padding&&t.padding(e.padding),void 0!==e.paddingTop&&t.paddingTop(e.paddingTop),void 0!==e.paddingRight&&t.paddingRight(e.paddingRight),void 0!==e.paddingBottom&&t.paddingBottom(e.paddingBottom),void 0!==e.paddingLeft&&t.paddingLeft(e.paddingLeft),void 0!==e.pointerEvents&&t.pointerEvents(e.pointerEvents),void 0!==e.position&&t.position(e.position),void 0!==e.right&&t.right(e.right),void 0!==e.textAlign&&t.textAlign(e.textAlign),void 0!==e.textDecorationColor&&t.textDecorationColor(e.textDecorationColor),void 0!==e.textDecorationLine&&t.textDecorationLine(e.textDecorationLine),void 0!==e.textDecorationStyle&&t.textDecorationStyle(e.textDecorationStyle),void 0!==e.textOverflow&&t.textOverflow(e.textOverflow),void 0!==e.textTransform&&t.textTransform(e.textTransform),void 0!==e.top&&t.top(e.top),void 0!==e.touchAction&&t.touchAction(e.touchAction),void 0!==e.transform&&t.transform(e.transform),void 0!==e.userSelect&&t.userSelect(e.userSelect),void 0!==e.verticalAlign&&t.verticalAlign(e.verticalAlign),void 0!==e.visibility&&t.visibility(e.visibility),void 0!==e.whiteSpace&&t.whiteSpace(e.whiteSpace),void 0!==e.width&&t.width(e.width),void 0!==e.zIndex&&t.zIndex(e.zIndex)},t.define=function(t){Pn({propertyNames:"align-content",type:String})(t,"alignContent"),Pn({propertyNames:"align-items",type:String})(t,"alignItems"),Pn({propertyNames:"align-self",type:String})(t,"alignSelf"),Pn({propertyNames:["appearance","-webkit-appearance"],type:String})(t,"appearance"),Pn({propertyNames:["backdrop-filter","-webkit-backdrop-filter"],type:String})(t,"backdropFilter"),Pn({propertyNames:["background-clip","-webkit-background-clip"],type:String})(t,"backgroundClip"),Pn({propertyNames:"background-color",type:z,state:null})(t,"backgroundColor"),Pn({propertyNames:"background-image",type:z,state:null,parse(t){try{return it.parse(t)}catch(e){return t}},fromAny(t){if("string"!=typeof t)return it.fromAny(t);try{return it.parse(t)}catch(e){return t}}})(t,"backgroundImage"),Pn({propertyNames:"border-collapse",type:String})(t,"borderCollapse"),t.borderColor=i,Pn({propertyNames:"border-top-color",type:z,state:null})(t,"borderTopColor"),Pn({propertyNames:"border-right-color",type:z,state:null})(t,"borderRightColor"),Pn({propertyNames:"border-bottom-color",type:z,state:null})(t,"borderBottomColor"),Pn({propertyNames:"border-left-color",type:z,state:null})(t,"borderLeftColor"),t.borderRadius=n,Pn({propertyNames:"border-top-left-radius",type:s.Length,state:null})(t,"borderTopLeftRadius"),Pn({propertyNames:"border-top-right-radius",type:s.Length,state:null})(t,"borderTopRightRadius"),Pn({propertyNames:"border-bottom-right-radius",type:s.Length,state:null})(t,"borderBottomRightRadius"),Pn({propertyNames:"border-bottom-left-radius",type:s.Length,state:null})(t,"borderBottomLeftRadius"),Pn({propertyNames:"border-spacing",type:String})(t,"borderSpacing"),t.borderStyle=o,Pn({propertyNames:"border-top-style",type:String})(t,"borderTopStyle"),Pn({propertyNames:"border-right-style",type:String})(t,"borderRightStyle"),Pn({propertyNames:"border-bottom-style",type:String})(t,"borderBottomStyle"),Pn({propertyNames:"border-left-style",type:String})(t,"borderLeftStyle"),t.borderWidth=r,Pn({propertyNames:"border-top-width",type:s.Length,state:null})(t,"borderTopWidth"),Pn({propertyNames:"border-right-width",type:s.Length,state:null})(t,"borderRightWidth"),Pn({propertyNames:"border-bottom-width",type:s.Length,state:null})(t,"borderBottomWidth"),Pn({propertyNames:"border-left-width",type:s.Length,state:null})(t,"borderLeftWidth"),On({propertyNames:"bottom",type:s.Length,state:null,get constraintValue(){const t=this.owner.node;if(t instanceof HTMLElement){const e=t.offsetParent,i=null!==e?e.getBoundingClientRect():t===document.body?t.getBoundingClientRect():null;if(null!==i){const e=t.getBoundingClientRect();return s.Length.px(e.bottom-i.bottom)}}return null}})(t,"bottom"),Pn({propertyNames:"box-shadow",type:rt,state:null})(t,"boxShadow"),Pn({propertyNames:"box-sizing",type:String})(t,"boxSizing"),Pn({propertyNames:"color",type:z,state:null})(t,"color"),Pn({propertyNames:"cursor",type:String})(t,"cursor"),Pn({propertyNames:"display",type:String})(t,"display"),Pn({propertyNames:"filter",type:String})(t,"filter"),Pn({propertyNames:"flex-basis",type:s.Length,state:null})(t,"flexBasis"),Pn({propertyNames:"flex-direction",type:String})(t,"flexDirection"),Pn({propertyNames:"flex-grow",type:Number})(t,"flexGrow"),Pn({propertyNames:"flex-shrink",type:Number})(t,"flexShrink"),Pn({propertyNames:"flex-wrap",type:String})(t,"flexWrap"),t.font=l,Pn({propertyNames:"font-family",type:k})(t,"fontFamily"),Pn({propertyNames:"font-size",type:s.Length,state:null})(t,"fontSize"),Pn({propertyNames:"font-stretch",type:String})(t,"fontStretch"),Pn({propertyNames:"font-style",type:String})(t,"fontStyle"),Pn({propertyNames:"font-variant",type:String})(t,"fontVariant"),Pn({propertyNames:"font-weight",type:String})(t,"fontWeight"),On({propertyNames:"height",type:s.Length,state:null,get constraintValue(){const t=this.owner.node;return t instanceof HTMLElement?s.Length.px(t.offsetHeight):null}})(t,"height"),Pn({propertyNames:"justify-content",type:String})(t,"justifyContent"),On({propertyNames:"left",type:s.Length,state:null,get constraintValue(){const t=this.owner.node;return t instanceof HTMLElement?s.Length.px(t.offsetLeft):null}})(t,"left"),Pn({propertyNames:"line-height",type:s.Length,state:null})(t,"lineHeight"),t.margin=a,On({propertyNames:"margin-top",type:s.Length,state:null})(t,"marginTop"),On({propertyNames:"margin-right",type:s.Length,state:null})(t,"marginRight"),On({propertyNames:"margin-bottom",type:s.Length,state:null})(t,"marginBottom"),On({propertyNames:"margin-left",type:s.Length,state:null})(t,"marginLeft"),Pn({propertyNames:"max-height",type:s.Length,state:null})(t,"maxHeight"),Pn({propertyNames:"max-width",type:s.Length,state:null})(t,"maxWidth"),Pn({propertyNames:"min-height",type:s.Length,state:null})(t,"minHeight"),Pn({propertyNames:"min-width",type:s.Length,state:null})(t,"minWidth"),Pn({propertyNames:"opacity",type:Number})(t,"opacity"),Pn({propertyNames:"order",type:Number})(t,"order"),Pn({propertyNames:"outline-color",type:z,state:null})(t,"outlineColor"),Pn({propertyNames:"outline-style",type:String})(t,"outlineStyle"),Pn({propertyNames:"outline-width",type:s.Length,state:null})(t,"outlineWidth"),t.overflow=h,Pn({propertyNames:"overflow-x",type:String})(t,"overflowX"),Pn({propertyNames:"overflow-y",type:String})(t,"overflowY"),Pn({propertyNames:"-webkit-overflow-scrolling",type:String})(t,"overflowScrolling"),t.overscrollBehavior=d,Pn({propertyNames:"overscroll-behavior-x",type:String})(t,"overscrollBehaviorX"),Pn({propertyNames:"overscroll-behavior-y",type:String})(t,"overscrollBehaviorY"),t.padding=c,On({propertyNames:"padding-top",type:s.Length,state:null})(t,"paddingTop"),On({propertyNames:"padding-right",type:s.Length,state:null})(t,"paddingRight"),On({propertyNames:"padding-bottom",type:s.Length,state:null})(t,"paddingBottom"),On({propertyNames:"padding-left",type:s.Length,state:null})(t,"paddingLeft"),Pn({propertyNames:"pointer-events",type:String})(t,"pointerEvents"),Pn({propertyNames:"position",type:String})(t,"position"),On({propertyNames:"right",type:s.Length,state:null,get constraintValue(){const t=this.owner.node;if(t instanceof HTMLElement){const e=t.offsetParent,i=null!==e?e.getBoundingClientRect():t===document.body?t.getBoundingClientRect():null;if(null!==i){const e=t.getBoundingClientRect();return s.Length.px(e.right-i.right)}}return null}})(t,"right"),Pn({propertyNames:"text-align",type:String})(t,"textAlign"),Pn({propertyNames:"text-decoration-color",type:z,state:null})(t,"textDecorationColor"),Pn({propertyNames:"text-decoration-line",type:String})(t,"textDecorationLine"),Pn({propertyNames:"text-decoration-style",type:String})(t,"textDecorationStyle"),Pn({propertyNames:"text-overflow",type:String})(t,"textOverflow"),Pn({propertyNames:"text-transform",type:String})(t,"textTransform"),On({propertyNames:"top",type:s.Length,state:null,get constraintValue(){const t=this.owner.node;return t instanceof HTMLElement?s.Length.px(t.offsetTop):null}})(t,"top"),Pn({propertyNames:"touch-action",type:String})(t,"touchAction"),Pn({propertyNames:"transform",type:s.Transform,state:null})(t,"transform"),Pn({propertyNames:["user-select","-webkit-user-select","-moz-user-select","-ms-user-select"],type:String})(t,"userSelect"),Pn({propertyNames:"vertical-align",type:String})(t,"verticalAlign"),Pn({propertyNames:"visibility",type:String})(t,"visibility"),Pn({propertyNames:"white-space",type:String})(t,"whiteSpace"),On({propertyNames:"width",type:s.Length,state:null,get constraintValue(){const t=this.owner.node;return t instanceof HTMLElement?s.Length.px(t.offsetWidth):null}})(t,"width"),Pn({propertyNames:"z-index",type:Number})(t,"zIndex")},t}(),zn=function(){const t={is:function(t){if("object"==typeof t&&null!==t||"function"==typeof t){return"getRule"in t}return!1}};return t}(),Un=function(t){const e=t.extend("CssRule");return Object.defineProperty(e.prototype,"familyType",{get:function(){return e},configurable:!0}),e.prototype.hasFastener=function(t,e){const i=this.fasteners;if(null!==i){const n=i[t];if(void 0!==n&&(null==e||n instanceof e))return!0}return!1},e.prototype.getFastener=function(t,e){const i=this.fasteners;if(null!==i){const n=i[t];if(void 0!==n&&(null==e||n instanceof e))return n}return null},e.prototype.setFastener=function(t,e){let i=this.fasteners;null===i&&(i={},this.fasteners=i);const n=i[t];void 0!==n&&this.mounted&&n.unmount(),null!==e?(i[t]=e,this.mounted&&e.mount()):delete i[t]},e.prototype.getLazyFastener=function(t,e){return i.FastenerContext.getLazyFastener(this,t,e)},e.prototype.getSuperFastener=function(e,i){return 0===arguments.length?t.prototype.getSuperFastener.call(this):null},e.prototype.mountFasteners=function(){const t=this.fasteners;for(const e in t){t[e].mount()}i.FastenerContext.init(this)},e.prototype.unmountFasteners=function(){const t=this.fasteners;for(const e in t){t[e].unmount()}},e.prototype.requireUpdate=function(t){const e=this.owner;i.FastenerContext.has(e,"requireUpdate")&&e.requireUpdate(t)},e.prototype.decohereFastener=function(t){let e=this.decoherent;null===e&&(e=[],this.decoherent=e),e.push(t),this.coherent&&(this.setCoherent(!1),this.decohere())},e.prototype.recohereFasteners=function(t){const e=this.decoherent;if(null!==e){const i=e.length;if(0!==i){this.decoherent=null;for(let n=0;n<i;n+=1){e[n].recohere(t)}}}},e.prototype.recohere=function(t){this.recohereFasteners(t),null===this.decoherent||0===this.decoherent.length?this.setCoherent(!0):(this.setCoherent(!1),this.decohere())},e.prototype.constraint=function(t,e,i,n){return this.owner.constraint(t,e,i,n)},e.prototype.hasConstraint=function(t){return this.owner.hasConstraint(t)},e.prototype.addConstraint=function(t){this.owner.addConstraint(t)},e.prototype.removeConstraint=function(t){this.owner.removeConstraint(t)},e.prototype.constraintVariable=function(t,e,i){return this.owner.constraintVariable(t,e,i)},e.prototype.hasConstraintVariable=function(t){return this.owner.hasConstraintVariable(t)},e.prototype.addConstraintVariable=function(t){this.owner.addConstraintVariable(t)},e.prototype.removeConstraintVariable=function(t){this.owner.removeConstraintVariable(t)},e.prototype.setConstraintVariable=function(t,e){this.owner.setConstraintVariable(t,e)},e.prototype.getLook=function(t,e){const i=this.owner;return Ut.is(i)?i.getLook(t,e):void 0},e.prototype.getLookOr=function(t,e,i){const n=this.owner;return Ut.is(n)?2===arguments.length?n.getLookOr(t,e):n.getLookOr(t,e,i):2===arguments.length?e:i},e.prototype.applyTheme=function(t,e,i){},e.prototype.onMount=function(){t.prototype.onMount.call(this),this.mountFasteners()},e.prototype.onUnmount=function(){this.unmountFasteners(),t.prototype.onUnmount.call(this)},e.prototype.createRule=function(t){const e=this.owner;if(zn.is(e)){const i=e.insertRule(t),n=e.getRule(i);if(n instanceof CSSRule)return n;throw new TypeError(""+n)}throw new Error("no css context")},e.construct=function(e,i,n){return(i=t.construct(e,i,n)).fasteners=null,i.decoherent=null,i.rule=null,i},e.define=function(t,e){let i=e.extends;const n=e.affinity,s=e.inherits;let o=e.css;delete e.extends,delete e.affinity,delete e.inherits,delete e.css,null==i&&(i=this);const r=i.extend(t,e);return"function"==typeof o&&(r.prototype.initCss=o,o=void 0),r.construct=function(t,e,r){let l;if(e=i.construct(t,e,r),void 0!==n&&e.initAffinity(n),void 0!==s&&e.initInherits(s),void 0!==o)l=o;else{if(void 0===e.initCss)throw new Error("undefined css");l=e.initCss()}return e.rule=e.createRule(l),void 0!==e.initRule&&e.initRule(e.rule),e},r},e}(i.Fastener),Hn=function(t){const i=t.extend("StyleRule");return Object.defineProperty(i.prototype,"selector",{get:function(){return this.rule.selectorText},configurable:!0}),i.prototype.setSelector=function(t){this.rule.selectorText=t},i.prototype.getStyle=function(t){if("undefined"!=typeof CSSStyleValue){const e=this.rule.styleMap;if("string"==typeof t)return e.get(t);for(let i=0,n=t.length;i<n;i+=1){const n=e.get(t[i]);if(void 0!==n)return n}return""}{const e=this.rule.style;if("string"==typeof t)return e.getPropertyValue(t);for(let i=0,n=t.length;i<n;i+=1){const n=e.getPropertyValue(t[i]);if(0!==n.length)return n}return""}},i.prototype.setStyle=function(t,e,i){if(this.willSetStyle(t,e,i),"undefined"!=typeof CSSStyleValue)if(null!=e){const n=Ct(e);if(null!==n)try{this.rule.styleMap.set(t,n)}catch(t){}else this.rule.style.setProperty(t,bt(e),i)}else this.rule.styleMap.delete(t);else null!=e?this.rule.style.setProperty(t,bt(e),i):this.rule.style.removeProperty(t);return this.onSetStyle(t,e,i),this.didSetStyle(t,e,i),this},i.prototype.willSetStyle=function(t,e,i){},i.prototype.onSetStyle=function(t,e,i){},i.prototype.didSetStyle=function(t,e,i){},i.prototype.applyTheme=function(t,i,n){n=void 0===n||!0===n?t.getOr(At.timing,Et.ambient,!1):e.Timing.fromAny(n);const s=this.fasteners;for(const e in s){const o=s[e];o instanceof Ht&&o.applyTheme(t,i,n)}},i.prototype.createRule=function(t){const e=this.owner;if(zn.is(e)){const i=e.insertRule(t),n=e.getRule(i);if(n instanceof CSSStyleRule)return n;throw new TypeError(""+n)}throw new Error("no css context")},Bn.define(i.prototype),i.construct=function(e,i,n){return null===i&&(delete(i=function(t,e){return void 0===e?i.getStyle(t):(i.setStyle(t,e),i.owner)}).name,Object.setPrototypeOf(i,e.prototype)),i=t.construct(e,i,n)},i.define=function(t,e){let i=e.extends;const n=e.affinity,s=e.inherits;let o=e.css;const r=e.style;delete e.extends,delete e.affinity,delete e.inherits,delete e.css,delete e.style,null==i&&(i=this);const l=i.extend(t,e);return"function"==typeof o&&(l.prototype.initCss=o,o=void 0),l.construct=function(t,e,l){let a;if(e=i.construct(t,e,l),void 0!==n&&e.initAffinity(n),void 0!==s&&e.initInherits(s),void 0!==o)a=o;else{if(void 0===e.initCss)throw new Error("undefined css");a=e.initCss()}return e.rule=e.createRule(a),void 0!==e.initRule&&e.initRule(e.rule),void 0!==r&&Bn.init(e,r),e},l},i}(Un),qn=function(t){const i=t.extend("MediaRule");return i.prototype.getRule=function(t){return this.rule.cssRules.item(t)},i.prototype.insertRule=function(t,e){return this.rule.insertRule(t,e)},i.prototype.removeRule=function(t){this.rule.deleteRule(t)},i.prototype.applyTheme=function(t,i,n){n=void 0===n||!0===n?t.getOr(At.timing,Et.ambient,!1):e.Timing.fromAny(n);const s=this.fasteners;for(const e in s){const o=s[e];o instanceof Un&&o.applyTheme(t,i,n)}},i.prototype.createRule=function(t){const e=this.owner;if(zn.is(e)){const i=e.insertRule(t),n=e.getRule(i);if(n instanceof CSSMediaRule)return n;throw new TypeError(""+n)}throw new Error("no css context")},i.construct=function(e,i,n){return i=t.construct(e,i,n)},i.define=function(t,e){let i=e.extends;const n=e.affinity,s=e.inherits;let o=e.css;delete e.extends,delete e.affinity,delete e.inherits,delete e.css,null==i&&(i=this);const r=i.extend(t,e);return"function"==typeof o&&(r.prototype.initCss=o,o=void 0),r.construct=function(t,e,r){let l;if(e=i.construct(t,e,r),void 0!==n&&e.initAffinity(n),void 0!==s&&e.initInherits(s),void 0!==o)l=o;else{if(void 0===e.initCss)throw new Error("undefined css");l=e.initCss()}return e.rule=e.createRule(l),void 0!==e.initRule&&e.initRule(e.rule),e},r},i}(Un),Gn=function(t){const n=t.extend("StyleSheet");return Object.defineProperty(n.prototype,"familyType",{get:function(){return n},configurable:!0}),n.prototype.getRule=function(t){return this.stylesheet.cssRules.item(t)},n.prototype.insertRule=function(t,e){return this.stylesheet.insertRule(t,e)},n.prototype.removeRule=function(t){this.stylesheet.deleteRule(t)},n.prototype.hasFastener=function(t,e){const i=this.fasteners;if(null!==i){const n=i[t];if(void 0!==n&&(null==e||n instanceof e))return!0}return!1},n.prototype.getFastener=function(t,e){const i=this.fasteners;if(null!==i){const n=i[t];if(void 0!==n&&(null==e||n instanceof e))return n}return null},n.prototype.setFastener=function(t,e){let i=this.fasteners;null===i&&(i={},this.fasteners=i);const n=i[t];void 0!==n&&this.mounted&&n.unmount(),null!==e?(i[t]=e,this.mounted&&e.mount()):delete i[t]},n.prototype.getLazyFastener=function(t,e){return i.FastenerContext.getLazyFastener(this,t,e)},n.prototype.getSuperFastener=function(e,i){return 0===arguments.length?t.prototype.getSuperFastener.call(this):null},n.prototype.mountFasteners=function(){const t=this.fasteners;for(const e in t){t[e].mount()}i.FastenerContext.init(this)},n.prototype.unmountFasteners=function(){const t=this.fasteners;for(const e in t){t[e].unmount()}},n.prototype.requireUpdate=function(t){const e=this.owner;i.FastenerContext.has(e,"requireUpdate")&&e.requireUpdate(t)},n.prototype.decohereFastener=function(t){let e=this.decoherent;null===e&&(e=[],this.decoherent=e),e.push(t),this.coherent&&(this.setCoherent(!1),this.decohere())},n.prototype.recohereFasteners=function(t){const e=this.decoherent;if(null!==e){const i=e.length;if(0!==i){this.decoherent=null;for(let n=0;n<i;n+=1){e[n].recohere(t)}}}},n.prototype.recohere=function(t){this.recohereFasteners(t),null===this.decoherent||0===this.decoherent.length?this.setCoherent(!0):(this.setCoherent(!1),this.decohere())},n.prototype.constraint=function(t,e,i,n){return this.owner.constraint(t,e,i,n)},n.prototype.hasConstraint=function(t){return this.owner.hasConstraint(t)},n.prototype.addConstraint=function(t){this.owner.addConstraint(t)},n.prototype.removeConstraint=function(t){this.owner.removeConstraint(t)},n.prototype.constraintVariable=function(t,e,i){return this.owner.constraintVariable(t,e,i)},n.prototype.hasConstraintVariable=function(t){return this.owner.hasConstraintVariable(t)},n.prototype.addConstraintVariable=function(t){this.owner.addConstraintVariable(t)},n.prototype.removeConstraintVariable=function(t){this.owner.removeConstraintVariable(t)},n.prototype.setConstraintVariable=function(t,e){this.owner.setConstraintVariable(t,e)},n.prototype.getLook=function(t,e){const i=this.owner;return Ut.is(i)?i.getLook(t,e):void 0},n.prototype.getLookOr=function(t,e,i){const n=this.owner;return Ut.is(n)?2===arguments.length?n.getLookOr(t,e):n.getLookOr(t,e,i):2===arguments.length?e:i},n.prototype.applyTheme=function(t,i,n){n=void 0===n||!0===n?t.getOr(At.timing,Et.ambient,!1):e.Timing.fromAny(n);const s=this.fasteners;for(const e in s){const o=s[e];o instanceof Un&&o.applyTheme(t,i,n)}},n.prototype.onMount=function(){t.prototype.onMount.call(this),this.mountFasteners()},n.prototype.onUnmount=function(){this.unmountFasteners(),t.prototype.onUnmount.call(this)},n.prototype.createStylesheet=function(){return new CSSStyleSheet},n.construct=function(e,i,n){return(i=t.construct(e,i,n)).fasteners=null,i.decoherent=null,i.stylesheet=null,i},n.define=function(t,e){let i=e.extends;const n=e.affinity,s=e.inherits;let o=e.css;delete e.extends,delete e.affinity,delete e.inherits,delete e.css,null==i&&(i=this);const r=i.extend(t,e);return"function"==typeof o&&(r.prototype.initCss=o,o=void 0),r.construct=function(t,e,o){return e=i.construct(t,e,o),void 0!==n&&e.initAffinity(n),void 0!==s&&e.initInherits(s),e.stylesheet=e.createStylesheet(),void 0!==e.initStylesheet&&e.initStylesheet(e.stylesheet),e},r},n}(i.Fastener);class jn extends fn{constructor(t){super(),this.node=t,this.childMap=null,t.view=this}get parent(){const t=this.node.parentNode;if(null!==t){const e=t.view;if(void 0!==e)return e}return null}get childCount(){let t=0;const e=this.node.childNodes;for(let i=0,n=e.length;i<n;i+=1){void 0!==e[i].view&&(t+=1)}return t}get children(){const t=this.node.childNodes,e=[];for(let i=0,n=t.length;i<n;i+=1){const n=t[i].view;void 0!==n&&e.push(n)}return e}firstChild(){const t=this.node.childNodes;for(let e=0,i=t.length;e<i;e+=1){const i=t[e].view;if(void 0!==i)return i}return null}lastChild(){const t=this.node.childNodes;for(let e=t.length-1;e>=0;e-=1){const i=t[e].view;if(void 0!==i)return i}return null}nextChild(t){if(t instanceof jn&&t.parent===this){let e=t.node;for(;;){if(e=e.nextSibling,null===e)break;if(void 0!==e.view)return e.view}}return null}previousChild(t){if(t instanceof jn&&t.parent===this){let e=t.node;for(;;){if(e=e.previousSibling,null===e)break;if(void 0!==e.view)return e.view}}return null}forEachChild(t,e){let i;const n=this.node.childNodes;let s=0;for(;s<n.length;){const o=n[s],r=o.view;if(void 0!==r&&(i=t.call(e,r),void 0!==i))break;n[s]===o&&(s+=1)}return i}insertChildMap(t){const e=t.key;if(void 0!==e){let i=this.childMap;null===i&&(i={},this.childMap=i),i[e]=t}}removeChildMap(t){const e=t.key;if(void 0!==e){const t=this.childMap;null!==t&&delete t[e]}}replaceChildMap(t,e){const i=e.key;if(void 0!==i){let e=this.childMap;null===e&&(e={},this.childMap=e),e[i]=t}}getChild(t,e){const i=this.childMap;if(null!==i){const n=i[t];if(void 0!==n&&(void 0===e||n instanceof e))return n}return null}setChild(t,e){var i,n;let s,o;null===e?(s=null,o=null):(s=jn.fromAny(e),o=s.node);const r=this.getChild(t),l=null!==r?r.node:null;let a=null,h=null;return null!==r&&null!==s&&r!==s?(s.remove(),h=l.nextSibling,a=null!==h&&null!==(i=h.view)&&void 0!==i?i:null,s.setKey(r.key),this.willRemoveChild(r),this.willInsertChild(s,a),r.detachParent(this),this.node.replaceChild(o,l),this.replaceChildMap(s,r),s.attachParent(this),this.onRemoveChild(r),this.onInsertChild(s,a),this.didRemoveChild(r),this.didInsertChild(s,a),r.setKey(void 0),s.cascadeInsert()):(s!==r||null!==s&&s.key!==t)&&(null!==r&&(h=l.nextSibling,a=null!==h&&null!==(n=h.view)&&void 0!==n?n:null,this.willRemoveChild(r),r.detachParent(this),this.removeChildMap(r),this.node.removeChild(l),this.onRemoveChild(r),this.didRemoveChild(r),r.setKey(void 0)),null!==s&&(s.remove(),s.setKey(t),this.willInsertChild(s,null),this.node.appendChild(o),this.insertChildMap(s),s.attachParent(this),this.onInsertChild(s,null),this.didInsertChild(s,null),s.cascadeInsert())),r}appendChild(t,e){const i=jn.fromAny(t),n=i.node;return i.remove(),void 0!==e&&(this.removeChild(e),i.setKey(e)),this.willInsertChild(i,null),this.node.appendChild(n),this.insertChildMap(i),i.attachParent(this),this.onInsertChild(i,null),this.didInsertChild(i,null),i.cascadeInsert(),i}prependChild(t,e){const i=jn.fromAny(t),n=i.node;i.remove(),void 0!==e&&(this.removeChild(e),i.setKey(e));let s=null;const o=this.node.firstChild;return null!==o&&(s=o.view,void 0===s&&(s=null)),this.willInsertChild(i,s),this.node.insertBefore(n,o),this.insertChildMap(i),i.attachParent(this),this.onInsertChild(i,s),this.didInsertChild(i,s),i.cascadeInsert(),i}insertChild(t,e,i){var n;let s,o;if(null===e)s=null,o=null;else if(e instanceof jn)s=e,o=e.node;else{if(!(e instanceof Node))throw new TypeError(""+e);s=null!==(n=e.view)&&void 0!==n?n:null,o=e}if(null!==o&&o.parentNode!==this.node)throw new TypeError(""+o);const r=jn.fromAny(t),l=r.node;return r.remove(),void 0!==i&&(this.removeChild(i),r.setKey(i)),this.willInsertChild(r,s),this.node.insertBefore(l,o),this.insertChildMap(r),r.attachParent(this),this.onInsertChild(r,s),this.didInsertChild(r,s),r.cascadeInsert(),r}replaceChild(t,e){var i;const n=e.node;if(n.parentNode!==this.node)throw new TypeError(""+e);const s=(t=jn.fromAny(t)).node;if(t!==e){t.remove();const o=n.nextSibling,r=null!==o&&null!==(i=o.view)&&void 0!==i?i:null;t.setKey(e.key),this.willRemoveChild(e),this.willInsertChild(t,r),e.detachParent(this),this.node.replaceChild(s,n),this.replaceChildMap(t,e),t.attachParent(this),this.onRemoveChild(e),this.onInsertChild(t,r),this.didRemoveChild(e),this.didInsertChild(t,r),e.setKey(void 0),t.cascadeInsert()}return e}injectChild(t,e,i){let n,s,o;if(null===e)n=null,s=null;else if(e instanceof jn)n=e,s=e.node;else{if(!(e instanceof Node))throw new TypeError(""+e);n=null,s=e}if(null!==s&&s.parentNode!==this.node)throw new TypeError(""+s);if(t instanceof jn)o=t;else{if(!(t instanceof Node))throw new TypeError(""+t);o=jn.fromNode(t)}void 0!==i&&(this.removeChild(i),o.setKey(i)),this.willInsertChild(o,n),this.insertChildMap(o),o.attachParent(this),this.onInsertChild(o,n),this.didInsertChild(o,n),o.cascadeInsert()}removeChild(t){let e,i;if("string"==typeof t){if(e=this.getChild(t),null===e)return null;i=e.node}else{if(t instanceof fn)e=t,i=t.node;else if(e=t.view,i=t,!(e instanceof jn))throw new Error("not a child view");if(e.parent!==this)throw new Error("not a child view")}return this.willRemoveChild(e),e.detachParent(this),this.removeChildMap(e),this.node.removeChild(i),this.onRemoveChild(e),this.didRemoveChild(e),e.setKey(void 0),e}removeChildren(){let t;for(;t=this.node.lastChild,null!==t;){const e=t.view;void 0!==e&&(this.willRemoveChild(e),e.detachParent(this),this.removeChildMap(e)),this.node.removeChild(t),void 0!==e&&(this.onRemoveChild(e),this.didRemoveChild(e),e.setKey(void 0))}}remove(){const t=this.node,e=t.parentNode;if(null!==e){const i=e.view;void 0!==i?this.traversing?this.setFlags(this.flags|fn.RemovingFlag):i.removeChild(this):(e.removeChild(t),this.detachParent(this),this.setKey(void 0))}}static isRootView(t){for(;;){const e=t.parentNode;if(null===e)break;if(void 0!==e.view)return!1;t=e}return!0}static isNodeMounted(t){let e=t.isConnected;if("boolean"!=typeof e){const i=t.ownerDocument;if(null!==i){e=0==(i.compareDocumentPosition(t)&t.DOCUMENT_POSITION_DISCONNECTED)}else e=!1}return e}static mount(t){const e=t.parent;null!==e?(t.attachParent(e),t.cascadeInsert()):t.mount()}mount(){!this.mounted&&jn.isNodeMounted(this.node)&&jn.isRootView(this.node)&&(this.cascadeMount(),this.cascadeInsert())}mountChildren(){const t=this.node.childNodes;let e=0;for(;e<t.length;){const i=t[e].view;void 0===i||(i.cascadeMount(),0==(i.flags&fn.RemovingFlag))?e+=1:(i.setFlags(i.flags&~fn.RemovingFlag),this.removeChild(i))}}unmountChildren(){const t=this.node.childNodes;let e=0;for(;e<t.length;){const i=t[e].view;void 0===i||(i.cascadeUnmount(),0==(i.flags&fn.RemovingFlag))?e+=1:(i.setFlags(i.flags&~fn.RemovingFlag),this.removeChild(i))}}cullChildren(){const t=this.node.childNodes;let e=0;for(;e<t.length;){const i=t[e].view;void 0===i||(i.cascadeCull(),0==(i.flags&fn.RemovingFlag))?e+=1:(i.setFlags(i.flags&~fn.RemovingFlag),this.removeChild(i))}}uncullChildren(){const t=this.node.childNodes;let e=0;for(;e<t.length;){const i=t[e].view;void 0===i||(i.cascadeUncull(),0==(i.flags&fn.RemovingFlag))?e+=1:(i.setFlags(i.flags&~fn.RemovingFlag),this.removeChild(i))}}cascadeProcess(t,e){const i=this.extendViewContext(e),n=Ni.current;try{if(Ni.current=i,t&=~fn.NeedsProcess,t|=this.flags&fn.UpdateMask,0!=((t=this.needsProcess(t,i))&fn.ProcessMask)){let e=t;this.setFlags(this.flags&~(fn.NeedsProcess|fn.NeedsProject)|fn.TraversingFlag|fn.ProcessingFlag|fn.ContextualFlag),this.willProcess(e,i),0!=((this.flags|t)&fn.NeedsResize)&&(e|=fn.NeedsResize,this.setFlags(this.flags&~fn.NeedsResize),this.willResize(i)),0!=((this.flags|t)&fn.NeedsScroll)&&(e|=fn.NeedsScroll,this.setFlags(this.flags&~fn.NeedsScroll),this.willScroll(i)),0!=((this.flags|t)&fn.NeedsChange)&&(e|=fn.NeedsChange,this.setFlags(this.flags&~fn.NeedsChange),this.willChange(i)),0!=((this.flags|t)&fn.NeedsAnimate)&&(e|=fn.NeedsAnimate,this.setFlags(this.flags&~fn.NeedsAnimate),this.willAnimate(i)),this.onProcess(e,i),0!=(e&fn.NeedsResize)&&this.onResize(i),0!=(e&fn.NeedsScroll)&&this.onScroll(i),0!=(e&fn.NeedsChange)&&this.onChange(i),0!=(e&fn.NeedsAnimate)&&this.onAnimate(i),0!=(e&fn.ProcessMask)&&(this.setFlags(this.flags&~fn.ContextualFlag),this.processChildren(e,i,this.processChild),this.setFlags(this.flags|fn.ContextualFlag)),0!=(e&fn.NeedsAnimate)&&this.didAnimate(i),0!=(e&fn.NeedsChange)&&this.didChange(i),0!=(e&fn.NeedsScroll)&&this.didScroll(i),0!=(e&fn.NeedsResize)&&this.didResize(i),this.didProcess(e,i)}}finally{this.setFlags(this.flags&~(fn.TraversingFlag|fn.ProcessingFlag|fn.ContextualFlag)),Ni.current=n}}processChildren(t,e,i){const n=this.node.childNodes;let s=0;for(;s<n.length;){const o=n[s].view;void 0===o||(i.call(this,o,t,e),0==(o.flags&fn.RemovingFlag))?s+=1:(o.setFlags(o.flags&~fn.RemovingFlag),this.removeChild(o))}}cascadeDisplay(t,e){const i=this.extendViewContext(e),n=Ni.current;try{if(Ni.current=i,t&=~fn.NeedsDisplay,t|=this.flags&fn.UpdateMask,0!=((t=this.needsDisplay(t,i))&fn.DisplayMask)){let e=t;this.setFlags(this.flags&~(fn.NeedsDisplay|fn.NeedsRender|fn.NeedsRasterize|fn.NeedsComposite)|fn.TraversingFlag|fn.DisplayingFlag|fn.ContextualFlag),this.willDisplay(e,i),0!=((this.flags|t)&fn.NeedsLayout)&&(e|=fn.NeedsLayout,this.setFlags(this.flags&~fn.NeedsLayout),this.willLayout(i)),this.onDisplay(e,i),0!=(e&fn.NeedsLayout)&&this.onLayout(i),0==(e&fn.DisplayMask)||this.culled||(this.setFlags(this.flags&~fn.ContextualFlag),this.displayChildren(e,i,this.displayChild),this.setFlags(this.flags|fn.ContextualFlag)),0!=(e&fn.NeedsLayout)&&this.didLayout(i),this.didDisplay(e,i)}}finally{this.setFlags(this.flags&~(fn.TraversingFlag|fn.DisplayingFlag|fn.ContextualFlag)),Ni.current=n}}displayChildren(t,e,i){const n=this.node.childNodes;let s=0;for(;s<n.length;){const o=n[s].view;void 0===o||(i.call(this,o,t,e),0==(o.flags&fn.RemovingFlag))?s+=1:(o.setFlags(o.flags&~fn.RemovingFlag),this.removeChild(o))}}text(t){return 0===arguments.length?(null===(t=this.node.textContent)&&(t=void 0),t):(void 0===t&&(t=null),this.node.textContent=t,this)}get parentTransform(){return s.Transform.identity()}get clientBounds(){const t=document.createRange();t.selectNode(this.node);const e=t.getBoundingClientRect();return t.detach(),new s.R2Box(e.left,e.top,e.right,e.bottom)}get pageBounds(){const t=document.createRange();t.selectNode(this.node);const e=t.getBoundingClientRect();t.detach();const i=window.pageXOffset,n=window.pageYOffset;return new s.R2Box(e.left+i,e.top+n,e.right+i,e.bottom+n)}dispatchEvent(t){return this.node.dispatchEvent(t)}on(t,e,i){return this.node.addEventListener(t,e,i),this}off(t,e,i){return this.node.removeEventListener(t,e,i),this}init(t){super.init(t),void 0!==t.text&&this.text(t.text)}static fromNode(t){let e=t.view;if(void 0===e)t instanceof Element?e=Xn.fromNode(t):t instanceof Text?e=Yn.fromNode(t):(e=new this(t),this.mount(e));else if(!(e instanceof this))throw new TypeError(e+" not an instance of "+this);return e}static fromAny(t){if(null==t)return t;if(t instanceof fn){if(t instanceof this)return t;throw new TypeError(t+" not an instance of "+this)}return t instanceof Node?this.fromNode(t):e.Creatable.is(t)?t.create():this.fromInit(t)}}u([i.Provider({extends:mn,type:wn,observes:!1,service:wn.global()})],jn.prototype,"domProvider",void 0),Ki.insertModalView=function(t){const e=document.body,i=e.view;if(void 0!==i)i.appendChild(t);else{if(!(t instanceof jn))throw new TypeError(""+t);e.appendChild(t.node),t.mount()}};class Yn extends jn{constructor(t){super(t)}init(t){super.init(t)}static create(t){void 0===t&&(t="");return new this(document.createTextNode(t))}static fromNode(t){let e=t.view;if(void 0===e)e=new this(t);else if(!(e instanceof this))throw new TypeError(e+" not an instance of "+this);return e}static fromAny(t){if(null==t)return t;if(t instanceof fn){if(t instanceof this)return t;throw new TypeError(t+" not an instance of "+this)}return t instanceof Node?this.fromNode(t):"string"==typeof t?this.create(t):e.Creatable.is(t)?t.create():this.fromInit(t)}}class Xn extends jn{constructor(t){super(t),this.initElement(t)}initElement(t){const e=t.getAttribute("swim-theme");if(null!==e&&""!==e){let t;if("auto"===e){t="dark"===Wi.detect().colorScheme?Bt.dark:Bt.light}else t=e.indexOf(".")<0?Bt[e]:wn.eval(e);if(!(t instanceof zt))throw new TypeError("unknown swim-theme: "+e);this.theme.setState(t,i.Affinity.Extrinsic)}}mountTheme(){if(super.mountTheme(),jn.isRootView(this.node)){const t=this.themeProvider.service;null!=t&&(this.mood.hasAffinity(i.Affinity.Intrinsic)&&null===this.mood.state&&this.mood.setState(t.mood,i.Affinity.Intrinsic),this.theme.hasAffinity(i.Affinity.Intrinsic)&&null===this.theme.state&&this.theme.setState(t.theme,i.Affinity.Intrinsic))}}getAttribute(t){return this.node.getAttribute(t)}setAttribute(t,e){return this.willSetAttribute(t,e),null!=e?this.node.setAttribute(t,mt(e)):this.node.removeAttribute(t),this.onSetAttribute(t,e),this.didSetAttribute(t,e),this}willSetAttribute(t,e){const i=this.observerCache.viewWillSetAttributeObservers;if(void 0!==i)for(let n=0,s=i.length;n<s;n+=1){i[n].viewWillSetAttribute(t,e,this)}}onSetAttribute(t,e){}didSetAttribute(t,e){const i=this.observerCache.viewDidSetAttributeObservers;if(void 0!==i)for(let n=0,s=i.length;n<s;n+=1){i[n].viewDidSetAttribute(t,e,this)}}getStyle(t){if("undefined"==typeof CSSStyleValue){const e=this.node.style;if("string"==typeof t)return e.getPropertyValue(t);for(let i=0,n=t.length;i<n;i+=1){const n=e.getPropertyValue(t[i]);if(0!==n.length)return n}return""}{const e=this.node.attributeStyleMap;if("string"!=typeof t){for(let i=0,n=t.length;i<n;i+=1){const n=e.get(t[i]);if(void 0!==n)return n}return""}try{return e.get(t)}catch(t){return}}}setStyle(t,e,i){if(this.willSetStyle(t,e,i),"undefined"!=typeof CSSStyleValue)if(null!=e){const n=Ct(e);if(null!==n)try{this.node.attributeStyleMap.set(t,n)}catch(t){}else this.node.style.setProperty(t,bt(e),i)}else this.node.attributeStyleMap.delete(t);else null!=e?this.node.style.setProperty(t,bt(e),i):this.node.style.removeProperty(t);return this.onSetStyle(t,e,i),this.didSetStyle(t,e,i),this}willSetStyle(t,e,i){const n=this.observerCache.viewWillSetStyleObservers;if(void 0!==n)for(let s=0,o=n.length;s<o;s+=1){n[s].viewWillSetStyle(t,e,i,this)}}onSetStyle(t,e,i){}didSetStyle(t,e,i){const n=this.observerCache.viewDidSetStyleObservers;if(void 0!==n)for(let s=0,o=n.length;s<o;s+=1){n[s].viewDidSetStyle(t,e,i,this)}}id(t){if(0==arguments.length){const t=this.getAttribute("id");return null!==t?t:void 0}return this.setAttribute("id",t),this}className(t){if(0===arguments.length){const t=this.getAttribute("class");return null!==t?t:void 0}return this.setAttribute("class",t),this}get classList(){return this.node.classList}hasClass(t){return this.node.classList.contains(t)}addClass(...t){const e=this.node.classList;for(let i=0,n=t.length;i<n;i+=1)e.add(t[i]);return this}removeClass(...t){const e=this.node.classList;for(let i=0,n=t.length;i<n;i+=1)e.remove(t[i]);return this}toggleClass(t,e){const i=this.node.classList;return void 0===e?i.toggle(t):!0===e?i.add(t):!1===e&&i.remove(t),this}get clientBounds(){const t=this.node.getBoundingClientRect();return new s.R2Box(t.left,t.top,t.right,t.bottom)}get pageBounds(){const t=this.node.getBoundingClientRect(),e=window.pageXOffset,i=window.pageYOffset;return new s.R2Box(t.left+e,t.top+i,t.right+e,t.bottom+i)}on(t,e,i){return this.node.addEventListener(t,e,i),this}off(t,e,i){return this.node.removeEventListener(t,e,i),this}onObserve(t){super.onObserve(t),void 0!==t.viewWillSetAttribute&&(this.observerCache.viewWillSetAttributeObservers=e.Arrays.inserted(t,this.observerCache.viewWillSetAttributeObservers)),void 0!==t.viewDidSetAttribute&&(this.observerCache.viewDidSetAttributeObservers=e.Arrays.inserted(t,this.observerCache.viewDidSetAttributeObservers)),void 0!==t.viewWillSetStyle&&(this.observerCache.viewWillSetStyleObservers=e.Arrays.inserted(t,this.observerCache.viewWillSetStyleObservers)),void 0!==t.viewDidSetStyle&&(this.observerCache.viewDidSetStyleObservers=e.Arrays.inserted(t,this.observerCache.viewDidSetStyleObservers))}onUnobserve(t){super.onUnobserve(t),void 0!==t.viewWillSetAttribute&&(this.observerCache.viewWillSetAttributeObservers=e.Arrays.removed(t,this.observerCache.viewWillSetAttributeObservers)),void 0!==t.viewDidSetAttribute&&(this.observerCache.viewDidSetAttributeObservers=e.Arrays.removed(t,this.observerCache.viewDidSetAttributeObservers)),void 0!==t.viewWillSetStyle&&(this.observerCache.viewWillSetStyleObservers=e.Arrays.removed(t,this.observerCache.viewWillSetStyleObservers)),void 0!==t.viewDidSetStyle&&(this.observerCache.viewDidSetStyleObservers=e.Arrays.removed(t,this.observerCache.viewDidSetStyleObservers))}init(t){super.init(t),void 0!==t.id&&this.id(t.id),void 0!==t.classList&&this.addClass(...t.classList)}static create(){let t=this.tag;return void 0===t&&(t="div"),this.fromTag(t)}static fromTag(t,e){let i;return void 0===e&&"svg"===t&&(e=Qn.namespace),i=void 0!==e?document.createElementNS(e,t):document.createElement(t),this.fromNode(i)}static fromNode(t){let e=t.view;if(void 0===e)t instanceof HTMLElement?e=Kn.fromNode(t):t instanceof SVGElement?e=Qn.fromNode(t):(e=new this(t),this.mount(e));else if(!(e instanceof this))throw new TypeError(e+" not an instance of "+this);return e}static fromAny(t){if(null==t)return t;if(t instanceof fn){if(t instanceof this)return t;throw new TypeError(t+" not an instance of "+this)}return t instanceof Node?this.fromNode(t):"string"==typeof t?this.fromTag(t):e.Creatable.is(t)?t.create():this.fromInit(t)}}class Kn extends Xn{constructor(t){super(t)}setChild(t,e){return"string"==typeof e&&(e=Kn.fromTag(e)),super.setChild(t,e)}appendChild(t,e){return"string"==typeof t&&(t=Kn.fromTag(t)),super.appendChild(t,e)}prependChild(t,e){return"string"==typeof t&&(t=Kn.fromTag(t)),super.prependChild(t,e)}insertChild(t,e,i){return"string"==typeof t&&(t=Kn.fromTag(t)),super.insertChild(t,e,i)}replaceChild(t,e){return"string"==typeof t&&(t=Kn.fromTag(t)),super.replaceChild(t,e)}onApplyTheme(t,e,i){super.onApplyTheme(t,e,i),this.node.hasAttribute("swim-theme")&&this.applyRootTheme(t,e,i)}applyRootTheme(t,e,n){const s=t.getOr(At.font,Et.ambient,null);null!==s&&(void 0!==s.style&&this.fontStyle.setState(s.style,void 0,0),void 0!==s.variant&&this.fontVariant.setState(s.variant,void 0,0),void 0!==s.weight&&this.fontWeight.setState(s.weight,void 0,0),void 0!==s.stretch&&this.fontStretch.setState(s.stretch,void 0,0),null!==s.size&&this.fontSize.setState(s.size,void 0,0),null!==s.height&&this.lineHeight.setState(s.height,void 0,0),this.fontFamily.setState(s.family,void 0,0)),this.backgroundColor.setState(t.getOr(At.backgroundColor,Et.ambient,null),n,i.Affinity.Intrinsic),this.color.setState(t.getOr(At.color,Et.ambient,null),n,i.Affinity.Intrinsic)}static isPositioned(t){const e=window.getComputedStyle(t);return"relative"===e.position||"absolute"===e.position}isPositioned(){return Kn.isPositioned(this.node)}static parentTransform(t){if(Kn.isPositioned(t)){const e=t.offsetLeft,i=t.offsetTop;if(0!==e||0!==i)return s.Transform.translate(-e,-i)}return s.Transform.identity()}static pageTransform(t){const e=t.parentNode;return e instanceof HTMLElement?Kn.pageTransform(e).transform(Kn.parentTransform(t)):s.Transform.identity()}get parentTransform(){const t=this.transform.value;if(null!==t)return t;if(this.isPositioned()){const t=this.node.offsetLeft,e=this.node.offsetTop;if(0!==t||0!==e)return s.Transform.translate(-t,-e)}return s.Transform.identity()}get pageTransform(){const t=this.parent;if(null!==t)return t.pageTransform.transform(this.parentTransform);{const t=this.node.parentNode;return t instanceof HTMLElement?Kn.pageTransform(t).transform(this.parentTransform):s.Transform.identity()}}on(t,e,i){return this.node.addEventListener(t,e,i),this}off(t,e,i){return this.node.removeEventListener(t,e,i),this}initAttributes(t){void 0!==t.autocomplete&&this.autocomplete(t.autocomplete),void 0!==t.checked&&this.checked(t.checked),void 0!==t.colspan&&this.colspan(t.colspan),void 0!==t.disabled&&this.disabled(t.disabled),void 0!==t.placeholder&&this.placeholder(t.placeholder),void 0!==t.rowspan&&this.rowspan(t.rowspan),void 0!==t.selected&&this.selected(t.selected),void 0!==t.title&&this.title(t.title),void 0!==t.type&&this.type(t.type),void 0!==t.value&&this.value(t.value)}initStyle(t){Bn.init(this,t)}init(t){super.init(t),void 0!==t.attributes&&this.initAttributes(t.attributes),void 0!==t.style&&this.initStyle(t.style)}static create(){return this.fromTag(this.tag)}static fromTag(t){if("style"===t&&this!==_n)return _n.create();if("svg"===t)return Qn.create();{const e=document.createElement(t);return this.fromNode(e)}}static fromNode(t){let e=t.view;if(void 0===e)e=new this(t),this.mount(e);else if(!(e instanceof this))throw new TypeError(e+" not an instance of "+this);return e}static fromAny(t){if(null==t)return t;if(t instanceof fn){if(t instanceof this)return t;throw new TypeError(t+" not an instance of "+this)}return t instanceof Node?this.fromNode(t):"string"==typeof t?this.fromTag(t):e.Creatable.is(t)?t.create():this.fromInit(t)}static forTag(t){return t===this.tag?this:new Zn(this,t)}}Kn.tag="div",u([bn({attributeName:"autocomplete",type:String})],Kn.prototype,"autocomplete",void 0),u([bn({attributeName:"checked",type:Boolean})],Kn.prototype,"checked",void 0),u([bn({attributeName:"colspan",type:Number})],Kn.prototype,"colspan",void 0),u([bn({attributeName:"disabled",type:Boolean})],Kn.prototype,"disabled",void 0),u([bn({attributeName:"placeholder",type:String})],Kn.prototype,"placeholder",void 0),u([bn({attributeName:"rowspan",type:Number})],Kn.prototype,"rowspan",void 0),u([bn({attributeName:"selected",type:Boolean})],Kn.prototype,"selected",void 0),u([bn({attributeName:"title",type:String})],Kn.prototype,"title",void 0),u([bn({attributeName:"type",type:String})],Kn.prototype,"type",void 0),u([bn({attributeName:"value",type:String})],Kn.prototype,"value",void 0),Bn.define(Kn.prototype);class Zn{constructor(t,e){this.factory=t,this.tag=e}create(){return this.fromTag(this.tag)}fromTag(t){const e=document.createElement(t);return this.fromNode(e)}fromNode(t){return this.factory.fromNode(t)}fromInit(t){let e=t.type;void 0===e&&(e=this);const i=e.create();return i.init(t),i}fromAny(t){return this.factory.fromAny(t)}}class _n extends Kn{constructor(t){super(t)}onApplyTheme(t,e,i){super.onApplyTheme(t,e,i),this.sheet.applyTheme(t,e,i)}init(t){super.init(t)}}_n.tag="style",u([Gn({lazy:!1,createStylesheet(){return this.owner.node.sheet}})],_n.prototype,"sheet",void 0);class Qn extends Xn{constructor(t){super(t)}setChild(t,e){return"string"==typeof e&&(e=Qn.fromTag(e)),super.setChild(t,e)}appendChild(t,e){return"string"==typeof t&&(t=Qn.fromTag(t)),super.appendChild(t,e)}prependChild(t,e){return"string"==typeof t&&(t=Qn.fromTag(t)),super.prependChild(t,e)}insertChild(t,e,i){return"string"==typeof t&&(t=Qn.fromTag(t)),super.insertChild(t,e,i)}replaceChild(t,e){return"string"==typeof t&&(t=Qn.fromTag(t)),super.replaceChild(t,e)}font(t,e){if(void 0===t){const t=this.fontStyle.value,e=this.fontVariant.value,i=this.fontWeight.value,n=this.fontStretch.value,s=this.fontSize.value,o=this.lineHeight.value,r=this.fontFamily.value;return void 0!==r?E.create(t,e,i,n,s,o,r):null}return null!==t?(void 0!==(t=E.fromAny(t)).style&&this.fontStyle.setState(t.style,e),void 0!==t.variant&&this.fontVariant.setState(t.variant,e),void 0!==t.weight&&this.fontWeight.setState(t.weight,e),void 0!==t.stretch&&this.fontStretch.setState(t.stretch,e),void 0!==t.size&&this.fontSize.setState(t.size,e),void 0!==t.height&&this.lineHeight.setState(t.height,e),this.fontFamily.setState(t.family,e)):(this.fontStyle.setState(void 0,e),this.fontVariant.setState(void 0,e),this.fontWeight.setState(void 0,e),this.fontStretch.setState(void 0,e),this.fontSize.setState(null,e),this.lineHeight.setState(null,e),this.fontFamily.setState(void 0,e)),this}get parentTransform(){const t=this.transform.value;return null!==t?t:s.Transform.identity()}on(t,e,i){return this.node.addEventListener(t,e,i),this}off(t,e,i){return this.node.removeEventListener(t,e,i),this}initAttributes(t){void 0!==t.alignmentBaseline&&this.alignmentBaseline(t.alignmentBaseline),void 0!==t.clipPath&&this.clipPath(t.clipPath),void 0!==t.cursor&&this.cursor(t.cursor),void 0!==t.cx&&this.cx(t.cx),void 0!==t.cy&&this.cy(t.cy),void 0!==t.cy&&this.cy(t.cy),void 0!==t.d&&this.d(t.d),void 0!==t.dx&&this.dx(t.dx),void 0!==t.dy&&this.dy(t.dy),void 0!==t.edgeMode&&this.edgeMode(t.edgeMode),void 0!==t.fill&&this.fill(t.fill),void 0!==t.fillRule&&this.fillRule(t.fillRule),void 0!==t.floodColor&&this.floodColor(t.floodColor),void 0!==t.floodOpacity&&this.floodOpacity(t.floodOpacity),void 0!==t.height&&this.height(t.height),void 0!==t.in&&this.in(t.in),void 0!==t.in2&&this.in2(t.in2),void 0!==t.lengthAdjust&&this.lengthAdjust(t.lengthAdjust),void 0!==t.mode&&this.mode(t.mode),void 0!==t.opacity&&this.opacity(t.opacity),void 0!==t.pointerEvents&&this.pointerEvents(t.pointerEvents),void 0!==t.points&&this.points(t.points),void 0!==t.preserveAspectRatio&&this.preserveAspectRatio(t.preserveAspectRatio),void 0!==t.r&&this.r(t.r),void 0!==t.result&&this.result(t.result),void 0!==t.stdDeviation&&this.stdDeviation(t.stdDeviation),void 0!==t.stroke&&this.stroke(t.stroke),void 0!==t.strokeDasharray&&this.strokeDasharray(t.strokeDasharray),void 0!==t.strokeDashoffset&&this.strokeDashoffset(t.strokeDashoffset),void 0!==t.strokeLinecap&&this.strokeLinecap(t.strokeLinecap),void 0!==t.strokeLinejoin&&this.strokeLinejoin(t.strokeLinejoin),void 0!==t.strokeMiterlimit&&this.strokeMiterlimit(t.strokeMiterlimit),void 0!==t.strokeWidth&&this.strokeWidth(t.strokeWidth),void 0!==t.textAnchor&&this.textAnchor(t.textAnchor),void 0!==t.textLength&&this.textLength(t.textLength),void 0!==t.transform&&this.transform(t.transform),void 0!==t.type&&this.type(t.type),void 0!==t.values&&this.values(t.values),void 0!==t.viewBox&&this.viewBox(t.viewBox),void 0!==t.width&&this.width(t.width),void 0!==t.x&&this.x(t.x),void 0!==t.x1&&this.x1(t.x1),void 0!==t.x2&&this.x2(t.x2),void 0!==t.y&&this.y(t.y),void 0!==t.y1&&this.y1(t.y1),void 0!==t.y2&&this.y2(t.y2)}initStyle(t){void 0!==t.cssTransform&&this.cssTransform(t.cssTransform),void 0!==t.filter&&this.filter(t.filter),void 0!==t.fontFamily&&this.fontFamily(t.fontFamily),void 0!==t.fontSize&&this.fontSize(t.fontSize),void 0!==t.fontStretch&&this.fontStretch(t.fontStretch),void 0!==t.fontStyle&&this.fontStyle(t.fontStyle),void 0!==t.fontVariant&&this.fontVariant(t.fontVariant),void 0!==t.fontWeight&&this.fontWeight(t.fontWeight),void 0!==t.lineHeight&&this.lineHeight(t.lineHeight),void 0!==t.touchAction&&this.touchAction(t.touchAction)}init(t){super.init(t),void 0!==t.attributes&&this.initAttributes(t.attributes),void 0!==t.style&&this.initStyle(t.style)}static create(){return this.fromTag(this.tag)}static fromTag(t){const e=document.createElementNS(this.namespace,t);return this.fromNode(e)}static fromNode(t){let e=t.view;if(void 0===e)e=new this(t),this.mount(e);else if(!(e instanceof this))throw new TypeError(e+" not an instance of "+this);return e}static fromAny(t){if(null==t)return t;if(t instanceof fn){if(t instanceof this)return t;throw new TypeError(t+" not an instance of "+this)}return t instanceof Node?this.fromNode(t):"string"==typeof t?this.fromTag(t):e.Creatable.is(t)?t.create():this.fromInit(t)}static forTag(t){return t===this.tag?this:new Jn(this,t)}}Qn.tag="svg",Qn.namespace="http://www.w3.org/2000/svg",u([bn({attributeName:"alignment-baseline",type:String})],Qn.prototype,"alignmentBaseline",void 0),u([bn({attributeName:"clip-path",type:String})],Qn.prototype,"clipPath",void 0),u([bn({attributeName:"cursor",type:String})],Qn.prototype,"cursor",void 0),u([bn({attributeName:"cx",type:Number})],Qn.prototype,"cx",void 0),u([bn({attributeName:"cy",type:Number})],Qn.prototype,"cy",void 0),u([bn({attributeName:"d",type:String})],Qn.prototype,"d",void 0),u([bn({attributeName:"dx",type:s.Length,state:null})],Qn.prototype,"dx",void 0),u([bn({attributeName:"dy",type:s.Length,state:null})],Qn.prototype,"dy",void 0),u([bn({attributeName:"edgeMode",type:String})],Qn.prototype,"edgeMode",void 0),u([bn({attributeName:"fill",type:z,state:null})],Qn.prototype,"fill",void 0),u([bn({attributeName:"fill-rule",type:String})],Qn.prototype,"fillRule",void 0),u([bn({attributeName:"flood-color",type:z,state:null})],Qn.prototype,"floodColor",void 0),u([bn({attributeName:"flood-opacity",type:Number})],Qn.prototype,"floodOpacity",void 0),u([bn({attributeName:"height",type:s.Length,state:null})],Qn.prototype,"height",void 0),u([bn({attributeName:"in",type:String})],Qn.prototype,"in",void 0),u([bn({attributeName:"in2",type:String})],Qn.prototype,"in2",void 0),u([bn({attributeName:"lengthAdjust",type:String})],Qn.prototype,"lengthAdjust",void 0),u([bn({attributeName:"mode",type:String})],Qn.prototype,"mode",void 0),u([bn({attributeName:"opacity",type:Number})],Qn.prototype,"opacity",void 0),u([bn({attributeName:"pointer-events",type:String})],Qn.prototype,"pointerEvents",void 0),u([bn({attributeName:"points",type:String})],Qn.prototype,"points",void 0),u([bn({attributeName:"preserveAspectRatio",type:Boolean})],Qn.prototype,"preserveAspectRatio",void 0),u([bn({attributeName:"r",type:Number})],Qn.prototype,"r",void 0),u([bn({attributeName:"result",type:String})],Qn.prototype,"result",void 0),u([bn({attributeName:"stdDeviation",type:Number})],Qn.prototype,"stdDeviation",void 0),u([bn({attributeName:"stroke",type:z,state:null})],Qn.prototype,"stroke",void 0),u([bn({attributeName:"stroke-dasharray",type:String})],Qn.prototype,"strokeDasharray",void 0),u([bn({attributeName:"stroke-dashoffset",type:Number})],Qn.prototype,"strokeDashoffset",void 0),u([bn({attributeName:"stroke-linecap",type:String})],Qn.prototype,"strokeLinecap",void 0),u([bn({attributeName:"stroke-linejoin",type:String})],Qn.prototype,"strokeLinejoin",void 0),u([bn({attributeName:"stroke-miterlimit",type:Number})],Qn.prototype,"strokeMiterlimit",void 0),u([bn({attributeName:"stroke-width",type:Number})],Qn.prototype,"strokeWidth",void 0),u([bn({attributeName:"text-anchor",type:String})],Qn.prototype,"textAnchor",void 0),u([bn({attributeName:"textLength",type:s.Length,state:null})],Qn.prototype,"textLength",void 0),u([bn({attributeName:"transform",type:s.Transform,state:null})],Qn.prototype,"transform",void 0),u([bn({attributeName:"type",type:String})],Qn.prototype,"type",void 0),u([bn({attributeName:"values",type:String})],Qn.prototype,"values",void 0),u([bn({attributeName:"viewBox",type:String})],Qn.prototype,"viewBox",void 0),u([bn({attributeName:"width",type:s.Length,state:null})],Qn.prototype,"width",void 0),u([bn({attributeName:"x",type:Number})],Qn.prototype,"x",void 0),u([bn({attributeName:"x1",type:Number})],Qn.prototype,"x1",void 0),u([bn({attributeName:"x2",type:Number})],Qn.prototype,"x2",void 0),u([bn({attributeName:"y",type:Number})],Qn.prototype,"y",void 0),u([bn({attributeName:"y1",type:Number})],Qn.prototype,"y1",void 0),u([bn({attributeName:"y2",type:Number})],Qn.prototype,"y2",void 0),u([Pn({propertyNames:"transform",type:s.Transform,state:null})],Qn.prototype,"cssTransform",void 0),u([Pn({propertyNames:"filter",type:String})],Qn.prototype,"filter",void 0),u([Pn({propertyNames:"font-family",type:k})],Qn.prototype,"fontFamily",void 0),u([Pn({propertyNames:"font-size",type:s.Length,state:null})],Qn.prototype,"fontSize",void 0),u([Pn({propertyNames:"font-stretch",type:String})],Qn.prototype,"fontStretch",void 0),u([Pn({propertyNames:"font-style",type:String})],Qn.prototype,"fontStyle",void 0),u([Pn({propertyNames:"font-variant",type:String})],Qn.prototype,"fontVariant",void 0),u([Pn({propertyNames:"font-weight",type:String})],Qn.prototype,"fontWeight",void 0),u([Pn({propertyNames:"line-height",type:s.Length,state:null})],Qn.prototype,"lineHeight",void 0),u([Pn({propertyNames:"touch-action",type:String})],Qn.prototype,"touchAction",void 0);class Jn{constructor(t,e){this.factory=t,this.tag=e}get namespace(){return Qn.namespace}create(){return this.fromTag(this.tag)}fromTag(t){const e=document.createElementNS(this.namespace,t);return this.fromNode(e)}fromNode(t){return this.factory.fromNode(t)}fromInit(t){let e=t.type;void 0===e&&(e=this);const i=e.create();return i.init(t),i}fromAny(t){return this.factory.fromAny(t)}}class $n{constructor(t,e,i){this.sheet=t,this.rowIndex=e,this.colIndex=i}get width(){return this.sheet.spriteWidth}get height(){return this.sheet.spriteHeight}get pixelRatio(){return this.sheet.pixelRatio}getRenderer(){return this.sheet.getSpriteRenderer(this.rowIndex,this.colIndex)}clear(){return this.sheet.clearSprite(this.rowIndex,this.colIndex)}draw(t,e){this.sheet.drawSprite(t,e,this.rowIndex,this.colIndex)}release(){this.sheet.releaseSprite(this)}}class ts{constructor(t,e,i,n,o){const r=Math.floor(n/e),l=Math.floor(i/t),a=r*l,h=new Array(a),d=new Array(a),c=document.createElement("canvas");c.width=i*o,c.height=n*o,c.style.width=i+"px",c.style.height=n+"px";const u=c.getContext("2d"),p=new cs(u,s.Transform.identity(),o);this.spriteWidth=t,this.spriteHeight=e,this.sprites=h,this.freeSprites=d,this.canvas=c,this.renderer=p,this.nextSheet=null,this.createSprites(h,r,l);for(let t=0;t<a;t+=1)d[t]=h[a-t-1]}createSprites(t,e,i){let n=0;for(let s=0;s<e;s+=1)for(let e=0;e<i;e+=1){const i=this.createSprite(s,e);t[n]=i,n+=1}}createSprite(t,e){return new $n(this,t,e)}get pixelRatio(){return this.renderer.pixelRatio}get canvasWidth(){return this.canvas.width/this.pixelRatio}get canvasHeight(){return this.canvas.height/this.pixelRatio}get rowCount(){return Math.floor(this.canvasHeight/this.spriteHeight)}get colCount(){return Math.floor(this.canvasWidth/this.spriteWidth)}get spriteCount(){return this.rowCount*this.colCount}get freeCount(){return this.freeSprites.length}static acquireNextFreeSheet(t){for(;;){const e=t.nextSheet;if(null===e)return null;if(0!==e.freeCount)return t.nextSheet=e.nextSheet,e.nextSheet=null,e;t=e}}acquireSprite(){const t=this.freeSprites.pop();return void 0!==t?t:null}releaseSprite(t){this.clearSprite(t.rowIndex,t.colIndex),this.freeSprites.push(t)}clearSprite(t,e){this.getSpriteRenderer(t,e).context.clearRect(0,0,this.spriteWidth,this.spriteHeight)}getSpriteRenderer(t,e){const i=this.renderer,n=i.context,o=i.pixelRatio,r=t*this.spriteWidth*o,l=e*this.spriteHeight*o;return n.setTransform(o,0,0,o,r,l),i.setTransform(s.Transform.affine(o,0,0,o,r,l)),i}drawSprite(t,e,i,n){const s=this.renderer.pixelRatio,o=this.spriteWidth*s,r=this.spriteHeight*s,l=i*o,a=n*r;t.drawImage(this.canvas,l,a,o,r,e.x,e.y,this.spriteWidth,this.spriteHeight)}}class es{constructor(t,e,i,n,s){void 0===i&&(i=window.devicePixelRatio||1),void 0===t&&(t=Math.floor(es.TextureWidth/i)),void 0===e&&(e=Math.floor(es.TextureHeight/i)),void 0===s&&(s=Math.floor(Math.log2(Math.min(t,e)/4))),void 0===n&&(n=Math.min(4,s)),this.canvasWidth=t,this.canvasHeight=e,this.minSizeClass=n,this.maxSizeClass=s,this.pixelRatio=i;const o=s-n+1,r=new Array(o);for(let t=0;t<o;t+=1)r[t]=null;this.slabs=r}createSlab(t){const e=1<<t;return new ts(e,e,this.canvasWidth,this.canvasHeight,this.pixelRatio)}getFreeSlab(t){if((t=Math.max(this.minSizeClass,t))<=this.maxSizeClass){const e=t-this.minSizeClass,i=this.slabs;let n=i[e];if(null===n)n=this.createSlab(t),i[e]=n;else if(0===n.freeCount){let s=ts.acquireNextFreeSheet(n);null===s&&(s=this.createSlab(t)),s.nextSheet=n,n=s,i[e]=n}return n}return null}createSheet(t,e){return new ts(t,e,t,e,this.pixelRatio)}getFreeSheet(t,e){const i=Math.ceil(Math.log2(t)),n=Math.ceil(Math.log2(e)),s=Math.max(i,n);let o=this.getFreeSlab(s);return null===o&&(o=this.createSheet(t,e)),o}acquireSprite(t,e){return this.getFreeSheet(t,e).acquireSprite()}static global(){return new es}}es.TextureWidth=512,es.TextureHeight=512,u([e.Lazy],es,"global",null);class is{}class ns extends fn{constructor(){super(),this.parent=null,this.ownViewFrame=null,this.eventHandlers=null,this.hoverSet=null}attachParent(t){this.willAttachParent(t),this.parent=t,t.mounted&&(t.culled&&this.cascadeCull(),this.cascadeMount()),this.onAttachParent(t),this.didAttachParent(t)}detachParent(t){this.willDetachParent(t),this.mounted&&this.cascadeUnmount(),this.onDetachParent(t),this.parent=null,this.didDetachParent(t)}needsProcess(t,e){return 0==(this.flags&fn.NeedsAnimate)&&(t&=~fn.NeedsAnimate),t}cascadeProcess(t,e){const i=this.extendViewContext(e),n=Ni.current;try{if(Ni.current=i,t&=~fn.NeedsProcess,t|=this.flags&fn.UpdateMask,0!=((t=this.needsProcess(t,i))&fn.ProcessMask)){let e=t;this.setFlags(this.flags&~(fn.NeedsProcess|fn.NeedsProject)|fn.TraversingFlag|fn.ProcessingFlag|fn.ContextualFlag),this.willProcess(e,i),0!=((this.flags|t)&fn.NeedsResize)&&(e|=fn.NeedsResize,this.setFlags(this.flags&~fn.NeedsResize),this.willResize(i)),0!=((this.flags|t)&fn.NeedsScroll)&&(e|=fn.NeedsScroll,this.setFlags(this.flags&~fn.NeedsScroll),this.willScroll(i)),0!=((this.flags|t)&fn.NeedsChange)&&(e|=fn.NeedsChange,this.setFlags(this.flags&~fn.NeedsChange),this.willChange(i)),0!=((this.flags|t)&fn.NeedsAnimate)&&(e|=fn.NeedsAnimate,this.setFlags(this.flags&~fn.NeedsAnimate),this.willAnimate(i)),this.onProcess(e,i),0!=(e&fn.NeedsResize)&&this.onResize(i),0!=(e&fn.NeedsScroll)&&this.onScroll(i),0!=(e&fn.NeedsChange)&&this.onChange(i),0!=(e&fn.NeedsAnimate)&&this.onAnimate(i),0!=(e&fn.ProcessMask)&&(this.setFlags(this.flags&~fn.ContextualFlag),this.processChildren(e,i,this.processChild),this.setFlags(this.flags|fn.ContextualFlag)),0!=(e&fn.NeedsAnimate)&&this.didAnimate(i),0!=(e&fn.NeedsChange)&&this.didChange(i),0!=(e&fn.NeedsScroll)&&this.didScroll(i),0!=(e&fn.NeedsResize)&&this.didResize(i),this.didProcess(e,i)}}finally{this.setFlags(this.flags&~(fn.TraversingFlag|fn.ProcessingFlag|fn.ContextualFlag)),Ni.current=n}}cascadeDisplay(t,e){const i=this.extendViewContext(e),n=Ni.current;try{if(Ni.current=i,t&=~fn.NeedsDisplay,t|=this.flags&fn.UpdateMask,0!=((t=this.needsDisplay(t,i))&fn.DisplayMask)){let e=t;this.setFlags(this.flags&~fn.NeedsDisplay|fn.TraversingFlag|fn.DisplayingFlag|fn.ContextualFlag),this.willDisplay(e,i),0!=((this.flags|t)&fn.NeedsLayout)&&(e|=fn.NeedsLayout,this.setFlags(this.flags&~fn.NeedsLayout),this.willLayout(i)),0!=((this.flags|t)&fn.NeedsRender)&&(e|=fn.NeedsRender,this.setFlags(this.flags&~fn.NeedsRender),this.willRender(i)),0!=((this.flags|t)&fn.NeedsRasterize)&&(e|=fn.NeedsRasterize,this.setFlags(this.flags&~fn.NeedsRasterize),this.willRasterize(i)),0!=((this.flags|t)&fn.NeedsComposite)&&(e|=fn.NeedsComposite,this.setFlags(this.flags&~fn.NeedsComposite),this.willComposite(i)),this.onDisplay(e,i),0!=(e&fn.NeedsLayout)&&this.onLayout(i),0!=(e&fn.NeedsRender)&&this.onRender(i),0!=(e&fn.NeedsRasterize)&&this.onRasterize(i),0!=(e&fn.NeedsComposite)&&this.onComposite(i),0==(e&fn.DisplayMask)||this.isHidden()||this.culled||(this.setFlags(this.flags&~fn.ContextualFlag),this.displayChildren(e,i,this.displayChild),this.setFlags(this.flags|fn.ContextualFlag)),0!=(e&fn.NeedsComposite)&&this.didComposite(i),0!=(e&fn.NeedsRasterize)&&this.didRasterize(i),0!=(e&fn.NeedsRender)&&this.didRender(i),0!=(e&fn.NeedsLayout)&&this.didLayout(i),this.didDisplay(e,i)}}finally{this.setFlags(this.flags&~(fn.TraversingFlag|fn.DisplayingFlag|fn.ContextualFlag)),Ni.current=n}}willRender(t){const e=this.observerCache.viewWillRenderObservers;if(void 0!==e)for(let i=0;i<e.length;i+=1){e[i].viewWillRender(t,this)}}onRender(t){}didRender(t){const e=this.observerCache.viewDidRenderObservers;if(void 0!==e)for(let i=0;i<e.length;i+=1){e[i].viewDidRender(t,this)}}willRasterize(t){const e=this.observerCache.viewWillRasterizeObservers;if(void 0!==e)for(let i=0;i<e.length;i+=1){e[i].viewWillRasterize(t,this)}}onRasterize(t){}didRasterize(t){const e=this.observerCache.viewDidRasterizeObservers;if(void 0!==e)for(let i=0;i<e.length;i+=1){e[i].viewDidRasterize(t,this)}}willComposite(t){const e=this.observerCache.viewWillCompositeObservers;if(void 0!==e)for(let i=0;i<e.length;i+=1){e[i].viewWillComposite(t,this)}}onComposite(t){}didComposite(t){const e=this.observerCache.viewDidCompositeObservers;if(void 0!==e)for(let i=0;i<e.length;i+=1){e[i].viewDidComposite(t,this)}}renderViewOutline(t,e,i,n){if(t.isDefined()){const s=e.lineWidth,o=e.strokeStyle;e.beginPath(),e.moveTo(t.xMin,t.yMin),e.lineTo(t.xMin,t.yMax),e.lineTo(t.xMax,t.yMax),e.lineTo(t.xMax,t.yMin),e.closePath(),e.lineWidth=n,e.strokeStyle=i.toString(),e.stroke(),e.lineWidth=s,e.strokeStyle=o}}isHidden(){return 0!=(this.flags&fn.HiddenMask)}setHidden(t){const e=this.flags;if(t&&0==(e&fn.HiddenFlag)){if(this.setFlags(e|fn.HiddenFlag),0==(e&fn.HideFlag)){this.setFlags(this.flags|fn.TraversingFlag);try{this.willSetHidden(!0),this.onSetHidden(!0),this.hideChildren(),this.didSetHidden(!0)}finally{this.setFlags(this.flags&~fn.TraversingFlag)}}}else if(!t&&0!=(e&fn.HiddenFlag)&&(this.setFlags(e&~fn.HiddenFlag),0==(e&fn.HideFlag))){this.setFlags(this.flags|fn.TraversingFlag);try{this.willSetHidden(!1),this.unhideChildren(),this.onSetHidden(!1),this.didSetHidden(!1)}finally{this.setFlags(this.flags&~fn.TraversingFlag)}}}cascadeHide(){if(0==(this.flags&fn.HideFlag)&&(this.setFlags(this.flags|fn.HideFlag),0==(this.flags&fn.HiddenFlag))){this.setFlags(this.flags|fn.TraversingFlag);try{this.willSetHidden(!0),this.onSetHidden(!0),this.hideChildren(),this.didSetHidden(!0)}finally{this.setFlags(this.flags&~fn.TraversingFlag)}}}hideChildren(){this.forEachChild((function(t){t instanceof ns&&(t.cascadeHide(),0!=(t.flags&fn.RemovingFlag)&&(t.setFlags(t.flags&~fn.RemovingFlag),this.removeChild(t)))}),this)}cascadeUnhide(){if(0!=(this.flags&fn.HideFlag)&&(this.setFlags(this.flags&~fn.HideFlag),0==(this.flags&fn.HiddenFlag))){this.setFlags(this.flags|fn.TraversingFlag);try{this.willSetHidden(!1),this.unhideChildren(),this.onSetHidden(!1),this.didSetHidden(!1)}finally{this.setFlags(this.flags&~fn.TraversingFlag)}}}unhideChildren(){this.forEachChild((function(t){t instanceof ns&&(t.cascadeUnhide(),0!=(t.flags&fn.RemovingFlag)&&(t.setFlags(t.flags&~fn.RemovingFlag),this.removeChild(t)))}),this)}willSetHidden(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.viewWillSetHidden&&n.viewWillSetHidden(t,this)}}onSetHidden(t){t||this.requireUpdate(fn.NeedsRender)}didSetHidden(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.viewDidSetHidden&&n.viewDidSetHidden(t,this)}}get viewFrame(){let t=this.ownViewFrame;return null===t&&(t=this.deriveViewFrame()),t}setViewFrame(t){this.ownViewFrame=t}deriveViewFrame(){const t=this.parent;return t instanceof ns||t instanceof ps?t.viewFrame:s.R2Box.undefined()}cullViewFrame(t=this.viewFrame){this.setCulled(!t.intersects(this.viewBounds))}get ownViewBounds(){return null}deriveViewBounds(){let t=this.ownViewBounds;return this.forEachChild((function(e){if(e instanceof ns&&!e.isHidden()&&!e.unbounded){const i=e.viewBounds;i.isDefined()&&(t=null!==t?t.union(i):i)}}),this),null===t&&(t=this.viewFrame),t}get hitBounds(){return this.viewBounds}deriveHitBounds(){let t;return this.forEachChild((function(e){if(e instanceof ns&&!e.isHidden()&&!e.intangible){const i=e.hitBounds;t=void 0===t?i:t.union(i)}}),this),void 0===t&&(t=this.viewBounds),t}cascadeHitTest(t,e,i){if(!this.isHidden()&&!this.culled&&!this.intangible){if(this.hitBounds.contains(t,e)){const n=this.extendViewContext(i);let s=this.hitTestChildren(t,e,n);if(null===s){const i=Ni.current;try{Ni.current=n,this.setFlags(this.flags|fn.ContextualFlag),s=this.hitTest(t,e,n)}finally{this.setFlags(this.flags&~fn.ContextualFlag),Ni.current=i}}return s}}return null}hitTest(t,e,i){return null}hitTestChildren(t,e,i){const n=this.forEachChild((function(n){if(n instanceof ns){const s=this.hitTestChild(n,t,e,i);if(null!==s)return s}}),this);return void 0!==n?n:null}hitTestChild(t,e,i,n){return t.cascadeHitTest(e,i,n)}get parentTransform(){return s.Transform.identity()}get clientBounds(){const t=this.clientTransform.inverse();return this.viewBounds.transform(t)}get popoverFrame(){const t=this.pageTransform.inverse();return this.viewBounds.transform(t)}on(t,e,i){let n=this.eventHandlers;null===n&&(n={},this.eventHandlers=n);let s=n[t];const o="boolean"==typeof i?i:"object"==typeof i&&null!==i&&i.capture||!1,r=i&&"object"==typeof i&&i.passive||!1,l=i&&"object"==typeof i&&i.once||!1;let a;if(void 0===s)a={listener:e,capture:o,passive:r,once:l},s=[a],n[t]=s;else{const t=s.length;let i=0;for(;i<t&&(a=s[i],a.listener!==e||a.capture!==o);)i+=1;i<t?(a.passive=r,a.once=l):(a={listener:e,capture:o,passive:r,once:l},s.push(a))}return this}off(t,e,i){const n=this.eventHandlers;if(null!==n){const s=n[t];if(void 0!==s){const o="boolean"==typeof i?i:"object"==typeof i&&null!==i&&i.capture||!1,r=s.length;let l=0;for(;l<r;){const i=s[l];if(i.listener===e&&i.capture===o){s.splice(l,1),0===s.length&&delete n[t];break}l+=1}}}return this}handleEvent(t){const e=t.type,i=this.eventHandlers;if(null!==i){const n=i[e];if(void 0!==n){let s=0;for(;s<n.length;){const e=n[s];if(!e.capture){const i=e.listener;if("function"==typeof i?i.call(this,t):"object"==typeof i&&null!==i&&i.handleEvent(t),e.once){n.splice(s,1);continue}}s+=1}0===n.length&&delete i[e]}}"mouseover"===e?this.onMouseOver(t):"mouseout"===e?this.onMouseOut(t):"pointerover"===e?this.onPointerOver(t):"pointerout"===e&&this.onPointerOut(t)}bubbleEvent(t){let e;if(this.handleEvent(t),t.bubbles&&!t.cancelBubble){const i=this.parent;e=i instanceof ns||i instanceof ps?i.bubbleEvent(t):i}else e=null;return e}dispatchEvent(t){t.targetView=this;const e=this.bubbleEvent(t);return null!==e?e.dispatchEvent(t):!t.cancelBubble}isHovering(){const t=this.hoverSet;return null!==t&&0!==Object.keys(t).length}onMouseOver(t){let e=this.hoverSet;if(null===e&&(e={},this.hoverSet=e),void 0===e.mouse){e.mouse=null;const i=this.eventHandlers;if(null!==i&&void 0!==i.mouseenter){const e=new MouseEvent("mouseenter",{bubbles:!1,button:t.button,buttons:t.buttons,altKey:t.altKey,ctrlKey:t.ctrlKey,metaKey:t.metaKey,shiftKey:t.shiftKey,clientX:t.clientX,clientY:t.clientY,screenX:t.screenX,screenY:t.screenY,movementX:t.movementX,movementY:t.movementY,view:t.view,detail:t.detail,relatedTarget:t.relatedTarget});e.targetView=this,e.relatedTargetView=t.relatedTargetView,this.handleEvent(e)}}}onMouseOut(t){const e=this.hoverSet;if(null!==e&&void 0!==e.mouse){delete e.mouse;const i=this.eventHandlers;if(null!==i&&void 0!==i.mouseleave){const e=new MouseEvent("mouseleave",{bubbles:!1,button:t.button,buttons:t.buttons,altKey:t.altKey,ctrlKey:t.ctrlKey,metaKey:t.metaKey,shiftKey:t.shiftKey,clientX:t.clientX,clientY:t.clientY,screenX:t.screenX,screenY:t.screenY,movementX:t.movementX,movementY:t.movementY,view:t.view,detail:t.detail,relatedTarget:t.relatedTarget});e.targetView=this,e.relatedTargetView=t.relatedTargetView,this.handleEvent(e)}}}onPointerOver(t){let e=this.hoverSet;null===e&&(e={},this.hoverSet=e);const i=""+t.pointerId;if(void 0===e[i]){e[i]=null;const n=this.eventHandlers;if(null!==n&&void 0!==n.pointerenter){const e=new PointerEvent("pointerenter",{bubbles:!1,pointerId:t.pointerId,pointerType:t.pointerType,isPrimary:t.isPrimary,button:t.button,buttons:t.buttons,altKey:t.altKey,ctrlKey:t.ctrlKey,metaKey:t.metaKey,shiftKey:t.shiftKey,clientX:t.clientX,clientY:t.clientY,screenX:t.screenX,screenY:t.screenY,movementX:t.movementX,movementY:t.movementY,tiltX:t.tiltX,tiltY:t.tiltY,twist:t.twist,width:t.width,height:t.height,pressure:t.pressure,tangentialPressure:t.tangentialPressure,view:t.view,detail:t.detail,relatedTarget:t.relatedTarget});e.targetView=this,e.relatedTargetView=t.relatedTargetView,this.handleEvent(e)}}}onPointerOut(t){const e=this.hoverSet;if(null!==e){const i=""+t.pointerId;if(void 0!==e[i]){delete e[i];const n=this.eventHandlers;if(null!==n&&void 0!==n.pointerleave){const e=new PointerEvent("pointerleave",{bubbles:!1,pointerId:t.pointerId,pointerType:t.pointerType,isPrimary:t.isPrimary,button:t.button,buttons:t.buttons,altKey:t.altKey,ctrlKey:t.ctrlKey,metaKey:t.metaKey,shiftKey:t.shiftKey,clientX:t.clientX,clientY:t.clientY,screenX:t.screenX,screenY:t.screenY,movementX:t.movementX,movementY:t.movementY,tiltX:t.tiltX,tiltY:t.tiltY,twist:t.twist,width:t.width,height:t.height,pressure:t.pressure,tangentialPressure:t.tangentialPressure,view:t.view,detail:t.detail,relatedTarget:t.relatedTarget});e.targetView=this,e.relatedTargetView=t.relatedTargetView,this.handleEvent(e)}}}}onObserve(t){super.onObserve(t),void 0!==t.viewWillRender&&(this.observerCache.viewWillRenderObservers=e.Arrays.inserted(t,this.observerCache.viewWillRenderObservers)),void 0!==t.viewDidRender&&(this.observerCache.viewDidRenderObservers=e.Arrays.inserted(t,this.observerCache.viewDidRenderObservers)),void 0!==t.viewWillRasterize&&(this.observerCache.viewWillRasterizeObservers=e.Arrays.inserted(t,this.observerCache.viewWillRasterizeObservers)),void 0!==t.viewDidRasterize&&(this.observerCache.viewDidRasterizeObservers=e.Arrays.inserted(t,this.observerCache.viewDidRasterizeObservers)),void 0!==t.viewWillComposite&&(this.observerCache.viewWillCompositeObservers=e.Arrays.inserted(t,this.observerCache.viewWillCompositeObservers)),void 0!==t.viewDidComposite&&(this.observerCache.viewDidCompositeObservers=e.Arrays.inserted(t,this.observerCache.viewDidCompositeObservers))}onUnobserve(t){super.onUnobserve(t),void 0!==t.viewWillRender&&(this.observerCache.viewWillRenderObservers=e.Arrays.removed(t,this.observerCache.viewWillRenderObservers)),void 0!==t.viewDidRender&&(this.observerCache.viewDidRenderObservers=e.Arrays.removed(t,this.observerCache.viewDidRenderObservers)),void 0!==t.viewWillRasterize&&(this.observerCache.viewWillRasterizeObservers=e.Arrays.removed(t,this.observerCache.viewWillRasterizeObservers)),void 0!==t.viewDidRasterize&&(this.observerCache.viewDidRasterizeObservers=e.Arrays.removed(t,this.observerCache.viewDidRasterizeObservers)),void 0!==t.viewWillComposite&&(this.observerCache.viewWillCompositeObservers=e.Arrays.removed(t,this.observerCache.viewWillCompositeObservers)),void 0!==t.viewDidComposite&&(this.observerCache.viewDidCompositeObservers=e.Arrays.removed(t,this.observerCache.viewDidCompositeObservers))}init(t){super.init(t),void 0!==t.hidden&&this.setHidden(t.hidden)}}ns.UncullFlags=fn.UncullFlags|fn.NeedsRender,ns.InsertChildFlags=fn.InsertChildFlags|fn.NeedsRender,ns.RemoveChildFlags=fn.RemoveChildFlags|fn.NeedsRender,u([i.Provider({type:es,observes:!1,service:es.global()})],ns.prototype,"spriteProvider",void 0),Object.defineProperty(ns.prototype,"renderer",{get(){const t=this.parent;return t instanceof ns||t instanceof ps?t.renderer:null},configurable:!0}),Object.defineProperty(ns.prototype,"viewBounds",{get(){return this.viewFrame},configurable:!0});class ss extends ns{constructor(){super(),this.children=[],this.childMap=null}get childCount(){return this.children.length}firstChild(){const t=this.children;return 0!==t.length?t[0]:null}lastChild(){const t=this.children,e=t.length;return 0!==e?t[e-1]:null}nextChild(t){const e=this.children,i=e.indexOf(t);return i>=0&&i+1<e.length?e[i+1]:null}previousChild(t){const e=this.children,i=e.indexOf(t);return i-1>=0?e[i-1]:null}forEachChild(t,e){let i;const n=this.children;let s=0;for(;s<n.length;){const o=n[s];if(i=t.call(e,o),void 0!==i)break;n[s]===o&&(s+=1)}return i}insertChildMap(t){const e=t.key;if(void 0!==e){let i=this.childMap;null===i&&(i={},this.childMap=i),i[e]=t}}removeChildMap(t){const e=t.key;if(void 0!==e){const t=this.childMap;null!==t&&delete t[e]}}replaceChildMap(t,e){const i=e.key;if(void 0!==i){let e=this.childMap;null===e&&(e={},this.childMap=e),e[i]=t}}getChild(t,e){const i=this.childMap;if(null!==i){const n=i[t];if(void 0!==n&&(void 0===e||n instanceof e))return n}return null}setChild(t,e){null!==e&&(e=fn.fromAny(e));const i=this.getChild(t),n=this.children;let s=-1,o=null;return null!==i&&null!==e&&i!==e?(e.remove(),s=n.indexOf(i),o=s+1<n.length?n[s+1]:null,e.setKey(i.key),this.willRemoveChild(i),this.willInsertChild(e,o),i.detachParent(this),n[s]=e,this.replaceChildMap(e,i),e.attachParent(this),this.onRemoveChild(i),this.onInsertChild(e,o),this.didRemoveChild(i),this.didInsertChild(e,o),i.setKey(void 0),e.cascadeInsert()):(e!==i||null!==e&&e.key!==t)&&(null!==i&&(this.willRemoveChild(i),i.detachParent(this),this.removeChildMap(i),s=n.indexOf(i),n.splice(s,1),this.onRemoveChild(i),this.didRemoveChild(i),i.setKey(void 0),s<n.length&&(o=n[s])),null!==e&&(e.remove(),e.setKey(t),this.willInsertChild(e,o),s>=0?n.splice(s,0,e):n.push(e),this.insertChildMap(e),e.attachParent(this),this.onInsertChild(e,o),this.didInsertChild(e,o),e.cascadeInsert())),i}appendChild(t,e){return(t=fn.fromAny(t)).remove(),void 0!==e&&(this.removeChild(e),t.setKey(e)),this.willInsertChild(t,null),this.children.push(t),this.insertChildMap(t),t.attachParent(this),this.onInsertChild(t,null),this.didInsertChild(t,null),t.cascadeInsert(),t}prependChild(t,e){(t=fn.fromAny(t)).remove(),void 0!==e&&(this.removeChild(e),t.setKey(e));const i=this.children,n=0!==i.length?i[0]:null;return this.willInsertChild(t,n),i.unshift(t),this.insertChildMap(t),t.attachParent(this),this.onInsertChild(t,n),this.didInsertChild(t,n),t.cascadeInsert(),t}insertChild(t,e,i){if(null!==e&&e.parent!==this)throw new TypeError(""+e);(t=fn.fromAny(t)).remove(),void 0!==i&&(this.removeChild(i),t.setKey(i)),this.willInsertChild(t,e);const n=this.children,s=null!==e?n.indexOf(e):-1;return s>=0?n.splice(s,0,t):n.push(t),this.insertChildMap(t),t.attachParent(this),this.onInsertChild(t,e),this.didInsertChild(t,e),t.cascadeInsert(),t}replaceChild(t,e){const i=this.children;if(e.parent!==this)throw new TypeError(""+e);if((t=fn.fromAny(t))!==e){t.remove();const n=i.indexOf(e),s=n+1<i.length?i[n+1]:null;t.setKey(e.key),this.willRemoveChild(e),this.willInsertChild(t,s),e.detachParent(this),i[n]=t,this.replaceChildMap(t,e),t.attachParent(this),this.onRemoveChild(e),this.onInsertChild(t,s),this.didRemoveChild(e),this.didInsertChild(t,s),e.setKey(void 0),t.cascadeInsert()}return e}removeChild(t){let e;if("string"==typeof t){if(e=this.getChild(t),null===e)return null}else if(e=t,e.parent!==this)throw new Error("not a child view");this.willRemoveChild(e),e.detachParent(this),this.removeChildMap(e);const i=this.children,n=i.indexOf(e);return i.splice(n,1),this.onRemoveChild(e),this.didRemoveChild(e),e.setKey(void 0),e}removeChildren(){const t=this.children;let e;for(;e=t.length,0!==e;){const i=t[e-1];this.willRemoveChild(i),i.detachParent(this),this.removeChildMap(i),t.pop(),this.onRemoveChild(i),this.didRemoveChild(i),i.setKey(void 0)}}mountChildren(){const t=this.children;let e=0;for(;e<t.length;){const i=t[e];i.cascadeMount(),0==(i.flags&fn.RemovingFlag)?e+=1:(i.setFlags(i.flags&~fn.RemovingFlag),this.removeChild(i))}}unmountChildren(){const t=this.children;let e=0;for(;e<t.length;){const i=t[e];i.cascadeUnmount(),0==(i.flags&fn.RemovingFlag)?e+=1:(i.setFlags(i.flags&~fn.RemovingFlag),this.removeChild(i))}}cullChildren(){const t=this.children;let e=0;for(;e<t.length;){const i=t[e];i.cascadeCull(),0==(i.flags&fn.RemovingFlag)?e+=1:(i.setFlags(i.flags&~fn.RemovingFlag),this.removeChild(i))}}uncullChildren(){const t=this.children;let e=0;for(;e<t.length;){const i=t[e];i.cascadeUncull(),0==(i.flags&fn.RemovingFlag)?e+=1:(i.setFlags(i.flags&~fn.RemovingFlag),this.removeChild(i))}}processChildren(t,e,i){const n=this.children;let s=0;for(;s<n.length;){const o=n[s];i.call(this,o,t,e),0==(o.flags&fn.RemovingFlag)?s+=1:(o.setFlags(o.flags&~fn.RemovingFlag),this.removeChild(o))}}displayChildren(t,e,i){const n=this.children;let s=0;for(;s<n.length;){const o=n[s];i.call(this,o,t,e),0==(o.flags&fn.RemovingFlag)?s+=1:(o.setFlags(o.flags&~fn.RemovingFlag),this.removeChild(o))}}deriveViewBounds(){let t;const e=this.children;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];if(n instanceof ns&&!n.isHidden()&&!n.unbounded){const e=n.viewBounds;e.isDefined()&&(t=void 0!==t?t.union(e):e)}}return void 0===t&&(t=this.viewFrame),t}deriveHitBounds(){let t;const e=this.children;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];if(n instanceof ns&&!n.isHidden()&&!n.intangible){const e=n.hitBounds;t=void 0===t?e:t.union(e)}}return void 0===t&&(t=this.viewBounds),t}hitTestChildren(t,e,i){const n=this.children;for(let s=n.length-1;s>=0;s-=1){const o=n[s];if(o instanceof ns){const n=this.hitTestChild(o,t,e,i);if(null!==n)return n}}return null}}class os extends is{}class rs{constructor(){this.precision=-1,this.x0=NaN,this.y0=NaN,this.x1=NaN,this.y1=NaN,this.d=""}setPrecision(t){this.precision=t}get anglePrecision(){const t=this.precision;return t>0?Math.max(5,t):t}moveTo(t,e){this.d+="M"+o.Format.decimal(t,this.precision)+","+o.Format.decimal(e,this.precision),this.x0=t,this.y0=e,this.x1=t,this.y1=e}lineTo(t,e){this.d+="L"+o.Format.decimal(t,this.precision)+","+o.Format.decimal(e,this.precision),this.x1=t,this.y1=e}quadraticCurveTo(t,e,i,n){this.d+="Q"+o.Format.decimal(t,this.precision)+","+o.Format.decimal(e,this.precision)+","+o.Format.decimal(i,this.precision)+","+o.Format.decimal(n,this.precision),this.x1=i,this.y1=n}bezierCurveTo(t,e,i,n,s,r){this.d+="C"+o.Format.decimal(t,this.precision)+","+o.Format.decimal(e,this.precision)+","+o.Format.decimal(i,this.precision)+","+o.Format.decimal(n,this.precision)+","+o.Format.decimal(s,this.precision)+","+o.Format.decimal(r,this.precision),this.x1=s,this.y1=r}arcTo(t,e,i,n,s){const r=this.x1,l=this.y1,a=i-t,h=n-e,d=r-t,c=l-e,u=d*d+c*c;if(s<0)throw new Error("negative radius: "+s);if(isNaN(this.x1))this.d+="M"+o.Format.decimal(t,this.precision)+","+o.Format.decimal(e,this.precision),this.x1=t,this.y1=e;else if(u>rs.Epsilon)if(Math.abs(c*a-h*d)>rs.Epsilon&&0!==s){const p=i-r,f=n-l,g=a*a+h*h,v=p*p+f*f,y=Math.sqrt(g),w=Math.sqrt(u),m=s*Math.tan((Math.PI-Math.acos((g+u-v)/(2*y*w)))/2),b=m/w,C=m/y;Math.abs(b-1)>rs.Epsilon&&(this.d+="L"+o.Format.decimal(t+b*d,this.precision)+","+o.Format.decimal(e+b*c,this.precision)),t+=C*a,e+=C*h;const S=o.Format.decimal(s,this.precision);this.d+="A"+S+","+S+",0,0,"+(c*p>d*f?"1":"0")+","+o.Format.decimal(t,this.precision)+","+o.Format.decimal(e,this.precision),this.x1=t,this.y1=e}else this.d+="L"+o.Format.decimal(t,this.precision)+","+o.Format.decimal(e,this.precision),this.x1=t,this.y1=e;else;}arc(t,e,i,n,s,r=!1){const l=t+i*Math.cos(n),a=e+i*Math.sin(n),h=1^+r;let d=r?n-s:s-n;if(i<0)throw new Error("negative radius: "+i);if(isNaN(this.x1)?this.d+="M"+o.Format.decimal(l,this.precision)+","+o.Format.decimal(a,this.precision):(Math.abs(this.x1-l)>rs.Epsilon||Math.abs(this.y1-a)>rs.Epsilon)&&(this.d+="L"+o.Format.decimal(l,this.precision)+","+o.Format.decimal(a,this.precision)),0===i)return;d<0&&(d=d%(2*Math.PI)+2*Math.PI);const c=o.Format.decimal(i,this.precision);if(d>2*Math.PI-rs.Epsilon)this.d+="A"+c+","+c+",0,1,"+(h?"1":"0")+","+o.Format.decimal(l,this.precision)+","+o.Format.decimal(a,this.precision),this.x1=l,this.y1=a;else if(d>rs.Epsilon){const n=t+i*Math.cos(s),r=e+i*Math.sin(s);this.d+="A"+c+","+c+",0,"+(d>=Math.PI?"1":"0")+","+(h?"1":"0")+","+o.Format.decimal(n,this.precision)+","+o.Format.decimal(r,this.precision),this.x1=n,this.y1=r}}rect(t,e,i,n){this.d+="M"+o.Format.decimal(t,this.precision)+","+o.Format.decimal(e,this.precision)+"h"+o.Format.decimal(i,this.precision)+"v"+o.Format.decimal(n,this.precision)+"h"+o.Format.decimal(-i,this.precision)+"Z",this.x0=t,this.y0=e,this.x1=t,this.y1=e}ellipse(t,e,i,n,s,r,l,a=!1){const h=Math.cos(s),d=Math.sin(s),c=Math.cos(l),u=Math.sin(l),p=h*i*c-d*n*u+t,f=d*i*c+h*n*u+e,g=l-r,v=Math.abs(g)>Math.PI,y=!a;this.d+="A"+o.Format.decimal(i,this.precision)+","+o.Format.decimal(n,this.precision)+","+o.Format.decimal(s,this.anglePrecision)+","+(v?"1":"0")+","+(y?"1":"0")+","+o.Format.decimal(p,this.precision)+","+o.Format.decimal(f,this.precision),this.x1=p,this.y1=f}closePath(){isNaN(this.x1)||(this.d+="Z",this.x1=this.x0,this.y1=this.y0)}toString(){return this.d}}rs.Epsilon=1e-6;class ls extends os{constructor(t){super(),this.context=t}get transform(){return s.Transform.identity()}get pixelRatio(){return 1}}class as extends os{}class hs{constructor(t){this.view=t,this.precision=-1,this.pathContext=null,this.pathView=null,this.pathFlags=0,this.fillStyle="",this.strokeStyle="",this.lineWidth=1,this.lineCap="butt",this.lineJoin="miter",this.miterLimit=10,this.lineDashOffset=0,this.lineDash=[]}setPrecision(t){this.precision=t}getPathContext(){const t=this.pathContext;if(null==t)throw new Error("no path");return t}getOrCreatePathContext(){let t=this.pathContext;if(null===t){if(t=this.createPathContext(),this.pathContext=t,null===this.pathView||0!==this.pathFlags){this.finalizePath();const t=this.nextPathView();this.setPathView(t)}this.setPathFlags(0)}return t}createPathContext(){const t=new rs;return t.setPrecision(this.precision),t}setPathView(t){this.pathView=t}nextPathView(){let t=this.pathView;if(null!==t){let e=t.node.nextSibling;for(t=null;null!==e;){if(e instanceof SVGPathElement){t=Qn.fromNode(e);break}e=e.nextSibling}}return t}finalizePath(){const t=this.pathView;if(null!==t){const e=this.pathFlags;if(0==(e&hs.FillFlag)){const e=t.getFastener("fill",i.Property);null!==e&&e.setState(null,i.Affinity.Intrinsic)}if(0==(e&hs.FillRuleFlag)){const e=t.getFastener("fillRule",i.Property);null!==e&&e.setState(void 0,i.Affinity.Intrinsic)}if(0==(e&hs.StrokeFlag)){const e=t.getFastener("stroke",i.Property);null!==e&&e.setState(null,i.Affinity.Intrinsic)}if(0==(e&hs.PathFlag)){const e=t.getFastener("d",i.Property);null!==e&&e.setState(void 0,i.Affinity.Intrinsic)}}}setPathFlags(t){this.pathFlags=t}getLineDash(){return this.lineDash}setLineDash(t){this.lineDash=t}beginPath(){this.pathContext=null}moveTo(t,e){this.getOrCreatePathContext().moveTo(t,e)}lineTo(t,e){this.getPathContext().lineTo(t,e)}quadraticCurveTo(t,e,i,n){this.getPathContext().quadraticCurveTo(t,e,i,n)}bezierCurveTo(t,e,i,n,s,o){this.getPathContext().bezierCurveTo(t,e,i,n,s,o)}arcTo(t,e,i,n,s){this.getPathContext().arcTo(t,e,i,n,s)}arc(t,e,i,n,s,o){this.getOrCreatePathContext().arc(t,e,i,n,s,o)}ellipse(t,e,i,n,s,o,r,l){this.getOrCreatePathContext().ellipse(t,e,i,n,s,o,r,l)}rect(t,e,i,n){this.getOrCreatePathContext().rect(t,e,i,n)}closePath(){const t=this.pathContext;null!==t&&t.closePath()}fill(t){const e=this.fillStyle;if("string"!=typeof e)throw new Error("unsupported fill style: "+e);{let n=this.pathView;null!==n&&0!=(this.pathFlags&hs.FillFlag)&&(this.finalizePath(),n=this.nextPathView(),this.setPathView(n));let s=!1;if(null===n&&(n=Qn.fromTag("path"),this.setPathView(n),s=!0),n.fill.setState(e,i.Affinity.Intrinsic),this.setPathFlags(this.pathFlags|hs.FillFlag),void 0!==t&&(n.fillRule.setState(t,i.Affinity.Intrinsic),this.setPathFlags(this.pathFlags|hs.FillRuleFlag)),0==(this.pathFlags&hs.PathFlag)){const t=this.getPathContext().toString();n.d.setState(t,i.Affinity.Intrinsic),this.setPathFlags(this.pathFlags|hs.PathFlag)}s&&this.view.appendChild(n)}}stroke(){const t=this.strokeStyle,e=this.lineWidth;if("string"!=typeof t||0===e||!isFinite(e))throw new Error("unsupported stroke style: "+t);{let n=this.pathView;null!==n&&0!=(this.pathFlags&hs.StrokeFlag)&&(this.finalizePath(),n=this.nextPathView(),this.setPathView(n));let s=!1;if(null===n&&(n=Qn.fromTag("path"),this.setPathView(n),s=!0),n.stroke.setState(t,i.Affinity.Intrinsic),n.strokeWidth.setState(e,i.Affinity.Intrinsic),n.strokeLinecap.setState(this.lineCap,i.Affinity.Intrinsic),n.strokeLinejoin.setState(this.lineJoin,i.Affinity.Intrinsic),"miter"===this.lineJoin?n.strokeMiterlimit.setState(this.miterLimit,i.Affinity.Intrinsic):n.strokeMiterlimit.setState(void 0,i.Affinity.Intrinsic),0!==this.lineDash.length){let t="";for(let e=0;e<this.lineDash.length;e+=1)0!==e&&(t+=" "),t+=this.lineDash[e];n.strokeDasharray.setState(t,i.Affinity.Intrinsic),0!==this.lineDashOffset?n.strokeDashoffset.setState(this.lineDashOffset,i.Affinity.Intrinsic):n.strokeDashoffset.setState(void 0,i.Affinity.Intrinsic)}else n.strokeDasharray.setState(void 0,i.Affinity.Intrinsic),n.strokeDashoffset.setState(void 0,i.Affinity.Intrinsic);if(this.setPathFlags(this.pathFlags|hs.StrokeFlag),0==(this.pathFlags&hs.PathFlag)){const t=this.getPathContext().toString();n.d.setState(t,i.Affinity.Intrinsic),this.setPathFlags(this.pathFlags|hs.PathFlag)}s&&this.view.appendChild(n)}}beginSvg(){let t=null,e=this.view.node.firstChild;for(;null!==e;){if(e instanceof SVGPathElement){t=Qn.fromNode(e);break}e=e.nextSibling}this.setPathView(t),this.setPathFlags(0)}finalizeSvg(){let t=this.pathView;if(null!==t){let e=t.node.nextSibling;for(null===t.fill.state&&null===t.stroke.state&&(this.pathView=null,t.remove()),t=null;null!==e;){const t=e.view;e=e.nextSibling,void 0!==t&&t.remove()}}}}hs.FillFlag=1,hs.FillRuleFlag=2,hs.StrokeFlag=4,hs.PathFlag=8;class ds extends as{constructor(t){super(),this.context=t}get transform(){return s.Transform.identity()}get pixelRatio(){return 1}}class cs extends as{constructor(t,e,i){super(),this.context=t,this.transform=e,this.pixelRatio=i}setTransform(t){this.transform=t}}class us extends is{constructor(t,e){super(),this.context=t,this.pixelRatio=void 0!==e?e:window.devicePixelRatio||1}}class ps extends Kn{constructor(t){super(t),Object.defineProperty(this,"children",{value:[],writable:!0,enumerable:!0,configurable:!0}),Object.defineProperty(this,"renderer",{value:this.createRenderer(),writable:!0,enumerable:!0,configurable:!0}),this.viewFrame=s.R2Box.undefined(),this.canvasFlags=ps.ClickEventsFlag,this.eventNode=t,this.mouse=null,this.pointers=null,this.touches=null,this.onClick=this.onClick.bind(this),this.onDblClick=this.onDblClick.bind(this),this.onContextMenu=this.onContextMenu.bind(this),this.onWheel=this.onWheel.bind(this),this.onMouseEnter=this.onMouseEnter.bind(this),this.onMouseLeave=this.onMouseLeave.bind(this),this.onMouseDown=this.onMouseDown.bind(this),this.onMouseMove=this.onMouseMove.bind(this),this.onMouseUp=this.onMouseUp.bind(this),this.onPointerEnter=this.onPointerEnter.bind(this),this.onPointerLeave=this.onPointerLeave.bind(this),this.onPointerDown=this.onPointerDown.bind(this),this.onPointerMove=this.onPointerMove.bind(this),this.onPointerUp=this.onPointerUp.bind(this),this.onPointerCancel=this.onPointerCancel.bind(this),this.onTouchStart=this.onTouchStart.bind(this),this.onTouchMove=this.onTouchMove.bind(this),this.onTouchEnd=this.onTouchEnd.bind(this),this.onTouchCancel=this.onTouchCancel.bind(this),this.initCanvas()}initCanvas(){this.position.setState("absolute",i.Affinity.Intrinsic)}get childCount(){return this.children.length}firstChild(){const t=this.children;return 0!==t.length?t[0]:null}lastChild(){const t=this.children,e=t.length;return 0!==e?t[e-1]:null}nextChild(t){const e=this.children,i=e.indexOf(t);return i>=0&&i+1<e.length?e[i+1]:null}previousChild(t){const e=this.children,i=e.indexOf(t);return i-1>=0?e[i-1]:null}forEachChild(t,e){let i;const n=this.children;let s=0;for(;s<n.length;){const o=n[s];if(i=t.call(e,o),void 0!==i)break;n[s]===o&&(s+=1)}return i}getChild(t,e){const i=this.childMap;if(null!==i){const n=i[t];if(void 0!==n&&(void 0===e||n instanceof e))return n}return null}setChild(t,e){let i,n;null===e?(i=null,n=null):(i="string"==typeof e?Kn.fromTag(e):e instanceof Node?jn.fromNode(e):fn.fromAny(e),n=i instanceof jn?i.node:null);const s=this.getChild(t),o=null!==s?s.node:null,r=this.children;let l=-1,a=null,h=null;return null!==s&&null!==i&&s!==i?(i.remove(),l=r.indexOf(s),a=l+1<r.length?r[l+1]:null,h=a instanceof jn?a.node:null,i.setKey(s.key),this.willRemoveChild(s),this.willInsertChild(i,a),s.detachParent(this),r[l]=i,null!==n&&s instanceof jn&&this.node.replaceChild(n,s.node),this.replaceChildMap(i,s),i.attachParent(this),this.onRemoveChild(s),this.onInsertChild(i,a),this.didRemoveChild(s),this.didInsertChild(i,a),s.setKey(void 0),i.cascadeInsert()):(i!==s||null!==i&&i.key!==t)&&(null!==s&&(this.willRemoveChild(s),s.detachParent(this),this.removeChildMap(s),null!==o&&this.node.removeChild(o),l=r.indexOf(s),r.splice(l,1),this.onRemoveChild(s),this.didRemoveChild(s),s.setKey(void 0),l<r.length&&(a=r[l],h=a instanceof jn?a.node:null)),null!==i&&(i.remove(),i.setKey(t),this.willInsertChild(i,a),l>=0?r.splice(l,0,i):r.push(i),null!==n&&this.node.insertBefore(n,h),this.insertChildMap(i),i.attachParent(this),this.onInsertChild(i,a),this.didInsertChild(i,a),i.cascadeInsert())),s}appendChild(t,e){let i,n;return"string"==typeof t?(i=Kn.fromTag(t),n=i.node):t instanceof Node?(i=jn.fromNode(t),n=t):(i=fn.fromAny(t),n=i instanceof jn?i.node:null),i.remove(),void 0!==e&&(this.removeChild(e),i.setKey(e)),this.willInsertChild(i,null),this.children.push(i),null!==n&&this.node.appendChild(n),this.insertChildMap(i),i.attachParent(this),this.onInsertChild(i,null),this.didInsertChild(i,null),i.cascadeInsert(),i}prependChild(t,e){let i,n;"string"==typeof t?(i=Kn.fromTag(t),n=i.node):t instanceof Node?(i=jn.fromNode(t),n=t):(i=fn.fromAny(t),n=i instanceof jn?i.node:null),i.remove(),void 0!==e&&(this.removeChild(e),i.setKey(e));const s=this.children,o=0!==s.length?s[0]:null,r=this.node.firstChild;return this.willInsertChild(i,o),s.unshift(i),null!==n&&this.node.insertBefore(n,r),this.insertChildMap(i),i.attachParent(this),this.onInsertChild(i,o),this.didInsertChild(i,o),i.cascadeInsert(),i}insertChild(t,e,i){var n;let s,o,r,l;if(null===e)s=null,o=null;else if(e instanceof fn)s=e,o=e instanceof jn?e.node:null;else{if(!(e instanceof Node))throw new TypeError(""+e);s=null!==(n=e.view)&&void 0!==n?n:null,o=e}if(null!==s&&s.parent!==this)throw new TypeError(""+s);"string"==typeof t?(r=Kn.fromTag(t),l=r.node):t instanceof Node?(r=jn.fromNode(t),l=t):(r=fn.fromAny(t),l=r instanceof jn?r.node:null),r.remove(),void 0!==i&&(this.removeChild(i),r.setKey(i)),this.willInsertChild(r,s);const a=this.children,h=null!==s?a.indexOf(s):-1;return h>=0?a.splice(h,0,r):a.push(r),null!==l&&this.node.insertBefore(l,o),this.insertChildMap(r),r.attachParent(this),this.onInsertChild(r,s),this.didInsertChild(r,s),r.cascadeInsert(),r}replaceChild(t,e){const i=this.children;if(e.parent!==this)throw new TypeError(""+e);let n,s;if("string"==typeof t?(n=Kn.fromTag(t),s=n.node):t instanceof Node?(n=jn.fromNode(t),s=t):(n=fn.fromAny(t),s=n instanceof jn?n.node:null),n!==e){n.remove();const t=i.indexOf(e),o=t+1<i.length?i[t+1]:null;n.setKey(e.key),this.willRemoveChild(e),this.willInsertChild(n,o),e.detachParent(this),i[t]=n,null!==s&&e instanceof jn&&this.node.replaceChild(s,e.node),this.replaceChildMap(n,e),n.attachParent(this),this.onRemoveChild(e),this.onInsertChild(n,o),this.didRemoveChild(e),this.didInsertChild(n,o),e.setKey(void 0),n.cascadeInsert()}return e}removeChild(t){let e,i;if("string"==typeof t){if(e=this.getChild(t),null===e)return null;i=e instanceof jn?e.node:null}else{if(t instanceof fn)e=t,i=t instanceof jn?t.node:null;else if(e=t.view,i=t,!(e instanceof jn))throw new Error("not a child view");if(e.parent!==this)throw new Error("not a child view")}this.willRemoveChild(e),e.detachParent(this),this.removeChildMap(e),null!==i&&this.node.removeChild(i);const n=this.children,s=n.indexOf(e);return n.splice(s,1),this.onRemoveChild(e),this.didRemoveChild(e),e.setKey(void 0),e}removeChildren(){const t=this.children;let e;for(;e=t.length,0!==e;){const i=t[e-1];this.willRemoveChild(i),i.detachParent(this),this.removeChildMap(i),i instanceof jn&&this.node.removeChild(i.node),t.pop(),this.onRemoveChild(i),this.didRemoveChild(i),i.setKey(void 0)}}onMount(){super.onMount(),this.attachEvents(this.eventNode)}mountChildren(){const t=this.children;let e=0;for(;e<t.length;){const i=t[e];i.cascadeMount(),0==(i.flags&fn.RemovingFlag)?e+=1:(i.setFlags(i.flags&~fn.RemovingFlag),this.removeChild(i))}}onUnmount(){this.detachEvents(this.eventNode),super.onUnmount()}unmountChildren(){const t=this.children;let e=0;for(;e<t.length;){const i=t[e];i.cascadeUnmount(),0==(i.flags&fn.RemovingFlag)?e+=1:(i.setFlags(i.flags&~fn.RemovingFlag),this.removeChild(i))}}cullChildren(){const t=this.children;let e=0;for(;e<t.length;){const i=t[e];i.cascadeCull(),0==(i.flags&fn.RemovingFlag)?e+=1:(i.setFlags(i.flags&~fn.RemovingFlag),this.removeChild(i))}}uncullChildren(){const t=this.children;let e=0;for(;e<t.length;){const i=t[e];i.cascadeUncull(),0==(i.flags&fn.RemovingFlag)?e+=1:(i.setFlags(i.flags&~fn.RemovingFlag),this.removeChild(i))}}isHidden(){return 0!=(this.flags&fn.HiddenFlag)}setHidden(t){0!=(this.flags&fn.HiddenFlag)!==t&&(this.willSetHidden(t),t?this.setFlags(this.flags|fn.HiddenFlag):this.setFlags(this.flags&~fn.HiddenFlag),this.onSetHidden(t),this.didSetHidden(t))}willSetHidden(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.viewWillSetHidden&&n.viewWillSetHidden(t,this)}}onSetHidden(t){t||this.requireUpdate(fn.NeedsRender|fn.NeedsComposite)}didSetHidden(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.viewDidSetHidden&&n.viewDidSetHidden(t,this)}}needsUpdate(t,e){return t=super.needsUpdate(t,e),t|=fn.NeedsRender|fn.NeedsComposite,this.setFlags(this.flags|fn.NeedsRender|fn.NeedsComposite),t}needsProcess(t,e){return 0!=(t&fn.ProcessMask)&&this.requireUpdate(fn.NeedsRender|fn.NeedsComposite),t}onResize(t){super.onResize(t),this.resizeCanvas(this.node),this.resetRenderer(),this.requireUpdate(fn.NeedsLayout|fn.NeedsRender|fn.NeedsComposite)}onScroll(t){super.onScroll(t),this.setCulled(!this.intersectsViewport())}processChildren(t,e,i){const n=this.children;let s=0;for(;s<n.length;){const o=n[s];i.call(this,o,t,e),0==(o.flags&fn.RemovingFlag)?s+=1:(o.setFlags(o.flags&~fn.RemovingFlag),this.removeChild(o))}}cascadeDisplay(t,e){const i=this.extendViewContext(e),n=Ni.current;try{if(Ni.current=i,t&=~fn.NeedsDisplay,t|=this.flags&fn.UpdateMask,0!=((t=this.needsDisplay(t,i))&fn.DisplayMask)){let e=t;this.setFlags(this.flags&~fn.NeedsDisplay|fn.TraversingFlag|fn.DisplayingFlag|fn.ContextualFlag),this.willDisplay(e,i),0!=((this.flags|t)&fn.NeedsLayout)&&(e|=fn.NeedsLayout,this.setFlags(this.flags&~fn.NeedsLayout),this.willLayout(i)),0!=((this.flags|t)&fn.NeedsRender)&&(e|=fn.NeedsRender,this.setFlags(this.flags&~fn.NeedsRender),this.willRender(i)),0!=((this.flags|t)&fn.NeedsRasterize)&&(e|=fn.NeedsRasterize,this.setFlags(this.flags&~fn.NeedsRasterize),this.willRasterize(i)),0!=((this.flags|t)&fn.NeedsComposite)&&(e|=fn.NeedsComposite,this.setFlags(this.flags&~fn.NeedsComposite),this.willComposite(i)),this.onDisplay(e,i),0!=(e&fn.NeedsLayout)&&this.onLayout(i),0!=(e&fn.NeedsRender)&&this.onRender(i),0!=(e&fn.NeedsRasterize)&&this.onRasterize(i),0!=(e&fn.NeedsComposite)&&this.onComposite(i),0==(e&fn.DisplayMask)||this.isHidden()||this.culled||(this.setFlags(this.flags&~fn.ContextualFlag),this.displayChildren(e,i,this.displayChild),this.setFlags(this.flags|fn.ContextualFlag)),0!=(e&fn.NeedsComposite)&&this.didComposite(i),0!=(e&fn.NeedsRasterize)&&this.didRasterize(i),0!=(e&fn.NeedsRender)&&this.didRender(i),0!=(e&fn.NeedsLayout)&&this.didLayout(i),this.didDisplay(e,i)}}finally{this.setFlags(this.flags&~(fn.TraversingFlag|fn.DisplayingFlag|fn.ContextualFlag)),Ni.current=n}}didDisplay(t,e){this.detectHitTargets(),super.didDisplay(t,e)}willRender(t){const e=this.observerCache.viewWillRenderObservers;if(void 0!==e)for(let i=0;i<e.length;i+=1){e[i].viewWillRender(t,this)}}onRender(t){this.clearCanvas()}didRender(t){const e=this.observerCache.viewDidRenderObservers;if(void 0!==e)for(let i=0;i<e.length;i+=1){e[i].viewDidRender(t,this)}}willRasterize(t){const e=this.observerCache.viewWillRasterizeObservers;if(void 0!==e)for(let i=0;i<e.length;i+=1){e[i].viewWillRasterize(t,this)}}onRasterize(t){}didRasterize(t){const e=this.observerCache.viewDidRasterizeObservers;if(void 0!==e)for(let i=0;i<e.length;i+=1){e[i].viewDidRasterize(t,this)}}willComposite(t){const e=this.observerCache.viewWillCompositeObservers;if(void 0!==e)for(let i=0;i<e.length;i+=1){e[i].viewWillComposite(t,this)}}onComposite(t){}didComposite(t){const e=this.observerCache.viewDidCompositeObservers;if(void 0!==e)for(let i=0;i<e.length;i+=1){e[i].viewDidComposite(t,this)}}needsDisplay(t,e){return t|=fn.NeedsRender|fn.NeedsComposite}displayChildren(t,e,i){const n=this.children;let s=0;for(;s<n.length;){const o=n[s];i.call(this,o,t,e),0==(o.flags&fn.RemovingFlag)?s+=1:(o.setFlags(o.flags&~fn.RemovingFlag),this.removeChild(o))}}get pixelRatio(){return window.devicePixelRatio||1}setRenderer(t){"string"==typeof t&&(t=this.createRenderer(t)),this.renderer=t,this.resetRenderer()}createRenderer(t="canvas"){if("canvas"===t){const t=this.node.getContext("2d");if(null!==t){const e=this.pixelRatio,i=s.Transform.affine(e,0,0,e,0,0);return new cs(t,i,e)}throw new Error("Failed to create canvas rendering context")}if("webgl"===t){const t=this.node.getContext("webgl");if(null!==t)return new us(t,this.pixelRatio);throw new Error("Failed to create webgl rendering context")}throw new Error("Failed to create "+t+" renderer")}setCanvasFlags(t){this.canvasFlags=t}extendViewContext(t){const e=Object.create(t);return e.viewFrame=this.viewFrame,e.renderer=this.renderer,e}setViewFrame(t){}get viewBounds(){return this.viewFrame}get hitBounds(){return this.viewFrame}cascadeHitTest(t,e,i){if(!this.isHidden()&&!this.culled&&!this.intangible){if(this.hitBounds.contains(t,e)){void 0===i&&(i=this.superViewContext);const n=this.extendViewContext(i);let s=this.hitTestChildren(t,e,n);if(null===s){const i=Ni.current;try{Ni.current=n,this.setFlags(this.flags|fn.ContextualFlag),s=this.hitTest(t,e,n)}finally{this.setFlags(this.flags&~fn.ContextualFlag),Ni.current=i}}return s}}return null}hitTest(t,e,i){return null}hitTestChildren(t,e,i){const n=this.children;for(let s=n.length-1;s>=0;s-=1){const o=n[s];if(o instanceof ns){const n=this.hitTestChild(o,t,e,i);if(null!==n)return n}}return null}hitTestChild(t,e,i,n){return t.cascadeHitTest(e,i,n)}detectHitTargets(t){if(0!=(this.canvasFlags&ps.MouseEventsFlag)){const e=this.mouse;null!==e&&(void 0===t&&(t=this.clientBounds),this.detectMouseTarget(e,this.clientBounds))}if(0!=(this.canvasFlags&ps.PointerEventsFlag)){const e=this.pointers;for(const i in e){const n=e[i];void 0===t&&(t=this.clientBounds),this.detectPointerTarget(n,t)}}}setEventNode(t){null===t&&(t=this.node);const e=this.eventNode;e!==t&&(this.detachEvents(e),this.eventNode=t,this.attachEvents(t))}clickEventsEnabled(t){const e=0!=(this.canvasFlags&ps.ClickEventsFlag);return void 0===t?e:(t&&!e?(this.setCanvasFlags(this.canvasFlags|ps.ClickEventsFlag),this.attachClickEvents(this.eventNode)):!t&&e&&(this.setCanvasFlags(this.canvasFlags&~ps.ClickEventsFlag),this.detachClickEvents(this.eventNode)),this)}wheelEventsEnabled(t){const e=0!=(this.canvasFlags&ps.WheelEventsFlag);return void 0===t?e:(t&&!e?(this.setCanvasFlags(this.canvasFlags|ps.WheelEventsFlag),this.attachWheelEvents(this.eventNode)):!t&&e&&(this.setCanvasFlags(this.canvasFlags&~ps.WheelEventsFlag),this.detachWheelEvents(this.eventNode)),this)}mouseEventsEnabled(t){const e=0!=(this.canvasFlags&ps.MouseEventsFlag);return void 0===t?e:(t&&!e?(this.setCanvasFlags(this.canvasFlags|ps.MouseEventsFlag),this.attachPassiveMouseEvents(this.eventNode)):!t&&e&&(this.setCanvasFlags(this.canvasFlags&~ps.MouseEventsFlag),this.detachPassiveMouseEvents(this.eventNode)),this)}pointerEventsEnabled(t){const e=0!=(this.canvasFlags&ps.PointerEventsFlag);return void 0===t?e:(t&&!e?(this.setCanvasFlags(this.canvasFlags|ps.PointerEventsFlag),this.attachPassivePointerEvents(this.eventNode)):!t&&e&&(this.setCanvasFlags(this.canvasFlags&~ps.PointerEventsFlag),this.detachPassivePointerEvents(this.eventNode)),this)}touchEventsEnabled(t){const e=0!=(this.canvasFlags&ps.TouchEventsFlag);return void 0===t?e:(t&&!e?(this.setCanvasFlags(this.canvasFlags|ps.TouchEventsFlag),this.attachPassiveTouchEvents(this.eventNode)):!t&&e&&(this.setCanvasFlags(this.canvasFlags&~ps.TouchEventsFlag),this.detachPassiveTouchEvents(this.eventNode)),this)}handleEvent(t){}bubbleEvent(t){return this.handleEvent(t),this}attachEvents(t){0!=(this.canvasFlags&ps.ClickEventsFlag)&&this.attachClickEvents(t),0!=(this.canvasFlags&ps.WheelEventsFlag)&&this.attachWheelEvents(t),0!=(this.canvasFlags&ps.MouseEventsFlag)&&this.attachPassiveMouseEvents(t),0!=(this.canvasFlags&ps.PointerEventsFlag)&&this.attachPassivePointerEvents(t),0!=(this.canvasFlags&ps.TouchEventsFlag)&&this.attachPassiveTouchEvents(t)}detachEvents(t){this.detachClickEvents(t),this.detachWheelEvents(t),this.detachPassiveMouseEvents(t),this.detachActiveMouseEvents(t),this.detachPassivePointerEvents(t),this.detachActivePointerEvents(t),this.detachPassiveTouchEvents(t),this.detachActiveTouchEvents(t)}fireEvent(t,e,i){const n=this.clientBounds;if(n.contains(e,i)){const s=e-n.x,o=i-n.y,r=this.cascadeHitTest(s,o);if(null!==r)return t.targetView=r,r.bubbleEvent(t),r}return null}attachClickEvents(t){t.addEventListener("click",this.onClick),t.addEventListener("dblclick",this.onDblClick),t.addEventListener("contextmenu",this.onContextMenu)}detachClickEvents(t){t.removeEventListener("click",this.onClick),t.removeEventListener("dblclick",this.onDblClick),t.removeEventListener("contextmenu",this.onContextMenu)}attachWheelEvents(t){t.addEventListener("wheel",this.onWheel)}detachWheelEvents(t){t.removeEventListener("wheel",this.onWheel)}attachPassiveMouseEvents(t){t.addEventListener("mouseenter",this.onMouseEnter),t.addEventListener("mouseleave",this.onMouseLeave),t.addEventListener("mousedown",this.onMouseDown)}detachPassiveMouseEvents(t){t.removeEventListener("mouseenter",this.onMouseEnter),t.removeEventListener("mouseleave",this.onMouseLeave),t.removeEventListener("mousedown",this.onMouseDown)}attachActiveMouseEvents(t){document.body.addEventListener("mousemove",this.onMouseMove),document.body.addEventListener("mouseup",this.onMouseUp)}detachActiveMouseEvents(t){document.body.removeEventListener("mousemove",this.onMouseMove),document.body.removeEventListener("mouseup",this.onMouseUp)}updateMouse(t,e){t.button=e.button,t.buttons=e.buttons,t.altKey=e.altKey,t.ctrlKey=e.ctrlKey,t.metaKey=e.metaKey,t.shiftKey=e.shiftKey,t.clientX=e.clientX,t.clientY=e.clientY,t.screenX=e.screenX,t.screenY=e.screenY,t.movementX=e.movementX,t.movementY=e.movementY,t.view=e.view,t.detail=e.detail,t.relatedTarget=e.relatedTarget}fireMouseEvent(t){return this.fireEvent(t,t.clientX,t.clientY)}onClick(t){const e=this.mouse;null!==e&&this.updateMouse(e,t),this.fireMouseEvent(t)}onDblClick(t){const e=this.mouse;null!==e&&this.updateMouse(e,t),this.fireMouseEvent(t)}onContextMenu(t){const e=this.mouse;null!==e&&this.updateMouse(e,t),this.fireMouseEvent(t)}onWheel(t){const e=this.mouse;null!==e&&this.updateMouse(e,t),this.fireMouseEvent(t)}onMouseEnter(t){let e=this.mouse;null===e&&(this.attachActiveMouseEvents(this.eventNode),e={},this.mouse=e),this.updateMouse(e,t)}onMouseLeave(t){null!==this.mouse&&(this.mouse=null,this.detachActiveMouseEvents(this.eventNode))}onMouseDown(t){let e=this.mouse;null===e&&(this.attachActiveMouseEvents(this.eventNode),e={},this.mouse=e),this.updateMouse(e,t),this.fireMouseEvent(t)}onMouseMove(t){let e=this.mouse;null===e&&(e={},this.mouse=e),this.updateMouse(e,t);const i=e.targetView;let n=this.fireMouseEvent(t);null===n&&(n=void 0),n!==i&&this.onMouseTargetChange(e,n,i)}onMouseUp(t){const e=this.mouse;null!==e&&this.updateMouse(e,t),this.fireMouseEvent(t)}onMouseTargetChange(t,e,i){if(t.bubbles=!0,void 0!==i){const n=new MouseEvent("mouseout",t);n.targetView=i,n.relatedTargetView=e,i.bubbleEvent(n)}if(t.targetView=e,void 0!==e){const n=new MouseEvent("mouseover",t);n.targetView=e,n.relatedTargetView=i,e.bubbleEvent(n)}}detectMouseTarget(t,e){const i=t.clientX,n=t.clientY;if(e.contains(i,n)){const s=i-e.x,o=n-e.y,r=t.targetView;let l=this.cascadeHitTest(s,o);null===l&&(l=void 0),l!==r&&this.onMouseTargetChange(t,l,r)}}attachPassivePointerEvents(t){t.addEventListener("pointerenter",this.onPointerEnter),t.addEventListener("pointerleave",this.onPointerLeave),t.addEventListener("pointerdown",this.onPointerDown)}detachPassivePointerEvents(t){t.removeEventListener("pointerenter",this.onPointerEnter),t.removeEventListener("pointerleave",this.onPointerLeave),t.removeEventListener("pointerdown",this.onPointerDown)}attachActivePointerEvents(t){document.body.addEventListener("pointermove",this.onPointerMove),document.body.addEventListener("pointerup",this.onPointerUp),document.body.addEventListener("pointercancel",this.onPointerCancel)}detachActivePointerEvents(t){document.body.removeEventListener("pointermove",this.onPointerMove),document.body.removeEventListener("pointerup",this.onPointerUp),document.body.removeEventListener("pointercancel",this.onPointerCancel)}updatePointer(t,e){t.pointerId=e.pointerId,t.pointerType=e.pointerType,t.isPrimary=e.isPrimary,t.button=e.button,t.buttons=e.buttons,t.altKey=e.altKey,t.ctrlKey=e.ctrlKey,t.metaKey=e.metaKey,t.shiftKey=e.shiftKey,t.clientX=e.clientX,t.clientY=e.clientY,t.screenX=e.screenX,t.screenY=e.screenY,t.movementX=e.movementX,t.movementY=e.movementY,t.width=e.width,t.height=e.height,t.tiltX=e.tiltX,t.tiltY=e.tiltY,t.twist=e.twist,t.pressure=e.pressure,t.tangentialPressure=e.tangentialPressure,t.view=e.view,t.detail=e.detail,t.relatedTarget=e.relatedTarget}firePointerEvent(t){return this.fireEvent(t,t.clientX,t.clientY)}onPointerEnter(t){const e=""+t.pointerId;let i=this.pointers;null===i&&(i={},this.pointers=i);let n=i[e];void 0===n&&(0===Object.keys(i).length&&this.attachActivePointerEvents(this.eventNode),n={},i[e]=n),this.updatePointer(n,t)}onPointerLeave(t){const e=""+t.pointerId;let i=this.pointers;null===i&&(i={},this.pointers=i);const n=i[e];void 0!==n&&(void 0!==n.targetView&&this.onPointerTargetChange(n,void 0,n.targetView),delete i[e],0===Object.keys(i).length&&this.detachActivePointerEvents(this.eventNode))}onPointerDown(t){const e=""+t.pointerId;let i=this.pointers;null===i&&(i={},this.pointers=i);let n=i[e];void 0===n&&(0===Object.keys(i).length&&this.attachActivePointerEvents(this.eventNode),n={},i[e]=n),this.updatePointer(n,t),this.firePointerEvent(t)}onPointerMove(t){const e=""+t.pointerId;let i=this.pointers;null===i&&(i={},this.pointers=i);let n=i[e];void 0===n&&(0===Object.keys(i).length&&this.attachActivePointerEvents(this.eventNode),n={},i[e]=n),this.updatePointer(n,t);const s=n.targetView;let o=this.firePointerEvent(t);null===o&&(o=void 0),o!==s&&this.onPointerTargetChange(n,o,s)}onPointerUp(t){const e=""+t.pointerId;let i=this.pointers;null===i&&(i={},this.pointers=i);const n=i[e];void 0!==n&&this.updatePointer(n,t),this.firePointerEvent(t),void 0!==n&&"mouse"!==t.pointerType&&(void 0!==n.targetView&&this.onPointerTargetChange(n,void 0,n.targetView),delete i[e],0===Object.keys(i).length&&this.detachActivePointerEvents(this.eventNode))}onPointerCancel(t){const e=""+t.pointerId;let i=this.pointers;null===i&&(i={},this.pointers=i);const n=i[e];void 0!==n&&this.updatePointer(n,t),this.firePointerEvent(t),void 0!==n&&"mouse"!==t.pointerType&&(void 0!==n.targetView&&this.onPointerTargetChange(n,void 0,n.targetView),delete i[e],0===Object.keys(i).length&&this.detachActivePointerEvents(this.eventNode))}onPointerTargetChange(t,e,i){if(t.bubbles=!0,void 0!==i){const n=new PointerEvent("pointerout",t);n.targetView=i,n.relatedTargetView=e,i.bubbleEvent(n)}if(t.targetView=e,void 0!==e){const n=new PointerEvent("pointerover",t);n.targetView=e,n.relatedTargetView=i,e.bubbleEvent(n)}}detectPointerTarget(t,e){const i=t.clientX,n=t.clientY;if(e.contains(i,n)){const s=i-e.x,o=n-e.y,r=t.targetView;let l=this.cascadeHitTest(s,o);null===l&&(l=void 0),l!==r&&this.onPointerTargetChange(t,l,r)}}attachPassiveTouchEvents(t){t.addEventListener("touchstart",this.onTouchStart)}detachPassiveTouchEvents(t){t.removeEventListener("touchstart",this.onTouchStart)}attachActiveTouchEvents(t){t.addEventListener("touchmove",this.onTouchMove),t.addEventListener("touchend",this.onTouchEnd),t.addEventListener("touchcancel",this.onTouchCancel)}detachActiveTouchEvents(t){t.removeEventListener("touchmove",this.onTouchMove),t.removeEventListener("touchend",this.onTouchEnd),t.removeEventListener("touchcancel",this.onTouchCancel)}updateTouch(t,e){t.clientX=e.clientX,t.clientY=e.clientY,t.screenX=e.screenX,t.screenY=e.screenY,t.pageX=e.pageX,t.pageY=e.pageY,t.radiusX=e.radiusX,t.radiusY=e.radiusY,t.rotationAngle=e.rotationAngle,t.force=e.force}fireTouchEvent(t,e){const i=e.changedTouches,n=[];for(let s=0,o=i.length;s<o;s+=1){const r=i[s],l=r.targetView;if(void 0!==l&&n.indexOf(l)<0){const a=new TouchEvent(t,{changedTouches:i,targetTouches:e.targetTouches,touches:e.touches,bubbles:!0});a.targetView=l;const h=[r];for(let t=s+1;t<o;t+=1){const e=i[t];e.targetView===l&&h.push(e)}void 0!==document.createTouchList?a.targetViewTouches=document.createTouchList(...h):(h.item=function(t){return h[t]},a.targetViewTouches=h),l.bubbleEvent(a),n.push(l)}}}onTouchStart(t){let e,i=this.touches;null===i&&(i={},this.touches=i);const n=t.changedTouches;for(let t=0,s=n.length;t<s;t+=1){const s=n[t],o=""+s.identifier;let r=i[o];void 0===r&&(0===Object.keys(i).length&&this.attachActiveTouchEvents(this.eventNode),r={identifier:s.identifier,target:s.target},i[o]=r),this.updateTouch(r,s);const l=r.clientX,a=r.clientY;if(void 0===e&&(e=this.clientBounds),e.contains(l,a)){const t=l-e.x,i=a-e.y,n=this.cascadeHitTest(t,i);null!==n&&(r.targetView=n,s.targetView=n)}}this.fireTouchEvent("touchstart",t)}onTouchMove(t){let e=this.touches;null===e&&(e={},this.touches=e);const i=t.changedTouches;for(let t=0,n=i.length;t<n;t+=1){const n=i[t],s=""+n.identifier;let o=e[s];void 0===o&&(o={identifier:n.identifier,target:n.target},e[s]=o),this.updateTouch(o,n),n.targetView=o.targetView}this.fireTouchEvent("touchmove",t)}onTouchEnd(t){let e=this.touches;null===e&&(e={},this.touches=e);const i=t.changedTouches,n=i.length;for(let t=0;t<n;t+=1){const n=i[t],s=""+n.identifier;let o=e[s];void 0===o&&(o={identifier:n.identifier,target:n.target},e[s]=o),this.updateTouch(o,n),n.targetView=o.targetView}this.fireTouchEvent("touchend",t);for(let t=0;t<n;t+=1){delete e[""+i[t].identifier],0===Object.keys(e).length&&this.detachActiveTouchEvents(this.eventNode)}}onTouchCancel(t){let e=this.touches;null===e&&(e={},this.touches=e);const i=t.changedTouches,n=i.length;for(let t=0;t<n;t+=1){const n=i[t],s=""+n.identifier;let o=e[s];void 0===o&&(o={identifier:n.identifier,target:n.target},e[s]=o),this.updateTouch(o,n),n.targetView=o.targetView}this.fireTouchEvent("touchcancel",t);for(let t=0;t<n;t+=1){delete e[""+i[t].identifier],0===Object.keys(e).length&&this.detachActiveTouchEvents(this.eventNode)}}resizeCanvas(t){let e,i,n,o=t.parentNode;if(o instanceof HTMLElement){do{if(e=Math.floor(o.offsetWidth),i=Math.floor(o.offsetHeight),0!==e&&0!==i)break;0!==e&&0!==i||!Kn.isPositioned(o)||this.requireUpdate(fn.NeedsResize),o=o.parentNode}while(o instanceof HTMLElement);n=this.pixelRatio,t.width=e*n,t.height=i*n,t.style.width=e+"px",t.style.height=i+"px"}else e=Math.floor(t.width),i=Math.floor(t.height),n=1;this.viewFrame=new s.R2Box(0,0,e,i)}clearCanvas(){const t=this.renderer;if(t instanceof cs){const e=this.viewFrame;t.context.clearRect(0,0,e.width,e.height)}else if(t instanceof us){const e=t.context;e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT)}}resetRenderer(){const t=this.renderer;if(t instanceof cs){const e=this.pixelRatio;t.context.setTransform(e,0,0,e,0,0)}else if(t instanceof us){const e=this.viewFrame;t.context.viewport(0,0,e.width,e.height)}}onObserve(t){super.onObserve(t),void 0!==t.viewWillRender&&(this.observerCache.viewWillRenderObservers=e.Arrays.inserted(t,this.observerCache.viewWillRenderObservers)),void 0!==t.viewDidRender&&(this.observerCache.viewDidRenderObservers=e.Arrays.inserted(t,this.observerCache.viewDidRenderObservers)),void 0!==t.viewWillRasterize&&(this.observerCache.viewWillRasterizeObservers=e.Arrays.inserted(t,this.observerCache.viewWillRasterizeObservers)),void 0!==t.viewDidRasterize&&(this.observerCache.viewDidRasterizeObservers=e.Arrays.inserted(t,this.observerCache.viewDidRasterizeObservers)),void 0!==t.viewWillComposite&&(this.observerCache.viewWillCompositeObservers=e.Arrays.inserted(t,this.observerCache.viewWillCompositeObservers)),void 0!==t.viewDidComposite&&(this.observerCache.viewDidCompositeObservers=e.Arrays.inserted(t,this.observerCache.viewDidCompositeObservers))}onUnobserve(t){super.onUnobserve(t),void 0!==t.viewWillRender&&(this.observerCache.viewWillRenderObservers=e.Arrays.removed(t,this.observerCache.viewWillRenderObservers)),void 0!==t.viewDidRender&&(this.observerCache.viewDidRenderObservers=e.Arrays.removed(t,this.observerCache.viewDidRenderObservers)),void 0!==t.viewWillRasterize&&(this.observerCache.viewWillRasterizeObservers=e.Arrays.removed(t,this.observerCache.viewWillRasterizeObservers)),void 0!==t.viewDidRasterize&&(this.observerCache.viewDidRasterizeObservers=e.Arrays.removed(t,this.observerCache.viewDidRasterizeObservers)),void 0!==t.viewWillComposite&&(this.observerCache.viewWillCompositeObservers=e.Arrays.removed(t,this.observerCache.viewWillCompositeObservers)),void 0!==t.viewDidComposite&&(this.observerCache.viewDidCompositeObservers=e.Arrays.removed(t,this.observerCache.viewDidCompositeObservers))}init(t){super.init(t),void 0!==t.renderer&&this.setRenderer(t.renderer),void 0!==t.clickEventsEnabled&&this.clickEventsEnabled(t.clickEventsEnabled),void 0!==t.wheelEventsEnabled&&this.wheelEventsEnabled(t.wheelEventsEnabled),void 0!==t.mouseEventsEnabled&&this.mouseEventsEnabled(t.mouseEventsEnabled),void 0!==t.pointerEventsEnabled&&this.pointerEventsEnabled(t.pointerEventsEnabled),void 0!==t.touchEventsEnabled&&this.touchEventsEnabled(t.touchEventsEnabled)}}ps.tag="canvas",ps.ClickEventsFlag=1,ps.WheelEventsFlag=2,ps.MouseEventsFlag=4,ps.PointerEventsFlag=8,ps.TouchEventsFlag=16,ps.EventsMask=ps.ClickEventsFlag|ps.WheelEventsFlag|ps.MouseEventsFlag|ps.PointerEventsFlag|ps.TouchEventsFlag,ps.UncullFlags=Kn.UncullFlags|fn.NeedsRender|fn.NeedsComposite,u([i.Provider({type:es,observes:!1,service:es.global()})],ps.prototype,"spriteProvider",void 0);class fs extends ss{constructor(){super(),this.canvas=this.createCanvas(),Object.defineProperty(this,"renderer",{value:this.createRenderer(),writable:!0,enumerable:!0,configurable:!0}),this.ownRasterFrame=null}get pixelRatio(){return window.devicePixelRatio||1}get compositor(){const t=this.parent;return t instanceof ns||t instanceof ps?t.renderer:null}setRenderer(t){"string"==typeof t&&(t=this.createRenderer(t)),this.renderer=t,this.requireUpdate(fn.NeedsRender|fn.NeedsComposite)}createRenderer(t="canvas"){if("canvas"===t){const t=this.canvas.getContext("2d");if(null!==t)return new cs(t,s.Transform.identity(),this.pixelRatio);throw new Error("Failed to create canvas rendering context")}if("webgl"===t){const t=this.canvas.getContext("webgl");if(null!==t)return new us(t,this.pixelRatio);throw new Error("Failed to create webgl rendering context")}throw new Error("Failed to create "+t+" renderer")}needsUpdate(t,e){const i=(t=super.needsUpdate(t,e))&(fn.NeedsRender|fn.NeedsComposite);return 0!==i&&(t|=fn.NeedsComposite,this.setFlags(this.flags|fn.NeedsDisplay|fn.NeedsComposite|i)),t}needsProcess(t,e){return 0==(this.flags&fn.ProcessMask)&&0==(t&fn.NeedsResize)&&(t=0),t}onResize(t){super.onResize(t),this.requireUpdate(fn.NeedsRender|fn.NeedsComposite)}needsDisplay(t,e){return 0!=(this.flags&fn.DisplayMask)?t|=fn.NeedsComposite:t=0!=(t&fn.NeedsComposite)?fn.NeedsDisplay|fn.NeedsComposite:0,t}onRender(t){const e=this.rasterFrame;this.resizeCanvas(this.canvas,e),this.resetRenderer(e),this.clearCanvas(e),super.onRender(t)}didComposite(t){this.compositeImage(t),super.didComposite(t)}onSetHidden(t){t||this.requireUpdate(fn.NeedsRender|fn.NeedsComposite)}extendViewContext(t){const e=Object.create(t);return e.compositor=t.renderer,e.renderer=this.renderer,e}get rasterFrame(){let t=this.ownRasterFrame;return null===t&&(t=this.deriveRasterFrame()),t}setRasterFrame(t){this.ownRasterFrame=t}deriveRasterFrame(){return this.viewBounds}createCanvas(){return document.createElement("canvas")}resizeCanvas(t,e){const i=this.pixelRatio,n=e.width,s=e.height,o=n*i,r=s*i,l=t.width,a=t.height;o===l&&r===a||(t.width=o,t.height=r,t.style.width=n+"px",t.style.height=s+"px")}clearCanvas(t){const e=this.renderer;if(e instanceof cs)e.context.clearRect(0,0,t.xMax,t.yMax);else if(e instanceof us){const t=e.context;t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT)}}resetRenderer(t){const e=this.renderer;if(e instanceof cs){const i=this.pixelRatio,n=t.xMin*i,o=t.yMin*i;e.context.setTransform(i,0,0,i,-n,-o),e.setTransform(s.Transform.affine(i,0,0,i,-n,-o))}else e instanceof us&&e.context.viewport(t.x,t.y,t.xMax,t.yMax)}compositeImage(t){const e=t.compositor;if(e instanceof cs){const t=e.context,i=this.rasterFrame,n=this.canvas;if(i.isDefined()&&0!==i.width&&0!==i.height&&0!==n.width&&0!==n.height){const e=t.globalAlpha,s=t.globalCompositeOperation;t.globalAlpha=this.opacity.getValue(),t.globalCompositeOperation=this.compositeOperation.getState(),t.drawImage(n,i.x,i.y,i.width,i.height),t.globalAlpha=e,t.globalCompositeOperation=s}}}init(t){super.init(t),void 0!==t.opacity&&this.opacity(t.opacity),void 0!==t.compositeOperation&&this.compositeOperation(t.compositeOperation)}}fs.MountFlags=ss.MountFlags|fn.NeedsRender|fn.NeedsComposite,fs.UncullFlags=ss.UncullFlags|fn.NeedsRender|fn.NeedsComposite,u([te({type:Number,state:1,updateFlags:fn.NeedsComposite})],fs.prototype,"opacity",void 0),u([i.Property({type:String,state:"source-over",updateFlags:fn.NeedsComposite})],fs.prototype,"compositeOperation",void 0),Object.defineProperty(fs.prototype,"viewBounds",{get(){return this.deriveViewBounds()},configurable:!0});const gs=function(){const t={init:function(t,e){void 0!==e.fill&&t.fill(e.fill)},is:function(t){if("object"==typeof t&&null!==t){const e=t;return e instanceof ns&&"fill"in e}return!1}};return t}(),vs=function(){const t={init:function(t,e){void 0!==e.stroke&&t.stroke(e.stroke),void 0!==e.strokeWidth&&t.strokeWidth(e.strokeWidth)},is:function(t){if("object"==typeof t&&null!==t){const e=t;return e instanceof ns&&"stroke"in e&&"strokeWidth"in e}return!1}};return t}();class ys{constructor(t,e,i,n){this.x=t,this.y=e,this.width=i,this.height=n}withX(t){return t=s.Length.fromAny(t),this.x.equals(t)?this:this.copy(t,this.y,this.width,this.height)}withY(t){return t=s.Length.fromAny(t),this.y.equals(t)?this:this.copy(this.x,t,this.width,this.height)}withWidth(t){return t=s.Length.fromAny(t),this.width.equals(t)?this:this.copy(this.x,this.y,t,this.height)}withHeight(t){return t=s.Length.fromAny(t),this.height.equals(t)?this:this.copy(this.x,this.y,this.width,t)}render(t,e){if(void 0===t){const t=new rs;return t.setPrecision(3),this.draw(t,e),t.toString()}t instanceof ls&&this.draw(t.context,e)}draw(t,e=null){this.renderRect(t,e)}renderRect(t,e){t.rect(this.x.pxValue(),this.y.pxValue(),this.width.pxValue(),this.height.pxValue())}copy(t,e,i,n){return new ys(t,e,i,n)}toAny(){return{x:this.x,y:this.y,width:this.width,height:this.height}}equals(t){return this===t||t instanceof ys&&(this.x.equals(t.x)&&this.y.equals(t.y)&&this.width.equals(t.width)&&this.height.equals(t.height))}debug(t){return t=t.write("Rect").write(46).write("create").write(40).debug(this.x).write(", ").debug(this.y).write(", ").debug(this.width).write(", ").debug(this.height).write(41)}toString(){return o.Format.debug(this)}static create(t,e,i,n){return t=s.Length.fromAny(t),e=s.Length.fromAny(e),i=s.Length.fromAny(i),n=s.Length.fromAny(n),new ys(t,e,i,n)}static fromAny(t){if(t instanceof ys)return t;if("object"==typeof t&&null!==t)return ys.create(t.x,t.y,t.width,t.height);throw new TypeError(""+t)}}class ws extends ss{get value(){return new ys(this.x.getValue(),this.y.getValue(),this.width.getValue(),this.height.getValue())}get state(){return new ys(this.x.getState(),this.y.getState(),this.width.getState(),this.height.getState())}setState(t,e){t instanceof ys&&(t=t.toAny()),void 0!==t.x&&this.x(t.x,e),void 0!==t.y&&this.y(t.y,e),void 0!==t.width&&this.width(t.width,e),void 0!==t.height&&this.height(t.height,e),void 0!==t.fill&&this.fill(t.fill,e),void 0!==t.stroke&&this.stroke(t.stroke,e),void 0!==t.strokeWidth&&this.strokeWidth(t.strokeWidth,e)}onRender(t){super.onRender(t);const e=t.renderer;e instanceof as&&!this.isHidden()&&!this.culled&&this.renderRect(e.context,this.viewFrame)}renderRect(t,e){const i=this.x.getValue().pxValue(e.width),n=this.y.getValue().pxValue(e.height),s=this.width.getValue().pxValue(e.width),o=this.height.getValue().pxValue(e.height),r=t.fillStyle,l=t.lineWidth,a=t.strokeStyle;t.beginPath(),t.rect(i,n,s,o);const h=this.fill.value;null!==h&&(t.fillStyle=h.toString(),t.fill());const d=this.stroke.value;if(null!==d){const i=this.strokeWidth.value;if(null!==i){const n=Math.min(e.width,e.height);t.lineWidth=i.pxValue(n)}t.strokeStyle=d.toString(),t.stroke()}t.fillStyle=r,t.lineWidth=l,t.strokeStyle=a}hitTest(t,e,i){const n=i.renderer;if(n instanceof cs){const i=n.transform.transform(t,e);return this.hitTestRect(i.x,i.y,n.context,this.viewFrame)}return null}hitTestRect(t,e,i,n){const s=this.x.getValue().pxValue(n.width),o=this.y.getValue().pxValue(n.height),r=this.width.getValue().pxValue(n.width),l=this.height.getValue().pxValue(n.height);if(i.beginPath(),i.rect(s,o,r,l),null!==this.fill.value&&i.isPointInPath(t,e))return this;if(null!==this.stroke.value){const s=this.strokeWidth.value;if(null!==s){const o=i.lineWidth,r=Math.min(n.width,n.height);i.lineWidth=s.pxValue(r);const l=i.isPointInStroke(t,e);if(i.lineWidth=o,l)return this}}return null}init(t){t instanceof ys||super.init(t),this.setState(t)}}u([Ht({type:s.Length,state:s.Length.zero(),updateFlags:fn.NeedsRender})],ws.prototype,"x",void 0),u([Ht({type:s.Length,state:s.Length.zero(),updateFlags:fn.NeedsRender})],ws.prototype,"y",void 0),u([Ht({type:s.Length,state:s.Length.zero(),updateFlags:fn.NeedsRender})],ws.prototype,"width",void 0),u([Ht({type:s.Length,state:s.Length.zero(),updateFlags:fn.NeedsRender})],ws.prototype,"height",void 0),u([Ht({type:z,state:null,inherits:!0,updateFlags:fn.NeedsRender})],ws.prototype,"fill",void 0),u([Ht({type:z,state:null,inherits:!0,updateFlags:fn.NeedsRender})],ws.prototype,"stroke",void 0),u([Ht({type:s.Length,state:null,inherits:!0,updateFlags:fn.NeedsRender})],ws.prototype,"strokeWidth",void 0),Object.defineProperty(ws.prototype,"viewBounds",{get(){const t=this.viewFrame,e=this.x.getValue().pxValue(t.width),i=this.y.getValue().pxValue(t.height),n=this.width.getValue().pxValue(t.width),o=this.height.getValue().pxValue(t.height);return new s.R2Box(e,i,e+n,i+o)},configurable:!0});class ms{constructor(t,e,i,n,s,o,r,l){this.center=t,this.innerRadius=e,this.outerRadius=i,this.startAngle=n,this.sweepAngle=s,this.padAngle=o,this.padRadius=r,this.cornerRadius=l}withCenter(t){return t=s.R2Point.fromAny(t),this.center.equals(t)?this:this.copy(t,this.innerRadius,this.outerRadius,this.startAngle,this.sweepAngle,this.padAngle,this.padRadius,this.cornerRadius)}withInnerRadius(t){return t=s.Length.fromAny(t),this.innerRadius.equals(t)?this:this.copy(this.center,t,this.outerRadius,this.startAngle,this.sweepAngle,this.padAngle,this.padRadius,this.cornerRadius)}withOuterRadius(t){return t=s.Length.fromAny(t),this.outerRadius.equals(t)?this:this.copy(this.center,this.innerRadius,t,this.startAngle,this.sweepAngle,this.padAngle,this.padRadius,this.cornerRadius)}withStartAngle(t){return t=s.Angle.fromAny(t),this.startAngle.equals(t)?this:this.copy(this.center,this.innerRadius,this.outerRadius,t,this.sweepAngle,this.padAngle,this.padRadius,this.cornerRadius)}withSweepAngle(t){return t=s.Angle.fromAny(t),this.sweepAngle.equals(t)?this:this.copy(this.center,this.innerRadius,this.outerRadius,this.startAngle,t,this.padAngle,this.padRadius,this.cornerRadius)}withPadAngle(t){return t=s.Angle.fromAny(t),this.padAngle.equals(t)?this:this.copy(this.center,this.innerRadius,this.outerRadius,this.startAngle,this.sweepAngle,t,this.padRadius,this.cornerRadius)}withPadRadius(t){return null!==t&&(t=s.Length.fromAny(t)),e.Equals(this.padRadius,t)?this:this.copy(this.center,this.innerRadius,this.outerRadius,this.startAngle,this.sweepAngle,this.padAngle,t,this.cornerRadius)}withCornerRadius(t){return t=s.Length.fromAny(t),this.cornerRadius.equals(t)?this:this.copy(this.center,this.innerRadius,this.outerRadius,this.startAngle,this.sweepAngle,this.padAngle,this.padRadius,t)}render(t,e){if(void 0===t){const t=new rs;return t.setPrecision(3),this.draw(t,e),t.toString()}t instanceof ls&&this.draw(t.context,e)}draw(t,e){this.renderArc(t,e)}renderArc(t,e){let i;void 0!==e&&(i=Math.min(e.width,e.height));const n=this.center,s=n.x,o=n.y;let r=this.innerRadius.pxValue(i),l=this.outerRadius.pxValue(i);const a=this.startAngle.radValue(),h=this.sweepAngle.radValue(),d=a+h,c=h>=0;if(l<r){const t=l;l=r,r=t}if(l>ms.Epsilon)if(h>2*Math.PI-ms.Epsilon)t.moveTo(s+l*Math.cos(a),o+l*Math.sin(a)),t.arc(s,o,l,a,d,!c),r>ms.Epsilon&&(t.moveTo(s+r*Math.cos(d),o+r*Math.sin(d)),t.arc(s,o,r,d,a,c));else{let e=a,n=d,u=a,p=d,f=h,g=h;const v=this.padAngle.radValue()/2,y=+(v>ms.Epsilon)&&(null!==this.padRadius?this.padRadius.pxValue(i):Math.sqrt(r*r+l*l)),w=Math.min(Math.abs(l-r)/2,this.cornerRadius.pxValue(i));let m,b,C=w,S=w;if(y>ms.Epsilon){let t=Math.asin(y/r*Math.sin(v)),i=Math.asin(y/l*Math.sin(v));(f-=2*t)>ms.Epsilon?(t*=c?1:-1,u+=t,p-=t):(f=0,u=p=(a+d)/2),(g-=2*i)>ms.Epsilon?(i*=c?1:-1,e+=i,n-=i):(g=0,e=n=(a+d)/2)}const A=l*Math.cos(e),x=l*Math.sin(e),D=r*Math.cos(p),T=r*Math.sin(p);let P,V;if(w>ms.Epsilon&&(P=l*Math.cos(n),V=l*Math.sin(n),m=r*Math.cos(u),b=r*Math.sin(u),h<Math.PI)){const t=f>ms.Epsilon?ms.intersect(A,x,m,b,P,V,D,T):[D,T],e=A-t[0],i=x-t[1],n=P-t[0],s=V-t[1],o=1/Math.sin(.5*Math.acos((e*n+i*s)/(Math.sqrt(e*e+i*i)*Math.sqrt(n*n+s*s)))),a=Math.sqrt(t[0]*t[0]+t[1]*t[1]);C=Math.min(w,(r-a)/(o-1)),S=Math.min(w,(l-a)/(o+1))}if(g>ms.Epsilon)if(S>ms.Epsilon){const e=ms.cornerTangents(m,b,A,x,l,S,c),i=ms.cornerTangents(P,V,D,T,l,S,c);t.moveTo(s+e.cx+e.x01,o+e.cy+e.y01),S<w?t.arc(s+e.cx,o+e.cy,S,Math.atan2(e.y01,e.x01),Math.atan2(i.y01,i.x01),!c):(t.arc(s+e.cx,o+e.cy,S,Math.atan2(e.y01,e.x01),Math.atan2(e.y11,e.x11),!c),t.arc(s,o,l,Math.atan2(e.cy+e.y11,e.cx+e.x11),Math.atan2(i.cy+i.y11,i.cx+i.x11),!c),t.arc(s+i.cx,o+i.cy,S,Math.atan2(i.y11,i.x11),Math.atan2(i.y01,i.x01),!c))}else t.moveTo(s+A,o+x),t.arc(s,o,l,e,n,!c);else t.moveTo(s+A,o+x);if(r>ms.Epsilon&&f>ms.Epsilon)if(C>ms.Epsilon){const e=ms.cornerTangents(D,T,P,V,r,-C,c),i=ms.cornerTangents(A,x,m,b,r,-C,c);t.lineTo(s+e.cx+e.x01,o+e.cy+e.y01),C<w?t.arc(s+e.cx,o+e.cy,C,Math.atan2(e.y01,e.x01),Math.atan2(i.y01,i.x01),!c):(t.arc(s+e.cx,o+e.cy,C,Math.atan2(e.y01,e.x01),Math.atan2(e.y11,e.x11),!c),t.arc(s,o,r,Math.atan2(e.cy+e.y11,e.cx+e.x11),Math.atan2(i.cy+i.y11,i.cx+i.x11),c),t.arc(s+i.cx,o+i.cy,C,Math.atan2(i.y11,i.x11),Math.atan2(i.y01,i.x01),!c))}else t.arc(s,o,r,p,u,c);else t.lineTo(s+D,o+T)}else t.moveTo(s,o);t.closePath()}copy(t,e,i,n,s,o,r,l){return new ms(t,e,i,n,s,o,r,l)}toAny(){return{center:this.center,innerRadius:this.innerRadius,outerRadius:this.outerRadius,startAngle:this.startAngle,sweepAngle:this.sweepAngle,padAngle:this.padAngle,padRadius:this.padRadius,cornerRadius:this.cornerRadius}}equals(t){return this===t||t instanceof ms&&(this.center.equals(t.center)&&this.innerRadius.equals(t.innerRadius)&&this.outerRadius.equals(t.outerRadius)&&this.startAngle.equals(t.startAngle)&&this.sweepAngle.equals(t.sweepAngle)&&this.padAngle.equals(t.padAngle)&&e.Equals(this.padRadius,t.padRadius)&&this.cornerRadius.equals(t.cornerRadius))}debug(t){return t=t.write("Arc").write(46).write("create").write(40).write(41),this.center.isDefined()&&(t=t.write(46).write("center").write(40).debug(this.center).write(41)),this.innerRadius.isDefined()&&(t=t.write(46).write("innerRadius").write(40).debug(this.innerRadius).write(41)),this.outerRadius.isDefined()&&(t=t.write(46).write("outerRadius").write(40).debug(this.outerRadius).write(41)),this.startAngle.isDefined()&&(t=t.write(46).write("startAngle").write(40).debug(this.startAngle).write(41)),this.sweepAngle.isDefined()&&(t=t.write(46).write("sweepAngle").write(40).debug(this.sweepAngle).write(41)),this.padAngle.isDefined()&&(t=t.write(46).write("padAngle").write(40).debug(this.padAngle).write(41)),null!==this.padRadius&&(t=t.write(46).write("padRadius").write(40).debug(this.padRadius).write(41)),this.cornerRadius.isDefined()&&(t=t.write(46).write("cornerRadius").write(40).debug(this.cornerRadius).write(41)),t}toString(){return o.Format.debug(this)}static create(t=s.R2Point.origin(),e=s.Length.zero(),i=s.Length.zero(),n=s.Angle.zero(),o=s.Angle.zero(),r=s.Angle.zero(),l=null,a=s.Length.zero()){return t=s.R2Point.fromAny(t),e=s.Length.fromAny(e),i=s.Length.fromAny(i),n=s.Angle.fromAny(n),o=s.Angle.fromAny(o),r=s.Angle.fromAny(r),l=null!==l?s.Length.fromAny(l):null,a=s.Length.fromAny(a),new ms(t,e,i,n,o,r,l,a)}static fromAny(t){if(t instanceof ms)return t;if("object"==typeof t&&null!==t)return ms.create(t.center,t.innerRadius,t.outerRadius,t.startAngle,t.sweepAngle,t.padAngle,t.padRadius,t.cornerRadius);throw new TypeError(""+t)}static intersect(t,e,i,n,s,o,r,l){const a=i-t,h=n-e,d=r-s,c=l-o,u=(d*(e-o)-c*(t-s))/(c*a-d*h);return[t+u*a,e+u*h]}static cornerTangents(t,e,i,n,s,o,r){const l=t-i,a=e-n,h=(r?o:-o)/Math.sqrt(l*l+a*a),d=h*a,c=-h*l,u=t+d,p=e+c,f=i+d,g=n+c,v=(u+f)/2,y=(p+g)/2,w=f-u,m=g-p,b=w*w+m*m,C=s-o,S=u*g-f*p,A=(m<0?-1:1)*Math.sqrt(Math.max(0,C*C*b-S*S));let x=(S*m-w*A)/b,D=(-S*w-m*A)/b;const T=(S*m+w*A)/b,P=(-S*w+m*A)/b,V=x-v,I=D-y,M=T-v,R=P-y;return V*V+I*I>M*M+R*R&&(x=T,D=P),{cx:x,cy:D,x01:-d,y01:-c,x11:x*(s/C-1),y11:D*(s/C-1)}}}ms.Epsilon=1e-12;class bs extends ss{get value(){return new ms(this.center.value,this.innerRadius.value,this.outerRadius.value,this.startAngle.value,this.sweepAngle.value,this.padAngle.value,this.padRadius.value,this.cornerRadius.value)}get state(){return new ms(this.center.state,this.innerRadius.state,this.outerRadius.state,this.startAngle.state,this.sweepAngle.state,this.padAngle.state,this.padRadius.state,this.cornerRadius.state)}setState(t,e){t instanceof ms&&(t=t.toAny()),void 0!==t.center&&this.center(t.center,e),void 0!==t.innerRadius&&this.innerRadius(t.innerRadius,e),void 0!==t.outerRadius&&this.outerRadius(t.outerRadius,e),void 0!==t.startAngle&&this.startAngle(t.startAngle,e),void 0!==t.sweepAngle&&this.sweepAngle(t.sweepAngle,e),void 0!==t.padAngle&&this.padAngle(t.padAngle,e),void 0!==t.padRadius&&this.padRadius(t.padRadius,e),void 0!==t.cornerRadius&&this.cornerRadius(t.cornerRadius,e),void 0!==t.fill&&this.fill(t.fill,e),void 0!==t.stroke&&this.stroke(t.stroke,e),void 0!==t.strokeWidth&&this.strokeWidth(t.strokeWidth,e)}layoutArc(){if(this.center.hasAffinity(i.Affinity.Intrinsic)){const t=this.viewFrame,e=t.xMin+t.width*this.xAlign.getValue(),n=t.yMin+t.height*this.yAlign.getValue();this.center.setState(new s.R2Point(e,n),i.Affinity.Intrinsic)}}onRender(t){super.onRender(t);const e=t.renderer;e instanceof as&&!this.isHidden()&&!this.culled&&(this.layoutArc(),this.renderArc(e.context,this.viewFrame))}renderArc(t,e){const i=t.fillStyle,n=t.lineWidth,s=t.strokeStyle,o=this.value;t.beginPath(),o.draw(t,e);const r=this.fill.value;null!==r&&(t.fillStyle=r.toString(),t.fill());const l=this.stroke.value;if(null!==l){const i=this.strokeWidth.value;if(null!==i){const n=Math.min(e.width,e.height);t.lineWidth=i.pxValue(n)}t.strokeStyle=l.toString(),t.stroke()}t.fillStyle=i,t.lineWidth=n,t.strokeStyle=s}get popoverFrame(){const t=this.viewFrame,e=Math.min(t.width,t.height),i=this.pageTransform.inverse(),n=this.center.getValue(),o=i.transformX(n.x,n.y),r=i.transformY(n.x,n.y),l=(this.innerRadius.getValue().pxValue(e)+this.outerRadius.getValue().pxValue(e))/2,a=this.startAngle.getValue().radValue()+this.sweepAngle.getValue().radValue()/2,h=o+l*Math.cos(a),d=r+l*Math.sin(a);return new s.R2Box(h,d,h,d)}hitTest(t,e,i){const n=i.renderer;if(n instanceof cs){const i=n.transform.transform(t,e);return this.layoutArc(),this.hitTestArc(i.x,i.y,n.context,this.viewFrame)}return null}hitTestArc(t,e,i,n){const s=this.value;if(i.beginPath(),s.draw(i,n),null!==this.fill.value&&i.isPointInPath(t,e))return this;if(null!==this.stroke.value){const s=this.strokeWidth.value;if(null!==s){const o=i.lineWidth,r=Math.min(n.width,n.height);i.lineWidth=s.pxValue(r);const l=i.isPointInStroke(t,e);if(i.lineWidth=o,l)return this}}return null}init(t){t instanceof ms||super.init(t),this.setState(t)}static fromArc(t){const e=new bs;return e.setState(t),e}}u([i.Animator({type:Number,state:.5,updateFlags:fn.NeedsRender})],bs.prototype,"xAlign",void 0),u([i.Animator({type:Number,state:.5,updateFlags:fn.NeedsRender})],bs.prototype,"yAlign",void 0),u([i.Animator({type:s.R2Point,state:s.R2Point.origin(),updateFlags:fn.NeedsRender})],bs.prototype,"center",void 0),u([Ht({type:s.Length,state:s.Length.zero(),updateFlags:fn.NeedsRender})],bs.prototype,"innerRadius",void 0),u([Ht({type:s.Length,state:s.Length.zero(),updateFlags:fn.NeedsRender})],bs.prototype,"outerRadius",void 0),u([Ht({type:s.Angle,state:s.Angle.zero(),updateFlags:fn.NeedsRender})],bs.prototype,"startAngle",void 0),u([Ht({type:s.Angle,state:s.Angle.zero(),updateFlags:fn.NeedsRender})],bs.prototype,"sweepAngle",void 0),u([Ht({type:s.Angle,state:s.Angle.zero(),updateFlags:fn.NeedsRender})],bs.prototype,"padAngle",void 0),u([Ht({type:s.Length,state:null,updateFlags:fn.NeedsRender})],bs.prototype,"padRadius",void 0),u([Ht({type:s.Length,state:s.Length.zero(),updateFlags:fn.NeedsRender})],bs.prototype,"cornerRadius",void 0),u([Ht({type:z,state:null,inherits:!0,updateFlags:fn.NeedsRender})],bs.prototype,"fill",void 0),u([Ht({type:z,state:null,inherits:!0,updateFlags:fn.NeedsRender})],bs.prototype,"stroke",void 0),u([Ht({type:s.Length,state:null,inherits:!0,updateFlags:fn.NeedsRender})],bs.prototype,"strokeWidth",void 0),Object.defineProperty(bs.prototype,"viewBounds",{get(){const t=this.viewFrame,e=Math.min(t.width,t.height),i=this.center.getValue(),n=this.outerRadius.getValue().pxValue(e);return new s.R2Box(i.x-n,i.y-n,i.x+n,i.y+n)},configurable:!0});const Cs=function(){const t={init:function(t,e){void 0!==e.font&&t.font(e.font),void 0!==e.textAlign&&t.textAlign(e.textAlign),void 0!==e.textBaseline&&t.textBaseline(e.textBaseline),void 0!==e.textOrigin&&t.textOrigin(e.textOrigin),void 0!==e.textColor&&t.textColor(e.textColor)},is:function(t){if("object"==typeof t&&null!==t){const e=t;return e instanceof ns&&"font"in e&&"textAlign"in e&&"textBaseline"in e&&"textOrigin"in e&&"textColor"in e}return!1}};return t}();class Ss{constructor(t,e,i,n,s,o){this.text=t,this.font=e,this.textAlign=i,this.textBaseline=n,this.textOrigin=s,this.textColor=o}withText(t){return this.text===t?this:this.copy(t,this.font,this.textAlign,this.textBaseline,this.textOrigin,this.textColor)}withFont(t){return null!==t&&(t=E.fromAny(t)),this.font===t?this:this.copy(this.text,t,this.textAlign,this.textBaseline,this.textOrigin,this.textColor)}withTextAlign(t){return this.textAlign===t?this:this.copy(this.text,this.font,t,this.textBaseline,this.textOrigin,this.textColor)}withTextBaseline(t){return this.textBaseline===t?this:this.copy(this.text,this.font,this.textAlign,t,this.textOrigin,this.textColor)}withTextOrigin(t){return null!==t&&(t=s.R2Point.fromAny(t)),e.Equals(this.textOrigin,t)?this:this.copy(this.text,this.font,this.textAlign,this.textBaseline,t,this.textColor)}withTextColor(t){return null!==t&&(t=z.fromAny(t)),e.Equals(this.textColor,t)?this:this.copy(this.text,this.font,this.textAlign,this.textBaseline,this.textOrigin,t)}render(t,e){t instanceof cs&&this.draw(t.context,e)}draw(t,e){this.renderText(t,e)}renderText(t,e){const i=t.font,n=t.textAlign,o=t.textBaseline,r=t.fillStyle;null!==this.font&&(t.font=this.font.toString()),null!==this.textAlign&&(t.textAlign=this.textAlign),null!==this.textBaseline&&(t.textBaseline=this.textBaseline),null!==this.textColor&&(t.fillStyle=this.textColor.toString());let l=this.textOrigin;null===l&&(l=s.R2Point.origin()),t.fillText(this.text,l.x,l.y),t.font=i,t.textAlign=n,t.textBaseline=o,t.fillStyle=r}copy(t,e,i,n,s,o){return new Ss(t,e,i,n,s,o)}toAny(){const t={text:this.text};return t.text=this.text,null!==this.font&&(t.font=this.font),null!==this.font&&(t.font=this.font),null!==this.textAlign&&(t.textAlign=this.textAlign),null!==this.textBaseline&&(t.textBaseline=this.textBaseline),null!==this.textOrigin&&(t.textOrigin=this.textOrigin),null!==this.textColor&&(t.textColor=this.textColor),t}equals(t){return this===t||t instanceof Ss&&(this.text===t.text&&e.Equals(this.font,t.font)&&this.textAlign===t.textAlign&&this.textBaseline===t.textBaseline&&e.Equals(this.textOrigin,t.textOrigin)&&e.Equals(this.textColor,t.textColor))}debug(t){return t=t.write("TextRun").write(46).write("create").write(40).debug(this.text).write(41),null!==this.font&&(t=t.write(46).write("font").write(40).debug(this.font).write(41)),null!==this.textAlign&&(t=t.write(46).write("textAlign").write(40).debug(this.textAlign).write(41)),null!==this.textBaseline&&(t=t.write(46).write("textBaseline").write(40).debug(this.textBaseline).write(41)),null!==this.textOrigin&&(t=t.write(46).write("textOrigin").write(40).debug(this.textOrigin).write(41)),null!==this.textColor&&(t=t.write(46).write("textColor").write(40).debug(this.textColor).write(41)),t}toString(){return o.Format.debug(this)}static create(t,e=null,i=null,n=null,o=null,r=null){return null!==e&&(e=E.fromAny(e)),null!==o&&(o=s.R2Point.fromAny(o)),null!==r&&(r=z.fromAny(r)),new Ss(t,e,i,n,o,r)}static fromAny(t){if(t instanceof Ss)return t;if("string"==typeof t)return Ss.create(t);if("object"==typeof t&&null!==t)return Ss.create(t.text,t.font,t.textAlign,t.textBaseline,t.textOrigin,t.textColor);throw new TypeError(""+t)}}class As extends ss{get value(){return new Ss(this.text.getValue(),this.font.getValue(),this.textAlign.getValue(),this.textBaseline.getValue(),this.textOrigin.getValue(),this.textColor.getValue())}get state(){return new Ss(this.text.getState(),this.font.getState(),this.textAlign.getState(),this.textBaseline.getState(),this.textOrigin.getState(),this.textColor.getState())}setState(t,e){"string"==typeof t?this.text(t,e):(t instanceof Ss&&(t=t.toAny()),void 0!==t.text&&this.text(t.text,e),void 0!==t.font&&this.font(t.font,e),void 0!==t.textAlign&&this.textAlign(t.textAlign,e),void 0!==t.textBaseline&&this.textBaseline(t.textBaseline,e),void 0!==t.textOrigin&&this.textOrigin(t.textOrigin,e),void 0!==t.textColor&&this.textColor(t.textColor,e))}onRender(t){super.onRender(t);const e=t.renderer;e instanceof cs&&!this.isHidden()&&!this.culled&&this.renderText(e.context)}renderText(t){const e=t.font,i=t.textAlign,n=t.textBaseline,o=t.fillStyle,r=this.font.value;null!==r&&(t.font=r.toString());const l=this.textAlign.value;void 0!==l&&(t.textAlign=l);const a=this.textBaseline.value;void 0!==a&&(t.textBaseline=a);const h=this.textColor.value;null!==h&&(t.fillStyle=h.toString());let d=this.textOrigin.value;null===d&&(d=s.R2Point.origin()),t.fillText(this.text.getValue(),d.x,d.y),t.font=e,t.textAlign=i,t.textBaseline=n,t.fillStyle=o}init(t){"string"!=typeof t?(t instanceof Ss||super.init(t),this.setState(t)):this.text(t)}}u([Ht({type:String,state:"",updateFlags:fn.NeedsRender})],As.prototype,"text",void 0),u([Ht({type:E,state:null,inherits:!0,updateFlags:fn.NeedsRender})],As.prototype,"font",void 0),u([Ht({type:String,inherits:!0,updateFlags:fn.NeedsRender})],As.prototype,"textAlign",void 0),u([Ht({type:String,inherits:!0,updateFlags:fn.NeedsRender})],As.prototype,"textBaseline",void 0),u([Ht({type:s.R2Point,state:null,inherits:!0,updateFlags:fn.NeedsRender})],As.prototype,"textOrigin",void 0),u([Ht({type:z,state:null,inherits:!0,updateFlags:fn.NeedsRender})],As.prototype,"textColor",void 0);const xs=function(){const t={fromAny:function(t){if(null==t)return t;return{iconWidth:s.Length.fromAny(t.iconWidth),iconHeight:s.Length.fromAny(t.iconHeight),xAlign:t.xAlign,yAlign:t.yAlign}},is:function(t){if("object"==typeof t&&null!==t||"function"==typeof t){const e=t;return"iconWidth"in e&&"iconHeight"in e}return!1}};return t}();class Ds{}class Ts extends Ds{}class Ps extends Ts{constructor(t,e,i,n,s){super(),this.path=t,this.fillRule=e,this.fillColor=i,this.fillLook=n,this.moodModifier=s}withFillRule(t){return e.Equals(this.fillRule,t)?this:this.copy(this.path,t,this.fillColor,this.fillLook,this.moodModifier)}withFillColor(t){return e.Equals(this.fillColor,t)?this:this.copy(this.path,this.fillRule,t,this.fillLook,this.moodModifier)}withFillLook(t){return this.fillLook===t?this:this.copy(this.path,this.fillRule,this.fillColor,t,this.moodModifier)}withMoodModifier(t){return e.Equals(this.moodModifier,t)?this:this.copy(this.path,this.fillRule,this.fillColor,this.fillLook,t)}modifyMood(t,e){let i=this.moodModifier;null===i&&(i=Nt.empty());const n=i.updatedCol(t,e,!0);return n.equals(i)?this:this.withMoodModifier(n)}isThemed(){return null!==this.fillColor}withTheme(t,e){const i=this.fillLook;if(null!==i){const n=this.moodModifier;return null!==n&&(e=n.timesCol(e,!0)),this.withFillColor(t.getOr(i,e,null))}return this}render(t,e){t instanceof as?this.paint(t.context,e):t instanceof os&&this.draw(t.context,e)}paint(t,e){const i=t.fillStyle;t.beginPath(),this.draw(t,e),null!==this.fillColor&&(t.fillStyle=this.fillColor.toString()),t.fill(this.fillRule),t.fillStyle=i}draw(t,e){const i=s.Transform.scale(e.width,e.height).translate(e.x,e.y);this.path.transformDraw(t,i)}copy(t,e,i,n,s){return new Ps(t,e,i,n,s)}interpolateTo(t){return t instanceof Ps?Vs(this,t):null}equivalentTo(t,i){return this===t||t instanceof Ps&&(this.path.equivalentTo(t.path,i)&&this.fillRule===t.fillRule&&e.Equivalent(this.fillColor,t.fillColor,i)&&this.fillLook===t.fillLook&&e.Equivalent(this.moodModifier,t.moodModifier,i))}equals(t){return this===t||t instanceof Ps&&(this.path.equals(t.path)&&this.fillRule===t.fillRule&&e.Equals(this.fillColor,t.fillColor)&&this.fillLook===t.fillLook&&e.Equals(this.moodModifier,t.moodModifier))}debug(t){return t=t.write("new").write(32).write("VectorIcon").write(40).debug(this.path).write(", ").debug(this.fillRule).write(", ").debug(this.fillColor).write(", ").debug(this.fillLook).write(", ").debug(this.moodModifier).write(41)}toString(){return o.Format.debug(this)}static create(t,e,i,n){return i=s.R2Path.fromAny(i),1===t&&1===e||(i=i.transform(s.Transform.scale(1/t,1/e))),void 0===n&&(n="nonzero"),new Ps(i,n,null,At.iconColor,null)}}const Vs=function(t){const i=function(t,n){const s=function(t){const e=s.path,i=s.fillRule,n=s.fillColorInterpolator(t),o=s.fillLook,r=s.moodModifier;return new Ps(e,i,n,o,r)};return Object.setPrototypeOf(s,i.prototype),s.path=n.path,s.fillRule=n.fillRule,s.fillColorInterpolator=e.Interpolator(t.fillColor,n.fillColor),s.fillLook=n.fillLook,s.moodModifier=n.moodModifier,s};return i.prototype=Object.create(t.prototype),i.prototype.constructor=i,Object.defineProperty(i.prototype,0,{get(){const t=this.path,e=this.fillRule,i=this.fillColorInterpolator[0],n=this.fillLook,s=this.moodModifier;return new Ps(t,e,i,n,s)},configurable:!0}),Object.defineProperty(i.prototype,1,{get(){const t=this.path,e=this.fillRule,i=this.fillColorInterpolator[1],n=this.fillLook,s=this.moodModifier;return new Ps(t,e,i,n,s)},configurable:!0}),i.prototype.equals=function(t){return this===t||t instanceof i&&(this.path.equals(t.path)&&this.fillRule===t.fillRule&&this.fillColorInterpolator.equals(t.fillColorInterpolator)&&this.fillLook===t.fillLook&&e.Equals(this.moodModifier,t.moodModifier))},i}(e.Interpolator);class Is extends Ts{constructor(t,e,i){super(),this.fillColor=t,this.fillLook=e,this.moodModifier=i}withFillColor(t){return e.Equals(this.fillColor,t)?this:this.copy(t,this.fillLook,this.moodModifier)}withFillLook(t){return this.fillLook===t?this:this.copy(this.fillColor,t,this.moodModifier)}withMoodModifier(t){return e.Equals(this.moodModifier,t)?this:this.copy(this.fillColor,this.fillLook,t)}modifyMood(t,e){let i=this.moodModifier;null===i&&(i=Nt.empty());const n=i.updatedCol(t,e,!0);return n.equals(i)?this:this.withMoodModifier(n)}isThemed(){return null!==this.fillColor}withTheme(t,e){const i=this.fillLook;if(null!==i){const n=this.moodModifier;return null!==n&&(e=n.timesCol(e,!0)),this.withFillColor(t.getOr(i,e,null))}return this}render(t,e){t instanceof as?this.paint(t.context,e):t instanceof os&&this.draw(t.context,e)}paint(t,e){const i=t.fillStyle;t.beginPath(),this.draw(t,e),null!==this.fillColor&&(t.fillStyle=this.fillColor.toString()),t.fill(),t.fillStyle=i}draw(t,e){const i=(e.xMin+e.xMax)/2,n=(e.yMin+e.yMax)/2,s=e.width,o=e.height,r=Math.min(s,o)/2;t.arc(i,n,r,0,2*Math.PI),t.closePath()}copy(t,e,i){return new Is(t,e,i)}interpolateTo(t){return t instanceof Is?Ms(this,t):null}equivalentTo(t,i){return this===t||t instanceof Is&&(e.Equivalent(this.fillColor,t.fillColor,i)&&this.fillLook===t.fillLook&&e.Equivalent(this.moodModifier,t.moodModifier,i))}equals(t){return this===t||t instanceof Is&&(e.Equals(this.fillColor,t.fillColor)&&this.fillLook===t.fillLook&&e.Equals(this.moodModifier,t.moodModifier))}debug(t){return t=t.write("new").write(32).write("CircleIcon").write(40).debug(this.fillColor).write(", ").debug(this.fillLook).write(", ").debug(this.moodModifier).write(41)}toString(){return o.Format.debug(this)}static create(){return new Is(null,At.accentColor,null)}}u([e.Lazy],Is,"create",null);const Ms=function(t){const i=function(t,n){const s=function(t){const e=s.fillColorInterpolator(t),i=s.fillLook,n=s.moodModifier;return new Is(e,i,n)};return Object.setPrototypeOf(s,i.prototype),s.fillColorInterpolator=e.Interpolator(t.fillColor,n.fillColor),s.fillLook=n.fillLook,s.moodModifier=n.moodModifier,s};return i.prototype=Object.create(t.prototype),i.prototype.constructor=i,Object.defineProperty(i.prototype,0,{get(){const t=this.fillColorInterpolator[0],e=this.fillLook,i=this.moodModifier;return new Is(t,e,i)},configurable:!0}),Object.defineProperty(i.prototype,1,{get(){const t=this.fillColorInterpolator[1],e=this.fillLook,i=this.moodModifier;return new Is(t,e,i)},configurable:!0}),i.prototype.equals=function(t){return this===t||t instanceof i&&(this.fillColorInterpolator.equals(t.fillColorInterpolator)&&this.fillLook===t.fillLook&&e.Equals(this.moodModifier,t.moodModifier))},i}(e.Interpolator);class Rs extends Ts{constructor(t,e,i,n,s){super(),this.sides=t,this.rotation=e,this.fillColor=i,this.fillLook=n,this.moodModifier=s}withFillColor(t){return e.Equals(this.fillColor,t)?this:this.copy(this.sides,this.rotation,t,this.fillLook,this.moodModifier)}withFillLook(t){return this.fillLook===t?this:this.copy(this.sides,this.rotation,this.fillColor,t,this.moodModifier)}withMoodModifier(t){return e.Equals(this.moodModifier,t)?this:this.copy(this.sides,this.rotation,this.fillColor,this.fillLook,t)}modifyMood(t,e){let i=this.moodModifier;null===i&&(i=Nt.empty());const n=i.updatedCol(t,e,!0);return n.equals(i)?this:this.withMoodModifier(n)}isThemed(){return null!==this.fillColor}withTheme(t,e){const i=this.fillLook;if(null!==i){const n=this.moodModifier;return null!==n&&(e=n.timesCol(e,!0)),this.withFillColor(t.getOr(i,e,null))}return this}render(t,e){t instanceof as?this.paint(t.context,e):t instanceof os&&this.draw(t.context,e)}paint(t,e){const i=t.fillStyle;t.beginPath(),this.draw(t,e),null!==this.fillColor&&(t.fillStyle=this.fillColor.toString()),t.fill(),t.fillStyle=i}draw(t,e){const i=this.sides;if(i>=3){const n=(e.xMin+e.xMax)/2,s=(e.yMin+e.yMax)/2,o=e.width,r=e.height,l=Math.min(o,r)/2,a=2*Math.PI/i;let h=this.rotation.radValue();t.moveTo(n+l*Math.cos(h),s+l*Math.sin(h)),h+=a;for(let e=1;e<i;e+=1)t.lineTo(n+l*Math.cos(h),s+l*Math.sin(h)),h+=a;t.closePath()}}copy(t,e,i,n,s){return new Rs(t,e,i,n,s)}interpolateTo(t){return t instanceof Rs?Fs(this,t):null}equivalentTo(t,i){return this===t||t instanceof Rs&&(this.sides===t.sides&&this.rotation.equivalentTo(t.rotation,i)&&e.Equivalent(this.fillColor,t.fillColor,i)&&this.fillLook===t.fillLook&&e.Equivalent(this.moodModifier,t.moodModifier,i))}equals(t){return this===t||t instanceof Rs&&(this.sides===t.sides&&this.rotation.equals(t.rotation)&&e.Equals(this.fillColor,t.fillColor)&&this.fillLook===t.fillLook&&e.Equals(this.moodModifier,t.moodModifier))}debug(t){return t=t.write("new").write(32).write("PolygonIcon").write(40).debug(this.sides).write(", ").debug(this.rotation).write(", ").debug(this.fillColor).write(", ").debug(this.fillLook).write(", ").debug(this.moodModifier).write(41)}toString(){return o.Format.debug(this)}static create(t,e){return e=void 0!==e?s.Angle.fromAny(e):s.Angle.zero(),new Rs(t,e,null,At.accentColor,null)}}const Fs=function(t){const i=function(t,n){const s=function(t){const e=s.sides,i=s.rotationInterpolator(t),n=s.fillColorInterpolator(t),o=s.fillLook,r=s.moodModifier;return new Rs(e,i,n,o,r)};return Object.setPrototypeOf(s,i.prototype),s.sides=n.sides,s.rotationInterpolator=t.rotation.interpolateTo(n.rotation),s.fillColorInterpolator=e.Interpolator(t.fillColor,n.fillColor),s.fillLook=n.fillLook,s.moodModifier=n.moodModifier,s};return i.prototype=Object.create(t.prototype),i.prototype.constructor=i,Object.defineProperty(i.prototype,0,{get(){const t=this.sides,e=this.rotationInterpolator[0],i=this.fillColorInterpolator[0],n=this.fillLook,s=this.moodModifier;return new Rs(t,e,i,n,s)},configurable:!0}),Object.defineProperty(i.prototype,1,{get(){const t=this.sides,e=this.rotationInterpolator[1],i=this.fillColorInterpolator[1],n=this.fillLook,s=this.moodModifier;return new Rs(t,e,i,n,s)},configurable:!0}),i.prototype.equals=function(t){return this===t||t instanceof i&&(this.sides===t.sides&&this.rotationInterpolator.equals(t.rotationInterpolator)&&this.fillColorInterpolator.equals(t.fillColorInterpolator)&&this.fillLook===t.fillLook&&e.Equals(this.moodModifier,t.moodModifier))},i}(e.Interpolator);class Ls extends Ds{constructor(t,e,i,n,s,o){super(),this.outer=t,this.inner=e,this.innerScale=i,this.moodModifier=n,this.outerMoodModifier=s,this.innerMoodModifier=o}withOuter(t){return this.outer===t?this:this.copy(t,this.inner,this.innerScale,this.moodModifier,this.outerMoodModifier,this.innerMoodModifier)}withInner(t){return this.inner===t?this:this.copy(this.outer,t,this.innerScale,this.moodModifier,this.outerMoodModifier,this.innerMoodModifier)}withInnerScale(t){return this.innerScale===t?this:this.copy(this.outer,this.inner,t,this.moodModifier,this.outerMoodModifier,this.innerMoodModifier)}withMoodModifier(t){return e.Equals(this.moodModifier,t)?this:this.copy(this.outer,this.inner,this.innerScale,t,this.outerMoodModifier,this.innerMoodModifier)}modifyMood(t,e){let i=this.moodModifier;null===i&&(i=Nt.empty());const n=i.updatedCol(t,e,!0);return n.equals(i)?this:this.withMoodModifier(n)}withOuterMoodModifier(t){return e.Equals(this.outerMoodModifier,t)?this:this.copy(this.outer,this.inner,this.innerScale,this.moodModifier,t,this.innerMoodModifier)}modifyOuterMood(t,e){let i=this.outerMoodModifier;null===i&&(i=Nt.empty());const n=i.updatedCol(t,e,!0);return n.equals(i)?this:this.withOuterMoodModifier(n)}withInnerMoodModifier(t){return e.Equals(this.innerMoodModifier,t)?this:this.copy(this.outer,this.inner,this.innerScale,this.moodModifier,this.outerMoodModifier,t)}modifyInnerMood(t,e){let i=this.innerMoodModifier;null===i&&(i=Nt.empty());const n=i.updatedCol(t,e,!0);return n.equals(i)?this:this.withInnerMoodModifier(n)}isThemed(){const t=this.outer,e=this.inner;return(null===t||t.isThemed())&&(null===e||e.isThemed())}withTheme(t,e){const i=this.moodModifier,n=this.outerMoodModifier,s=this.innerMoodModifier;let o=e;null!==i&&(o=i.timesCol(o,!0));const r=this.outer;let l;if(null!==r){let e=o;null!==n&&(e=n.timesCol(e,!0)),l=r.withTheme(t,e)}else l=null;const a=this.inner;let h;if(null!==a){let e=o;null!==s&&(e=s.timesCol(e,!0)),h=a.withTheme(t,e)}else h=null;return r!==l||a!==h?this.copy(l,h,this.innerScale,i,n,s):this}render(t,e){t instanceof as?this.paint(t.context,e):t instanceof os&&this.draw(t.context,e)}paint(t,e){const i=this.outer;null!==i&&i.paint(t,this.outerFrame(e));const n=this.inner;null!==n&&n.paint(t,this.innerFrame(e))}draw(t,e){const i=this.outer;null!==i&&i.draw(t,this.outerFrame(e));const n=this.inner;null!==n&&n.draw(t,this.innerFrame(e))}outerFrame(t){return t}innerFrame(t){let{xMin:e,xMax:i,yMin:n,yMax:o}=t,r=i-e,l=o-n;const a=this.innerScale;if(1!==a){const t=(e+i)/2,s=(n+o)/2;r*=a,l*=a,e=t-r/2,n=s-l/2,i=t+r/2,o=s+l/2}if(r>l){const t=(r-l)/2;e+=t,i-=t}else if(r<l){const t=(l-r)/2;n+=t,o-=t}return r!==l||1!==a?new s.R2Box(e,n,i,o):t}copy(t,e,i,n,s,o){return new Ls(t,e,i,n,s,o)}interpolateTo(t){return t instanceof Ls?ks(this,t):null}equivalentTo(t,i){return this===t||t instanceof Ls&&(e.Equivalent(this.outer,t.outer,i)&&e.Equivalent(this.inner,t.inner,i)&&e.Equivalent(this.innerScale,t.innerScale,i)&&e.Equivalent(this.moodModifier,t.moodModifier,i)&&e.Equivalent(this.outerMoodModifier,t.outerMoodModifier,i)&&e.Equivalent(this.innerMoodModifier,t.innerMoodModifier,i))}equals(t){return this===t||t instanceof Ls&&(e.Equals(this.outer,t.outer)&&e.Equals(this.inner,t.inner)&&e.Equals(this.innerScale,t.innerScale)&&e.Equals(this.moodModifier,t.moodModifier)&&e.Equals(this.outerMoodModifier,t.outerMoodModifier)&&e.Equals(this.innerMoodModifier,t.innerMoodModifier))}debug(t){return t=t.write("new").write(32).write("EnclosedIcon").write(40).debug(this.outer).write(", ").debug(this.inner).write(", ").debug(this.innerScale).write(", ").debug(this.moodModifier).write(", ").debug(this.outerMoodModifier).write(", ").debug(this.innerMoodModifier).write(41)}toString(){return o.Format.debug(this)}static create(t,e){return new Ls(t,e,1,null,null,null)}static embossed(t,e){return new Ls(t,e,1,null,null,Ls.embossedMoodModifier)}static get embossedMoodModifier(){return Nt.empty().updatedCol(Rt.default,[[Rt.embossed,1]],!0)}}u([e.Lazy],Ls,"embossedMoodModifier",null);const ks=function(t){const i=function(t,n){const s=function(t){const e=s.outerInterpolator(t),i=s.innerInterpolator(t),n=s.innerScaleInterpolator(t),o=s.moodModifier,r=s.outerMoodModifier,l=s.innerMoodModifier;return new Ls(e,i,n,o,r,l)};return Object.setPrototypeOf(s,i.prototype),s.outerInterpolator=e.Interpolator(t.outer,n.outer),s.innerInterpolator=e.Interpolator(t.inner,n.inner),s.innerScaleInterpolator=e.Interpolator(t.innerScale,n.innerScale),s.moodModifier=n.moodModifier,s.outerMoodModifier=n.outerMoodModifier,s.innerMoodModifier=n.innerMoodModifier,s};return i.prototype=Object.create(t.prototype),i.prototype.constructor=i,Object.defineProperty(i.prototype,0,{get(){const t=this.outerInterpolator[0],e=this.innerInterpolator[0],i=this.innerScaleInterpolator[0],n=this.moodModifier,s=this.outerMoodModifier,o=this.innerMoodModifier;return new Ls(t,e,i,n,s,o)},configurable:!0}),Object.defineProperty(i.prototype,1,{get(){const t=this.outerInterpolator[1],e=this.innerInterpolator[1],i=this.innerScaleInterpolator[1],n=this.moodModifier,s=this.outerMoodModifier,o=this.innerMoodModifier;return new Ls(t,e,i,n,s,o)},configurable:!0}),i.prototype.equals=function(t){return this===t||t instanceof i&&(this.outerInterpolator.equals(t.outerInterpolator)&&this.innerInterpolator.equals(t.innerInterpolator)&&this.innerScaleInterpolator.equals(t.innerScaleInterpolator)&&e.Equals(this.moodModifier,t.moodModifier)&&e.Equals(this.outerMoodModifier,t.outerMoodModifier)&&e.Equals(this.innerMoodModifier,t.innerMoodModifier))},i}(e.Interpolator),Os=function(){const t={is:function(t){if("object"==typeof t&&null!==t){const e=t;return e instanceof Ws||e instanceof Ns||e instanceof Bs||e instanceof fn&&"xAlign"in e&&"yAlign"in e&&"iconWidth"in e&&"iconHeight"in e&&"iconColor"in e&&"graphics"in e}return!1},init:function(t,e){void 0!==e.xAlign&&t.xAlign(e.xAlign),void 0!==e.yAlign&&t.yAlign(e.yAlign),void 0!==e.iconWidth&&t.iconWidth(e.iconWidth),void 0!==e.iconHeight&&t.iconHeight(e.iconHeight),void 0!==e.iconColor&&t.iconColor(e.iconColor),void 0!==e.graphics&&t.graphics(e.graphics)}};return t}(),Es=function(t){const e=t.extend("IconGraphicsAnimator");return e.prototype.fromAny=function(t){const e=this.owner;if(Os.is(e)&&t instanceof Ds){const i=e.iconColor.state;if(null!==i&&t instanceof Ts)t=t.withFillColor(i);else{const i=e.theme.state,n=e.mood.state;null!==i&&null!==n&&(t=t.withTheme(i,n))}}return t},e}(Ht);class Ws extends ss{onApplyTheme(t,e,n){if(super.onApplyTheme(t,e,n),!this.graphics.inherited){const s=this.graphics.value;if(s instanceof Ds){const o=s.withTheme(t,e);this.graphics.setState(o,!!s.isThemed()&&n,i.Affinity.Reflexive)}}}onRender(t){super.onRender(t);const e=t.renderer;e instanceof as&&!this.isHidden()&&!this.culled&&this.renderIcon(e,this.viewBounds)}renderIcon(t,e){const i=this.graphics.value;if(null!==i){t.context.beginPath(),i.render(t,e)}}hitTest(t,e,i){const n=i.renderer;return n instanceof cs?this.hitTestIcon(t,e,n,this.viewBounds):null}hitTestIcon(t,e,i,n){return this.hitBounds.contains(t,e)?this:null}init(t){super.init(t),Os.init(this,t)}}u([i.Animator({type:Number,state:.5,updateFlags:fn.NeedsRender})],Ws.prototype,"xAlign",void 0),u([i.Animator({type:Number,state:.5,updateFlags:fn.NeedsRender})],Ws.prototype,"yAlign",void 0),u([Ht({type:s.Length,state:null,updateFlags:fn.NeedsRender})],Ws.prototype,"iconWidth",void 0),u([Ht({type:s.Length,state:null,updateFlags:fn.NeedsRender})],Ws.prototype,"iconHeight",void 0),u([Ht({type:z,state:null,updateFlags:fn.NeedsRender,didSetValue(t,e){if(null!==t){const e=this.owner.graphics.value;if(e instanceof Ts){const n=e.withFillColor(t);this.owner.graphics.setState(n,i.Affinity.Reflexive)}}}})],Ws.prototype,"iconColor",void 0),u([Ht({extends:Es,type:Object,state:null,updateFlags:fn.NeedsRender})],Ws.prototype,"graphics",void 0),Object.defineProperty(Ws.prototype,"viewBounds",{get(){const t=this.viewFrame,e=t.width,i=t.height,n=Math.min(e,i);let o=this.iconWidth.value;o=o instanceof s.Length?o.pxValue(n):n;let r=this.iconHeight.value;r=r instanceof s.Length?r.pxValue(n):n;const l=t.x+(e-o)*this.xAlign.getValue(),a=t.y+(i-r)*this.yAlign.getValue();return new s.R2Box(l,a,l+o,a+r)},configurable:!0});class Ns extends Qn{constructor(t){super(t)}onApplyTheme(t,e,n){if(super.onApplyTheme(t,e,n),!this.graphics.inherited){const s=this.graphics.value;if(s instanceof Ds){const o=s.withTheme(t,e);this.graphics.setState(o,!!s.isThemed()&&n,i.Affinity.Reflexive)}}}onResize(t){super.onResize(t),this.requireUpdate(fn.NeedsLayout)}needsDisplay(t,e){return 0==(this.flags&fn.NeedsLayout)&&(t&=~fn.NeedsLayout),t}onLayout(t){super.onLayout(t),this.renderIcon()}renderIcon(){const t=new hs(this);t.setPrecision(3),t.beginSvg();const e=this.graphics.value;if(null!==e){const i=this.iconBounds;if(i.isDefined()&&i.width>0&&i.height>0){t.beginPath();const n=new ds(t);e.render(n,i)}}t.finalizeSvg()}get iconBounds(){let t=this.node.viewportElement;if(null===t&&(t=this.node),t instanceof SVGSVGElement){const e=t.viewBox.animVal,i=e.width,n=e.height,o=Math.min(i,n);let r=this.iconWidth.value;r=r instanceof s.Length?r.pxValue(o):o;let l=this.iconHeight.value;l=l instanceof s.Length?l.pxValue(o):o;const a=e.x+(i-r)*this.xAlign.getValue(),h=e.y+(n-l)*this.yAlign.getValue();return new s.R2Box(a,h,a+r,h+l)}return s.R2Box.undefined()}init(t){super.init(t),Os.init(this,t)}}Ns.MountFlags=Qn.MountFlags|fn.NeedsAnimate,u([i.Animator({type:Number,state:.5,updateFlags:fn.NeedsLayout})],Ns.prototype,"xAlign",void 0),u([i.Animator({type:Number,state:.5,updateFlags:fn.NeedsLayout})],Ns.prototype,"yAlign",void 0),u([Ht({type:s.Length,state:null,updateFlags:fn.NeedsLayout})],Ns.prototype,"iconWidth",void 0),u([Ht({type:s.Length,state:null,updateFlags:fn.NeedsLayout})],Ns.prototype,"iconHeight",void 0),u([Ht({type:z,state:null,updateFlags:fn.NeedsLayout,didSetValue(t,e){if(null!==t){const e=this.owner.graphics.value;if(e instanceof Ts){const n=e.withFillColor(t);this.owner.graphics.setState(n,i.Affinity.Reflexive)}}}})],Ns.prototype,"iconColor",void 0),u([Ht({extends:Es,type:Object,state:null,updateFlags:fn.NeedsLayout})],Ns.prototype,"graphics",void 0);class Bs extends Kn{constructor(t){super(t),this.initIcon()}initIcon(){this.position.setState("relative",i.Affinity.Intrinsic);const t=this.createSvgView();null!==t&&this.setChild("svg",t)}createSvgView(){return Ns.create()}get svgView(){const t=this.getChild("svg");return t instanceof Ns?t:null}onInsertChild(t,e){super.onInsertChild(t,e),"svg"===t.key&&t instanceof Ns&&this.onInsertSvg(t)}onInsertSvg(t){t.xAlign.setInherits(!0),t.yAlign.setInherits(!0),t.iconWidth.setInherits(!0),t.iconHeight.setInherits(!0),t.iconColor.setInherits(!0),t.graphics.setInherits(!0),t.setStyle("position","absolute")}onApplyTheme(t,e,n){if(super.onApplyTheme(t,e,n),!this.graphics.inherited){const s=this.graphics.value;if(s instanceof Ds){const o=s.withTheme(t,e);this.graphics.setState(o,!!s.isThemed()&&n,i.Affinity.Reflexive)}}}onResize(t){super.onResize(t),this.requireUpdate(fn.NeedsLayout)}needsDisplay(t,e){return 0==(this.flags&fn.NeedsLayout)&&(t&=~fn.NeedsLayout),t}onLayout(t){super.onLayout(t),this.layoutIcon()}layoutIcon(){const t=this.svgView;if(null!==t&&(t.width.hasAffinity(i.Affinity.Intrinsic)||t.height.hasAffinity(i.Affinity.Intrinsic)||t.viewBox.hasAffinity(i.Affinity.Intrinsic))){let e=this.width.value;e=e instanceof s.Length?e.pxValue():this.node.offsetWidth;let n=this.height.value;n=n instanceof s.Length?n.pxValue():this.node.offsetHeight,t.width.setState(e,i.Affinity.Intrinsic),t.height.setState(n,i.Affinity.Intrinsic),t.viewBox.setState("0 0 "+e+" "+n,i.Affinity.Intrinsic)}}init(t){super.init(t),Os.init(this,t)}}u([i.Animator({type:Number,state:.5,updateFlags:fn.NeedsLayout})],Bs.prototype,"xAlign",void 0),u([i.Animator({type:Number,state:.5,updateFlags:fn.NeedsLayout})],Bs.prototype,"yAlign",void 0),u([Ht({type:s.Length,state:null,updateFlags:fn.NeedsLayout})],Bs.prototype,"iconWidth",void 0),u([Ht({type:s.Length,state:null,updateFlags:fn.NeedsLayout})],Bs.prototype,"iconHeight",void 0),u([Ht({type:z,state:null,updateFlags:fn.NeedsLayout,didSetValue(t,e){if(null!==t){const e=this.owner.graphics.value;if(e instanceof Ts){const n=e.withFillColor(t);this.owner.graphics.setState(n,i.Affinity.Reflexive)}}}})],Bs.prototype,"iconColor",void 0),u([Ht({extends:Es,type:Object,state:null,updateFlags:fn.NeedsLayout})],Bs.prototype,"graphics",void 0);const zs=function(){const t={current:null,create:function(){return{updateTime:performance.now()}}};return t}();class Us extends e.Service{constructor(){super(),this.flags=0,this.controllerContext=zs.create(),this.updateDelay=Us.MinUpdateDelay,this.compileTimer=0,this.executeTimer=0,this.runCompilePass=this.runCompilePass.bind(this),this.runExecutePass=this.runExecutePass.bind(this),this.onVisibilityChange=this.onVisibilityChange.bind(this)}setFlags(t){this.flags=t}updatedControllerContext(){const t=this.controllerContext;return t.updateTime=performance.now(),t}needsUpdate(t,e){return t}requestUpdate(t,e,i){e=this.needsUpdate(e,i);let n=this.flags&~e&_s.UpdateMask;0!=(e&_s.CompileMask)&&(n|=_s.NeedsCompile),0!=(e&_s.ExecuteMask)&&(n|=_s.NeedsExecute),this.setFlags(this.flags|n),i&&0==(this.flags&_s.TraversingFlag)&&this.updateDelay<=Us.MaxCompileInterval?this.runImmediatePass():this.scheduleUpdate()}scheduleUpdate(){const t=this.flags;0==(t&_s.CompilingFlag)&&0!=(t&_s.CompileMask)?this.scheduleCompilePass(this.updateDelay):0==(t&_s.ExecutingFlag)&&0!=(t&_s.ExecuteMask)&&this.scheduleExecutePass(Us.MinExecuteInterval)}cancelUpdate(){this.cancelCompilePass(),this.cancelExecutePass()}runImmediatePass(){0!=(this.flags&_s.CompileMask)&&(this.cancelUpdate(),this.runCompilePass(!0)),0!=(this.flags&_s.ExecuteMask)&&this.updateDelay<=Us.MaxCompileInterval&&(this.cancelUpdate(),this.runExecutePass(!0))}scheduleCompilePass(t){0===this.compileTimer&&(this.compileTimer=setTimeout(this.runCompilePass,t))}cancelCompilePass(){0!==this.compileTimer&&(clearTimeout(this.compileTimer),this.compileTimer=0)}runCompilePass(t=!1){this.setFlags(this.flags&~_s.CompileMask|_s.TraversingFlag|_s.CompilingFlag);try{const e=performance.now(),i=this.roots,n=this.controllerContext;n.updateTime=e;for(let t=0;t<i.length;t+=1){const e=i[t];0!=(e.flags&_s.CompileMask)&&e.cascadeCompile(0,n)}const s=performance.now();let o=Math.max(Us.MinCompileInterval,this.updateDelay);this.updateDelay=s-e>o?Math.min(Math.max(2,2*this.updateDelay),Us.MaxUpdateDelay):Math.min(Us.MinUpdateDelay,this.updateDelay/2),this.cancelCompilePass(),0!=(this.flags&_s.ExecuteMask)?this.scheduleExecutePass(Us.MinExecuteInterval):0!=(this.flags&_s.CompileMask)&&(t&&(o=Math.max(Us.MaxCompileInterval,o)),this.cancelExecutePass(),this.scheduleCompilePass(o))}finally{this.setFlags(this.flags&~(_s.TraversingFlag|_s.CompilingFlag))}}scheduleExecutePass(t){0===this.executeTimer&&(this.executeTimer=setTimeout(this.runExecutePass,t))}cancelExecutePass(){0!==this.executeTimer&&(clearTimeout(this.executeTimer),this.executeTimer=0)}runExecutePass(t=!1){this.setFlags(this.flags&~_s.ExecuteMask|_s.TraversingFlag|_s.ExecutingFlag);try{const e=performance.now(),i=this.controllerContext;i.updateTime=e;const n=this.roots;for(let t=0;t<n.length;t+=1){const e=n[t];0!=(e.flags&_s.ExecuteMask)&&e.cascadeExecute(0,i)}if(this.cancelExecutePass(),0!=(this.flags&_s.CompileMask)){let e=this.updateDelay;t&&(e=Math.max(Us.MaxCompileInterval,e)),this.scheduleCompilePass(e)}else 0!=(this.flags&_s.ExecuteMask)&&(this.cancelCompilePass(),this.scheduleExecutePass(Us.MaxExecuteInterval))}finally{this.setFlags(this.flags&~(_s.TraversingFlag|_s.ExecutingFlag))}}get powerFlags(){return 0}power(){const t=this.roots;for(let e=0,i=t.length;e<i;e+=1){t[e].requireUpdate(this.powerFlags)}}unpower(){this.cancelUpdate(),this.updateDelay=Us.MinUpdateDelay}onAttachRoot(t){super.onAttachRoot(t),this.requestUpdate(t,t.flags&_s.UpdateMask,!1)}onAttach(){super.onAttach(),this.attachEvents()}onDetach(){this.detachEvents(),super.onDetach()}attachEvents(){"undefined"!=typeof document&&document.addEventListener("visibilitychange",this.onVisibilityChange)}detachEvents(){"undefined"!=typeof document&&document.removeEventListener("visibilitychange",this.onVisibilityChange)}onVisibilityChange(){"visible"===document.visibilityState?this.power():this.unpower()}static global(){return new Us}}Us.MinUpdateDelay=0,Us.MaxUpdateDelay=167,Us.MinCompileInterval=12,Us.MaxCompileInterval=33,Us.MinExecuteInterval=4,Us.MaxExecuteInterval=16,u([e.Lazy],Us,"global",null);const Hs=function(t){const e=t.extend("ExecuteProvider");return Object.defineProperty(e.prototype,"controllerContext",{get(){let t=this.service;return null==t&&(t=Us.global()),t.controllerContext},configurable:!0}),e.prototype.updatedControllerContext=function(){let t=this.service;return null==t&&(t=Us.global()),t.updatedControllerContext()},e.prototype.requestUpdate=function(t,e,i){let n=this.service;null==n&&(n=Us.global()),n.requestUpdate(t,e,i)},e.prototype.createService=function(){return Us.global()},e}(i.Provider),qs=function(){const t={empty:function(){return{fragment:void 0,permanent:{},ephemeral:{}}},current:function(){try{return t.fromUri(window.location.href)}catch(t){return console.error(t),{fragment:void 0,permanent:{},ephemeral:{}}}},updated:function(e,i){void 0===i&&(i=t.current()),"fragment"in e&&(i.fragment=e.fragment);for(const t in e.permanent){const n=e.permanent[t];void 0!==n?i.permanent[t]=n:delete i.permanent[t]}for(const t in e.ephemeral){const n=e.ephemeral[t];void 0!==n?i.ephemeral[t]=n:delete i.ephemeral[t]}return i},cloned:function(t){const e={fragment:t.fragment,permanent:{},ephemeral:{}};for(const i in t.permanent)e.permanent[i]=t.permanent[i];for(const i in t.ephemeral)e.ephemeral[i]=t.ephemeral[i];return e},fromUri:function(e){const i=(e=h.Uri.fromAny(e)).fragment;return i.isDefined()?t.fromUriFragment(i):t.empty()},fromUriFragment:function(t){let e=void 0!==(t=h.UriFragment.fromAny(t)).identifier?h.UriQuery.parse(t.identifier):h.UriQuery.undefined();const i={fragment:void 0,permanent:{},ephemeral:{}};for(;!e.isEmpty();){const t=e.key,n=e.value;void 0!==t?i.permanent[t]=n:i.fragment=n,e=e.tail()}return i},toUri:function(t){const e=h.UriQuery.builder();void 0!==t.fragment&&e.add(void 0,t.fragment);for(const i in t.permanent){const n=t.permanent[i];e.add(i,n)}return h.Uri.fragment(h.UriFragment.create(e.bind().toString()))}};return t}();class Gs extends e.Service{constructor(){super(),this.historyState=qs.current(),this.popHistory=this.popHistory.bind(this)}get historyUri(){return qs.toUri(this.historyState)}pushHistory(t){const e=this.historyState,i=qs.updated(t,qs.cloned(e)),n=qs.toUri(i);this.willPushHistory(i,e),this.historyState=i,window.history.pushState(i.ephemeral,"",n.toString()),this.onPushHistory(i,e),this.didPushHistory(i,e)}willPushHistory(t,e){const i=this.observers;for(let n=0,s=i.length;n<s;n+=1){const s=i[n];void 0!==s.serviceWillPushHistory&&s.serviceWillPushHistory(t,e,this)}}onPushHistory(t,e){const i=this.roots;for(let t=0,e=i.length;t<e;t+=1)i[t].requireUpdate(_s.NeedsRevise)}didPushHistory(t,e){const i=this.observers;for(let n=0,s=i.length;n<s;n+=1){const s=i[n];void 0!==s.serviceDidPushHistory&&s.serviceDidPushHistory(t,e,this)}}replaceHistory(t){const i=this.historyState,n=qs.updated(t,qs.cloned(i));if(!e.Objects.equal(i,n)){const t=qs.toUri(n);this.willReplaceHistory(n,i),this.historyState=n,window.history.replaceState(n.ephemeral,"",t.toString()),this.onReplaceHistory(n,i),this.didReplaceHistory(n,i)}}willReplaceHistory(t,e){const i=this.observers;for(let n=0,s=i.length;n<s;n+=1){const s=i[n];void 0!==s.serviceWillReplaceHistory&&s.serviceWillReplaceHistory(t,e,this)}}onReplaceHistory(t,e){const i=this.roots;for(let t=0,e=i.length;t<e;t+=1)i[t].requireUpdate(_s.NeedsRevise)}didReplaceHistory(t,e){const i=this.observers;for(let n=0,s=i.length;n<s;n+=1){const s=i[n];void 0!==s.serviceDidReplaceHistory&&s.serviceDidReplaceHistory(t,e,this)}}popHistory(t){const e={};"object"==typeof t.state&&null!==t.state&&(e.ephemeral=t.state);const i=qs.current(),n=qs.updated(e,i);this.willPopHistory(n,i),this.historyState=n,this.onPopHistory(n,i),this.didPopHistory(n,i)}willPopHistory(t,e){const i=this.observers;for(let n=0,s=i.length;n<s;n+=1){const s=i[n];void 0!==s.serviceWillPopHistory&&s.serviceWillPopHistory(t,e,this)}}onPopHistory(t,e){const i=this.roots;for(let t=0,e=i.length;t<e;t+=1)i[t].requireUpdate(_s.NeedsRevise)}didPopHistory(t,e){const i=this.observers;for(let n=0,s=i.length;n<s;n+=1){const s=i[n];void 0!==s.serviceDidPopHistory&&s.serviceDidPopHistory(t,e,this)}}onAttach(){super.onAttach(),this.attachEvents()}onDetach(){this.detachEvents(),super.onDetach()}attachEvents(){"undefined"!=typeof window&&window.addEventListener("popstate",this.popHistory)}detachEvents(){"undefined"!=typeof window&&window.removeEventListener("popstate",this.popHistory)}static global(){return new Gs}}u([e.Lazy],Gs,"global",null);const js=function(t){const e=t.extend("HistoryProvider");return Object.defineProperty(e.prototype,"historyState",{get(){let t=this.service;return null==t&&(t=Gs.global()),t.historyState},configurable:!0}),e.prototype.pushHistory=function(t){let e=this.service;null==e&&(e=Gs.global()),e.pushHistory(t)},e.prototype.replaceHistory=function(t){let e=this.service;null==e&&(e=Gs.global()),e.replaceHistory(t)},e.prototype.createService=function(){return Gs.global()},e}(i.Provider);class Ys extends e.Service{willSet(t,e,i){const n=this.observers;for(let s=0,o=n.length;s<o;s+=1){const o=n[s];void 0!==o.serviceWillStore&&o.serviceWillStore(t,e,i,this)}}onSet(t,e,i){const n=this.roots;for(let t=0,e=n.length;t<e;t+=1)n[t].requireUpdate(_s.NeedsRevise)}didSet(t,e,i){const n=this.observers;for(let s=0,o=n.length;s<o;s+=1){const o=n[s];void 0!==o.serviceDidStore&&o.serviceDidStore(t,e,i,this)}}willClear(){const t=this.observers;for(let e=0,i=t.length;e<i;e+=1){const i=t[e];void 0!==i.serviceWillClear&&i.serviceWillClear(this)}}onClear(){const t=this.roots;for(let e=0,i=t.length;e<i;e+=1)t[e].requireUpdate(_s.NeedsRevise)}didClear(){const t=this.observers;for(let e=0,i=t.length;e<i;e+=1){const i=t[e];void 0!==i.serviceDidClear&&i.serviceDidClear(this)}}static global(){let t=Xs.local();return null===t&&(t=new Ks),t}}u([e.Lazy],Ys,"global",null);class Xs extends Ys{constructor(t){super(),this.storage=t,this.onStorage=this.onStorage.bind(this)}get(t){const e=this.storage.getItem(t);return null!==e?e:void 0}set(t,e){let i=this.storage.getItem(t);return null===i&&(i=void 0),e!==i&&(this.willSet(t,e,i),void 0!==e?this.storage.setItem(t,e):this.storage.removeItem(t),this.onSet(t,e,i),this.didSet(t,e,i)),i}clear(){this.willClear(),this.storage.clear(),this.onClear(),this.didClear()}onStorage(t){if(t.storageArea===this.storage){const e=t.key;if(null!==e){let i=t.newValue;null===i&&(i=void 0);let n=t.oldValue;null===n&&(n=void 0),i!==n&&(this.willSet(e,i,n),this.onSet(e,i,n),this.didSet(e,i,n))}else this.willClear(),this.onClear(),this.didClear()}}onAttach(){super.onAttach(),this.attachEvents()}onDetach(){this.detachEvents(),super.onDetach()}attachEvents(){"undefined"!=typeof window&&window.addEventListener("storage",this.onStorage)}detachEvents(){"undefined"!=typeof window&&window.removeEventListener("storage",this.onStorage)}static local(){try{return new Xs(window.localStorage)}catch(t){return null}}static session(){try{return new Xs(window.sessionStorage)}catch(t){return null}}}u([e.Lazy],Xs,"local",null),u([e.Lazy],Xs,"session",null);class Ks extends Ys{constructor(t){super(),void 0===t&&(t={}),this.storage=t}get(t){return this.storage[t]}set(t,e){const i=this.storage,n=i[t];return e!==n&&(this.willSet(t,e,n),void 0!==e?i[t]=e:delete i[t],this.onSet(t,e,n),this.didSet(t,e,n)),n}clear(){this.willClear(),this.storage={},this.onClear(),this.didClear()}}const Zs=function(t){const e=t.extend("StorageProvider");return e.prototype.get=function(t){let e=this.service;return null==e&&(e=Ys.global()),e.get(t)},e.prototype.set=function(t,e){let i=this.service;return null==i&&(i=Ys.global()),i.set(t,e)},e.prototype.clear=function(){let t=this.service;null==t&&(t=Ys.global()),t.clear()},e.prototype.createService=function(){return Ys.global()},e}(i.Provider);class _s extends i.Hierarchy{constructor(){super(),this.parent=null}setFlags(t){this.flags=t}attachParent(t){this.willAttachParent(t),this.parent=t,t.mounted&&this.cascadeMount(),this.onAttachParent(t),this.didAttachParent(t)}willAttachParent(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.controllerWillAttachParent&&n.controllerWillAttachParent(t,this)}}onAttachParent(t){}didAttachParent(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.controllerDidAttachParent&&n.controllerDidAttachParent(t,this)}}detachParent(t){this.willDetachParent(t),this.mounted&&this.cascadeUnmount(),this.onDetachParent(t),this.parent=null,this.didDetachParent(t)}willDetachParent(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.controllerWillDetachParent&&n.controllerWillDetachParent(t,this)}}onDetachParent(t){}didDetachParent(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.controllerDidDetachParent&&n.controllerDidDetachParent(t,this)}}get insertChildFlags(){return this.constructor.InsertChildFlags}willInsertChild(t,e){super.willInsertChild(t,e);const i=this.observers;for(let n=0,s=i.length;n<s;n+=1){const s=i[n];void 0!==s.controllerWillInsertChild&&s.controllerWillInsertChild(t,e,this)}}onInsertChild(t,e){super.onInsertChild(t,e),this.bindChildFasteners(t,e)}didInsertChild(t,e){const i=this.observers;for(let n=0,s=i.length;n<s;n+=1){const s=i[n];void 0!==s.controllerDidInsertChild&&s.controllerDidInsertChild(t,e,this)}super.didInsertChild(t,e)}cascadeInsert(t,e){0!=(this.flags&_s.MountedFlag)&&(void 0===t&&(t=0),0!=((t|=this.flags&_s.UpdateMask)&_s.CompileMask)&&(void 0===e&&(e=this.superControllerContext),this.cascadeCompile(t,e)))}get removeChildFlags(){return this.constructor.RemoveChildFlags}willRemoveChild(t){super.willRemoveChild(t);const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.controllerWillRemoveChild&&n.controllerWillRemoveChild(t,this)}}onRemoveChild(t){super.onRemoveChild(t),this.unbindChildFasteners(t)}didRemoveChild(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.controllerDidRemoveChild&&n.controllerDidRemoveChild(t,this)}super.didRemoveChild(t)}get mountFlags(){return this.constructor.MountFlags}mount(){this.mounted||null!==this.parent||(this.cascadeMount(),this.cascadeInsert())}willMount(){super.willMount();const t=this.observers;for(let e=0,i=t.length;e<i;e+=1){const i=t[e];void 0!==i.controllerWillMount&&i.controllerWillMount(this)}}onMount(){this.requestUpdate(this,this.flags&_s.UpdateMask,!1),this.requireUpdate(this.mountFlags),null!==this.decoherent&&0!==this.decoherent.length&&this.requireUpdate(_s.NeedsRevise),this.mountFasteners()}didMount(){const t=this.observers;for(let e=0,i=t.length;e<i;e+=1){const i=t[e];void 0!==i.controllerDidMount&&i.controllerDidMount(this)}super.didMount()}willUnmount(){super.willUnmount();const t=this.observers;for(let e=0,i=t.length;e<i;e+=1){const i=t[e];void 0!==i.controllerWillUnmount&&i.controllerWillUnmount(this)}}didUnmount(){const t=this.observers;for(let e=0,i=t.length;e<i;e+=1){const i=t[e];void 0!==i.controllerDidUnmount&&i.controllerDidUnmount(this)}super.didUnmount()}requireUpdate(t,e=!1){const i=this.flags,n=t&~i&_s.UpdateMask;0!==n&&(this.setFlags(i|n),this.requestUpdate(this,n,e))}needsUpdate(t,e){return t}requestUpdate(t,e,i){e=this.needsUpdate(e,i);let n=this.flags&~e&_s.UpdateMask;if(0!=(e&_s.CompileMask)&&(n|=_s.NeedsCompile),0!=(e&_s.ExecuteMask)&&(n|=_s.NeedsExecute),0!==n||i){this.setFlags(this.flags|n);const s=this.parent;if(null!==s)s.requestUpdate(t,e,i);else if(this.mounted){const n=this.executeProvider.service;null!=n&&n.requestUpdate(t,e,i)}}}get updating(){return 0!=(this.flags&_s.UpdatingMask)}get compiling(){return 0!=(this.flags&_s.CompilingFlag)}needsCompile(t,e){return t}cascadeCompile(t,e){const i=this.extendControllerContext(e),n=zs.current;try{if(zs.current=i,t&=~_s.NeedsCompile,t|=this.flags&_s.UpdateMask,0!=((t=this.needsCompile(t,i))&_s.CompileMask)){let e=t;this.setFlags(this.flags&~_s.NeedsCompile|_s.TraversingFlag|_s.CompilingFlag|_s.ContextualFlag),this.willCompile(e,i),0!=((this.flags|t)&_s.NeedsResolve)&&(e|=_s.NeedsResolve,this.setFlags(this.flags&~_s.NeedsResolve),this.willResolve(i)),0!=((this.flags|t)&_s.NeedsGenerate)&&(e|=_s.NeedsGenerate,this.setFlags(this.flags&~_s.NeedsGenerate),this.willGenerate(i)),0!=((this.flags|t)&_s.NeedsAssemble)&&(e|=_s.NeedsAssemble,this.setFlags(this.flags&~_s.NeedsAssemble),this.willAssemble(i)),this.onCompile(e,i),0!=(e&_s.NeedsResolve)&&this.onResolve(i),0!=(e&_s.NeedsGenerate)&&this.onGenerate(i),0!=(e&_s.NeedsAssemble)&&this.onAssemble(i),0!=(e&_s.CompileMask)&&(this.setFlags(this.flags&~_s.ContextualFlag),this.compileChildren(e,i,this.compileChild),this.setFlags(this.flags|_s.ContextualFlag)),0!=(e&_s.NeedsAssemble)&&this.didAssemble(i),0!=(e&_s.NeedsGenerate)&&this.didGenerate(i),0!=(e&_s.NeedsResolve)&&this.didResolve(i),this.didCompile(e,i)}}finally{this.setFlags(this.flags&~(_s.TraversingFlag|_s.CompilingFlag|_s.ContextualFlag)),zs.current=n}}willCompile(t,e){}onCompile(t,e){}didCompile(t,e){}willResolve(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.controllerWillResolve&&n.controllerWillResolve(t,this)}}onResolve(t){}didResolve(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.controllerDidResolve&&n.controllerDidResolve(t,this)}}willGenerate(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.controllerWillGenerate&&n.controllerWillGenerate(t,this)}}onGenerate(t){}didGenerate(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.controllerDidGenerate&&n.controllerDidGenerate(t,this)}}willAssemble(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.controllerWillAssemble&&n.controllerWillAssemble(t,this)}}onAssemble(t){}didAssemble(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.controllerDidAssemble&&n.controllerDidAssemble(t,this)}}compileChildren(t,e,i){this.forEachChild((function(n){i.call(this,n,t,e),0!=(n.flags&_s.RemovingFlag)&&(n.setFlags(n.flags&~_s.RemovingFlag),this.removeChild(n))}),this)}compileChild(t,e,i){t.cascadeCompile(e,i)}get executing(){return 0!=(this.flags&_s.ExecutingFlag)}needsExecute(t,e){return t}cascadeExecute(t,e){const i=this.extendControllerContext(e),n=zs.current;try{if(zs.current=i,t&=~_s.NeedsExecute,t|=this.flags&_s.UpdateMask,0!=((t=this.needsExecute(t,i))&_s.ExecuteMask)){let e=t;this.setFlags(this.flags&~_s.NeedsExecute|_s.TraversingFlag|_s.ExecutingFlag|_s.ContextualFlag),this.willExecute(e,i),0!=((this.flags|t)&_s.NeedsRevise)&&(e|=_s.NeedsRevise,this.setFlags(this.flags&~_s.NeedsRevise),this.willRevise(i)),0!=((this.flags|t)&_s.NeedsCompute)&&(e|=_s.NeedsCompute,this.setFlags(this.flags&~_s.NeedsCompute),this.willCompute(i)),this.onExecute(e,i),0!=(e&_s.NeedsRevise)&&this.onRevise(i),0!=(e&_s.NeedsCompute)&&this.onCompute(i),0!=(e&_s.ExecuteMask)&&(this.setFlags(this.flags&~_s.ContextualFlag),this.executeChildren(e,i,this.executeChild),this.setFlags(this.flags|_s.ContextualFlag)),0!=(e&_s.NeedsCompute)&&this.didCompute(i),0!=(e&_s.NeedsRevise)&&this.didRevise(i),this.didExecute(e,i)}}finally{this.setFlags(this.flags&~(_s.TraversingFlag|_s.ExecutingFlag|_s.ContextualFlag)),zs.current=n}}willExecute(t,e){}onExecute(t,e){}didExecute(t,e){}willRevise(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.controllerWillRevise&&n.controllerWillRevise(t,this)}}onRevise(t){this.recohereFasteners(t.updateTime)}didRevise(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.controllerDidRevise&&n.controllerDidRevise(t,this)}}willCompute(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.controllerWillCompute&&n.controllerWillCompute(t,this)}}onCompute(t){}didCompute(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.controllerDidCompute&&n.controllerDidCompute(t,this)}}executeChildren(t,e,i){this.forEachChild((function(n){i.call(this,n,t,e),0!=(n.flags&_s.RemovingFlag)&&(n.setFlags(n.flags&~_s.RemovingFlag),this.removeChild(n))}),this)}executeChild(t,e,i){t.cascadeExecute(e,i)}onAttachFastener(t,e){super.onAttachFastener(t,e),this.bindFastener(e)}bindFastener(t){t instanceof Js&&t.binds&&this.forEachChild((function(e){t.bindController(e,null)}),this)}bindChildFasteners(t,e){const i=this.fasteners;for(const n in i){const s=i[n];this.bindChildFastener(s,t,e)}}bindChildFastener(t,e,i){t instanceof Js&&t.bindController(e,i)}unbindChildFasteners(t){const e=this.fasteners;for(const i in e){const n=e[i];this.unbindChildFastener(n,t)}}unbindChildFastener(t,e){t instanceof Js&&t.unbindController(e)}decohereFastener(t){super.decohereFastener(t),this.requireUpdate(_s.NeedsRevise)}get superControllerContext(){const t=this.parent;return null!==t?t.controllerContext:this.executeProvider.updatedControllerContext()}extendControllerContext(t){return t}get controllerContext(){return 0!=(this.flags&_s.ContextualFlag)?zs.current:this.extendControllerContext(this.superControllerContext)}init(t){}static create(){return new this}static fromInit(t){let i;i=("object"==typeof t&&null!==t||"function"==typeof t)&&e.Creatable.is(t.type)?t.type:this;const n=i.create();return n.init(t),n}static fromAny(t){if(null==t)return t;if(t instanceof _s){if(t instanceof this)return t;throw new TypeError(t+" not an instance of "+this)}return e.Creatable.is(t)?t.create():this.fromInit(t)}}_s.uid=function(){let t=1;return function(){const e=~~t;return t+=1,e}}(),_s.MountedFlag=i.Hierarchy.MountedFlag,_s.RemovingFlag=i.Hierarchy.RemovingFlag,_s.TraversingFlag=i.Hierarchy.TraversingFlag,_s.CompilingFlag=1<<i.Hierarchy.FlagShift+0,_s.ExecutingFlag=1<<i.Hierarchy.FlagShift+1,_s.ContextualFlag=1<<i.Hierarchy.FlagShift+2,_s.UpdatingMask=_s.CompilingFlag|_s.ExecutingFlag,_s.StatusMask=_s.MountedFlag|_s.RemovingFlag|_s.TraversingFlag|_s.CompilingFlag|_s.ExecutingFlag|_s.ContextualFlag,_s.NeedsCompile=1<<i.Hierarchy.FlagShift+3,_s.NeedsResolve=1<<i.Hierarchy.FlagShift+4,_s.NeedsGenerate=1<<i.Hierarchy.FlagShift+5,_s.NeedsAssemble=1<<i.Hierarchy.FlagShift+6,_s.CompileMask=_s.NeedsCompile|_s.NeedsResolve|_s.NeedsGenerate|_s.NeedsAssemble,_s.NeedsExecute=1<<i.Hierarchy.FlagShift+7,_s.NeedsRevise=1<<i.Hierarchy.FlagShift+8,_s.NeedsCompute=1<<i.Hierarchy.FlagShift+9,_s.ExecuteMask=_s.NeedsExecute|_s.NeedsRevise|_s.NeedsCompute,_s.UpdateMask=_s.CompileMask|_s.ExecuteMask,_s.FlagShift=i.Hierarchy.FlagShift+10,_s.FlagMask=(1<<_s.FlagShift)-1,_s.MountFlags=0,_s.InsertChildFlags=0,_s.RemoveChildFlags=0,u([i.Provider({extends:Hs,type:Us,observes:!1,service:Us.global()})],_s.prototype,"executeProvider",void 0),u([i.Provider({extends:js,type:Gs,observes:!1,service:Gs.global()})],_s.prototype,"historyProvider",void 0),u([i.Provider({extends:Zs,type:Ys,observes:!1,service:Ys.global()})],_s.prototype,"storageProvider",void 0);class Qs extends _s{constructor(){super(),this.children=[],this.childMap=null}get childCount(){return this.children.length}firstChild(){const t=this.children;return 0!==t.length?t[0]:null}lastChild(){const t=this.children,e=t.length;return 0!==e?t[e-1]:null}nextChild(t){const e=this.children,i=e.indexOf(t);return i>=0&&i+1<e.length?e[i+1]:null}previousChild(t){const e=this.children,i=e.indexOf(t);return i-1>=0?e[i-1]:null}forEachChild(t,e){let i;const n=this.children;let s=0;for(;s<n.length;){const o=n[s];if(i=t.call(e,o),void 0!==i)break;n[s]===o&&(s+=1)}return i}insertChildMap(t){const e=t.key;if(void 0!==e){let i=this.childMap;null===i&&(i={},this.childMap=i),i[e]=t}}removeChildMap(t){const e=t.key;if(void 0!==e){const t=this.childMap;null!==t&&delete t[e]}}replaceChildMap(t,e){const i=e.key;if(void 0!==i){let e=this.childMap;null===e&&(e={},this.childMap=e),e[i]=t}}getChild(t,e){const i=this.childMap;if(null!==i){const n=i[t];if(void 0!==n&&(void 0===e||n instanceof e))return n}return null}setChild(t,e){null!==e&&(e=_s.fromAny(e));const i=this.getChild(t),n=this.children;let s=-1,o=null;return null!==i&&null!==e&&i!==e?(e.remove(),s=n.indexOf(i),o=s+1<n.length?n[s+1]:null,e.setKey(i.key),this.willRemoveChild(i),this.willInsertChild(e,o),i.detachParent(this),n[s]=e,this.replaceChildMap(e,i),e.attachParent(this),this.onRemoveChild(i),this.onInsertChild(e,o),this.didRemoveChild(i),this.didInsertChild(e,o),i.setKey(void 0),e.cascadeInsert()):(e!==i||null!==e&&e.key!==t)&&(null!==i&&(this.willRemoveChild(i),i.detachParent(this),this.removeChildMap(i),s=n.indexOf(i),n.splice(s,1),this.onRemoveChild(i),this.didRemoveChild(i),i.setKey(void 0),s<n.length&&(o=n[s])),null!==e&&(e.remove(),e.setKey(t),this.willInsertChild(e,o),s>=0?n.splice(s,0,e):n.push(e),this.insertChildMap(e),e.attachParent(this),this.onInsertChild(e,o),this.didInsertChild(e,o),e.cascadeInsert())),i}appendChild(t,e){return(t=_s.fromAny(t)).remove(),void 0!==e&&(this.removeChild(e),t.setKey(e)),this.willInsertChild(t,null),this.children.push(t),this.insertChildMap(t),t.attachParent(this),this.onInsertChild(t,null),this.didInsertChild(t,null),t.cascadeInsert(),t}prependChild(t,e){(t=_s.fromAny(t)).remove(),void 0!==e&&(this.removeChild(e),t.setKey(e));const i=this.children,n=0!==i.length?i[0]:null;return this.willInsertChild(t,n),i.unshift(t),this.insertChildMap(t),t.attachParent(this),this.onInsertChild(t,n),this.didInsertChild(t,n),t.cascadeInsert(),t}insertChild(t,e,i){if(null!==e&&e.parent!==this)throw new TypeError(""+e);(t=_s.fromAny(t)).remove(),void 0!==i&&(this.removeChild(i),t.setKey(i)),this.willInsertChild(t,e);const n=this.children,s=null!==e?n.indexOf(e):-1;return s>=0?n.splice(s,0,t):n.push(t),this.insertChildMap(t),t.attachParent(this),this.onInsertChild(t,e),this.didInsertChild(t,e),t.cascadeInsert(),t}replaceChild(t,e){const i=this.children;if(e.parent!==this)throw new TypeError(""+e);if((t=_s.fromAny(t))!==e){t.remove();const n=i.indexOf(e),s=n+1<i.length?i[n+1]:null;t.setKey(e.key),this.willRemoveChild(e),this.willInsertChild(t,s),e.detachParent(this),i[n]=t,this.replaceChildMap(t,e),t.attachParent(this),this.onRemoveChild(e),this.onInsertChild(t,s),this.didRemoveChild(e),this.didInsertChild(t,s),e.setKey(void 0),t.cascadeInsert()}return e}removeChild(t){let e;if("string"==typeof t){if(e=this.getChild(t),null===e)return null}else if(e=t,e.parent!==this)throw new Error("not a child controller");this.willRemoveChild(e),e.detachParent(this),this.removeChildMap(e);const i=this.children,n=i.indexOf(e);return i.splice(n,1),this.onRemoveChild(e),this.didRemoveChild(e),e.setKey(void 0),e}removeChildren(){const t=this.children;let e;for(;e=t.length,0!==e;){const i=t[e-1];this.willRemoveChild(i),i.detachParent(this),this.removeChildMap(i),t.pop(),this.onRemoveChild(i),this.didRemoveChild(i),i.setKey(void 0)}}mountChildren(){const t=this.children;let e=0;for(;e<t.length;){const i=t[e];i.cascadeMount(),0==(i.flags&_s.RemovingFlag)?e+=1:(i.setFlags(i.flags&~_s.RemovingFlag),this.removeChild(i))}}unmountChildren(){const t=this.children;let e=0;for(;e<t.length;){const i=t[e];i.cascadeUnmount(),0==(i.flags&_s.RemovingFlag)?e+=1:(i.setFlags(i.flags&~_s.RemovingFlag),this.removeChild(i))}}compileChildren(t,e,i){const n=this.children;let s=0;for(;s<n.length;){const o=n[s];i.call(this,o,t,e),0==(o.flags&_s.RemovingFlag)?s+=1:(o.setFlags(o.flags&~_s.RemovingFlag),this.removeChild(o))}}executeChildren(t,e,i){const n=this.children;let s=0;for(;s<n.length;){const o=n[s];i.call(this,o,t,e),0==(o.flags&_s.RemovingFlag)?s+=1:(o.setFlags(o.flags&~_s.RemovingFlag),this.removeChild(o))}}}const Js=function(t){const e=t.extend("ControllerRelation");return Object.defineProperty(e.prototype,"familyType",{get:function(){return e},configurable:!0}),e.prototype.initController=function(t){},e.prototype.willAttachController=function(t,e){},e.prototype.onAttachController=function(t,e){!0===this.observes&&t.observe(this)},e.prototype.didAttachController=function(t,e){},e.prototype.deinitController=function(t){},e.prototype.willDetachController=function(t){},e.prototype.onDetachController=function(t){!0===this.observes&&t.unobserve(this)},e.prototype.didDetachController=function(t){},Object.defineProperty(e.prototype,"parentController",{get(){const t=this.owner;return t instanceof _s?t:null},configurable:!0}),e.prototype.insertChild=function(t,e,i,n){t.insertChild(e,i,n)},e.prototype.bindController=function(t,e){},e.prototype.unbindController=function(t){},e.prototype.detectController=function(t){return null},e.prototype.createController=function(){let t;const e=this.type;if(void 0!==e&&(t=e.create()),null==t){let t="Unable to create ";throw 0!==this.name.length&&(t+=this.name+" "),t+="controller",new Error(t)}return t},e.prototype.fromAny=function(t){const e=this.type;return void 0!==e?e.fromAny(t):_s.fromAny(t)},Object.defineProperty(e.prototype,"lazy",{get:function(){return!1},configurable:!0}),Object.defineProperty(e.prototype,"static",{get:function(){return!0},configurable:!0}),e.construct=function(e,i,n){return i=t.construct(e,i,n)},e.define=function(t,e){let i=e.extends;const n=e.affinity,s=e.inherits;delete e.extends,delete e.affinity,delete e.inherits,null==i&&(i=this);const o=i.extend(t,e);return o.construct=function(t,e,o){return e=i.construct(t,e,o),void 0!==n&&e.initAffinity(n),void 0!==s&&e.initInherits(s),e},o},e}(i.Fastener),$s=function(t){const e=t.extend("ControllerRef");return Object.defineProperty(e.prototype,"familyType",{get:function(){return e},configurable:!0}),e.prototype.onInherit=function(t){this.setController(t.controller)},e.prototype.getController=function(){const t=this.controller;if(null===t){let e=t+" ";throw 0!==this.name.length&&(e+=this.name+" "),e+="controller",new TypeError(e)}return t},e.prototype.setController=function(t,e,i){null!==t&&(t=this.fromAny(t));let n=this.controller;if(n!==t){let s;void 0===e&&(e=null),this.binds&&(s=this.parentController,null!==s)&&(null!==n&&n.parent===s&&(null===e&&(e=s.nextChild(n)),n.remove()),null!==t&&(void 0===i&&(i=this.key),this.insertChild(s,t,e,i)),n=this.controller),n!==t&&(null!==n&&(this.willDetachController(n),this.controller=null,this.onDetachController(n),this.deinitController(n),this.didDetachController(n)),null!==t&&(this.willAttachController(t,e),this.controller=t,this.onAttachController(t,e),this.initController(t),this.didAttachController(t,e)))}return n},e.prototype.attachController=function(t,e){const i=this.controller;return(t=null!=t?this.fromAny(t):null===i?this.createController():i)!==i&&(void 0===e&&(e=null),null!==i&&(this.willDetachController(i),this.controller=null,this.onDetachController(i),this.deinitController(i),this.didDetachController(i)),this.willAttachController(t,e),this.controller=t,this.onAttachController(t,e),this.initController(t),this.didAttachController(t,e)),t},e.prototype.detachController=function(){const t=this.controller;return null!==t&&(this.willDetachController(t),this.controller=null,this.onDetachController(t),this.deinitController(t),this.didDetachController(t)),t},e.prototype.insertController=function(t,e,i,n){if(null!=e)e=this.fromAny(e);else{const t=this.controller;e=null===t?this.createController():t}null==t&&(t=this.parentController),void 0===i&&(i=null),void 0===n&&(n=this.key),null===t||e.parent===t&&e.key===n||this.insertChild(t,e,i,n);const s=this.controller;return e!==s&&(null!==s&&(this.willDetachController(s),this.controller=null,this.onDetachController(s),this.deinitController(s),this.didDetachController(s),s.remove()),this.willAttachController(e,i),this.controller=e,this.onAttachController(e,i),this.initController(e),this.didAttachController(e,i)),e},e.prototype.removeController=function(){const t=this.controller;return null!==t&&t.remove(),t},e.prototype.deleteController=function(){const t=this.detachController();return null!==t&&t.remove(),t},e.prototype.bindController=function(t,e){if(this.binds&&null===this.controller){const i=this.detectController(t);null!==i&&(this.willAttachController(i,e),this.controller=i,this.onAttachController(i,e),this.initController(i),this.didAttachController(i,e))}},e.prototype.unbindController=function(t){if(this.binds){const e=this.detectController(t);null!==e&&this.controller===e&&(this.willDetachController(e),this.controller=null,this.onDetachController(e),this.deinitController(e),this.didDetachController(e))}},e.prototype.detectController=function(t){const e=this.key;return void 0!==e&&e===t.key?t:null},e.construct=function(e,i,n){return null===i&&(delete(i=function(t,e,n){return void 0===t?i.controller:(i.setController(t,e,n),i.owner)}).name,Object.setPrototypeOf(i,e.prototype)),(i=t.construct(e,i,n)).key=void 0,i.controller=null,i},e.define=function(t,e){let i=e.extends;const n=e.affinity,s=e.inherits;delete e.extends,delete e.affinity,delete e.inherits,!0===e.key?Object.defineProperty(e,"key",{value:t,configurable:!0}):!1===e.key&&Object.defineProperty(e,"key",{value:void 0,configurable:!0}),null==i&&(i=this);const o=i.extend(t,e);return o.construct=function(t,e,o){return e=i.construct(t,e,o),void 0!==n&&e.initAffinity(n),void 0!==s&&e.initInherits(s),e},o},e}(Js),to=function(t){const e=t.extend("ControllerSet");return Object.defineProperty(e.prototype,"familyType",{get:function(){return e},configurable:!0}),e.prototype.hasController=function(t){return void 0!==this.controllers[t.uid]},e.prototype.addController=function(t,e,i){let n;t=null!=t?this.fromAny(t):this.createController(),void 0===e&&(e=null),this.binds&&(n=this.parentController,null!==n)&&(void 0===i&&(i=this.key(t)),this.insertChild(n,t,e,i));const s=this.controllers;return void 0===s[t.uid]&&(this.willAttachController(t,e),s[t.uid]=t,this.controllerCount+=1,this.onAttachController(t,e),this.initController(t),this.didAttachController(t,e)),t},e.prototype.attachController=function(t,e){t=null!=t?this.fromAny(t):this.createController();const i=this.controllers;return void 0===i[t.uid]&&(void 0===e&&(e=null),this.willAttachController(t,e),i[t.uid]=t,this.controllerCount+=1,this.onAttachController(t,e),this.initController(t),this.didAttachController(t,e)),t},e.prototype.detachController=function(t){const e=this.controllers;return void 0!==e[t.uid]?(this.willDetachController(t),this.controllerCount-=1,delete e[t.uid],this.onDetachController(t),this.deinitController(t),this.didDetachController(t),t):null},e.prototype.insertController=function(t,e,i,n){e=null!=e?this.fromAny(e):this.createController(),null==t&&(t=this.parentController),void 0===i&&(i=null),void 0===n&&(n=this.key(e)),null===t||e.parent===t&&e.key===n||this.insertChild(t,e,i,n);const s=this.controllers;return void 0===s[e.uid]&&(this.willAttachController(e,i),s[e.uid]=e,this.controllerCount+=1,this.onAttachController(e,i),this.initController(e),this.didAttachController(e,i)),e},e.prototype.removeController=function(t){return this.hasController(t)?(t.remove(),t):null},e.prototype.deleteController=function(t){const e=this.detachController(t);return null!==e&&e.remove(),e},e.prototype.bindController=function(t,e){if(this.binds){const i=this.detectController(t),n=this.controllers;null!==i&&void 0===n[i.uid]&&(this.willAttachController(i,e),n[i.uid]=i,this.controllerCount+=1,this.onAttachController(i,e),this.initController(i),this.didAttachController(i,e))}},e.prototype.unbindController=function(t){if(this.binds){const e=this.detectController(t),i=this.controllers;null!==e&&void 0!==i[e.uid]&&(this.willDetachController(e),this.controllerCount-=1,delete i[e.uid],this.onDetachController(e),this.deinitController(e),this.didDetachController(e))}},e.prototype.detectController=function(t){return"function"==typeof this.type&&t instanceof this.type?t:null},e.prototype.key=function(t){},e.construct=function(e,i,n){return null===i&&(delete(i=function(t){return i.addController(t),i.owner}).name,Object.setPrototypeOf(i,e.prototype)),(i=t.construct(e,i,n)).controllers={},i.controllerCount=0,i},e.define=function(t,e){let i=e.extends;const n=e.affinity,s=e.inherits;delete e.extends,delete e.affinity,delete e.inherits,null==i&&(i=this);const o=i.extend(t,e);return o.construct=function(t,e,o){return e=i.construct(t,e,o),void 0!==n&&e.initAffinity(n),void 0!==s&&e.initInherits(s),e},o},e}(Js),eo=function(t){const e=t.extend("TraitViewRef");return Object.defineProperty(e.prototype,"familyType",{get:function(){return e},configurable:!0}),e.prototype.onInherit=function(t){this.setTrait(t.trait),this.setView(t.view)},e.prototype.getTrait=function(){const t=this.trait;if(null===t){let e=t+" ";throw 0!==this.name.length&&(e+=this.name+" "),e+="trait",new TypeError(e)}return t},e.prototype.setTrait=function(t,e,i){null!==t&&(t=this.fromAnyTrait(t));let n=this.trait;if(n!==t){let s;void 0===e&&(e=null),this.bindsTrait&&(s=this.parentModel,null!==s)&&(null!==n&&n.model===s&&(null===e&&(e=s.nextTrait(n)),n.remove()),null!==t&&(void 0===i&&(i=this.traitKey),this.insertChildTrait(s,t,e,i)),n=this.trait),n!==t&&(null!==n&&(this.willDetachTrait(n),this.trait=null,this.onDetachTrait(n),this.deinitTrait(n),this.didDetachTrait(n)),null!==t&&(this.willAttachTrait(t,e),this.trait=t,this.onAttachTrait(t,e),this.initTrait(t),this.didAttachTrait(t,e)))}return n},e.prototype.attachTrait=function(t,e){const i=this.trait;return(t=null!=t?this.fromAnyTrait(t):null===i?this.createTrait():i)!==i&&(void 0===e&&(e=null),null!==i&&(this.willDetachTrait(i),this.trait=null,this.onDetachTrait(i),this.deinitTrait(i),this.didDetachTrait(i)),this.willAttachTrait(t,e),this.trait=t,this.onAttachTrait(t,e),this.initTrait(t),this.didAttachTrait(t,e)),t},e.prototype.detachTrait=function(){const t=this.trait;return null!==t&&(this.willDetachTrait(t),this.trait=null,this.onDetachTrait(t),this.deinitTrait(t),this.didDetachTrait(t)),t},e.prototype.initTrait=function(t){},e.prototype.willAttachTrait=function(t,e){},e.prototype.onAttachTrait=function(t,e){!0===this.observesTrait&&t.observe(this)},e.prototype.didAttachTrait=function(t,e){},e.prototype.deinitTrait=function(t){},e.prototype.willDetachTrait=function(t){},e.prototype.onDetachTrait=function(t){!0===this.observesTrait&&t.unobserve(this)},e.prototype.didDetachTrait=function(t){},e.prototype.insertTrait=function(t,e,i,n){if(null!=e)e=this.fromAnyTrait(e);else{const t=this.trait;e=null===t?this.createTrait():t}null==t&&(t=this.parentModel),void 0===i&&(i=null),void 0===n&&(n=this.traitKey),null===t||e.parent===t&&e.key===n||this.insertChildTrait(t,e,i,n);const s=this.trait;return e!==s&&(null!==s&&(this.willDetachTrait(s),this.trait=null,this.onDetachTrait(s),this.deinitTrait(s),this.didDetachTrait(s),s.remove()),this.willAttachTrait(e,i),this.trait=e,this.onAttachTrait(e,i),this.initTrait(e),this.didAttachTrait(e,i)),e},e.prototype.removeTrait=function(){const t=this.trait;return null!==t&&t.remove(),t},e.prototype.deleteTrait=function(){const t=this.detachTrait();return null!==t&&t.remove(),t},Object.defineProperty(e.prototype,"parentModel",{get(){const t=this.owner;return t instanceof w?t:t instanceof A?t.model:null},configurable:!0}),e.prototype.insertChildTrait=function(t,e,i,n){t.insertTrait(e,i,n)},e.prototype.bindModel=function(t,e){if(this.bindsTrait&&null===this.trait){const e=this.detectModel(t);null!==e&&(this.willAttachTrait(e,null),this.trait=e,this.onAttachTrait(e,null),this.initTrait(e),this.didAttachTrait(e,null))}},e.prototype.unbindModel=function(t){if(this.bindsTrait){const e=this.detectModel(t);null!==e&&this.trait===e&&(this.willDetachTrait(e),this.trait=null,this.onDetachTrait(e),this.deinitTrait(e),this.didDetachTrait(e))}},e.prototype.detectModel=function(t){return null},e.prototype.bindTrait=function(t,e){if(this.bindsTrait&&null===this.trait){const i=this.detectTrait(t);null!==i&&(this.willAttachTrait(i,e),this.trait=i,this.onAttachTrait(i,e),this.initTrait(i),this.didAttachTrait(i,e))}},e.prototype.unbindTrait=function(t){if(this.bindsTrait){const e=this.detectTrait(t);null!==e&&this.trait===e&&(this.willDetachTrait(e),this.trait=null,this.onDetachTrait(e),this.deinitTrait(e),this.didDetachTrait(e))}},e.prototype.detectTrait=function(t){const e=this.traitKey;return void 0!==e&&e===t.key?t:null},e.prototype.createTrait=function(){let t;const e=this.traitType;if(void 0!==e&&(t=e.create()),null==t){let t="Unable to create ";throw 0!==this.name.length&&(t+=this.name+" "),t+="trait",new Error(t)}return t},e.prototype.fromAnyTrait=function(t){const e=this.traitType;return void 0!==e?e.fromAny(t):A.fromAny(t)},e.prototype.getView=function(){const t=this.view;if(null===t){let e=t+" ";throw 0!==this.name.length&&(e+=this.name+" "),e+="view",new TypeError(e)}return t},e.prototype.setView=function(t,e,i){null!==t&&(t=this.fromAnyView(t));let n=this.view;if(n!==t){let s;void 0===e&&(e=null),this.bindsView&&(s=this.parentView,null!==s)&&(null!==n&&n.parent===s&&(null===e&&(e=s.nextChild(n)),n.remove()),null!==t&&(void 0===i&&(i=this.viewKey),this.insertChildView(s,t,e,i)),n=this.view),n!==t&&(null!==n&&(this.willDetachView(n),this.view=null,this.onDetachView(n),this.deinitView(n),this.didDetachView(n)),null!==t&&(this.willAttachView(t,e),this.view=t,this.onAttachView(t,e),this.initView(t),this.didAttachView(t,e)))}return n},e.prototype.attachView=function(t,e){const i=this.view;return(t=null!=t?this.fromAnyView(t):null===i?this.createView():i)!==i&&(void 0===e&&(e=null),null!==i&&(this.willDetachView(i),this.view=null,this.onDetachView(i),this.deinitView(i),this.didDetachView(i)),this.willAttachView(t,e),this.view=t,this.onAttachView(t,e),this.initView(t),this.didAttachView(t,e)),t},e.prototype.detachView=function(){const t=this.view;return null!==t&&(this.willDetachView(t),this.view=null,this.onDetachView(t),this.deinitView(t),this.didDetachView(t)),t},e.prototype.initView=function(t){},e.prototype.willAttachView=function(t,e){},e.prototype.onAttachView=function(t,e){!0===this.observesView&&t.observe(this)},e.prototype.didAttachView=function(t,e){},e.prototype.deinitView=function(t){},e.prototype.willDetachView=function(t){},e.prototype.onDetachView=function(t){!0===this.observesView&&t.unobserve(this)},e.prototype.didDetachView=function(t){},e.prototype.insertView=function(t,e,i,n){if(null!=e)e=this.fromAnyView(e);else{const t=this.view;e=null===t?this.createView():t}null==t&&(t=this.parentView),void 0===i&&(i=null),void 0===n&&(n=this.viewKey),null===t||e.parent===t&&e.key===n||this.insertChildView(t,e,i,n);const s=this.view;return e!==s&&(null!==s&&(this.willDetachView(s),this.view=null,this.onDetachView(s),this.deinitView(s),this.didDetachView(s),s.remove()),this.willAttachView(e,i),this.view=e,this.onAttachView(e,i),this.initView(e),this.didAttachView(e,i)),e},e.prototype.removeView=function(){const t=this.view;return null!==t&&t.remove(),t},e.prototype.deleteView=function(){const t=this.detachView();return null!==t&&t.remove(),t},Object.defineProperty(e.prototype,"parentView",{get(){const t=this.owner;return t instanceof fn?t:null},configurable:!0}),e.prototype.insertChildView=function(t,e,i,n){t.insertChild(e,i,n)},e.prototype.bindView=function(t,e){if(this.bindsView&&null===this.view){const i=this.detectView(t);null!==i&&(this.willAttachView(i,e),this.view=i,this.onAttachView(i,e),this.initView(i),this.didAttachView(i,e))}},e.prototype.unbindView=function(t){if(this.bindsView){const e=this.detectView(t);null!==e&&this.view===e&&(this.willDetachView(e),this.view=null,this.onDetachView(e),this.deinitView(e),this.didDetachView(e))}},e.prototype.detectView=function(t){const e=this.viewKey;return void 0!==e&&e===t.key?t:null},e.prototype.createView=function(){let t;const e=this.viewType;if(void 0!==e&&(t=e.create()),null==t){let t="Unable to create ";throw 0!==this.name.length&&(t+=this.name+" "),t+="view",new Error(t)}return t},e.prototype.fromAnyView=function(t){const e=this.viewType;return void 0!==e?e.fromAny(t):fn.fromAny(t)},Object.defineProperty(e.prototype,"lazy",{get:function(){return!1},configurable:!0}),Object.defineProperty(e.prototype,"static",{get:function(){return!0},configurable:!0}),e.construct=function(e,i,n){return(i=t.construct(e,i,n)).trait=null,i.view=null,i},e.define=function(t,e){let i=e.extends;const n=e.affinity,s=e.inherits;delete e.extends,delete e.affinity,delete e.inherits,!0===e.traitKey?Object.defineProperty(e,"traitKey",{value:t,configurable:!0}):!1===e.traitKey&&Object.defineProperty(e,"traitKey",{value:void 0,configurable:!0}),!0===e.viewKey?Object.defineProperty(e,"viewKey",{value:t,configurable:!0}):!1===e.viewKey&&Object.defineProperty(e,"viewKey",{value:void 0,configurable:!0}),null==i&&(i=this);const o=i.extend(t,e);return o.construct=function(t,e,o){return e=i.construct(t,e,o),void 0!==n&&e.initAffinity(n),void 0!==s&&e.initInherits(s),e},o},e}(i.Fastener),io=function(t){const e=t.extend("TraitControllerRef");return Object.defineProperty(e.prototype,"familyType",{get:function(){return e},configurable:!0}),e.prototype.getTraitRef=function(t){throw new Error("abstract")},Object.defineProperty(e.prototype,"trait",{get:function(){const t=this.controller;if(null!==t){return this.getTraitRef(t).trait}return null},configurable:!0}),e.prototype.setTrait=function(t,e,i){let n=this.controller;if(null!==t){null===n&&(n=this.createController(t));this.getTraitRef(n).setTrait(t,e,i),this.setController(n,null,i)}else if(null!==n){this.getTraitRef(n).setTrait(null)}return n},e.prototype.removeTrait=function(t){const e=this.controller;if(null!==e){if(this.getTraitRef(e).trait===t)return e.remove(),e}return null},e.prototype.deleteTrait=function(t){const e=this.controller;if(null!==e){if(this.getTraitRef(e).trait===t)return e.remove(),this.setController(null),e}return null},e.construct=function(e,i,n){return i=t.construct(e,i,n)},e.define=function(t,e){let i=e.extends;const n=e.affinity,s=e.inherits;delete e.extends,delete e.affinity,delete e.inherits,!0===e.key?Object.defineProperty(e,"key",{value:t,configurable:!0}):!1===e.key&&Object.defineProperty(e,"key",{value:void 0,configurable:!0}),null==i&&(i=this);const o=i.extend(t,e);return o.construct=function(t,e,o){return e=i.construct(t,e,o),void 0!==n&&e.initAffinity(n),void 0!==s&&e.initInherits(s),e},o},e}($s),no=function(t){const e=t.extend("TraitControllerSet");return e.prototype.getTraitRef=function(t){throw new Error("missing implementation")},e.prototype.hasTraitController=function(t){return void 0!==this.traitControllers[t.uid]},e.prototype.addTraitController=function(t,e,i){const n=this.traitControllers;let s=n[t.uid];if(void 0===s){s=this.createController(t);this.getTraitRef(s).setTrait(t,e,i);const o=null!=e?n[e.uid]:void 0;this.addController(s,o,i)}return s},e.prototype.removeTraitController=function(t){const e=this.controllers;for(const i in e){const n=e[i];if(this.getTraitRef(n).trait===t)return this.removeController(n),n}return null},e.prototype.deleteTraitController=function(t){const e=this.controllers;for(const i in e){const n=e[i];if(this.getTraitRef(n).trait===t)return this.deleteController(n),n}return null},e.prototype.attachControllerTrait=function(t,e,i){const n=this.traitControllers;let s=n[e.uid];return void 0===s&&(s=t,void 0===i&&(i=null),this.willAttachControllerTrait(s,e,i),n[e.uid]=s,this.controllerCount+=1,this.onAttachControllerTrait(s,e,i),this.initControllerTrait(s,e),this.didAttachControllerTrait(s,e,i)),s},e.prototype.detachControllerTrait=function(t,e){const i=this.traitControllers,n=i[e.uid];return void 0!==n?(this.willDetachControllerTrait(n,e),this.controllerCount-=1,delete i[e.uid],this.onDetachControllerTrait(n,e),this.deinitControllerTrait(n,e),this.didDetachControllerTrait(n,e),n):null},e.prototype.initControllerTrait=function(t,e){},e.prototype.willAttachControllerTrait=function(t,e,i){},e.prototype.onAttachControllerTrait=function(t,e,i){},e.prototype.didAttachControllerTrait=function(t,e,i){},e.prototype.deinitControllerTrait=function(t,e){},e.prototype.willDetachControllerTrait=function(t,e){},e.prototype.onDetachControllerTrait=function(t,e){},e.prototype.didDetachControllerTrait=function(t,e){},e.prototype.onAttachController=function(t,e){const i=this.getTraitRef(t).trait;if(null!==i){const n=null!==e&&this.hasController(e)?this.getTraitRef(e).trait:null;this.attachControllerTrait(t,i,n)}to.prototype.onAttachController.call(this,t,e)},e.prototype.onDetachController=function(t){to.prototype.onDetachController.call(this,t);const e=this.getTraitRef(t).trait;null!==e&&this.detachControllerTrait(t,e)},e.construct=function(e,i,n){return(i=t.construct(e,i,n)).traitControllers={},i},e.define=function(t,e){let i=e.extends;const n=e.affinity,s=e.inherits;delete e.extends,delete e.affinity,delete e.inherits,null==i&&(i=this);const o=i.extend(t,e);return o.construct=function(t,e,o){return e=i.construct(t,e,o),void 0!==n&&e.initAffinity(n),void 0!==s&&e.initInherits(s),e},o},e}(to),so=function(t){const e=t.extend("TraitViewControllerRef");return Object.defineProperty(e.prototype,"familyType",{get:function(){return e},configurable:!0}),e.prototype.getTraitViewRef=function(t){throw new Error("abstract")},Object.defineProperty(e.prototype,"trait",{get:function(){const t=this.controller;if(null!==t){return this.getTraitViewRef(t).trait}return null},configurable:!0}),e.prototype.setTrait=function(t,e,i){let n=this.controller;if(null!==t){null===n&&(n=this.createController(t));const s=this.getTraitViewRef(n);if(s.setTrait(t,e,i),this.setController(n,null,i),null===s.view){const t=s.createView();s.insertView(this.parentView,t,null,i)}}else if(null!==n){this.getTraitViewRef(n).setTrait(null)}return n},e.prototype.removeTrait=function(t){const e=this.controller;if(null!==e){if(this.getTraitViewRef(e).trait===t)return e.remove(),e}return null},e.prototype.deleteTrait=function(t){const e=this.controller;if(null!==e){if(this.getTraitViewRef(e).trait===t)return e.remove(),this.setController(null),e}return null},Object.defineProperty(e.prototype,"view",{get:function(){const t=this.controller;if(null!==t){return this.getTraitViewRef(t).view}return null},configurable:!0}),Object.defineProperty(e.prototype,"parentView",{get:function(){return null},configurable:!0}),e.construct=function(e,i,n){return i=t.construct(e,i,n)},e.define=function(t,e){let i=e.extends;const n=e.affinity,s=e.inherits;delete e.extends,delete e.affinity,delete e.inherits,!0===e.key?Object.defineProperty(e,"key",{value:t,configurable:!0}):!1===e.key&&Object.defineProperty(e,"key",{value:void 0,configurable:!0}),null==i&&(i=this);const o=i.extend(t,e);return o.construct=function(t,e,o){return e=i.construct(t,e,o),void 0!==n&&e.initAffinity(n),void 0!==s&&e.initInherits(s),e},o},e}($s),oo=function(t){const e=t.extend("TraitViewControllerSet");return e.prototype.getTraitViewRef=function(t){throw new Error("missing implementation")},e.prototype.hasTraitController=function(t){return void 0!==this.traitControllers[t.uid]},e.prototype.addTraitController=function(t,e,i){const n=this.traitControllers;let s=n[t.uid];if(void 0===s){s=this.createController(t);const o=this.getTraitViewRef(s);o.setTrait(t,e,i);const r=null!=e?n[e.uid]:void 0;if(this.addController(s,r,i),null===o.view){const t=o.createView(),e=void 0!==r?this.getTraitViewRef(r).view:null;o.insertView(this.parentView,t,e,i)}}return s},e.prototype.removeTraitController=function(t){const e=this.controllers;for(const i in e){const n=e[i];if(this.getTraitViewRef(n).trait===t)return this.removeController(n),n}return null},e.prototype.deleteTraitController=function(t){const e=this.controllers;for(const i in e){const n=e[i];if(this.getTraitViewRef(n).trait===t)return this.deleteController(n),n}return null},e.prototype.attachControllerTrait=function(t,e,i){const n=this.traitControllers;let s=n[e.uid];return void 0===s&&(s=t,void 0===i&&(i=null),this.willAttachControllerTrait(s,e,i),n[e.uid]=s,this.controllerCount+=1,this.onAttachControllerTrait(s,e,i),this.initControllerTrait(s,e),this.didAttachControllerTrait(s,e,i)),s},e.prototype.detachControllerTrait=function(t,e){const i=this.traitControllers,n=i[e.uid];return void 0!==n?(this.willDetachControllerTrait(n,e),this.controllerCount-=1,delete i[e.uid],this.onDetachControllerTrait(n,e),this.deinitControllerTrait(n,e),this.didDetachControllerTrait(n,e),n):null},e.prototype.initControllerTrait=function(t,e){},e.prototype.willAttachControllerTrait=function(t,e,i){},e.prototype.onAttachControllerTrait=function(t,e,i){},e.prototype.didAttachControllerTrait=function(t,e,i){},e.prototype.deinitControllerTrait=function(t,e){},e.prototype.willDetachControllerTrait=function(t,e){},e.prototype.onDetachControllerTrait=function(t,e){},e.prototype.didDetachControllerTrait=function(t,e){},e.prototype.onAttachController=function(t,e){const i=this.getTraitViewRef(t).trait;if(null!==i){const n=null!==e&&this.hasController(e)?this.getTraitViewRef(e).trait:null;this.attachControllerTrait(t,i,n)}to.prototype.onAttachController.call(this,t,e)},e.prototype.onDetachController=function(t){to.prototype.onDetachController.call(this,t);const e=this.getTraitViewRef(t).trait;null!==e&&this.detachControllerTrait(t,e)},Object.defineProperty(e.prototype,"parentView",{get:function(){return null},configurable:!0}),e.construct=function(e,i,n){return(i=t.construct(e,i,n)).traitControllers={},i},e.define=function(t,e){let i=e.extends;const n=e.affinity,s=e.inherits;delete e.extends,delete e.affinity,delete e.inherits,null==i&&(i=this);const o=i.extend(t,e);return o.construct=function(t,e,o){return e=i.construct(t,e,o),void 0!==n&&e.initAffinity(n),void 0!==s&&e.initInherits(s),e},o},e}(to);class ro extends Kn{constructor(t){super(t),this.glowState="ready",this.glowTimer=0,this.initGlow()}initGlow(){this.addClass("button-glow"),this.position.setState("absolute",i.Affinity.Intrinsic),this.width.setState(s.Length.zero(),i.Affinity.Intrinsic),this.height.setState(s.Length.zero(),i.Affinity.Intrinsic),this.borderTopLeftRadius.setState(s.Length.pct(50),i.Affinity.Intrinsic),this.borderTopRightRadius.setState(s.Length.pct(50),i.Affinity.Intrinsic),this.borderBottomLeftRadius.setState(s.Length.pct(50),i.Affinity.Intrinsic),this.borderBottomRightRadius.setState(s.Length.pct(50),i.Affinity.Intrinsic),this.pointerEvents.setState("none",i.Affinity.Intrinsic)}didMount(){if(this.backgroundColor.hasAffinity(i.Affinity.Intrinsic)){let t=this.getLookOr(At.highlightColor,null);null!==t&&(t=t.alpha(1)),this.backgroundColor.setState(t,i.Affinity.Intrinsic)}super.didMount()}onUnmount(){this.glowState="ready",this.cancelGlow(),this.remove(),super.onUnmount()}onApplyTheme(t,e,n){if(super.onApplyTheme(t,e,n),this.backgroundColor.hasAffinity(i.Affinity.Intrinsic)){let n=t.getOr(At.highlightColor,e,null);null!==n&&(n=n.alpha(1)),this.backgroundColor.setState(n,i.Affinity.Intrinsic)}}glow(t,n,s,o=0){if("ready"===this.glowState)if(this.cancelGlow(),0!==o){const e=this.glow.bind(this,t,n,s,i.Affinity.Intrinsic);this.glowTimer=setTimeout(e,o)}else{s=void 0===s||!0===s?this.getLookOr(At.timing,!1):e.Timing.fromAny(s),this.willGlow();const o=this.node.offsetParent;if(null!==o){const e=o.getBoundingClientRect(),r=t-e.left,l=n-e.top,a=Math.max(r,e.width-r),h=Math.max(l,e.height-l),d=Math.sqrt(a*a+h*h),c=this.getLook(At.highlightColor),u=void 0!==c?c.alpha():.1;this.opacity.setState(u,i.Affinity.Intrinsic),!1!==s?(this.left.setState(r,i.Affinity.Intrinsic),this.top.setState(l,i.Affinity.Intrinsic),this.left.setState(r-d,s,i.Affinity.Intrinsic),this.top.setState(l-d,s,i.Affinity.Intrinsic),this.width.setState(2*d,s,i.Affinity.Intrinsic),this.height.setState(2*d,s,i.Affinity.Intrinsic)):(this.left.setState(r-d,i.Affinity.Intrinsic),this.top.setState(l-d,i.Affinity.Intrinsic),this.width.setState(2*d,i.Affinity.Intrinsic),this.height.setState(2*d,i.Affinity.Intrinsic),this.didGlow()),this.glowState="glowing"}}}willGlow(){}didGlow(){}cancelGlow(){0!==this.glowTimer&&(clearTimeout(this.glowTimer),this.glowTimer=0)}pulse(t,n,s){s=void 0===s||!0===s?this.getLookOr(At.timing,!1):e.Timing.fromAny(s),"ready"===this.glowState&&this.glow(t,n,s),"glowing"===this.glowState&&(this.willPulse(),!1!==s?this.opacity.setState(0,s,i.Affinity.Intrinsic):(this.opacity.setState(0,i.Affinity.Intrinsic),this.didPulse()),this.glowState="pulsing")}willPulse(){}didPulse(){this.remove()}fade(t,n,s){"ready"===this.glowState?(this.cancelGlow(),this.didFade()):"glowing"===this.glowState&&(s=void 0===s||!0===s?this.getLookOr(At.timing,!1):e.Timing.fromAny(s),this.willFade(),!1!==s?this.opacity.setState(0,s,i.Affinity.Intrinsic):(this.opacity.setState(0,i.Affinity.Intrinsic),this.didFade())),this.glowState="fading"}willFade(){}didFade(){this.remove()}}u([On({propertyNames:"left",type:s.Length,state:null,get constraintValue(){const t=this.owner.node;return t instanceof HTMLElement?s.Length.px(t.offsetLeft):null},didTransition(){this.owner.didGlow()}})],ro.prototype,"left",void 0),u([Pn({propertyNames:"opacity",type:Number,didTransition(t){"pulsing"===this.owner.glowState&&0===t?this.owner.didPulse():"fading"===this.owner.glowState&&0===t&&this.owner.didFade()}})],ro.prototype,"opacity",void 0);class lo extends Kn{constructor(t){super(t),this.initMembrane(t)}initMembrane(t){this.addClass("membrane")}glow(t){if(t.detail instanceof ro&&(t.detail.fade(t.x,t.y),t.detail=void 0),void 0===t.detail){const e="mouse"===t.inputType?0:100;t.detail=this.prependChild(ro),t.detail.glow(t.x,t.y,void 0,e)}}init(t){super.init(t)}}u([i.Property({type:Boolean,inherits:!0,state:!0})],lo.prototype,"glows",void 0),u([$i({self:!0,didBeginPress(t,e){this.owner.glows.state&&this.owner.glow(t)},didMovePress(t,e){t.isRunaway()?this.cancelPress(t,e):this.owner.clientBounds.contains(t.x,t.y)||(t.clearHoldTimer(),this.beginHover(t,e),t.detail instanceof ro&&(t.detail.fade(t.x,t.y),t.detail=void 0))},didEndPress(t,e){this.owner.clientBounds.contains(t.x,t.y)?t.detail instanceof ro&&t.detail.pulse(t.x,t.y):(this.endHover(t,e),t.detail instanceof ro&&(t.detail.fade(t.x,t.y),t.detail=void 0))},didCancelPress(t,e){this.owner.clientBounds.contains(t.x,t.y)||this.endHover(t,e),t.detail instanceof ro&&(t.detail.fade(t.x,t.y),t.detail=void 0)}})],lo.prototype,"gesture",void 0);class ao extends lo{constructor(t){super(t),this.buttonType="regular",this.iconCount=0,this.icon=null,this.initButton()}initButton(){this.addClass("floating-button"),this.position.setState("relative",i.Affinity.Intrinsic),"regular"===this.buttonType?(this.width.setState(56,i.Affinity.Intrinsic),this.height.setState(56,i.Affinity.Intrinsic)):"mini"===this.buttonType&&(this.width.setState(40,i.Affinity.Intrinsic),this.height.setState(40,i.Affinity.Intrinsic)),this.borderTopLeftRadius.setState(s.Length.pct(50),i.Affinity.Intrinsic),this.borderTopRightRadius.setState(s.Length.pct(50),i.Affinity.Intrinsic),this.borderBottomLeftRadius.setState(s.Length.pct(50),i.Affinity.Intrinsic),this.borderBottomRightRadius.setState(s.Length.pct(50),i.Affinity.Intrinsic),this.overflowX.setState("hidden",i.Affinity.Intrinsic),this.overflowY.setState("hidden",i.Affinity.Intrinsic),this.userSelect.setState("none",i.Affinity.Intrinsic),this.cursor.setState("pointer",i.Affinity.Intrinsic)}setButtonType(t){this.buttonType!==t&&(this.buttonType=t,"regular"===t?(this.width.setState(56,i.Affinity.Intrinsic),this.height.setState(56,i.Affinity.Intrinsic)):"mini"===t&&(this.width.setState(40,i.Affinity.Intrinsic),this.height.setState(40,i.Affinity.Intrinsic)))}pushIcon(t,n){n=void 0===n||!0===n?this.getLookOr(At.timing,!1):e.Timing.fromAny(n);const o=this.iconCount,r="icon"+o,l=this.getFastener(r,vn),a=null!==l?l.view:null;null!==a&&(!1!==n?(a.opacity.setState(0,n,i.Affinity.Intrinsic),a.transform.setState(s.Transform.rotate(s.Angle.deg(90)),n,i.Affinity.Intrinsic)):a.remove());const h=o+1,d="icon"+h,c=ao.IconRef.create(this);Object.defineProperty(c,"name",{value:d,enumerable:!0,configurable:!0}),c.iconIndex=h;const u=Bs.create();u.position.setState("absolute",i.Affinity.Intrinsic),u.left.setState(0,i.Affinity.Intrinsic),u.top.setState(0,i.Affinity.Intrinsic),u.width.setState(this.width.state,i.Affinity.Intrinsic),u.height.setState(this.height.state,i.Affinity.Intrinsic),u.opacity.setState(0,i.Affinity.Intrinsic),u.opacity.setState(1,n,i.Affinity.Intrinsic),u.transform.setState(s.Transform.rotate(s.Angle.deg(-90)),i.Affinity.Intrinsic),u.transform.setState(s.Transform.rotate(s.Angle.deg(0)),n,i.Affinity.Intrinsic),u.pointerEvents.setState("none",i.Affinity.Intrinsic),u.iconWidth.setState(24,i.Affinity.Intrinsic),u.iconHeight.setState(24,i.Affinity.Intrinsic),u.iconColor.setAffinity(i.Affinity.Extrinsic),u.graphics.setState(t,i.Affinity.Intrinsic),c.setView(u),this.setFastener(d,c),this.appendChild(u,d),this.iconCount=h,this.icon=c}popIcon(t){t=void 0===t||!0===t?this.getLookOr(At.timing,!1):e.Timing.fromAny(t);const n=this.iconCount,o="icon"+n,r=this.getFastener(o,vn),l=null!==r?r.view:null;null!==l&&(!1!==t?(l.opacity.setState(0,t,i.Affinity.Intrinsic),l.transform.setState(s.Transform.rotate(s.Angle.deg(-90)),t,i.Affinity.Intrinsic)):l.remove());const a=n-1,h="icon"+a,d=this.getFastener(h,vn),c=null!==d?d.view:null;null!==c&&(c.opacity.setState(1,t,i.Affinity.Intrinsic),c.transform.setState(s.Transform.rotate(s.Angle.deg(0)),t,i.Affinity.Intrinsic),this.appendChild(c,h)),this.iconCount=a,this.icon=d}onApplyTheme(t,e,n){super.onApplyTheme(t,e,n),this.backgroundColor.setState(t.getOr(At.accentColor,e,null),n,i.Affinity.Intrinsic);let s=t.getOr(At.shadow,Et.floating,null);if(null!==s){const t=s.color,e=this.disclosure.getPhaseOr(1);s=s.withColor(t.alpha(t.alpha()*e))}this.boxShadow.setState(s,n,i.Affinity.Intrinsic)}onLayout(t){super.onLayout(t);let e=this.getLookOr(At.shadow,Et.floating,null);if(null!==e){const t=e.color,i=this.disclosure.getPhaseOr(1);e=e.withColor(t.alpha(t.alpha()*i))}this.boxShadow.setState(e,i.Affinity.Intrinsic)}}ao.IconRef=vn.define("IconRef",{type:Bs,observes:!0,init(){this.iconIndex=0},viewDidApplyTheme(t,e,i,n){const s=t.getOr(At.backgroundColor,e,null);n.iconColor.setState(s,i)},viewDidAnimate(t,e){e.opacity.tweening||this.iconIndex===this.owner.iconCount||(e.remove(),this.iconIndex>this.owner.iconCount&&this.owner.setFastener(this.key,null))}}),u([$i({extends:!0,didStartHovering(){if(this.owner.modifyMood(Rt.default,[[Rt.hovering,1]]),this.owner.backgroundColor.hasAffinity(i.Affinity.Intrinsic)){const t=this.owner.getLook(At.timing);this.owner.backgroundColor.setState(this.owner.getLookOr(At.accentColor,null),t,i.Affinity.Intrinsic)}},didStopHovering(){if(this.owner.modifyMood(Rt.default,[[Rt.hovering,void 0]]),this.owner.backgroundColor.hasAffinity(i.Affinity.Intrinsic)){const t=this.owner.getLook(At.timing);this.owner.backgroundColor.setState(this.owner.getLookOr(At.accentColor,null),t,i.Affinity.Intrinsic)}},didMovePress(t,e){}})],ao.prototype,"gesture",void 0),u([Ht({type:gt,inherits:!0})],ao.prototype,"disclosure",void 0);class ho extends Kn{constructor(t){super(t),this.initButtonItem()}initButtonItem(){this.addClass("button-item"),this.position.setState("relative",i.Affinity.Intrinsic);const t=this.createButton();null!==t&&this.setChild("button",t)}createButton(){const t=ao.create();return t.setButtonType("mini"),t}get button(){const t=this.getChild("button");return t instanceof ao?t:null}get icon(){const t=this.button,e=null!==t?t.icon:null;return null!==e?e.view:null}get label(){const t=this.getChild("label");return t instanceof Kn?t:null}onApplyTheme(t,e,n){super.onApplyTheme(t,e,n);const s=this.label;null!==s&&s.color.hasAffinity(i.Affinity.Intrinsic)&&s.color.setState(t.getOr(At.mutedColor,e,null),n,i.Affinity.Intrinsic)}onLayout(t){super.onLayout(t);const e=this.disclosure.getPhaseOr(1),n=this.button;null!==n&&(this.width.setState(n.width.state,i.Affinity.Intrinsic),this.height.setState(n.height.state,i.Affinity.Intrinsic));const s=this.label;null!==s&&s.opacity.setState(e,i.Affinity.Intrinsic)}onInsertChild(t,e){super.onInsertChild(t,e);const i=t.key;"button"===i&&t instanceof ao?this.onInsertButton(t):"label"===i&&t instanceof Kn&&this.onInsertLabel(t)}onRemoveChild(t){const e=t.key;"button"===e&&t instanceof ao?this.onRemoveButton(t):"label"===e&&t instanceof Kn&&this.onRemoveLabel(t),super.onRemoveChild(t)}onInsertButton(t){}onRemoveButton(t){}onInsertLabel(t){t.display.setState("block",i.Affinity.Intrinsic),t.position.setState("absolute",i.Affinity.Intrinsic),t.top.setState(0,i.Affinity.Intrinsic),t.right.setState(56,i.Affinity.Intrinsic),t.bottom.setState(0,i.Affinity.Intrinsic),t.fontSize.setState(17,i.Affinity.Intrinsic),t.fontWeight.setState("500",i.Affinity.Intrinsic),t.lineHeight.setState(40,i.Affinity.Intrinsic),t.whiteSpace.setState("nowrap",i.Affinity.Intrinsic),t.opacity.setState(this.disclosure.getPhaseOr(0),i.Affinity.Intrinsic)}onRemoveLabel(t){}}u([Ht({type:gt,inherits:!0})],ho.prototype,"disclosure",void 0);class co extends Kn{constructor(t){super(t),this.stackHeight=0,this.onClick=this.onClick.bind(this),this.onContextMenu=this.onContextMenu.bind(this),this.initButtonStack(),this.initButton()}initButtonStack(){this.addClass("button-stack"),this.display.setState("block",i.Affinity.Intrinsic),this.position.setState("relative",i.Affinity.Intrinsic),this.width.setState(56,i.Affinity.Intrinsic),this.height.setState(56,i.Affinity.Intrinsic),this.opacity.setState(1,i.Affinity.Intrinsic),this.userSelect.setState("none",i.Affinity.Intrinsic),this.cursor.setState("pointer",i.Affinity.Intrinsic)}initButton(){const t=this.createButton();null!==t&&this.appendChild(t,"button")}createButton(){return ao.create()}get modalView(){return null}get modalState(){return this.disclosure.modalState}get modality(){return this.disclosure.phase}showModal(t,e){this.disclosure.expand(e)}hideModal(t){this.disclosure.collapse(t)}get button(){const t=this.getChild("button");return t instanceof Kn?t:null}get closeIcon(){return co.closeIcon}get items(){const t=this.node.childNodes,e=[];for(let i=0,n=t.length;i<n;i+=1){const n=t[i].view;n instanceof ho&&e.push(n)}return e}insertItem(t,e,i){void 0===e&&(e=this.node.childNodes.length-1),this.insertChild(t.node,this.node.childNodes[1+e]||null,i)}removeItems(){const t=this.node.childNodes;for(let e=t.length-1;e>=0;e-=1){const i=t[e].view;i instanceof ho&&this.removeChild(i)}}onMount(){super.onMount(),this.on("click",this.onClick),this.on("contextmenu",this.onContextMenu)}onUnmount(){this.off("click",this.onClick),this.off("contextmenu",this.onContextMenu),super.onUnmount()}onLayout(t){super.onLayout(t),this.layoutStack();const e=this.modalProvider.service;null!=e&&e.updateModality()}layoutStack(){const t=this.disclosure.getPhase(),e=this.node.childNodes,n=e.length,o=this.button;let r,l=n-1,a=0,h=0;if(null!==o){o.zIndex.setState(n,i.Affinity.Intrinsic);const t=null!==o?o.height.value:void 0;r=t instanceof s.Length?t.pxValue():o.node.offsetHeight}else r=0;const d=this.buttonSpacing.value,c=this.itemSpacing.value;for(let o=0;o<n;o+=1){const n=e[o].view;if(n instanceof ho){0===a?(h+=d,r+=d):(h+=c,r+=c);const e=n.height.value,o=e instanceof s.Length?e.pxValue():n.node.offsetHeight;n.display.setState(0===t?"none":"flex",i.Affinity.Intrinsic),n.bottom.setState(t*r,i.Affinity.Intrinsic),n.zIndex.setState(l,i.Affinity.Intrinsic),r+=o,h+=o,a+=1,l-=1}}this.stackHeight=h}onInsertChild(t,e){super.onInsertChild(t,e);"button"===t.key&&t instanceof Kn?this.onInsertButton(t):t instanceof ho&&this.onInsertItem(t)}onRemoveChild(t){"button"===t.key&&t instanceof Kn?this.onRemoveButton(t):t instanceof ho&&this.onRemoveItem(t),super.onRemoveChild(t)}onInsertButton(t){this.gesture.setView(t),t instanceof ao&&(t.disclosure.setState(gt.expanded(),i.Affinity.Intrinsic),(this.disclosure.expanded||this.disclosure.expanding)&&t.pushIcon(this.closeIcon)),t.zIndex.setState(0,i.Affinity.Intrinsic)}onRemoveButton(t){this.gesture.setView(null)}onInsertItem(t){t.position.setState("absolute",i.Affinity.Intrinsic),t.right.setState(8,i.Affinity.Intrinsic),t.bottom.setState(8,i.Affinity.Intrinsic),t.left.setState(8,i.Affinity.Intrinsic),t.zIndex.setState(0,i.Affinity.Intrinsic)}onRemoveItem(t){}willExpand(){const t=this.observers;for(let e=0,i=t.length;e<i;e+=1){const i=t[e];void 0!==i.buttonStackWillExpand&&i.buttonStackWillExpand(this)}}onExpand(){const t=this.button;if(t instanceof ao){const e=this.disclosure.timing;t.pushIcon(this.closeIcon,null!==e?e:void 0)}this.modalProvider.presentModal(this)}didExpand(){const t=this.observers;for(let e=0,i=t.length;e<i;e+=1){const i=t[e];void 0!==i.buttonStackDidExpand&&i.buttonStackDidExpand(this)}}willCollapse(){const t=this.observers;for(let e=0,i=t.length;e<i;e+=1){const i=t[e];void 0!==i.buttonStackWillCollapse&&i.buttonStackWillCollapse(this)}}onCollapse(){this.modalProvider.dismissModal(this);const t=this.button;if(t instanceof ao&&t.iconCount>1){const e=this.disclosure.timing;t.popIcon(null!==e?e:void 0)}}didCollapse(){const t=this.observers;for(let e=0,i=t.length;e<i;e+=1){const i=t[e];void 0!==i.buttonStackDidCollapse&&i.buttonStackDidCollapse(this)}}show(t){1!==this.opacity.state&&(t=void 0===t||!0===t?this.getLookOr(At.timing,!1):e.Timing.fromAny(t),this.willShow(),!1!==t?this.opacity.setState(1,t,i.Affinity.Intrinsic):(this.opacity.setState(1,i.Affinity.Intrinsic),this.didShow()))}willShow(){const t=this.observers;for(let e=0,i=t.length;e<i;e+=1){const i=t[e];void 0!==i.buttonStackWillShow&&i.buttonStackWillShow(this)}this.display("block")}didShow(){this.requireUpdate(fn.NeedsLayout);const t=this.observers;for(let e=0,i=t.length;e<i;e+=1){const i=t[e];void 0!==i.buttonStackDidShow&&i.buttonStackDidShow(this)}}hide(t){0!==this.opacity.state&&(t=void 0===t||!0===t?this.getLookOr(At.timing,!1):e.Timing.fromAny(t),this.willHide(),!1!==t?this.opacity.setState(0,t,i.Affinity.Intrinsic):(this.opacity.setState(0,i.Affinity.Intrinsic),this.didHide()))}willHide(){const t=this.observers;for(let e=0,i=t.length;e<i;e+=1){const i=t[e];void 0!==i.buttonStackWillHide&&i.buttonStackWillHide(this)}}didHide(){this.display("none"),this.requireUpdate(fn.NeedsLayout);const t=this.observers;for(let e=0,i=t.length;e<i;e+=1){const i=t[e];void 0!==i.buttonStackDidHide&&i.buttonStackDidHide(this)}}onClick(t){var e;t.target===(null===(e=this.button)||void 0===e?void 0:e.node)&&t.stopPropagation()}onContextMenu(t){t.preventDefault()}static get closeIcon(){return Ps.create(24,24,"M19,6.4L17.6,5L12,10.6L6.4,5L5,6.4L10.6,12L5,17.6L6.4,19L12,13.4L17.6,19L19,17.6L13.4,12Z")}}u([$i({didMovePress(t,e){if(!t.defaultPrevented&&!this.owner.disclosure.expanded){const e=this.owner.stackHeight,i=Math.min(Math.max(0,-(t.y-t.y0)/(.5*e)),1);this.owner.disclosure.setPhase(i),i>.1&&(t.clearHoldTimer(),this.owner.disclosure.expanding||this.owner.disclosure.setState(this.owner.disclosure.value.asExpanding()))}},didEndPress(t,e){if(!t.defaultPrevented){const e=this.owner.disclosure.getPhase();t.t-t.t0<t.holdDelay?e<.1||this.owner.disclosure.expanded?this.owner.disclosure.collapse():this.owner.disclosure.expand():e<.5?this.owner.disclosure.collapse():e>=.5&&this.owner.disclosure.expand()}},didCancelPress(t,e){if(2===t.buttons)this.owner.disclosure.toggle();else{this.owner.disclosure.getPhase()<.1||this.owner.disclosure.expanded?this.owner.disclosure.collapse():this.owner.disclosure.expand()}},didLongPress(t){t.preventDefault(),this.owner.disclosure.toggle()}})],co.prototype,"gesture",void 0),u([Ht({type:gt,state:gt.collapsed(),updateFlags:fn.NeedsLayout,willExpand(){this.owner.willExpand(),this.owner.onExpand()},didExpand(){this.owner.didExpand()},willCollapse(){this.owner.willCollapse(),this.owner.onCollapse()},didCollapse(){this.owner.didCollapse()}})],co.prototype,"disclosure",void 0),u([Ht({type:Number,state:28,updateFlags:fn.NeedsLayout})],co.prototype,"buttonSpacing",void 0),u([Ht({type:Number,state:20,updateFlags:fn.NeedsLayout})],co.prototype,"itemSpacing",void 0),u([Pn({propertyNames:"opacity",type:Number,didTransition(t){1===t?this.owner.didShow():0===t&&this.owner.didHide()}})],co.prototype,"opacity",void 0),u([e.Lazy],co,"closeIcon",null);class uo extends lo{constructor(t){super(t),this.iconCount=0,this.icon=null,this.onClick=this.onClick.bind(this),this.initButton(),this.initTheme()}initButton(){this.addClass("icon-button"),this.position.setState("relative",i.Affinity.Intrinsic),this.width.setState(44,i.Affinity.Intrinsic),this.height.setState(44,i.Affinity.Intrinsic),this.display.setState("flex",i.Affinity.Intrinsic),this.justifyContent.setState("center",i.Affinity.Intrinsic),this.alignItems.setState("center",i.Affinity.Intrinsic),this.borderTopLeftRadius.setState(4,i.Affinity.Intrinsic),this.borderTopRightRadius.setState(4,i.Affinity.Intrinsic),this.borderBottomLeftRadius.setState(4,i.Affinity.Intrinsic),this.borderBottomRightRadius.setState(4,i.Affinity.Intrinsic),this.overflowX.setState("hidden",i.Affinity.Intrinsic),this.overflowY.setState("hidden",i.Affinity.Intrinsic),this.userSelect.setState("none",i.Affinity.Intrinsic),this.cursor.setState("pointer",i.Affinity.Intrinsic)}initTheme(){this.modifyTheme(Rt.default,[[Rt.translucent,1]])}pushIcon(t,n){const o=this.iconCount,r=o+1;this.iconCount=r,n=(void 0!==n||0!==o)&&(void 0===n||!0===n?this.getLookOr(At.timing,!1):e.Timing.fromAny(n));const l="icon"+o,a=this.getFastener(l,vn),h=null!==a?a.view:null;null!==h&&(!1!==n?(h.opacity.setState(0,n,i.Affinity.Intrinsic),h.cssTransform.setState(s.Transform.rotate(s.Angle.deg(90)),n,i.Affinity.Intrinsic)):h.remove());const d="icon"+r,c=uo.IconRef.create(this);Object.defineProperty(c,"name",{value:d,enumerable:!0,configurable:!0}),c.iconIndex=r,this.icon=c;const u=Ns.create();u.setStyle("position","absolute"),u.setStyle("left","0"),u.setStyle("top","0"),u.opacity.setState(0,i.Affinity.Intrinsic),u.opacity.setState(1,n,i.Affinity.Intrinsic),u.cssTransform.setState(s.Transform.rotate(s.Angle.deg(-90)),i.Affinity.Intrinsic),u.cssTransform.setState(s.Transform.rotate(s.Angle.deg(0)),n,i.Affinity.Intrinsic),u.pointerEvents.setState("none",i.Affinity.Intrinsic),u.xAlign.setInherits(!0),u.yAlign.setInherits(!0),u.iconWidth.setInherits(!0),u.iconHeight.setInherits(!0),u.iconColor.setInherits(!0),u.graphics.setState(t,i.Affinity.Intrinsic),c.setView(u),this.setFastener(d,c),this.appendChild(u,d)}popIcon(t){const n=this.iconCount,o=n-1;this.iconCount=o,t=void 0===t||!0===t?this.getLookOr(At.timing,!1):e.Timing.fromAny(t);const r="icon"+n,l=this.getFastener(r,vn),a=null!==l?l.view:null;null!==a&&(!1!==t?(a.opacity.setState(0,t,i.Affinity.Intrinsic),a.cssTransform.setState(s.Transform.rotate(s.Angle.deg(-90)),t,i.Affinity.Intrinsic)):(a.remove(),this.setFastener(r,null)));const h="icon"+o,d=this.getFastener(h,vn);this.icon=d;const c=null!==d?d.view:null;return null!==c&&(c.opacity.setState(1,t,i.Affinity.Intrinsic),c.cssTransform.setState(s.Transform.rotate(s.Angle.deg(0)),t,i.Affinity.Intrinsic),this.appendChild(c,h)),a}onApplyTheme(t,e,n){if(super.onApplyTheme(t,e,n),this.backgroundColor.hasAffinity(i.Affinity.Intrinsic)){let t=this.getLookOr(At.backgroundColor,null);!this.gesture.hovering&&t instanceof z&&(t=t.alpha(0)),this.backgroundColor.setState(t,n,i.Affinity.Intrinsic)}if(!this.graphics.inherited){const s=this.graphics.value;if(s instanceof Ds){const o=s.withTheme(t,e);this.graphics.setState(o,!!s.isThemed()&&n,i.Affinity.Reflexive)}}}onResize(t){super.onResize(t),this.requireUpdate(fn.NeedsLayout)}needsDisplay(t,e){return 0==(this.flags&fn.NeedsLayout)&&(t&=~fn.NeedsLayout),t}onLayout(t){super.onLayout(t),this.layoutIcon()}layoutIcon(){const t=this.fasteners;if(null!==t){let e=this.width.value;e=e instanceof s.Length?e.pxValue():this.node.offsetWidth;let n=this.height.value;n=n instanceof s.Length?n.pxValue():this.node.offsetHeight;for(const s in t){const o=t[s];if(o instanceof uo.IconRef){const t=o.view;null!==t&&(t.width.setState(e,i.Affinity.Intrinsic),t.height.setState(n,i.Affinity.Intrinsic),t.viewBox.setState("0 0 "+e+" "+n,i.Affinity.Intrinsic))}}}}onMount(){super.onMount(),this.on("click",this.onClick)}onUnmount(){this.off("click",this.onClick),super.onUnmount()}get hovers(){return!0}setHovers(t){this.hovers!==t&&Object.defineProperty(this,"hovers",{value:t,configurable:!0})}onClick(t){t.stopPropagation();const e=this.observers;for(let t=0,i=e.length;t<i;t+=1){const i=e[t];void 0!==i.buttonDidPress&&i.buttonDidPress(this)}}init(t){super.init(t),Os.init(this,t)}}uo.IconRef=vn.define("IconRef",{type:Ns,observes:!0,init(){this.iconIndex=0},viewDidAnimate(t,e){e.opacity.tweening||this.iconIndex===this.owner.iconCount||(e.remove(),this.iconIndex>this.owner.iconCount&&this.owner.setFastener(this.name,null))}}),u([i.Animator({type:Number,state:.5,updateFlags:fn.NeedsLayout})],uo.prototype,"xAlign",void 0),u([i.Animator({type:Number,state:.5,updateFlags:fn.NeedsLayout})],uo.prototype,"yAlign",void 0),u([Ht({type:s.Length,state:s.Length.px(24),updateFlags:fn.NeedsLayout})],uo.prototype,"iconWidth",void 0),u([Ht({type:s.Length,state:s.Length.px(24),updateFlags:fn.NeedsLayout})],uo.prototype,"iconHeight",void 0),u([Ht({type:z,state:null,updateFlags:fn.NeedsLayout,didSetValue(t,e){if(null!==t){const e=this.owner.graphics.value;if(e instanceof Ts){const n=e.withFillColor(t);this.owner.graphics.setState(n,i.Affinity.Reflexive)}}}})],uo.prototype,"iconColor",void 0),u([Ht({extends:Es,state:null,type:Object,updateFlags:fn.NeedsLayout})],uo.prototype,"graphics",void 0),u([$i({extends:!0,didStartHovering(){if(this.owner.hovers){this.owner.modifyMood(Rt.default,[[Rt.hovering,1]]);const t=this.owner.getLook(At.timing);this.owner.backgroundColor.hasAffinity(i.Affinity.Intrinsic)&&this.owner.backgroundColor.setState(this.owner.getLookOr(At.backgroundColor,null),t,i.Affinity.Intrinsic)}},didStopHovering(){this.owner.modifyMood(Rt.default,[[Rt.hovering,void 0]]);const t=this.owner.getLook(At.timing);if(this.owner.backgroundColor.hasAffinity(i.Affinity.Intrinsic)){let e=this.owner.getLookOr(At.backgroundColor,null);null!==e&&(e=e.alpha(0)),this.owner.backgroundColor.setState(e,t,i.Affinity.Intrinsic)}}})],uo.prototype,"gesture",void 0);class po extends Kn{constructor(t){super(t),this.initDisclosureButton()}initDisclosureButton(){this.addClass("disclosure-button"),this.display.setState("flex",i.Affinity.Intrinsic),this.justifyContent.setState("center",i.Affinity.Intrinsic),this.alignItems.setState("center",i.Affinity.Intrinsic),this.flexGrow.setState(1,i.Affinity.Intrinsic),this.flexShrink.setState(0,i.Affinity.Intrinsic),this.cursor.setState("pointer",i.Affinity.Intrinsic);const t=this.appendChild(Qn,"icon");t.width.setState(24,i.Affinity.Intrinsic),t.height.setState(24,i.Affinity.Intrinsic),t.viewBox.setState("0 0 24 24",i.Affinity.Intrinsic);const e=t.appendChild("polygon","arrow");e.points.setState("0 4 -6 -2 -4.59 -3.41 0 1.17 4.59 -3.41 6 -2",i.Affinity.Intrinsic),e.transform.setState(s.Transform.translate(12,12).rotate(s.Angle.deg(0)),i.Affinity.Intrinsic)}get icon(){return this.getChild("icon")}get arrow(){return this.icon.getChild("arrow")}needsDisplay(t,e){return 0==(this.flags&fn.NeedsLayout)&&(t&=~fn.NeedsLayout),t}onLayout(t){super.onLayout(t);const e=this.disclosure.getPhase(),n=this.collapsedColor.value,o=this.expandedColor.value;if(null!==n&&null!==o&&this.arrow.fill.hasAffinity(i.Affinity.Intrinsic)){const t=n.interpolateTo(o);this.arrow.fill.setState(t(e),i.Affinity.Intrinsic)}const r=s.Transform.translate(12,12).rotate(s.Angle.deg(-180*e));this.arrow.transform.setState(r,i.Affinity.Intrinsic)}}u([Ht({type:gt,inherits:!0,updateFlags:fn.NeedsLayout})],po.prototype,"disclosure",void 0),u([Ht({type:z,inherits:!0,look:At.color,updateFlags:fn.NeedsLayout})],po.prototype,"collapsedColor",void 0),u([Ht({type:z,inherits:!0,look:At.accentColor,updateFlags:fn.NeedsLayout})],po.prototype,"expandedColor",void 0);class fo extends Kn{constructor(t){super(t),this.tokenState="expanded",this.onClickHead=this.onClickHead.bind(this),this.onClickBody=this.onClickBody.bind(this),this.onClickFoot=this.onClickFoot.bind(this),this.initToken()}initToken(){this.addClass("token"),this.position.setState("relative",i.Affinity.Intrinsic),this.height.setState(32,i.Affinity.Intrinsic),this.boxSizing.setState("content-box",i.Affinity.Intrinsic),this.userSelect.setState("none",i.Affinity.Intrinsic),this.shape.insertView()}initShape(t){t.addClass("shape"),t.setStyle("position","absolute"),t.setStyle("top","0"),t.setStyle("left","0"),this.head.insertView(t),this.headIcon.attachView(),this.body.insertView(t),this.foot.insertView(t),this.footIcon.attachView()}initHead(t){t.addClass("head"),t.fillRule.setState("evenodd",i.Affinity.Intrinsic),t.pointerEvents.setState("bounding-box",i.Affinity.Intrinsic),t.cursor.setState("pointer",i.Affinity.Intrinsic)}initHeadIcon(t){t.addClass("head-icon"),t.pointerEvents.setState("none",i.Affinity.Intrinsic)}initBody(t){t.addClass("body"),t.pointerEvents.setState("fill",i.Affinity.Intrinsic),t.cursor.setState("pointer",i.Affinity.Intrinsic)}initFoot(t){t.addClass("foot"),t.fillRule.setState("evenodd",i.Affinity.Intrinsic),t.pointerEvents.setState("bounding-box",i.Affinity.Intrinsic),t.cursor.setState("pointer",i.Affinity.Intrinsic)}initFootIcon(t){t.addClass("foot-icon"),t.pointerEvents.setState("none",i.Affinity.Intrinsic)}initLabelContainer(t){t.addClass("label"),t.display.setState("block",i.Affinity.Intrinsic),t.position.setState("absolute",i.Affinity.Intrinsic),t.top.setState(0,i.Affinity.Intrinsic),t.left.setState(0,i.Affinity.Intrinsic),t.overflowX.setState("hidden",i.Affinity.Intrinsic),t.overflowY.setState("hidden",i.Affinity.Intrinsic),t.pointerEvents.setState("none",i.Affinity.Intrinsic)}initLabel(t){t.position.setState("absolute",i.Affinity.Intrinsic),t.top.setState(0,i.Affinity.Intrinsic),t.bottom.setState(0,i.Affinity.Intrinsic),t.left.setState(0,i.Affinity.Intrinsic)}get expanded(){return"expanded"===this.tokenState||"expanding"===this.tokenState}get collapsed(){return"collapsed"===this.tokenState||"collapsing"===this.tokenState}get fillLook(){return At.accentColor}needsProcess(t,e){return 0!=(t&fn.NeedsLayout)&&(t|=fn.NeedsAnimate),t}onLayout(t){super.onLayout(t),this.layoutToken()}layoutToken(){const t=this.paddingTop.getStateOr(s.Length.zero()).pxValue(),e=this.paddingRight.getStateOr(s.Length.zero()).pxValue(),n=this.paddingBottom.getStateOr(s.Length.zero()).pxValue(),o=this.paddingLeft.getStateOr(s.Length.zero()).pxValue(),r=this.node.clientHeight,l=r-t-n,a=l/2,h=Math.sqrt(4+2*a*2),d=Math.asin(h/(a+2)),c=a/2,u=a,p=a/2,f=this.expandedPhase.value,g=this.icon.state,v=this.accessory.state;let y=0,w=0;const m=this.label.view;null!==m&&(y=m.node.clientWidth,w+=c+y+u);let b=0,C=0;null!==v&&(b=2*a,C+=b+p);let S=l;0!==f&&0!==w&&(S+=2+f*w);const A=S;0!==f&&0!==C&&(S+=2+f*C);const x=S+o+e,D=r;this.width.setState(S,i.Affinity.Intrinsic);const T=this.labelContainer.view;null!==T&&(T.display.setState(0!==f?"block":"none",i.Affinity.Intrinsic),T.left.setState(o+l+2+c,i.Affinity.Intrinsic),T.top.setState(t,i.Affinity.Intrinsic),T.width.setState(f*y,i.Affinity.Intrinsic),T.height.setState(l,i.Affinity.Intrinsic));const P=this.shape.view;null!==P&&(P.width.setState(x,i.Affinity.Intrinsic),P.height.setState(D,i.Affinity.Intrinsic),P.viewBox.setState("0 0 "+x+" "+D,i.Affinity.Intrinsic));const V=this.head.view;if(null!==V){const e=new rs;if(e.setPrecision(3),e.arc(o+a,t+a,a,-Math.PI/2,Math.PI/2*3),e.closePath(),null!==g&&!this.icon.embossed){const i=new ls(e),n=new s.R2Box(o,t,o+l,t+l);g.render(i,n),this.headIcon.removeView()}V.d.setState(e.toString(),i.Affinity.Intrinsic)}const I=this.headIcon.view;if(null!==I)if(null!==g&&this.icon.embossed){const e=new rs;e.setPrecision(3);const n=new ls(e),r=new s.R2Box(o,t,o+l,t+l);g.render(n,r),I.d.setState(e.toString(),i.Affinity.Intrinsic),this.headIcon.insertView()}else this.headIcon.removeView();const M=this.body.view;if(null!==M){const e=new rs;if(e.setPrecision(3),0!==f){const i=1-f;e.arc(o+a,t+a,a+2,-Math.PI/2+d,Math.PI/2-d),e.arc(o+A-a-2*i,t+a,a+2*i,Math.PI/2-i*d,-Math.PI/2+i*d,!0),e.closePath()}M.d.setState(e.toString(),i.Affinity.Intrinsic)}const R=this.foot.view;if(null!==R&&null!==v){const e=new rs;if(e.setPrecision(3),0!==f){const i=1-f;if(e.arc(o+A-a,t+a,a+2,-Math.PI/2+d,Math.PI/2-d),e.arc(o+S-a-2*i,t+a,a+2*i,Math.PI/2-i*d,-Math.PI/2+i*d,!0),e.closePath(),null!==v&&!this.accessory.embossed){const i=new ls(e),n=new s.R2Box(o+A+2,t,o+A+2+2*a,t+2*a);v.render(i,n),this.headIcon.removeView()}}R.d.setState(e.toString(),i.Affinity.Intrinsic)}const F=this.footIcon.view;if(null!==F)if(null!==v&&this.accessory.embossed){const e=new rs;if(e.setPrecision(3),0!==f){const i=new ls(e),n=new s.R2Box(o+A+2,t,o+A+2+l,t+l);v.render(i,n)}F.d.setState(e.toString(),i.Affinity.Intrinsic),this.footIcon.insertView()}else this.footIcon.removeView()}expand(t){"expanded"===this.tokenState&&1===this.expandedPhase.value||(t=void 0===t||!0===t?this.getLookOr(At.timing,!1):e.Timing.fromAny(t),"expanding"!==this.tokenState&&(this.willExpand(),this.onExpand()),!1!==t?1!==this.expandedPhase.value?this.expandedPhase.setState(1,t,i.Affinity.Intrinsic):setTimeout(this.didExpand.bind(this)):(this.expandedPhase.setState(1,i.Affinity.Intrinsic),this.didExpand()))}willExpand(){this.tokenState="expanding";const t=this.labelContainer.view;null!==t&&t.display.setState("block",i.Affinity.Intrinsic);const e=this.observers;for(let t=0,i=e.length;t<i;t+=1){const i=e[t];void 0!==i.tokenWillExpand&&i.tokenWillExpand(this)}}onExpand(){}didExpand(){this.tokenState="expanded",this.requireUpdate(fn.NeedsLayout);const t=this.observers;for(let e=0,i=t.length;e<i;e+=1){const i=t[e];void 0!==i.tokenDidExpand&&i.tokenDidExpand(this)}}collapse(t){"collapsed"===this.tokenState&&0===this.expandedPhase.value||(t=void 0===t||!0===t?this.getLookOr(At.timing,!1):e.Timing.fromAny(t),"collapsing"!==this.tokenState&&(this.willCollapse(),this.onCollapse()),!1!==t?0!==this.expandedPhase.value?this.expandedPhase.setState(0,t,i.Affinity.Intrinsic):setTimeout(this.didCollapse.bind(this)):(this.expandedPhase.setState(0,i.Affinity.Intrinsic),this.didCollapse()))}willCollapse(){this.tokenState="collapsing";const t=this.observers;for(let e=0,i=t.length;e<i;e+=1){const i=t[e];void 0!==i.tokenWillCollapse&&i.tokenWillCollapse(this)}}onCollapse(){const t=this.label.view;null!==t&&t.node.blur()}didCollapse(){this.tokenState="collapsed",this.requireUpdate(fn.NeedsLayout);const t=this.observers;for(let e=0,i=t.length;e<i;e+=1){const i=t[e];void 0!==i.tokenDidCollapse&&i.tokenDidCollapse(this)}}toggle(t){const e=this.tokenState;"collapsed"===e||"collapsing"===e?this.expand(t):"expanded"!==e&&"expanding"!==e||this.collapse(t)}onClickHead(t){this.toggle();const e=this.label.view;null!==e&&this.expanded&&e.node.focus(),this.didPressHead()}didPressHead(){const t=this.observers;for(let e=0,i=t.length;e<i;e+=1){const i=t[e];void 0!==i.tokenDidPressHead&&i.tokenDidPressHead(this)}}onClickBody(t){this.didPressBody()}didPressBody(){const t=this.observers;for(let e=0,i=t.length;e<i;e+=1){const i=t[e];void 0!==i.tokenDidPressBody&&i.tokenDidPressBody(this)}}onClickFoot(t){this.didPressFoot()}didPressFoot(){const t=this.observers;for(let e=0,i=t.length;e<i;e+=1){const i=t[e];void 0!==i.tokenDidPressFoot&&i.tokenDidPressFoot(this)}}init(t){super.init(t)}}u([i.Animator({type:Number,state:1,updateFlags:fn.NeedsLayout,didTransition(t){const e=this.owner.tokenState;"expanding"===e&&1===t?this.owner.didExpand():"collapsing"===e&&0===t&&this.owner.didCollapse()}})],fo.prototype,"expandedPhase",void 0),u([vn({key:!0,type:Qn,binds:!0,didAttachView(t){this.owner.initShape(t)}})],fo.prototype,"shape",void 0),u([vn({key:!0,type:Qn.forTag("path"),observes:!0,didAttachView(t){this.owner.initHead(t),this.owner.headGesture.setView(t)},willDetachView(t){this.owner.headGesture.setView(null)},viewDidMount(t){t.on("click",this.owner.onClickHead)},viewWillUnmount(t){t.off("click",this.owner.onClickHead)},viewDidApplyTheme(t,e,n,s){s.fill.setState(t.getOr(this.owner.fillLook,e,null),n,i.Affinity.Intrinsic);const o=this.owner.headIcon.view;if(null!==o&&o.fill.hasAffinity(i.Affinity.Intrinsic)){const s=t.getOr(this.owner.fillLook,e.updated(Rt.embossed,1),null);o.fill.setState(s,n,i.Affinity.Intrinsic)}}})],fo.prototype,"head",void 0),u([$i({didStartHovering(){const t=this.view;t.modifyMood(Rt.default,[[Rt.hovering,1]]);const e=t.getLook(At.timing);t.fill.setState(t.getLookOr(this.owner.fillLook,null),e,i.Affinity.Intrinsic);const n=this.owner.headIcon.view;if(null!==n&&n.fill.hasAffinity(i.Affinity.Intrinsic)){const s=t.getLookOr(this.owner.fillLook,t.mood.getState().updated(Rt.embossed,1),null);n.fill.setState(s,e,i.Affinity.Intrinsic)}},didStopHovering(){const t=this.view;t.modifyMood(Rt.default,[[Rt.hovering,void 0]]);const e=t.getLook(At.timing);t.fill.setState(t.getLookOr(this.owner.fillLook,null),e,i.Affinity.Intrinsic);const n=this.owner.headIcon.view;if(null!==n&&n.fill.hasAffinity(i.Affinity.Intrinsic)){const s=t.getLookOr(this.owner.fillLook,t.mood.getState().updated(Rt.embossed,1),null);n.fill.setState(s,e,i.Affinity.Intrinsic)}},didBeginPress(t,e){"mouse"!==t.inputType&&this.beginHover(t,e)},didMovePress(t,e){t.isRunaway()&&this.cancelPress(t,e)},didEndPress(t,e){"mouse"===t.inputType&&this.view.clientBounds.contains(t.x,t.y)||this.endHover(t,e)},didCancelPress(t,e){"mouse"===t.inputType&&this.view.clientBounds.contains(t.x,t.y)||this.endHover(t,e)}})],fo.prototype,"headGesture",void 0),u([vn({key:!0,type:Qn.forTag("path"),didAttachView(t){this.owner.initHeadIcon(t)},insertChild(t,e,i,n){const s=this.owner.shape.view;null!==s&&s.insertChild(e,this.owner.body.view,n)}})],fo.prototype,"headIcon",void 0),u([i.Property({type:Object,state:null,updateFlags:fn.NeedsLayout,embossed:!0})],fo.prototype,"icon",void 0),u([vn({key:!0,type:Qn.forTag("path"),observes:!0,didAttachView(t){this.owner.initBody(t),this.owner.bodyGesture.setView(t)},willDetachView(t){this.owner.bodyGesture.setView(null)},viewDidMount(t){t.on("click",this.owner.onClickBody)},viewWillUnmount(t){t.off("click",this.owner.onClickBody)},viewDidApplyTheme(t,e,n,s){s.fill.setState(t.getOr(this.owner.fillLook,e,null),n,i.Affinity.Intrinsic);const o=this.owner.label.view;null!==o&&o.color.hasAffinity(i.Affinity.Intrinsic)&&o.color.setState(t.getOr(At.backgroundColor,e,null),n,i.Affinity.Intrinsic)}})],fo.prototype,"body",void 0),u([$i({didStartHovering(){const t=this.view;t.modifyMood(Rt.default,[[Rt.hovering,1]]);const e=t.getLook(At.timing);t.fill.setState(t.getLookOr(this.owner.fillLook,null),e,i.Affinity.Intrinsic);const n=this.owner.label.view;null!==n&&n.color.hasAffinity(i.Affinity.Intrinsic)&&n.color.setState(t.getLookOr(At.backgroundColor,null),e,i.Affinity.Intrinsic)},didStopHovering(){const t=this.view;t.modifyMood(Rt.default,[[Rt.hovering,void 0]]);const e=t.getLook(At.timing);t.fill.setState(t.getLookOr(this.owner.fillLook,null),e,i.Affinity.Intrinsic);const n=this.owner.label.view;null!==n&&n.color.hasAffinity(i.Affinity.Intrinsic)&&n.color.setState(t.getLookOr(At.backgroundColor,null),e,i.Affinity.Intrinsic)},didBeginPress(t,e){"mouse"!==t.inputType&&this.beginHover(t,e)},didMovePress(t,e){t.isRunaway()&&this.cancelPress(t,e)},didEndPress(t,e){"mouse"===t.inputType&&this.view.clientBounds.contains(t.x,t.y)||this.endHover(t,e)},didCancelPress(t,e){"mouse"===t.inputType&&this.view.clientBounds.contains(t.x,t.y)||this.endHover(t,e)}})],fo.prototype,"bodyGesture",void 0),u([vn({key:!0,type:Qn.forTag("path"),observes:!0,didAttachView(t){this.owner.initFoot(t),this.owner.footGesture.setView(t)},willDetachView(t){this.owner.footGesture.setView(null)},viewDidMount(t){t.on("click",this.owner.onClickFoot)},viewWillUnmount(t){t.off("click",this.owner.onClickFoot)},viewDidApplyTheme(t,e,n,s){s.fill.setState(t.getOr(this.owner.fillLook,e,null),n,i.Affinity.Intrinsic);const o=this.owner.footIcon.view;if(null!==o&&o.fill.hasAffinity(i.Affinity.Intrinsic)){const s=t.getOr(this.owner.fillLook,e.updated(Rt.embossed,1),null);o.fill.setState(s,n,i.Affinity.Intrinsic)}}})],fo.prototype,"foot",void 0),u([$i({didStartHovering(){const t=this.view;t.modifyMood(Rt.default,[[Rt.hovering,1]]);const e=t.getLook(At.timing);t.fill.setState(t.getLookOr(this.owner.fillLook,null),e,i.Affinity.Intrinsic);const n=this.owner.footIcon.view;if(null!==n&&n.fill.hasAffinity(i.Affinity.Intrinsic)){const s=t.getLookOr(this.owner.fillLook,t.mood.getState().updated(Rt.embossed,1),null);n.fill.setState(s,e,i.Affinity.Intrinsic)}},didStopHovering(){const t=this.view;t.modifyMood(Rt.default,[[Rt.hovering,void 0]]);const e=t.getLook(At.timing);t.fill.setState(t.getLookOr(this.owner.fillLook,null),e,i.Affinity.Intrinsic);const n=this.owner.footIcon.view;if(null!==n&&n.fill.hasAffinity(i.Affinity.Intrinsic)){const s=t.getLookOr(this.owner.fillLook,t.mood.getState().updated(Rt.embossed,1),null);n.fill.setState(s,e,i.Affinity.Intrinsic)}},didBeginPress(t,e){"mouse"!==t.inputType&&this.beginHover(t,e)},didMovePress(t,e){t.isRunaway()&&this.cancelPress(t,e)},didEndPress(t,e){"mouse"===t.inputType&&this.view.clientBounds.contains(t.x,t.y)||this.endHover(t,e)},didCancelPress(t,e){"mouse"===t.inputType&&this.view.clientBounds.contains(t.x,t.y)||this.endHover(t,e)}})],fo.prototype,"footGesture",void 0),u([vn({key:!0,type:Qn.forTag("path"),didAttachView(t){this.owner.initFootIcon(t)},insertChild(t,e,i,n){const s=this.owner.shape.view;null!==s&&s.appendChild(e,n)}})],fo.prototype,"footIcon",void 0),u([i.Property({type:Object,state:null,updateFlags:fn.NeedsLayout,init(){this.embossed=!0}})],fo.prototype,"accessory",void 0),u([vn({key:!0,type:Kn,binds:!0,didAttachView(t){this.owner.initLabelContainer(t)}})],fo.prototype,"labelContainer",void 0),u([vn({key:!0,type:Kn,didAttachView(t){if(null===t.parent){this.owner.labelContainer.insertView();const e=this.owner.labelContainer.view;null!==e&&e.appendChild(t)}this.owner.initLabel(t)}})],fo.prototype,"label",void 0);class go extends fo{constructor(t){super(t),this.onInputUpdate=this.onInputUpdate.bind(this),this.onInputChange=this.onInputChange.bind(this),this.onInputKey=this.onInputKey.bind(this)}initToken(){this.stylesheet.insertView(),super.initToken(),this.addClass("input-token"),this.label.attachView()}initStylesheet(t){const e=t.sheet;if(null!==e){const t=go.PlaceholderRule.create(e);e.setFastener("placeholder",t)}}initLabel(t){super.initLabel(t),t.paddingTop.setState(0,i.Affinity.Intrinsic),t.paddingRight.setState(0,i.Affinity.Intrinsic),t.paddingBottom.setState(0,i.Affinity.Intrinsic),t.paddingLeft.setState(0,i.Affinity.Intrinsic),t.borderTopStyle.setState("none",i.Affinity.Intrinsic),t.borderRightStyle.setState("none",i.Affinity.Intrinsic),t.borderBottomStyle.setState("none",i.Affinity.Intrinsic),t.borderLeftStyle.setState("none",i.Affinity.Intrinsic),t.boxSizing.setState("border-box",i.Affinity.Intrinsic),t.backgroundColor.setState(z.transparent(),i.Affinity.Intrinsic),t.appearance.setState("none",i.Affinity.Intrinsic),t.outlineStyle.setState("none",i.Affinity.Intrinsic),t.pointerEvents.setState("auto",i.Affinity.Intrinsic)}get placeholderLook(){return At.neutralColor}onApplyTheme(t,e,n){super.onApplyTheme(t,e,n);const s=this.stylesheet.view;if(null!==s){const o=s.getFastener("placeholder",Hn);null!==o&&o.color.setState(t.getOr(this.placeholderLook,e,null),n,i.Affinity.Intrinsic)}const o=this.label.view;null!==o&&o.font(t.getOr(At.font,e,null),!1,i.Affinity.Intrinsic)}onInputUpdate(t){const e=this.label.view;null!==e&&this.didUpdateInput(e)}didUpdateInput(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.tokenDidUpdateInput&&n.tokenDidUpdateInput(t,this)}}onInputChange(t){const e=this.label.view;null!==e&&this.didChangeInput(e)}didChangeInput(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.tokenDidChangeInput&&n.tokenDidChangeInput(t,this)}}onInputKey(t){const e=this.label.view;null!==e&&"Enter"===t.key&&this.didAcceptInput(e)}didAcceptInput(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.tokenDidAcceptInput&&n.tokenDidAcceptInput(t,this)}}init(t){super.init(t)}}go.PlaceholderRule=Hn.define("PlaceholderRule",{css:"::placeholder {}"}),u([vn({key:!0,type:_n,binds:!0,observes:!0,viewDidMount(t){this.owner.initStylesheet(t)}})],go.prototype,"stylesheet",void 0),u([vn({type:Kn.forTag("input"),observes:!0,didAttachView(t){if(null===t.parent){this.owner.labelContainer.insertView();const e=this.owner.labelContainer.view;null!==e&&e.appendChild(t)}this.owner.initLabel(t)},viewDidMount(t){t.on("input",this.owner.onInputUpdate),t.on("change",this.owner.onInputChange),t.on("keydown",this.owner.onInputKey)},viewWillUnmount(t){t.off("input",this.owner.onInputUpdate),t.off("change",this.owner.onInputChange),t.off("keydown",this.owner.onInputKey)}})],go.prototype,"label",void 0);class vo{constructor(t,e,i,n,s,o,r,l,a,h,d){this.key=t,this.grow=e,this.shrink=i,this.basis=n,this.optional=s,this.persistent=o,this.textColor=r,this.width=l,this.left=a,this.right=h,this.hidden=d}withFlex(t,e,i){return i=void 0!==i?s.Length.fromAny(i):this.basis,this.copy(this.key,t,e,i,this.optional,this.persistent,this.textColor,this.width,this.left,this.right,this.hidden)}asOptional(t){return this.copy(this.key,this.grow,this.shrink,this.basis,t,this.persistent,this.textColor,this.width,this.left,this.right,this.hidden)}asPersistent(t){return this.copy(this.key,this.grow,this.shrink,this.basis,this.optional,t,this.textColor,this.width,this.left,this.right,this.hidden)}withTextColor(t){return null===t||t instanceof At||(t=z.fromAny(t)),this.copy(this.key,this.grow,this.shrink,this.basis,this.optional,this.persistent,t,this.width,this.left,this.right,this.hidden)}asHidden(t){return this.copy(this.key,this.grow,this.shrink,this.basis,this.optional,this.persistent,this.textColor,this.width,this.left,this.right,t)}resized(t,e,i,n){return null!==t&&(t=s.Length.fromAny(t)),null!==e&&(e=s.Length.fromAny(e)),null!==i&&(i=s.Length.fromAny(i)),void 0===n&&(n=this.hidden),this.copy(this.key,this.grow,this.shrink,this.basis,this.optional,this.persistent,this.textColor,t,e,i,n)}copy(t,e,i,n,s,o,r,l,a,h,d){return new vo(t,e,i,n,s,o,r,l,a,h,d)}equivalentTo(t,i){return this===t||t instanceof vo&&(this.key===t.key&&this.grow===t.grow&&this.shrink===t.shrink&&this.basis.equivalentTo(t.basis,i)&&this.optional===t.optional&&this.persistent===t.persistent&&e.Equivalent(this.textColor,t.textColor,i))}equals(t){return this===t||t instanceof vo&&(this.key===t.key&&this.grow===t.grow&&this.shrink===t.shrink&&this.basis.equals(t.basis)&&this.optional===t.optional&&this.persistent===t.persistent&&e.Equals(this.textColor,t.textColor)&&e.Equals(this.width,t.width)&&e.Equals(this.left,t.left)&&e.Equals(this.right,t.right)&&this.hidden===t.hidden)}debug(t){return t=t.write("ColLayout").write(46).write("create").write(40).debug(this.key).write(", ").debug(this.grow).write(", ").debug(this.shrink).write(", ").debug(this.basis).write(41),this.optional&&(t=t.write(46).write("asOptional").write(40).debug(this.optional).write(41)),this.persistent&&(t=t.write(46).write("asPersistent").write(40).debug(this.persistent).write(41)),this.textColor&&(t=t.write(46).write("withTextColor").write(40).debug(this.textColor).write(41)),(null!==this.width||null!==this.left||null!==this.right||this.hidden)&&(t=t.write(46).write("resized").write(40).debug(this.width).write(", ").debug(this.left).write(", ").debug(this.right).write(", ").debug(this.hidden).write(41)),t}toString(){return o.Format.debug(this)}static create(t,e,i,n,o,r,l){return void 0===e&&(e=0),void 0===i&&(i=1),n=void 0!==n?s.Length.fromAny(n):s.Length.zero(),void 0===o&&(o=!1),void 0===r&&(r=!1),void 0===l&&(l=null),null===l||l instanceof At||(l=z.fromAny(l)),new vo(t,e,i,n,o,r,l,null,null,null,!1)}static fromAny(t){if(null==t||t instanceof vo)return t;if("object"==typeof t&&null!==t)return vo.fromInit(t);throw new TypeError(""+t)}static fromInit(t){let e=t.key;void 0===e&&(e="");let i=t.grow;void 0===i&&(i=0);let n=t.shrink;void 0===n&&(n=1);let o=t.basis;o=void 0!==o?s.Length.fromAny(o):s.Length.zero();let r=t.optional;void 0===r&&(r=!1);let l=t.persistent;void 0===l&&(l=!1);let a=t.textColor;void 0===a&&(a=null),null===a||a instanceof At||(a=z.fromAny(a));let h=t.width;h=null!=h?s.Length.fromAny(h):null;let d=t.left;d=null!=d?s.Length.fromAny(d):null;let c=t.right;c=null!=c?s.Length.fromAny(c):null;let u=t.hidden;return void 0===u&&(u=!1),new vo(e,i,n,o,r,l,a,h,d,c,u)}}class yo{constructor(t,e,i,n,s){this.width=t,this.left=e,this.right=i,this.colSpacing=n,this.cols=s}getCol(t){const e=this.cols;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];if(t===n.key)return n}return null}resized(t,i,n,o){if(t=s.Length.fromAny(t),void 0===i?i=this.left:null!==i&&(i=s.Length.fromAny(i)),void 0===n?n=this.right:null!==n&&(n=s.Length.fromAny(n)),void 0===o?o=this.colSpacing:null!==o&&(o=s.Length.fromAny(o)),e.Equals(this.width,t)&&e.Equals(this.left,i)&&e.Equals(this.right,n)&&e.Equals(this.colSpacing,o))return this;{const e=this.cols,s=e.length,r=new Array(s),l=t.pxValue(),a=null!==i?i.pxValue(l):0,h=null!==n?n.pxValue(l):0,d=null!==o?o.pxValue(l):0;let c=0,u=0,p=0,f=a+h,g=a;for(let t=0;t<s;t+=1){0!==t&&(f+=d,g+=d);const i=e[t],n=i.basis.pxValue(l);r[t]=i.resized(n,g,l-n-g,!1),c+=i.grow,u+=i.shrink,i.optional&&(p+=1),f+=n,g+=n}if(f>l&&p>0){let t=s-1;for(;t>=0&&p>0;){const e=r[t],i=e.width.pxValue();if(e.optional&&(r[t]=e.resized(0,g,l-g,!0),c-=e.grow,u-=e.shrink,p-=1,f-=i),g-=i,0!==t&&(f-=d,g-=d),f<=l)break;t-=1}for(t+=1;t<s;){const e=r[t];if(!e.optional){f+=d,g+=d;const i=e.basis.pxValue(l);r[t]=e.resized(i,g,l-i-g),g+=i}t+=1}}if(f<l&&c>0){const t=l-f;let e=a,i=0;for(let n=0;n<s;n+=1){const s=r[n];if(s.hidden)r[n]=s.resized(0,e+d,l-e-d);else{0!==i&&(e+=d);const o=s.basis.pxValue(l)+t*(s.grow/c);r[n]=s.resized(o,e,l-o-e),e+=o,i+=1}}}else if(f>l&&u>0){const t=f-l;let e=a,i=0;for(let n=0;n<s;n+=1){const s=r[n];if(s.hidden)r[n]=s.resized(0,e+d,l-e-d);else{0!==i&&(e+=d);const o=s.basis.pxValue(l)-t*(s.shrink/u);r[n]=s.resized(o,e,l-o-e),e+=o,i+=1}}}return new yo(t,i,n,o,r)}}equivalentTo(t,e){if(this===t)return!0;if(t instanceof yo){const i=this.cols,n=t.cols,s=i.length;if(s===n.length){for(let t=0;t<s;t+=1)if(!i[t].equivalentTo(n[t],e))return!1;return!0}}return!1}equals(t){return this===t||t instanceof yo&&(e.Equals(this.width,t.width)&&e.Equals(this.left,t.left)&&e.Equals(this.right,t.right)&&e.Equals(this.colSpacing,t.colSpacing)&&e.Arrays.equal(this.cols,t.cols))}debug(t){t=t.write("TableLayout").write(46).write("of").write(40);for(let e=0,i=this.cols.length;e<i;e+=1)0!==e&&(t=t.write(", ")),t=t.debug(this.cols[e]);return t=t.write(41),null===this.width&&null===this.left&&null===this.right&&null===this.colSpacing||(t=t.write(46).write("resized").write(40).debug(this.width).write(", ").debug(this.left).write(", ").debug(this.right).write(", ").debug(this.colSpacing).write(41)),t}toString(){return o.Format.debug(this)}static of(...t){const e=t.length,i=new Array(e);for(let n=0;n<e;n+=1)i[n]=vo.fromAny(t[n]);return new yo(null,null,null,null,i)}static create(t){return new yo(null,null,null,null,t)}static fromAny(t){if(null==t||t instanceof yo)return t;if("object"==typeof t&&null!==t)return yo.fromInit(t);throw new TypeError(""+t)}static fromInit(t){let e=t.width;e=null!=e?s.Length.fromAny(e):null;let i=t.left;i=null!=i?s.Length.fromAny(i):null;let n=t.right;n=null!=n?s.Length.fromAny(n):null;let o=t.colSpacing;o=null!=o?s.Length.fromAny(o):null;const r=t.cols.length,l=new Array(r);for(let e=0;e<r;e+=1)l[e]=vo.fromAny(t.cols[e]);return new yo(e,i,n,o,l)}}class wo extends Kn{constructor(t){super(t),this.initCell()}initCell(){this.addClass("cell"),this.overflowX.setState("hidden",i.Affinity.Intrinsic),this.overflowY.setState("hidden",i.Affinity.Intrinsic)}onPress(t,e){}didPress(t,e){this.callObservers("viewDidPress",t,e,this)}onLongPress(t){}didLongPress(t){this.callObservers("viewDidLongPress",t,this)}}class mo extends wo{initCell(){super.initCell(),this.addClass("cell-text")}}u([vn({key:!0,type:Kn,binds:!0,willAttachView(t){this.owner.callObservers("viewWillAttachContent",t,this.owner)},didDetachView(t){this.owner.callObservers("viewDidDetachContent",t,this.owner)},create(t){const e=Kn.fromTag("span");return e.alignSelf.setState("center",i.Affinity.Intrinsic),e.whiteSpace.setState("nowrap",i.Affinity.Intrinsic),e.textOverflow.setState("ellipsis",i.Affinity.Intrinsic),e.overflowX.setState("hidden",i.Affinity.Intrinsic),e.overflowY.setState("hidden",i.Affinity.Intrinsic),void 0!==t&&e.text(t),e},fromAny(t){return"string"==typeof t?this.create(t):Kn.fromAny(t)}})],mo.prototype,"content",void 0);class bo extends wo{constructor(t){super(t),this.initSvg()}initCell(){super.initCell(),this.addClass("cell-icon")}initSvg(){const t=this.createSvgView();null!==t&&this.setChild("svg",t)}createSvgView(){return Ns.create()}get svgView(){const t=this.getChild("svg");return t instanceof Ns?t:null}onInsertChild(t,e){super.onInsertChild(t,e),"svg"===t.key&&t instanceof Ns&&this.onInsertSvg(t)}onInsertSvg(t){t.xAlign.setInherits(!0),t.yAlign.setInherits(!0),t.iconWidth.setInherits(!0),t.iconHeight.setInherits(!0),t.iconColor.setInherits(!0),t.graphics.setInherits(!0),t.setStyle("position","absolute")}onApplyTheme(t,e,n){if(super.onApplyTheme(t,e,n),!this.graphics.inherited){const s=this.graphics.value;if(s instanceof Ds){const o=s.withTheme(t,e);this.graphics.setState(o,!!s.isThemed()&&n,i.Affinity.Reflexive)}}}onResize(t){super.onResize(t),this.requireUpdate(fn.NeedsLayout)}needsDisplay(t,e){return 0==(this.flags&fn.NeedsLayout)&&(t&=~fn.NeedsLayout),t}onLayout(t){super.onLayout(t),this.layoutIcon()}layoutIcon(){const t=this.svgView;if(null!==t&&(t.width.hasAffinity(i.Affinity.Intrinsic)||t.height.hasAffinity(i.Affinity.Intrinsic)||t.viewBox.hasAffinity(i.Affinity.Intrinsic))){let e=this.width.value;e=e instanceof s.Length?e.pxValue():this.node.offsetWidth;let n=this.height.value;n=n instanceof s.Length?n.pxValue():this.node.offsetHeight,t.width.setState(e,i.Affinity.Intrinsic),t.height.setState(n,i.Affinity.Intrinsic),t.viewBox.setState("0 0 "+e+" "+n,i.Affinity.Intrinsic)}}}u([i.Animator({type:Number,state:.5,updateFlags:fn.NeedsLayout})],bo.prototype,"xAlign",void 0),u([i.Animator({type:Number,state:.5,updateFlags:fn.NeedsLayout})],bo.prototype,"yAlign",void 0),u([Ht({type:s.Length,state:null,updateFlags:fn.NeedsLayout})],bo.prototype,"iconWidth",void 0),u([Ht({type:s.Length,state:null,updateFlags:fn.NeedsLayout})],bo.prototype,"iconHeight",void 0),u([Ht({type:z,state:null,updateFlags:fn.NeedsLayout,didSetValue(t,e){if(null!==t){const e=this.owner.graphics.value;if(e instanceof Ts){const n=e.withFillColor(t);this.owner.graphics.setState(n,i.Affinity.Reflexive)}}}})],bo.prototype,"iconColor",void 0),u([Ht({extends:Es,type:Object,state:null,updateFlags:fn.NeedsLayout,willSetValue(t,e){this.owner.callObservers("viewWillSetGraphics",t,e,this.owner)},didSetValue(t,e){this.owner.requireUpdate(fn.NeedsRasterize|fn.NeedsComposite),this.owner.callObservers("viewDidSetGraphics",t,e,this.owner)}})],bo.prototype,"graphics",void 0);class Co extends wo{initCell(){super.initCell(),this.addClass("cell-disclosure"),this.button.insertView()}didPress(t,e){t.preventDefault();const i=this.disclosure.superFastener;i instanceof $t&&i.toggle(),super.didPress(t,e)}}u([Ht({type:gt,inherits:!0})],Co.prototype,"disclosure",void 0),u([vn({key:!0,type:po,binds:!0})],Co.prototype,"button",void 0);class So extends A{}class Ao extends So{}u([i.Property({state:null,willSetState(t,e){this.owner.callObservers("traitWillSetContent",t,e,this.owner)},didSetState(t,e){this.owner.callObservers("traitDidSetContent",t,e,this.owner)}})],Ao.prototype,"content",void 0);class xo extends So{}u([i.Property({state:null,willSetState(t,e){this.owner.callObservers("traitWillSetIcon",t,e,this.owner)},didSetState(t,e){this.owner.callObservers("traitDidSetIcon",t,e,this.owner)}})],xo.prototype,"icon",void 0);class Do extends Qs{static fromTrait(t){return t instanceof Ao?new To:t instanceof xo?new Po:new Do}}u([eo({traitType:So,willAttachTrait(t){this.owner.callObservers("controllerWillAttachCellTrait",t,this.owner)},didDetachTrait(t){this.owner.callObservers("controllerDidDetachCellTrait",t,this.owner)},viewType:wo,observesView:!0,willAttachView(t){this.owner.callObservers("controllerWillAttachCellView",t,this.owner)},didDetachView(t){this.owner.callObservers("controllerDidDetachCellView",t,this.owner)},viewDidPress(t,e,i){this.owner.callObservers("controllerDidPressCellView",t,e,i,this.owner)},viewDidLongPress(t,e){this.owner.callObservers("controllerDidLongPressCellView",t,e,this.owner)}})],Do.prototype,"cell",void 0);class To extends Do{createContentView(t,e){return"function"==typeof t?t(e):t}setContentView(t,e){const i=this.cell.view;if(null!==i){const n=null!==t?this.createContentView(t,e):null;i.content.setView(n)}}}u([eo({extends:!0,traitType:Ao,observesTrait:!0,initTrait(t){this.owner.setContentView(t.content.state,t)},deinitTrait(t){this.owner.setContentView(null,t)},traitDidSetContent(t,e,i){this.owner.setContentView(t,i)},viewType:mo,observesView:!0,initView(t){this.owner.content.setView(t.content.view);const e=this.trait;null!==e&&this.owner.setContentView(e.content.state,e)},deinitView(t){this.owner.content.setView(null)},viewWillAttachContent(t){this.owner.content.setView(t)},viewDidDetachContent(t){this.owner.content.setView(null)}})],To.prototype,"cell",void 0),u([vn({type:Kn,willAttachView(t){this.owner.callObservers("controllerWillAttachCellContentView",t,this.owner)},didDetachView(t){this.owner.callObservers("controllerDidDetachCellContentView",t,this.owner)}})],To.prototype,"content",void 0);class Po extends Do{setIcon(t){const e=this.cell.view;null!==e&&e.graphics.setState(t)}}u([eo({extends:!0,traitType:xo,observesTrait:!0,initTrait(t){this.owner.setIcon(t.icon.state)},deinitTrait(t){this.owner.setIcon(null)},traitDidSetIcon(t,e){this.owner.setIcon(t)},viewType:bo,observesView:!0,initView(t){const e=this.trait;null!==e&&this.owner.setIcon(e.icon.state)},viewWillSetGraphics(t,e){this.owner.callObservers("controllerWillSetCellIcon",t,e,this.owner)},viewDidSetGraphics(t,e){this.owner.callObservers("controllerDidSetCellIcon",t,e,this.owner)}})],Po.prototype,"cell",void 0);class Vo extends Kn{constructor(t){super(t),this.initLeaf()}initLeaf(){this.addClass("leaf"),this.position.setState("relative",i.Affinity.Intrinsic),this.overflowX.setState("hidden",i.Affinity.Intrinsic),this.overflowY.setState("hidden",i.Affinity.Intrinsic);const t=this.highlight.getPhase(),e=this.hover.getPhase(),n=Math.max(t,e);this.modifyMood(Rt.default,[[Rt.transparent,1-n],[Rt.hovering,e*(1-t)],[Rt.selected,t]],!1)}getCell(t,e){void 0===e&&(e=wo);const i=this.getChild(t);return i instanceof e?i:null}getOrCreateCell(t,e){let i=this.getChild(t,e);return null===i&&(i=e.create(),this.setChild(t,i)),i}setCell(t,e){this.setChild(t,e)}onLayout(t){super.onLayout(t),this.layoutLeaf()}layoutLeaf(){const t=this.rowHeight.value;null!==t&&this.height.setState(t,i.Affinity.Intrinsic)}displayChildren(t,e,i){0!=(t&fn.NeedsLayout)?this.layoutChildViews(t,e,i):super.displayChildren(t,e,i)}layoutChildViews(t,e,n){const s=this.layout.state,o=this.height.state,r=this.stretch.getPhaseOr(1);super.displayChildren(t,e,(function(t,e,l){if(t instanceof wo){const e=t.key,n=null!==s&&void 0!==e?s.getCol(e):null;if(null!==n){t.display.setState(n.hidden?"none":"flex",i.Affinity.Intrinsic),t.left.setState(n.left,i.Affinity.Intrinsic),t.width.setState(n.width,i.Affinity.Intrinsic),t.height.setState(o,i.Affinity.Intrinsic);const e=n.textColor;e instanceof At?t.color.setLook(e,i.Affinity.Intrinsic):t.color.setState(e,i.Affinity.Intrinsic),n.persistent||t.opacity.setState(r,i.Affinity.Intrinsic)}else t.display.setState("none",i.Affinity.Intrinsic),t.left.setState(null,i.Affinity.Intrinsic),t.width.setState(null,i.Affinity.Intrinsic),t.height.setState(null,i.Affinity.Intrinsic)}n.call(this,t,e,l)}))}glow(t){if(t.detail instanceof ro&&(t.detail.fade(t.x,t.y),t.detail=void 0),void 0===t.detail){const e="mouse"===t.inputType?0:100;t.detail=this.prependChild(ro),t.detail.glow(t.x,t.y,void 0,e)}}}u([i.Property({type:yo,inherits:!0,state:null,updateFlags:fn.NeedsLayout})],Vo.prototype,"layout",void 0),u([i.Property({type:Number,inherits:!0,state:0,updateFlags:fn.NeedsLayout})],Vo.prototype,"depth",void 0),u([te({type:s.Length,inherits:!0,state:null,updateFlags:fn.NeedsLayout})],Vo.prototype,"rowSpacing",void 0),u([te({type:s.Length,inherits:!0,state:null,updateFlags:fn.NeedsLayout})],Vo.prototype,"rowHeight",void 0),u([Ht({type:gt,inherits:!0,state:null,updateFlags:fn.NeedsLayout})],Vo.prototype,"stretch",void 0),u([i.Property({type:Boolean,inherits:!0,state:!1})],Vo.prototype,"hovers",void 0),u([Ht({type:ct,state:ct.unfocused(),didSetValue(t,e){const n=this.owner.highlight.getPhase(),s=t.phase,o=Math.max(n,s);this.owner.modifyMood(Rt.default,[[Rt.transparent,1-o],[Rt.hovering,s*(1-n)],[Rt.selected,n]],!1),0!==o?this.owner.backgroundColor.setLook(At.backgroundColor,i.Affinity.Intrinsic):(this.owner.backgroundColor.setLook(null,i.Affinity.Intrinsic),this.owner.backgroundColor.setState(null,i.Affinity.Intrinsic))}})],Vo.prototype,"hover",void 0),u([Ht({type:ct,state:ct.unfocused(),willFocus(){this.owner.callObservers("viewWillHighlight",this.owner)},didFocus(){this.owner.callObservers("viewDidHighlight",this.owner)},willUnfocus(){this.owner.callObservers("viewWillUnhighlight",this.owner)},didUnfocus(){this.owner.callObservers("viewDidUnhighlight",this.owner)},didSetValue(t,e){const n=t.phase,s=this.owner.hover.getPhase(),o=Math.max(n,s);this.owner.modifyMood(Rt.default,[[Rt.transparent,1-o],[Rt.hovering,s*(1-n)],[Rt.selected,n]],!1),0!==o?this.owner.backgroundColor.setLook(At.backgroundColor,i.Affinity.Intrinsic):(this.owner.backgroundColor.setLook(null,i.Affinity.Intrinsic),this.owner.backgroundColor.setState(null,i.Affinity.Intrinsic))}})],Vo.prototype,"highlight",void 0),u([yn({type:wo,binds:!0,initView(t){t.display.setState("none",i.Affinity.Intrinsic),t.position.setState("absolute",i.Affinity.Intrinsic),t.left.setState(0,i.Affinity.Intrinsic),t.top.setState(0,i.Affinity.Intrinsic),t.width.setState(0,i.Affinity.Intrinsic),t.height.setState(this.owner.height.state,i.Affinity.Intrinsic)},willAttachView(t,e){this.owner.callObservers("viewWillAttachCell",t,e,this.owner)},didDetachView(t){this.owner.callObservers("viewDidDetachCell",t,this.owner)}})],Vo.prototype,"cells",void 0),u([i.Property({type:Boolean,inherits:!0,state:!0})],Vo.prototype,"glows",void 0),u([$i({self:!0,didBeginPress(t,e){this.owner.glows.state&&this.owner.glow(t)},didMovePress(t,e){t.isRunaway()?this.cancelPress(t,e):this.owner.clientBounds.contains(t.x,t.y)||(t.clearHoldTimer(),this.beginHover(t,e),t.detail instanceof ro&&(t.detail.fade(t.x,t.y),t.detail=void 0))},didEndPress(t,e){this.owner.clientBounds.contains(t.x,t.y)?t.detail instanceof ro&&t.detail.pulse(t.x,t.y):(this.endHover(t,e),t.detail instanceof ro&&(t.detail.fade(t.x,t.y),t.detail=void 0))},didCancelPress(t,e){this.owner.clientBounds.contains(t.x,t.y)||this.endHover(t,e),t.detail instanceof ro&&(t.detail.fade(t.x,t.y),t.detail=void 0)},didStartHovering(){this.owner.hovers.state&&this.owner.hover.focus(!1),this.owner.callObservers("viewDidEnter",this.owner)},didStopHovering(){this.owner.hovers.state&&this.owner.hover.unfocus(),this.owner.callObservers("viewDidLeave",this.owner)},didPress(t,e){if(this.owner.clientBounds.contains(t.x,t.y)){if(!t.defaultPrevented){let i=t.target;for(;null!==i&&i!==this.owner.node;){const n=i.view;if(n instanceof wo){n.onPress(t,e),n.didPress(t,e);break}i=i instanceof Node?i.parentNode:null}}t.defaultPrevented||this.owner.callObservers("viewDidPress",t,e,this.owner)}},didLongPress(t){if(!t.defaultPrevented){let e=t.target;for(;null!==e&&e!==this.owner.node;){const i=e.view;if(i instanceof wo){i.onLongPress(t),i.didLongPress(t);break}e=e instanceof Node?e.parentNode:null}}t.defaultPrevented||this.owner.callObservers("viewDidLongPress",t,this.owner)}})],Vo.prototype,"gesture",void 0);class Io extends A{getCell(t,e){void 0===e&&(e=So);const i=this.getTrait(t);return i instanceof e?i:null}getOrCreateCell(t,e){let i=this.getTrait(t,e);return null===i&&(i=e.create(),this.setTrait(t,i)),i}setCell(t,e){this.setTrait(t,e)}startConsumingCells(){const t=this.cells.traits;for(const e in t){t[e].consume(this)}}stopConsumingCells(){const t=this.cells.traits;for(const e in t){t[e].unconsume(this)}}onStartConsuming(){super.onStartConsuming(),this.startConsumingCells()}onStopConsuming(){super.onStopConsuming(),this.stopConsumingCells()}}u([T({type:So,binds:!0,willAttachTrait(t,e){this.owner.callObservers("traitWillAttachCell",t,e,this.owner)},didAttachTrait(t,e){this.owner.consuming&&t.consume(this.owner)},willDetachTrait(t){this.owner.consuming&&t.unconsume(this.owner)},didDetachTrait(t){this.owner.callObservers("traitDidDetachCell",t,this.owner)},detectModel:t=>t.getTrait(So)})],Io.prototype,"cells",void 0);class Mo extends Qs{getCellTrait(t,e){const i=this.leaf.trait;return null!==i?i.getCell(t,e):null}getOrCreateCellTrait(t,e){const i=this.leaf.trait;if(null===i)throw new Error("no leaf trait");return i.getOrCreateCell(t,e)}setCellTrait(t,e){const i=this.leaf.trait;if(null===i)throw new Error("no leaf trait");i.setCell(t,e)}getCellView(t,e){const i=this.leaf.view;return null!==i?i.getCell(t,e):null}getOrCreateCellView(t,e){let i=this.leaf.view;if(null===i){if(i=this.leaf.createView(),null===i)throw new Error("no leaf view");this.leaf.setView(i)}return i.getOrCreateCell(t,e)}setCellView(t,e){let i=this.leaf.view;if(null===i){if(i=this.leaf.createView(),null===i)throw new Error("no leaf view");this.leaf.setView(i)}i.setCell(t,e)}}u([eo({traitType:Io,observesTrait:!0,willAttachTrait(t){this.owner.callObservers("controllerWillAttachLeafTrait",t,this.owner)},didAttachTrait(t){const e=t.cells.traits;for(const t in e){const i=e[t];this.owner.cells.addTraitController(i)}},willDetachTrait(t){const e=t.cells.traits;for(const t in e){const i=e[t];this.owner.cells.deleteTraitController(i)}},didDetachTrait(t){this.owner.callObservers("controllerDidDetachLeafTrait",t,this.owner)},traitWillAttachCell(t,e){this.owner.cells.addTraitController(t,e)},traitDidDetachCell(t){this.owner.cells.deleteTraitController(t)},viewType:Vo,observesView:!0,initView(t){const e=this.owner.cells.controllers;for(const i in e){const n=e[i],s=n.cell.view;if(null!==s&&null===s.parent){const e=n.cell.trait;null!==e&&n.cell.insertView(t,void 0,void 0,e.key)}}},willAttachView(t){this.owner.callObservers("controllerWillAttachLeafView",t,this.owner)},didDetachView(t){this.owner.callObservers("controllerDidDetachLeafView",t,this.owner)},viewWillHighlight(t){this.owner.callObservers("controllerWillHighlightLeafView",t,this.owner)},viewDidHighlight(t){this.owner.callObservers("controllerDidHighlightLeafView",t,this.owner)},viewWillUnhighlight(t){this.owner.callObservers("controllerWillUnhighlightLeafView",t,this.owner)},viewDidUnhighlight(t){this.owner.callObservers("controllerDidUnhighlightLeafView",t,this.owner)},viewDidEnter(t){this.owner.callObservers("controllerDidEnterLeafView",t,this.owner)},viewDidLeave(t){this.owner.callObservers("controllerDidLeaveLeafView",t,this.owner)},viewDidPress(t,e,i){this.owner.callObservers("controllerDidPressLeafView",t,e,i,this.owner)},viewDidLongPress(t,e){this.owner.callObservers("controllerDidLongPressLeafView",t,e,this.owner)}})],Mo.prototype,"leaf",void 0),u([oo({type:Do,binds:!0,observes:!0,get parentView(){return this.owner.leaf.view},getTraitViewRef:t=>t.cell,willAttachController(t){this.owner.callObservers("controllerWillAttachCell",t,this.owner)},didAttachController(t){const e=t.cell.trait;null!==e&&this.attachCellTrait(e,t);const i=t.cell.view;null!==i&&this.attachCellView(i,t)},willDetachController(t){const e=t.cell.view;null!==e&&this.detachCellView(e,t);const i=t.cell.trait;null!==i&&this.detachCellTrait(i,t)},didDetachController(t){this.owner.callObservers("controllerDidDetachCell",t,this.owner)},controllerWillAttachCellTrait(t,e){this.owner.callObservers("controllerWillAttachCellTrait",t,e,this.owner),this.attachCellTrait(t,e)},controllerDidDetachCellTrait(t,e){this.detachCellTrait(t,e),this.owner.callObservers("controllerDidDetachCellTrait",t,e,this.owner)},attachCellTrait(t,e){},detachCellTrait(t,e){},controllerWillAttachCellView(t,e){this.owner.callObservers("controllerWillAttachCellView",t,e,this.owner),this.attachCellView(t,e)},controllerDidDetachCellView(t,e){this.detachCellView(t,e),this.owner.callObservers("controllerDidDetachCellView",t,e,this.owner)},attachCellView(t,e){if(t instanceof mo){const i=t.content.view;null!==i&&this.attachCellContentView(i,e)}},detachCellView(t,e){if(t instanceof mo){const i=t.content.view;null!==i&&this.detachCellContentView(i,e)}t.remove()},controllerDidPressCellView(t,e,i,n){this.owner.callObservers("controllerDidPressCellView",t,e,i,n,this.owner)},controllerDidLongPressCellView(t,e,i){this.owner.callObservers("controllerDidLongPressCellView",t,e,i,this.owner)},controllerWillAttachCellContentView(t,e){this.attachCellContentView(t,e),this.owner.callObservers("controllerWillAttachCellContentView",t,e,this.owner)},controllerDidDetachCellContentView(t,e){this.owner.callObservers("controllerDidDetachCellContentView",t,e,this.owner),this.detachCellContentView(t,e)},attachCellContentView(t,e){},detachCellContentView(t,e){},controllerWillSetCellIcon(t,e,i){this.owner.callObservers("controllerWillSetCellIcon",t,e,i,this.owner)},controllerDidSetCellIcon(t,e,i){this.owner.callObservers("controllerDidSetCellIcon",t,e,i,this.owner)},createController(t){return void 0!==t?Do.fromTrait(t):oo.prototype.createController.call(this)}})],Mo.prototype,"cells",void 0);class Ro extends Kn{constructor(t){super(t),this.visibleFrame=new s.R2Box(0,0,window.innerWidth,window.innerHeight),this.initRow()}initRow(){this.addClass("row"),this.position.setState("relative",i.Affinity.Intrinsic)}getCell(t,e){const i=this.leaf.view;return null!==i?i.getCell(t,e):null}getOrCreateCell(t,e){const i=this.leaf.insertView();if(null===i)throw new Error("no leaf view");return i.getOrCreateCell(t,e)}setCell(t,e){const i=this.leaf.insertView();if(null===i)throw new Error("no leaf view");i.setCell(t,e)}detectVisibleFrame(t){const e=this.rowHeight.getValueOr(s.Length.zero()).pxValue(),i=t.visibleFrame;if(void 0!==i){let t=this.left.state;t=t instanceof s.Length?t.pxValue():0;let n=this.top.state;return n=n instanceof s.Length?n.pxValue():0,new s.R2Box(i.xMin-t-0,i.yMin-n-e,i.xMax-t+0,i.yMax-n+e)}{const t=this.node.getBoundingClientRect(),i=-t.x-0,n=-t.y-e,o=window.innerWidth-t.x+0,r=window.innerHeight-t.y+e;return new s.R2Box(i,n,o,r)}}extendViewContext(t){const e=Object.create(t);return e.visibleFrame=this.visibleFrame,e}onProcess(t,e){super.onProcess(t,e);const i=this.detectVisibleFrame(Object.getPrototypeOf(e));this.visibleFrame=i,e.visibleFrame=this.visibleFrame}needsProcess(t,e){return 0!=(t&fn.NeedsResize)&&(t|=fn.NeedsScroll),t}onDisplay(t,e){super.onDisplay(t,e);const i=this.detectVisibleFrame(Object.getPrototypeOf(e));this.visibleFrame=i,e.visibleFrame=this.visibleFrame}onLayout(t){super.onLayout(t),this.resizeRow();const e=this.leaf.view;null!==e&&this.layoutLeaf(e)}resizeRow(){const t=this.layout.inherited?null:this.layout.state;if(null!==t){const e=this.layout.superState;let i=null;null!=e&&null!==e.width&&(i=e.width.pxValue()),null===i&&(i=this.width.state,i=i instanceof s.Length?i.pxValue():this.node.offsetWidth);const n=t.resized(i,0,0);this.layout.setState(n)}}layoutLeaf(t){const e=this.layout.state,n=null!==e?e.width:null,s=this.getLook(At.timing);t.top.setState(0,s,i.Affinity.Intrinsic),t.width.setState(n,i.Affinity.Intrinsic)}didLayout(t){this.layoutRow(),super.didLayout(t)}layoutRow(){const t=this.layout.state,e=null!==t?t.width:null,n=this.rowSpacing.getValueOr(s.Length.zero()).pxValue(),o=this.disclosure.getValue(),r=this.disclosing.getPhaseOr(1);let l=0,a=0;const h=this.leaf.view;null!==h&&(h.width.setState(e,i.Affinity.Intrinsic),h.display.setState("flex",i.Affinity.Intrinsic),l=h.height.value,l=l instanceof s.Length?l.pxValue():h.node.offsetHeight,a=h.height.state,a=a instanceof s.Length?a.pxValue():l);const d=this.head.view;null!==d&&(o.collapsed?d.display.setState("none",i.Affinity.Intrinsic):(d.top.setState(l,i.Affinity.Intrinsic),d.width.setState(e,i.Affinity.Intrinsic),d.height.setState(n*r,i.Affinity.Intrinsic),d.opacity.setState(r,i.Affinity.Intrinsic),d.display.setState("block",i.Affinity.Intrinsic)));let c=0,u=0;const p=this.tree.view;null!==p&&(o.collapsed?p.display.setState("none",i.Affinity.Intrinsic):(p.top.setState((l+n)*r,i.Affinity.Intrinsic),p.width.setState(e,i.Affinity.Intrinsic),p.display.setState("block",i.Affinity.Intrinsic),c=p.height.value,c=c instanceof s.Length?c.pxValue():p.node.offsetHeight,c+=n,u=p.height.state,u=u instanceof s.Length?u.pxValue():c,u+=n));const f=this.foot.view;if(null!==f&&(o.collapsed?f.display.setState("none",i.Affinity.Intrinsic):(f.top.setState(l+c,i.Affinity.Intrinsic),f.width.setState(e,i.Affinity.Intrinsic),f.height.setState(n*r,i.Affinity.Intrinsic),f.opacity.setState(r,i.Affinity.Intrinsic),f.display.setState("block",i.Affinity.Intrinsic))),this.height.hasAffinity(i.Affinity.Intrinsic)){const t=l+c*r,e=a+u;this.height.setInterpolatedValue(s.Length.px(t),s.Length.px(e))}}onCull(){super.onCull(),this.display.setState("none",i.Affinity.Intrinsic)}onUncull(){super.onUncull(),this.display.setState("block",i.Affinity.Intrinsic)}}u([i.Property({type:yo,inherits:!0,state:null,updateFlags:fn.NeedsLayout})],Ro.prototype,"layout",void 0),u([i.Property({type:Number,inherits:!0,state:0,updateFlags:fn.NeedsLayout,didSetState(t,e){const n=this.owner.tree.view;null!==n&&n.depth.setState(t+1,i.Affinity.Intrinsic)}})],Ro.prototype,"depth",void 0),u([te({type:s.Length,inherits:!0,state:null,updateFlags:fn.NeedsLayout})],Ro.prototype,"rowSpacing",void 0),u([te({type:s.Length,inherits:!0,state:null,updateFlags:fn.NeedsLayout})],Ro.prototype,"rowHeight",void 0),u([i.Property({type:Boolean,inherits:!0,state:!1})],Ro.prototype,"hovers",void 0),u([i.Property({type:Boolean,inherits:!0,state:!0})],Ro.prototype,"glows",void 0),u([vn({key:!0,type:Vo,binds:!0,observes:!0,initView(t){t.display.setState("none",i.Affinity.Intrinsic),t.position.setState("absolute",i.Affinity.Intrinsic),t.left.setState(0,i.Affinity.Intrinsic),t.top.setState(0,i.Affinity.Intrinsic);const e=this.owner.layout.state;t.width.setState(null!==e?e.width:null,i.Affinity.Intrinsic),t.zIndex.setState(1,i.Affinity.Intrinsic)},willAttachView(t){this.owner.callObservers("viewWillAttachLeaf",t,this.owner)},didDetachView(t){this.owner.callObservers("viewDidDetachLeaf",t,this.owner)},viewWillHighlight(t){this.owner.callObservers("viewWillHighlightLeaf",t,this.owner)},viewDidHighlight(t){this.owner.callObservers("viewDidHighlightLeaf",t,this.owner)},viewWillUnhighlight(t){this.owner.callObservers("viewWillUnhighlightLeaf",t,this.owner)},viewDidUnhighlight(t){this.owner.callObservers("viewDidUnhighlightLeaf",t,this.owner)},viewDidEnter(t){this.owner.callObservers("viewDidEnterLeaf",t,this.owner)},viewDidLeave(t){this.owner.callObservers("viewDidLeaveLeaf",t,this.owner)},viewDidPress(t,e,i){this.owner.callObservers("viewDidPressLeaf",t,e,i,this.owner)},viewDidLongPress(t,e){this.owner.callObservers("viewDidLongPressLeaf",t,e,this.owner)}})],Ro.prototype,"leaf",void 0),u([vn({key:!0,type:Kn,binds:!0,initView(t){t.addClass("head"),t.display.setState("none",i.Affinity.Intrinsic),t.position.setState("absolute",i.Affinity.Intrinsic),t.left.setState(0,i.Affinity.Intrinsic),t.top.setState(this.owner.rowHeight.state,i.Affinity.Intrinsic);const e=this.owner.layout.state;t.width.setState(null!==e?e.width:null,i.Affinity.Intrinsic),t.height.setState(this.owner.rowSpacing.state,i.Affinity.Intrinsic),t.backgroundColor.setLook(At.accentColor,i.Affinity.Intrinsic),t.opacity.setState(this.owner.disclosing.phase,i.Affinity.Intrinsic),t.zIndex.setState(1,i.Affinity.Intrinsic)}})],Ro.prototype,"head",void 0),u([vn({key:!0,binds:!0,initView(t){t.addClass("tree"),t.display.setState(this.owner.disclosure.collapsed?"none":"block",i.Affinity.Intrinsic),t.position.setState("absolute",i.Affinity.Intrinsic),t.left.setState(0,i.Affinity.Intrinsic);const e=this.owner.layout.state;t.width.setState(null!==e?e.width:null,i.Affinity.Intrinsic),t.zIndex.setState(0,i.Affinity.Intrinsic),t.depth.setState(this.owner.depth.state+1,i.Affinity.Intrinsic)},willAttachView(t){this.owner.callObservers("viewWillAttachTree",t,this.owner)},didDetachView(t){this.owner.callObservers("viewDidDetachTree",t,this.owner)},createView:()=>zo.create()})],Ro.prototype,"tree",void 0),u([vn({key:!0,type:Kn,binds:!0,initView(t){t.addClass("foot"),t.display.setState("none",i.Affinity.Intrinsic),t.position.setState("absolute",i.Affinity.Intrinsic),t.left.setState(0,i.Affinity.Intrinsic),t.top.setState(this.owner.rowHeight.state,i.Affinity.Intrinsic);const e=this.owner.layout.state;t.width.setState(null!==e?e.width:null,i.Affinity.Intrinsic),t.height.setState(this.owner.rowSpacing.state,i.Affinity.Intrinsic),t.backgroundColor.setLook(At.borderColor,i.Affinity.Intrinsic),t.opacity.setState(this.owner.disclosing.phase,i.Affinity.Intrinsic),t.zIndex.setState(1,i.Affinity.Intrinsic)}})],Ro.prototype,"foot",void 0),u([Ht({type:gt,state:gt.collapsed(),willExpand(){this.owner.callObservers("viewWillExpand",this.owner);const t=this.owner.tree.view;null!==t&&t.display.setState("block",i.Affinity.Intrinsic)},didExpand(){this.owner.callObservers("viewDidExpand",this.owner)},willCollapse(){this.owner.callObservers("viewWillCollapse",this.owner)},didCollapse(){const t=this.owner.tree.view;null!==t&&t.display.setState("none",i.Affinity.Intrinsic),this.owner.callObservers("viewDidCollapse",this.owner)},didSetValue(t,e){0!==t.direction?this.owner.disclosing.setState(t,i.Affinity.Intrinsic):(this.owner.disclosing.setState(null,i.Affinity.Intrinsic),this.owner.disclosing.setAffinity(i.Affinity.Transient));const n=this.owner.getBase(zo);null!==n&&n.requireUpdate(fn.NeedsLayout)}})],Ro.prototype,"disclosure",void 0),u([Ht({type:gt,inherits:!0,state:null,updateFlags:fn.NeedsLayout})],Ro.prototype,"disclosing",void 0);class Fo extends Io{}u([D({binds:!0,willAttachTrait(t){this.owner.callObservers("traitWillAttachTree",t,this.owner)},didDetachTrait(t){this.owner.callObservers("traitDidDetachTree",t,this.owner)},detectModel:t=>t.getTrait(Uo),detectTrait:t=>t instanceof Uo?t:null,createTrait:()=>Uo.create()})],Fo.prototype,"tree",void 0);class Lo extends Mo{}u([eo({traitType:Fo,observesTrait:!0,initTrait(t){null===this.owner.leaf.trait&&this.owner.leaf.setTrait(t);const e=t.tree.trait;null!==e&&this.owner.tree.setTrait(e)},deinitTrait(t){const e=t.tree.trait;null!==e&&this.owner.tree.deleteTrait(e),this.owner.leaf.trait===t&&this.owner.leaf.setTrait(null)},willAttachTrait(t){this.owner.callObservers("controllerWillAttachRowTrait",t,this.owner)},didDetachTrait(t){this.owner.callObservers("controllerDidDetachRowTrait",t,this.owner)},traitWillAttachTree(t){this.owner.tree.setTrait(t)},traitDidDetachTree(t){this.owner.tree.deleteTrait(t)},viewType:Ro,observesView:!0,initView(t){if(null===this.owner.leaf.view){const e=t.leaf.insertView();this.owner.leaf.setView(e)}const e=this.owner.tree.controller;null!==e&&e.table.insertView(t)},willAttachView(t){this.owner.callObservers("controllerWillAttachRowView",t,this.owner)},didDetachView(t){this.owner.callObservers("controllerDidDetachRowView",t,this.owner)},viewWillExpand(t){this.owner.callObservers("controllerWillExpandRowView",t,this.owner)},viewDidExpand(t){this.owner.callObservers("controllerDidExpandRowView",t,this.owner)},viewWillCollapse(t){this.owner.callObservers("controllerWillCollapseRowView",t,this.owner)},viewDidCollapse(t){this.owner.callObservers("controllerDidCollapseRowView",t,this.owner)},viewWillAttachTree(t){const e=this.owner.tree.controller;null!==e&&e.table.setView(t)}})],Lo.prototype,"row",void 0),u([so({binds:!0,observes:!0,get parentView(){return this.owner.row.view},getTraitViewRef:t=>t.table,initController(t){const e=t.table.trait;null!==e&&this.attachTreeTrait(e,t);const i=t.table.view;null!==i&&this.attachTreeView(i,t);const n=this.owner.row.trait;if(null!==n){const e=n.tree.trait;null!==e&&t.table.setTrait(e)}},deinitController(t){const e=t.table.trait;null!==e&&this.detachTreeTrait(e,t);const i=t.table.view;null!==i&&this.detachTreeView(i,t)},willAttachController(t){this.owner.callObservers("controllerWillAttachTree",t,this.owner)},didDetachController(t){this.owner.callObservers("controllerDidDetachTree",t,this.owner)},controllerWillAttachTreeTrait(t,e){this.owner.callObservers("controllerWillAttachTreeTrait",t,e,this.owner),this.attachTreeTrait(t,e)},controllerDidDetachTreeTrait(t,e){this.detachTreeTrait(t,e),this.owner.callObservers("controllerDidDetachTreeTrait",t,e,this.owner)},attachTreeTrait(t,e){},detachTreeTrait(t,e){},controllerWillAttachTableView(t,e){this.owner.callObservers("controllerWillAttachTreeView",t,e,this.owner),this.attachTreeView(t,e)},controllerDidDetachTableView(t,e){this.detachTreeView(t,e),this.owner.callObservers("controllerDidDetachTreeView",t,e,this.owner)},attachTreeView(t,e){},detachTreeView(t,e){t.remove()},detectController:t=>t instanceof Ho?t:null,createController:()=>Ho.create()})],Lo.prototype,"tree",void 0);class ko extends Kn{constructor(t){super(t),this.initCol()}initCol(){this.addClass("col"),this.overflowX.setState("hidden",i.Affinity.Intrinsic),this.overflowY.setState("hidden",i.Affinity.Intrinsic)}}u([vn({key:!0,type:Kn,binds:!0,willAttachView(t){this.owner.callObservers("viewWillAttachLabel",t,this.owner)},didDetachView(t){this.owner.callObservers("viewDidDetachLabel",t,this.owner)},createView(t){const e=Kn.fromTag("span");return e.alignSelf.setState("center",i.Affinity.Intrinsic),e.whiteSpace.setState("nowrap",i.Affinity.Intrinsic),e.textOverflow.setState("ellipsis",i.Affinity.Intrinsic),e.overflowX.setState("hidden",i.Affinity.Intrinsic),e.overflowY.setState("hidden",i.Affinity.Intrinsic),e.color.setLook(At.neutralColor,i.Affinity.Intrinsic),void 0!==t&&e.text(t),e},fromAny(t){return"string"==typeof t?this.createView(t):Kn.fromAny(t)}})],ko.prototype,"label",void 0);class Oo extends A{}u([i.Property({type:vo,state:null,willSetState(t,e){this.owner.callObservers("traitWillSetLayout",t,e,this.owner)},didSetState(t,e){this.owner.callObservers("traitDidSetLayout",t,e,this.owner)}})],Oo.prototype,"layout",void 0),u([i.Property({state:null,willSetState(t,e){this.owner.callObservers("traitWillSetLabel",t,e,this.owner)},didSetState(t,e){this.owner.callObservers("traitDidSetLabel",t,e,this.owner)}})],Oo.prototype,"label",void 0);class Eo extends Qs{createLabelView(t,e){return"function"==typeof t?t(e):t}setLabelView(t,e){const i=this.col.view;if(null!==i){const n=null!==t?this.createLabelView(t,e):null;i.label.setView(n)}}}u([eo({traitType:Oo,observesTrait:!0,initTrait(t){null!==this.view&&this.owner.setLabelView(t.label.state,t)},deinitTrait(t){null!==this.view&&this.owner.setLabelView(null,t)},willAttachTrait(t){this.owner.callObservers("controllerWillAttachColTrait",t,this.owner)},didDetachTrait(t){this.owner.callObservers("controllerDidDetachColTrait",t,this.owner)},traitWillSetLayout(t,e){this.owner.callObservers("controllerWillSetColLayout",t,e,this.owner)},traitDidSetLayout(t,e){this.owner.callObservers("controllerDidSetColLayout",t,e,this.owner)},traitDidSetLabel(t,e,i){this.owner.setLabelView(t,i)},viewType:ko,observesView:!0,initView(t){this.owner.label.setView(t.label.view);const e=this.trait;null!==e&&this.owner.setLabelView(e.label.state,e)},deinitView(t){this.owner.label.setView(null)},willAttachView(t){this.owner.callObservers("controllerWillAttachColView",t,this.owner)},didDetachView(t){this.owner.callObservers("controllerDidDetachColView",t,this.owner)},viewWillAttachLabel(t){this.owner.label.setView(t)},viewDidDetachLabel(t){this.owner.label.setView(null)}})],Eo.prototype,"col",void 0),u([vn({type:Kn,willAttachView(t){this.owner.callObservers("controllerWillAttachColLabelView",t,this.owner)},didDetachView(t){this.owner.callObservers("controllerDidDetachColLabelView",t,this.owner)}})],Eo.prototype,"label",void 0);class Wo extends Kn{constructor(t){super(t),this.initHeader()}initHeader(){this.addClass("header"),this.position.setState("relative",i.Affinity.Intrinsic),this.overflowX.setState("hidden",i.Affinity.Intrinsic),this.overflowY.setState("hidden",i.Affinity.Intrinsic)}getCol(t,e){void 0===e&&(e=ko);const i=this.getChild(t);return i instanceof e?i:null}getOrCreateCol(t,e){void 0===e&&(e=ko);let i=this.getChild(t);return i instanceof e||(i=e.create(),this.setChild(t,i)),i}setCol(t,e){this.setChild(t,e)}onLayout(t){super.onLayout(t),this.layoutHeader()}layoutHeader(){const t=this.rowHeight.value;null!==t&&this.height.setState(t,i.Affinity.Intrinsic)}displayChildren(t,e,i){0!=(t&fn.NeedsLayout)?this.layoutChildViews(t,e,i):super.displayChildren(t,e,i)}layoutChildViews(t,e,n){const s=this.layout.state,o=this.height.state,r=this.stretch.getPhaseOr(1);super.displayChildren(t,e,(function(t,e,l){if(t instanceof ko){const e=t.key,n=null!==s&&void 0!==e?s.getCol(e):null;if(null!==n){t.display.setState(n.hidden?"none":"flex",i.Affinity.Intrinsic),t.left.setState(n.left,i.Affinity.Intrinsic),t.width.setState(n.width,i.Affinity.Intrinsic),t.height.setState(o,i.Affinity.Intrinsic);const e=n.textColor;e instanceof At?t.color.setLook(e,i.Affinity.Intrinsic):t.color.setState(e,i.Affinity.Intrinsic),n.persistent||t.opacity.setState(r,i.Affinity.Intrinsic)}else t.display.setState("none",i.Affinity.Intrinsic),t.left.setState(null,i.Affinity.Intrinsic),t.width.setState(null,i.Affinity.Intrinsic),t.height.setState(null,i.Affinity.Intrinsic)}n.call(this,t,e,l)}))}}u([i.Property({type:yo,inherits:!0,state:null,updateFlags:fn.NeedsLayout})],Wo.prototype,"layout",void 0),u([i.Property({type:Number,inherits:!0,state:0,updateFlags:fn.NeedsLayout})],Wo.prototype,"depth",void 0),u([te({type:s.Length,inherits:!0,state:null,updateFlags:fn.NeedsLayout})],Wo.prototype,"rowSpacing",void 0),u([te({type:s.Length,inherits:!0,state:null,updateFlags:fn.NeedsLayout})],Wo.prototype,"rowHeight",void 0),u([Ht({type:gt,inherits:!0,state:null,updateFlags:fn.NeedsLayout})],Wo.prototype,"stretch",void 0),u([yn({type:ko,binds:!0,initView(t){t.display.setState("none",i.Affinity.Intrinsic),t.position.setState("absolute",i.Affinity.Intrinsic),t.left.setState(0,i.Affinity.Intrinsic),t.top.setState(0,i.Affinity.Intrinsic),t.width.setState(0,i.Affinity.Intrinsic),t.height.setState(this.owner.height.state,i.Affinity.Intrinsic)},willAttachView(t,e){this.owner.callObservers("viewWillAttachCol",t,e,this.owner)},didDetachView(t){this.owner.callObservers("viewDidDetachCol",t,this.owner)}})],Wo.prototype,"cols",void 0);class No extends A{getCol(t,e){void 0===e&&(e=Oo);const i=this.getTrait(t);return i instanceof e?i:null}getOrCreateCol(t,e){void 0===e&&(e=Oo);let i=this.getTrait(t);return i instanceof e||(i=new e,this.setTrait(t,i)),i}setCol(t,e){this.setTrait(t,e)}startConsumingCols(){const t=this.cols.traits;for(const e in t){t[e].consume(this)}}stopConsumingCols(){const t=this.cols.traits;for(const e in t){t[e].unconsume(this)}}onStartConsuming(){super.onStartConsuming(),this.startConsumingCols()}onStopConsuming(){super.onStopConsuming(),this.stopConsumingCols()}}u([T({type:Oo,binds:!0,willAttachTrait(t,e){this.owner.callObservers("traitWillAttachCol",t,e,this.owner)},didAttachTrait(t){this.owner.consuming&&t.consume(this.owner)},willDetachTrait(t){this.owner.consuming&&t.unconsume(this.owner)},didDetachTrait(t){this.owner.callObservers("traitDidDetachCol",t,this.owner)},detectModel:t=>t.getTrait(Oo)})],No.prototype,"cols",void 0);class Bo extends Qs{getColTrait(t,e){const i=this.header.trait;return null!==i?i.getCol(t,e):null}getOrCreateColTrait(t,e){const i=this.header.trait;if(null===i)throw new Error("no header trait");return i.getOrCreateCol(t,e)}setColTrait(t,e){const i=this.header.trait;if(null===i)throw new Error("no header trait");i.setCol(t,e)}getColView(t,e){const i=this.header.view;return null!==i?i.getCol(t,e):null}getOrCreateColView(t,e){let i=this.header.view;if(null===i){if(i=this.header.createView(),null===i)throw new Error("no header view");this.header.setView(i)}return i.getOrCreateCol(t,e)}setColView(t,e){let i=this.header.view;if(null===i){if(i=this.header.createView(),null===i)throw new Error("no header view");this.header.setView(i)}i.setCol(t,e)}}u([eo({traitType:No,observesTrait:!0,willAttachTrait(t){this.owner.callObservers("controllerWillAttachHeaderTrait",t,this.owner)},didAttachTrait(t){const e=t.cols.traits;for(const t in e){const i=e[t];this.owner.cols.addTraitController(i)}},willDetachTrait(t){const e=t.cols.traits;for(const t in e){const i=e[t];this.owner.cols.deleteTraitController(i)}},didDetachTrait(t){this.owner.callObservers("controllerDidDetachHeaderTrait",t,this.owner)},traitWillAttachCol(t,e){this.owner.cols.addTraitController(t,e)},traitDidDetachCol(t){this.owner.cols.deleteTraitController(t)},viewType:Wo,observesView:!0,initView(t){const e=this.owner.cols.controllers;for(const i in e){const n=e[i],s=n.col.view;if(null!==s&&null===s.parent){const e=n.col.trait;null!==e&&n.col.insertView(t,void 0,void 0,e.key)}}},willAttachView(t){this.owner.callObservers("controllerWillAttachHeaderView",t,this.owner)},didDetachView(t){this.owner.callObservers("controllerDidDetachHeaderView",t,this.owner)},insertChildView(t,e,i,n){t.prependChild(e,n)}})],Bo.prototype,"header",void 0),u([oo({type:Eo,binds:!0,observes:!0,get parentView(){return this.owner.header.view},getTraitViewRef:t=>t.col,willAttachController(t){this.owner.callObservers("controllerWillAttachCol",t,this.owner)},didAttachController(t){const e=t.col.trait;null!==e&&this.attachColTrait(e,t);const i=t.col.view;null!==i&&this.attachColView(i,t)},willDetachController(t){const e=t.col.view;null!==e&&this.detachColView(e,t);const i=t.col.trait;null!==i&&this.detachColTrait(i,t)},didDetachController(t){this.owner.callObservers("controllerDidDetachCol",t,this.owner)},controllerWillAttachColTrait(t,e){this.owner.callObservers("controllerWillAttachColTrait",t,e,this.owner),this.attachColTrait(t,e)},controllerDidDetachColTrait(t,e){this.detachColTrait(t,e),this.owner.callObservers("controllerDidDetachColTrait",t,e,this.owner)},attachColTrait(t,e){},detachColTrait(t,e){},controllerWillAttachColView(t,e){this.owner.callObservers("controllerWillAttachColView",t,e,this.owner),this.attachColView(t,e)},controllerDidDetachColView(t,e){this.detachColView(t,e),this.owner.callObservers("controllerDidDetachColView",t,e,this.owner)},attachColView(t,e){const i=t.label.view;null!==i&&this.attachColLabelView(i,e)},detachColView(t,e){const i=t.label.view;null!==i&&this.detachColLabelView(i,e),t.remove()},controllerWillSetColLayout(t,e,i){this.owner.callObservers("controllerWillSetColLayout",t,e,i,this.owner)},controllerDidSetColLayout(t,e,i){this.owner.callObservers("controllerDidSetColLayout",t,e,i,this.owner)},controllerWillAttachColLabelView(t,e){this.owner.callObservers("controllerWillAttachColLabelView",t,e,this.owner),this.attachColLabelView(t,e)},controllerDidDetachColLabelView(t,e){this.detachColLabelView(t,e),this.owner.callObservers("controllerDidDetachColLabelView",t,e,this.owner)},attachColLabelView(t,e){},detachColLabelView(t,e){}})],Bo.prototype,"cols",void 0);class zo extends Kn{constructor(t){super(t),this.visibleViews=[],this.visibleFrame=new s.R2Box(0,0,window.innerWidth,window.innerHeight),this.initTable()}initTable(){this.addClass("table"),this.position.setState("relative",i.Affinity.Intrinsic),this.backgroundColor.setLook(At.backgroundColor,i.Affinity.Intrinsic)}detectVisibleFrame(t){const e=this.rowHeight.getValueOr(s.Length.zero()).pxValue(),i=t.visibleFrame;if(void 0!==i){let t=this.left.state;t=t instanceof s.Length?t.pxValue():0;let n=this.top.state;return n=n instanceof s.Length?n.pxValue():0,new s.R2Box(i.xMin-t-0,i.yMin-n-e,i.xMax-t+0,i.yMax-n+e)}{const t=this.node.getBoundingClientRect(),i=-t.x-0,n=-t.y-e,o=window.innerWidth-t.x+0,r=window.innerHeight-t.y+e;return new s.R2Box(i,n,o,r)}}extendViewContext(t){const e=Object.create(t);return e.visibleFrame=this.visibleFrame,e}needsProcess(t,e){return 0!=(t&fn.NeedsResize)&&(t|=fn.NeedsScroll),t}onResize(t){super.onResize(t),this.resizeTable()}resizeTable(){const t=this.layout.inherited?null:this.layout.state;if(null!==t){const e=this.layout.superState;let i=null;null!=e&&null!==e.width&&(i=e.width.pxValue()),null===i&&(i=this.width.state,i=i instanceof s.Length?i.pxValue():this.node.offsetWidth);const n=this.edgeInsets.state;let o=this.paddingLeft.state;o=o instanceof s.Length?o.pxValue(i):0;let r=this.paddingRight.state;r=r instanceof s.Length?r.pxValue(i):0;let l=null!==n?n.insetLeft:0;l+=o;let a=null!==n?n.insetRight:0;a+=r;const h=t.resized(i,l,a);this.layout.setState(h)}}processVisibleViews(t,e,i){const n=this.visibleViews;let s=0;for(;s<n.length;){const o=n[s];i.call(this,o,t,e),0==(o.flags&fn.RemovingFlag)?s+=1:(o.setFlags(o.flags&~fn.RemovingFlag),this.removeChild(o))}}processChildren(t,e,i){this.culled||(0!=(t&fn.NeedsScroll)?this.scrollChildViews(t,e,i):this.processVisibleViews(t,e,i))}scrollChildViews(t,e,n){const o=this.visibleViews;o.length=0;const r=this.detectVisibleFrame(Object.getPrototypeOf(e));e.visibleFrame=r,this.visibleFrame=r,super.processChildren(t,e,(function(t,e,l){let a;if(t instanceof Kn){const e=t.top.state,n=t.height.state;if(e instanceof s.Length&&n instanceof s.Length){const s=r.yMin,o=r.yMax,l=e.pxValue();a=s<=l+n.pxValue()&&l<=o,t.display.setState(a?"flex":"none",i.Affinity.Intrinsic),t.setCulled(!a)}else a=!0}else a=!0;a&&(o.push(t),n.call(this,t,e,l))}))}displayVisibleViews(t,e,i){const n=this.visibleViews;let s=0;for(;s<n.length;){const o=n[s];i.call(this,o,t,e),0==(o.flags&fn.RemovingFlag)?s+=1:(o.setFlags(o.flags&~fn.RemovingFlag),this.removeChild(o))}}displayChildren(t,e,i){0!=(t&fn.NeedsLayout)?this.layoutChildViews(t,e,i):this.displayVisibleViews(t,e,i)}layoutChildViews(t,e,n){this.resizeTable();const o=this.layout.state,r=null!==o?o.width:null,l=this.rowHeight.getValue(),a=this.rowSpacing.getValue().pxValue(l.pxValue()),h=this.disclosing.getPhaseOr(1),d=this.visibleViews;d.length=0;const c=this.detectVisibleFrame(Object.getPrototypeOf(e));e.visibleFrame=c,this.visibleFrame=c;let u=0,p=0,f=0;super.displayChildren(t,e,(function(t,e,o){let l;if((t instanceof Ro||t instanceof Wo)&&(0!==f&&(u+=a*h,p+=a),t.top.hasAffinity(i.Affinity.Intrinsic)&&t.top.setInterpolatedValue(s.Length.px(u),s.Length.px(p)),t.width.setState(r,i.Affinity.Intrinsic)),t instanceof Kn){const e=t.top.state,n=t.height.state;if(e instanceof s.Length&&n instanceof s.Length){const t=c.yMin,i=c.yMax,s=e.pxValue();l=t<=s+n.pxValue()&&s<=i}else l=!0;t.display.setState(l?"flex":"none",i.Affinity.Intrinsic),t.setCulled(!l)}else l=!0;if(l&&d.push(t),n.call(this,t,e,o),t instanceof Ro||t instanceof Wo){let e=t.height.value;e=e instanceof s.Length?e.pxValue():t.node.offsetHeight;let i=t.height.state;i=i instanceof s.Length?i.pxValue():e,u+=e*h,p+=i,f+=1}})),this.height.hasAffinity(i.Affinity.Intrinsic)&&this.height.setInterpolatedValue(s.Length.px(u),s.Length.px(p));const g=this.disclosure.getPhaseOr(1);this.opacity.setState(g,i.Affinity.Intrinsic)}}u([i.Property({type:yo,inherits:!0,state:null,updateFlags:fn.NeedsLayout})],zo.prototype,"layout",void 0),u([i.Property({type:Object,inherits:!0,state:null,updateFlags:fn.NeedsLayout})],zo.prototype,"edgeInsets",void 0),u([i.Property({type:Number,inherits:!0,state:0,updateFlags:fn.NeedsLayout,didSetState(t,e){this.owner.modifyTheme(Rt.default,[[Rt.nested,0!==t?1:void 0]],!1)}})],zo.prototype,"depth",void 0),u([te({type:s.Length,inherits:!0,state:s.Length.zero(),updateFlags:fn.NeedsLayout})],zo.prototype,"rowSpacing",void 0),u([te({type:s.Length,inherits:!0,state:s.Length.px(24),updateFlags:fn.NeedsLayout})],zo.prototype,"rowHeight",void 0),u([i.Property({type:Boolean,inherits:!0,state:!1})],zo.prototype,"hovers",void 0),u([i.Property({type:Boolean,inherits:!0,state:!0})],zo.prototype,"glows",void 0),u([Ht({type:gt,inherits:!0,state:null})],zo.prototype,"disclosure",void 0),u([Ht({type:gt,inherits:!0,state:null})],zo.prototype,"disclosing",void 0),u([Ht({type:gt,inherits:!0,state:null,updateFlags:fn.NeedsLayout})],zo.prototype,"stretch",void 0),u([vn({key:!0,type:Wo,binds:!0,initView(t){t.display.setState("none",i.Affinity.Intrinsic),t.position.setState("absolute",i.Affinity.Intrinsic),t.left.setState(0,i.Affinity.Intrinsic),t.top.setState(null,i.Affinity.Intrinsic);const e=this.owner.layout.state;t.width.setState(null!==e?e.width:null,i.Affinity.Intrinsic),t.setCulled(!0)},willAttachView(t){this.owner.callObservers("viewWillAttachHeader",t,this.owner)},didDetachView(t){this.owner.callObservers("viewDidDetachHeader",t,this.owner)},insertChild(t,e,i,n){t.prependChild(e,n)}})],zo.prototype,"header",void 0),u([yn({type:Ro,binds:!0,observes:!0,initView(t){t.display.setState("none",i.Affinity.Intrinsic),t.position.setState("absolute",i.Affinity.Intrinsic),t.left.setState(0,i.Affinity.Intrinsic),t.top.setState(null,i.Affinity.Intrinsic);const e=this.owner.layout.state;t.width.setState(null!==e?e.width:null,i.Affinity.Intrinsic),t.setCulled(!0)},willAttachView(t,e){this.owner.callObservers("viewWillAttachRow",t,e,this.owner)},didDetachView(t){this.owner.callObservers("viewDidDetachRow",t,this.owner)},viewWillAttachLeaf(t,e){this.owner.callObservers("viewWillAttachLeaf",t,e)},viewDidDetachLeaf(t,e){this.owner.callObservers("viewDidDetachLeaf",t,e)},viewDidEnterLeaf(t,e){this.owner.callObservers("viewDidEnterLeaf",t,e)},viewDidLeaveLeaf(t,e){this.owner.callObservers("viewDidLeaveLeaf",t,e)},viewDidPressLeaf(t,e,i,n){this.owner.callObservers("viewDidPressLeaf",t,e,i,n)},viewDidLongPressLeaf(t,e,i){this.owner.callObservers("viewDidLongPressLeaf",t,e,i)},viewWillAttachTree(t,e){this.owner.callObservers("viewWillAttachTree",t,e)},viewDidDetachTree(t,e){this.owner.callObservers("viewDidDetachTree",t,e)},viewWillHighlightLeaf(t,e){this.owner.callObservers("viewWillHighlightLeaf",t,e)},viewDidHighlightLeaf(t,e){this.owner.callObservers("viewDidHighlightLeaf",t,e)},viewWillUnhighlightLeaf(t,e){this.owner.callObservers("viewWillUnhighlightLeaf",t,e)},viewDidUnhighlightLeaf(t,e){this.owner.callObservers("viewDidUnhighlightLeaf",t,e)},viewWillExpand(t){this.owner.callObservers("viewWillExpandRow",t)},viewDidExpand(t){this.owner.callObservers("viewDidExpandRow",t)},viewWillCollapse(t){this.owner.callObservers("viewWillCollapseRow",t)},viewDidCollapse(t){this.owner.callObservers("viewDidCollapseRow",t)}})],zo.prototype,"rows",void 0);class Uo extends A{createLayout(){const t=[],e=this.cols.traits;for(const i in e){const n=e[i].layout.state;null!==n&&t.push(n)}const i=this.colSpacing.state;return new yo(null,null,null,i,t)}updateLayout(){const t=this.createLayout();this.layout.setState(t,i.Affinity.Intrinsic)}startConsumingCols(){const t=this.cols.traits;for(const e in t){t[e].consume(this)}}stopConsumingCols(){const t=this.cols.traits;for(const e in t){t[e].unconsume(this)}}startConsumingRows(){const t=this.rows.traits;for(const e in t){t[e].consume(this)}}stopConsumingRows(){const t=this.rows.traits;for(const e in t){t[e].unconsume(this)}}onStartConsuming(){super.onStartConsuming(),this.startConsumingCols(),this.startConsumingRows()}onStopConsuming(){super.onStopConsuming(),this.stopConsumingRows(),this.stopConsumingCols()}}u([i.Property({type:yo,state:null,willSetState(t,e){this.owner.callObservers("traitWillSetTableLayout",t,e,this.owner)},didSetState(t,e){this.owner.callObservers("traitDidSetTableLayout",t,e,this.owner)}})],Uo.prototype,"layout",void 0),u([i.Property({type:s.Length,state:null,didSetState(t,e){this.owner.updateLayout()}})],Uo.prototype,"colSpacing",void 0),u([D({type:No,binds:!0,willAttachTrait(t){this.owner.callObservers("traitWillAttachHeader",t,this.owner)},didDetachTrait(t){this.owner.callObservers("traitDidDetachHeader",t,this.owner)},detectTrait:t=>t instanceof No?t:null})],Uo.prototype,"header",void 0),u([T({type:Oo,binds:!0,observes:!0,willAttachTrait(t,e){this.owner.callObservers("traitWillAttachCol",t,e,this.owner)},didAttachTrait(t){this.owner.updateLayout(),this.owner.consuming&&t.consume(this.owner)},willDetachTrait(t){this.owner.consuming&&t.unconsume(this.owner)},didDetachTrait(t){this.owner.updateLayout(),this.owner.callObservers("traitDidDetachCol",t,this.owner)},traitDidSetLayout(t,e){this.owner.updateLayout()},detectModel:t=>t.getTrait(Oo)})],Uo.prototype,"cols",void 0),u([T({type:Fo,binds:!0,willAttachTrait(t,e){this.owner.callObservers("traitWillAttachRow",t,e,this.owner)},didAttachTrait(t){this.owner.consuming&&t.consume(this.owner)},willDetachTrait(t){this.owner.consuming&&t.unconsume(this.owner)},didDetachTrait(t){this.owner.callObservers("traitDidDetachRow",t,this.owner)},detectModel:t=>t.getTrait(Fo),detectTrait:t=>null})],Uo.prototype,"rows",void 0);class Ho extends Qs{layoutTable(t,e){e.layout.setState(t,i.Affinity.Intrinsic)}}u([eo({traitType:Uo,observesTrait:!0,willAttachTrait(t){this.owner.callObservers("controllerWillAttachTableTrait",t,this.owner)},didAttachTrait(t){const e=t.header.trait;null!==e&&this.owner.header.setTrait(e);const i=t.cols.traits;for(const t in i){const e=i[t];this.owner.cols.addTraitController(e,null,e.key)}const n=t.rows.traits;for(const t in n){const e=n[t];this.owner.rows.addTraitController(e)}const s=this.view;if(null!==s){const e=t.layout.state;null!==e&&this.owner.layoutTable(e,s)}},willDetachTrait(t){const e=t.rows.traits;for(const t in e){const i=e[t];this.owner.rows.deleteTraitController(i)}const i=t.cols.traits;for(const t in i){const e=i[t];this.owner.cols.deleteTraitController(e)}const n=t.header.trait;null!==n&&this.owner.header.deleteTrait(n)},didDetachTrait(t){this.owner.callObservers("controllerDidDetachTableTrait",t,this.owner)},traitWillSetTableLayout(t,e){this.owner.callObservers("controllerWillSetTableLayout",t,e,this.owner)},traitDidSetTableLayout(t,e){this.owner.callObservers("controllerDidSetTableLayout",t,e,this.owner)},traitWillAttachHeader(t){this.owner.header.setTrait(t)},traitDidDetachHeader(t){this.owner.header.deleteTrait(t)},traitWillAttachCol(t,e){this.owner.cols.addTraitController(t,e,t.key)},traitDidDetachCol(t){this.owner.cols.deleteTraitController(t)},traitWillAttachRow(t,e){this.owner.rows.addTraitController(t,e)},traitDidDetachRow(t){this.owner.rows.deleteTraitController(t)},viewType:zo,observesView:!0,initView(t){const e=this.owner.header.controller;null!==e&&(e.header.insertView(t),null===t.header.view&&t.header.setView(e.header.view));const i=this.owner.rows.controllers;for(const e in i){const n=i[e],s=n.row.view;null!==s&&null===s.parent&&n.row.insertView(t)}const n=this.trait;if(null!==n){const e=n.layout.state;null!==e&&this.owner.layoutTable(e,t)}},willAttachView(t){this.owner.callObservers("controllerWillAttachTableView",t,this.owner)},didDetachView(t){this.owner.callObservers("controllerDidDetachTableView",t,this.owner)},viewWillAttachHeader(t){const e=this.owner.header.controller;null!==e&&e.header.setView(t)},viewDidDetachHeader(t){const e=this.owner.header.controller;null!==e&&e.header.setView(null)}})],Ho.prototype,"table",void 0),u([so({type:Bo,binds:!0,observes:!0,get parentView(){return this.owner.table.view},getTraitViewRef:t=>t.header,initController(t){const e=this.owner.table.trait;if(null!==e){const i=e.header.trait;null!==i&&t.header.setTrait(i)}},willAttachController(t){this.owner.callObservers("controllerWillAttachHeader",t,this.owner)},didAttachController(t){const e=t.header.trait;null!==e&&this.attachHeaderTrait(e,t);const i=t.header.view;null!==i&&this.attachHeaderView(i,t)},willDetachController(t){const e=t.header.view;null!==e&&this.detachHeaderView(e,t);const i=t.header.trait;null!==i&&this.detachHeaderTrait(i,t)},didDetachController(t){this.owner.callObservers("controllerDidDetachHeader",t,this.owner)},controllerWillAttachHeaderTrait(t,e){this.owner.callObservers("controllerWillAttachHeaderTrait",t,this.owner),this.attachHeaderTrait(t,e)},controllerDidDetachHeaderTrait(t,e){this.detachHeaderTrait(t,e),this.owner.callObservers("controllerDidDetachHeaderTrait",t,this.owner)},attachHeaderTrait(t,e){},detachHeaderTrait(t,e){},controllerWillAttachHeaderView(t,e){this.owner.callObservers("controllerWillAttachHeaderView",t,this.owner),this.attachHeaderView(t,e)},controllerDidDetachHeaderView(t,e){this.detachHeaderView(t,e),this.owner.callObservers("controllerDidDetachHeaderView",t,this.owner)},attachHeaderView(t,e){},detachHeaderView(t,e){t.remove()},detectController:t=>t instanceof Bo?t:null})],Ho.prototype,"header",void 0),u([oo({type:Eo,binds:!0,observes:!0,getTraitViewRef:t=>t.col,willAttachController(t){this.owner.callObservers("controllerWillAttachCol",t,this.owner)},didAttachController(t){const e=t.col.trait;null!==e&&this.attachColTrait(e,t);const i=t.col.view;null!==i&&this.attachColView(i,t)},willDetachController(t){const e=t.col.trait;null!==e&&this.detachColTrait(e,t);const i=t.col.view;null!==i&&this.detachColView(i,t)},didDetachController(t){this.owner.callObservers("controllerDidDetachCol",t,this.owner)},controllerWillAttachColTrait(t,e){this.owner.callObservers("controllerWillAttachColTrait",t,e,this.owner),this.attachColTrait(t,e)},controllerDidDetachColTrait(t,e){this.detachColTrait(t,e),this.owner.callObservers("controllerDidDetachColTrait",t,e,this.owner)},attachColTrait(t,e){},detachColTrait(t,e){},controllerWillSetColLayout(t,e,i){this.owner.callObservers("controllerWillSetColLayout",t,e,i,this.owner)},controllerDidSetColLayout(t,e,i){this.owner.callObservers("controllerDidSetColLayout",t,e,i,this.owner)},controllerWillAttachColView(t,e){this.owner.callObservers("controllerWillAttachColView",t,e,this.owner),this.attachColView(t,e)},controllerDidDetachColView(t,e){this.detachColView(t,e),this.owner.callObservers("controllerDidDetachColView",t,e,this.owner)},attachColView(t,e){const i=t.label.view;null!==i&&this.attachColLabelView(i,e)},detachColView(t,e){const i=t.label.view;null!==i&&this.detachColLabelView(i,e),t.remove()},controllerWillAttachColLabelView(t,e){this.owner.callObservers("controllerWillAttachColLabelView",t,e,this.owner),this.attachColLabelView(t,e)},controllerDidDetachColLabelView(t,e){this.detachColLabelView(t,e),this.owner.callObservers("controllerDidDetachColLabelView",t,e,this.owner)},attachColLabelView(t,e){},detachColLabelView(t,e){}})],Ho.prototype,"cols",void 0),u([oo({type:Lo,binds:!0,observes:!0,get parentView(){return this.owner.table.view},getTraitViewRef:t=>t.row,willAttachController(t){this.owner.callObservers("controllerWillAttachRow",t,this.owner)},didAttachController(t){const e=t.row.trait;null!==e&&this.attachRowTrait(e,t);const i=t.row.view;null!==i&&this.attachRowView(i,t)},willDetachController(t){const e=t.row.view;null!==e&&this.detachRowView(e,t);const i=t.row.trait;null!==i&&this.detachRowTrait(i,t)},didDetachController(t){this.owner.callObservers("controllerDidDetachRow",t,this.owner)},controllerWillAttachRowTrait(t,e){this.owner.callObservers("controllerWillAttachRowTrait",t,e,this.owner),this.attachRowTrait(t,e)},controllerDidDetachRowTrait(t,e){this.detachRowTrait(t,e),this.owner.callObservers("controllerDidDetachRowTrait",t,e,this.owner)},attachRowTrait(t,e){},detachRowTrait(t,e){},controllerWillAttachRowView(t,e){this.owner.callObservers("controllerWillAttachRowView",t,e,this.owner),this.attachRowView(t,e)},controllerDidDetachRowView(t,e){this.detachRowView(t,e),this.owner.callObservers("controllerDidDetachRowView",t,e,this.owner)},attachRowView(t,e){},detachRowView(t,e){t.remove()},controllerWillAttachLeafTrait(t,e){this.owner.callObservers("controllerWillAttachLeafTrait",t,e,this.owner),this.attachLeafTrait(t,e)},controllerDidDetachLeafTrait(t,e){this.detachLeafTrait(t,e),this.owner.callObservers("controllerDidDetachLeafTrait",t,e,this.owner)},attachLeafTrait(t,e){},detachLeafTrait(t,e){},controllerWillAttachLeafView(t,e){this.owner.callObservers("controllerWillAttachLeafView",t,e,this.owner),this.attachLeafView(t,e)},controllerDidDetachLeafView(t,e){this.detachLeafView(t,e),this.owner.callObservers("controllerDidDetachLeafView",t,e,this.owner)},attachLeafView(t,e){},detachLeafView(t,e){},controllerWillAttachCell(t,e){this.owner.callObservers("controllerWillAttachCell",t,e,this.owner),this.attachCell(t,e)},controllerDidDetachCell(t,e){this.detachCell(t,e),this.owner.callObservers("controllerDidDetachCell",t,e,this.owner)},attachCell(t,e){const i=t.cell.trait;null!==i&&this.attachCellTrait(i,t,e);const n=t.cell.view;null!==n&&this.attachCellView(n,t,e)},detachCell(t,e){const i=t.cell.trait;null!==i&&this.detachCellTrait(i,t,e);const n=t.cell.view;null!==n&&this.detachCellView(n,t,e)},controllerWillAttachCellTrait(t,e,i){this.owner.callObservers("controllerWillAttachCellTrait",t,e,i,this.owner),this.attachCellTrait(t,e,i)},controllerDidDetachCellTrait(t,e,i){this.detachCellTrait(t,e,i),this.owner.callObservers("controllerDidDetachCellTrait",t,e,i,this.owner)},attachCellTrait(t,e,i){},detachCellTrait(t,e,i){},controllerWillAttachCellView(t,e,i){this.owner.callObservers("controllerWillAttachCellView",t,e,i,this.owner),this.attachCellView(t,e,i)},controllerDidDetachCellView(t,e,i){this.detachCellView(t,e,i),this.owner.callObservers("controllerDidDetachCellView",t,e,i,this.owner)},attachCellView(t,e,i){if(t instanceof mo){const n=t.content.view;null!==n&&this.attachCellContentView(n,e,i)}},detachCellView(t,e,i){if(t instanceof mo){const n=t.content.view;null!==n&&this.detachCellContentView(n,e,i)}},controllerWillAttachCellContentView(t,e,i){this.owner.callObservers("controllerWillAttachCellContentView",t,e,i,this.owner),this.attachCellContentView(t,e,i)},controllerDidDetachCellContentView(t,e,i){this.detachCellContentView(t,e,i),this.owner.callObservers("controllerDidDetachCellContentView",t,e,i,this.owner)},attachCellContentView(t,e,i){},detachCellContentView(t,e,i){},controllerWillSetCellIcon(t,e,i,n){this.owner.callObservers("controllerWillSetCellIcon",t,e,i,n,this.owner)},controllerDidSetCellIcon(t,e,i,n){this.owner.callObservers("controllerDidSetCellIcon",t,e,i,n,this.owner)},controllerWillAttachTree(t,e){this.owner.callObservers("controllerWillAttachTree",t,e,this.owner),this.attachTree(t,e)},controllerDidDetachTree(t,e){this.detachTree(t,e),this.owner.callObservers("controllerDidDetachTree",t,e,this.owner)},attachTree(t,e){const i=t.table.trait;null!==i&&this.attachTreeTrait(i,t,e);const n=t.table.view;null!==n&&this.attachTreeView(n,t,e)},detachTree(t,e){const i=t.table.trait;null!==i&&this.detachTreeTrait(i,t,e);const n=t.table.view;null!==n&&this.detachTreeView(n,t,e)},controllerWillAttachTreeTrait(t,e,i){this.owner.callObservers("controllerWillAttachTreeTrait",t,e,i,this.owner),this.attachTreeTrait(t,e,i)},controllerDidDetachTreeTrait(t,e,i){this.detachTreeTrait(t,e,i),this.owner.callObservers("controllerDidDetachTreeTrait",t,e,i,this.owner)},attachTreeTrait(t,e,i){},detachTreeTrait(t,e,i){},controllerWillAttachTreeView(t,e,i){this.owner.callObservers("controllerWillAttachTreeView",t,e,i,this.owner),this.attachTreeView(t,e,i)},controllerDidDetachTreeView(t,e,i){this.detachTreeView(t,e,i),this.owner.callObservers("controllerDidDetachTreeView",t,e,i,this.owner)},attachTreeView(t,e,i){},detachTreeView(t,e,i){},controllerWillExpandRowView(t,e){this.owner.callObservers("controllerWillExpandRowView",t,e,this.owner)},controllerDidExpandRowView(t,e){this.owner.callObservers("controllerDidExpandRowView",t,e,this.owner)},controllerWillCollapseRowView(t,e){this.owner.callObservers("controllerWillCollapseRowView",t,e,this.owner)},controllerDidCollapseRowView(t,e){this.owner.callObservers("controllerDidCollapseRowView",t,e,this.owner)}})],Ho.prototype,"rows",void 0);class qo extends Kn{constructor(t){super(t),this.displayState=qo.HiddenState,this.onClick=this.onClick.bind(this),"undefined"!=typeof PointerEvent?(this.onSyntheticClick=this.onSyntheticClick.bind(this),this.on("pointerup",this.onClick),this.on("click",this.onSyntheticClick)):"undefined"!=typeof TouchEvent?(this.onSyntheticClick=this.onSyntheticClick.bind(this),this.on("touchend",this.onClick),this.on("click",this.onSyntheticClick)):this.on("click",this.onClick),this.initScrim()}initScrim(){this.addClass("scrim"),this.display.setState("none",i.Affinity.Intrinsic),this.position.setState("absolute",i.Affinity.Intrinsic),this.top.setState(0,i.Affinity.Intrinsic),this.right.setState(0,i.Affinity.Intrinsic),this.bottom.setState(0,i.Affinity.Intrinsic),this.left.setState(0,i.Affinity.Intrinsic),this.pointerEvents.setState("auto",i.Affinity.Intrinsic),this.cursor.setState("pointer",i.Affinity.Intrinsic),this.backgroundColor.setState(z.black(0),i.Affinity.Intrinsic)}setDisplayState(t){this.displayState=t}isShown(){switch(this.displayState){case qo.ShownState:case qo.ShowingState:case qo.ShowState:return!0;default:return!1}}isHidden(){switch(this.displayState){case qo.HiddenState:case qo.HidingState:case qo.HideState:return!0;default:return!1}}show(t,n){this.isHidden()&&(n=void 0===n||!0===n?this.getLookOr(At.timing,!1):e.Timing.fromAny(n),this.setDisplayState(qo.ShowState),!1!==n?(this.backgroundColor.setState(z.black(0),i.Affinity.Intrinsic),this.backgroundColor.setState(z.black(t),n,i.Affinity.Intrinsic)):(this.willShow(),this.backgroundColor.setState(z.black(t),i.Affinity.Intrinsic),this.didShow()))}willShow(){this.setDisplayState(qo.ShowingState),this.display.setState("block",i.Affinity.Intrinsic)}didShow(){this.setDisplayState(qo.ShownState)}hide(t){this.isShown()&&(t=void 0===t||!0===t?this.getLookOr(At.timing,!1):e.Timing.fromAny(t),this.setDisplayState(qo.HideState),!1!==t?this.backgroundColor.setState(z.black(0),t,i.Affinity.Intrinsic):(this.willHide(),this.backgroundColor.setState(z.black(0),i.Affinity.Intrinsic),this.didHide()))}willHide(){this.setDisplayState(qo.HidingState)}didHide(){this.setDisplayState(qo.HiddenState),this.display.setState("none",i.Affinity.Intrinsic)}onMount(){super.onMount();const t=this.modalProvider.service;null!=t&&(t.observe(this),this.serviceDidUpdateModality(t.modality,0,t))}onUnmount(){const t=this.modalProvider.service;null!=t&&t.unobserve(this),this.hide(!1),super.onUnmount()}serviceDidUpdateModality(t,e,n){if(0!==t){const n=.5*t;0===e?this.show(n):(this.backgroundColor.setState(z.black(n),i.Affinity.Intrinsic),this.displayState===qo.ShowingState&&this.didShow())}else this.hide()}onClick(t){const e=this.modalProvider.service;null!=e&&e.displaceModals(t)}onSyntheticClick(t){t.preventDefault(),t.stopPropagation()}}qo.HiddenState=0,qo.HidingState=1,qo.HideState=2,qo.ShownState=3,qo.ShowingState=4,qo.ShowState=5,u([Pn({propertyNames:"background-color",type:z,state:null,willTransition(){const t=this.owner.displayState;t===qo.ShowState?this.owner.willShow():t===qo.HideState&&this.owner.willHide()},didTransition(){const t=this.owner.displayState;t===qo.ShowingState?this.owner.didShow():t===qo.HidingState&&this.owner.didHide()}})],qo.prototype,"backgroundColor",void 0);class Go extends Kn{constructor(t){super(t),this.sourceFrame=null,this.displayState=Go.HiddenState,this.modality=!1,this.allowedPlacement=["top","bottom","right","left"],this.currentPlacement="none",this.onClick=this.onClick.bind(this),this.initArrow()}initArrow(){const t=this.createArrow();null!==t&&this.prependChild(t,"arrow")}createArrow(){const t=Kn.fromTag("div");return t.addClass("popover-arrow"),t.display.setState("none",i.Affinity.Intrinsic),t.position.setState("absolute",i.Affinity.Intrinsic),t.width.setState(0,i.Affinity.Intrinsic),t.height.setState(0,i.Affinity.Intrinsic),t}setDisplayState(t){this.displayState=t}setSource(t){this.source.setView(t)}get modalView(){return this}get modalState(){switch(this.displayState){case Go.HiddenState:return"hidden";case Go.HidingState:case Go.HideState:return"hiding";case Go.ShownState:return"shown";case Go.ShowingState:case Go.ShowState:return"showing";default:throw new Error(""+this.displayState)}}isShown(){switch(this.displayState){case Go.ShownState:case Go.ShowingState:case Go.ShowState:return!0;default:return!1}}isHidden(){switch(this.displayState){case Go.HiddenState:case Go.HidingState:case Go.HideState:return!0;default:return!1}}showModal(t,i){this.isHidden()&&(i=void 0===i||!0===i?this.getLookOr(At.timing,!1):e.Timing.fromAny(i),void 0!==t.modal&&(this.modality=t.modal),this.setDisplayState(Go.ShowState),!1!==i?this.displayPhase.setState(1,i):(this.willShow(),this.didShow()))}willShow(){this.setDisplayState(Go.ShowingState);const t=this.observers;for(let e=0,i=t.length;e<i;e+=1){const i=t[e];void 0!==i.popoverWillShow&&i.popoverWillShow(this)}this.place(),this.visibility.setState("visible",i.Affinity.Intrinsic)}didShow(){this.setDisplayState(Go.ShownState),this.pointerEvents.setState("auto",i.Affinity.Intrinsic),this.marginTop.setState(null,i.Affinity.Intrinsic),this.opacity.setState(void 0,i.Affinity.Intrinsic);const t=this.observers;for(let e=0,i=t.length;e<i;e+=1){const i=t[e];void 0!==i.popoverDidShow&&i.popoverDidShow(this)}}hideModal(t){this.isShown()&&(t=void 0===t||!0===t?this.getLookOr(At.timing,!1):e.Timing.fromAny(t),this.setDisplayState(Go.HideState),!1!==t?this.displayPhase.setState(0,t):(this.willHide(),this.didHide()))}willHide(){this.setDisplayState(Go.HidingState);const t=this.observers;for(let e=0,i=t.length;e<i;e+=1){const i=t[e];void 0!==i.popoverWillHide&&i.popoverWillHide(this)}this.pointerEvents.setState("none",i.Affinity.Intrinsic)}didHide(){this.setDisplayState(Go.HiddenState),this.visibility.setState("hidden",i.Affinity.Intrinsic),this.marginTop.setState(null,i.Affinity.Intrinsic),this.opacity.setState(void 0,i.Affinity.Intrinsic);const t=this.observers;for(let e=0,i=t.length;e<i;e+=1){const i=t[e];void 0!==i.popoverDidHide&&i.popoverDidHide(this)}}placement(t){return void 0===t?this.allowedPlacement:(e.Arrays.equal(this.allowedPlacement,t)||(this.allowedPlacement.length=0,this.allowedPlacement.push(...t),this.place()),this)}onMount(){super.onMount(),this.attachEvents()}onUnmount(){super.onUnmount(),this.detachEvents()}attachEvents(){this.on("click",this.onClick)}detachEvents(){this.off("click",this.onClick)}needsProcess(t,e){return 0!=(t&(fn.NeedsScroll|fn.NeedsAnimate))&&this.requireUpdate(fn.NeedsLayout),t}onAnimate(t){super.onAnimate(t);const e=this.displayState;e===Go.ShowState?this.willShow():e===Go.HideState?this.willHide():e!==Go.ShowingState||this.displayPhase.tweening?e!==Go.HidingState||this.displayPhase.tweening||this.didHide():this.didShow(),this.displayPhase.tweening&&this.applyDisplayPhase(this.displayPhase.value)}applyDisplayPhase(t){const e=this.currentPlacement;"above"===e?(this.opacity.setState(void 0,i.Affinity.Intrinsic),this.marginTop.setState((1-t)*-this.node.clientHeight,i.Affinity.Intrinsic)):"below"===e?(this.opacity.setState(void 0,i.Affinity.Intrinsic),this.marginTop.setState((1-t)*this.node.clientHeight,i.Affinity.Intrinsic)):(this.marginTop.setState(null,i.Affinity.Intrinsic),this.opacity.setState(t,i.Affinity.Intrinsic))}onLayout(t){super.onLayout(t),this.place()}place(t=!1){const e=this.source.view,i=this.sourceFrame,n=null!==e?e.popoverFrame:null;if(null===n||0===this.allowedPlacement.length||!t&&n.equals(i))return"none";{this.sourceFrame=null;const t=this.placePopover(e,n),i=this.getChild("arrow");return i instanceof Kn&&this.placeArrow(e,n,i,t),t}}placePopover(t,e){const n=this.node,o=n.offsetParent;if(null===o)return"none";const r=n.clientWidth,l=n.clientHeight,a=o.getBoundingClientRect(),h=a.left,d=a.top,c=e.left-window.pageXOffset-h,u=e.right-window.pageXOffset-h,p=e.top-window.pageYOffset-d,f=e.bottom-window.pageYOffset-d,g=e.width,v=e.height,y=c+g/2,w=p+v/2,m=this.placementFrame.state,b=null!==m?m.left:0,C=(null!==m?m.right:window.innerWidth)-h,S=null!==m?m.top:0,A=(null!==m?m.bottom:window.innerHeight)-d,x=c-b-window.pageXOffset,D=C-c-g,T=p-S-window.pageYOffset,P=A-p-v,V=this.dropdown.state,I=this.arrowHeight.getValue().pxValue(),M=this.placementGap.getValue().pxValue();let R;const F=this.allowedPlacement;for(let t=0,e=F.length;t<e;t+=1){const e=F[t];if("above"===e||"below"===e||"over"===e){R=e;break}if("top"===e&&l+I+M<=T){R=e;break}if("bottom"===e&&l+I+M<=P){R=e;break}if("left"===e&&r+I+M<=x){R=e;break}if("right"===e&&r+I+M<=D){R=e;break}}if(void 0===R){R="none";for(let t=0,e=F.length;t<e;t+=1){const e=F[t];if("top"===e&&T>=P){R=e;break}if("bottom"===e&&P>=T){R=e;break}if("left"===e&&x>=D){R=e;break}if("right"===e&&D>=x){R=e;break}}}let L=n.offsetLeft,k=n.offsetTop,O=null,E=null,W=this.width.state;W=W instanceof s.Length?W.pxValue():null;let N=this.height.state;N=N instanceof s.Length?N.pxValue():null;let B=W,z=N,U=this.maxWidth.state;U=U instanceof s.Length?U.pxValue():null;let H=this.maxHeight.state;H=H instanceof s.Length?H.pxValue():null;let q=U,G=H;return"above"===R?(L=Math.round(b),k=Math.round(S),O=Math.round((null!==m?m.width:window.innerWidth)-C),B=Math.round(Math.max(0,C-b)),z=null,q=null,G=Math.round(Math.max(0,A-S))):"below"===R?(L=Math.round(b),k=Math.round(A-l),O=Math.round(C-(null!==m?m.width:window.innerWidth)),B=Math.round(Math.max(0,C-b)),z=null,q=null,G=Math.round(Math.max(0,A-S))):"over"===R?(L=Math.round(b),k=Math.round(S),O=Math.round(C-(null!==m?m.width:window.innerWidth)),E=Math.round(A-(null!==m?m.height:window.innerHeight)),B=Math.round(Math.max(0,C-b)),z=Math.round(Math.max(0,A-S)),q=null,G=null):"top"!==R||V?"bottom"!==R||V?"left"!==R||V?"right"!==R||V?"top"===R&&V?(L=Math.max(b,c),k=Math.round(Math.max(S,p-(l+M))),B=Math.round(Math.max(0,Math.min(g,C-c))),z=null,q=Math.round(Math.max(0,C-b)),G=Math.round(Math.max(0,f-S))):"bottom"===R&&V?(L=Math.max(b,c),k=Math.round(Math.max(S,f+M)),B=Math.round(Math.max(0,Math.min(g,C-c))),z=null,q=Math.round(Math.max(0,C-b)),G=Math.round(Math.max(0,A-p))):"left"===R&&V?(L=Math.round(Math.max(b,c-(r+M))),k=Math.max(S,p),B=null,z=Math.round(Math.max(0,Math.min(v,A-p))),q=Math.round(Math.max(0,u-b)),G=Math.round(Math.max(0,A-S))):"right"===R&&V&&(L=Math.round(Math.max(b,u+M)),k=Math.max(S,p),B=null,z=Math.round(Math.max(0,Math.min(v,A-p))),q=Math.round(Math.max(0,C-c)),G=Math.round(Math.max(0,A-S))):(L=Math.round(Math.max(b,u+I+M)),k=w-l/2<=S?Math.round(S):w+l/2>=A?Math.round(A-l):Math.round(w-l/2),q=Math.round(Math.max(0,C-c)),G=Math.round(Math.max(0,A-S))):(L=Math.round(Math.max(b,c-(r+I+M))),k=w-l/2<=S?Math.round(S):w+l/2>=A?Math.round(A-l):Math.round(w-l/2),q=Math.round(Math.max(0,u-b)),G=Math.round(Math.max(0,A-S))):(L=y-r/2<=b?Math.round(b):y+r/2>=C?Math.round(C-r):Math.round(y-r/2),k=Math.round(Math.max(S,f+I+M)),q=Math.round(Math.max(0,C-b)),G=Math.round(Math.max(0,A-p))):(L=y-r/2<=b?Math.round(b):y+r/2>=C?Math.round(C-r):Math.round(y-r/2),k=Math.round(Math.max(S,p-(l+I+M))),q=Math.round(Math.max(0,C-b)),G=Math.round(Math.max(0,f-S))),"none"!==R&&(L!==n.offsetLeft&&this.left.hasAffinity(i.Affinity.Intrinsic)||k!==n.offsetTop&&this.top.hasAffinity(i.Affinity.Intrinsic)||B!==W&&this.width.hasAffinity(i.Affinity.Intrinsic)||z!==N&&this.height.hasAffinity(i.Affinity.Intrinsic)||q!==U&&this.maxWidth.hasAffinity(i.Affinity.Intrinsic)||G!==H&&this.maxHeight.hasAffinity(i.Affinity.Intrinsic))&&(this.willPlacePopover(R),this.position.setState("absolute",i.Affinity.Intrinsic),this.left.setState(L,i.Affinity.Intrinsic),this.right.setState(O,i.Affinity.Intrinsic),this.top.setState(k,i.Affinity.Intrinsic),this.bottom.setState(E,i.Affinity.Intrinsic),this.width.setState(B,i.Affinity.Intrinsic),this.height.setState(z,i.Affinity.Intrinsic),this.maxWidth.setState(q,i.Affinity.Intrinsic),this.maxHeight.setState(G,i.Affinity.Intrinsic),this.onPlacePopover(R),this.didPlacePopover(R)),this.currentPlacement=R,R}willPlacePopover(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.popoverWillPlace&&n.popoverWillPlace(t,this)}}onPlacePopover(t){}didPlacePopover(t){const e=this.observers;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];void 0!==n.popoverDidPlace&&n.popoverDidPlace(t,this)}}placeArrow(t,e,n,o){const r=this.node,l=r.offsetParent;if(null===l)return;const a=l.getBoundingClientRect(),h=a.left,d=a.top,c=e.left-window.pageXOffset-h,u=e.top-window.pageYOffset-d,p=c+e.width/2,f=u+e.height/2,g=r.offsetLeft,v=g+r.clientWidth,y=r.offsetTop,w=y+r.clientHeight;let m=this.backgroundColor.value;null===m&&(m=z.transparent());const b=this.borderRadius(),C=b instanceof s.Length?b.pxValue():0,S=this.arrowWidth.getValue().pxValue(),A=this.arrowHeight.getValue().pxValue(),x=g+C+S/2,D=v-C-S/2,T=y+C+S/2,P=w-C-S/2;n.top.setState(null,i.Affinity.Intrinsic),n.right.setState(null,i.Affinity.Intrinsic),n.bottom.setState(null,i.Affinity.Intrinsic),n.left.setState(null,i.Affinity.Intrinsic),n.borderLeftWidth.setState(null,i.Affinity.Intrinsic),n.borderLeftStyle.setState(void 0,i.Affinity.Intrinsic),n.borderLeftColor.setState(null,i.Affinity.Intrinsic),n.borderRightWidth.setState(null,i.Affinity.Intrinsic),n.borderRightStyle.setState(void 0,i.Affinity.Intrinsic),n.borderRightColor.setState(null,i.Affinity.Intrinsic),n.borderTopWidth.setState(null,i.Affinity.Intrinsic),n.borderTopStyle.setState(void 0,i.Affinity.Intrinsic),n.borderTopColor.setState(null,i.Affinity.Intrinsic),n.borderBottomWidth.setState(null,i.Affinity.Intrinsic),n.borderBottomStyle.setState(void 0,i.Affinity.Intrinsic),n.borderBottomColor.setState(null,i.Affinity.Intrinsic),n.zIndex.setState(100,i.Affinity.Intrinsic),"none"===o||"above"===o||"below"===o||"over"===o?n.display.setState("none",i.Affinity.Intrinsic):Math.round(f)<=Math.round(y-A)&&x<=p&&p<=D?(n.display.setState("block",i.Affinity.Intrinsic),n.top.setState(Math.round(-A),i.Affinity.Intrinsic),n.left.setState(Math.round(p-g-S/2),i.Affinity.Intrinsic),n.borderLeftWidth.setState(Math.round(S/2),i.Affinity.Intrinsic),n.borderLeftStyle.setState("solid",i.Affinity.Intrinsic),n.borderLeftColor.setState(z.transparent(),i.Affinity.Intrinsic),n.borderRightWidth.setState(Math.round(S/2),i.Affinity.Intrinsic),n.borderRightStyle.setState("solid",i.Affinity.Intrinsic),n.borderRightColor.setState(z.transparent(),i.Affinity.Intrinsic),n.borderBottomWidth.setState(Math.round(A),i.Affinity.Intrinsic),n.borderBottomStyle.setState("solid",i.Affinity.Intrinsic),n.borderBottomColor.setState(m,i.Affinity.Intrinsic)):Math.round(w+A)<=Math.round(f)&&x<=p&&p<=D?(n.display.setState("block",i.Affinity.Intrinsic),n.bottom.setState(Math.round(-A),i.Affinity.Intrinsic),n.left.setState(Math.round(p-g-S/2),i.Affinity.Intrinsic),n.borderLeftWidth.setState(Math.round(S/2),i.Affinity.Intrinsic),n.borderLeftStyle.setState("solid",i.Affinity.Intrinsic),n.borderLeftColor.setState(z.transparent(),i.Affinity.Intrinsic),n.borderRightWidth.setState(Math.round(S/2),i.Affinity.Intrinsic),n.borderRightStyle.setState("solid",i.Affinity.Intrinsic),n.borderRightColor.setState(z.transparent(),i.Affinity.Intrinsic),n.borderTopWidth.setState(Math.round(A),i.Affinity.Intrinsic),n.borderTopStyle.setState("solid",i.Affinity.Intrinsic),n.borderTopColor.setState(m,i.Affinity.Intrinsic)):Math.round(p)<=Math.round(g-A)&&T<=f&&f<=P?(n.display.setState("block"),n.left.setState(Math.round(-A),i.Affinity.Intrinsic),n.top.setState(Math.round(f-y-S/2),i.Affinity.Intrinsic),n.borderTopWidth.setState(Math.round(S/2),i.Affinity.Intrinsic),n.borderTopStyle.setState("solid",i.Affinity.Intrinsic),n.borderTopColor.setState(z.transparent(),i.Affinity.Intrinsic),n.borderBottomWidth.setState(Math.round(S/2),i.Affinity.Intrinsic),n.borderBottomStyle.setState("solid",i.Affinity.Intrinsic),n.borderBottomColor.setState(z.transparent(),i.Affinity.Intrinsic),n.borderRightWidth.setState(Math.round(A),i.Affinity.Intrinsic),n.borderRightStyle.setState("solid",i.Affinity.Intrinsic),n.borderRightColor.setState(m,i.Affinity.Intrinsic)):Math.round(v+A)<=Math.round(p)&&T<=f&&f<=P?(n.display.setState("block",i.Affinity.Intrinsic),n.right.setState(Math.round(-A),i.Affinity.Intrinsic),n.top.setState(Math.round(f-y-S/2),i.Affinity.Intrinsic),n.borderTopWidth.setState(Math.round(S/2),i.Affinity.Intrinsic),n.borderTopStyle.setState("solid",i.Affinity.Intrinsic),n.borderTopColor.setState(z.transparent(),i.Affinity.Intrinsic),n.borderBottomWidth.setState(Math.round(S/2),i.Affinity.Intrinsic),n.borderBottomStyle.setState("solid",i.Affinity.Intrinsic),n.borderBottomColor.setState(z.transparent(),i.Affinity.Intrinsic),n.borderLeftWidth.setState(Math.round(A),i.Affinity.Intrinsic),n.borderLeftStyle.setState("solid",i.Affinity.Intrinsic),n.borderLeftColor.setState(m,i.Affinity.Intrinsic)):n.display.setState("none",i.Affinity.Intrinsic)}onClick(t){t.stopPropagation()}init(t){super.init(t),void 0!==t.source&&this.source.setView(t.source),void 0!==t.placement&&this.placement(t.placement),void 0!==t.placementFrame&&this.placementFrame(t.placementFrame),void 0!==t.arrowWidth&&this.arrowWidth(t.arrowWidth),void 0!==t.arrowHeight&&this.arrowHeight(t.arrowHeight)}}Go.HiddenState=0,Go.HidingState=1,Go.HideState=2,Go.ShownState=3,Go.ShowingState=4,Go.ShowState=5,u([Pn({propertyNames:"background-color",type:z,state:null,didSetValue(t,e){this.owner.place()}})],Go.prototype,"backgroundColor",void 0),u([Ht({type:Number,state:0})],Go.prototype,"displayPhase",void 0),u([Ht({type:s.Length,state:s.Length.zero()})],Go.prototype,"placementGap",void 0),u([Ht({type:s.Length,state:s.Length.px(10)})],Go.prototype,"arrowWidth",void 0),u([Ht({type:s.Length,state:s.Length.px(8)})],Go.prototype,"arrowHeight",void 0),u([vn({observes:!0,willAttachView(t){this.owner.callObservers("popoverWillAttachSource",t,this.owner)},didAttachView(t){this.owner.requireUpdate(fn.NeedsLayout)},didDetachView(t){this.owner.callObservers("popoverDidDetachSource",t,this.owner)},viewDidMount(t){this.owner.place()},viewDidResize(t,e){this.owner.place()},viewDidScroll(t,e){this.owner.place()},viewDidAnimate(t,e){this.owner.place()},viewDidLayout(t,e){this.owner.place()},viewDidProject(t,e){this.owner.place()},viewDidSetAttribute(t,e,i){this.owner.place()},viewDidSetStyle(t,e,i,n){this.owner.place()}})],Go.prototype,"source",void 0),u([i.Property({type:s.R2Box,state:null,didSetState(t){this.owner.place()},fromAny:t=>null!==t?s.R2Box.fromAny(t):null})],Go.prototype,"placementFrame",void 0),u([i.Property({type:Boolean,state:!1,didSetState(t){this.owner.place()}})],Go.prototype,"dropdown",void 0);class jo extends Kn{constructor(t){super(t),this.modality=!0,this.initDrawer()}initDrawer(){this.addClass("drawer"),this.display.setState("flex",i.Affinity.Intrinsic),this.overflowX.setState("hidden",i.Affinity.Intrinsic),this.overflowY.setState("auto",i.Affinity.Intrinsic),this.overscrollBehaviorY.setState("contain",i.Affinity.Intrinsic),this.overflowScrolling.setState("touch",i.Affinity.Intrinsic)}isHorizontal(){return"top"===this.placement.state||"bottom"===this.placement.state}isVertical(){return"left"===this.placement.state||"right"===this.placement.state}willSetPlacement(t,e){const i=this.observers;for(let n=0,s=i.length;n<s;n+=1){const s=i[n];void 0!==s.viewWillSetPlacement&&s.viewWillSetPlacement(t,e,this)}}onSetPlacement(t,e){}didSetPlacement(t,e){const i=this.observers;for(let n=0,s=i.length;n<s;n+=1){const s=i[n];void 0!==s.viewDidSetPlacement&&s.viewDidSetPlacement(t,e,this)}}willPresent(){const t=this.observers;for(let e=0,i=t.length;e<i;e+=1){const i=t[e];void 0!==i.viewWillPresent&&i.viewWillPresent(this)}}didPresent(){const t=this.observers;for(let e=0,i=t.length;e<i;e+=1){const i=t[e];void 0!==i.viewDidPresent&&i.viewDidPresent(this)}}willDismiss(){const t=this.modalProvider.service;null!=t&&t.dismissModal(this);const e=this.observers;for(let t=0,i=e.length;t<i;t+=1){const i=e[t];void 0!==i.viewWillDismiss&&i.viewWillDismiss(this)}}didDismiss(){const t=this.observers;for(let e=0,i=t.length;e<i;e+=1){const i=t[e];void 0!==i.viewDidDismiss&&i.viewDidDismiss(this)}}willExpand(){const t=this.modalProvider.service;null!=t&&t.dismissModal(this);const e=this.observers;for(let t=0,i=e.length;t<i;t+=1){const i=e[t];void 0!==i.viewWillExpand&&i.viewWillExpand(this)}}didExpand(){const t=this.observers;for(let e=0,i=t.length;e<i;e+=1){const i=t[e];void 0!==i.viewDidExpand&&i.viewDidExpand(this)}}willCollapse(){const t=this.modalProvider.service;null!=t&&t.dismissModal(this);const e=this.observers;for(let t=0,i=e.length;t<i;t+=1){const i=e[t];void 0!==i.viewWillCollapse&&i.viewWillCollapse(this)}}didCollapse(){const t=this.observers;for(let e=0,i=t.length;e<i;e+=1){const i=t[e];void 0!==i.viewDidCollapse&&i.viewDidCollapse(this)}}onLayout(t){super.onLayout(t),this.display.setState(this.slide.dismissed?"none":"flex",i.Affinity.Intrinsic),this.layoutDrawer(t),"mobile"===t.viewportIdiom?this.boxShadow.setState(this.getLookOr(At.shadow,Et.floating,null),i.Affinity.Intrinsic):this.boxShadow.setState(this.getLookOr(At.shadow,null),i.Affinity.Intrinsic)}layoutDrawer(t){const e=this.placement.state;"top"===e?this.layoutDrawerTop(t):"right"===e?this.layoutDrawerRight(t):"bottom"===e?this.layoutDrawerBottom(t):"left"===e&&this.layoutDrawerLeft(t)}layoutDrawerTop(t){const e=this.slide.getPhase();this.addClass("drawer-top").removeClass("drawer-right").removeClass("drawer-bottom").removeClass("drawer-left"),this.position.setState("fixed",i.Affinity.Intrinsic),this.width.setState(null,i.Affinity.Intrinsic),this.height.setState(null,i.Affinity.Intrinsic),this.left.setState(s.Length.zero(),i.Affinity.Intrinsic),this.right.setState(s.Length.zero(),i.Affinity.Intrinsic),this.bottom.setState(null,i.Affinity.Intrinsic);let n=this.height.value;null===n&&(n=s.Length.px(this.node.offsetHeight)),this.top.setState(n.times(e-1),i.Affinity.Intrinsic),this.effectiveWidth.setState(this.width.value),this.effectiveHeight.setState(n.times(e),i.Affinity.Intrinsic);let o=this.edgeInsets.superState;null==o&&(o=t.viewport.safeArea),this.edgeInsets.setState({insetTop:0,insetRight:o.insetRight,insetBottom:0,insetLeft:o.insetLeft},i.Affinity.Intrinsic),this.stretch.collapsed&&this.expand()}layoutDrawerRight(t){const e=this.stretch.getPhase(),n=this.slide.getPhase();let o;if(this.removeClass("drawer-top").addClass("drawer-right").removeClass("drawer-bottom").removeClass("drawer-left"),this.position.setState("fixed",i.Affinity.Intrinsic),this.height.setState(null,i.Affinity.Intrinsic),this.top.setState(s.Length.zero(),i.Affinity.Intrinsic),this.bottom.setState(s.Length.zero(),i.Affinity.Intrinsic),this.left.setState(null,i.Affinity.Intrinsic),this.width.hasAffinity(i.Affinity.Intrinsic)){const t=this.collapsedWidth.getValue(),i=this.expandedWidth.getValue();o=t.times(1-e).plus(i.times(e))}else o=this.width.value,null===o&&(o=s.Length.px(this.node.offsetWidth));this.width.setState(o,i.Affinity.Intrinsic),this.right.setState(o.times(n-1),i.Affinity.Intrinsic),this.effectiveWidth.setState(o.times(n),i.Affinity.Intrinsic),this.effectiveHeight.setState(this.height.value,i.Affinity.Intrinsic);let r=this.edgeInsets.superState;null!=r&&null!==r||(r=t.viewport.safeArea),this.paddingTop.setState(s.Length.px(r.insetTop),i.Affinity.Intrinsic),this.paddingBottom.setState(s.Length.px(r.insetBottom),i.Affinity.Intrinsic),this.edgeInsets.setState({insetTop:0,insetRight:r.insetRight,insetBottom:0,insetLeft:0},i.Affinity.Intrinsic)}layoutDrawerBottom(t){const e=this.slide.getPhase();this.removeClass("drawer-top").removeClass("drawer-right").addClass("drawer-bottom").removeClass("drawer-left"),this.position.setState("fixed",i.Affinity.Intrinsic),this.width.setState(null,i.Affinity.Intrinsic),this.height.setState(null,i.Affinity.Intrinsic),this.left.setState(s.Length.zero(),i.Affinity.Intrinsic),this.right.setState(s.Length.zero(),i.Affinity.Intrinsic),this.top.setState(null,i.Affinity.Intrinsic);let n=this.height.value;null===n&&(n=s.Length.px(this.node.offsetHeight)),this.bottom.setState(n.times(e-1),i.Affinity.Intrinsic),this.effectiveWidth.setState(this.width.value,i.Affinity.Intrinsic),this.effectiveHeight.setState(n.times(e),i.Affinity.Intrinsic);let o=this.edgeInsets.superState;null!=o&&null!==o||(o=t.viewport.safeArea),this.edgeInsets.setState({insetTop:0,insetRight:o.insetRight,insetBottom:0,insetLeft:o.insetLeft},i.Affinity.Intrinsic),this.stretch.collapsed&&this.expand()}layoutDrawerLeft(t){const e=this.stretch.getPhase(),n=this.slide.getPhase();let o;if(this.removeClass("drawer-top").removeClass("drawer-right").removeClass("drawer-bottom").addClass("drawer-left"),this.position.setState("fixed",i.Affinity.Intrinsic),this.height.setState(null,i.Affinity.Intrinsic),this.top.setState(s.Length.zero(),i.Affinity.Intrinsic),this.bottom.setState(s.Length.zero(),i.Affinity.Intrinsic),this.right.setState(null,i.Affinity.Intrinsic),this.width.hasAffinity(i.Affinity.Intrinsic)){const t=this.collapsedWidth.getValue(),i=this.expandedWidth.getValue();o=t.times(1-e).plus(i.times(e))}else o=this.width.value,null===o&&(o=s.Length.px(this.node.offsetWidth));this.width.setState(o,i.Affinity.Intrinsic),this.left.setState(o.times(n-1),i.Affinity.Intrinsic),this.effectiveWidth.setState(o.times(n),i.Affinity.Intrinsic),this.effectiveHeight.setState(this.height.value,i.Affinity.Intrinsic);let r=this.edgeInsets.superState;null!=r&&null!==r||(r=t.viewport.safeArea),this.paddingTop.setState(s.Length.px(r.insetTop),i.Affinity.Intrinsic),this.paddingBottom.setState(s.Length.px(r.insetBottom),i.Affinity.Intrinsic),this.edgeInsets.setState({insetTop:0,insetRight:0,insetBottom:0,insetLeft:r.insetLeft},i.Affinity.Intrinsic)}get modalView(){return this}get modalState(){return this.slide.modalState}showModal(t,e){void 0!==t.modal&&(this.modality=t.modal),this.present(e)}hideModal(t){this.dismiss(t)}present(t){t=void 0===t||!0===t?this.getLookOr(At.timing,!1):e.Timing.fromAny(t),this.slide.present(t)}dismiss(t){t=void 0===t||!0===t?this.getLookOr(At.timing,!1):e.Timing.fromAny(t),this.slide.dismiss(t)}expand(t){t=void 0===t||!0===t?this.getLookOr(At.timing,!1):e.Timing.fromAny(t),this.stretch.expand(t)}collapse(t){t=void 0===t||!0===t?this.getLookOr(At.timing,!1):e.Timing.fromAny(t),this.stretch.collapse(t)}toggle(t){if(t=void 0===t||!0===t?this.getLookOr(At.timing,!1):e.Timing.fromAny(t),"mobile"===this.viewportIdiom||this.isHorizontal())if(this.slide.presented)this.slide.dismiss(t);else{this.stretch.expand(t),this.slide.present(t);const e=this.modalProvider.service;null!=e&&e.presentModal(this,{modal:!0})}else this.stretch.toggle(t),this.slide.present(t)}init(t){super.init(t),void 0!==t.placement&&this.placement(t.placement),void 0!==t.collapsedWidth&&this.collapsedWidth(t.collapsedWidth),void 0!==t.expandedWidth&&this.expandedWidth(t.expandedWidth)}}u([te({type:s.Length,state:s.Length.px(60)})],jo.prototype,"collapsedWidth",void 0),u([te({type:s.Length,state:s.Length.px(200)})],jo.prototype,"expandedWidth",void 0),u([a.ConstraintProperty({type:s.Length,state:null,toNumber:t=>null!==t?t.pxValue():0})],jo.prototype,"effectiveWidth",void 0),u([a.ConstraintProperty({type:s.Length,state:null,toNumber:t=>null!==t?t.pxValue():0})],jo.prototype,"effectiveHeight",void 0),u([i.Property({type:String,state:"left",updateFlags:fn.NeedsResize|fn.NeedsLayout,willSetState(t,e){this.owner.willSetPlacement(t,e)},didSetState(t,e){this.owner.onSetPlacement(t,e),this.owner.didSetPlacement(t,e)}})],jo.prototype,"placement",void 0),u([Ht({type:pt,state:pt.presented(),updateFlags:fn.NeedsLayout,willPresent(){this.owner.willPresent()},didPresent(){this.owner.didPresent()},willDismiss(){this.owner.willDismiss()},didDismiss(){this.owner.didDismiss()}})],jo.prototype,"slide",void 0),u([Ht({type:gt,state:gt.expanded(),updateFlags:fn.NeedsResize|fn.NeedsLayout,willExpand(){this.owner.willExpand()},didExpand(){this.owner.didExpand()},willCollapse(){this.owner.willCollapse()},didCollapse(){this.owner.didCollapse()}})],jo.prototype,"stretch",void 0),u([i.Property({type:Object,inherits:!0,state:null})],jo.prototype,"edgeInsets",void 0);class Yo extends uo{constructor(t){super(t),this.drawerView=null,this.initIcon()}initButton(){super.initButton(),this.addClass("drawer-button")}initIcon(){this.pushIcon(Yo.hamburgerIcon)}setDrawerView(t){this.drawerView=t}onClick(t){super.onClick(t);const e=this.drawerView;null!==e&&e.toggle()}static get hamburgerIcon(){return Ps.create(24,24,"M21,17L21,19L3,19L3,17L21,17ZM21,11L21,13L3,13L3,11L21,11ZM3,5L3,7L21,7L21,5L3,5Z")}}u([e.Lazy],Yo,"hamburgerIcon",null);class Xo{constructor(t,e,i,n,s,o,r){this.key=t,this.grow=e,this.shrink=i,this.basis=n,this.width=s,this.left=o,this.right=r}withGrow(t){return this.copy(this.key,t,this.shrink,this.basis,this.width,this.left,this.right)}withShrink(t){return this.copy(this.key,this.grow,t,this.basis,this.width,this.left,this.right)}withBasis(t){return t=s.Length.fromAny(t),this.copy(this.key,this.grow,this.shrink,t,this.width,this.left,this.right)}resized(t,e,i){return null!==t&&(t=s.Length.fromAny(t)),null!==e&&(e=s.Length.fromAny(e)),null!==i&&(i=s.Length.fromAny(i)),this.copy(this.key,this.grow,this.shrink,this.basis,t,e,i)}copy(t,e,i,n,s,o,r){return new Xo(t,e,i,n,s,o,r)}equivalentTo(t,e){return this===t||t instanceof Xo&&(this.key===t.key&&this.grow===t.grow&&this.shrink===t.shrink&&this.basis.equivalentTo(t.basis,e))}equals(t){return this===t||t instanceof Xo&&(this.key===t.key&&this.grow===t.grow&&this.shrink===t.shrink&&this.basis.equals(t.basis)&&e.Equals(this.width,t.width)&&e.Equals(this.left,t.left)&&e.Equals(this.right,t.right))}debug(t){return t=t.write("DeckPost").write(46).write("create").write(40).debug(this.key).write(", ").debug(this.grow).write(", ").debug(this.shrink).write(", ").debug(this.basis).write(41),null===this.width&&null===this.left&&null===this.right||(t=t.write(46).write("resized").write(40).debug(this.width).write(", ").debug(this.left).write(", ").debug(this.right).write(", ").write(41)),t}toString(){return o.Format.debug(this)}static create(t,e,i,n){return void 0===e&&(e=0),void 0===i&&(i=1),n=void 0!==n?s.Length.fromAny(n):s.Length.zero(),new Xo(t,e,i,n,null,null,null)}static fromAny(t){if(null==t||t instanceof Xo)return t;if("object"==typeof t&&null!==t)return Xo.fromInit(t);throw new TypeError(""+t)}static fromInit(t){let e=t.key;void 0===e&&(e="");let i=t.grow;void 0===i&&(i=0);let n=t.shrink;void 0===n&&(n=1);let o=t.basis;o=void 0!==o?s.Length.fromAny(o):s.Length.zero();let r=t.width;r=null!=r?s.Length.fromAny(r):null;let l=t.left;l=null!=l?s.Length.fromAny(l):null;let a=t.right;return a=null!=a?s.Length.fromAny(a):null,new Xo(e,i,n,o,r,l,a)}}class Ko{constructor(t,e,i,n,s){this.width=t,this.left=e,this.right=i,this.spacing=n,this.posts=s}lookupPost(t){const e=this.posts;for(let i=0,n=e.length;i<n;i+=1){if(t===e[i].key)return i}}getPost(t){const e=this.posts;if("number"==typeof t){const i=e[t];if(void 0!==i)return i}else if("string"==typeof t)for(let i=0,n=e.length;i<n;i+=1){const n=e[i];if(t===n.key)return n}return null}resized(t,i,n,o){if(t=s.Length.fromAny(t),void 0===i?i=this.left:null!==i&&(i=s.Length.fromAny(i)),void 0===n?n=this.right:null!==n&&(n=s.Length.fromAny(n)),void 0===o?o=this.spacing:null!==o&&(o=s.Length.fromAny(o)),e.Equals(this.width,t)&&e.Equals(this.left,i)&&e.Equals(this.right,n)&&e.Equals(this.spacing,o))return this;{const e=this.posts,s=e.length,r=new Array(s),l=t.pxValue(),a=null!==i?i.pxValue(l):0,h=null!==n?n.pxValue(l):0,d=null!==o?o.pxValue(l):0;let c=0,u=0,p=a+h,f=a;for(let t=0;t<s;t+=1){0!==t&&(p+=d,f+=d);const i=e[t],n=i.basis.pxValue(l);r[t]=i.resized(n,f,l-n-f),c+=i.grow,u+=i.shrink,p+=n,f+=n}if(p<l&&c>0){const t=l-p;let e=a,i=0;for(let n=0;n<s;n+=1){const s=r[n];0!==i&&(p+=d,e+=d);const o=s.basis.pxValue(l)+t*(s.grow/c);r[n]=s.resized(o,e,l-o-e),e+=o,i+=1}}else if(p>l&&u>0){const t=p-l;let e=a,i=0;for(let n=0;n<s;n+=1){const s=r[n];0!==i&&(p+=d,e+=d);const o=s.basis.pxValue(l)-t*(s.shrink/u);r[n]=s.resized(o,e,l-o-e),e+=o,i+=1}}return new Ko(t,i,n,o,r)}}equivalentTo(t,e){if(this===t)return!0;if(t instanceof Ko){const i=this.posts,n=t.posts,s=i.length;if(s===n.length){for(let t=0;t<s;t+=1)if(!i[t].equivalentTo(n[t],e))return!1;return!0}}return!1}equals(t){return this===t||t instanceof Ko&&(e.Equals(this.width,t.width)&&e.Equals(this.left,t.left)&&e.Equals(this.right,t.right)&&e.Equals(this.spacing,t.spacing)&&e.Arrays.equal(this.posts,t.posts))}debug(t){t=t.write("DeckRail").write(46).write("of").write(40);for(let e=0,i=this.posts.length;e<i;e+=1)0!==e&&(t=t.write(", ")),t=t.debug(this.posts[e]);return t=t.write(41),null===this.width&&null===this.left&&null===this.right&&null===this.spacing||(t=t.write(46).write("resized").write(40).debug(this.width).write(", ").debug(this.left).write(", ").debug(this.right).write(", ").debug(this.spacing).write(41)),t}toString(){return o.Format.debug(this)}static of(...t){const e=t.length,i=new Array(e);for(let n=0;n<e;n+=1)i[n]=Xo.fromAny(t[n]);return new Ko(null,null,null,null,i)}static create(t){return new Ko(null,null,null,null,t)}static fromAny(t){if(null==t||t instanceof Ko)return t;if("object"==typeof t&&null!==t)return Ko.fromInit(t);throw new TypeError(""+t)}static fromInit(t){let e=t.width;e=null!=e?s.Length.fromAny(e):null;let i=t.left;i=null!=i?s.Length.fromAny(i):null;let n=t.right;n=null!=n?s.Length.fromAny(n):null;let o,r=t.spacing;if(r=null!=r?s.Length.fromAny(r):null,void 0!==t.posts){const e=t.posts.length;o=new Array(e);for(let i=0;i<e;i+=1)o[i]=Xo.fromAny(t.posts[i])}else o=[];return new Ko(e,i,n,r,o)}}class Zo extends Kn{constructor(t){super(t),this.initSlot()}initSlot(){this.addClass("deck-slot")}}u([i.Property({type:Xo,state:null,inherits:!0})],Zo.prototype,"post",void 0),u([i.Property({type:Xo,state:null})],Zo.prototype,"nextPost",void 0),u([i.Property({type:Xo,state:null})],Zo.prototype,"prevPost",void 0);class _o extends Zo{constructor(t){super(t),this.itemCount=0,this.item=null,this.initSlider()}initSlider(){this.addClass("deck-slider"),this.position.setState("relative",i.Affinity.Intrinsic)}get colorLook(){return At.color}createItem(t){const e=Kn.fromTag("span");return e.display.setState("flex",i.Affinity.Intrinsic),e.alignItems.setState("center",i.Affinity.Intrinsic),e.whiteSpace.setState("nowrap",i.Affinity.Intrinsic),e.text(t),e}pushItem(t,i){"string"==typeof t&&(t=this.createItem(t));const n=this.itemCount,s=n+1;this.itemCount=s;const o="item"+n,r=this.getFastener(o,vn),l=null!==r?r.view:null,a="item"+s,h=Jo.create(this);Object.defineProperty(h,"name",{value:a,configurable:!0}),h.itemIndex=s,this.willPushItem(t,l),this.item=h,this.setFastener(a,h),h.setView(t),h.insertView(),!1===(i=(void 0!==i||0!==n)&&(void 0===i||!0===i?this.getLookOr(At.timing,Et.navigating,!1):e.Timing.fromAny(i)))&&this.didPushItem(t,l)}willPushItem(t,e){this.forEachObserver((function(i){void 0!==i.deckSliderWillPushItem&&i.deckSliderWillPushItem(t,e,this)}))}didPushItem(t,e){null!==e&&e.parent===this&&e.remove(),this.forEachObserver((function(i){void 0!==i.deckSliderDidPushItem&&i.deckSliderDidPushItem(t,e,this)}))}popItem(t){const i=this.itemCount,n=i-1;this.itemCount=n;const s="item"+i,o=this.getFastener(s,vn),r=null!==o?o.view:null;if(null!==r){const i="item"+n,s=this.getFastener(i,vn),o=null!==s?s.view:null;this.willPopItem(o,r),this.item=s,null!==s&&s.insertView(),!1===(t=void 0===t||!0===t?this.getLookOr(At.timing,Et.navigating,!1):e.Timing.fromAny(t))&&this.didPopItem(o,r)}return r}willPopItem(t,e){this.forEachObserver((function(i){void 0!==i.deckSliderWillPopItem&&i.deckSliderWillPopItem(t,e,this)}))}didPopItem(t,e){const i=e.key;if(e.remove(),void 0!==i){const t=this.getFastener(i,vn);null!==t&&t.itemIndex>this.itemCount&&this.setFastener(i,null)}this.forEachObserver((function(i){void 0!==i.deckSliderDidPopItem&&i.deckSliderDidPopItem(t,e,this)}))}didLayout(t){if(!this.deckPhase.tweening){const t=this.deckPhase.value;if(void 0!==t){const e="item"+Math.round(t+1),i=this.getFastener(e,vn),n=null!==i?i.view:null;if(null!==n)this.didPopItem(null!==this.item?this.item.view:null,n);else if(null!==this.item&&null!==this.item.view&&Math.round(t)>0){const e="item"+Math.round(t-1),i=this.getFastener(e,vn),n=null!==i?i.view:null;this.didPushItem(this.item.view,n)}}}super.didLayout(t)}}u([Ht({type:Number,inherits:!0,updateFlags:fn.NeedsLayout})],_o.prototype,"deckPhase",void 0),u([Ht({type:Number,state:.5})],_o.prototype,"slotAlign",void 0);const Qo=function(t){const e=t.extend("DeckSliderItem");return e.prototype.didAttachView=function(t){this.initItem(t)},e.prototype.insertChild=function(t,e,i,n){const s="item"+(this.itemIndex+1);i=t.getChild(s),t.insertChild(e,i,n)},e.prototype.viewDidApplyTheme=function(t,e,n,s){s.color.hasAffinity(i.Affinity.Intrinsic)&&s.color.setState(t.getOr(this.owner.colorLook,e,null),n,i.Affinity.Intrinsic)},e.prototype.viewDidLayout=function(t,e){this.layoutItem(e)},e.prototype.initItem=function(t){t.position.setState("absolute",i.Affinity.Intrinsic)},e.prototype.layoutItem=function(t){const e=this.itemIndex,n=this.owner.slotAlign.getValue();let o=this.owner.width.state;o=o instanceof s.Length?o.pxValue():this.owner.node.offsetWidth;let r=this.owner.height.state;r=r instanceof s.Length?r.pxValue():this.owner.node.offsetHeight;const l=this.owner.deckPhase.getValueOr(0),a=Math.max(this.owner.itemCount,Math.ceil(l)),h=a-1,d=l-h;let c=t.width.state;this.itemWidth=c,c instanceof s.Length?c=c.pxValue(o):(c=t.node.offsetWidth,this.owner.deckPhase.tweening?t.width.setState(c,i.Affinity.Intrinsic):t.width.setState(this.itemWidth,i.Affinity.Intrinsic));const u=o-c;e<h||e===h&&1===d?(t.left.setState(0,i.Affinity.Intrinsic),t.top.setState(0,i.Affinity.Intrinsic),t.height.setState(r,i.Affinity.Intrinsic),t.opacity.setState(0,i.Affinity.Intrinsic),t.setCulled(!0)):e===h?(t.left.setState(u*n*(1-d),i.Affinity.Intrinsic),t.top.setState(0,i.Affinity.Intrinsic),t.height.setState(r,i.Affinity.Intrinsic),t.opacity.setState(1-d,i.Affinity.Intrinsic),t.setCulled(!1)):e===a?(t.left.setState(u*(1-d)+u*n*d,i.Affinity.Intrinsic),t.top.setState(0,i.Affinity.Intrinsic),t.height.setState(r,i.Affinity.Intrinsic),t.opacity.setState(d,i.Affinity.Intrinsic),t.setCulled(!1)):(t.left.setState(u,i.Affinity.Intrinsic),t.top.setState(0,i.Affinity.Intrinsic),t.height.setState(r,i.Affinity.Intrinsic),t.opacity.setState(0,i.Affinity.Intrinsic),t.setCulled(!0))},e.construct=function(e,i,n){return(i=t.construct(e,i,n)).itemIndex=0,i.itemWidth=null,i},e}(vn),Jo=vn.define("DeckSliderItemRef",{extends:Qo,key:!0,type:Kn,observes:!0});class $o extends Zo{constructor(t){super(t),this.labelCount=0,this.label=null,this.initButton()}initButton(){this.addClass("deck-button"),this.position.setState("relative",i.Affinity.Intrinsic),this.userSelect.setState("none",i.Affinity.Intrinsic),this.cursor.setState("pointer",i.Affinity.Intrinsic)}get colorLook(){return At.accentColor}createLabel(t){const e=Kn.fromTag("span");return e.display.setState("flex",i.Affinity.Intrinsic),e.alignItems.setState("center",i.Affinity.Intrinsic),e.whiteSpace.setState("nowrap",i.Affinity.Intrinsic),e.text(t),e}pushLabel(t,i){"string"==typeof t&&(t=this.createLabel(t));const n=this.labelCount,s=n+1;this.labelCount=s;const o="label"+n,r=this.getFastener(o,vn),l=null!==r?r.view:null,a="label"+s,h=nr.create(this);Object.defineProperty(h,"name",{value:a,configurable:!0}),h.labelIndex=s,this.willPushLabel(t,l),this.label=h,this.setFastener(a,h),h.setView(t),h.insertView(),!1===(i=(void 0!==i||0!==n)&&(void 0===i||!0===i?this.getLookOr(At.timing,Et.navigating,!1):e.Timing.fromAny(i)))&&this.didPushLabel(t,l)}willPushLabel(t,e){this.forEachObserver((function(i){void 0!==i.deckButtonWillPushLabel&&i.deckButtonWillPushLabel(t,e,this)}))}didPushLabel(t,e){null!==e&&e.parent===this&&e.remove(),this.forEachObserver((function(i){void 0!==i.deckButtonDidPushLabel&&i.deckButtonDidPushLabel(t,e,this)}))}popLabel(t){const i=this.labelCount,n=i-1;this.labelCount=n;const s="label"+i,o=this.getFastener(s,vn),r=null!==o?o.view:null;if(null!==r){const i="label"+n,s=this.getFastener(i,vn),o=null!==s?s.view:null;this.willPopLabel(o,r),this.label=s,null!==s&&s.insertView(),!1===(t=void 0===t||!0===t?this.getLookOr(At.timing,Et.navigating,!1):e.Timing.fromAny(t))&&this.didPopLabel(o,r)}return r}willPopLabel(t,e){this.forEachObserver((function(i){void 0!==i.deckButtonWillPopLabel&&i.deckButtonWillPopLabel(t,e,this)}))}didPopLabel(t,e){const i=e.key;if(e.remove(),void 0!==i){const t=this.getFastener(i,vn);null!==t&&t.labelIndex>this.labelCount&&this.setFastener(i,null)}this.forEachObserver((function(i){void 0!==i.deckButtonDidPopLabel&&i.deckButtonDidPopLabel(t,e,this)}))}didLayout(t){if(!this.deckPhase.tweening){const t=this.deckPhase.value;if(void 0!==t){const e="label"+Math.round(t+1),i=this.getFastener(e,vn),n=null!==i?i.view:null;if(null!==n)this.didPopLabel(null!==this.label?this.label.view:null,n);else if(null!==this.label&&null!==this.label.view&&Math.round(t)>0){const e="label"+Math.round(t-1),i=this.getFastener(e,vn),n=null!==i?i.view:null;this.didPushLabel(this.label.view,n)}}}super.didLayout(t)}}u([i.Property({type:s.Length,state:s.Length.px(12)})],$o.prototype,"iconPadding",void 0),u([Ht({type:Number,inherits:!0,updateFlags:fn.NeedsLayout})],$o.prototype,"deckPhase",void 0),u([Ht({type:Number,state:0})],$o.prototype,"slotAlign",void 0);const tr=function(t){const e=t.extend("DeckButtonCloseIcon");return e.prototype.didAttachView=function(t){this.initIcon(t)},e.prototype.insertChild=function(t,e,i,n){t.prependChild(e,n)},e.prototype.viewDidLayout=function(t,e){this.layoutIcon(e)},e.prototype.initIcon=function(t){t.addClass("close-icon"),t.setStyle("position","absolute"),t.pointerEvents.setState("none",i.Affinity.Intrinsic)},e.prototype.layoutIcon=function(t){const e=this.owner.slotAlign.getValue();let n=this.owner.width.state;n=n instanceof s.Length?n.pxValue():this.owner.node.offsetWidth;let o=this.owner.height.state;o=o instanceof s.Length?o.pxValue():this.owner.node.offsetHeight;const r=this.owner.iconPadding.getState().pxValue(n);let l=t.width.state;l=l instanceof s.Length?l.pxValue():0;let a=t.height.state;a=a instanceof s.Length?a.pxValue():0;const h=this.owner.deckPhase.getValueOr(0),d=Math.min(Math.max(0,h-1),1),c=r+(n-l-r)*e,u=(o-a)/2;t.setStyle("left",c+"px"),t.setStyle("top",u+"px"),t.viewBox.setState("0 0 "+l+" "+a,i.Affinity.Intrinsic),t.opacity.setState(1-d,i.Affinity.Intrinsic)},e}(vn);vn({extends:tr,key:!0,type:Ns,observes:!0})($o.prototype,"closeIcon");const er=function(t){const e=t.extend("DeckButtonBackIcon");return e.prototype.didAttachView=function(t){this.initIcon(t)},e.prototype.insertChild=function(t,e,i,n){t.prependChild(e,n)},e.prototype.viewDidLayout=function(t,e){this.layoutIcon(e)},e.prototype.initIcon=function(t){t.addClass("back-icon"),t.setStyle("position","absolute"),t.pointerEvents.setState("none",i.Affinity.Intrinsic)},e.prototype.layoutIcon=function(t){const e=this.owner.slotAlign.getValue();let n=this.owner.width.state;n=n instanceof s.Length?n.pxValue():this.owner.node.offsetWidth;let o=this.owner.height.state;o=o instanceof s.Length?o.pxValue():this.owner.node.offsetHeight;const r=this.owner.iconPadding.getState().pxValue(n);let l=t.width.state;l=l instanceof s.Length?l.pxValue():0;let a=t.height.state;a=a instanceof s.Length?a.pxValue():0;const h=this.owner.deckPhase.getValueOr(0),d=Math.max(this.owner.labelCount,Math.ceil(h)),c="label"+d,u=this.owner.getChild(c);let p=r+(n-l-r)*e;const f=(o-a)/2;let g;if(h<=1)g=0,t.iconColor.setState(null,i.Affinity.Intrinsic);else if(null!==u&&h<2){const o=this.owner.parent,r=this.owner.nextPost.state,a=null!==o&&null!==r?o.getChild(r.key):null;let c,f;if(a instanceof Zo){c=a.slotAlign.value,f=a.width.state,f=f instanceof s.Length?f.pxValue():a.node.offsetWidth;let t=a.left.state;t=t instanceof s.Length?t.pxValue():a.node.offsetLeft;let e=this.owner.left.state;e=e instanceof s.Length?e.pxValue():this.owner.node.offsetLeft;f+=t-(e+n)}else c=0,f=0;const v=h-(d-1);let y=u.width.state;y=y instanceof s.Length?y.pxValue(n):u.node.offsetWidth;const w=n-p-l+(f-y)*c;p+=w*(1-v)+w*e*v,g=v;const m=a instanceof Zo?a.getLookOr(a.colorLook,null):null,b=this.owner.getLookOr(this.owner.colorLook,null);null!==m&&null!==b?t.iconColor.setState(m.interpolateTo(b)(v),i.Affinity.Intrinsic):t.iconColor.setState(b,i.Affinity.Intrinsic)}t.setStyle("left",p+"px"),t.setStyle("top",f+"px"),t.viewBox.setState("0 0 "+l+" "+a,i.Affinity.Intrinsic),t.opacity.setState(g,i.Affinity.Intrinsic)},e}(vn);vn({extends:er,key:!0,type:Ns,observes:!0})($o.prototype,"backIcon");const ir=function(t){const e=t.extend("DeckButtonLabel");return e.prototype.didAttachView=function(t){this.initLabel(t)},e.prototype.insertChild=function(t,e,i,n){const s="label"+(this.labelIndex+1);i=t.getChild(s),t.insertChild(e,i,n)},e.prototype.viewDidApplyTheme=function(t,e,n,s){s.color.hasAffinity(i.Affinity.Intrinsic)&&s.color.setState(t.getOr(this.owner.colorLook,e,null),n,i.Affinity.Intrinsic)},e.prototype.viewDidLayout=function(t,e){this.layoutLabel(e)},e.prototype.initLabel=function(t){t.position.setState("absolute",i.Affinity.Intrinsic),t.pointerEvents.setState("none",i.Affinity.Intrinsic)},e.prototype.layoutLabel=function(t){const e=this.labelIndex,n=this.owner.slotAlign.getValue();let o=this.owner.width.state;o=o instanceof s.Length?o.pxValue():this.owner.node.offsetWidth;let r=this.owner.height.state;r=r instanceof s.Length?r.pxValue():this.owner.node.offsetHeight;const l=this.owner.parent,a=this.owner.nextPost.state,h=null!==l&&null!==a?l.getChild(a.key):null;let d,c;if(h instanceof Zo){d=h.slotAlign.value,c=h.width.state,c=c instanceof s.Length?c.pxValue():h.node.offsetWidth;let t=h.left.state;t=t instanceof s.Length?t.pxValue():h.node.offsetLeft;let e=this.owner.left.state;e=e instanceof s.Length?e.pxValue():this.owner.node.offsetLeft;c+=t-(e+o)}else d=0,c=0;const u=this.owner.iconPadding.getState().pxValue(o);let p,f;const g=this.owner.backIcon.view;null!==g?(p=g.width.state,p=p instanceof s.Length?p.pxValue():0,f=g.height.state,f=f instanceof s.Length?f.pxValue():0):(p=0,f=0);const v=this.owner.deckPhase.getValueOr(0),y=Math.max(this.owner.labelCount,Math.ceil(v)),w=y-1,m=v-w;let b=t.width.state;this.labelWidth=b,b instanceof s.Length?b=b.pxValue(o):(b=t.node.offsetWidth,this.owner.deckPhase.tweening?t.width.setState(b,i.Affinity.Intrinsic):t.width.setState(this.labelWidth,i.Affinity.Intrinsic));const C=u+(o-p-u)*n,S=(r-f)/2,A=o-C-p+(c-b)*d;if(e<w||e===w&&1===m)t.left.setState(C+p,i.Affinity.Intrinsic),t.top.setState(S,i.Affinity.Intrinsic),t.height.setState(f,i.Affinity.Intrinsic),t.opacity.setState(0,i.Affinity.Intrinsic),t.setCulled(!0);else if(e===w)t.left.setState(C+p+A*n*(1-m),i.Affinity.Intrinsic),t.top.setState(S,i.Affinity.Intrinsic),t.height.setState(f,i.Affinity.Intrinsic),t.opacity.setState(1-m,i.Affinity.Intrinsic),t.setCulled(!1);else if(e===y){t.left.setState(C+p+(A*(1-m)+A*n*m),i.Affinity.Intrinsic),t.top.setState(S,i.Affinity.Intrinsic),t.height.setState(f,i.Affinity.Intrinsic);const e=h instanceof Zo?h.getLookOr(h.colorLook,null):null,s=this.owner.getLookOr(this.owner.colorLook,null);null!==e&&null!==s?t.color.setState(e.interpolateTo(s)(m),i.Affinity.Intrinsic):t.color.setState(s,i.Affinity.Intrinsic),t.opacity.setState(1,i.Affinity.Intrinsic),t.setCulled(!1)}else t.left.setState(C+p+A,i.Affinity.Intrinsic),t.top.setState(S,i.Affinity.Intrinsic),t.height.setState(f,i.Affinity.Intrinsic),t.opacity.setState(0,i.Affinity.Intrinsic),t.setCulled(!0);this.layoutWidth=C+p+b+u},e.construct=function(e,i,n){return(i=t.construct(e,i,n)).labelIndex=0,i.labelWidth=null,i.layoutWidth=0,i},e}(vn),nr=vn.define("DeckButtonLabelRef",{extends:ir,key:!0,type:Kn,observes:!0});class sr extends Kn{constructor(t){super(t),this.initBar(),this.initTheme()}initBar(){this.addClass("deck-bar"),this.position.setState("relative",i.Affinity.Intrinsic),this.height.setState(this.barHeight.state,i.Affinity.Intrinsic),this.userSelect.setState("none",i.Affinity.Intrinsic),this.edgeInsets.setState({insetTop:0,insetRight:0,insetBottom:0,insetLeft:0},i.Affinity.Intrinsic)}initTheme(){this.modifyTheme(Rt.default,[[Rt.translucent,1],[Rt.primary,1]])}onApplyTheme(t,e,n){super.onApplyTheme(t,e,n),this.backgroundColor.hasAffinity(i.Affinity.Intrinsic)&&this.backgroundColor.setState(t.getOr(At.backgroundColor,e,null),n,i.Affinity.Intrinsic)}onInsertChild(t,e){super.onInsertChild(t,e),t instanceof Zo&&this.onInsertSlot(t)}onInsertSlot(t){t.position.setState("absolute",i.Affinity.Intrinsic)}onResize(t){super.onResize(t),this.resizeBar(t)}resizeBar(t){const e=this.rail.inherited?null:this.rail.state;if(null!=e){const n=this.rail.superState;let o=null;if(null!=n&&null!==n.width&&(o=n.width.pxValue()),null===o){const t=this.parent;t instanceof Kn&&(o=t.width.state,o=o instanceof s.Length?o.pxValue():t.node.offsetWidth)}null===o&&(o=this.width.state,o=o instanceof s.Length?o.pxValue():this.node.offsetWidth);let r=this.edgeInsets.superState;null==r&&this.edgeInsets.hasAffinity(i.Affinity.Intrinsic)&&(r=t.viewport.safeArea);const l=null!=r?r.insetTop:0,a=null!=r?r.insetLeft:0,h=null!=r?r.insetRight:0,d=this.itemSpacing.getStateOr(s.Length.zero()).pxValue(o),c=e.resized(o,a,h,d);this.rail.setState(c),this.height.setState(this.barHeight.state.plus(l),i.Affinity.Intrinsic)}}onLayout(t){super.onLayout(t),this.layoutBar(t)}layoutBar(t){let e=this.edgeInsets.superState;null==e&&this.edgeInsets.hasAffinity(i.Affinity.Intrinsic)&&(e=t.viewport.safeArea);const n=null!=e?e.insetTop:0;this.height.setState(this.barHeight.state.plus(n),i.Affinity.Intrinsic)}displayChildren(t,e,i){0!=(t&fn.NeedsLayout)?this.layoutChildViews(t,e,i):super.displayChildren(t,e,i)}layoutChildViews(t,e,n){const o=this.rail.state;let r=this.edgeInsets.superState;null==r&&this.edgeInsets.hasAffinity(i.Affinity.Intrinsic)&&(r=e.viewport.safeArea);let l=this.height.state;l=l instanceof s.Length?l.pxValue():this.node.offsetHeight;const a=null!=r?r.insetTop:0,h=this.barHeight.state;super.displayChildren(t,e,(function(t,e,s){if(t instanceof Zo){const e=t.key,n=null!==o&&void 0!==e?o.lookupPost(e):void 0;if(void 0!==n){const e=o.getPost(n),s=o.getPost(n+1),r=o.getPost(n-1);t.display.setState("flex",i.Affinity.Intrinsic),t.left.setState(e.left,i.Affinity.Intrinsic),t.top.setState(a,i.Affinity.Intrinsic),t.width.setState(e.width,i.Affinity.Intrinsic),t.height.setState(h,i.Affinity.Intrinsic),t.post.setState(e,i.Affinity.Intrinsic),t.nextPost.setState(s,i.Affinity.Intrinsic),t.prevPost.setState(r,i.Affinity.Intrinsic)}else t.display.setState("none",i.Affinity.Intrinsic),t.left.setState(null,i.Affinity.Intrinsic),t.top.setState(null,i.Affinity.Intrinsic),t.width.setState(null,i.Affinity.Intrinsic),t.height.setState(null,i.Affinity.Intrinsic),t.post.setState(null,i.Affinity.Intrinsic),t.nextPost.setState(null,i.Affinity.Intrinsic),t.prevPost.setState(null,i.Affinity.Intrinsic)}n.call(this,t,e,s)}))}didPressBackButton(t){this.forEachObserver((function(e){void 0!==e.deckBarDidPressBackButton&&e.deckBarDidPressBackButton(t,this)}))}didPressCloseButton(t){this.forEachObserver((function(e){void 0!==e.deckBarDidPressCloseButton&&e.deckBarDidPressCloseButton(t,this)}))}}u([i.Property({type:Ko,state:null})],sr.prototype,"rail",void 0),u([Ht({type:Number,inherits:!0})],sr.prototype,"deckPhase",void 0),u([i.Property({type:s.Length,state:s.Length.px(48),updateFlags:fn.NeedsLayout})],sr.prototype,"barHeight",void 0),u([i.Property({type:s.Length,state:s.Length.zero(),updateFlags:fn.NeedsResize})],sr.prototype,"itemSpacing",void 0),u([i.Property({type:Object,inherits:!0,state:null,updateFlags:fn.NeedsResize})],sr.prototype,"edgeInsets",void 0);class or extends Kn{constructor(t){super(t),this.initCard()}initCard(){this.addClass("deck-card"),this.position.setState("relative",i.Affinity.Intrinsic),this.overflowX.setState("auto",i.Affinity.Intrinsic),this.overflowY.setState("auto",i.Affinity.Intrinsic),this.overflowScrolling.setState("touch",i.Affinity.Intrinsic)}onApplyTheme(t,e,n){super.onApplyTheme(t,e,n),this.backgroundColor.hasAffinity(i.Affinity.Intrinsic)&&this.backgroundColor.setState(t.getOr(At.backgroundColor,e,null),n,i.Affinity.Intrinsic)}}u([i.Property({type:Object,inherits:!0,state:null})],or.prototype,"edgeInsets",void 0),u([i.Property({type:String})],or.prototype,"cardTitle",void 0),u([vn({type:Kn})],or.prototype,"backItem",void 0),u([vn({type:Kn})],or.prototype,"titleView",void 0),u([vn({type:Kn})],or.prototype,"leftItem",void 0),u([vn({type:Kn})],or.prototype,"rightItem",void 0);class rr extends Kn{constructor(t){super(t),this.cardCount=0,this.card=null,this.initDeck()}initDeck(){this.addClass("deck"),this.position.setState("relative",i.Affinity.Intrinsic),this.overflowX.setState("hidden",i.Affinity.Intrinsic),this.overflowY.setState("hidden",i.Affinity.Intrinsic)}pushCard(t,i){if(this.deckPhase.tweening)return;const n=this.cardCount,s=n+1;this.cardCount=s;const o="card"+n,r=this.getFastener(o,vn),l=null!==r?r.view:null,a="card"+s,h=hr.create(this);Object.defineProperty(h,"name",{value:a,configurable:!0}),h.cardIndex=s,this.willPushCard(t,l),this.card=h,this.setFastener(a,h),h.setView(t),h.insertView(),i=(void 0!==i||0!==n)&&(void 0===i||!0===i?this.getLookOr(At.timing,Et.navigating,!1):e.Timing.fromAny(i)),this.deckPhase.setState(s,i),this.onPushCard(t,l),!1===i&&this.didPushCard(t,l)}willPushCard(t,e){this.forEachObserver((function(i){void 0!==i.deckWillPushCard&&i.deckWillPushCard(t,e,this)}))}onPushCard(t,e){}didPushCard(t,e){null!==e&&e.parent===this&&e.remove(),this.forEachObserver((function(i){void 0!==i.deckDidPushCard&&i.deckDidPushCard(t,e,this)}))}popCard(t){if(this.deckPhase.tweening)return null;const i=this.cardCount,n=i-1;this.cardCount=n;const s="card"+i,o=this.getFastener(s,vn),r=null!==o?o.view:null;if(null!==r){const i="card"+n,s=this.getFastener(i,vn),o=null!==s?s.view:null;this.willPopCard(o,r),this.card=s,null!==s&&s.insertView(),t=void 0===t||!0===t?this.getLookOr(At.timing,Et.navigating,!1):e.Timing.fromAny(t),this.deckPhase.setState(n,t),this.onPopCard(o,r),!1===t&&this.didPopCard(o,r)}return r}willPopCard(t,e){this.forEachObserver((function(i){void 0!==i.deckWillPopCard&&i.deckWillPopCard(t,e,this)}))}onPopCard(t,e){}didPopCard(t,e){const i=e.key;if(e.remove(),void 0!==i){const t=this.getFastener(i,vn);null!==t&&t.cardIndex>this.cardCount&&this.setFastener(i,null)}this.forEachObserver((function(i){void 0!==i.deckDidPopCard&&i.deckDidPopCard(t,e,this)}))}didLayout(t){if(!this.deckPhase.tweening){const t=this.deckPhase.value;if(void 0!==t){const e="card"+Math.round(t+1),i=this.getFastener(e,vn),n=null!==i?i.view:null;if(null!==n)this.didPopCard(null!==this.card?this.card.view:null,n);else if(null!==this.card&&null!==this.card.view&&Math.round(t)>0){const e="card"+Math.round(t-1),i=this.getFastener(e,vn),n=null!==i?i.view:null;this.didPushCard(this.card.view,n)}}}super.didLayout(t)}didPressBackButton(t){this.forEachObserver((function(e){void 0!==e.deckDidPressBackButton&&e.deckDidPressBackButton(t,this)}))}didPressCloseButton(t){this.forEachObserver((function(e){void 0!==e.deckDidPressCloseButton&&e.deckDidPressCloseButton(t,this)}))}}u([Ht({type:Number,state:0,updateFlags:fn.NeedsLayout})],rr.prototype,"deckPhase",void 0),u([i.Property({type:Number,state:1})],rr.prototype,"inAlign",void 0),u([i.Property({type:Number,state:1/3})],rr.prototype,"outAlign",void 0),u([i.Property({type:Object,inherits:!0,state:null,updateFlags:fn.NeedsResize})],rr.prototype,"edgeInsets",void 0);const lr=function(t){const e=t.extend("DeckSliderItem");return e.prototype.didAttachView=function(t){this.initBar(t)},e.prototype.insertChild=function(t,e,i,n){t.prependChild(e,n)},e.prototype.viewDidResize=function(t,e){this.resizeBar(e)},e.prototype.initBar=function(t){let e=this.owner.width.state;e=e instanceof s.Length?e:s.Length.px(this.owner.node.offsetWidth),t.position.setState("absolute",i.Affinity.Intrinsic),t.left.setState(0,i.Affinity.Intrinsic),t.top.setState(0,i.Affinity.Intrinsic),t.width.setState(e,i.Affinity.Intrinsic),t.zIndex.setState(1,i.Affinity.Intrinsic)},e.prototype.resizeBar=function(t){let e=this.owner.width.state;e=e instanceof s.Length?e:s.Length.px(this.owner.node.offsetWidth),t.width.setState(e,i.Affinity.Intrinsic)},e.prototype.deckBarDidPressBackButton=function(t){this.owner.didPressBackButton(t)},e.prototype.deckBarDidPressCloseButton=function(t){this.owner.didPressCloseButton(t)},e}(vn);vn({extends:lr,key:!0,type:sr,binds:!0,observes:!0})(rr.prototype,"bar");const ar=function(t){const e=t.extend("DeckSliderItem");return e.prototype.didAttachView=function(t){this.initCard(t)},e.prototype.insertChild=function(t,e,i,n){const s="card"+(this.cardIndex+1);i=t.getChild(s),t.insertChild(e,i,n)},e.prototype.viewDidResize=function(t,e){this.resizeCard(e,t)},e.prototype.viewDidLayout=function(t,e){this.layoutCard(e,t)},e.prototype.initCard=function(t){let e=this.owner.edgeInsets.state;void 0===e&&this.owner.edgeInsets.hasAffinity(i.Affinity.Intrinsic)&&(e=this.owner.viewport.safeArea);let n=this.owner.width.state;n=n instanceof s.Length?n:s.Length.px(this.owner.node.offsetWidth);let o=this.owner.height.state;o=o instanceof s.Length?o:s.Length.px(this.owner.node.offsetHeight);let r=null;const l=this.owner.bar.view;null!==l&&(r=l.height.state,r=r instanceof s.Length?r:s.Length.px(l.node.offsetHeight),null!==e&&(e={insetTop:0,insetRight:e.insetRight,insetBottom:e.insetBottom,insetLeft:e.insetLeft})),t.edgeInsets.setState(e,i.Affinity.Intrinsic),t.position.setState("absolute",i.Affinity.Intrinsic),t.left.setState(n,i.Affinity.Intrinsic),t.top.setState(0,i.Affinity.Intrinsic),t.width.setState(n,i.Affinity.Intrinsic),t.height.setState(o,i.Affinity.Intrinsic),t.paddingTop.setState(r,i.Affinity.Intrinsic),t.boxSizing.setState("border-box",i.Affinity.Intrinsic),t.zIndex.setState(0,i.Affinity.Intrinsic),t.visibility.setState("hidden",i.Affinity.Intrinsic)},e.prototype.resizeCard=function(t,e){let n=this.owner.edgeInsets.state;void 0===n&&this.owner.edgeInsets.hasAffinity(i.Affinity.Intrinsic)&&(n=e.viewport.safeArea);let o=this.owner.width.state;o=o instanceof s.Length?o:s.Length.px(this.owner.node.offsetWidth);let r=this.owner.height.state;r=r instanceof s.Length?r:s.Length.px(this.owner.node.offsetHeight);let l=null;const a=this.owner.bar.view;null!==a&&(l=a.height.state,l=l instanceof s.Length?l:s.Length.px(a.node.offsetHeight),null!==n&&(n={insetTop:0,insetRight:n.insetRight,insetBottom:n.insetBottom,insetLeft:n.insetLeft})),t.edgeInsets.setState(n,i.Affinity.Intrinsic),t.width.setState(o,i.Affinity.Intrinsic),t.height.setState(r,i.Affinity.Intrinsic),t.paddingTop.setState(l,i.Affinity.Intrinsic)},e.prototype.layoutCard=function(t,e){let n=t.width.state;n=n instanceof s.Length?n:s.Length.px(t.node.offsetWidth);const o=this.owner.inAlign.state,r=this.owner.outAlign.state,l=this.owner.deckPhase.getValue(),a=Math.max(this.owner.cardCount,Math.ceil(l)),h=a-1,d=l-h,c=this.cardIndex;c<h||c===h&&1===d?(t.left.setState(-n.pxValue()*r,i.Affinity.Intrinsic),t.visibility.setState("hidden",i.Affinity.Intrinsic),t.setCulled(!0)):c===h?(t.left.setState(-n.pxValue()*r*d,i.Affinity.Intrinsic),t.visibility.setState(void 0,i.Affinity.Intrinsic),t.setCulled(!1)):c===a?(t.left.setState(n.pxValue()*o*(1-d),i.Affinity.Intrinsic),t.visibility.setState(void 0,i.Affinity.Intrinsic),t.setCulled(!1)):(t.left.setState(n.pxValue()*o,i.Affinity.Intrinsic),t.visibility.setState("hidden",i.Affinity.Intrinsic),t.setCulled(!0))},e.construct=function(e,i,n){return(i=t.construct(e,i,n)).cardIndex=0,i},e}(vn),hr=vn.define("DeckViewCardRef",{extends:ar,key:!0,type:or,observes:!0});class dr extends sr{constructor(t){super(t),this.onBackButtonClick=this.onBackButtonClick.bind(this),this.initRail()}initRail(){const t=Xo.create("backButton",0,0,48),e=Xo.create("titleSlider",1,1),n=Xo.create("moreSlider",0,0,48),s=Ko.create([t,e,n]);this.rail.setState(s,i.Affinity.Intrinsic),this.backMembrane.insertView(),this.backButton.insertView(),this.titleSlider.insertView(),this.moreSlider.insertView()}get closeIcon(){return dr.closeIcon}createCloseIcon(){const t=Ns.create();return t.width.setState(24,i.Affinity.Intrinsic),t.height.setState(24,i.Affinity.Intrinsic),t.iconWidth.setState(24,i.Affinity.Intrinsic),t.iconHeight.setState(24,i.Affinity.Intrinsic),t.graphics.setState(this.closeIcon,i.Affinity.Intrinsic),t}initBackMembrane(t){t.display.setState("none",i.Affinity.Intrinsic),t.position.setState("absolute",i.Affinity.Intrinsic),t.left.setState(0,i.Affinity.Intrinsic),t.top.setState(0,i.Affinity.Intrinsic),t.borderTopLeftRadius.setState(4,i.Affinity.Intrinsic),t.borderTopRightRadius.setState(4,i.Affinity.Intrinsic),t.borderBottomLeftRadius.setState(4,i.Affinity.Intrinsic),t.borderBottomRightRadius.setState(4,i.Affinity.Intrinsic),t.overflowX.setState("hidden",i.Affinity.Intrinsic),t.overflowY.setState("hidden",i.Affinity.Intrinsic),t.cursor.setState("pointer",i.Affinity.Intrinsic)}get backIcon(){return dr.backIcon}createBackIcon(){const t=Ns.create();return t.width.setState(24,i.Affinity.Intrinsic),t.height.setState(24,i.Affinity.Intrinsic),t.iconWidth.setState(24,i.Affinity.Intrinsic),t.iconHeight.setState(24,i.Affinity.Intrinsic),t.graphics.setState(this.backIcon,i.Affinity.Intrinsic),t}createBackButton(){const t=$o.create();return t.backIcon.setView(this.createBackIcon()),t.backIcon.insertView(),t}initBackButton(t){t.pointerEvents.setState("none",i.Affinity.Intrinsic)}initTitleSlider(t){t.pointerEvents.setState("none",i.Affinity.Intrinsic)}initMoreSlider(t){}pushTitle(t,e){const i=this.titleSlider.view,n=this.backButton.view;if(null!==i&&null!==n){const s=i.item;let o=null;null!==s&&(o=s.view,s.setView(null),i.item=null),i.pushItem(t,e),null!==o?n.pushLabel(o,e):n.labelCount=i.itemCount}}popTitle(t){const e=this.titleSlider.view,i=this.backButton.view;null!==e&&null!==i&&(e.popItem(t),i.popLabel(t))}didPopBackButton(t,e,i){const n=i.getFastener(e.key,vn);null!==n&&(n.setView(null),i.setFastener(n.key,null));const s=this.titleSlider.view;if(null!==s){const t="item"+s.itemCount,i=s.getFastener(t,vn);null!==i&&i.setView(e),s.item=i,s.appendChild(e,t)}}didLayout(t){const e=this.backMembrane.view,n=this.backButton.view;if(null!==e&&null!==n){if(e.width.hasAffinity(i.Affinity.Intrinsic)){let t=n.left.state;if(t=t instanceof s.Length?t.pxValue():n.node.offsetLeft,null!==n.label)e.width.setState(t+n.label.layoutWidth,i.Affinity.Intrinsic);else{let o=n.height.state;o=o instanceof s.Length?o.pxValue():n.node.offsetWidth,e.width.setState(t+o,i.Affinity.Intrinsic)}}if(e.height.hasAffinity(i.Affinity.Intrinsic)){let t=n.top.state;t=t instanceof s.Length?t.pxValue():n.node.offsetTop;let o=n.height.state;o=o instanceof s.Length?o.pxValue():n.node.offsetHeight,e.height.setState(t+o,i.Affinity.Intrinsic)}if(null!==n.backIcon.view){const t=n.closeIcon.view,s=n.deckPhase.getValueOr(0),o=Math.min(Math.max(0,s-1),1);e.display.setState(null===t&&0===o?"none":"block",i.Affinity.Intrinsic)}}super.didLayout(t)}onBackButtonClick(t){t.stopPropagation();this.deckPhase.getStateOr(0)>1?this.didPressBackButton(t):this.didPressCloseButton(t)}static get closeIcon(){return Ps.create(24,24,"M19,6.4L17.6,5L12,10.6L6.4,5L5,6.4L10.6,12L5,17.6L6.4,19L12,13.4L17.6,19L19,17.6L13.4,12Z")}static get backIcon(){return Ps.create(24,24,"M11.7,3.9L9.9,2.1L0,12L9.9,21.9L11.7,20.1L3.5,12Z").withFillLook(At.accentColor)}}u([vn({key:!0,type:lo,binds:!0,didAttachView(t){this.owner.initBackMembrane(t),t.on("click",this.owner.onBackButtonClick)},willDetachView(t){t.off("click",this.owner.onBackButtonClick)}})],dr.prototype,"backMembrane",void 0),u([vn({key:!0,type:$o,binds:!0,observes:!0,didAttachView(t){this.owner.initBackButton(t)},createView(){return this.owner.createBackButton()},deckButtonDidPopLabel(t,e,i){this.owner.didPopBackButton(t,e,i)}})],dr.prototype,"backButton",void 0),u([vn({key:!0,type:_o,binds:!0,didAttachView(t){this.owner.initTitleSlider(t)}})],dr.prototype,"titleSlider",void 0),u([vn({key:!0,type:_o,binds:!0,didAttachView(t){this.owner.initMoreSlider(t)}})],dr.prototype,"moreSlider",void 0),u([e.Lazy],dr,"closeIcon",null),u([e.Lazy],dr,"backIcon",null);class cr extends ss{onLayout(t){super.onLayout(t),this.center.recohere(t.updateTime)}onRender(t){super.onRender(t);const e=t.renderer;if(e instanceof cs&&!this.isHidden()&&!this.culled){const t=e.context;t.save(),this.renderDial(t,this.viewFrame),t.restore()}}renderDial(t,n){const o=n.width,r=n.height,l=Math.min(o,r),a=this.value.getValue(),h=this.limit.getValue(),d=0!==h?a/h:0,c=this.center.getValue(),u=this.innerRadius.getValue().px(l),p=this.outerRadius.getValue().px(l),f=p.value-u.value,g=this.startAngle.getValue().rad(),v=this.sweepAngle.getValue().rad(),y=this.cornerRadius.getValue().px(f),w=new ms(c,u,p,g,v,s.Angle.zero(),null,y),m=w.withSweepAngle(v.times(d));t.save(),t.beginPath();const b=this.dialColor.value;null!==b&&(t.fillStyle=b.toString()),w.draw(t,n),null!==b&&t.fill(),t.clip();const C=this.meterColor.value;null!==C&&(t.beginPath(),t.fillStyle=C.toString(),m.draw(t,n),t.fill()),t.restore();const S=this.label.view;if(null!==S&&!S.isHidden()){const t=(u.value+p.value)/2,n=t*Math.cos(g.value+e.Equivalent.Epsilon),o=t*Math.sin(g.value+e.Equivalent.Epsilon);let r;r=n>=0?o>=0?"start":"end":o<0?"end":"start";const l=g.value-Math.PI/2,a=this.labelPadding.getValue().pxValue(f),h=a*Math.cos(l),d=a*Math.sin(l);Cs.is(S)&&(S.textAlign.setState(r,i.Affinity.Intrinsic),S.textBaseline.setState("middle",i.Affinity.Intrinsic),S.textOrigin.setState(new s.R2Point(c.x+n+h,c.y+o+d),i.Affinity.Intrinsic))}const A=this.legend.view;if(null!==A&&!A.isHidden()){const n=this.tickAlign.getValue(),r=g.value+v.value*d*n,a=this.tickRadius.getValue().pxValue(l),h=this.tickLength.getValue().pxValue(o),u=this.tickWidth.getValue().pxValue(l),f=this.tickColor.value,y=c.x,w=c.y,m=p.value*Math.cos(r+e.Equivalent.Epsilon),b=p.value*Math.sin(r+e.Equivalent.Epsilon),C=a*Math.cos(r+e.Equivalent.Epsilon),S=a*Math.sin(r+e.Equivalent.Epsilon);let x,D=0;if(null!==f&&(t.beginPath(),t.lineWidth=u,t.strokeStyle=f.toString(),t.moveTo(y+m,w+b),t.lineTo(y+C,w+S),0!==h&&(C>=0?(t.lineTo(y+h,w+S),D=h-C):C<0&&(t.lineTo(y-h,w+S),D=h+C)),t.stroke()),C>=0?x="end":(D=-D,x="start"),Cs.is(A)){const t=this.tickPadding.getValue().pxValue(l);gs.is(A)&&A.fill.setState(f,i.Affinity.Intrinsic),A.textAlign.setState(x,i.Affinity.Intrinsic),A.textBaseline.setState("alphabetic",i.Affinity.Intrinsic),A.textOrigin.setState(new s.R2Point(y+C+D,w+S-t),i.Affinity.Intrinsic)}}}hitTest(t,e,i){const n=i.renderer;if(n instanceof cs){const i=n.transform.transform(t,e);return this.hitTestDial(i.x,i.y,n.context,this.viewFrame)}return null}hitTestDial(t,e,i,n){const o=Math.min(n.width,n.height),r=this.center.getValue(),l=this.innerRadius.getValue().px(o),a=this.outerRadius.getValue().px(o),h=a.value-l.value,d=this.startAngle.getValue(),c=this.sweepAngle.getValue(),u=this.cornerRadius.getValue().px(h),p=new ms(r,l,a,d,c,s.Angle.zero(),null,u);return i.beginPath(),p.draw(i,n),i.isPointInPath(t,e)?this:null}init(t){super.init(t),void 0!==t.value&&this.value(t.value),void 0!==t.limit&&this.limit(t.limit),void 0!==t.center&&this.center(t.center),void 0!==t.innerRadius&&this.innerRadius(t.innerRadius),void 0!==t.outerRadius&&this.outerRadius(t.outerRadius),void 0!==t.startAngle&&this.startAngle(t.startAngle),void 0!==t.sweepAngle&&this.sweepAngle(t.sweepAngle),void 0!==t.cornerRadius&&this.cornerRadius(t.cornerRadius),void 0!==t.dialColor&&this.dialColor(t.dialColor),void 0!==t.meterColor&&this.meterColor(t.meterColor),void 0!==t.labelPadding&&this.labelPadding(t.labelPadding),void 0!==t.tickAlign&&this.tickAlign(t.tickAlign),void 0!==t.tickRadius&&this.tickRadius(t.tickRadius),void 0!==t.tickLength&&this.tickLength(t.tickLength),void 0!==t.tickWidth&&this.tickWidth(t.tickWidth),void 0!==t.tickPadding&&this.tickPadding(t.tickPadding),void 0!==t.tickColor&&this.tickColor(t.tickColor),void 0!==t.font&&this.font(t.font),void 0!==t.textColor&&this.textColor(t.textColor),void 0!==t.arrangement&&this.arrangement(t.arrangement),void 0!==t.label&&this.label(t.label),void 0!==t.legend&&this.legend(t.legend)}}u([i.Animator({type:Number,state:0,updateFlags:fn.NeedsRender,willSetValue(t,e){this.owner.callObservers("viewWillSetDialValue",t,e,this.owner)},didSetValue(t,e){this.owner.callObservers("viewDidSetDialValue",t,e,this.owner)}})],cr.prototype,"value",void 0),u([i.Animator({type:Number,state:1,updateFlags:fn.NeedsRender,willSetValue(t,e){this.owner.callObservers("viewWillSetDialLimit",t,e,this.owner)},didSetValue(t,e){this.owner.callObservers("viewDidSetDialLimit",t,e,this.owner)}})],cr.prototype,"limit",void 0),u([i.Animator({type:s.R2Point,inherits:!0,state:s.R2Point.origin(),updateFlags:fn.NeedsRender})],cr.prototype,"center",void 0),u([Ht({type:s.Length,inherits:!0,state:s.Length.pct(30),updateFlags:fn.NeedsRender})],cr.prototype,"innerRadius",void 0),u([Ht({type:s.Length,inherits:!0,state:s.Length.pct(40),updateFlags:fn.NeedsRender})],cr.prototype,"outerRadius",void 0),u([Ht({type:s.Angle,inherits:!0,state:s.Angle.rad(-Math.PI/2),updateFlags:fn.NeedsRender})],cr.prototype,"startAngle",void 0),u([Ht({type:s.Angle,inherits:!0,state:s.Angle.rad(2*Math.PI),updateFlags:fn.NeedsRender})],cr.prototype,"sweepAngle",void 0),u([Ht({type:s.Length,inherits:!0,state:s.Length.pct(50),updateFlags:fn.NeedsRender})],cr.prototype,"cornerRadius",void 0),u([Ht({type:z,inherits:!0,state:null,look:At.subduedColor,updateFlags:fn.NeedsRender})],cr.prototype,"dialColor",void 0),u([Ht({type:z,inherits:!0,state:null,look:At.accentColor,updateFlags:fn.NeedsRender})],cr.prototype,"meterColor",void 0),u([Ht({type:s.Length,inherits:!0,state:s.Length.pct(25),updateFlags:fn.NeedsRender})],cr.prototype,"labelPadding",void 0),u([Ht({type:Number,inherits:!0,state:1,updateFlags:fn.NeedsRender})],cr.prototype,"tickAlign",void 0),u([Ht({type:s.Length,inherits:!0,state:s.Length.pct(45),updateFlags:fn.NeedsRender})],cr.prototype,"tickRadius",void 0),u([Ht({type:s.Length,inherits:!0,state:s.Length.pct(50),updateFlags:fn.NeedsRender})],cr.prototype,"tickLength",void 0),u([Ht({type:s.Length,inherits:!0,state:s.Length.px(1),updateFlags:fn.NeedsRender})],cr.prototype,"tickWidth",void 0),u([Ht({type:s.Length,inherits:!0,state:s.Length.px(2),updateFlags:fn.NeedsRender})],cr.prototype,"tickPadding",void 0),u([Ht({type:z,inherits:!0,state:null,look:At.neutralColor,updateFlags:fn.NeedsRender})],cr.prototype,"tickColor",void 0),u([Ht({type:E,inherits:!0,updateFlags:fn.NeedsRender})],cr.prototype,"font",void 0),u([Ht({type:z,inherits:!0,look:At.mutedColor,updateFlags:fn.NeedsRender})],cr.prototype,"textColor",void 0),u([vn({key:!0,type:As,binds:!0,willAttachView(t){this.owner.callObservers("viewWillAttachDialLabel",t,this.owner)},didDetachView(t){this.owner.callObservers("viewDidDetachDialLabel",t,this.owner)},fromAny(t){return"string"==typeof t?this.view instanceof As?(this.view.text(t),this.view):As.fromAny(t):ns.fromAny(t)}})],cr.prototype,"label",void 0),u([vn({key:!0,type:As,binds:!0,willAttachView(t){this.owner.callObservers("viewWillAttachDialLegend",t,this.owner)},didDetachView(t){this.owner.callObservers("viewDidDetachDialLegend",t,this.owner)},fromAny(t){return"string"==typeof t?this.view instanceof As?(this.view.text(t),this.view):As.fromAny(t):ns.fromAny(t)}})],cr.prototype,"legend",void 0),u([i.Property({type:String,state:"auto"})],cr.prototype,"arrangement",void 0);class ur extends A{formatLabel(t,e){}formatLegend(t,e){}}u([i.Property({type:Number,state:0,willSetState(t,e){this.owner.callObservers("traitWillSetDialValue",t,e,this.owner)},didSetState(t,e){this.owner.callObservers("traitDidSetDialValue",t,e,this.owner)}})],ur.prototype,"value",void 0),u([i.Property({type:Number,state:1,willSetState(t,e){this.owner.callObservers("traitWillSetDialLimit",t,e,this.owner)},didSetState(t,e){this.owner.callObservers("traitDidSetDialLimit",t,e,this.owner)}})],ur.prototype,"limit",void 0),u([i.Property({state:null,willSetState(t,e){this.owner.callObservers("traitWillSetDialColor",t,e,this.owner)},didSetState(t,e){this.owner.callObservers("traitDidSetDialColor",t,e,this.owner)},fromAny:t=>(null===t||t instanceof At||(t=z.fromAny(t)),t)})],ur.prototype,"dialColor",void 0),u([i.Property({state:null,willSetState(t,e){this.owner.callObservers("traitWillSetMeterColor",t,e,this.owner)},didSetState(t,e){this.owner.callObservers("traitDidSetMeterColor",t,e,this.owner)},fromAny:t=>(null===t||t instanceof At||(t=z.fromAny(t)),t)})],ur.prototype,"meterColor",void 0),u([i.Property({state:null,willSetState(t,e){this.owner.callObservers("traitWillSetDialLabel",t,e,this.owner)},didSetState(t,e){this.owner.callObservers("traitDidSetDialLabel",t,e,this.owner)}})],ur.prototype,"label",void 0),u([i.Property({state:null,willSetState(t,e){this.owner.callObservers("traitWillSetDialLegend",t,e,this.owner)},didSetState(t,e){this.owner.callObservers("traitDidSetDialLegend",t,e,this.owner)}})],ur.prototype,"legend",void 0);class pr extends Qs{updateLabel(t,e,n){if(n.label.hasAffinity(i.Affinity.Intrinsic)){const s=n.formatLabel(t,e);void 0!==s&&n.label.setState(s,i.Affinity.Intrinsic)}}updateLegend(t,e,n){if(n.legend.hasAffinity(i.Affinity.Intrinsic)){const s=n.formatLegend(t,e);void 0!==s&&n.legend.setState(s,i.Affinity.Intrinsic)}}setValue(t,n){const s=this.dial.view;null!==s&&s.value.hasAffinity(i.Affinity.Intrinsic)&&(void 0===n||!0===n?!0===(n=this.dialTiming.state)&&(n=s.getLook(At.timing,Et.ambient)):n=e.Timing.fromAny(n),s.value.setState(t,n,i.Affinity.Intrinsic))}setLimit(t,n){const s=this.dial.view;null!==s&&s.limit.hasAffinity(i.Affinity.Intrinsic)&&(void 0===n||!0===n?!0===(n=this.dialTiming.state)&&(n=s.getLook(At.timing,Et.ambient)):n=e.Timing.fromAny(n),s.limit.setState(t,n,i.Affinity.Intrinsic))}setDialColor(t,n){const s=this.dial.view;null!==s&&(void 0===n||!0===n?!0===(n=this.dialTiming.state)&&(n=s.getLook(At.timing,Et.ambient)):n=e.Timing.fromAny(n),t instanceof At?s.dialColor.setLook(t,n,i.Affinity.Intrinsic):s.dialColor.setState(t,n,i.Affinity.Intrinsic))}setMeterColor(t,n){const s=this.dial.view;null!==s&&(void 0===n||!0===n?!0===(n=this.dialTiming.state)&&(n=s.getLook(At.timing,Et.ambient)):n=e.Timing.fromAny(n),t instanceof At?s.meterColor.setLook(t,n,i.Affinity.Intrinsic):s.meterColor.setState(t,n,i.Affinity.Intrinsic))}createLabelView(t){return"function"==typeof t?t(this.dial.trait):t}setLabelView(t){const e=this.dial.view;if(null!==e){const i=null!==t?this.createLabelView(t):null;e.label.setView(i)}}createLegendView(t){return"function"==typeof t?t(this.dial.trait):t}setLegendView(t){const e=this.dial.view;if(null!==e){const i=null!==t?this.createLegendView(t):null;e.legend.setView(i)}}}u([i.Property({type:e.Timing,inherits:!0})],pr.prototype,"dialTiming",void 0),u([eo({traitType:ur,observesTrait:!0,willAttachTrait(t){this.owner.callObservers("controllerWillAttachDialTrait",t,this.owner)},didAttachTrait(t){if(null!==this.view){this.owner.setValue(t.value.state),this.owner.setLimit(t.limit.state);const e=t.dialColor.state;null!==e&&this.owner.setDialColor(e);const i=t.meterColor.state;null!==i&&this.owner.setMeterColor(i),this.owner.setLabelView(t.label.state),this.owner.setLegendView(t.legend.state)}},didDetachTrait(t){this.owner.callObservers("controllerDidDetachDialTrait",t,this.owner)},traitDidSetDialValue(t,e){this.owner.setValue(t)},traitDidSetDialLimit(t,e){this.owner.setLimit(t)},traitDidSetDialColor(t,e){this.owner.setDialColor(t)},traitDidSetMeterColor(t,e){this.owner.setMeterColor(t)},traitDidSetDialLabel(t,e){this.owner.setLabelView(t)},traitDidSetDialLegend(t,e){this.owner.setLegendView(t)},viewType:cr,observesView:!0,willAttachView(t){this.owner.callObservers("controllerWillAttachDialView",t,this.owner)},didAttachView(t){const e=this.trait;if(null!==e){const t=e.dialColor.state;null!==t&&this.owner.setDialColor(t);const i=e.meterColor.state;null!==i&&this.owner.setMeterColor(i)}if(this.owner.label.setView(t.label.view),this.owner.legend.setView(t.legend.view),null!==e){const i=t.value.value,n=t.limit.value;this.owner.updateLabel(i,n,e),this.owner.updateLegend(i,n,e),this.owner.setValue(e.value.state),this.owner.setLimit(e.limit.state),this.owner.setLabelView(e.label.state),this.owner.setLegendView(e.legend.state)}},willDetachView(t){this.owner.label.setView(null),this.owner.legend.setView(null)},didDetachView(t){this.owner.callObservers("controllerDidDetachDialView",t,this.owner)},viewWillSetDialValue(t,e,i){this.owner.callObservers("controllerWillSetDialValue",t,e,this.owner)},viewDidSetDialValue(t,e,i){const n=this.trait;if(null!==n){const e=i.limit.value;this.owner.updateLabel(t,e,n),this.owner.updateLegend(t,e,n)}this.owner.callObservers("controllerDidSetDialValue",t,e,this.owner)},viewWillSetDialLimit(t,e,i){this.owner.callObservers("controllerWillSetDialLimit",t,e,this.owner)},viewDidSetDialLimit(t,e,i){const n=this.trait;if(null!==n){const e=i.value.value;this.owner.updateLabel(e,t,n),this.owner.updateLegend(e,t,n)}this.owner.callObservers("controllerDidSetDialLimit",t,e,this.owner)},viewWillAttachDialLabel(t){this.owner.label.setView(t)},viewDidDetachDialLabel(t){this.owner.label.setView(null)},viewWillAttachDialLegend(t){this.owner.legend.setView(t)},viewDidDetachDialLegend(t){this.owner.legend.setView(null)}})],pr.prototype,"dial",void 0),u([vn({key:!0,willAttachView(t){this.owner.callObservers("controllerWillAttachDialLabelView",t,this.owner)},didDetachView(t){this.owner.callObservers("controllerDidDetachDialLabelView",t,this.owner)}})],pr.prototype,"label",void 0),u([vn({key:!0,willAttachView(t){this.owner.callObservers("controllerWillAttachDialLegendView",t,this.owner)},didDetachView(t){this.owner.callObservers("controllerDidDetachDialLegendView",t,this.owner)}})],pr.prototype,"legend",void 0);class fr extends ss{onLayout(t){super.onLayout(t),this.layoutGauge(this.viewFrame)}layoutGauge(t){if(this.center.hasAffinity(i.Affinity.Intrinsic)){const e=(t.xMin+t.xMax)/2,n=(t.yMin+t.yMax)/2;this.center.setState(new s.R2Point(e,n),i.Affinity.Intrinsic)}const e=this.dials.views;let n=0;for(const t in e){"auto"===e[t].arrangement.state&&(n+=1)}const o=Math.min(t.width,t.height),r=this.limit.getValue(),l=this.startAngle.getValue(),a=this.sweepAngle.getValue();let h=this.innerRadius.getValue().pxValue(o);const d=this.outerRadius.getValue().pxValue(o),c=this.dialSpacing.getValue().pxValue(o),u=n>1?(d-h-c*(n-1))/n:d-h;for(const t in e){const n=e[t];if("auto"===n.arrangement.state){if(isFinite(r)){const t=n.limit.getValue();n.limit.setState(Math.max(t,r),i.Affinity.Intrinsic)}n.startAngle.setState(l,i.Affinity.Intrinsic),n.sweepAngle.setState(a,i.Affinity.Intrinsic),n.innerRadius.setState(s.Length.px(h),i.Affinity.Intrinsic),n.outerRadius.setState(s.Length.px(h+u),i.Affinity.Intrinsic),h=h+u+c}}const p=this.title.view;Cs.is(p)&&p.textOrigin.setState(this.center.state,i.Affinity.Intrinsic)}init(t){super.init(t),void 0!==t.limit&&this.limit(t.limit),void 0!==t.innerRadius&&this.innerRadius(t.innerRadius),void 0!==t.outerRadius&&this.outerRadius(t.outerRadius),void 0!==t.startAngle&&this.startAngle(t.startAngle),void 0!==t.sweepAngle&&this.sweepAngle(t.sweepAngle),void 0!==t.cornerRadius&&this.cornerRadius(t.cornerRadius),void 0!==t.dialSpacing&&this.dialSpacing(t.dialSpacing),void 0!==t.dialColor&&this.dialColor(t.dialColor),void 0!==t.meterColor&&this.meterColor(t.meterColor),void 0!==t.labelPadding&&this.labelPadding(t.labelPadding),void 0!==t.tickAlign&&this.tickAlign(t.tickAlign),void 0!==t.tickRadius&&this.tickRadius(t.tickRadius),void 0!==t.tickLength&&this.tickLength(t.tickLength),void 0!==t.tickWidth&&this.tickWidth(t.tickWidth),void 0!==t.tickPadding&&this.tickPadding(t.tickPadding),void 0!==t.tickColor&&this.tickColor(t.tickColor),void 0!==t.font&&this.font(t.font),void 0!==t.textColor&&this.textColor(t.textColor),void 0!==t.title&&this.title(t.title);const e=t.dials;if(void 0!==e)for(let t=0,i=e.length;t<i;t+=1){const i=e[t];this.appendChild(cr.fromAny(i),i.key)}}}u([i.Animator({type:Number,state:0,updateFlags:fn.NeedsLayout})],fr.prototype,"limit",void 0),u([i.Animator({type:s.R2Point,state:s.R2Point.origin(),updateFlags:fn.NeedsLayout})],fr.prototype,"center",void 0),u([Ht({type:s.Length,state:s.Length.pct(30),updateFlags:fn.NeedsLayout})],fr.prototype,"innerRadius",void 0),u([Ht({type:s.Length,state:s.Length.pct(40),updateFlags:fn.NeedsLayout})],fr.prototype,"outerRadius",void 0),u([Ht({type:s.Angle,state:s.Angle.rad(-Math.PI/2),updateFlags:fn.NeedsLayout})],fr.prototype,"startAngle",void 0),u([Ht({type:s.Angle,state:s.Angle.rad(2*Math.PI),updateFlags:fn.NeedsLayout})],fr.prototype,"sweepAngle",void 0),u([Ht({type:s.Length,state:s.Length.pct(50)})],fr.prototype,"cornerRadius",void 0),u([Ht({type:s.Length,state:s.Length.px(1),updateFlags:fn.NeedsLayout})],fr.prototype,"dialSpacing",void 0),u([Ht({type:z,state:null,look:At.subduedColor})],fr.prototype,"dialColor",void 0),u([Ht({type:z,state:null,look:At.accentColor})],fr.prototype,"meterColor",void 0),u([Ht({type:s.Length,state:s.Length.pct(25)})],fr.prototype,"labelPadding",void 0),u([Ht({type:Number,state:1})],fr.prototype,"tickAlign",void 0),u([Ht({type:s.Length,state:s.Length.pct(45)})],fr.prototype,"tickRadius",void 0),u([Ht({type:s.Length,state:s.Length.pct(50)})],fr.prototype,"tickLength",void 0),u([Ht({type:s.Length,state:s.Length.px(1)})],fr.prototype,"tickWidth",void 0),u([Ht({type:s.Length,state:s.Length.px(2)})],fr.prototype,"tickPadding",void 0),u([Ht({type:z,state:null,look:At.neutralColor})],fr.prototype,"tickColor",void 0),u([Ht({type:E,state:null,inherits:!0})],fr.prototype,"font",void 0),u([Ht({type:z,state:null,look:At.mutedColor})],fr.prototype,"textColor",void 0),u([vn({key:!0,type:As,binds:!0,initView(t){Cs.is(t)&&(t.textAlign.setState("center",i.Affinity.Intrinsic),t.textBaseline.setState("middle",i.Affinity.Intrinsic),t.textOrigin.setState(this.owner.center.state,i.Affinity.Intrinsic))},willAttachView(t){this.owner.callObservers("viewWillAttachGaugeTitle",t,this.owner)},didDetachView(t){this.owner.callObservers("viewDidDetachGaugeTitle",t,this.owner)},fromAny(t){return"string"==typeof t?this.view instanceof As?(this.view.text(t),this.view):As.fromAny(t):ns.fromAny(t)}})],fr.prototype,"title",void 0),u([yn({type:cr,binds:!0,observes:!0,willAttachView(t,e){this.owner.callObservers("viewWillAttachDial",t,e,this.owner)},didAttachView(t){const e=t.label.view;null!==e&&this.attachLabelView(e);const i=t.legend.view;null!==i&&this.attachLegendView(i)},willDetachView(t){const e=t.legend.view;null!==e&&this.detachLegendView(e);const i=t.label.view;null!==i&&this.detachLabelView(i)},didDetachView(t){this.owner.callObservers("viewDidDetachDial",t,this.owner)},viewDidSetDialValue(t,e){this.owner.requireUpdate(fn.NeedsLayout)},viewWillAttachDialLabel(t){this.attachLabelView(t)},viewDidDetachDialLabel(t){this.detachLabelView(t)},attachLabelView(t){},detachLabelView(t){},viewWillAttachDialLegend(t){this.attachLegendView(t)},viewDidDetachDialLegend(t){this.detachLegendView(t)},attachLegendView(t){},detachLegendView(t){}})],fr.prototype,"dials",void 0);class gr extends A{startConsumingDials(){const t=this.dials.traits;for(const e in t){t[e].consume(this)}}stopConsumingDials(){const t=this.dials.traits;for(const e in t){t[e].unconsume(this)}}onStartConsuming(){super.onStartConsuming(),this.startConsumingDials()}onStopConsuming(){super.onStopConsuming(),this.stopConsumingDials()}}u([i.Property({state:null,willSetState(t,e){this.owner.callObservers("traitWillSetGaugeTitle",t,e,this.owner)},didSetState(t,e){this.owner.callObservers("traitDidSetGaugeTitle",t,e,this.owner)}})],gr.prototype,"title",void 0),u([T({type:ur,binds:!0,willAttachTrait(t,e){this.owner.callObservers("traitWillAttachDial",t,e,this.owner)},didAttachTrait(t){this.owner.consuming&&t.consume(this.owner)},willDetachTrait(t){this.owner.consuming&&t.unconsume(this.owner)},didDetachTrait(t){this.owner.callObservers("traitDidDetachDial",t,this.owner)},detectModel:t=>t.getTrait(ur)})],gr.prototype,"dials",void 0);class vr extends Qs{createTitleView(t,e){return"function"==typeof t?t(e):t}setTitleView(t,e){const i=this.gauge.view;if(null!==i){const n=null!==t?this.createTitleView(t,e):null;i.title.setView(n)}}}u([eo({traitType:gr,observesTrait:!0,willAttachTrait(t){this.owner.callObservers("controllerWillAttachGaugeTrait",t,this.owner)},didAttachTrait(t){const e=t.dials.traits;for(const t in e){const i=e[t];this.owner.dials.addTraitController(i)}null!==this.view&&this.owner.setTitleView(t.title.state,t)},willDetachTrait(t){null!==this.view&&this.owner.setTitleView(null,t);const e=t.dials.traits;for(const t in e){const i=e[t];this.owner.dials.deleteTraitController(i)}},didDetachTrait(t){this.owner.callObservers("controllerDidDetachGaugeTrait",t,this.owner)},traitDidSetGaugeTitle(t,e,i){this.owner.setTitleView(t,i)},traitWillAttachDial(t,e){this.owner.dials.addTraitController(t,e)},traitDidDetachDial(t){this.owner.dials.deleteTraitController(t)},viewType:fr,observesView:!0,initView(t){const e=this.owner.dials.controllers;for(const i in e){const n=e[i],s=n.dial.view;null!==s&&null===s.parent&&n.dial.insertView(t)}this.owner.title.setView(t.title.view);const i=this.trait;null!==i&&this.owner.setTitleView(i.title.state,i)},deinitView(t){this.owner.title.setView(null)},willAttachView(t){this.owner.callObservers("controllerWillAttachGaugeView",t,this.owner)},didDetachView(t){this.owner.callObservers("controllerDidDetachGaugeView",t,this.owner)},viewWillAttachGaugeTitle(t){this.owner.title.setView(t)},viewDidDetachGaugeTitle(t){this.owner.title.setView(null)}})],vr.prototype,"gauge",void 0),u([vn({key:!0,willAttachView(t){this.owner.callObservers("controllerWillAttachGaugeTitleView",t,this.owner)},didDetachView(t){this.owner.callObservers("controllerDidDetachGaugeTitleView",t,this.owner)}})],vr.prototype,"title",void 0),u([i.Property({type:e.Timing,state:!0})],vr.prototype,"dialTiming",void 0),u([oo({type:pr,binds:!0,observes:!0,get parentView(){return this.owner.gauge.view},getTraitViewRef:t=>t.dial,willAttachController(t){this.owner.callObservers("controllerWillAttachDial",t,this.owner)},didAttachController(t){const e=t.dial.trait;null!==e&&this.attachDialTrait(e,t);const i=t.dial.view;null!==i&&this.attachDialView(i,t)},willDetachController(t){const e=t.dial.view;null!==e&&this.detachDialView(e,t);const i=t.dial.trait;null!==i&&this.detachDialTrait(i,t)},didDetachController(t){this.owner.callObservers("controllerDidDetachDial",t,this.owner)},controllerWillAttachDialTrait(t,e){this.owner.callObservers("controllerWillAttachDialTrait",t,e,this.owner),this.attachDialTrait(t,e)},controllerDidDetachDialTrait(t,e){this.detachDialTrait(t,e),this.owner.callObservers("controllerDidDetachDialTrait",t,e,this.owner)},attachDialTrait(t,e){},detachDialTrait(t,e){},controllerWillAttachDialView(t,e){this.owner.callObservers("controllerWillAttachDialView",t,e,this.owner),this.attachDialView(t,e)},controllerDidDetachDialView(t,e){this.detachDialView(t,e),this.owner.callObservers("controllerDidDetachDialView",t,e,this.owner)},attachDialView(t,e){const i=t.label.view;null!==i&&this.attachDialLabelView(i,e);const n=t.legend.view;null!==n&&this.attachDialLegendView(n,e)},detachDialView(t,e){const i=t.legend.view;null!==i&&this.detachDialLegendView(i,e);const n=t.label.view;null!==n&&this.detachDialLabelView(n,e),t.remove()},controllerWillSetDialValue(t,e,i){this.owner.callObservers("controllerWillSetDialValue",t,e,i,this.owner)},controllerDidSetDialValue(t,e,i){this.owner.callObservers("controllerDidSetDialValue",t,e,i,this.owner)},controllerWillSetDialLimit(t,e,i){this.owner.callObservers("controllerWillSetDialLimit",t,e,i,this.owner)},controllerDidSetDialLimit(t,e,i){this.owner.callObservers("controllerDidSetDialLimit",t,e,i,this.owner)},controllerWillAttachDialLabelView(t,e){this.owner.callObservers("controllerWillAttachDialLabelView",t,e,this.owner),this.attachDialLabelView(t,e)},controllerDidDetachDialLabelView(t,e){this.detachDialLabelView(t,e),this.owner.callObservers("controllerDidDetachDialLabelView",t,e,this.owner)},attachDialLabelView(t,e){},detachDialLabelView(t,e){},controllerWillAttachDialLegendView(t,e){this.owner.callObservers("controllerWillAttachDialLegendView",t,e,this.owner),this.attachDialLegendView(t,e)},controllerDidDetachDialLegendView(t,e){this.detachDialLegendView(t,e),this.owner.callObservers("controllerDidDetachDialLegendView",t,e,this.owner)},attachDialLegendView(t,e){},detachDialLegendView(t,e){}})],vr.prototype,"dials",void 0);class yr extends ss{onLayout(t){super.onLayout(t),this.center.recohere(t.updateTime)}onRender(t){super.onRender(t);const e=t.renderer;e instanceof as&&!this.isHidden()&&!this.culled&&this.renderSlice(e.context,this.viewFrame)}renderSlice(t,n){const o=n.width,r=n.height,l=Math.min(o,r),a=this.value.getValue(),h=this.total.getValue(),d=0!==h?a/h:0,c=this.center.getValue(),u=this.innerRadius.getValue().px(l),p=this.outerRadius.getValue().px(l),f=p.value-u.value,g=this.phaseAngle.getValue().rad(),v=s.Angle.rad(2*Math.PI*d),y=this.padAngle.getValue(),w=this.padRadius.getValueOr(null),m=this.cornerRadius.getValue().px(f),b=new ms(c,u,p,g,v,y,w,m),C=this.sliceColor.value;if(null!==C){const e=t.fillStyle;t.beginPath(),t.fillStyle=C.toString(),b.draw(t,n),t.fill(),t.fillStyle=e}const S=this.label.view;if(null!==S&&!S.isHidden()){const t=this.labelRadius.getValue().pxValue(f),e=g.value+v.value/2,n=u.value+t,o=n*Math.cos(e),r=n*Math.sin(e);Cs.is(S)&&(S.textAlign.setState("center",i.Affinity.Intrinsic),S.textBaseline.setState("middle",i.Affinity.Intrinsic),S.textOrigin.setState(new s.R2Point(c.x+o,c.y+r),i.Affinity.Intrinsic))}const A=this.legend.view;if(null!==A&&!A.isHidden()){const n=this.tickAlign.getValue(),r=g.value+v.value*n,a=this.tickRadius.getValue().pxValue(l),h=this.tickLength.getValue().pxValue(o),d=this.tickWidth.getValue().pxValue(l),u=this.tickColor.value,f=c.x,y=c.y,w=p.value*Math.cos(r+e.Equivalent.Epsilon),m=p.value*Math.sin(r+e.Equivalent.Epsilon),b=a*Math.cos(r+e.Equivalent.Epsilon),C=a*Math.sin(r+e.Equivalent.Epsilon);let S,x=0;if(null!==u&&0!==d){const e=t.lineWidth,i=t.strokeStyle;t.beginPath(),t.lineWidth=d,t.strokeStyle=u.toString(),t.moveTo(f+w,y+m),t.lineTo(f+b,y+C),0!==h&&(b>=0?(t.lineTo(f+h,y+C),x=h-b):b<0&&(t.lineTo(f-h,y+C),x=h+b)),t.stroke(),t.lineWidth=e,t.strokeStyle=i}if(b>=0?S="end":(x=-x,S="start"),Cs.is(A)){const t=this.tickPadding.getValue().pxValue(l);gs.is(A)&&A.fill.setState(u,i.Affinity.Intrinsic),A.textAlign.setState(S,i.Affinity.Intrinsic),A.textBaseline.setState("alphabetic",i.Affinity.Intrinsic),A.textOrigin.setState(new s.R2Point(f+b+x,y+C-t),i.Affinity.Intrinsic)}}}hitTest(t,e,i){const n=i.renderer;if(n instanceof cs){const i=n.transform.transform(t,e);return this.hitTestSlice(i.x,i.y,n.context,this.viewFrame)}return null}hitTestSlice(t,e,i,n){const o=Math.min(n.width,n.height),r=this.value.getValue(),l=this.total.getValue(),a=0!==l?r/l:0,h=this.center.getValue(),d=this.innerRadius.getValue().px(o),c=this.outerRadius.getValue().px(o),u=c.value-d.value,p=this.phaseAngle.getValue().rad(),f=s.Angle.rad(2*Math.PI*a),g=this.padAngle.getValue(),v=this.padRadius.getValueOr(null),y=this.cornerRadius.getValue().px(u),w=new ms(h,d,c,p,f,g,v,y);return i.beginPath(),w.draw(i,n),i.isPointInPath(t,e)?this:null}init(t){super.init(t),void 0!==t.value&&this.value(t.value),void 0!==t.total&&this.total(t.total),void 0!==t.center&&this.center(t.center),void 0!==t.innerRadius&&this.innerRadius(t.innerRadius),void 0!==t.outerRadius&&this.outerRadius(t.outerRadius),void 0!==t.phaseAngle&&this.phaseAngle(t.phaseAngle),void 0!==t.padAngle&&this.padAngle(t.padAngle),void 0!==t.padRadius&&this.padRadius(t.padRadius),void 0!==t.cornerRadius&&this.cornerRadius(t.cornerRadius),void 0!==t.labelRadius&&this.labelRadius(t.labelRadius),void 0!==t.sliceColor&&this.sliceColor(t.sliceColor),void 0!==t.tickAlign&&this.tickAlign(t.tickAlign),void 0!==t.tickRadius&&this.tickRadius(t.tickRadius),void 0!==t.tickLength&&this.tickLength(t.tickLength),void 0!==t.tickWidth&&this.tickWidth(t.tickWidth),void 0!==t.tickPadding&&this.tickPadding(t.tickPadding),void 0!==t.tickColor&&this.tickColor(t.tickColor),void 0!==t.font&&this.font(t.font),void 0!==t.textColor&&this.textColor(t.textColor),void 0!==t.label&&this.label(t.label),void 0!==t.legend&&this.legend(t.legend)}}u([i.Animator({type:Number,state:0,updateFlags:fn.NeedsRender,willSetValue(t,e){this.owner.callObservers("viewWillSetSliceValue",t,e,this.owner)},didSetValue(t,e){this.owner.callObservers("viewDidSetSliceValue",t,e,this.owner)}})],yr.prototype,"value",void 0),u([i.Animator({type:Number,state:1,updateFlags:fn.NeedsRender})],yr.prototype,"total",void 0),u([i.Animator({type:s.R2Point,inherits:!0,state:s.R2Point.origin(),updateFlags:fn.NeedsRender})],yr.prototype,"center",void 0),u([Ht({type:s.Length,inherits:!0,state:s.Length.pct(3),updateFlags:fn.NeedsRender})],yr.prototype,"innerRadius",void 0),u([Ht({type:s.Length,inherits:!0,state:s.Length.pct(25),updateFlags:fn.NeedsRender})],yr.prototype,"outerRadius",void 0),u([Ht({type:s.Angle,state:s.Angle.zero(),updateFlags:fn.NeedsRender})],yr.prototype,"phaseAngle",void 0),u([Ht({type:s.Angle,inherits:!0,state:s.Angle.deg(2),updateFlags:fn.NeedsRender})],yr.prototype,"padAngle",void 0),u([Ht({type:s.Length,inherits:!0,state:null,updateFlags:fn.NeedsRender})],yr.prototype,"padRadius",void 0),u([Ht({type:s.Length,inherits:!0,state:s.Length.zero(),updateFlags:fn.NeedsRender})],yr.prototype,"cornerRadius",void 0),u([Ht({type:s.Length,inherits:!0,state:s.Length.pct(50),updateFlags:fn.NeedsRender})],yr.prototype,"labelRadius",void 0),u([Ht({type:z,inherits:!0,state:null,look:At.accentColor,updateFlags:fn.NeedsRender})],yr.prototype,"sliceColor",void 0),u([Ht({type:Number,inherits:!0,state:.5,updateFlags:fn.NeedsRender})],yr.prototype,"tickAlign",void 0),u([Ht({type:s.Length,inherits:!0,state:s.Length.pct(30),updateFlags:fn.NeedsRender})],yr.prototype,"tickRadius",void 0),u([Ht({type:s.Length,inherits:!0,state:s.Length.pct(50),updateFlags:fn.NeedsRender})],yr.prototype,"tickLength",void 0),u([Ht({type:s.Length,inherits:!0,state:s.Length.px(1),updateFlags:fn.NeedsRender})],yr.prototype,"tickWidth",void 0),u([Ht({type:s.Length,inherits:!0,state:s.Length.px(2),updateFlags:fn.NeedsRender})],yr.prototype,"tickPadding",void 0),u([Ht({type:z,inherits:!0,state:null,look:At.neutralColor,updateFlags:fn.NeedsRender})],yr.prototype,"tickColor",void 0),u([Ht({type:E,inherits:!0,state:null,updateFlags:fn.NeedsRender})],yr.prototype,"font",void 0),u([Ht({type:z,inherits:!0,state:null,look:At.mutedColor,updateFlags:fn.NeedsRender})],yr.prototype,"textColor",void 0),u([vn({key:!0,type:As,binds:!0,willAttachView(t){this.owner.callObservers("viewWillAttachSliceLabel",t,this.owner)},didDetachView(t){this.owner.callObservers("viewDidDetachSliceLabel",t,this.owner)},fromAny(t){return"string"==typeof t?this.view instanceof As?(this.view.text(t),this.view):As.fromAny(t):ns.fromAny(t)}})],yr.prototype,"label",void 0),u([vn({key:!0,type:As,binds:!0,willAttachView(t){this.owner.callObservers("viewWillAttachSliceLegend",t,this.owner)},didDetachView(t){this.owner.callObservers("viewDidDetachSliceLegend",t,this.owner)},fromAny(t){return"string"==typeof t?this.view instanceof As?(this.view.text(t),this.view):As.fromAny(t):ns.fromAny(t)}})],yr.prototype,"legend",void 0);class wr extends A{formatLabel(t){}formatLegend(t){}}u([i.Property({type:Number,state:0,willSetState(t,e){this.owner.callObservers("traitWillSetSliceValue",t,e,this.owner)},didSetState(t,e){this.owner.callObservers("traitDidSetSliceValue",t,e,this.owner)}})],wr.prototype,"value",void 0),u([i.Property({state:null,willSetState(t,e){this.owner.callObservers("traitWillSetSliceColor",t,e,this.owner)},didSetState(t,e){this.owner.callObservers("traitDidSetSliceColor",t,e,this.owner)},fromAny:t=>(null===t||t instanceof At||(t=z.fromAny(t)),t)})],wr.prototype,"sliceColor",void 0),u([i.Property({state:null,willSetState(t,e){this.owner.callObservers("traitWillSetSliceLabel",t,e,this.owner)},didSetState(t,e){this.owner.callObservers("traitDidSetSliceLabel",t,e,this.owner)}})],wr.prototype,"label",void 0),u([i.Property({state:null,willSetState(t,e){this.owner.callObservers("traitWillSetSliceLegend",t,e,this.owner)},didSetState(t,e){this.owner.callObservers("traitDidSetSliceLegend",t,e,this.owner)}})],wr.prototype,"legend",void 0);class mr extends Qs{updateLabel(t,e){if(e.label.hasAffinity(i.Affinity.Intrinsic)){const n=e.formatLabel(t);void 0!==n&&e.label.setState(n,i.Affinity.Intrinsic)}}updateLegend(t,e){if(e.legend.hasAffinity(i.Affinity.Intrinsic)){const n=e.formatLegend(t);void 0!==n&&e.legend.setState(n,i.Affinity.Intrinsic)}}setValue(t,n){const s=this.slice.view;null!==s&&s.value.hasAffinity(i.Affinity.Intrinsic)&&(void 0===n||!0===n?!0===(n=this.sliceTiming.state)&&(n=s.getLook(At.timing,Et.ambient)):n=e.Timing.fromAny(n),s.value.setState(t,n,i.Affinity.Intrinsic))}setSliceColor(t,n){const s=this.slice.view;null!==s&&(void 0===n||!0===n?!0===(n=this.sliceTiming.state)&&(n=s.getLook(At.timing,Et.ambient)):n=e.Timing.fromAny(n),t instanceof At?s.sliceColor.setLook(t,n,i.Affinity.Intrinsic):s.sliceColor.setState(t,n,i.Affinity.Intrinsic))}createLabelView(t){return"function"==typeof t?t(this.slice.trait):t}setLabelView(t){const e=this.slice.view;if(null!==e){const i=null!==t?this.createLabelView(t):null;e.label.setView(i)}}createLegendView(t){return"function"==typeof t?t(this.slice.trait):t}setLegendView(t){const e=this.slice.view;if(null!==e){const i=null!==t?this.createLegendView(t):null;e.legend.setView(i)}}}u([i.Property({type:e.Timing,inherits:!0})],mr.prototype,"sliceTiming",void 0),u([eo({traitType:wr,observesTrait:!0,willAttachTrait(t){this.owner.callObservers("controllerWillAttachSliceTrait",t,this.owner)},didAttachTrait(t){if(null!==this.view){this.owner.setValue(t.value.state);const e=t.sliceColor.state;null!==e&&this.owner.setSliceColor(e),this.owner.setLabelView(t.label.state),this.owner.setLegendView(t.legend.state)}},didDetachTrait(t){this.owner.callObservers("controllerDidDetachSliceTrait",t,this.owner)},traitDidSetSliceValue(t,e){this.owner.setValue(t)},traitDidSetSliceColor(t,e){this.owner.setSliceColor(t)},traitDidSetSliceLabel(t,e){this.owner.setLabelView(t)},traitDidSetSliceLegend(t,e){this.owner.setLegendView(t)},viewType:yr,observesView:!0,willAttachView(t){this.owner.callObservers("controllerWillAttachSliceView",t,this.owner)},didAttachView(t){const e=this.trait;if(null!==e){const t=e.sliceColor.state;null!==t&&this.owner.setSliceColor(t)}this.owner.label.setView(t.label.view),this.owner.legend.setView(t.legend.view);const i=t.value.value;t.setHidden(0===i),null!==e&&(this.owner.updateLabel(i,e),this.owner.updateLegend(i,e),this.owner.setValue(e.value.state),this.owner.setLabelView(e.label.state),this.owner.setLegendView(e.legend.state))},willDetachView(t){this.owner.label.setView(null),this.owner.legend.setView(null)},didDetachView(t){this.owner.callObservers("controllerDidDetachSliceView",t,this.owner)},viewWillSetSliceValue(t,e,i){this.owner.callObservers("controllerWillSetSliceValue",t,e,this.owner)},viewDidSetSliceValue(t,e,i){i.setHidden(0===t);const n=this.trait;null!==n&&(this.owner.updateLabel(t,n),this.owner.updateLegend(t,n)),this.owner.callObservers("controllerDidSetSliceValue",t,e,this.owner)},viewWillAttachSliceLabel(t){this.owner.label.setView(t)},viewDidDetachSliceLabel(t){this.owner.label.setView(null)},viewWillAttachSliceLegend(t){this.owner.legend.setView(t)},viewDidDetachSliceLegend(t){this.owner.legend.setView(null)}})],mr.prototype,"slice",void 0),u([vn({key:!0,willAttachView(t){this.owner.callObservers("controllerWillAttachSliceLabelView",t,this.owner)},didDetachView(t){this.owner.callObservers("controllerDidDetachSliceLabelView",t,this.owner)}})],mr.prototype,"label",void 0),u([vn({key:!0,willAttachView(t){this.owner.callObservers("controllerWillAttachSliceLegendView",t,this.owner)},didDetachView(t){this.owner.callObservers("controllerDidDetachSliceLegendView",t,this.owner)}})],mr.prototype,"legend",void 0);class br extends ss{onLayout(t){super.onLayout(t),this.layoutPie(this.viewFrame)}layoutPie(t){if(this.center.hasAffinity(i.Affinity.Intrinsic)){const e=(t.xMin+t.xMax)/2,n=(t.yMin+t.yMax)/2;this.center.setState(new s.R2Point(e,n),i.Affinity.Intrinsic)}const e=this.slices.views;let n=0;for(const t in e){const i=e[t].value.getValue();isFinite(i)&&(n+=i)}n=Math.max(n,this.limit.getValue());let o=this.baseAngle.getValue().rad();for(const t in e){const r=e[t];r.total.setState(n,i.Affinity.Intrinsic),r.phaseAngle.setState(o,i.Affinity.Intrinsic);const l=r.value.getValue();if(isFinite(l)){const t=0!==n?l/n:0;o=s.Angle.rad(o.value+2*Math.PI*t)}}const r=this.title.view;Cs.is(r)&&r.textOrigin.setState(this.center.value,i.Affinity.Intrinsic)}init(t){super.init(t),void 0!==t.limit&&this.limit(t.limit),void 0!==t.center&&this.center(t.center),void 0!==t.baseAngle&&this.baseAngle(t.baseAngle),void 0!==t.innerRadius&&this.innerRadius(t.innerRadius),void 0!==t.outerRadius&&this.outerRadius(t.outerRadius),void 0!==t.padAngle&&this.padAngle(t.padAngle),void 0!==t.padRadius&&this.padRadius(t.padRadius),void 0!==t.cornerRadius&&this.cornerRadius(t.cornerRadius),void 0!==t.labelRadius&&this.labelRadius(t.labelRadius),void 0!==t.sliceColor&&this.sliceColor(t.sliceColor),void 0!==t.tickAlign&&this.tickAlign(t.tickAlign),void 0!==t.tickRadius&&this.tickRadius(t.tickRadius),void 0!==t.tickLength&&this.tickLength(t.tickLength),void 0!==t.tickWidth&&this.tickWidth(t.tickWidth),void 0!==t.tickPadding&&this.tickPadding(t.tickPadding),void 0!==t.tickColor&&this.tickColor(t.tickColor),void 0!==t.font&&this.font(t.font),void 0!==t.textColor&&this.textColor(t.textColor),void 0!==t.title&&this.title(t.title);const e=t.slices;if(void 0!==e)for(let t=0,i=e.length;t<i;t+=1){const i=e[t];this.appendChild(yr.fromAny(i),i.key)}}}u([i.Animator({type:Number,state:0,updateFlags:fn.NeedsLayout})],br.prototype,"limit",void 0),u([i.Animator({type:s.R2Point,state:s.R2Point.origin(),updateFlags:fn.NeedsLayout})],br.prototype,"center",void 0),u([Ht({type:s.Angle,state:s.Angle.rad(-Math.PI/2),updateFlags:fn.NeedsLayout})],br.prototype,"baseAngle",void 0),u([Ht({type:s.Length,state:s.Length.pct(3)})],br.prototype,"innerRadius",void 0),u([Ht({type:s.Length,state:s.Length.pct(25)})],br.prototype,"outerRadius",void 0),u([Ht({type:s.Angle,state:s.Angle.deg(2)})],br.prototype,"padAngle",void 0),u([Ht({type:s.Length,state:null})],br.prototype,"padRadius",void 0),u([Ht({type:s.Length,state:s.Length.zero()})],br.prototype,"cornerRadius",void 0),u([Ht({type:s.Length,state:s.Length.pct(50)})],br.prototype,"labelRadius",void 0),u([Ht({type:z,state:null,look:At.accentColor})],br.prototype,"sliceColor",void 0),u([Ht({type:Number,state:.5})],br.prototype,"tickAlign",void 0),u([Ht({type:s.Length,state:s.Length.pct(30)})],br.prototype,"tickRadius",void 0),u([Ht({type:s.Length,state:s.Length.pct(50)})],br.prototype,"tickLength",void 0),u([Ht({type:s.Length,state:s.Length.px(1)})],br.prototype,"tickWidth",void 0),u([Ht({type:s.Length,state:s.Length.px(2)})],br.prototype,"tickPadding",void 0),u([Ht({type:z,state:null,look:At.neutralColor})],br.prototype,"tickColor",void 0),u([Ht({type:E,state:null,inherits:!0})],br.prototype,"font",void 0),u([Ht({type:z,state:null,look:At.mutedColor})],br.prototype,"textColor",void 0),u([vn({key:!0,type:As,binds:!0,initView(t){Cs.is(t)&&(t.textAlign.setState("center",i.Affinity.Intrinsic),t.textBaseline.setState("middle",i.Affinity.Intrinsic),t.textOrigin.setState(this.owner.center.state,i.Affinity.Intrinsic))},willAttachView(t){this.owner.callObservers("viewWillAttachPieTitle",t,this.owner)},didDetachView(t){this.owner.callObservers("viewDidDetachPieTitle",t,this.owner)},fromAny(t){return"string"==typeof t?this.view instanceof As?(this.view.text(t),this.view):As.fromAny(t):ns.fromAny(t)}})],br.prototype,"title",void 0),u([yn({type:yr,binds:!0,observes:!0,willAttachView(t,e){this.owner.callObservers("viewWillAttachSlice",t,e,this.owner)},didAttachView(t){const e=t.label.view;null!==e&&this.attachLabelView(e);const i=t.legend.view;null!==i&&this.attachLegendView(i)},willDetachView(t){const e=t.legend.view;null!==e&&this.detachLegendView(e);const i=t.label.view;null!==i&&this.detachLabelView(i)},didDetachView(t){this.owner.callObservers("viewDidDetachSlice",t,this.owner)},viewDidSetSliceValue(t,e){this.owner.requireUpdate(fn.NeedsLayout)},viewWillAttachSliceLabel(t){this.attachLabelView(t)},viewDidDetachSliceLabel(t){this.detachLabelView(t)},attachLabelView(t){},detachLabelView(t){},viewWillAttachSliceLegend(t){this.attachLegendView(t)},viewDidDetachSliceLegend(t){this.detachLegendView(t)},attachLegendView(t){},detachLegendView(t){}})],br.prototype,"slices",void 0);class Cr extends A{startConsumingSlices(){const t=this.slices.traits;for(const e in t){t[e].consume(this)}}stopConsumingSlices(){const t=this.slices.traits;for(const e in t){t[e].unconsume(this)}}onStartConsuming(){super.onStartConsuming(),this.startConsumingSlices()}onStopConsuming(){super.onStopConsuming(),this.stopConsumingSlices()}}u([i.Property({state:null,willSetState(t,e){this.owner.callObservers("traitWillSetPieTitle",t,e,this.owner)},didSetState(t,e){this.owner.callObservers("traitDidSetPieTitle",t,e,this.owner)}})],Cr.prototype,"title",void 0),u([T({type:wr,binds:!0,willAttachTrait(t,e){this.owner.callObservers("traitWillAttachSlice",t,e,this.owner)},didAttachTrait(t){this.owner.consuming&&t.consume(this.owner)},willDetachTrait(t){this.owner.consuming&&t.unconsume(this.owner)},didDetachTrait(t){this.owner.callObservers("traitDidDetachSlice",t,this.owner)},detectModel:t=>t.getTrait(wr)})],Cr.prototype,"slices",void 0);class Sr extends Qs{createTitleView(t,e){return"function"==typeof t?t(e):t}setTitleView(t,e){const i=this.pie.view;if(null!==i){const n=null!==t?this.createTitleView(t,e):null;i.title.setView(n)}}}u([eo({traitType:Cr,observesTrait:!0,willAttachTrait(t){this.owner.callObservers("controllerWillAttachPieTrait",t,this.owner)},didAttachTrait(t){const e=t.slices.traits;for(const t in e){const i=e[t];this.owner.slices.addTraitController(i)}null!==this.view&&this.owner.setTitleView(t.title.state,t)},willDetachTrait(t){null!==this.view&&this.owner.setTitleView(t.title.state,t);const e=t.slices.traits;for(const t in e){const i=e[t];this.owner.slices.deleteTraitController(i)}},didDetachTrait(t){this.owner.callObservers("controllerDidDetachPieTrait",t,this.owner)},traitDidSetPieTitle(t,e,i){this.owner.setTitleView(t,i)},traitWillAttachSlice(t,e){this.owner.slices.addTraitController(t)},traitDidDetachSlice(t){this.owner.slices.deleteTraitController(t)},viewType:br,observesView:!0,initView(t){const e=this.owner.slices.controllers;for(const i in e){const n=e[i],s=n.slice.view;null!==s&&null===s.parent&&n.slice.insertView(t)}this.owner.title.setView(t.title.view);const i=this.trait;null!==i&&this.owner.setTitleView(i.title.state,i)},deinitView(t){this.owner.title.setView(null)},willAttachView(t){this.owner.callObservers("controllerWillAttachPieView",t,this.owner)},didDetachView(t){this.owner.callObservers("controllerDidDetachPieView",t,this.owner)},viewWillAttachPieTitle(t){this.owner.title.setView(t)},viewDidDetachPieTitle(t){this.owner.title.setView(t)}})],Sr.prototype,"pie",void 0),u([vn({key:!0,willAttachView(t){this.owner.callObservers("controllerWillAttachPieTitleView",t,this.owner)},didDetachView(t){this.owner.callObservers("controllerDidDetachPieTitleView",t,this.owner)}})],Sr.prototype,"title",void 0),u([i.Property({type:e.Timing,state:!0})],Sr.prototype,"sliceTiming",void 0),u([oo({type:mr,binds:!0,observes:!0,get parentView(){return this.owner.pie.view},getTraitViewRef:t=>t.slice,willAttachController(t){this.owner.callObservers("controllerWillAttachSlice",t,this.owner)},didAttachController(t){const e=t.slice.trait;null!==e&&this.attachSliceTrait(e,t);const i=t.slice.view;null!==i&&this.attachSliceView(i,t)},willDetachController(t){const e=t.slice.view;null!==e&&this.detachSliceView(e,t);const i=t.slice.trait;null!==i&&this.detachSliceTrait(i,t)},didDetachController(t){this.owner.callObservers("controllerDidDetachSlice",t,this.owner)},controllerWillAttachSliceTrait(t,e){this.owner.callObservers("controllerWillAttachSliceTrait",t,e,this.owner),this.attachSliceTrait(t,e)},controllerDidDetachSliceTrait(t,e){this.detachSliceTrait(t,e),this.owner.callObservers("controllerDidDetachSliceTrait",t,e,this.owner)},attachSliceTrait(t,e){},detachSliceTrait(t,e){},controllerWillAttachSliceView(t,e){this.owner.callObservers("controllerWillAttachSliceView",t,e,this.owner),this.attachSliceView(t,e)},controllerDidDetachSliceView(t,e){this.detachSliceView(t,e),this.owner.callObservers("controllerDidDetachSliceView",t,e,this.owner)},attachSliceView(t,e){const i=t.label.view;null!==i&&this.attachSliceLabelView(i,e);const n=t.legend.view;null!==n&&this.attachSliceLegendView(n,e)},detachSliceView(t,e){const i=t.legend.view;null!==i&&this.detachSliceLegendView(i,e);const n=t.label.view;null!==n&&this.detachSliceLabelView(n,e),t.remove()},controllerWillSetSliceValue(t,e,i){this.owner.callObservers("controllerWillSetSliceValue",t,e,i,this.owner)},controllerDidSetSliceValue(t,e,i){this.owner.callObservers("controllerDidSetSliceValue",t,e,i,this.owner)},controllerWillAttachSliceLabelView(t,e){this.owner.callObservers("controllerWillAttachSliceLabelView",t,e,this.owner),this.attachSliceLabelView(t,e)},controllerDidDetachSliceLabelView(t,e){this.detachSliceLabelView(t,e),this.owner.callObservers("controllerDidDetachSliceLabelView",t,e,this.owner)},attachSliceLabelView(t,e){},detachSliceLabelView(t,e){},controllerWillAttachSliceLegendView(t,e){this.owner.callObservers("controllerWillAttachSliceLegendView",t,e,this.owner),this.attachSliceLegendView(t,e)},controllerDidDetachSliceLegendView(t,e){this.detachSliceLegendView(t,e),this.owner.callObservers("controllerDidDetachSliceLegendView",t,e,this.owner)},attachSliceLegendView(t,e){},detachSliceLegendView(t,e){}})],Sr.prototype,"slices",void 0);class Ar extends ss{constructor(){super(),this.xCoord=NaN,this.yCoord=NaN,this.y2Coord=void 0,this.gradientStop=!1}setXCoord(t){this.xCoord=t}setYCoord(t){this.yCoord=t}setY2Coord(t){this.y2Coord=t}setState(t,e){void 0!==t.x&&this.x(t.x,e),void 0!==t.y&&this.y(t.y,e),void 0!==t.y2&&this.y2(t.y2,e),void 0!==t.radius&&this.radius(t.radius,e),void 0!==t.hitRadius&&this.hitRadius(t.hitRadius),void 0!==t.color&&this.color(t.color,e),void 0!==t.opacity&&this.opacity(t.opacity,e),void 0!==t.font&&this.font(t.font,e),void 0!==t.textColor&&this.textColor(t.textColor,e),void 0!==t.category&&this.category(t.category),void 0!==t.labelPadding&&this.labelPadding(t.labelPadding,e),void 0!==t.labelPlacement&&this.labelPlacement(t.labelPlacement),void 0!==t.label&&this.label(t.label)}isGradientStop(){return this.gradientStop}updateGradientStop(){this.gradientStop=null!==this.color.value||void 0!==this.opacity.value}onLayout(t){super.onLayout(t),this.layoutDataPoint(this.viewFrame)}layoutDataPoint(t){const e=this.label.view;null!==e&&this.layoutLabel(e,t)}layoutLabel(t,e){let n=this.labelPlacement.state;if("above"!==n&&"below"!==n&&"middle"!==n){const t=this.category.state;n="increasing"===t||"maxima"===t?"above":"decreasing"===t||"minima"===t?"below":"above"}const o=this.xCoord;let r=this.yCoord;"above"===n?r-=this.labelPadding.getValue().pxValue(Math.min(e.width,e.height)):"below"===n&&(r+=this.labelPadding.getValue().pxValue(Math.min(e.width,e.height))),Cs.is(t)&&(t.textAlign.setState("center",i.Affinity.Intrinsic),"above"===n?t.textBaseline.setState("bottom",i.Affinity.Intrinsic):"below"===n?t.textBaseline.setState("top",i.Affinity.Intrinsic):"middle"===n&&t.textBaseline.setState("middle",i.Affinity.Intrinsic),t.textOrigin.setState(new s.R2Point(o,r),i.Affinity.Intrinsic))}hitTest(t,e,i){const n=i.renderer;return n instanceof cs?this.hitTestPoint(t,e,n.context,this.viewFrame):null}hitTestPoint(t,e,i,n){let s=this.hitRadius.state;const o=this.radius.value;if(null!==o){const t=Math.min(n.width,n.height);s=Math.max(s,o.pxValue(t))}const r=this.xCoord-t,l=this.yCoord-e;return r*r+l*l<s*s?this:null}init(t){super.init(t),this.setState(t)}}u([i.Animator({willSetValue(t,e){this.owner.callObservers("viewWillSetDataPointX",t,e,this.owner)},didSetValue(t,e){this.owner.callObservers("viewDidSetDataPointX",t,e,this.owner)}})],Ar.prototype,"x",void 0),u([i.Animator({willSetValue(t,e){this.owner.callObservers("viewWillSetDataPointY",t,e,this.owner)},didSetValue(t,e){this.owner.callObservers("viewDidSetDataPointY",t,e,this.owner)}})],Ar.prototype,"y",void 0),u([i.Animator({willSetValue(t,e){this.owner.callObservers("viewWillSetDataPointY2",t,e,this.owner)},didSetValue(t,e){this.owner.callObservers("viewDidSetDataPointY2",t,e,this.owner)}})],Ar.prototype,"y2",void 0),u([Ht({type:s.Length,state:null,willSetValue(t,e){this.owner.callObservers("viewWillSetDataPointRadius",t,e,this.owner)},didSetValue(t,e){this.owner.callObservers("viewDidSetDataPointRadius",t,e,this.owner)}})],Ar.prototype,"radius",void 0),u([i.Property({type:Number,state:5})],Ar.prototype,"hitRadius",void 0),u([Ht({type:z,state:null,willSetValue(t,e){this.owner.callObservers("viewWillSetDataPointColor",t,e,this.owner)},didSetValue(t,e){this.owner.updateGradientStop(),this.owner.callObservers("viewDidSetDataPointColor",t,e,this.owner)}})],Ar.prototype,"color",void 0),u([Ht({type:Number,willSetValue(t,e){this.owner.callObservers("viewWillSetDataPointOpacity",t,e,this.owner)},didSetValue(t,e){this.owner.updateGradientStop(),this.owner.callObservers("viewDidSetDataPointOpacity",t,e,this.owner)}})],Ar.prototype,"opacity",void 0),u([Ht({type:E,inherits:!0})],Ar.prototype,"font",void 0),u([Ht({type:z,inherits:!0})],Ar.prototype,"textColor",void 0),u([i.Property({type:String})],Ar.prototype,"category",void 0),u([Ht({type:s.Length,state:s.Length.zero(),updateFlags:fn.NeedsLayout})],Ar.prototype,"labelPadding",void 0),u([vn({key:!0,type:As,binds:!0,willAttachView(t){this.owner.callObservers("viewWillAttachDataPointLabel",t,this.owner)},didDetachView(t){this.owner.callObservers("viewDidDetachDataPointLabel",t,this.owner)},fromAny(t){return"string"==typeof t?this.view instanceof As?(this.view.text(t),this.view):As.fromAny(t):ns.fromAny(t)}})],Ar.prototype,"label",void 0),u([i.Property({type:String,state:"auto"})],Ar.prototype,"labelPlacement",void 0);class xr extends A{constructor(t,e){super(),this.x.setState(t),this.y.setState(e)}formatLabel(t,e){}}u([i.Property({willSetState(t,e){this.owner.callObservers("traitWillSetDataPointX",t,e,this.owner)},didSetState(t,e){this.owner.callObservers("traitDidSetDataPointX",t,e,this.owner)}})],xr.prototype,"x",void 0),u([i.Property({willSetState(t,e){this.owner.callObservers("traitWillSetDataPointY",t,e,this.owner)},didSetState(t,e){this.owner.callObservers("traitDidSetDataPointY",t,e,this.owner)}})],xr.prototype,"y",void 0),u([i.Property({willSetState(t,e){this.owner.callObservers("traitWillSetDataPointY2",t,e,this.owner)},didSetState(t,e){this.owner.callObservers("traitDidSetDataPointY2",t,e,this.owner)}})],xr.prototype,"y2",void 0),u([i.Property({type:s.Length,state:null,willSetState(t,e){this.owner.callObservers("traitWillSetDataPointRadius",t,e,this.owner)},didSetState(t,e){this.owner.callObservers("traitDidSetDataPointRadius",t,e,this.owner)}})],xr.prototype,"radius",void 0),u([i.Property({state:null,willSetState(t,e){this.owner.callObservers("traitWillSetDataPointColor",t,e,this.owner)},didSetState(t,e){this.owner.callObservers("traitDidSetDataPointColor",t,e,this.owner)},fromAny:t=>(null===t||t instanceof At||(t=z.fromAny(t)),t)})],xr.prototype,"color",void 0),u([i.Property({type:Number,willSetState(t,e){this.owner.callObservers("traitWillSetDataPointOpacity",t,e,this.owner)},didSetState(t,e){this.owner.callObservers("traitDidSetDataPointOpacity",t,e,this.owner)}})],xr.prototype,"opacity",void 0),u([i.Property({state:null,willSetState(t,e){this.owner.callObservers("traitWillSetDataPointLabel",t,e,this.owner)},didSetState(t,e){this.owner.callObservers("traitDidSetDataPointLabel",t,e,this.owner)}})],xr.prototype,"label",void 0);class Dr extends A{startConsumingDataPoints(){const t=this.dataPoints.traits;for(const e in t){t[e].consume(this)}}stopConsumingDataPoints(){const t=this.dataPoints.traits;for(const e in t){t[e].unconsume(this)}}onStartConsuming(){super.onStartConsuming(),this.startConsumingDataPoints()}onStopConsuming(){super.onStopConsuming(),this.stopConsumingDataPoints()}}u([T({type:xr,binds:!0,willAttachTrait(t,e){this.owner.callObservers("traitWillAttachDataPoint",t,e,this.owner)},didAttachTrait(t){this.owner.consuming&&t.consume(this.owner)},willDetachTrait(t){this.owner.consuming&&t.unconsume(this.owner)},didDetachTrait(t){this.owner.callObservers("traitDidDetachDataPoint",t,this.owner)},detectModel:t=>t.getTrait(xr)})],Dr.prototype,"dataPoints",void 0);class Tr extends Qs{updateLabel(t,e,n){const s=n.formatLabel(t,e);void 0!==s&&n.label.setState(s,i.Affinity.Intrinsic)}setX(t,n,s){const o=this.dataPoint.view;null!==o&&(void 0===s||!0===s?!0===(s=this.dataPointTiming.state)&&(s=o.getLook(At.timing,Et.ambient)):s=e.Timing.fromAny(s),o.x.setState(t,s,i.Affinity.Intrinsic))}setY(t,n,s){const o=this.dataPoint.view;null!==o&&(void 0===s||!0===s?!0===(s=this.dataPointTiming.state)&&(s=o.getLook(At.timing,Et.ambient)):s=e.Timing.fromAny(s),o.y.setState(t,s,i.Affinity.Intrinsic))}setY2(t,n,s){const o=this.dataPoint.view;null!==o&&(void 0===s||!0===s?!0===(s=this.dataPointTiming.state)&&(s=o.getLook(At.timing,Et.ambient)):s=e.Timing.fromAny(s),o.y2.setState(t,s,i.Affinity.Intrinsic))}setRadius(t,n,s){const o=this.dataPoint.view;null!==o&&(void 0===s||!0===s?!0===(s=this.dataPointTiming.state)&&(s=o.getLook(At.timing,Et.ambient)):s=e.Timing.fromAny(s),o.radius.setState(t,s,i.Affinity.Intrinsic))}setColor(t,n,s){const o=this.dataPoint.view;null!==o&&(void 0===s||!0===s?!0===(s=this.dataPointTiming.state)&&(s=o.getLook(At.timing,Et.ambient)):s=e.Timing.fromAny(s),t instanceof At?o.color.setLook(t,s,i.Affinity.Intrinsic):o.color.setState(t,s,i.Affinity.Intrinsic))}setOpacity(t,n,s){const o=this.dataPoint.view;null!==o&&(void 0===s||!0===s?!0===(s=this.dataPointTiming.state)&&(s=o.getLook(At.timing,Et.ambient)):s=e.Timing.fromAny(s),o.opacity.setState(t,s,i.Affinity.Intrinsic))}createLabelView(t,e){return"function"==typeof t?t(e):t}setLabelView(t,e){const i=this.dataPoint.view;if(null!==i){const n=null!==t?this.createLabelView(t,e):null;i.label.setView(n)}}}u([i.Property({type:e.Timing,inherits:!0})],Tr.prototype,"dataPointTiming",void 0),u([eo({traitType:xr,observesTrait:!0,willAttachTrait(t){this.owner.callObservers("controllerWillAttachDataPointTrait",t,this.owner)},didAttachTrait(t){null!==this.view&&(this.owner.setX(t.x.state,t),this.owner.setY(t.y.state,t),this.owner.setY2(t.y2.state,t),this.owner.setRadius(t.radius.state,t),this.owner.setColor(t.color.state,t),this.owner.setOpacity(t.opacity.state,t),this.owner.setLabelView(t.label.state,t))},willDetachTrait(t){null!==this.view&&this.owner.setLabelView(null,t)},didDetachTrait(t){this.owner.callObservers("controllerDidDetachDataPointTrait",t,this.owner)},traitDidSetDataPointX(t,e,i){this.owner.setX(t,i)},traitDidSetDataPointY(t,e,i){this.owner.setY(t,i)},traitDidSetDataPointY2(t,e,i){this.owner.setY2(t,i)},traitDidSetDataPointRadius(t,e,i){this.owner.setRadius(t,i)},traitDidSetDataPointColor(t,e,i){this.owner.setColor(t,i)},traitDidSetDataPointOpacity(t,e,i){this.owner.setOpacity(t,i)},traitDidSetDataPointLabel(t,e,i){this.owner.setLabelView(t,i)},viewType:Ar,observesView:!0,willAttachView(t){this.owner.callObservers("controllerWillAttachDataPointView",t,this.owner)},didAttachView(t){this.owner.label.setView(t.label.view);const e=this.trait;if(null!==e){this.owner.setX(e.x.state,e),this.owner.setY(e.y.state,e),this.owner.setY2(e.y2.state,e),this.owner.setRadius(e.radius.state,e),this.owner.setColor(e.color.state,e),this.owner.setOpacity(e.opacity.state,e),this.owner.setLabelView(e.label.state,e);const i=t.x.value,n=t.y.value;this.owner.updateLabel(i,n,e)}},willDetachView(t){this.owner.label.setView(null)},didDetachView(t){this.owner.callObservers("controllerDidDetachDataPointView",t,this.owner)},viewWillSetDataPointX(t,e,i){this.owner.callObservers("controllerWillSetDataPointX",t,e,this.owner)},viewDidSetDataPointX(t,e,i){const n=this.trait;if(null!==n){const e=i.y.value;this.owner.updateLabel(t,e,n)}this.owner.callObservers("controllerDidSetDataPointX",t,e,this.owner)},viewWillSetDataPointY(t,e,i){this.owner.callObservers("controllerWillSetDataPointY",t,e,this.owner)},viewDidSetDataPointY(t,e,i){const n=this.trait;if(null!==n){const e=i.x.value;this.owner.updateLabel(e,t,n)}this.owner.callObservers("controllerDidSetDataPointY",t,e,this.owner)},viewWillSetDataPointY2(t,e,i){this.owner.callObservers("controllerWillSetDataPointY2",t,e,this.owner)},viewDidSetDataPointY2(t,e,i){this.owner.callObservers("controllerDidSetDataPointY2",t,e,this.owner)},viewWillSetDataPointRadius(t,e,i){this.owner.callObservers("controllerWillSetDataPointRadius",t,e,this.owner)},viewDidSetDataPointRadius(t,e,i){this.owner.callObservers("controllerDidSetDataPointRadius",t,e,this.owner)},viewWillSetDataPointColor(t,e,i){this.owner.callObservers("controllerWillSetDataPointColor",t,e,this.owner)},viewDidSetDataPointColor(t,e,i){this.owner.callObservers("controllerDidSetDataPointColor",t,e,this.owner)},viewWillSetDataPointOpacity(t,e,i){this.owner.callObservers("controllerWillSetDataPointOpacity",t,e,this.owner)},viewDidSetDataPointOpacity(t,e,i){this.owner.callObservers("controllerDidSetDataPointOpacity",t,e,this.owner)},viewWillAttachDataPointLabel(t){this.owner.label.setView(t)},viewDidDetachDataPointLabel(t){this.owner.label.setView(null)},createView(){const t=new Ar,e=this.trait;return null!==e&&(t.x.setState(e.x.state,i.Affinity.Intrinsic),t.y.setState(e.y.state,i.Affinity.Intrinsic),t.y2.setState(e.y2.state,i.Affinity.Intrinsic),t.radius.setState(e.radius.state,i.Affinity.Intrinsic)),t}})],Tr.prototype,"dataPoint",void 0),u([vn({key:!0,willAttachView(t){this.owner.callObservers("controllerWillAttachDataPointLabelView",t,this.owner)},didDetachView(t){this.owner.callObservers("controllerDidDetachDataPointLabelView",t,this.owner)}})],Tr.prototype,"label",void 0);class Pr extends Qs{}u([D({type:Dr,observes:!0,willAttachTrait(t){this.owner.callObservers("controllerWillAttachDataSetTrait",t,this.owner)},didAttachTrait(t){const e=t.dataPoints.traits;for(const t in e){const i=e[t];this.owner.dataPoints.addTraitController(i)}},willDetachTrait(t){const e=t.dataPoints.traits;for(const t in e){const i=e[t];this.owner.dataPoints.deleteTraitController(i)}},didDetachTrait(t){this.owner.callObservers("controllerDidDetachDataSetTrait",t,this.owner)},traitWillAttachDataPoint(t,e){this.owner.dataPoints.addTraitController(t,e)},traitDidDetachDataPoint(t){this.owner.dataPoints.deleteTraitController(t)}})],Pr.prototype,"dataSet",void 0),u([i.Property({type:e.Timing,state:!0})],Pr.prototype,"dataPointTiming",void 0),u([oo({type:Tr,binds:!0,observes:!0,getTraitViewRef:t=>t.dataPoint,willAttachController(t){this.owner.callObservers("controllerWillAttachDataPoint",t,this.owner)},didAttachController(t){const e=t.dataPoint.trait;null!==e&&this.attachDataPointTrait(e,t);const i=t.dataPoint.view;null!==i&&this.attachDataPointView(i,t);const n=this.parentView;null!==n&&t.dataPoint.insertView(n)},willDetachController(t){const e=t.dataPoint.view;null!==e&&this.detachDataPointView(e,t);const i=t.dataPoint.trait;null!==i&&this.detachDataPointTrait(i,t)},didDetachController(t){this.owner.callObservers("controllerDidDetachDataPoint",t,this.owner)},controllerWillAttachDataPointTrait(t,e){this.owner.callObservers("controllerWillAttachDataPointTrait",t,e,this.owner),this.attachDataPointTrait(t,e)},controllerDidDetachDataPointTrait(t,e){this.detachDataPointTrait(t,e),this.owner.callObservers("controllerDidDetachDataPointTrait",t,e,this.owner)},attachDataPointTrait(t,e){},detachDataPointTrait(t,e){},controllerWillAttachDataPointView(t,e){this.owner.callObservers("controllerWillAttachDataPointView",t,e,this.owner),this.attachDataPointView(t,e)},controllerDidDetachDataPointView(t,e){this.detachDataPointView(t,e),this.owner.callObservers("controllerDidDetachDataPointView",t,e,this.owner)},attachDataPointView(t,e){const i=t.label.view;null!==i&&this.attachDataPointLabelView(i,e)},detachDataPointView(t,e){const i=t.label.view;null!==i&&this.detachDataPointLabelView(i,e),t.remove()},controllerWillSetDataPointX(t,e,i){this.owner.callObservers("controllerWillSetDataPointX",t,e,i,this.owner)},controllerDidSetDataPointX(t,e,i){this.owner.callObservers("controllerDidSetDataPointX",t,e,i,this.owner)},controllerWillSetDataPointY(t,e,i){this.owner.callObservers("controllerWillSetDataPointY",t,e,i,this.owner)},controllerDidSetDataPointY(t,e,i){this.owner.callObservers("controllerDidSetDataPointY",t,e,i,this.owner)},controllerWillSetDataPointY2(t,e,i){this.owner.callObservers("controllerWillSetDataPointY2",t,e,i,this.owner)},controllerDidSetDataPointY2(t,e,i){this.owner.callObservers("controllerDidSetDataPointY2",t,e,i,this.owner)},controllerWillSetDataPointRadius(t,e,i){this.owner.callObservers("controllerWillSetDataPointRadius",t,e,i,this.owner)},controllerDidSetDataPointRadius(t,e,i){this.owner.callObservers("controllerDidSetDataPointRadius",t,e,i,this.owner)},controllerWillSetDataPointColor(t,e,i){this.owner.callObservers("controllerWillSetDataPointColor",t,e,i,this.owner)},controllerDidSetDataPointColor(t,e,i){this.owner.callObservers("controllerDidSetDataPointColor",t,e,i,this.owner)},controllerWillSetDataPointOpacity(t,e,i){this.owner.callObservers("controllerWillSetDataPointOpacity",t,e,i,this.owner)},controllerDidSetDataPointOpacity(t,e,i){this.owner.callObservers("controllerDidSetDataPointOpacity",t,e,i,this.owner)},controllerWillAttachDataPointLabelView(t,e){this.owner.callObservers("controllerWillAttachDataPointLabelView",t,e,this.owner),this.attachDataPointLabelView(t,e)},controllerDidDetachDataPointLabelView(t,e){this.detachDataPointLabelView(t,e),this.owner.callObservers("controllerDidDetachDataPointLabelView",t,e,this.owner)},attachDataPointLabelView(t,e){},detachDataPointLabelView(t,e){}})],Pr.prototype,"dataPoints",void 0);const Vr=function(t){const n=t.extend("ContinuousScaleAnimator");return n.prototype.setScale=function(t,n,s,o,r){"string"==typeof t&&(t=Fr.parseScale(t).domain),t instanceof e.Domain&&(r=s,n instanceof e.Domain&&(o=n[1],s=n[0]),n=t[1],t=t[0]);const l=this.state;let a;if(null!=l){if(a=l.withDomain(t,n),void 0!==s&&void 0!==o&&(a=a.overRange(s,o)),(null==r||!1===r)&&0!=(this.flags&i.Animator.TweeningFlag)){const e=this.getValue().withDomain(t,n);this.setValue(e),r=!0}}else a=Fr.createScale(t,n,s,o);this.setState(a,r,i.Affinity.Reflexive)},n.prototype.setDomain=function(t,n,s){"string"==typeof t&&(t=Fr.parseScale(t).domain),t instanceof e.Domain&&(s=n,n=t[1],t=t[0]);const o=this.state;let r;if(null!=o){if(r=o.withDomain(t,n),(null==s||!1===s)&&0!=(this.flags&i.Animator.TweeningFlag)){const e=this.getValue().withDomain(t,n);this.setValue(e),s=!0}}else r=Fr.createScale(t,n,0,1);this.setState(r,s,i.Affinity.Reflexive)},n.prototype.setRange=function(t,n,s){const o=this.state;if(null!=o){t instanceof e.Range&&(s=n,n=t[1],t=t[0]);const r=o.overRange(t,n);if((null==s||!1===s)&&0!=(this.flags&i.Animator.TweeningFlag)){const e=this.getValue().overRange(t,n);this.setValue(e),s=!0}this.setState(r,s,i.Affinity.Reflexive)}},n.prototype.setBaseScale=function(t,e,i,s,o){this.inherited&&this.superFastener instanceof n?this.superFastener.setBaseScale(t,e,i,s,o):this.setScale(t,e,i,s,o)},n.prototype.setBaseDomain=function(t,e,i){this.inherited&&this.superFastener instanceof n?this.superFastener.setBaseDomain(t,e,i):this.setDomain(t,e,i)},n.prototype.setBaseRange=function(t,e,i){this.inherited&&this.superFastener instanceof n?this.superFastener.setBaseRange(t,e,i):this.setRange(t,e,i)},n.prototype.fromAny=function(t){return"string"==typeof t&&(t=Fr.parseScale(t)),t},n}(i.Animator),Ir=function(){const t={is:function(t){if("object"==typeof t&&null!==t){const e=t;return e instanceof Fr||e instanceof ns&&"xScale"in e}return!1}};return t}(),Mr=function(){const t={is:function(t){if("object"==typeof t&&null!==t){const e=t;return e instanceof Fr||e instanceof ns&&"yScale"in e}return!1}};return t}(),Rr=function(){const t={is:function(t){if("object"==typeof t&&null!==t){const e=t;return e instanceof Fr||e instanceof ns&&"xScale"in e&&"yScale"in e}return!1}};return t}();class Fr extends ss{constructor(){super(),this.scaledFlags=0,this.xDataDomain=null,this.yDataDomain=null,this.xDataRange=null,this.yDataRange=null,this.xDataDomainPadded=null,this.yDataDomainPadded=null}setScaledFlags(t){this.scaledFlags=t}xDomain(t,i,n){if(void 0===t){const t=this.xScale.value;return null!==t?t.domain:null}{(t instanceof e.Domain||"string"==typeof t)&&(n=i),!0===n&&(n=this.rescaleTransition.state);const s=this.xRange();return t instanceof e.Domain||"string"==typeof t?null!==s?this.xScale.setBaseScale(t,s,n):this.xScale.setBaseDomain(t,n):null!==s?this.xScale.setBaseScale(t,i,s[0],s[1],n):this.xScale.setBaseDomain(t,i,n),this}}yDomain(t,i,n){if(void 0===t){const t=this.yScale.value;return null!==t?t.domain:null}{(t instanceof e.Domain||"string"==typeof t)&&(n=i),!0===n&&(n=this.rescaleTransition.state);const s=this.yRange();return t instanceof e.Domain||"string"==typeof t?null!==s?this.yScale.setBaseScale(t,s,n):this.yScale.setBaseDomain(t,n):null!==s?this.yScale.setBaseScale(t,i,s[0],s[1],n):this.yScale.setBaseDomain(t,i,n),this}}xRange(){const t=this.viewFrame.width;if(isFinite(t)){const i=this.xRangePadding.state,n=i[0],s=t-i[1];return e.LinearRange(n,s)}return null}yRange(){const t=this.viewFrame.height;if(isFinite(t)){const i=this.yRangePadding.state,n=i[0],s=t-i[1];return e.LinearRange(s,n)}return null}setXDataDomain(t){const i=this.xDataDomain;e.Equals(t,i)||(this.willSetXDataDomain(t,i),this.xDataDomain=t,this.onSetXDataDomain(t,i),this.didSetXDataDomain(t,i))}willSetXDataDomain(t,e){this.callObservers("viewWillSetXDataDomain",t,e,this)}onSetXDataDomain(t,e){this.updateXDataRange(),this.updateXDataDomainPadded(),this.requireUpdate(fn.NeedsLayout)}didSetXDataDomain(t,e){this.callObservers("viewDidSetXDataDomain",t,e,this)}updateXDataDomain(t){let i=this.xDataDomain;null===i||1===this.scaled.viewCount?i=t:null!==t&&(e.Values.compare(t[0],i[0])<0&&(i=e.Domain(t[0],i[1])),e.Values.compare(i[1],t[1])<0&&(i=e.Domain(i[0],t[1]))),this.setXDataDomain(i)}setYDataDomain(t){const i=this.yDataDomain;e.Equals(t,i)||(this.willSetYDataDomain(t,i),this.yDataDomain=t,this.onSetYDataDomain(t,i),this.didSetYDataDomain(t,i))}willSetYDataDomain(t,e){this.callObservers("viewWillSetYDataDomain",t,e,this)}onSetYDataDomain(t,e){this.updateYDataRange(),this.updateYDataDomainPadded(),this.requireUpdate(fn.NeedsLayout)}didSetYDataDomain(t,e){this.callObservers("viewDidSetYDataDomain",t,e,this)}updateYDataDomain(t){let i=this.yDataDomain;null===i||1===this.scaled.viewCount?i=t:null!==t&&(e.Values.compare(t[0],i[0])<0&&(i=e.Domain(t[0],i[1])),e.Values.compare(i[1],t[1])<0&&(i=e.Domain(i[0],t[1]))),this.setYDataDomain(i)}setXDataRange(t){this.xDataRange=t}updateXDataRange(){const t=this.xDataDomain;if(null!==t){const i=this.xScale.value;null!==i?this.setXDataRange(e.LinearRange(i(t[0]),i(t[1]))):this.setXDataRange(null)}}setYDataRange(t){this.yDataRange=t}updateYDataRange(){const t=this.yDataDomain;if(null!==t){const i=this.yScale.value;null!==i?this.setYDataRange(e.LinearRange(i(t[0]),i(t[1]))):this.setYDataRange(null)}}setXDataDomainPadded(t){this.xDataDomainPadded=t}updateXDataDomainPadded(){let t;const i=this.xDataDomain;if(null!==i){let n=i[0],s=i[1];const o=this.xDomainPadding.state;"boolean"!=typeof o[0]&&(n=+n-+o[0]),"boolean"!=typeof o[1]&&(s=+s+ +o[1]),t=e.Domain(n,s)}else t=null;this.setXDataDomainPadded(t)}setYDataDomainPadded(t){this.yDataDomainPadded=t}updateYDataDomainPadded(){let t;const i=this.yDataDomain;if(null!==i){let n=i[0],s=i[1];const o=this.yDomainPadding.state;"boolean"!=typeof o[0]&&(n=+n-+o[0]),"boolean"!=typeof o[1]&&(s=+s+ +o[1]),t=e.Domain(n,s)}else t=null;this.setYDataDomainPadded(t)}updateXRangePadding(t){if(this.xRangePadding.hasAffinity(i.Affinity.Intrinsic)){let e=this.xRangePadding.state;null===e||1===this.scaled.viewCount?e=t:null!==t&&(e=[Math.max(e[0],t[0]),Math.max(e[1],t[1])]),this.xRangePadding.setState(e,i.Affinity.Intrinsic)}}updateYRangePadding(t){if(this.yRangePadding.hasAffinity(i.Affinity.Intrinsic)){let e=this.yRangePadding.state;null===e||1===this.scaled.viewCount?e=t:null!==t&&(e=[Math.max(e[0],t[0]),Math.max(e[1],t[1])]),this.yRangePadding.setState(e,i.Affinity.Intrinsic)}}xFitAlign(t){const e=this.fitAlign.state;return void 0===t?e[0]:(this.fitAlign.setState([t,e[1]]),this)}yFitAlign(t){const e=this.fitAlign.state;return void 0===t?e[0]:(this.fitAlign.setState([e[0],t]),this)}preserveAspectRatio(t){return void 0===t?this.gesture.preserveAspectRatio:(this.gesture.preserveAspectRatio=t,this)}domainTracking(t,e){return void 0===t?[0!=(this.scaledFlags&Fr.XDomainTrackingFlag),0!=(this.scaledFlags&Fr.YDomainTrackingFlag)]:(Array.isArray(t)?(e=t[1],t=t[0]):void 0===e&&(e=t),t?this.setScaledFlags(this.scaledFlags|Fr.XDomainTrackingFlag):this.setScaledFlags(this.scaledFlags&~Fr.XDomainTrackingFlag),e?this.setScaledFlags(this.scaledFlags|Fr.YDomainTrackingFlag):this.setScaledFlags(this.scaledFlags&~Fr.YDomainTrackingFlag),this)}xDomainTracking(t){return void 0===t?0!=(this.scaledFlags&Fr.XDomainTrackingFlag):(t?this.setScaledFlags(this.scaledFlags|Fr.XDomainTrackingFlag):this.setScaledFlags(this.scaledFlags&~Fr.XDomainTrackingFlag),this)}yDomainTracking(t){return void 0===t?0!=(this.scaledFlags&Fr.YDomainTrackingFlag):(t?this.setScaledFlags(this.scaledFlags|Fr.YDomainTrackingFlag):this.setScaledFlags(this.scaledFlags&~Fr.YDomainTrackingFlag),this)}scaleGestures(t,e){return void 0===t?[0!=(this.scaledFlags&Fr.XScaleGesturesFlag),0!=(this.scaledFlags&Fr.YScaleGesturesFlag)]:(Array.isArray(t)?(e=t[1],t=t[0]):void 0===e&&(e=t),t?this.setScaledFlags(this.scaledFlags|Fr.XScaleGesturesFlag):this.setScaledFlags(this.scaledFlags&~Fr.XScaleGesturesFlag),e?this.setScaledFlags(this.scaledFlags|Fr.YScaleGesturesFlag):this.setScaledFlags(this.scaledFlags&~Fr.YScaleGesturesFlag),this)}xScaleGestures(t){return void 0===t?0!=(this.scaledFlags&Fr.XScaleGesturesFlag):(t?this.setScaledFlags(this.scaledFlags|Fr.XScaleGesturesFlag):this.setScaledFlags(this.scaledFlags&~Fr.XScaleGesturesFlag),this)}yScaleGestures(t){return void 0===t?0!=(this.scaledFlags&Fr.YScaleGesturesFlag):(t?this.setScaledFlags(this.scaledFlags|Fr.YScaleGesturesFlag):this.setScaledFlags(this.scaledFlags&~Fr.YScaleGesturesFlag),this)}fitX(t=!1){this.setScaledFlags(this.scaledFlags|Fr.XFitFlag),!0===t&&this.setScaledFlags(this.scaledFlags|Fr.XFitTweenFlag),this.requireUpdate(fn.NeedsLayout)}fitY(t=!1){this.setScaledFlags(this.scaledFlags|Fr.YFitFlag),!0===t&&this.setScaledFlags(this.scaledFlags|Fr.YFitTweenFlag),this.requireUpdate(fn.NeedsLayout)}fit(t=!1){this.setScaledFlags(this.scaledFlags|Fr.XFitFlag|Fr.YFitFlag),!0===t&&this.setScaledFlags(this.scaledFlags|Fr.FitTweenMask),this.requireUpdate(fn.NeedsLayout)}onLayout(t){super.onLayout(t),this.xScale.recohere(t.updateTime),this.yScale.recohere(t.updateTime),this.resizeScales(),this.updateScales()}resizeScales(){let t;const e=this.xRange();if(null!==e)if(t=this.xScale.inherited?null:this.xScale.state,null!==t)t.range.equals(e)||(this.xScale.setRange(e),this.setScaledFlags(this.scaledFlags|Fr.RescaleFlag));else if(null===this.xScale.superFastener||null===this.xScale.superValue){const i=this.xDataDomainPadded;null!==i&&(t=Fr.createScale(i[0],i[1],e[0],e[1]),this.xScale.setState(t),this.setScaledFlags(this.scaledFlags|Fr.XFitFlag))}let i;const n=this.yRange();if(null!==n)if(i=this.yScale.inherited?null:this.yScale.state,null!==i)i.range.equals(n)||(this.yScale.setRange(n),this.setScaledFlags(this.scaledFlags|Fr.RescaleFlag));else if(null===this.yScale.superFastener||null===this.yScale.superValue){const t=this.yDataDomainPadded;null!==t&&(i=Fr.createScale(t[0],t[1],n[0],n[1]),this.yScale.setState(i),this.setScaledFlags(this.scaledFlags|Fr.YFitFlag))}}updateScales(){const t=this.xScale.inherited?null:this.xScale.state,e=this.yScale.inherited?null:this.yScale.state;if(null!==t&&null!==e){if(!this.gesture.pressing){const i=this.gesture.coasting;this.boundScales(t,e,i)}}}boundScales(t,i,n){const s=t.domain,o=i.domain;let r=s,a=o;const h=this.xDataDomainPadded;null!==h&&0!=(this.scaledFlags&Fr.XFitFlag)?(r=h,this.setScaledFlags(this.scaledFlags|Fr.XInRangeMask)):r=s;const d=this.yDataDomainPadded;null!==d&&0!=(this.scaledFlags&Fr.YFitFlag)?(a=d,this.setScaledFlags(this.scaledFlags|Fr.YInRangeMask)):a=o;const c=null!==h?h:s,u=this.xDomainBounds.state,p=!1===u[0]?void 0:!0===u[0]?c[0]:u[0],f=!1===u[1]?void 0:!0===u[1]?c[1]:u[1],g=this.xZoomBounds.state;let v=g[0],y=g[1];!0===v?v=t instanceof e.LinearScale?Fr.LinearZoomMin:t instanceof l.TimeScale?Fr.TimeZoomMin:void 0:!1===v&&(v=void 0),!0===y?y=t instanceof e.LinearScale?Fr.LinearZoomMax:t instanceof l.TimeScale?Fr.TimeZoomMax:void 0:!1===y&&(y=void 0),r=t.clampDomain(p,f,v,y).domain;const w=null!==d?d:o,m=this.yDomainBounds.state,b=!1===m[0]?void 0:!0===m[0]?w[0]:m[0],C=!1===m[1]?void 0:!0===m[1]?w[1]:m[1],S=this.yZoomBounds.state;let A=S[0],x=S[1];if(!0===A?A=i instanceof e.LinearScale?Fr.LinearZoomMin:i instanceof l.TimeScale?Fr.TimeZoomMin:void 0:!1===A&&(A=void 0),!0===x?x=i instanceof e.LinearScale?Fr.LinearZoomMax:i instanceof l.TimeScale?Fr.TimeZoomMax:void 0:!1===x&&(x=void 0),a=i.clampDomain(b,C,A,x).domain,null!==h&&!n&&0!=(this.scaledFlags&Fr.XDomainTrackingFlag)&&0!=(this.scaledFlags&Fr.XInRangeMask))if((this.scaledFlags&Fr.XInRangeMask)===Fr.XInRangeMask)r=h;else{const t=+r[1]-+r[0];r=0!=(this.scaledFlags&Fr.XMinInRangeFlag)?e.Domain(h[0],+h[0]+ +t):e.Domain(+h[1]-+t,h[1])}if(null!==d&&!n&&0!=(this.scaledFlags&Fr.YDomainTrackingFlag)&&0!=(this.scaledFlags&Fr.YInRangeMask))if((this.scaledFlags&Fr.YInRangeMask)===Fr.YInRangeMask)a=d;else{const t=+a[1]-+a[0];a=0!=(this.scaledFlags&Fr.YMinInRangeFlag)?e.Domain(d[0],+d[0]+ +t):e.Domain(+d[1]-+t,d[1])}const D=this.fitAspectRatio.state;if(void 0!==D&&(this.gesture.preserveAspectRatio||0!=(this.scaledFlags&Fr.FitMask))){const n=t.range,s=i.range,o=+r[1]-+r[0],l=+a[1]-+a[0],h=o/l,d=(n[1]-n[0])/(s[0]-s[1]),c=Math.abs(D*d);if(!e.Equivalent(h,c)){const t=this.fitAlign.state;if(D<0&&h<c||D>0&&h>c){const i=l*c-o;r=e.Domain(+r[0]-i*t[0],+r[1]+i*(1-t[0]))}else{const i=o/c-l;a=e.Domain(+a[0]-i*t[1],+a[1]+i*(1-t[1]))}}}if(0==(this.scaledFlags&Fr.XBoundingFlag)&&!e.Equivalent(r,s)){let e;0!=(this.scaledFlags&(Fr.XFitFlag|Fr.RescaleFlag))&&0==(this.scaledFlags&Fr.XFitTweenFlag)||(e=0!=(this.scaledFlags&Fr.InteractingMask)?this.reboundTransition.state:this.rescaleTransition.state,void 0!==e&&!1!==e&&this.setScaledFlags(this.scaledFlags|Fr.XBoundingFlag)),this.willReboundX(t),this.xDomain(r,e),void 0===e&&!1!==e&&this.didReboundX(this.xScale.getState()),null!==h&&0!=(this.scaledFlags&Fr.XFitFlag)&&this.setScaledFlags(this.scaledFlags&~Fr.XFitFlag)}if(0==(this.scaledFlags&Fr.YBoundingFlag)&&!e.Equivalent(a,o)){let t;0!=(this.scaledFlags&(Fr.YFitFlag|Fr.RescaleFlag))&&0==(this.scaledFlags&Fr.YFitTweenFlag)||(t=0!=(this.scaledFlags&Fr.InteractingMask)?this.reboundTransition.state:this.rescaleTransition.state,void 0!==t&&!1!==t&&this.setScaledFlags(this.scaledFlags|Fr.YBoundingFlag)),this.willReboundY(i),this.yDomain(a,t),void 0===t&&!1!==t&&this.didReboundY(this.yScale.getState()),null!==d&&0!=(this.scaledFlags&Fr.YFitFlag)&&this.setScaledFlags(this.scaledFlags&~Fr.YFitFlag)}this.setScaledFlags(this.scaledFlags&~(Fr.InteractedFlag|Fr.RescaleFlag))}displayChildren(t,e,i){let n,s;0!=(t&fn.NeedsLayout)&&(n=this.xScale.value,null!==n)&&(s=this.yScale.value,null!==s)?this.layoutChildViews(n,s,t,e,i):super.displayChildren(t,e,i)}layoutChildViews(t,n,s,o,r){let l,a,h,d,c=0,u=0,p=0,f=0,g=0,v=0;super.displayChildren(s,o,(function(t,i,n){if(r.call(this,t,i,n),Ir.is(t)&&t.xScale.inherited){const i=t.xDataDomain;if(null!==i){0!==g?(e.Values.compare(i[0],l)<0&&(l=i[0]),e.Values.compare(a,i[1])<0&&(a=i[1])):(l=i[0],a=i[1]);const n=t.xRangePadding();c=Math.max(n[0],c),u=Math.max(n[1],u),g+=1}}if(Mr.is(t)&&t.yScale.inherited){const i=t.yDataDomain;if(null!==i){0!==v?(e.Values.compare(i[0],h)<0&&(h=i[0]),e.Values.compare(d,i[1])<0&&(d=i[1])):(h=i[0],d=i[1]);const n=t.yRangePadding();p=Math.max(n[0],p),f=Math.max(n[1],f),v+=1}}})),this.setXDataDomain(0!==g?e.Domain(l,a):null),this.setYDataDomain(0!==v?e.Domain(h,d):null),this.xRangePadding.setState([c,u],i.Affinity.Intrinsic),this.yRangePadding.setState([p,f],i.Affinity.Intrinsic)}onBeginBoundingXScale(t){}onEndBoundingXScale(t){this.setScaledFlags(this.scaledFlags&~Fr.XBoundingFlag),this.didReboundX(t)}onInterruptBoundingXScale(t){this.setScaledFlags(this.scaledFlags&~Fr.XBoundingFlag),this.didReboundX(t)}onBeginBoundingYScale(t){}onEndBoundingYScale(t){this.setScaledFlags(this.scaledFlags&~Fr.YBoundingFlag),this.didReboundY(t)}onInterruptBoundingYScale(t){this.setScaledFlags(this.scaledFlags&~Fr.YBoundingFlag),this.didReboundY(t)}willReboundX(t){this.gesture.neutralizeX()}didReboundX(t){}willReboundY(t){this.gesture.neutralizeY()}didReboundY(t){}init(t){super.init(t),void 0!==t.xScale&&this.xScale(t.xScale),void 0!==t.yScale&&this.yScale(t.yScale),void 0!==t.xDomainBounds&&this.xDomainBounds(t.xDomainBounds),void 0!==t.yDomainBounds&&this.yDomainBounds(t.yDomainBounds),void 0!==t.xZoomBounds&&this.xZoomBounds(t.xZoomBounds),void 0!==t.yZoomBounds&&this.yZoomBounds(t.yZoomBounds),void 0!==t.xDomainPadding&&this.xDomainPadding(t.xDomainPadding),void 0!==t.yDomainPadding&&this.yDomainPadding(t.yDomainPadding),void 0!==t.xRangePadding&&this.xRangePadding(t.xRangePadding),void 0!==t.yRangePadding&&this.yRangePadding(t.yRangePadding),void 0!==t.fitAlign&&this.fitAlign(t.fitAlign),void 0!==t.xFitAlign&&this.xFitAlign(t.xFitAlign),void 0!==t.yFitAlign&&this.yFitAlign(t.yFitAlign),void 0!==t.fitAspectRatio&&this.fitAspectRatio(t.fitAspectRatio),void 0!==t.preserveAspectRatio&&this.preserveAspectRatio(t.preserveAspectRatio),void 0!==t.domainTracking&&this.domainTracking(t.domainTracking),void 0!==t.xDomainTracking&&this.xDomainTracking(t.xDomainTracking),void 0!==t.yDomainTracking&&this.yDomainTracking(t.yDomainTracking),void 0!==t.scaleGestures&&this.scaleGestures(t.scaleGestures),void 0!==t.xScaleGestures&&this.xScaleGestures(t.xScaleGestures),void 0!==t.yScaleGestures&&this.yScaleGestures(t.yScaleGestures),void 0!==t.rescaleTransition&&this.rescaleTransition.setState(t.rescaleTransition),void 0!==t.reboundTransition&&this.reboundTransition.setState(t.reboundTransition)}static createScale(t,i,n,s){let o;if(o="number"==typeof n&&"number"==typeof s?e.LinearRange(n,s):e.LinearRange(0,1),"number"==typeof t&&"number"==typeof i)return e.LinearScale(e.LinearDomain(t,i),o);if(t instanceof l.DateTime&&i instanceof l.DateTime)return l.TimeScale(l.TimeDomain(t,i),o);throw new TypeError(t+", "+i+", "+n+", "+s)}static parseScale(t){if("linear"===t)return e.LinearScale(e.LinearDomain(0,1),e.LinearRange(0,1));if("time"===t){const t=l.DateTime.current(),i=t.withDay(t.day-1);return l.TimeScale(l.TimeDomain(i,t),e.LinearRange(0,1))}{const i=t.split("..."),n=+i[0],s=+i[1];if(isFinite(n)&&isFinite(s))return e.LinearScale(e.LinearDomain(n,s),e.LinearRange(0,1));{const t=l.DateTime.parse(i[0]),n=l.DateTime.parse(i[1]);return l.TimeScale(l.TimeDomain(t,n),e.LinearRange(0,1))}}}}Fr.XDomainTrackingFlag=1,Fr.YDomainTrackingFlag=2,Fr.XScaleGesturesFlag=4,Fr.YScaleGesturesFlag=8,Fr.XMinInRangeFlag=16,Fr.XMaxInRangeFlag=32,Fr.YMinInRangeFlag=64,Fr.YMaxInRangeFlag=128,Fr.InteractingFlag=256,Fr.InteractedFlag=512,Fr.XBoundingFlag=1024,Fr.YBoundingFlag=2048,Fr.XFitFlag=4096,Fr.YFitFlag=8192,Fr.XFitTweenFlag=16384,Fr.YFitTweenFlag=32768,Fr.RescaleFlag=65536,Fr.DomainTrackingMask=Fr.XDomainTrackingFlag|Fr.YDomainTrackingFlag,Fr.ScaleGesturesMask=Fr.XScaleGesturesFlag|Fr.YScaleGesturesFlag,Fr.XInRangeMask=Fr.XMinInRangeFlag|Fr.XMaxInRangeFlag,Fr.YInRangeMask=Fr.YMinInRangeFlag|Fr.YMaxInRangeFlag,Fr.InteractingMask=Fr.InteractingFlag|Fr.InteractedFlag,Fr.BoundingMask=Fr.XBoundingFlag|Fr.YBoundingFlag,Fr.FitMask=Fr.XFitFlag|Fr.YFitFlag,Fr.FitTweenMask=Fr.XFitTweenFlag|Fr.YFitTweenFlag,Fr.LinearZoomMin=1e6,Fr.LinearZoomMax=.001,Fr.TimeZoomMin=864e5,Fr.TimeZoomMax=1,Fr.InsertChildFlags=ss.InsertChildFlags|fn.NeedsResize,u([i.Animator({extends:Vr,type:e.ContinuousScale,inherits:!0,state:null,updateFlags:fn.NeedsLayout,willSetValue(t,e){this.owner.callObservers("viewWillSetXScale",t,e,this.owner)},didSetValue(t,e){this.owner.updateXDataRange(),this.owner.callObservers("viewDidSetXScale",t,e,this.owner)},willTransition(t){0!=(this.owner.scaledFlags&Fr.XBoundingFlag)&&this.owner.onBeginBoundingXScale(t)},didTransition(t){0!=(this.owner.scaledFlags&Fr.XBoundingFlag)&&this.owner.onEndBoundingXScale(t)},didInterrupt(t){0!=(this.owner.scaledFlags&Fr.XBoundingFlag)&&this.owner.onInterruptBoundingXScale(t)}})],Fr.prototype,"xScale",void 0),u([i.Animator({extends:Vr,type:e.ContinuousScale,inherits:!0,state:null,updateFlags:fn.NeedsLayout,willSetValue(t,e){this.owner.callObservers("viewWillSetYScale",t,e,this.owner)},didSetValue(t,e){this.owner.updateYDataRange(),this.owner.callObservers("viewDidSetYScale",t,e,this.owner)},willTransition(t){0!=(this.owner.scaledFlags&Fr.YBoundingFlag)&&this.owner.onBeginBoundingYScale(t)},didTransition(t){0!=(this.owner.scaledFlags&Fr.YBoundingFlag)&&this.owner.onEndBoundingYScale(t)},didInterrupt(t){0!=(this.owner.scaledFlags&Fr.YBoundingFlag)&&this.owner.onInterruptBoundingYScale(t)}})],Fr.prototype,"yScale",void 0),u([i.Property({updateFlags:fn.NeedsLayout,initState:()=>[!0,!0],equalState:(t,i)=>e.Arrays.equal(t,i)})],Fr.prototype,"xDomainBounds",void 0),u([i.Property({updateFlags:fn.NeedsLayout,initState:()=>[!0,!0],equalState:(t,i)=>e.Arrays.equal(t,i)})],Fr.prototype,"yDomainBounds",void 0),u([i.Property({updateFlags:fn.NeedsLayout,initState:()=>[!0,!0],equalState:(t,i)=>e.Arrays.equal(t,i)})],Fr.prototype,"xZoomBounds",void 0),u([i.Property({updateFlags:fn.NeedsLayout,initState:()=>[!0,!0],equalState:(t,i)=>e.Arrays.equal(t,i)})],Fr.prototype,"yZoomBounds",void 0),u([i.Property({updateFlags:fn.NeedsLayout,initState:()=>[!1,!1],equalState:(t,i)=>e.Arrays.equal(t,i)})],Fr.prototype,"xDomainPadding",void 0),u([i.Property({updateFlags:fn.NeedsLayout,initState:()=>[!1,!1],equalState:(t,i)=>e.Arrays.equal(t,i)})],Fr.prototype,"yDomainPadding",void 0),u([i.Property({updateFlags:fn.NeedsLayout,initState:()=>[0,0],willSetState(t,e){this.owner.callObservers("viewWillSetXRangePadding",t,e,this.owner)},didSetState(t,e){this.owner.callObservers("viewDidSetXRangePadding",t,e,this.owner)},equalState:(t,i)=>e.Arrays.equal(t,i)})],Fr.prototype,"xRangePadding",void 0),u([i.Property({updateFlags:fn.NeedsLayout,initState:()=>[0,0],willSetState(t,e){this.owner.callObservers("viewWillSetYRangePadding",t,e,this.owner)},didSetState(t,e){this.owner.callObservers("viewDidSetYRangePadding",t,e,this.owner)},equalState:(t,i)=>e.Arrays.equal(t,i)})],Fr.prototype,"yRangePadding",void 0),u([i.Property({type:Object,initState:()=>[1,.5],equalState:(t,i)=>e.Arrays.equal(t,i),fromAny:t=>"number"==typeof t?[t,t]:t})],Fr.prototype,"fitAlign",void 0),u([i.Property({type:Number})],Fr.prototype,"fitAspectRatio",void 0),u([i.Property({type:e.Timing,inherits:!0,initState:()=>e.Easing.linear.withDuration(250)})],Fr.prototype,"rescaleTransition",void 0),u([i.Property({type:e.Timing,inherits:!0,initState:()=>e.Easing.cubicOut.withDuration(250)})],Fr.prototype,"reboundTransition",void 0),u([yn({binds:!0,observes:!0,willAttachView(t,e){this.owner.callObservers("viewWillAttachScaled",t,e,this.owner)},didAttachView(t){Ir.is(t)&&this.owner.updateXDataDomain(t.xDataDomain),Mr.is(t)&&this.owner.updateYDataDomain(t.yDataDomain)},didDetachView(t){this.owner.callObservers("viewDidDetachScaled",t,this.owner)},viewDidSetXRangePadding(t,e){this.owner.updateXRangePadding(t)},viewDidSetYRangePadding(t,e){this.owner.updateYRangePadding(t)},viewDidSetXDataDomain(t,e){this.owner.updateXDataDomain(t),this.owner.requireUpdate(fn.NeedsLayout)},viewDidSetYDataDomain(t,e){this.owner.updateYDataDomain(t),this.owner.requireUpdate(fn.NeedsLayout)},detectView:t=>Ir.is(t)||Mr.is(t)?t:null})],Fr.prototype,"scaled",void 0),u([dn({self:!0,getXScale(){return 0!=(this.owner.scaledFlags&Fr.XScaleGesturesFlag)?this.owner.xScale():null},setXScale(t,e){0!=(this.owner.scaledFlags&Fr.XScaleGesturesFlag)&&this.owner.xScale(t,e)},getYScale(){return 0!=(this.owner.scaledFlags&Fr.YScaleGesturesFlag)?this.owner.yScale():null},setYScale(t,e){0!=(this.owner.scaledFlags&Fr.YScaleGesturesFlag)&&this.owner.yScale(t,e)},willStartInteracting(){this.owner.setScaledFlags(this.owner.scaledFlags&~Fr.BoundingMask|Fr.InteractingFlag)},didStopInteracting(){const t=this.owner.xScale.value,e=this.owner.xDataDomain;if(null!==t&&null!==e){const i=t.domain;i.contains(e[0])?this.owner.setScaledFlags(this.owner.scaledFlags|Fr.XMinInRangeFlag):this.owner.setScaledFlags(this.owner.scaledFlags&~Fr.XMinInRangeFlag),i.contains(e[1])?this.owner.setScaledFlags(this.owner.scaledFlags|Fr.XMaxInRangeFlag):this.owner.setScaledFlags(this.owner.scaledFlags&~Fr.XMaxInRangeFlag)}const i=this.owner.yScale.value,n=this.owner.yDataDomain;if(null!==i&&null!==n){const t=i.domain;t.contains(n[0])?this.owner.setScaledFlags(this.owner.scaledFlags|Fr.YMinInRangeFlag):this.owner.setScaledFlags(this.owner.scaledFlags&~Fr.YMinInRangeFlag),t.contains(n[1])?this.owner.setScaledFlags(this.owner.scaledFlags|Fr.YMaxInRangeFlag):this.owner.setScaledFlags(this.owner.scaledFlags&~Fr.YMaxInRangeFlag)}this.owner.setScaledFlags(this.owner.scaledFlags&~Fr.InteractingFlag|Fr.InteractedFlag)},didStopPressing(){this.owner.requireUpdate(fn.NeedsLayout)},willBeginCoast(t,e){0==(this.owner.scaledFlags&Fr.XScaleGesturesFlag)&&(t.disableX=!0,t.vx=0,t.ax=0),0==(this.owner.scaledFlags&Fr.YScaleGesturesFlag)&&(t.disableY=!0,t.vy=0,t.ay=0)}})],Fr.prototype,"gesture",void 0);class Lr extends ss{constructor(){super(),this.xDataDomain=null,this.yDataDomain=null,this.xDataRange=null,this.yDataRange=null}xDomain(t,e,i){if(0===arguments.length){const t=this.xScale.value;return null!==t?t.domain:null}return this.xScale.setDomain(t,e,i),this}yDomain(t,e,i){if(0===arguments.length){const t=this.yScale.value;return null!==t?t.domain:null}return this.yScale.setDomain(t,e,i),this}xRange(){const t=this.xScale.value;return null!==t?t.range:null}yRange(){const t=this.yScale.value;return null!==t?t.range:null}setXDataDomain(t){const i=this.xDataDomain;e.Equals(t,i)||(this.willSetXDataDomain(t,i),this.xDataDomain=t,this.onSetXDataDomain(t,i),this.didSetXDataDomain(t,i))}willSetXDataDomain(t,e){this.callObservers("viewWillSetXDataDomain",t,e,this)}onSetXDataDomain(t,e){this.updateXDataRange(),this.requireUpdate(fn.NeedsLayout)}didSetXDataDomain(t,e){this.callObservers("viewDidSetXDataDomain",t,e,this)}updateXDataDomain(t){const i=t.x.getValue();let n=this.xDataDomain;null===n?n=e.Domain(i,i):e.Values.compare(i,n[0])<0?n=e.Domain(i,n[1]):e.Values.compare(n[1],i)<0&&(n=e.Domain(n[0],i)),this.setXDataDomain(n)}setYDataDomain(t){const i=this.yDataDomain;e.Equals(t,i)||(this.willSetYDataDomain(t,i),this.yDataDomain=t,this.onSetYDataDomain(t,i),this.didSetYDataDomain(t,i))}willSetYDataDomain(t,e){this.callObservers("viewWillSetYDataDomain",t,e,this)}onSetYDataDomain(t,e){this.updateYDataRange(),this.requireUpdate(fn.NeedsLayout)}didSetYDataDomain(t,e){this.callObservers("viewDidSetYDataDomain",t,e,this)}updateYDataDomain(t){const i=t.y.value,n=t.y2.value;let s=this.yDataDomain;null===s?s=e.Domain(i,i):(e.Values.compare(i,s[0])<0?s=e.Domain(i,s[1]):e.Values.compare(s[1],i)<0&&(s=e.Domain(s[0],i)),void 0!==n&&(e.Values.compare(n,s[0])<0?s=e.Domain(n,s[1]):e.Values.compare(s[1],n)<0&&(s=e.Domain(s[0],n)))),this.setYDataDomain(s)}setXDataRange(t){this.xDataRange=t}updateXDataRange(){const t=this.xDataDomain;if(null!==t){const i=this.xScale.value;null!==i?this.setXDataRange(e.LinearRange(i(t[0]),i(t[1]))):this.setXDataRange(null)}}setYDataRange(t){this.yDataRange=t}updateYDataRange(){const t=this.yDataDomain;if(null!==t){const i=this.yScale.value;null!==i?this.setYDataRange(e.LinearRange(i(t[0]),i(t[1]))):this.setYDataRange(null)}}onLayout(t){super.onLayout(t),this.xScale.recohere(t.updateTime),this.yScale.recohere(t.updateTime),this.resizeScales(this.viewFrame)}resizeScales(t){const e=this.xScale.inherited?null:this.xScale.value;null!==e&&e.range[1]!==t.width&&this.xScale.setRange(0,t.width);const i=this.yScale.inherited?null:this.yScale.value;null!==i&&i.range[1]!==t.height&&this.yScale.setRange(0,t.height)}displayChildren(t,e,i){let n,s;0!=(t&fn.NeedsLayout)&&(n=this.xScale.value,null!==n)&&(s=this.yScale.value,null!==s)?this.layoutChildViews(n,s,t,e,i):super.displayChildren(t,e,i)}layoutChildViews(t,n,s,o,r){const l=this.viewFrame,a=Math.min(l.width,l.height);let h,d,c,u,p=0,f=0,g=0,v=0,y=null;super.displayChildren(s,o,(function(i,s,o){if(i instanceof Ar){const s=i.x.getValue(),o=i.y.getValue(),r=i.y2.value,w=i.radius.value,m=t(s),b=n(o);if(i.setXCoord(l.xMin+m),i.setYCoord(l.yMin+b),null!==y?(e.Values.compare(s,h)<0?h=s:e.Values.compare(d,s)<0&&(d=s),e.Values.compare(o,c)<0?c=o:e.Values.compare(u,o)<0&&(u=o),void 0!==r&&(e.Values.compare(r,c)<0?c=r:e.Values.compare(u,r)<0&&(u=r))):(h=s,d=s,c=o,u=o),null!==w){const t=w.pxValue(a);p=Math.max(t,p),f=Math.max(t,f),g=Math.max(t,g),v=Math.max(t,v)}y=i}r.call(this,i,s,o)})),this.setXDataDomain(null!==y?e.Domain(h,d):null),this.setYDataDomain(null!==y?e.Domain(c,u):null),this.xRangePadding.setState([p,f],i.Affinity.Intrinsic),this.yRangePadding.setState([g,v],i.Affinity.Intrinsic)}didRender(t){const e=t.renderer;e instanceof cs&&!this.isHidden()&&!this.culled&&this.renderPlot(e.context,this.viewFrame),super.didRender(t)}init(t){super.init(t),void 0!==t.xScale&&this.xScale(t.xScale),void 0!==t.yScale&&this.yScale(t.yScale);const e=t.data;if(void 0!==e)for(let t=0,i=e.length;t<i;t+=1)this.appendChild(Ar.fromAny(e[t]));void 0!==t.font&&this.font(t.font),void 0!==t.textColor&&this.textColor(t.textColor)}}u([Ht({type:E,state:null,inherits:!0})],Lr.prototype,"font",void 0),u([Ht({type:z,state:null,inherits:!0})],Lr.prototype,"textColor",void 0),u([i.Animator({extends:Vr,type:e.ContinuousScale,inherits:!0,state:null,updateFlags:fn.NeedsLayout,willSetValue(t,e){this.owner.callObservers("viewWillSetXScale",t,e,this.owner)},didSetValue(t,e){this.owner.updateXDataRange(),this.owner.callObservers("viewDidSetXScale",t,e,this.owner)}})],Lr.prototype,"xScale",void 0),u([i.Animator({extends:Vr,type:e.ContinuousScale,inherits:!0,state:null,updateFlags:fn.NeedsLayout,willSetValue(t,e){this.owner.callObservers("viewWillSetYScale",t,e,this.owner)},didSetValue(t,e){this.owner.updateYDataRange(),this.owner.callObservers("viewDidSetYScale",t,e,this.owner)}})],Lr.prototype,"yScale",void 0),u([i.Property({initState:()=>[0,0],willSetState(t,e){this.owner.callObservers("viewWillSetXRangePadding",t,e,this.owner)},didSetState(t,e){this.owner.callObservers("viewDidSetXRangePadding",t,e,this.owner)}})],Lr.prototype,"xRangePadding",void 0),u([i.Property({initState:()=>[0,0],willSetState(t,e){this.owner.callObservers("viewWillSetYRangePadding",t,e,this.owner)},didSetState(t,e){this.owner.callObservers("viewDidSetYRangePadding",t,e,this.owner)}})],Lr.prototype,"yRangePadding",void 0),u([yn({type:Ar,binds:!0,observes:!0,willAttachView(t,e){this.owner.callObservers("viewWillAttachDataPoint",t,e,this.owner)},didAttachView(t){this.owner.updateXDataDomain(t),this.owner.updateYDataDomain(t);const e=t.label.view;null!==e&&this.attachDataPointLabelView(e)},willDetachView(t){const e=t.label.view;null!==e&&this.detachDataPointLabelView(e)},didDetachView(t){this.owner.callObservers("viewDidDetachDataPoint",t,this.owner)},viewDidSetDataPointX(t,e,i){this.owner.updateXDataDomain(i),this.owner.requireUpdate(fn.NeedsLayout)},viewDidSetDataPointY(t,e,i){this.owner.updateYDataDomain(i),this.owner.requireUpdate(fn.NeedsLayout)},viewDidSetDataPointY2(t,e,i){this.owner.updateYDataDomain(i),this.owner.requireUpdate(fn.NeedsLayout)},viewWillAttachDataPointLabel(t){this.attachDataPointLabelView(t)},viewDidDetachDataPointLabel(t){this.detachDataPointLabelView(t)},attachDataPointLabelView(t){this.owner.requireUpdate(fn.NeedsLayout)},detachDataPointLabelView(t){}})],Lr.prototype,"dataPoints",void 0);class kr extends ns{constructor(){super(),this.dataPointRefs=new d.BTree,this.xDataDomain=null,this.yDataDomain=null,this.xDataRange=null,this.yDataRange=null,this.gradientStops=0}xDomain(t,e,i){if(0===arguments.length){const t=this.xScale.value;return null!==t?t.domain:null}return this.xScale.setDomain(t,e,i),this}yDomain(t,e,i){if(0===arguments.length){const t=this.yScale.value;return null!==t?t.domain:null}return this.yScale.setDomain(t,e,i),this}xRange(){const t=this.xScale.value;return null!==t?t.range:null}yRange(){const t=this.yScale.value;return null!==t?t.range:null}setXDataDomain(t){const i=this.xDataDomain;e.Equals(t,i)||(this.willSetXDataDomain(t,i),this.xDataDomain=t,this.onSetXDataDomain(t,i),this.didSetXDataDomain(t,i))}willSetXDataDomain(t,e){this.callObservers("viewWillSetXDataDomain",t,e,this)}onSetXDataDomain(t,e){this.updateXDataRange(),this.requireUpdate(fn.NeedsLayout)}didSetXDataDomain(t,e){this.callObservers("viewDidSetXDataDomain",t,e,this)}updateXDataDomain(t){const i=this.dataPointRefs,n=i.firstKey(),s=i.lastKey();let o;if(void 0!==n&&void 0!==s)o=e.Domain(n,s);else{const i=t.x.getValue();o=e.Domain(i,i)}this.setXDataDomain(o)}setYDataDomain(t){const i=this.yDataDomain;e.Equals(t,i)||(this.willSetYDataDomain(t,i),this.yDataDomain=t,this.onSetYDataDomain(t,i),this.didSetYDataDomain(t,i))}willSetYDataDomain(t,e){this.callObservers("viewWillSetYDataDomain",t,e,this)}onSetYDataDomain(t,e){this.updateYDataRange(),this.requireUpdate(fn.NeedsLayout)}didSetYDataDomain(t,e){this.callObservers("viewDidSetYDataDomain",t,e,this)}updateYDataDomain(t){const i=t.y.value,n=t.y2.value;let s=this.yDataDomain;null===s?s=e.Domain(i,i):(e.Values.compare(i,s[0])<0?s=e.Domain(i,s[1]):e.Values.compare(s[1],i)<0&&(s=e.Domain(s[0],i)),void 0!==n&&(e.Values.compare(n,s[0])<0?s=e.Domain(n,s[1]):e.Values.compare(s[1],n)<0&&(s=e.Domain(s[0],n)))),this.setYDataDomain(s)}setXDataRange(t){this.xDataRange=t}updateXDataRange(){const t=this.xDataDomain;if(null!==t){const i=this.xScale.value;null!==i?this.setXDataRange(e.LinearRange(i(t[0]),i(t[1]))):this.setXDataRange(null)}}setYDataRange(t){this.yDataRange=t}updateYDataRange(){const t=this.yDataDomain;if(null!==t){const i=this.yScale.value;null!==i?this.setYDataRange(e.LinearRange(i(t[0]),i(t[1]))):this.setYDataRange(null)}}insertDataPoint(t,e=null){(t=Ar.fromAny(t)).remove();const i=t.x.getState();this.removeDataPoint(i);const n=this.createDataPointRef(t);return this.willInsertChild(t,null),this.dataPointRefs.set(i,n),n.setView(t,e),t.attachParent(this),this.onInsertChild(t,null),this.didInsertChild(t,null),t.cascadeInsert(),this.mounted&&n.mount(),t}insertDataPoints(...t){for(let e=0,i=t.length;e<i;e+=1)this.insertDataPoint(t[e])}removeDataPoint(t){t instanceof Ar&&(t=t.x.getState());const e=this.dataPointRefs.get(t);if(void 0!==e){const i=e.view;if(i.parent!==this)throw new Error("not a child view");this.willRemoveChild(i),i.detachParent(this),this.dataPointRefs.delete(t),this.onRemoveChild(i),this.didRemoveChild(i),i.setKey(void 0),e.setView(null),this.mounted&&e.unmount()}}createDataPointRef(t){return kr.DataPointRef.create(this)}getDataPointRef(t){const e=this.dataPointRefs.get(t);return void 0!==e?e:null}getDataPointView(t){const e=this.dataPointRefs.get(t);return void 0!==e?e.view:null}mountDataPointRefs(){this.dataPointRefs.forEachValue((function(t){t.mount()}),this)}unmountDataPointRefs(){this.dataPointRefs.forEachValue((function(t){t.unmount()}),this)}get childCount(){return this.dataPointRefs.size}get children(){const t=[];return this.dataPointRefs.forEachValue((function(e){t.push(e.view)}),this),t}firstChild(){const t=this.dataPointRefs.firstValue();return void 0!==t?t.view:null}lastChild(){const t=this.dataPointRefs.lastValue();return void 0!==t?t.view:null}nextChild(t){if(t instanceof Ar){const e=this.dataPointRefs.nextValue(t.x.getState());if(void 0!==e)return e.view}return null}previousChild(t){if(t instanceof Ar){const e=this.dataPointRefs.previousValue(t.x.getState());if(void 0!==e)return e.view}return null}forEachChild(t,e){return this.dataPointRefs.forEachValue((function(i){const n=t.call(e,i.view);if(void 0!==n)return n}),e)}getChild(t,e){return null}setChild(t,e){throw new Error("unsupported")}appendChild(t,e){if(void 0!==e)throw new Error("unsupported");if(!((t=fn.fromAny(t))instanceof Ar))throw new TypeError(""+t);return this.insertDataPoint(t)}prependChild(t,e){if(void 0!==e)throw new Error("unsupported");if(!((t=fn.fromAny(t))instanceof Ar))throw new TypeError(""+t);return this.insertDataPoint(t)}insertChild(t,e,i){if(void 0!==i)throw new Error("unsupported");if(!((t=fn.fromAny(t))instanceof Ar))throw new TypeError(""+t);return this.insertDataPoint(t)}replaceChild(t,e){if(!(e instanceof Ar))throw new TypeError(""+e);if(e.parent!==this)throw new TypeError(""+e);if(!((t=fn.fromAny(t))instanceof Ar))throw new TypeError(""+t);return t!==e&&(this.removeDataPoint(e.x.getState()),this.insertDataPoint(t)),e}removeChild(t){if("string"==typeof t)throw new Error("unsupported");if(!(t instanceof Ar))throw new TypeError(""+t);return this.removeDataPoint(t.x.getState()),t}removeChildren(){this.dataPointRefs.forEach((function(t,e){const i=e.view;this.willRemoveChild(i),i.detachParent(this),this.dataPointRefs.delete(t),this.onRemoveChild(i),this.didRemoveChild(i),i.setKey(void 0),e.setView(null),this.mounted&&e.unmount()}),this)}onLayout(t){super.onLayout(t),this.xScale.recohere(t.updateTime),this.yScale.recohere(t.updateTime),this.resizeScales(this.viewFrame)}resizeScales(t){const e=this.xScale.inherited?null:this.xScale.value;null!==e&&e.range[1]!==t.width&&this.xScale.setRange(0,t.width);const i=this.yScale.inherited?null:this.yScale.value;null!==i&&i.range[1]!==t.height&&this.yScale.setRange(0,t.height)}displayChildren(t,e,i){let n,s;0!=(t&fn.NeedsLayout)&&(n=this.xScale.value,null!==n)&&(s=this.yScale.value,null!==s)?this.layoutChildViews(n,s,t,e,i):super.displayChildren(t,e,i)}layoutChildViews(t,n,s,o,r){const l=this.viewFrame;let a,h,d,c,u,p,f=0,g=null,v=null;if(super.displayChildren(s,o,(function(s,o,y){const w=s,m=w.x.getValue(),b=w.y.getValue(),C=w.y2.value,S=t(m),A=n(b);w.setXCoord(l.xMin+S),w.setYCoord(l.yMin+A);const x=void 0!==C?n(C):void 0;if(void 0!==x?w.setY2Coord(l.yMin+x):void 0!==w.y2Coord&&w.setY2Coord(void 0),w.isGradientStop()&&(f+=1),null!==v){let t;t=null!==g?e.Values.compare(u,p)<0&&e.Values.compare(b,p)<0?"maxima":e.Values.compare(p,u)<0&&e.Values.compare(p,b)<0?"minima":e.Values.compare(u,p)<0&&e.Values.compare(p,b)<0?"increasing":e.Values.compare(p,u)<0&&e.Values.compare(b,p)<0?"decreasing":"flat":e.Values.compare(p,b)<0?"increasing":e.Values.compare(b,p)<0?"decreasing":"flat",v.category.setState(t,i.Affinity.Intrinsic),e.Values.compare(b,d)<0?d=b:e.Values.compare(c,b)<0&&(c=b),void 0!==C&&(e.Values.compare(C,d)<0?d=C:e.Values.compare(c,C)<0&&(c=C))}else a=m,h=m,d=b,c=b;g=v,v=w,u=p,p=b,h=m,r.call(this,s,o,y)})),null!==v){let t;t=null!==g?e.Values.compare(u,p)<0?"increasing":e.Values.compare(p,u)<0?"decreasing":"flat":"flat",v.category.setState(t,i.Affinity.Intrinsic)}this.setXDataDomain(null!==g?e.Domain(a,h):null),this.setYDataDomain(null!==g?e.Domain(d,c):null),this.gradientStops=f}didRender(t){const e=t.renderer;e instanceof cs&&!this.isHidden()&&!this.culled&&this.renderPlot(e.context,this.viewFrame),super.didRender(t)}hitTest(t,e,i){const n=this.hitMode.state;if("none"!==n){const s=i.renderer;if(s instanceof cs){let i;return i="domain"===n?this.hitTestDomain(t,e,s):this.hitTestPlot(t,e,s),i}}return null}hitTestChildren(t,e,i){return null}hitTestDomain(t,e,i){const n=this.xScale.value;if(null!==n){const e=n.inverse(t),i=this.dataPointRefs.previousValue(e),s=this.dataPointRefs.nextValue(e),o=void 0!==i?i.view.x.value:void 0,r=void 0!==s?s.view.x.value:void 0,l=void 0!==o?+e-+o:NaN,a=void 0!==r?+r-+e:NaN;if(l<=a)return i.view;if(l>a)return s.view;if(void 0!==i)return i.view;if(void 0!==s)return s.view}return null}mountFasteners(){super.mountFasteners(),this.mountDataPointRefs()}unmountFasteners(){this.unmountDataPointRefs(),super.unmountFasteners()}init(t){super.init(t),void 0!==t.xScale&&this.xScale(t.xScale),void 0!==t.yScale&&this.yScale(t.yScale);const e=t.data;if(void 0!==e)for(let t=0,i=e.length;t<i;t+=1)this.appendChild(Ar.fromAny(e[t]));void 0!==t.font&&this.font(t.font),void 0!==t.textColor&&this.textColor(t.textColor),void 0!==t.hitMode&&this.hitMode(t.hitMode)}}kr.DataPointRef=vn.define("DataPointRef",{observes:!0,willAttachView(t,e){this.owner.callObservers("viewWillAttachDataPoint",t,e,this.owner)},didAttachView(t){this.owner.updateXDataDomain(t),this.owner.updateYDataDomain(t);const e=t.label.view;null!==e&&this.attachDataPointLabelView(e)},willDetachView(t){const e=t.label.view;null!==e&&this.detachDataPointLabelView(e),this.owner.updateXDataDomain(t)},didDetachView(t){this.owner.callObservers("viewDidDetachDataPoint",t,this.owner)},viewDidSetDataPointX(t,e,i){this.owner.updateXDataDomain(i),this.owner.requireUpdate(fn.NeedsLayout)},viewDidSetDataPointY(t,e,i){this.owner.updateYDataDomain(i),this.owner.requireUpdate(fn.NeedsLayout)},viewDidSetDataPointY2(t,e,i){this.owner.updateYDataDomain(i),this.owner.requireUpdate(fn.NeedsLayout)},viewWillAttachDataPointLabel(t){this.attachDataPointLabelView(t)},viewDidDetachDataPointLabel(t){this.detachDataPointLabelView(t)},attachDataPointLabelView(t){this.owner.requireUpdate(fn.NeedsLayout)},detachDataPointLabelView(t){}}),u([Ht({type:E,state:null,inherits:!0})],kr.prototype,"font",void 0),u([Ht({type:z,state:null,inherits:!0})],kr.prototype,"textColor",void 0),u([i.Property({type:String,state:"domain"})],kr.prototype,"hitMode",void 0),u([i.Animator({extends:Vr,type:e.ContinuousScale,inherits:!0,state:null,updateFlags:fn.NeedsLayout,willSetValue(t,e){this.owner.callObservers("viewWillSetXScale",t,e,this.owner)},didSetValue(t,e){this.owner.updateXDataRange(),this.owner.callObservers("viewDidSetXScale",t,e,this.owner)}})],kr.prototype,"xScale",void 0),u([i.Animator({extends:Vr,type:e.ContinuousScale,inherits:!0,state:null,updateFlags:fn.NeedsLayout,willSetValue(t,e){this.owner.callObservers("viewWillSetYScale",t,e,this.owner)},didSetValue(t,e){this.owner.updateYDataRange(),this.owner.callObservers("viewDidSetYScale",t,e,this.owner)}})],kr.prototype,"yScale",void 0),u([i.Property({initState:()=>[0,0],willSetState(t,e){this.owner.callObservers("viewWillSetXRangePadding",t,e,this.owner)},didSetState(t,e){this.owner.callObservers("viewDidSetXRangePadding",t,e,this.owner)}})],kr.prototype,"xRangePadding",void 0),u([i.Property({initState:()=>[0,0],willSetState(t,e){this.owner.callObservers("viewWillSetYRangePadding",t,e,this.owner)},didSetState(t,e){this.owner.callObservers("viewDidSetYRangePadding",t,e,this.owner)}})],kr.prototype,"yRangePadding",void 0);class Or extends Lr{renderPlot(t,e){const i=Math.min(e.width,e.height),n=this.radius.getValueOr(s.Length.zero()),o=this.fill.value,r=this.stroke.value,l=this.strokeWidth.value,a=t.fillStyle,h=t.lineWidth,d=t.strokeStyle,c=this.dataPoints.views;for(const e in c){const s=c[e];t.beginPath();const a=s.radius.getValueOr(n).pxValue(i);t.arc(s.xCoord,s.yCoord,a,0,2*Math.PI);let h=s.color.getValueOr(o);if(null!==h){const e=s.opacity.value;void 0!==e&&(h=h.alpha(e)),t.fillStyle=h.toString(),t.fill()}null!==r&&(null!==l&&(t.lineWidth=l.pxValue(i)),t.strokeStyle=r.toString(),t.stroke())}t.fillStyle=a,t.lineWidth=h,t.strokeStyle=d}init(t){super.init(t),void 0!==t.radius&&this.radius(t.radius),void 0!==t.fill&&this.fill(t.fill),void 0!==t.stroke&&this.stroke(t.stroke),void 0!==t.strokeWidth&&this.strokeWidth(t.strokeWidth)}}u([Ht({type:s.Length,state:s.Length.px(5),updateFlags:fn.NeedsRender,willSetValue(t,e){this.owner.callObservers("viewWillSetPlotRadius",t,e,this.owner)},didSetValue(t,e){this.owner.callObservers("viewDidSetPlotRadius",t,e,this.owner)}})],Or.prototype,"radius",void 0),u([Ht({type:z,state:null,look:At.accentColor,updateFlags:fn.NeedsRender,willSetValue(t,e){this.owner.callObservers("viewWillSetPlotFill",t,e,this.owner)},didSetValue(t,e){this.owner.callObservers("viewDidSetPlotFill",t,e,this.owner)}})],Or.prototype,"fill",void 0),u([Ht({type:z,state:null,updateFlags:fn.NeedsRender})],Or.prototype,"stroke",void 0),u([Ht({type:s.Length,state:null,updateFlags:fn.NeedsRender})],Or.prototype,"strokeWidth",void 0);class Er extends kr{renderPlot(t,e){const i=Math.min(e.width,e.height),n=this.stroke.getValueOr(z.transparent()),o=this.strokeWidth.getValueOr(s.Length.zero()).pxValue(i),r=this.gradientStops;let l,a,h,d=null;const c=this.dataPointRefs;if(c.isEmpty())l=NaN,a=NaN,h=NaN;else{const e=c.firstValue().view,i=c.lastValue().view;l=e.xCoord,a=i.xCoord,h=a-l,0!==r&&(d=t.createLinearGradient(l,0,a,0))}t.beginPath();let u=0;c.forEach((function(e,i){const s=i.view,o=s.xCoord,r=s.yCoord;if(0===u?t.moveTo(o,r):t.lineTo(o,r),null!==d&&s.isGradientStop()){let t=s.color.getValueOr(n);const e=s.opacity.value;void 0!==e&&(t=t.alpha(e));const i=(o-l)/(h||1);d.addColorStop(i,t.toString())}u+=1}),this);const p=t.lineWidth,f=t.strokeStyle;t.lineWidth=o,t.strokeStyle=null!==d?d:n.toString(),t.stroke(),t.lineWidth=p,t.strokeStyle=f}hitTestPlot(t,e,i){const n=i.context;let s=this.hitWidth.state;const o=this.strokeWidth.value;if(null!==o){const t=this.viewFrame,e=Math.min(t.width,t.height);s=Math.max(s,o.pxValue(e))}n.beginPath();let r=0;this.dataPointRefs.forEach((function(t,e){const i=e.view,s=i.xCoord,o=i.yCoord;0===r?n.moveTo(s,o):n.lineTo(s,o),r+=1}),this);const l=n.lineWidth;n.lineWidth=s;const a=i.transform.transform(t,e),h=n.isPointInStroke(a.x,a.y);if(n.lineWidth=l,h){const n=this.hitMode.state;if("plot"===n)return this;if("data"===n)return this.hitTestDomain(t,e,i)}return null}init(t){super.init(t),void 0!==t.hitWidth&&this.hitWidth(t.hitWidth),void 0!==t.stroke&&this.stroke(t.stroke),void 0!==t.strokeWidth&&this.strokeWidth(t.strokeWidth)}}u([Ht({type:z,state:null,look:At.accentColor,updateFlags:fn.NeedsRender,willSetValue(t,e){this.owner.callObservers("viewWillSetPlotStroke",t,e,this.owner)},didSetValue(t,e){this.owner.callObservers("viewDidSetPlotStroke",t,e,this.owner)}})],Er.prototype,"stroke",void 0),u([Ht({type:s.Length,state:s.Length.px(1),updateFlags:fn.NeedsRender,willSetValue(t,e){this.owner.callObservers("viewWillSetPlotStrokeWidth",t,e,this.owner)},didSetValue(t,e){if(this.owner.xRangePadding.hasAffinity(i.Affinity.Intrinsic)||this.owner.yRangePadding.hasAffinity(i.Affinity.Intrinsic)){const t=this.owner.viewFrame,e=Math.min(t.width,t.height),n=this.getValueOr(s.Length.zero()).pxValue(e)/2;this.owner.xRangePadding.setState([n,n],i.Affinity.Intrinsic),this.owner.yRangePadding.setState([n,n],i.Affinity.Intrinsic)}this.owner.callObservers("viewDidSetPlotStrokeWidth",t,e,this.owner)}})],Er.prototype,"strokeWidth",void 0),u([i.Property({type:Number,state:5})],Er.prototype,"hitWidth",void 0);class Wr extends kr{renderPlot(t,e){const i=this.fill.getValueOr(z.transparent()),n=this.gradientStops;let s,o,r,l=null;t.beginPath();const a=this.dataPointRefs;if(a.isEmpty())s=NaN,o=NaN,r=NaN;else{const e=a.firstValue().view,h=a.lastValue().view;if(s=e.xCoord,o=h.xCoord,r=o-s,t.moveTo(e.xCoord,e.yCoord),0!==n&&(l=t.createLinearGradient(s,0,o,0),e.isGradientStop())){let t=e.color.getValueOr(i);const n=e.opacity.value;void 0!==n&&(t=t.alpha(n)),l.addColorStop(0,t.toString())}}const h=a.values();for(h.next();h.hasNext();){const e=h.next().value.view;if(t.lineTo(e.xCoord,e.yCoord),null!==l&&e.isGradientStop()){let t=e.color.value||i;const n=e.opacity.value;void 0!==n&&(t=t.alpha(n));const o=(e.xCoord-s)/(r||1);l.addColorStop(o,t.toString())}}for(;h.hasPrevious();){const e=h.previous().value.view;t.lineTo(e.xCoord,e.y2Coord)}a.isEmpty()||t.closePath();const d=t.fillStyle;t.fillStyle=null!==l?l:i.toString(),t.fill(),t.fillStyle=d}hitTestPlot(t,e,i){const n=i.context,s=this.dataPointRefs;n.beginPath();const o=s.values();if(o.hasNext()){const t=o.next().value.view;n.moveTo(t.xCoord,t.yCoord)}for(;o.hasNext();){const t=o.next().value.view;n.lineTo(t.xCoord,t.yCoord)}for(;o.hasPrevious();){const t=o.previous().value.view;n.lineTo(t.xCoord,t.y2Coord)}s.isEmpty()||n.closePath();const r=i.transform.transform(t,e);if(n.isPointInPath(r.x,r.y)){const n=this.hitMode.state;if("plot"===n)return this;if("data"===n)return this.hitTestDomain(t,e,i)}return null}init(t){super.init(t),void 0!==t.fill&&this.fill(t.fill)}}u([Ht({type:z,state:null,look:At.accentColor,updateFlags:fn.NeedsRender,willSetValue(t,e){this.owner.callObservers("viewWillSetPlotFill",t,e,this.owner)},didSetValue(t,e){this.owner.callObservers("viewDidSetPlotFill",t,e,this.owner)}})],Wr.prototype,"fill",void 0);class Nr extends A{detectDataSetTrait(t){return t instanceof Dr?t:null}detectTraits(t){if(null===this.dataSet.trait){const e=t.traits;for(let t=0,i=e.length;t<i;t+=1){const i=e[t],n=this.detectDataSetTrait(i);null!==n&&this.dataSet.setTrait(n)}}}onAttachModel(t){super.onAttachModel(t),this.detectTraits(t)}onInsertTrait(t,e){if(super.onInsertTrait(t,e),null===this.dataSet.trait){const i=this.detectDataSetTrait(t);null!==i&&this.dataSet.setTrait(i,e)}}onRemoveTrait(t){super.onRemoveTrait(t);const e=this.detectDataSetTrait(t);null!==e&&this.dataSet.trait===e&&this.dataSet.setTrait(null)}onStartConsuming(){super.onStartConsuming();const t=this.dataSet.trait;null!==t&&t.consume(this)}onStopConsuming(){super.onStopConsuming();const t=this.dataSet.trait;null!==t&&t.unconsume(this)}}u([D({type:Dr,willAttachTrait(t,e){this.owner.callObservers("traitWillAttachDataSet",t,this.owner)},didAttachTrait(t){this.owner.consuming&&t.consume(this.owner)},willDetachTrait(t){this.owner.consuming&&t.unconsume(this.owner)},didDetachTrait(t){this.owner.callObservers("traitDidDetachDataSet",t,this.owner)}})],Nr.prototype,"dataSet",void 0);class Br extends Nr{}class zr extends Nr{}class Ur extends Br{}u([i.Property({type:s.Length,state:null,willSetState(t,e){this.owner.callObservers("traitWillSetPlotRadius",t,e,this.owner)},didSetState(t,e){this.owner.callObservers("traitDidSetPlotRadius",t,e,this.owner)}})],Ur.prototype,"radius",void 0),u([i.Property({state:null,willSetState(t,e){this.owner.callObservers("traitWillSetPlotFill",t,e,this.owner)},didSetState(t,e){this.owner.callObservers("traitDidSetPlotFill",t,e,this.owner)},fromAny:t=>(null===t||t instanceof At||(t=z.fromAny(t)),t)})],Ur.prototype,"fill",void 0);class Hr extends zr{}u([i.Property({state:null,willSetState(t,e){this.owner.callObservers("traitWillSetPlotStroke",t,e,this.owner)},didSetState(t,e){this.owner.callObservers("traitDidSetPlotStroke",t,e,this.owner)},fromAny:t=>(null===t||t instanceof At||(t=z.fromAny(t)),t)})],Hr.prototype,"stroke",void 0),u([i.Property({type:s.Length,state:null,willSetState(t,e){this.owner.callObservers("traitWillSetPlotStrokeWidth",t,e,this.owner)},didSetState(t,e){this.owner.callObservers("traitDidSetPlotStrokeWidth",t,e,this.owner)}})],Hr.prototype,"strokeWidth",void 0);class qr extends zr{}u([i.Property({state:null,willSetState(t,e){this.owner.callObservers("traitWillSetPlotFill",t,e,this.owner)},didSetState(t,e){this.owner.callObservers("traitDidSetPlotFill",t,e,this.owner)},fromAny:t=>(null===t||t instanceof At||(t=z.fromAny(t)),t)})],qr.prototype,"fill",void 0);class Gr extends Pr{static fromTrait(t){if(t instanceof Ur)return new Xr;if(t instanceof Hr)return new Kr;if(t instanceof qr)return new Zr;throw new Error("Can't create PlotController from "+t)}}u([i.Property({type:e.Timing,inherits:!0})],Gr.prototype,"plotTiming",void 0);class jr extends Gr{}class Yr extends Gr{}class Xr extends jr{setPlotRadius(t,n){const s=this.plot.view;null!==s&&(void 0===n||!0===n?!0===(n=this.plotTiming.state)&&(n=s.getLook(At.timing,Et.ambient)):n=e.Timing.fromAny(n),s.radius.setState(t,n,i.Affinity.Intrinsic))}setPlotFill(t,n){const s=this.plot.view;null!==s&&(void 0===n||!0===n?!0===(n=this.plotTiming.state)&&(n=s.getLook(At.timing,Et.ambient)):n=e.Timing.fromAny(n),t instanceof At?s.fill.setLook(t,n,i.Affinity.Intrinsic):s.fill.setState(t,n,i.Affinity.Intrinsic))}}u([oo({extends:!0,get parentView(){return this.owner.plot.view}})],Xr.prototype,"dataPoints",void 0),u([eo({traitType:Ur,observesTrait:!0,initTrait(t){if(null===this.owner.dataSet.trait){const e=t.getTrait(Dr);null!==e&&this.owner.dataSet.setTrait(e)}null!==this.view&&(this.owner.setPlotRadius(t.radius.state),this.owner.setPlotFill(t.fill.state))},willAttachTrait(t){this.owner.callObservers("controllerWillAttachPlotTrait",t,this.owner)},didDetachTrait(t){this.owner.callObservers("controllerDidDetachPlotTrait",t,this.owner)},traitDidSetPlotRadius(t,e){this.owner.setPlotRadius(t)},traitDidSetPlotFill(t,e){this.owner.setPlotFill(t)},viewType:Or,observesView:!0,initView(t){const e=this.owner.dataPoints.controllers;for(const i in e){e[i].dataPoint.insertView(t)}const i=this.trait;null!==i&&(this.owner.setPlotRadius(i.radius.state),this.owner.setPlotFill(i.fill.state))},willAttachView(t){this.owner.callObservers("controllerWillAttachPlotView",t,this.owner)},didDetachView(t){this.owner.callObservers("controllerDidDetachPlotView",t,this.owner)},viewWillSetPlotRadius(t,e,i){this.owner.callObservers("controllerWillSetPlotRadius",t,e,this.owner)},viewDidSetPlotRadius(t,e,i){this.owner.callObservers("controllerDidSetPlotRadius",t,e,this.owner)},viewWillSetPlotFill(t,e,i){this.owner.callObservers("controllerWillSetPlotFill",t,e,this.owner)},viewDidSetPlotFill(t,e,i){this.owner.callObservers("controllerDidSetPlotFill",t,e,this.owner)}})],Xr.prototype,"plot",void 0);class Kr extends Yr{setPlotStroke(t,n){const s=this.plot.view;null!==s&&(void 0===n||!0===n?!0===(n=this.plotTiming.state)&&(n=s.getLook(At.timing,Et.ambient)):n=e.Timing.fromAny(n),t instanceof At?s.stroke.setLook(t,n,i.Affinity.Intrinsic):s.stroke.setState(t,n,i.Affinity.Intrinsic))}setPlotStrokeWidth(t,n){const s=this.plot.view;null!==s&&(void 0===n||!0===n?!0===(n=this.plotTiming.state)&&(n=s.getLook(At.timing,Et.ambient)):n=e.Timing.fromAny(n),s.strokeWidth.setState(t,n,i.Affinity.Intrinsic))}}u([oo({extends:!0,get parentView(){return this.owner.plot.view}})],Kr.prototype,"dataPoints",void 0),u([eo({traitType:Hr,observesTrait:!0,initTrait(t){if(null===this.owner.dataSet.trait){const e=t.getTrait(Dr);null!==e&&this.owner.dataSet.setTrait(e)}if(null!==this.view){const e=t.stroke.state;null!==e&&this.owner.setPlotStroke(e);const i=t.strokeWidth.state;null!==i&&this.owner.setPlotStrokeWidth(i)}},willAttachTrait(t){this.owner.callObservers("controllerWillAttachPlotTrait",t,this.owner)},didDetachTrait(t){this.owner.callObservers("controllerDidDetachPlotTrait",t,this.owner)},traitDidSetPlotStroke(t,e){this.owner.setPlotStroke(t)},traitDidSetPlotStrokeWidth(t,e){this.owner.setPlotStrokeWidth(t)},viewType:Er,observesView:!0,initView(t){const e=this.owner.dataPoints.controllers;for(const i in e){e[i].dataPoint.insertView(t)}const i=this.trait;if(null!==i){const t=i.stroke.state;null!==t&&this.owner.setPlotStroke(t);const e=i.strokeWidth.state;null!==e&&this.owner.setPlotStrokeWidth(e)}},willAttachView(t){this.owner.callObservers("controllerWillAttachPlotView",t,this.owner)},didDetachView(t){this.owner.callObservers("controllerDidDetachPlotView",t,this.owner)},viewWillSetPlotStroke(t,e,i){this.owner.callObservers("controllerWillSetPlotStroke",t,e,this.owner)},viewDidSetPlotStroke(t,e,i){this.owner.callObservers("controllerDidSetPlotStroke",t,e,this.owner)},viewWillSetPlotStrokeWidth(t,e,i){this.owner.callObservers("controllerWillSetPlotStrokeWidth",t,e,this.owner)},viewDidSetPlotStrokeWidth(t,e,i){this.owner.callObservers("controllerDidSetPlotStrokeWidth",t,e,this.owner)}})],Kr.prototype,"plot",void 0);class Zr extends Yr{setPlotFill(t,n){const s=this.plot.view;null!==s&&(void 0===n||!0===n?!0===(n=this.plotTiming.state)&&(n=s.getLook(At.timing,Et.ambient)):n=e.Timing.fromAny(n),t instanceof At?s.fill.setLook(t,n,i.Affinity.Intrinsic):s.fill.setState(t,n,i.Affinity.Intrinsic))}willSetPlotFill(t,e,i){const n=this.observers;for(let i=0,s=n.length;i<s;i+=1){const s=n[i];void 0!==s.controllerWillSetPlotFill&&s.controllerWillSetPlotFill(t,e,this)}}onSetPlotFill(t,e,i){}didSetPlotFill(t,e,i){const n=this.observers;for(let i=0,s=n.length;i<s;i+=1){const s=n[i];void 0!==s.controllerDidSetPlotFill&&s.controllerDidSetPlotFill(t,e,this)}}}u([oo({extends:!0,get parentView(){return this.owner.plot.view}})],Zr.prototype,"dataPoints",void 0),u([eo({traitType:qr,observesTrait:!0,initTrait(t){if(null===this.owner.dataSet.trait){const e=t.getTrait(Dr);null!==e&&this.owner.dataSet.setTrait(e)}if(null!==this.view){const e=t.fill.state;null!==e&&this.owner.setPlotFill(e)}},willAttachTrait(t){this.owner.callObservers("controllerWillAttachPlotTrait",t,this.owner)},didDetachTrait(t){this.owner.callObservers("controllerDidDetachPlotTrait",t,this.owner)},traitDidSetPlotFill(t,e){this.owner.setPlotFill(t)},viewType:Wr,observesView:!0,initView(t){const e=this.owner.dataPoints.controllers;for(const i in e){e[i].dataPoint.insertView(t)}const i=this.trait;if(null!==i){const t=i.fill.state;null!==t&&this.owner.setPlotFill(t)}},willAttachView(t){this.owner.callObservers("controllerWillAttachPlotView",t,this.owner)},didDetachView(t){this.owner.callObservers("controllerDidDetachPlotView",t,this.owner)},viewWillSetPlotFill(t,e,i){this.owner.willSetPlotFill(t,e,i)},viewDidSetPlotFill(t,e,i){this.owner.onSetPlotFill(t,e,i),this.owner.didSetPlotFill(t,e,i)}})],Zr.prototype,"plot",void 0);class _r extends Fr{addPlot(t,e){t=fn.fromAny(t),this.appendChild(t)}willRender(t){super.willRender(t);const e=t.renderer;if(e instanceof cs){const t=e.context;t.save(),this.clipGraph(t,this.viewFrame)}}didRender(t){const e=t.renderer;if(e instanceof cs){e.context.restore()}super.didRender(t)}clipGraph(t,e){t.beginPath(),t.rect(e.x,e.y,e.width,e.height),t.clip()}hitTest(t,e,i){return this}init(t){super.init(t);const e=t.plots;if(void 0!==e)for(let t=0,i=e.length;t<i;t+=1)this.addPlot(e[t]);void 0!==t.font&&this.font(t.font),void 0!==t.textColor&&this.textColor(t.textColor)}}u([Ht({type:E,inherits:!0,state:null})],_r.prototype,"font",void 0),u([Ht({type:z,inherits:!0,state:null})],_r.prototype,"textColor",void 0);class Qr extends A{startConsumingPlots(){const t=this.plots.traits;for(const e in t){t[e].consume(this)}}stopConsumingPlots(){const t=this.plots.traits;for(const e in t){t[e].unconsume(this)}}onStartConsuming(){super.onStartConsuming(),this.startConsumingPlots()}onStopConsuming(){super.onStopConsuming(),this.stopConsumingPlots()}}u([T({type:Nr,binds:!0,willAttachTrait(t){this.owner.callObservers("traitWillAttachPlot",t,this.owner)},didAttachTrait(t){this.owner.consuming&&t.consume(this.owner)},willDetachTrait(t){this.owner.consuming&&t.unconsume(this.owner)},didDetachTrait(t){this.owner.callObservers("traitDidDetachPlot",t,this.owner)},detectModel:t=>t.getTrait(Nr)})],Qr.prototype,"plots",void 0);class Jr extends Qs{}u([eo({traitType:Qr,observesTrait:!0,willAttachTrait(t){this.owner.callObservers("controllerWillAttachGraphTrait",t,this.owner)},didAttachTrait(t){const e=t.plots.traits;for(const t in e){const i=e[t];this.owner.plots.addTraitController(i)}},willDetachTrait(t){const e=t.plots.traits;for(const t in e){const i=e[t];this.owner.plots.deleteTraitController(i)}},didDetachTrait(t){this.owner.callObservers("controllerDidDetachGraphTrait",t,this.owner)},traitWillAttachPlot(t,e){this.owner.plots.addTraitController(t,e)},traitDidDetachPlot(t){this.owner.plots.deleteTraitController(t)},viewType:_r,initView(t){const e=this.owner.plots.controllers;for(const i in e){const n=e[i],s=n.plot.view;null!==s&&null===s.parent&&n.plot.insertView(t)}},willAttachView(t){this.owner.callObservers("controllerWillAttachGraphView",t,this.owner)},didDetachView(t){this.owner.callObservers("controllerDidDetachGraphView",t,this.owner)}})],Jr.prototype,"graph",void 0),u([oo({type:Gr,binds:!0,observes:!0,get parentView(){return this.owner.graph.view},getTraitViewRef:t=>t.plot,willAttachController(t){this.owner.callObservers("controllerWillAttachPlot",t,this.owner)},didAttachController(t){const e=t.plot.trait;null!==e&&this.attachPlotTrait(e,t);const i=t.plot.view;null!==i&&this.attachPlotView(i,t);const n=t.dataSet.trait;null!==n&&this.attachDataSetTrait(n,t)},willDetachController(t){const e=t.dataSet.trait;null!==e&&this.detachDataSetTrait(e,t);const i=t.plot.view;null!==i&&this.detachPlotView(i,t);const n=t.plot.trait;null!==n&&this.detachPlotTrait(n,t)},didDetachController(t){this.owner.callObservers("controllerDidDetachPlot",t,this.owner)},controllerWillAttachPlotTrait(t,e){this.owner.callObservers("controllerWillAttachPlotTrait",t,e,this.owner),this.attachPlotTrait(t,e)},controllerDidDetachPlotTrait(t,e){this.detachPlotTrait(t,e),this.owner.callObservers("controllerDidDetachPlotTrait",t,e,this.owner)},attachPlotTrait(t,e){},detachPlotTrait(t,e){},controllerWillAttachPlotView(t,e){this.owner.callObservers("controllerWillAttachPlotView",t,e,this.owner),this.attachPlotView(t,e)},controllerDidDetachPlotView(t,e){this.detachPlotView(t,e),this.owner.callObservers("controllerDidDetachPlotView",t,e,this.owner)},attachPlotView(t,e){},detachPlotView(t,e){t.remove()},controllerWillAttachDataSetTrait(t,e){this.owner.callObservers("controllerWillAttachDataSetTrait",t,e,this.owner),this.attachDataSetTrait(t,e)},controllerDidDetachDataSetTrait(t,e){this.detachDataSetTrait(t,e),this.owner.callObservers("controllerDidDetachDataSetTrait",t,e,this.owner)},attachDataSetTrait(t,e){},detachDataSetTrait(t,e){},controllerWillAttachDataPoint(t,e){this.owner.callObservers("controllerWillAttachDataPoint",t,e,this.owner),this.attachDataPoint(t,e)},controllerDidDetachDataPoint(t,e){this.detachDataPoint(t,e),this.owner.callObservers("controllerDidDetachDataPoint",t,e,this.owner)},attachDataPoint(t,e){const i=t.dataPoint.trait;null!==i&&this.attachDataPointTrait(i,t,e);const n=t.dataPoint.view;null!==n&&this.attachDataPointView(n,t,e)},detachDataPoint(t,e){const i=t.dataPoint.trait;null!==i&&this.detachDataPointTrait(i,t,e);const n=t.dataPoint.view;null!==n&&this.detachDataPointView(n,t,e)},controllerWillAttachDataPointTrait(t,e,i){this.owner.callObservers("controllerWillAttachDataPointTrait",t,e,i,this.owner),this.attachDataPointTrait(t,e,i)},controllerDidDetachDataPointTrait(t,e,i){this.detachDataPointTrait(t,e,i),this.owner.callObservers("controllerDidDetachDataPointTrait",t,e,i,this.owner)},attachDataPointTrait(t,e,i){},detachDataPointTrait(t,e,i){},controllerWillAttachDataPointView(t,e,i){this.owner.callObservers("controllerWillAttachDataPointView",t,e,i,this.owner),this.attachDataPointView(t,e,i)},controllerDidDetachDataPointView(t,e,i){this.detachDataPointView(t,e,i),this.owner.callObservers("controllerDidDetachDataPointView",t,e,i,this.owner)},attachDataPointView(t,e,i){const n=t.label.view;null!==n&&this.attachDataPointLabelView(n,e,i)},detachDataPointView(t,e,i){const n=t.label.view;null!==n&&this.detachDataPointLabelView(n,e,i)},controllerWillAttachDataPointLabelView(t,e,i){this.owner.callObservers("controllerWillAttachDataPointLabelView",t,e,i,this.owner),this.attachDataPointLabelView(t,e,i)},controllerDidDetachDataPointLabelView(t,e,i){this.detachDataPointLabelView(t,e,i),this.owner.callObservers("controllerDidDetachDataPointLabelView",t,e,i,this.owner)},attachDataPointLabelView(t,e,i){},detachDataPointLabelView(t,e,i){},createController(t){return void 0!==t?Gr.fromTrait(t):oo.prototype.createController.call(this)}})],Jr.prototype,"plots",void 0);const $r=Math.sqrt(50),tl=Math.sqrt(10),el=Math.sqrt(2),il=1e3,nl=6e4,sl=36e5,ol=24*sl,rl=30*ol,ll=365*ol,al=(new d.BTree).set(il,l.TimeInterval.second).set(5e3,l.TimeInterval.second.every(5)).set(15e3,l.TimeInterval.second.every(15)).set(3e4,l.TimeInterval.second.every(30)).set(nl,l.TimeInterval.minute).set(3e5,l.TimeInterval.minute.every(5)).set(9e5,l.TimeInterval.minute.every(15)).set(18e5,l.TimeInterval.minute.every(30)).set(sl,l.TimeInterval.hour).set(3*sl,l.TimeInterval.hour.every(3)).set(6*sl,l.TimeInterval.hour.every(6)).set(12*sl,l.TimeInterval.hour.every(12)).set(ol,l.TimeInterval.day).set(2*ol,l.TimeInterval.day.every(2)).set(6048e5,l.TimeInterval.week).set(rl,l.TimeInterval.month).set(3*rl,l.TimeInterval.month.every(3)).set(ll,l.TimeInterval.year),hl=l.DateTimeFormat.pattern(".%L"),dl=l.DateTimeFormat.pattern(":%S"),cl=l.DateTimeFormat.pattern("%I:%M"),ul=l.DateTimeFormat.pattern("%I %p"),pl=l.DateTimeFormat.pattern("%a %d"),fl=l.DateTimeFormat.pattern("%b %d"),gl=l.DateTimeFormat.pattern("%B"),vl=l.DateTimeFormat.pattern("%Y");class yl{format(t){return""+t}static fromScale(t,i){if(void 0===i&&(i=10),t instanceof l.TimeScale){const e=t.domain;return new ml(e[0],e[1],i)}if(t instanceof e.LinearScale){const e=t.domain;return new wl(e[0],e[1],i)}throw new TypeError(""+t)}static step(t,e){const i=Math.abs(t)/e;let n=Math.pow(10,Math.floor(Math.log(i)/Math.LN10));const s=i/n;return s>=$r?n*=10:s>=tl?n*=5:s>=el&&(n*=2),t<0?-n:n}}class wl extends yl{constructor(t,e,i){super(),this.x0=t,this.dx=e-this.x0,this.n=Math.max(0,i)}count(t){return void 0===t?this.n:(this.n=Math.max(0,t),this)}domain(t,i){return void 0===t?e.LinearDomain(this.x0,this.x0+this.dx):void 0===i?(this.x0=t[0],this.dx=t[1]-this.x0,this):(this.x0=t,this.dx=i-this.x0,this)}generate(){let t,e;this.dx<0?(e=this.x0,t=e+this.dx):(t=this.x0,e=t+this.dx);const i=wl.interval(e-t,this.n);if(0===i||!isFinite(i))return[];let n;if(i>0){t=Math.ceil(t/i),e=Math.floor(e/i);const s=Math.ceil(e-t+1);n=new Array(s);for(let e=0;e<s;e+=1)n[e]=(t+e)*i}else{t=Math.floor(t*i),e=Math.ceil(e*i);const s=Math.ceil(t-e+1);n=new Array(s);for(let e=0;e<s;e+=1)n[e]=(t-e)/i}return this.dx<0&&n.reverse(),n}static interval(t,e=10){const i=t/e,n=Math.floor(Math.log(i)/Math.LN10),s=Math.pow(10,n),o=i/s,r=o>=$r?10:o>=tl?5:o>=el?2:1;return n>=0?s*r:-Math.pow(10,-n)/r}}class ml extends yl{constructor(t,e,i,n){super();const s=l.DateTime.fromAny(t),o=l.DateTime.fromAny(e);this.t0=s.time,this.dt=o.time-this.t0,this.zone=void 0!==n?n:s.zone,this.n=Math.max(0,i)}count(t){return void 0===t?this.n:(this.n=Math.max(0,t),this)}domain(t,e){return void 0===t?l.TimeDomain(new l.DateTime(this.t0,this.zone),new l.DateTime(this.t0+this.dt,this.zone)):(void 0===e?(e=t[1],t=t[0]):t=t,t=l.DateTime.fromAny(t),e=l.DateTime.fromAny(e),this.t0=t.time,this.dt=e.time-this.t0,this)}generate(t){let e,i;this.dt<0?(i=this.t0,e=i+this.dt):(e=this.t0,i=e+this.dt),void 0===t&&(t=this.n);const n=(t=ml.interval(i-e,t)).range(new l.DateTime(e,this.zone),new l.DateTime(i+1,this.zone));return this.dt<0&&n.reverse(),n}format(t){return l.TimeInterval.second.floor(t)<t?hl.format(t):l.TimeInterval.minute.floor(t)<t?dl.format(t):l.TimeInterval.hour.floor(t)<t?cl.format(t):l.TimeInterval.day.floor(t)<t?ul.format(t):l.TimeInterval.month.floor(t)<t?l.TimeInterval.week.floor(t)<t?pl.format(t):fl.format(t):l.TimeInterval.year.floor(t)<t?gl.format(t):vl.format(t)}static interval(t,e=10){if("number"==typeof e){const i=Math.abs(t)/e,n=al.nextKey(i);if(void 0===n){const i=yl.step(t/ll,e);e=l.TimeInterval.year.every(i)}else if(n>il)e=i/al.previousKey(i)<n/i?al.previousValue(i):al.nextValue(i);else{const i=Math.max(1,yl.step(t,e));e=l.TimeInterval.millisecond.every(i)}}return e}}var bl;t.TickState=void 0,(bl=t.TickState||(t.TickState={}))[bl.Excluded=0]="Excluded",bl[bl.Entering=1]="Entering",bl[bl.Included=2]="Included",bl[bl.Leaving=3]="Leaving";class Cl extends ss{constructor(t){super(),this.value=t,this.offset=0,this.tickState=0,this.preserved=!0}setOffset(t){this.offset=t}preserve(t){return void 0===t?this.preserved:(this.preserved=t,this)}fadeIn(t){0!==this.tickState&&3!==this.tickState||(this.opacity.setState(1,t),this.tickState=1)}fadeOut(t){1!==this.tickState&&2!==this.tickState||(this.opacity.setState(0,t),this.tickState=3)}onLayout(t){super.onLayout(t);const e=this.label.view;null!==e&&this.layoutLabel(e)}willRender(t){super.willRender(t);const e=t.renderer;if(e instanceof cs){const t=e.context;Cl.globalAlpha=t.globalAlpha,t.globalAlpha=this.opacity.getValue()}}onRender(t){const e=t.renderer;e instanceof as&&!this.isHidden()&&!this.culled&&this.renderTick(e.context,this.viewFrame)}didRender(t){const e=t.renderer;if(e instanceof cs){e.context.globalAlpha=Cl.globalAlpha,Cl.globalAlpha=NaN}super.didRender(t)}init(t){super.init(t),void 0!==t.tickMarkColor&&this.tickMarkColor(t.tickMarkColor),void 0!==t.tickMarkWidth&&this.tickMarkWidth(t.tickMarkWidth),void 0!==t.tickMarkLength&&this.tickMarkLength(t.tickMarkLength),void 0!==t.tickLabelPadding&&this.tickLabelPadding(t.tickLabelPadding),void 0!==t.gridLineColor&&this.gridLineColor(t.gridLineColor),void 0!==t.gridLineWidth&&this.gridLineWidth(t.gridLineWidth),void 0!==t.font&&this.font(t.font),void 0!==t.textColor&&this.textColor(t.textColor),void 0!==t.label&&this.label(t.label)}static top(t){return new Sl(t)}static right(t){return new Al(t)}static bottom(t){return new xl(t)}static left(t){return new Dl(t)}static from(t,e){if("top"===e)return this.top(t);if("right"===e)return this.right(t);if("bottom"===e)return this.bottom(t);if("left"===e)return this.left(t);throw new TypeError(e)}static fromInit(t,e){if(void 0!==t.orientation&&(e=t.orientation),void 0===e)throw new TypeError;const i=this.from(t.value,e);return i.init(t),i}static fromAny(t,e){if(null==t)return t;if(t instanceof fn){if(t instanceof this)return t;throw new TypeError(t+" not an instance of "+this)}return this.fromInit(t,e)}}Cl.globalAlpha=NaN,u([i.Animator({type:s.R2Point,state:s.R2Point.origin(),updateFlags:fn.NeedsRender})],Cl.prototype,"anchor",void 0),u([Ht({type:Number,state:1,updateFlags:fn.NeedsRender})],Cl.prototype,"opacity",void 0),u([Ht({type:z,inherits:!0,state:null,updateFlags:fn.NeedsRender})],Cl.prototype,"tickMarkColor",void 0),u([Ht({type:Number,inherits:!0,state:1,updateFlags:fn.NeedsRender})],Cl.prototype,"tickMarkWidth",void 0),u([Ht({type:Number,inherits:!0,state:6,updateFlags:fn.NeedsRender})],Cl.prototype,"tickMarkLength",void 0),u([Ht({type:Number,inherits:!0,state:2,updateFlags:fn.NeedsRender})],Cl.prototype,"tickLabelPadding",void 0),u([Ht({type:z,inherits:!0,state:null,updateFlags:fn.NeedsRender})],Cl.prototype,"gridLineColor",void 0),u([Ht({type:Number,inherits:!0,state:0,updateFlags:fn.NeedsRender})],Cl.prototype,"gridLineWidth",void 0),u([Ht({type:E,inherits:!0,state:null})],Cl.prototype,"font",void 0),u([Ht({type:z,inherits:!0,state:null})],Cl.prototype,"textColor",void 0),u([vn({key:!0,type:As,binds:!0,willAttachView(t){this.owner.callObservers("viewWillAttachTickLabel",t,this.owner)},didDetachView(t){this.owner.callObservers("viewDidDetachTickLabel",t,this.owner)},fromAny(t){return"string"==typeof t?this.view instanceof As?(this.view.text(t),this.view):As.fromAny(t):ns.fromAny(t)}})],Cl.prototype,"label",void 0);class Sl extends Cl{constructor(t){super(t)}get orientation(){return"top"}layoutLabel(t){const e=this.anchor.getValue(),n=Math.round(e.x),o=Math.round(e.y)-this.tickMarkLength.getValue()-this.tickLabelPadding.getValue();Cs.is(t)&&(t.textAlign.setState("center",i.Affinity.Intrinsic),t.textBaseline.setState("bottom",i.Affinity.Intrinsic),t.textOrigin.setState(new s.R2Point(n,o),i.Affinity.Intrinsic))}renderTick(t,e){const i=this.anchor.getValue(),n=Math.round(i.x),s=Math.round(i.y),o=this.tickMarkLength.getValue(),r=s-o,l=t.lineWidth,a=t.strokeStyle,h=this.tickMarkColor.value,d=this.tickMarkWidth.getValue();null!==h&&0!==d&&0!==o&&(t.beginPath(),t.lineWidth=d,t.strokeStyle=h.toString(),t.moveTo(n,s),t.lineTo(n,r),t.stroke());const c=this.gridLineColor.value,u=this.gridLineWidth.getValue();null!==c&&0!==u&&e.xMin<n&&n<e.xMax&&(t.beginPath(),t.lineWidth=u,t.strokeStyle=c.toString(),t.moveTo(n,s),t.lineTo(n,e.yMax),t.stroke()),t.lineWidth=l,t.strokeStyle=a}}class Al extends Cl{constructor(t){super(t)}get orientation(){return"right"}layoutLabel(t){const e=this.anchor.getValue(),n=Math.round(e.x),o=Math.round(e.y),r=n+this.tickMarkLength.getValue()+this.tickLabelPadding.getValue();Cs.is(t)&&(t.textAlign.setState("left",i.Affinity.Intrinsic),t.textBaseline.setState("middle",i.Affinity.Intrinsic),t.textOrigin.setState(new s.R2Point(r,o),i.Affinity.Intrinsic))}renderTick(t,e){const i=this.anchor.getValue(),n=Math.round(i.x),s=Math.round(i.y),o=this.tickMarkLength.getValue(),r=n+o,l=t.lineWidth,a=t.strokeStyle,h=this.tickMarkColor.value,d=this.tickMarkWidth.getValue();null!==h&&0!==d&&0!==o&&(t.beginPath(),t.lineWidth=d,t.strokeStyle=h.toString(),t.moveTo(n,s),t.lineTo(r,s),t.stroke());const c=this.gridLineColor.value,u=this.gridLineWidth.getValue();null!==c&&0!==u&&e.yMin<s&&s<e.yMax&&(t.beginPath(),t.lineWidth=u,t.strokeStyle=c.toString(),t.moveTo(n,s),t.lineTo(e.xMin,s),t.stroke()),t.lineWidth=l,t.strokeStyle=a}}class xl extends Cl{constructor(t){super(t)}get orientation(){return"bottom"}layoutLabel(t){const e=this.anchor.getValue(),n=Math.round(e.x),o=Math.round(e.y)+this.tickMarkLength.getValue()+this.tickLabelPadding.getValue();Cs.is(t)&&(t.textAlign.setState("center",i.Affinity.Intrinsic),t.textBaseline.setState("top",i.Affinity.Intrinsic),t.textOrigin.setState(new s.R2Point(n,o),i.Affinity.Intrinsic))}renderTick(t,e){const i=this.anchor.getValue(),n=Math.round(i.x),s=Math.round(i.y),o=this.tickMarkLength.getValue(),r=s+o,l=t.lineWidth,a=t.strokeStyle,h=this.tickMarkColor.value,d=this.tickMarkWidth.getValue();null!==h&&0!==d&&0!==o&&(t.beginPath(),t.lineWidth=d,t.strokeStyle=h.toString(),t.moveTo(n,s),t.lineTo(n,r),t.stroke());const c=this.gridLineColor.value,u=this.gridLineWidth.getValue();null!==c&&0!==u&&e.xMin<n&&n<e.xMax&&(t.beginPath(),t.lineWidth=u,t.strokeStyle=c.toString(),t.moveTo(n,s),t.lineTo(n,e.yMin),t.stroke()),t.lineWidth=l,t.strokeStyle=a}}class Dl extends Cl{constructor(t){super(t)}get orientation(){return"left"}layoutLabel(t){const e=this.anchor.getValue(),n=Math.round(e.x),o=Math.round(e.y),r=n-this.tickMarkLength.getValue()-this.tickLabelPadding.getValue();Cs.is(t)&&(t.textAlign.setState("right",i.Affinity.Intrinsic),t.textBaseline.setState("middle",i.Affinity.Intrinsic),t.textOrigin.setState(new s.R2Point(r,o),i.Affinity.Intrinsic))}renderTick(t,e){const i=this.anchor.getValue(),n=Math.round(i.x),s=Math.round(i.y),o=this.tickMarkLength.getValue(),r=n-o,l=t.lineWidth,a=t.strokeStyle,h=this.tickMarkColor.value,d=this.tickMarkWidth.getValue();null!==h&&0!==d&&0!==o&&(t.beginPath(),t.strokeStyle=h.toString(),t.lineWidth=d,t.moveTo(n,s),t.lineTo(r,s),t.stroke());const c=this.gridLineColor.value,u=this.gridLineWidth.getValue();null!==c&&0!==u&&e.yMin<s&&s<e.yMax&&(t.beginPath(),t.lineWidth=u,t.strokeStyle=c.toString(),t.moveTo(n,s),t.lineTo(e.xMax,s),t.stroke()),t.lineWidth=l,t.strokeStyle=a}}class Tl extends ns{constructor(){super(),this.ticks=new d.BTree}getTick(t){const e=this.ticks.get(t);return void 0!==e?e:null}insertTick(t){return(t=Cl.fromAny(t,this.orientation)).remove(),this.willInsertChild(t,null),this.ticks.set(t.value,t),t.attachParent(this),this.onInsertChild(t,null),this.didInsertChild(t,null),t.cascadeInsert(),t}removeTick(t){const e=this.ticks.get(t);if(void 0!==e){if(e.parent!==this)throw new Error("not a child view");return this.willRemoveChild(e),e.detachParent(this),this.ticks.delete(t),this.onRemoveChild(e),this.didRemoveChild(e),e.setKey(void 0),e}return null}get childCount(){return this.ticks.size}get children(){const t=[];return this.ticks.forEachValue((function(e){t.push(e)}),this),t}firstChild(){const t=this.ticks.firstValue();return void 0!==t?t:null}lastChild(){const t=this.ticks.lastValue();return void 0!==t?t:null}nextChild(t){if(t instanceof Cl){const e=this.ticks.nextValue(t.value);if(void 0!==e)return e}return null}previousChild(t){if(t instanceof Cl){const e=this.ticks.previousValue(t.value);if(void 0!==e)return e}return null}forEachChild(t,e){return this.ticks.forEachValue(t,e)}getChild(t,e){return null}setChild(t,e){throw new Error("unsupported")}appendChild(t,e){if(void 0!==e)throw new Error("unsupported");if(!((t=fn.fromAny(t))instanceof Cl))throw new TypeError(""+t);return this.insertTick(t)}prependChild(t,e){if(void 0!==e)throw new Error("unsupported");if(!((t=fn.fromAny(t))instanceof Cl))throw new TypeError(""+t);return this.insertTick(t)}insertChild(t,e,i){if(void 0!==i)throw new Error("unsupported");if(!((t=fn.fromAny(t))instanceof Cl))throw new TypeError(""+t);return this.insertTick(t)}replaceChild(t,e){if(!(e instanceof Cl))throw new TypeError(""+e);if(e.parent!==this)throw new TypeError(""+e);if(!((t=fn.fromAny(t))instanceof Cl))throw new TypeError(""+t);return t!==e&&(this.removeTick(e.value),this.insertTick(t)),e}removeChild(t){if("string"==typeof t)throw new Error("unsupported");if(!(t instanceof Cl))throw new TypeError(""+t);return this.removeTick(t.value),t}removeChildren(){this.ticks.forEach((function(t,e){this.willRemoveChild(e),e.detachParent(this),this.ticks.delete(t),this.onRemoveChild(e),this.didRemoveChild(e),e.setKey(void 0)}),this)}updateTicks(){const t=this.scale.value;let e=this.tickGenerator.state;if(null!==t&&null!==e){let i=this.tickTransition.state;!0===e&&(e=yl.fromScale(t),this.tickGenerator.setState(e),i=!1),this.generateTicks(e,t,i)}}generateTicks(t,e,i){const n=this.tickMarkSpacing.getValue();if(0!==n){const i=e.range,s=Math.abs(i[1]-i[0]),o=Math.max(1,Math.floor(s/n));t.count(o)}t.domain(e.domain);const s=this.ticks.clone(),o=t.generate();for(let t=0,e=o.length;t<e;t+=1){const e=o[t],n=s.get(e);if(void 0!==n)s.delete(e),n.fadeIn(i);else{const t=this.createTickView(e);null!==t&&(this.insertTick(t),t.opacity.setInterpolatedValue(0,0),t.fadeIn(i))}}s.forEachValue((function(t){t.preserved||t.fadeOut(i)}),this)}createTickView(t){const e=Cl.from(t,this.orientation);if(null!==e){const i=this.createTickLabel(t,e);null!==i&&(e.label(i),e.preserve(!1))}return e}createTickLabel(t,e){let i=null;const n=this.observers;for(let s=0,o=n.length;s<o&&null==i;s+=1){const o=n[s];void 0!==o.createTickLabel&&(i=o.createTickLabel(t,e,this))}if(null==i){const e=this.tickGenerator.state;i=e instanceof yl?e.format(t):""+t}return"string"==typeof i&&(i=this.formatTickLabel(i,e)),i}formatTickLabel(t,e){const i=this.observers;for(let n=0,s=i.length;n<s;n+=1){const s=i[n];if(void 0!==s.formatTickLabel){const i=s.formatTickLabel(t,e,this);if(void 0!==i)return i}}return t}needsDisplay(t,e){return 0==(this.flags&fn.NeedsLayout)&&(t&=~fn.NeedsLayout),t}onLayout(t){super.onLayout(t),this.scale.recohere(t.updateTime),this.updateTicks()}displayChild(t,e,i){if(0!=(e&fn.NeedsLayout)&&t instanceof Cl){const e=this.scale.value;null!==e&&this.layoutTick(t,this.origin.getValue(),this.viewFrame,e)}super.displayChild(t,e,i)}didRender(t){const e=t.renderer;e instanceof as&&this.renderDomain(e.context,this.origin.getValue(),this.viewFrame),super.didRender(t)}init(t){super.init(t),void 0!==t.scale&&this.scale(t.scale);const e=t.ticks;if(void 0!==e)for(let t=0,i=e.length;t<i;t+=1)this.insertTick(e[t]);void 0!==t.tickGenerator&&this.tickGenerator(t.tickGenerator),void 0!==t.borderColor&&this.borderColor(t.borderColor),void 0!==t.borderWidth&&this.borderWidth(t.borderWidth),void 0!==t.borderSerif&&this.borderSerif(t.borderSerif),void 0!==t.tickMarkSpacing&&this.tickMarkSpacing(t.tickMarkSpacing),void 0!==t.tickMarkColor&&this.tickMarkColor(t.tickMarkColor),void 0!==t.tickMarkWidth&&this.tickMarkWidth(t.tickMarkWidth),void 0!==t.tickMarkLength&&this.tickMarkLength(t.tickMarkLength),void 0!==t.tickLabelPadding&&this.tickLabelPadding(t.tickLabelPadding),void 0!==t.tickTransition&&this.tickTransition(t.tickTransition),void 0!==t.gridLineColor&&this.gridLineColor(t.gridLineColor),void 0!==t.gridLineWidth&&this.gridLineWidth(t.gridLineWidth),void 0!==t.font&&this.font(t.font),void 0!==t.textColor&&this.textColor(t.textColor)}}u([i.Property({type:yl,state:!0})],Tl.prototype,"tickGenerator",void 0),u([Ht({type:s.R2Point,state:s.R2Point.origin(),updateFlags:fn.NeedsLayout|fn.NeedsRender})],Tl.prototype,"origin",void 0),u([Ht({type:z,inherits:!0,state:null,updateFlags:fn.NeedsRender})],Tl.prototype,"borderColor",void 0),u([Ht({type:Number,inherits:!0,state:1,updateFlags:fn.NeedsRender})],Tl.prototype,"borderWidth",void 0),u([Ht({type:Number,inherits:!0,state:6,updateFlags:fn.NeedsRender})],Tl.prototype,"borderSerif",void 0),u([Ht({type:Number,state:80,updateFlags:fn.NeedsRender})],Tl.prototype,"tickMarkSpacing",void 0),u([Ht({type:z,inherits:!0,state:null,updateFlags:fn.NeedsRender})],Tl.prototype,"tickMarkColor",void 0),u([Ht({type:Number,inherits:!0,state:1,updateFlags:fn.NeedsRender})],Tl.prototype,"tickMarkWidth",void 0),u([Ht({type:Number,inherits:!0,state:6,updateFlags:fn.NeedsRender})],Tl.prototype,"tickMarkLength",void 0),u([Ht({type:Number,inherits:!0,state:2,updateFlags:fn.NeedsRender})],Tl.prototype,"tickLabelPadding",void 0),u([i.Property({type:e.Timing,inherits:!0,initState:()=>e.Easing.cubicOut.withDuration(250)})],Tl.prototype,"tickTransition",void 0),u([Ht({type:z,inherits:!0,state:null,updateFlags:fn.NeedsRender})],Tl.prototype,"gridLineColor",void 0),u([Ht({type:Number,inherits:!0,state:0,updateFlags:fn.NeedsRender})],Tl.prototype,"gridLineWidth",void 0),u([Ht({type:E,inherits:!0,state:null,updateFlags:fn.NeedsRender})],Tl.prototype,"font",void 0),u([Ht({type:z,inherits:!0,state:null,updateFlags:fn.NeedsRender})],Tl.prototype,"textColor",void 0);class Pl extends Tl{get orientation(){return"top"}layoutTick(t,e,n,o){if(t.anchor.hasAffinity(i.Affinity.Intrinsic)){const r=o(t.value);t.setOffset(r),t.anchor.setState(new s.R2Point(n.xMin+r,e.y),i.Affinity.Intrinsic)}}renderDomain(t,e,i){const n=this.borderColor.value,s=this.borderWidth.getValue();if(null!==n&&0!==s){const o=i.xMin,r=i.xMax,l=e.y,a=this.borderSerif.getValue(),h=t.lineWidth,d=t.strokeStyle;t.beginPath(),t.lineWidth=s,t.strokeStyle=n.toString(),0!==a?(t.moveTo(o,l-a),t.lineTo(o,l),t.lineTo(r,l),t.lineTo(r,l-a)):(t.moveTo(o,l),t.lineTo(r,l)),t.stroke(),t.lineWidth=h,t.strokeStyle=d}}}u([i.Animator({extends:Vr,type:e.ContinuousScale,inherits:"xScale",state:null,updateFlags:fn.NeedsLayout})],Pl.prototype,"scale",void 0);class Vl extends Tl{get orientation(){return"right"}layoutTick(t,e,n,o){if(t.anchor.hasAffinity(i.Affinity.Intrinsic)){const r=o(t.value);t.setOffset(r),t.anchor.setState(new s.R2Point(e.x,n.yMin+r),i.Affinity.Intrinsic)}}renderDomain(t,e,i){const n=this.borderColor.value,s=this.borderWidth.getValue();if(null!==n&&0!==s){const o=e.x,r=this.borderSerif.getValue(),l=i.yMin,a=i.yMax,h=t.lineWidth,d=t.strokeStyle;t.beginPath(),t.lineWidth=s,t.strokeStyle=n.toString(),0!==r?(t.moveTo(o+r,l),t.lineTo(o,l),t.lineTo(o,a),t.lineTo(o+r,a)):(t.moveTo(o,l),t.lineTo(o,a)),t.stroke(),t.lineWidth=h,t.strokeStyle=d}}}u([i.Animator({extends:Vr,type:e.ContinuousScale,inherits:"yScale",state:null,updateFlags:fn.NeedsLayout})],Vl.prototype,"scale",void 0);class Il extends Tl{get orientation(){return"bottom"}layoutTick(t,e,n,o){if(t.anchor.hasAffinity(i.Affinity.Intrinsic)){const r=o(t.value);t.setOffset(r),t.anchor.setState(new s.R2Point(n.xMin+r,e.y),i.Affinity.Intrinsic)}}renderDomain(t,e,i){const n=this.borderColor.value,s=this.borderWidth.getValue();if(null!==n&&0!==s){const o=i.xMin,r=i.xMax,l=e.y,a=this.borderSerif.getValue(),h=t.lineWidth,d=t.strokeStyle;t.beginPath(),t.lineWidth=s,t.strokeStyle=n.toString(),0!==a?(t.moveTo(o,l+a),t.lineTo(o,l),t.lineTo(r,l),t.lineTo(r,l+a)):(t.moveTo(o,l),t.lineTo(r,l)),t.stroke(),t.lineWidth=h,t.strokeStyle=d}}}u([i.Animator({extends:Vr,type:e.ContinuousScale,inherits:"xScale",state:null,updateFlags:fn.NeedsLayout})],Il.prototype,"scale",void 0);class Ml extends Tl{get orientation(){return"left"}layoutTick(t,e,n,o){if(t.anchor.hasAffinity(i.Affinity.Intrinsic)){const r=o(t.value);t.setOffset(r),t.anchor.setState(new s.R2Point(e.x,n.yMin+r),i.Affinity.Intrinsic)}}renderDomain(t,e,i){const n=this.borderColor.value,s=this.borderWidth.getValue();if(null!==n&&0!==s){const o=e.x,r=this.borderSerif.getValue(),l=i.yMin,a=i.yMax,h=t.lineWidth,d=t.strokeStyle;t.beginPath(),t.lineWidth=s,t.strokeStyle=n.toString(),0!==r?(t.moveTo(o-r,l),t.lineTo(o,l),t.lineTo(o,a),t.lineTo(o-r,a)):(t.moveTo(o,l),t.lineTo(o,a)),t.stroke(),t.lineWidth=h,t.strokeStyle=d}}}u([i.Animator({extends:Vr,type:e.ContinuousScale,inherits:"yScale",state:null,updateFlags:fn.NeedsLayout})],Ml.prototype,"scale",void 0);class Rl extends A{}class Fl extends Rl{}class Ll extends Rl{}class kl extends Rl{}class Ol extends Rl{}class El extends Qs{}u([eo({traitType:Rl,willAttachTrait(t){this.owner.callObservers("controllerWillAttachAxisTrait",t,this.owner)},didDetachTrait(t){this.owner.callObservers("controllerDidDetachAxisTrait",t,this.owner)},viewType:Tl,willAttachView(t){this.owner.callObservers("controllerWillAttachAxisView",t,this.owner)},didDetachView(t){this.owner.callObservers("controllerDidDetachAxisView",t,this.owner)}})],El.prototype,"axis",void 0);class Wl extends El{}u([eo({extends:!0,traitType:Fl,viewType:Pl})],Wl.prototype,"axis",void 0);class Nl extends El{}u([eo({extends:!0,traitType:Ll,viewType:Vl})],Nl.prototype,"axis",void 0);class Bl extends El{}u([eo({extends:!0,traitType:kl,viewType:Il})],Bl.prototype,"axis",void 0);class zl extends El{}u([eo({extends:!0,traitType:Ol,viewType:Ml})],zl.prototype,"axis",void 0);class Ul extends Fr{xRange(){const t=this.viewFrame,i=this.gutterLeft.getValue().pxValue(t.width),n=this.gutterRight.getValue().pxValue(t.width),s=this.xRangePadding.state,o=s[0],r=this.viewFrame.width-n-i-s[1];return e.LinearRange(o,r)}yRange(){const t=this.viewFrame,i=this.gutterTop.getValue().pxValue(t.height),n=this.gutterBottom.getValue().pxValue(t.height),s=this.yRangePadding.state,o=s[0],r=this.viewFrame.height-n-i-s[1];return e.LinearRange(r,o)}updateScales(){this.layoutChart(this.viewFrame),super.updateScales()}layoutChart(t){const e=this.gutterTop.getValue().pxValue(t.height),n=this.gutterRight.getValue().pxValue(t.width),o=this.gutterBottom.getValue().pxValue(t.height),r=this.gutterLeft.getValue().pxValue(t.width),l=t.yMin+e,a=t.xMax-n,h=t.yMax-o,d=t.xMin+r,c=this.topAxis.view;null!==c&&(c.setViewFrame(new s.R2Box(d,t.yMin,a,h)),c.origin.setState(new s.R2Point(d,l),i.Affinity.Intrinsic));const u=this.rightAxis.view;null!==u&&(u.setViewFrame(new s.R2Box(d,l,t.xMax,h)),u.origin.setState(new s.R2Point(Math.max(d,a),h),i.Affinity.Intrinsic));const p=this.bottomAxis.view;null!==p&&(p.setViewFrame(new s.R2Box(d,l,a,t.yMax)),p.origin.setState(new s.R2Point(d,Math.max(l,h)),i.Affinity.Intrinsic));const f=this.leftAxis.view;null!==f&&(f.setViewFrame(new s.R2Box(t.xMin,l,a,h)),f.origin.setState(new s.R2Point(d,h),i.Affinity.Intrinsic));const g=this.graph.view;null!==g&&g.setViewFrame(new s.R2Box(d,l,a,h))}init(t){super.init(t),void 0!==t.graph&&this.graph(t.graph),void 0!==t.topAxis&&this.topAxis(t.topAxis),void 0!==t.rightAxis&&this.rightAxis(t.rightAxis),void 0!==t.bottomAxis&&this.bottomAxis(t.bottomAxis),void 0!==t.leftAxis&&this.leftAxis(t.leftAxis),void 0!==t.gutterTop&&this.gutterTop(t.gutterTop),void 0!==t.gutterRight&&this.gutterRight(t.gutterRight),void 0!==t.gutterBottom&&this.gutterBottom(t.gutterBottom),void 0!==t.gutterLeft&&this.gutterLeft(t.gutterLeft),void 0!==t.borderColor&&this.borderColor(t.borderColor),void 0!==t.borderWidth&&this.borderWidth(t.borderWidth),void 0!==t.borderSerif&&this.borderSerif(t.borderSerif),void 0!==t.tickMarkColor&&this.tickMarkColor(t.tickMarkColor),void 0!==t.tickMarkWidth&&this.tickMarkWidth(t.tickMarkWidth),void 0!==t.tickMarkLength&&this.tickMarkLength(t.tickMarkLength),void 0!==t.tickLabelPadding&&this.tickLabelPadding(t.tickLabelPadding),void 0!==t.tickTransition&&this.tickTransition(t.tickTransition),void 0!==t.gridLineColor&&this.gridLineColor(t.gridLineColor),void 0!==t.gridLineWidth&&this.gridLineWidth(t.gridLineWidth),void 0!==t.font&&this.font(t.font),void 0!==t.textColor&&this.textColor(t.textColor)}}u([Ht({type:s.Length,state:s.Length.px(20)})],Ul.prototype,"gutterTop",void 0),u([Ht({type:s.Length,state:s.Length.px(40)})],Ul.prototype,"gutterRight",void 0),u([Ht({type:s.Length,state:s.Length.px(20)})],Ul.prototype,"gutterBottom",void 0),u([Ht({type:s.Length,state:s.Length.px(40)})],Ul.prototype,"gutterLeft",void 0),u([Ht({type:z,state:null,look:At.neutralColor})],Ul.prototype,"borderColor",void 0),u([Ht({type:Number,state:1})],Ul.prototype,"borderWidth",void 0),u([Ht({type:Number,state:6})],Ul.prototype,"borderSerif",void 0),u([Ht({type:z,state:null,look:At.neutralColor})],Ul.prototype,"tickMarkColor",void 0),u([Ht({type:Number,state:1})],Ul.prototype,"tickMarkWidth",void 0),u([Ht({type:Number,state:6})],Ul.prototype,"tickMarkLength",void 0),u([Ht({type:Number,state:2})],Ul.prototype,"tickLabelPadding",void 0),u([i.Property({type:e.Timing,initState:()=>e.Easing.cubicOut.withDuration(250)})],Ul.prototype,"tickTransition",void 0),u([Ht({type:z,state:null,look:At.subduedColor})],Ul.prototype,"gridLineColor",void 0),u([Ht({type:Number,state:0})],Ul.prototype,"gridLineWidth",void 0),u([Ht({type:E,state:null,inherits:!0})],Ul.prototype,"font",void 0),u([Ht({type:z,state:null,look:At.mutedColor})],Ul.prototype,"textColor",void 0),u([vn({key:!0,type:_r,binds:!0,willAttachView(t){this.owner.callObservers("viewWillAttachGraph",t,this.owner)},didDetachView(t){this.owner.callObservers("viewDidDetachGraph",t,this.owner)},detectView:t=>t instanceof _r?t:null})],Ul.prototype,"graph",void 0),u([vn({key:!0,type:Pl,binds:!0,willAttachView(t){this.owner.callObservers("viewWillAttachTopAxis",t,this.owner)},didDetachView(t){this.owner.callObservers("viewDidDetachTopAxis",t,this.owner)},detectView:t=>t instanceof Pl?t:null})],Ul.prototype,"topAxis",void 0),u([vn({key:!0,type:Vl,binds:!0,willAttachView(t){this.owner.callObservers("viewWillAttachRightAxis",t,this.owner)},didDetachView(t){this.owner.callObservers("viewDidDetachRightAxis",t,this.owner)},detectView:t=>t instanceof Vl?t:null})],Ul.prototype,"rightAxis",void 0),u([vn({key:!0,type:Il,binds:!0,willAttachView(t){this.owner.callObservers("viewWillAttachBottomAxis",t,this.owner)},didDetachView(t){this.owner.callObservers("viewDidDetachBottomAxis",t,this.owner)},detectView:t=>t instanceof Il?t:null})],Ul.prototype,"bottomAxis",void 0),u([vn({key:!0,type:Ml,binds:!0,willAttachView(t){this.owner.callObservers("viewWillAttachLeftAxis",t,this.owner)},didDetachView(t){this.owner.callObservers("viewDidDetachLeftAxis",t,this.owner)},detectView:t=>t instanceof Ml?t:null})],Ul.prototype,"leftAxis",void 0);class Hl extends A{onStartConsuming(){super.onStartConsuming();const t=this.graph.trait;null!==t&&t.consume(this);const e=this.topAxis.trait;null!==e&&e.consume(this);const i=this.rightAxis.trait;null!==i&&i.consume(this);const n=this.bottomAxis.trait;null!==n&&n.consume(this);const s=this.leftAxis.trait;null!==s&&s.consume(this)}onStopConsuming(){super.onStopConsuming();const t=this.graph.trait;null!==t&&t.unconsume(this);const e=this.topAxis.trait;null!==e&&e.unconsume(this);const i=this.rightAxis.trait;null!==i&&i.unconsume(this);const n=this.bottomAxis.trait;null!==n&&n.unconsume(this);const s=this.leftAxis.trait;null!==s&&s.unconsume(this)}}u([D({type:Qr,binds:!0,willAttachTrait(t){this.owner.callObservers("traitWillAttachGraph",t,this.owner)},didAttachTrait(t){this.owner.consuming&&t.consume(this.owner)},willDetachTrait(t){this.owner.consuming&&t.unconsume(this.owner)},didDetachTrait(t){this.owner.callObservers("traitDidDetachGraph",t,this.owner)},detectModel:t=>t.getTrait(Qr),detectTrait:t=>t instanceof Qr?t:null})],Hl.prototype,"graph",void 0),u([D({type:Fl,binds:!0,willAttachTrait(t){this.owner.callObservers("traitWillAttachTopAxis",t,this.owner)},didAttachTrait(t){this.owner.consuming&&t.consume(this.owner)},willDetachTrait(t){this.owner.consuming&&t.unconsume(this.owner)},didDetachTrait(t){this.owner.callObservers("traitDidDetachTopAxis",t,this.owner)},detectModel:t=>t.getTrait(Fl),detectTrait:t=>t instanceof Fl?t:null})],Hl.prototype,"topAxis",void 0),u([D({type:Ll,binds:!0,willAttachTrait(t){this.owner.callObservers("traitWillAttachRightAxis",t,this.owner)},didAttachTrait(t){this.owner.consuming&&t.consume(this.owner)},willDetachTrait(t){this.owner.consuming&&t.unconsume(this.owner)},didDetachTrait(t){this.owner.callObservers("traitDidDetachRightAxis",t,this.owner)},detectModel:t=>t.getTrait(Ll),detectTrait:t=>t instanceof Ll?t:null})],Hl.prototype,"rightAxis",void 0),u([D({type:kl,binds:!0,willAttachTrait(t){this.owner.callObservers("traitWillAttachBottomAxis",t,this.owner)},didAttachTrait(t){this.owner.consuming&&t.consume(this.owner)},willDetachTrait(t){this.owner.consuming&&t.unconsume(this.owner)},didDetachTrait(t){this.owner.callObservers("traitDidDetachBottomAxis",t,this.owner)},detectModel:t=>t.getTrait(kl),detectTrait:t=>t instanceof kl?t:null})],Hl.prototype,"bottomAxis",void 0),u([D({type:Ol,binds:!0,willAttachTrait(t){this.owner.callObservers("traitWillAttachLeftAxis",t,this.owner)},didAttachTrait(t){this.owner.consuming&&t.consume(this.owner)},willDetachTrait(t){this.owner.consuming&&t.unconsume(this.owner)},didDetachTrait(t){this.owner.callObservers("traitDidDetachLeftAxis",t,this.owner)},detectModel:t=>t.getTrait(Ol),detectTrait:t=>t instanceof Ol?t:null})],Hl.prototype,"leftAxis",void 0);class ql extends Jr{}u([eo({traitType:Hl,observesTrait:!0,initTrait(t){this.owner.graph.setTrait(t.graph.trait);const e=t.topAxis.trait;null!==e&&this.owner.topAxis.setTrait(e);const i=t.rightAxis.trait;null!==i&&this.owner.rightAxis.setTrait(i);const n=t.bottomAxis.trait;null!==n&&this.owner.bottomAxis.setTrait(n);const s=t.leftAxis.trait;null!==s&&this.owner.leftAxis.setTrait(s)},deinitTrait(t){const e=t.leftAxis.trait;null!==e&&this.owner.leftAxis.deleteTrait(e);const i=t.bottomAxis.trait;null!==i&&this.owner.bottomAxis.deleteTrait(i);const n=t.rightAxis.trait;null!==n&&this.owner.rightAxis.deleteTrait(n);const s=t.topAxis.trait;null!==s&&this.owner.topAxis.deleteTrait(s),this.owner.graph.setTrait(null)},willAttachTrait(t){this.owner.callObservers("controllerWillAttachChartTrait",t,this.owner)},didDetachTrait(t){this.owner.callObservers("controllerDidDetachChartTrait",t,this.owner)},traitWillAttachTopAxis(t){this.owner.topAxis.setTrait(t)},traitDidDetachTopAxis(t){this.owner.topAxis.setTrait(null)},traitWillAttachRightAxis(t){this.owner.rightAxis.setTrait(t)},traitDidDetachRightAxis(t){this.owner.rightAxis.setTrait(null)},traitWillAttachBottomAxis(t){this.owner.bottomAxis.setTrait(t)},traitDidDetachBottomAxis(t){this.owner.bottomAxis.setTrait(null)},traitWillAttachLeftAxis(t){this.owner.leftAxis.setTrait(t)},traitDidDetachLeftAxis(t){this.owner.leftAxis.setTrait(null)},viewType:Ul,initView(t){const e=this.owner.topAxis.controller;null!==e&&e.axis.insertView(t);const i=this.owner.rightAxis.controller;null!==i&&i.axis.insertView(t);const n=this.owner.bottomAxis.controller;null!==n&&n.axis.insertView(t);const s=this.owner.leftAxis.controller;null!==s&&s.axis.insertView(t),null===this.owner.graph.view&&null===this.owner.graph.trait||this.owner.graph.insertView(t)},willAttachView(t){this.owner.callObservers("controllerWillAttachChartView",t,this.owner)},didDetachView(t){this.owner.callObservers("controllerDidDetachChartView",t,this.owner)}})],ql.prototype,"chart",void 0),u([eo({extends:!0,initTrait(t){Jr.graph.prototype.initTrait.call(this,t);const e=this.owner.chart.view;null!==e&&this.insertView(e)},initView(t){Jr.graph.prototype.initView.call(this,t);const e=this.owner.chart.view;null!==e&&this.insertView(e)},deinitView(t){Jr.graph.prototype.deinitView.call(this,t),t.remove()}})],ql.prototype,"graph",void 0),u([so({type:Wl,binds:!0,observes:!0,get parentView(){return this.owner.chart.view},getTraitViewRef:t=>t.axis,willAttachController(t){this.owner.callObservers("controllerWillAttachTopAxis",t,this.owner)},didAttachController(t){const e=t.axis.trait;null!==e&&this.attachAxisTrait(e);const i=t.axis.view;null!==i&&this.attachAxisView(i)},willDetachController(t){const e=t.axis.view;null!==e&&this.detachAxisView(e);const i=t.axis.trait;null!==i&&this.detachAxisTrait(i)},didDetachController(t){this.owner.callObservers("controllerDidDetachTopAxis",t,this.owner)},controllerWillAttachAxisTrait(t){this.owner.callObservers("controllerWillAttachTopAxisTrait",t,this.owner),this.attachAxisTrait(t)},controllerDidDetachAxisTrait(t){this.detachAxisTrait(t),this.owner.callObservers("controllerDidDetachTopAxisTrait",t,this.owner)},attachAxisTrait(t){},detachAxisTrait(t){},controllerWillAttachAxisView(t){this.owner.callObservers("controllerWillAttachTopAxisView",t,this.owner),this.attachAxisView(t)},controllerDidDetachAxisView(t){this.detachAxisView(t),this.owner.callObservers("controllerDidDetachTopAxisView",t,this.owner)},attachAxisView(t){},detachAxisView(t){t.remove()},detectController:t=>t instanceof Wl?t:null})],ql.prototype,"topAxis",void 0),u([so({type:Nl,binds:!0,observes:!0,get parentView(){return this.owner.chart.view},getTraitViewRef:t=>t.axis,willAttachController(t){this.owner.callObservers("controllerWillAttachRightAxis",t,this.owner)},didAttachController(t){const e=t.axis.trait;null!==e&&this.attachAxisTrait(e);const i=t.axis.view;null!==i&&this.attachAxisView(i)},willDetachController(t){const e=t.axis.view;null!==e&&this.detachAxisView(e);const i=t.axis.trait;null!==i&&this.detachAxisTrait(i)},didDetachController(t){this.owner.callObservers("controllerDidDetachRightAxis",t,this.owner)},controllerWillAttachAxisTrait(t){this.owner.callObservers("controllerWillAttachRightAxisTrait",t,this.owner),this.attachAxisTrait(t)},controllerDidDetachAxisTrait(t){this.detachAxisTrait(t),this.owner.callObservers("controllerDidDetachRightAxisTrait",t,this.owner)},attachAxisTrait(t){},detachAxisTrait(t){},controllerWillAttachAxisView(t){this.owner.callObservers("controllerWillAttachRightAxisView",t,this.owner),this.attachAxisView(t)},controllerDidDetachAxisView(t){this.detachAxisView(t),this.owner.callObservers("controllerDidDetachRightAxisView",t,this.owner)},attachAxisView(t){},detachAxisView(t){t.remove()},detectController:t=>t instanceof Nl?t:null})],ql.prototype,"rightAxis",void 0),u([so({type:Bl,binds:!0,observes:!0,get parentView(){return this.owner.chart.view},getTraitViewRef:t=>t.axis,willAttachController(t){this.owner.callObservers("controllerWillAttachBottomAxis",t,this.owner)},didAttachController(t){const e=t.axis.trait;null!==e&&this.attachAxisTrait(e);const i=t.axis.view;null!==i&&this.attachAxisView(i)},willDetachController(t){const e=t.axis.view;null!==e&&this.detachAxisView(e);const i=t.axis.trait;null!==i&&this.detachAxisTrait(i)},didDetachController(t){this.owner.callObservers("controllerDidDetachBottomAxis",t,this.owner)},controllerWillAttachAxisTrait(t){this.owner.callObservers("controllerWillAttachBottomAxisTrait",t,this.owner),this.attachAxisTrait(t)},controllerDidDetachAxisTrait(t){this.detachAxisTrait(t),this.owner.callObservers("controllerDidDetachBottomAxisTrait",t,this.owner)},attachAxisTrait(t){},detachAxisTrait(t){},controllerWillAttachAxisView(t){this.owner.callObservers("controllerWillAttachBottomAxisView",t,this.owner),this.attachAxisView(t)},controllerDidDetachAxisView(t){this.detachAxisView(t),this.owner.callObservers("controllerDidDetachBottomAxisView",t,this.owner)},attachAxisView(t){},detachAxisView(t){t.remove()},detectController:t=>t instanceof Bl?t:null})],ql.prototype,"bottomAxis",void 0),u([so({type:zl,binds:!0,observes:!0,get parentView(){return this.owner.chart.view},getTraitViewRef:t=>t.axis,willAttachController(t){this.owner.callObservers("controllerWillAttachLeftAxis",t,this.owner)},didAttachController(t){const e=t.axis.trait;null!==e&&this.attachAxisTrait(e);const i=t.axis.view;null!==i&&this.attachAxisView(i)},willDetachController(t){const e=t.axis.view;null!==e&&this.detachAxisView(e);const i=t.axis.trait;null!==i&&this.detachAxisTrait(i)},didDetachController(t){this.owner.callObservers("controllerDidDetachLeftAxis",t,this.owner)},controllerWillAttachAxisTrait(t){this.owner.callObservers("controllerWillAttachLeftAxisTrait",t,this.owner),this.attachAxisTrait(t)},controllerDidDetachAxisTrait(t){this.detachAxisTrait(t),this.owner.callObservers("controllerDidDetachLeftAxisTrait",t,this.owner)},attachAxisTrait(t){},detachAxisTrait(t){},controllerWillAttachAxisView(t){this.owner.callObservers("controllerWillAttachLeftAxisView",t,this.owner),this.attachAxisView(t)},controllerDidDetachAxisView(t){this.detachAxisView(t),this.owner.callObservers("controllerDidDetachLeftAxisView",t,this.owner)},attachAxisView(t){},detachAxisView(t){t.remove()},detectController:t=>t instanceof zl?t:null})],ql.prototype,"leftAxis",void 0);const Gl=function(){const t={fromAny:function(t){if(null==t)return t;{let e,i;e=void 0!==t.geoFrame&&null!==t.geoFrame?c.GeoBox.fromAny(t.geoFrame):null,i=void 0!==t.geoCenter&&null!==t.geoCenter?c.GeoPoint.fromAny(t.geoCenter):null;return{geoFrame:e,geoCenter:i,zoom:t.zoom,heading:t.heading,tilt:t.tilt}}},is:function(t){if(null!=t||"function"==typeof t){const e=t;return"geoFrame"in e&&"geoCenter"in e&&"zoom"in e&&"heading"in e&&"tilt"in e}return!1}};return t}(),jl=function(){const t={is:function(t){return!(!c.GeoProjection.is(t)||!Gl.is(t))}};return t}();class Yl extends ns{needsProcess(t,e){return 0==(this.flags&fn.NeedsAnimate)&&(t&=~fn.NeedsAnimate),t}cascadeProcess(t,e){const i=this.extendViewContext(e),n=Ni.current;try{if(Ni.current=i,t&=~fn.NeedsProcess,t|=this.flags&fn.UpdateMask,0!=((t=this.needsProcess(t,i))&fn.ProcessMask)){let e=t;this.setFlags(this.flags&~fn.NeedsProcess|fn.TraversingFlag|fn.ProcessingFlag|fn.ContextualFlag),this.willProcess(e,i),0!=((this.flags|t)&fn.NeedsResize)&&(e|=fn.NeedsResize,this.setFlags(this.flags&~fn.NeedsResize),this.willResize(i)),0!=((this.flags|t)&fn.NeedsScroll)&&(e|=fn.NeedsScroll,this.setFlags(this.flags&~fn.NeedsScroll),this.willScroll(i)),0!=((this.flags|t)&fn.NeedsChange)&&(e|=fn.NeedsChange,this.setFlags(this.flags&~fn.NeedsChange),this.willChange(i)),0!=((this.flags|t)&fn.NeedsAnimate)&&(e|=fn.NeedsAnimate,this.setFlags(this.flags&~fn.NeedsAnimate),this.willAnimate(i)),0!=((this.flags|t)&fn.NeedsLayout)&&(e|=fn.NeedsLayout,this.setFlags(this.flags&~fn.NeedsLayout),this.willLayout(i)),0!=((this.flags|t)&fn.NeedsProject)&&(e|=fn.NeedsProject,this.setFlags(this.flags&~fn.NeedsProject),this.willProject(i)),this.onProcess(e,i),0!=(e&fn.NeedsResize)&&this.onResize(i),0!=(e&fn.NeedsScroll)&&this.onScroll(i),0!=(e&fn.NeedsChange)&&this.onChange(i),0!=(e&fn.NeedsAnimate)&&this.onAnimate(i),0!=(e&fn.NeedsLayout)&&this.onLayout(i),0!=(e&fn.NeedsProject)&&this.onProject(i),0!=(e&fn.ProcessMask)&&(this.setFlags(this.flags&~fn.ContextualFlag),this.processChildren(e,i,this.processChild),this.setFlags(this.flags|fn.ContextualFlag)),0!=(e&fn.NeedsProject)&&this.didProject(i),0!=(e&fn.NeedsLayout)&&this.didLayout(i),0!=(e&fn.NeedsAnimate)&&this.didAnimate(i),0!=(e&fn.NeedsChange)&&this.didChange(i),0!=(e&fn.NeedsScroll)&&this.didScroll(i),0!=(e&fn.NeedsResize)&&this.didResize(i),this.didProcess(e,i)}}finally{this.setFlags(this.flags&~(fn.TraversingFlag|fn.ProcessingFlag|fn.ContextualFlag)),Ni.current=n}}willProject(t){const e=this.observerCache.viewWillProjectObservers;if(void 0!==e)for(let i=0;i<e.length;i+=1){e[i].viewWillProject(t,this)}}onProject(t){}didProject(t){const e=this.observerCache.viewDidProjectObservers;if(void 0!==e)for(let i=0;i<e.length;i+=1){e[i].viewDidProject(t,this)}}onRender(t){super.onRender(t);const e=this.geoBoundsColor.value;null!==e&&this.renderGeoBounds(t,e,1)}renderGeoBounds(t,e,i){const n=t.renderer;n instanceof as&&!this.isHidden()&&!this.culled&&!this.unbounded&&this.renderGeoOutline(this.geoBounds,t.geoViewport,n.context,e,i)}renderGeoOutline(t,e,i,n,s){if(t.isDefined()){const o=i.lineWidth,r=i.strokeStyle,l=e.project(t.southWest.normalized()),a=e.project(t.northWest.normalized()),h=e.project(t.northEast.normalized()),d=e.project(t.southEast.normalized());i.beginPath(),i.moveTo(l.x,l.y),i.lineTo(a.x,a.y),i.lineTo(h.x,h.y),i.lineTo(d.x,d.y),i.closePath(),i.lineWidth=s,i.strokeStyle=n.toString(),i.stroke(),i.lineWidth=o,i.strokeStyle=r}}onSetHidden(t){const e=this.parent;e instanceof Yl&&e.onSetChildHidden(this,t),t||this.requireUpdate(fn.NeedsProject)}onSetChildHidden(t,e){}onSetChildUnbounded(t,e){}onSetUnbounded(t){const e=this.parent;e instanceof Yl&&e.onSetChildUnbounded(this,t)}cullGeoFrame(t=this.geoFrame){this.setCulled(!t.intersects(this.geoBounds))}get geoViewport(){return this.viewContext.geoViewport}get geoFrame(){const t=this.parent;return t instanceof Yl?t.geoFrame:c.GeoBox.globe()}get ownGeoBounds(){return null}willSetGeoBounds(t,e){const i=this.observers;for(let n=0,s=i.length;n<s;n+=1){const s=i[n];void 0!==s.viewWillSetGeoBounds&&s.viewWillSetGeoBounds(t,e,this)}}onSetGeoBounds(t,e){if(!this.unbounded){const i=this.parent;i instanceof Yl&&i.onSetChildGeoBounds(this,t,e)}}didSetGeoBounds(t,e){const i=this.observers;for(let n=0,s=i.length;n<s;n+=1){const s=i[n];void 0!==s.viewDidSetGeoBounds&&s.viewDidSetGeoBounds(t,e,this)}}onSetChildGeoBounds(t,e,i){}deriveGeoBounds(){let t=this.ownGeoBounds;return this.forEachChild((function(e){if(e instanceof Yl&&!e.isHidden()&&!e.unbounded){const i=e.geoBounds;i.isDefined()&&(t=null!==t?t.union(i):i)}}),this),null===t&&(t=this.geoFrame),t}onObserve(t){super.onObserve(t),void 0!==t.viewWillProject&&(this.observerCache.viewWillProjectObservers=e.Arrays.inserted(t,this.observerCache.viewWillProjectObservers)),void 0!==t.viewDidProject&&(this.observerCache.viewDidProjectObservers=e.Arrays.inserted(t,this.observerCache.viewDidProjectObservers))}onUnobserve(t){super.onUnobserve(t),void 0!==t.viewWillProject&&(this.observerCache.viewWillProjectObservers=e.Arrays.removed(t,this.observerCache.viewWillProjectObservers)),void 0!==t.viewDidProject&&(this.observerCache.viewDidProjectObservers=e.Arrays.removed(t,this.observerCache.viewDidProjectObservers))}init(t){super.init(t)}}Yl.MountFlags=ns.MountFlags|fn.NeedsProject,Yl.UncullFlags=ns.UncullFlags|fn.NeedsProject,u([Ht({type:z,state:null,inherits:!0})],Yl.prototype,"geoBoundsColor",void 0),Object.defineProperty(Yl.prototype,"geoBounds",{get(){return this.geoFrame},configurable:!0});class Xl extends A{}class Kl extends Qs{static fromTrait(t){if(t instanceof _l)return new $l;if(t instanceof ma)return new ba;if(t instanceof ua)return new ga;if(t instanceof ca)return new fa;throw new Error("Can't create GeoController from "+t)}}u([i.Property({type:e.Timing,inherits:!0})],Kl.prototype,"geoTiming",void 0);class Zl extends Yl{constructor(){super(),this.children=[],this.childMap=null,Object.defineProperty(this,"geoBounds",{value:c.GeoBox.undefined(),writable:!0,enumerable:!0,configurable:!0})}get childCount(){return this.children.length}firstChild(){const t=this.children;return 0!==t.length?t[0]:null}lastChild(){const t=this.children,e=t.length;return 0!==e?t[e-1]:null}nextChild(t){const e=this.children,i=e.indexOf(t);return i>=0&&i+1<e.length?e[i+1]:null}previousChild(t){const e=this.children,i=e.indexOf(t);return i-1>=0?e[i-1]:null}forEachChild(t,e){let i;const n=this.children;let s=0;for(;s<n.length;){const o=n[s];if(i=t.call(e,o),void 0!==i)break;n[s]===o&&(s+=1)}return i}insertChildMap(t){const e=t.key;if(void 0!==e){let i=this.childMap;null===i&&(i={},this.childMap=i),i[e]=t}}removeChildMap(t){const e=t.key;if(void 0!==e){const t=this.childMap;null!==t&&delete t[e]}}replaceChildMap(t,e){const i=e.key;if(void 0!==i){let e=this.childMap;null===e&&(e={},this.childMap=e),e[i]=t}}getChild(t,e){const i=this.childMap;if(null!==i){const n=i[t];if(void 0!==n&&(void 0===e||n instanceof e))return n}return null}setChild(t,e){null!==e&&(e=fn.fromAny(e));const i=this.getChild(t),n=this.children;let s=-1,o=null;return null!==i&&null!==e&&i!==e?(e.remove(),s=n.indexOf(i),o=s+1<n.length?n[s+1]:null,e.setKey(i.key),this.willRemoveChild(i),this.willInsertChild(e,o),i.detachParent(this),n[s]=e,this.replaceChildMap(e,i),e.attachParent(this),this.onRemoveChild(i),this.onInsertChild(e,o),this.didRemoveChild(i),this.didInsertChild(e,o),i.setKey(void 0),e.cascadeInsert()):(e!==i||null!==e&&e.key!==t)&&(null!==i&&(this.willRemoveChild(i),i.detachParent(this),this.removeChildMap(i),s=n.indexOf(i),n.splice(s,1),this.onRemoveChild(i),this.didRemoveChild(i),i.setKey(void 0),s<n.length&&(o=n[s])),null!==e&&(e.remove(),e.setKey(t),this.willInsertChild(e,o),s>=0?n.splice(s,0,e):n.push(e),this.insertChildMap(e),e.attachParent(this),this.onInsertChild(e,o),this.didInsertChild(e,o),e.cascadeInsert())),i}appendChild(t,e){return(t=fn.fromAny(t)).remove(),void 0!==e&&(this.removeChild(e),t.setKey(e)),this.willInsertChild(t,null),this.children.push(t),this.insertChildMap(t),t.attachParent(this),this.onInsertChild(t,null),this.didInsertChild(t,null),t.cascadeInsert(),t}prependChild(t,e){(t=fn.fromAny(t)).remove(),void 0!==e&&(this.removeChild(e),t.setKey(e));const i=this.children,n=0!==i.length?i[0]:null;return this.willInsertChild(t,n),i.unshift(t),this.insertChildMap(t),t.attachParent(this),this.onInsertChild(t,n),this.didInsertChild(t,n),t.cascadeInsert(),t}insertChild(t,e,i){if(null!==e&&e.parent!==this)throw new TypeError(""+e);(t=fn.fromAny(t)).remove(),void 0!==i&&(this.removeChild(i),t.setKey(i)),this.willInsertChild(t,e);const n=this.children,s=null!==e?n.indexOf(e):-1;return s>=0?n.splice(s,0,t):n.push(t),this.insertChildMap(t),t.attachParent(this),this.onInsertChild(t,e),this.didInsertChild(t,e),t.cascadeInsert(),t}replaceChild(t,e){const i=this.children;if(e.parent!==this)throw new TypeError(""+e);if((t=fn.fromAny(t))!==e){t.remove();const n=i.indexOf(e),s=n+1<i.length?i[n+1]:null;t.setKey(e.key),this.willRemoveChild(e),this.willInsertChild(t,s),e.detachParent(this),i[n]=t,this.replaceChildMap(t,e),t.attachParent(this),this.onRemoveChild(e),this.onInsertChild(t,s),this.didRemoveChild(e),this.didInsertChild(t,s),e.setKey(void 0),t.cascadeInsert()}return e}didInsertChild(t,e){t instanceof Yl&&this.onInsertChildGeoBounds(t,t.geoBounds),super.didInsertChild(t,e)}removeChild(t){let e;if("string"==typeof t){if(e=this.getChild(t),null===e)return null}else if(e=t,e.parent!==this)throw new Error("not a child view");this.willRemoveChild(e),e.detachParent(this),this.removeChildMap(e);const i=this.children,n=i.indexOf(e);return i.splice(n,1),this.onRemoveChild(e),this.didRemoveChild(e),e.setKey(void 0),e}didRemoveChild(t){t instanceof Yl&&this.onRemoveChildGeoBounds(t,t.geoBounds),super.didRemoveChild(t)}removeChildren(){const t=this.children;let e;for(;e=t.length,0!==e;){const i=t[e-1];this.willRemoveChild(i),i.detachParent(this),this.removeChildMap(i),t.pop(),this.onRemoveChild(i),this.didRemoveChild(i),i.setKey(void 0)}}mountChildren(){const t=this.children;let e=0;for(;e<t.length;){const i=t[e];i.cascadeMount(),0==(i.flags&fn.RemovingFlag)?e+=1:(i.setFlags(i.flags&~fn.RemovingFlag),this.removeChild(i))}}unmountChildren(){const t=this.children;let e=0;for(;e<t.length;){const i=t[e];i.cascadeUnmount(),0==(i.flags&fn.RemovingFlag)?e+=1:(i.setFlags(i.flags&~fn.RemovingFlag),this.removeChild(i))}}processChildren(t,e,i){const n=this.children;let s=0;for(;s<n.length;){const o=n[s];i.call(this,o,t,e),0==(o.flags&fn.RemovingFlag)?s+=1:(o.setFlags(o.flags&~fn.RemovingFlag),this.removeChild(o))}}displayChildren(t,e,i){const n=this.children;let s=0;for(;s<n.length;){const o=n[s];i.call(this,o,t,e),0==(o.flags&fn.RemovingFlag)?s+=1:(o.setFlags(o.flags&~fn.RemovingFlag),this.removeChild(o))}}setGeoBounds(t){const e=this.geoBounds;e.equals(t)||(this.willSetGeoBounds(t,e),this.geoBounds=t,this.onSetGeoBounds(t,e),this.didSetGeoBounds(t,e))}updateGeoBounds(){this.setGeoBounds(this.deriveGeoBounds())}onInsertChildGeoBounds(t,e){this.updateGeoBounds()}onRemoveChildGeoBounds(t,e){this.updateGeoBounds()}onSetChildGeoBounds(t,e,i){this.updateGeoBounds()}onSetChildHidden(t,e){this.updateGeoBounds()}onSetChildUnbounded(t,e){this.updateGeoBounds()}deriveGeoBounds(){let t=this.ownGeoBounds;const e=this.children;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];if(n instanceof Yl&&!n.isHidden()&&!n.unbounded){const e=n.geoBounds;e.isDefined()&&(t=null!==t?t.union(e):e)}}return null===t&&(t=this.geoFrame),t}deriveViewBounds(){let t=this.ownViewBounds;const e=this.children;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];if(n instanceof ns&&!n.isHidden()&&!n.unbounded){const e=n.viewBounds;e.isDefined()&&(t=null!==t?t.union(e):e)}}return null===t&&(t=this.viewFrame),t}deriveHitBounds(){let t;const e=this.children;for(let i=0,n=e.length;i<n;i+=1){const n=e[i];if(n instanceof ns&&!n.isHidden()&&!n.intangible){const e=n.hitBounds;t=void 0===t?e:t.union(e)}}return void 0===t&&(t=this.viewBounds),t}hitTestChildren(t,e,i){const n=this.children;for(let s=n.length-1;s>=0;s-=1){const o=n[s];if(o instanceof ns){const n=o.cascadeHitTest(t,e,i);if(null!==n)return n}}return null}}class _l extends Xl{constructor(){super(),this.geoBounds=c.GeoBox.globe()}setGeoBounds(t){const e=this.geoBounds;t.equals(e)||(this.willSetGeoBounds(t,e),this.geoBounds=t,this.onSetGeoBounds(t,e),this.didSetGeoBounds(t,e))}willSetGeoBounds(t,e){this.callObservers("traitWillSetGeoBounds",t,e,this)}onSetGeoBounds(t,e){}didSetGeoBounds(t,e){this.callObservers("traitDidSetGeoBounds",t,e,this)}startConsumingFeatures(){const t=this.features.traits;for(const e in t){t[e].consume(this)}}stopConsumingFeatures(){const t=this.features.traits;for(const e in t){t[e].unconsume(this)}}onStartConsuming(){super.onStartConsuming(),this.startConsumingFeatures()}onStopConsuming(){super.onStopConsuming(),this.stopConsumingFeatures()}}u([T({type:Xl,binds:!0,willAttachTrait(t){this.owner.callObservers("traitWillAttachFeature",t,this.owner)},didAttachTrait(t){this.owner.consuming&&t.consume(this.owner)},willDetachTrait(t){this.owner.consuming&&t.unconsume(this.owner)},didDetachTrait(t){this.owner.callObservers("traitDidDetachFeature",t,this.owner)},detectModel:t=>t.getTrait(Xl),detectTrait:t=>null})],_l.prototype,"features",void 0);class Ql{constructor(t,e,i,n,s,o,r,l,a,h,d,c){this.depth=t,this.maxDepth=e,this.density=i,this.geoFrame=n,this.geoBounds=s,this.geoCenter=o,this.southWest=r,this.northWest=l,this.southEast=a,this.northEast=h,this.views=d,this.size=c}isEmpty(){return 0===this.size}contains(t){return this.geoFrame.contains(t)}intersects(t){return this.geoFrame.intersects(t)}getTree(t){if(this.depth<this.maxDepth&&this.size>this.density){const e=this.geoCenter,i=t.lngMin<=e.lng,n=t.latMin<=e.lat,s=t.lngMax>e.lng,o=t.latMax>e.lat;if(i!==s&&n!==o)if(n&&i){const e=this.southWest;if(null!==e)return e.getTree(t)}else if(o&&i){const e=this.northWest;if(null!==e)return e.getTree(t)}else if(n&&s){const e=this.southEast;if(null!==e)return e.getTree(t)}else if(o&&s){const e=this.northEast;if(null!==e)return e.getTree(t)}}return this}has(t,e){if(this.depth<this.maxDepth&&this.size>this.density){const i=this.hasNode(t,e);if(void 0!==i)return i}return this.hasLeaf(t,e)}hasNode(t,e){const i=this.geoCenter,n=e.lngMin<=i.lng,s=e.latMin<=i.lat,o=e.lngMax>i.lng,r=e.latMax>i.lat;if(n!==o&&s!==r)if(s&&n){const i=this.southWest;if(null!==i)return i.has(t,e)}else if(r&&n){const i=this.northWest;if(null!==i)return i.has(t,e)}else if(s&&o){const i=this.southEast;if(null!==i)return i.has(t,e)}else if(r&&o){const i=this.northEast;if(null!==i)return i.has(t,e)}}hasLeaf(t,e){return this.views.indexOf(t)>=0}inserted(t,e){let i=this;if(i.depth<i.maxDepth&&i.size>i.density){const n=i.insertedNode(t,e);if(null!==n)return i=n,this!==i&&i.size===i.density+1&&(i=i.reinsertedNode()),i}return i=i.insertedLeaf(t,e),this!==i&&i.depth<i.maxDepth&&i.size===i.density+1&&(i=i.reinsertedNode()),i}insertedNode(t,e){const i=this.geoCenter,n=e.lngMin<=i.lng,s=e.latMin<=i.lat,o=e.lngMax>i.lng,r=e.latMax>i.lat;if(n!==o&&s!==r){if(s&&n){const i=this.southWest;let n=i;return null===n&&(n=this.createTree(this.depth+1,this.maxDepth,this.density,new c.GeoBox(this.geoFrame.lngMin,this.geoFrame.latMin,this.geoCenter.lng,this.geoCenter.lat))),n=n.inserted(t,e),i!==n?this.createTree(this.depth,this.maxDepth,this.density,this.geoFrame,void 0,this.geoCenter,n,this.northWest,this.southEast,this.northEast,this.views,this.size+1):this}if(r&&n){const i=this.northWest;let n=i;return null===n&&(n=this.createTree(this.depth+1,this.maxDepth,this.density,new c.GeoBox(this.geoFrame.lngMin,this.geoCenter.lat,this.geoCenter.lng,this.geoFrame.latMax))),n=n.inserted(t,e),i!==n?this.createTree(this.depth,this.maxDepth,this.density,this.geoFrame,void 0,this.geoCenter,this.southWest,n,this.southEast,this.northEast,this.views,this.size+1):this}if(s&&o){const i=this.southEast;let n=i;return null===n&&(n=this.createTree(this.depth+1,this.maxDepth,this.density,new c.GeoBox(this.geoCenter.lng,this.geoFrame.latMin,this.geoFrame.lngMax,this.geoCenter.lat))),n=n.inserted(t,e),i!==n?this.createTree(this.depth,this.maxDepth,this.density,this.geoFrame,void 0,this.geoCenter,this.southWest,this.northWest,n,this.northEast,this.views,this.size+1):this}if(r&&o){const i=this.northEast;let n=i;return null===n&&(n=this.createTree(this.depth+1,this.maxDepth,this.density,new c.GeoBox(this.geoCenter.lng,this.geoCenter.lat,this.geoFrame.lngMax,this.geoFrame.latMax))),n=n.inserted(t,e),i!==n?this.createTree(this.depth,this.maxDepth,this.density,this.geoFrame,void 0,this.geoCenter,this.southWest,this.northWest,this.southEast,n,this.views,this.size+1):this}}return null}insertedLeaf(t,e){const i=this.views;if(i.indexOf(t)<0){const e=i.slice(0);return e.push(t),this.createTree(this.depth,this.maxDepth,this.density,this.geoFrame,void 0,this.geoCenter,this.southWest,this.northWest,this.southEast,this.northEast,e,this.size+1)}return this}removed(t,e){let i=this;if(i.depth<i.maxDepth&&i.size>i.density){const n=i.removedNode(t,e);if(null!==n)return i=n,this!==i&&i.size===i.density&&(i=i.reinsertedLeaf()),i}return i=i.removedLeaf(t,e),this!==i&&i.size===i.density&&(i=i.reinsertedLeaf()),i}removedNode(t,e){const i=this.geoCenter,n=e.lngMin<=i.lng,s=e.latMin<=i.lat,o=e.lngMax>i.lng,r=e.latMax>i.lat;if(n!==o&&s!==r){if(s&&n){const i=this.southWest;if(null!==i){let n=i.removed(t,e);return n.isEmpty()&&(n=null),this.createTree(this.depth,this.maxDepth,this.density,this.geoFrame,void 0,this.geoCenter,n,this.northWest,this.southEast,this.northEast,this.views,this.size-1)}return this}if(r&&n){const i=this.northWest;if(null!==i){let n=i.removed(t,e);return n.isEmpty()&&(n=null),this.createTree(this.depth,this.maxDepth,this.density,this.geoFrame,void 0,this.geoCenter,this.southWest,n,this.southEast,this.northEast,this.views,this.size-1)}return this}if(s&&o){const i=this.southEast;if(null!==i){let n=i.removed(t,e);return n.isEmpty()&&(n=null),this.createTree(this.depth,this.maxDepth,this.density,this.geoFrame,void 0,this.geoCenter,this.southWest,this.northWest,n,this.northEast,this.views,this.size-1)}return this}if(r&&o){const i=this.northEast;if(null!==i){let n=i.removed(t,e);return n.isEmpty()&&(n=null),this.createTree(this.depth,this.maxDepth,this.density,this.geoFrame,void 0,this.geoCenter,this.southWest,this.northWest,this.southEast,n,this.views,this.size-1)}return this}}return null}removedLeaf(t,e){const i=this.views,n=i.indexOf(t);if(n>=0){const t=i.slice(0);return t.splice(n,1),this.createTree(this.depth,this.maxDepth,this.density,this.geoFrame,void 0,this.geoCenter,this.southWest,this.northWest,this.southEast,this.northEast,t,this.size-1)}return this}reinsertedNode(){let t=this.createTree(this.depth,this.maxDepth,this.density,this.geoFrame,void 0,this.geoCenter);return this.forEach((function(e){const i=e.geoBounds,n=t.insertedNode(e,i);t=null!==n?n:t.insertedLeaf(e,i)}),this),t}reinsertedLeaf(){let t=this.createTree(this.depth,this.maxDepth,this.density,this.geoFrame,void 0,this.geoCenter);return this.forEach((function(e){t=t.insertedLeaf(e,e.geoBounds)}),this),t}moved(t,e,i){if(this.depth<this.maxDepth&&this.size>this.density){const n=this.geoCenter,s=e.lngMin<=n.lng,o=e.latMin<=n.lat,r=e.lngMax>n.lng,l=e.latMax>n.lat,a=i.lngMin<=n.lng,h=i.latMin<=n.lat,d=i.lngMax>n.lng,c=i.latMax>n.lat;if(s!==a||o!==h||r!==d||l!==c)return this.removed(t,i).inserted(t,e);if(s!==r&&o!==l)if(o&&s){const n=this.southWest,s=n.moved(t,e,i);if(n!==s)return this.createTree(this.depth,this.maxDepth,this.density,this.geoFrame,void 0,this.geoCenter,s,this.northWest,this.southEast,this.northEast,this.views,this.size)}else if(l&&s){const n=this.northWest,s=n.moved(t,e,i);if(n!==s)return this.createTree(this.depth,this.maxDepth,this.density,this.geoFrame,void 0,this.geoCenter,this.southWest,s,this.southEast,this.northEast,this.views,this.size)}else if(o&&r){const n=this.southEast,s=n.moved(t,e,i);if(n!==s)return this.createTree(this.depth,this.maxDepth,this.density,this.geoFrame,void 0,this.geoCenter,this.southWest,this.northWest,s,this.northEast,this.views,this.size)}else if(l&&r){const n=this.northEast,s=n.moved(t,e,i);if(n!==s)return this.createTree(this.depth,this.maxDepth,this.density,this.geoFrame,void 0,this.geoCenter,this.southWest,this.northWest,this.southEast,s,this.views,this.size)}}return this}forEach(t,e){if(null!==this.southWest){const i=this.southWest.forEach(t,e);if(void 0!==i)return i}if(null!==this.northWest){const i=this.northWest.forEach(t,e);if(void 0!==i)return i}if(null!==this.southEast){const i=this.southEast.forEach(t,e);if(void 0!==i)return i}if(null!==this.northEast){const i=this.northEast.forEach(t,e);if(void 0!==i)return i}const i=this.views;for(let n=0;n<i.length;n+=1){const s=t.call(e,i[n]);if(void 0!==s)return s}}forEachReverse(t,e){const i=this.views;for(let n=i.length-1;n>=0;n-=1){const s=t.call(e,i[n]);if(void 0!==s)return s}if(null!==this.northEast){const i=this.northEast.forEachReverse(t,e);if(void 0!==i)return i}if(null!==this.southEast){const i=this.southEast.forEachReverse(t,e);if(void 0!==i)return i}if(null!==this.northWest){const i=this.northWest.forEachReverse(t,e);if(void 0!==i)return i}if(null!==this.southWest){const i=this.southWest.forEachReverse(t,e);if(void 0!==i)return i}}forEachIntersecting(t,e,i){if(this.geoFrame.intersects(t)){if(null!==this.southWest){const n=this.southWest.forEachIntersecting(t,e,i);if(void 0!==n)return n}if(null!==this.northWest){const n=this.northWest.forEachIntersecting(t,e,i);if(void 0!==n)return n}if(null!==this.southEast){const n=this.southEast.forEachIntersecting(t,e,i);if(void 0!==n)return n}if(null!==this.northEast){const n=this.northEast.forEachIntersecting(t,e,i);if(void 0!==n)return n}const n=this.views;for(let t=0;t<n.length;t+=1){const s=e.call(i,n[t]);if(void 0!==s)return s}}}forEachNonIntersecting(t,e,i){if(!this.geoFrame.intersects(t)){if(null!==this.southWest){const n=this.southWest.forEachNonIntersecting(t,e,i);if(void 0!==n)return n}if(null!==this.northWest){const n=this.northWest.forEachNonIntersecting(t,e,i);if(void 0!==n)return n}if(null!==this.southEast){const n=this.southEast.forEachNonIntersecting(t,e,i);if(void 0!==n)return n}if(null!==this.northEast){const n=this.northEast.forEachNonIntersecting(t,e,i);if(void 0!==n)return n}const n=this.views;for(let t=0;t<n.length;t+=1){const s=e.call(i,n[t]);if(void 0!==s)return s}}}createTree(t,i,n,s,o,r,l=null,a=null,h=null,d=null,c=e.Arrays.empty,u=0){if(void 0===r&&(r=s.center),void 0===o){null!==l&&(o=l.geoBounds),null!==a&&(o=void 0!==o?o.union(a.geoBounds):a.geoBounds),null!==h&&(o=void 0!==o?o.union(h.geoBounds):h.geoBounds),null!==d&&(o=void 0!==o?o.union(d.geoBounds):d.geoBounds);for(let t=0;t<c.length;t+=1){const e=c[t];o=void 0!==o?o.union(e.geoBounds):e.geoBounds}void 0===o&&(o=s)}return new Ql(t,i,n,s,o,r,l,a,h,d,c,u)}static empty(t,i,n,s){return void 0===t&&(t=c.GeoBox.globe()),void 0===i&&(i=0),void 0===n&&(n=20),n=Math.max(i,n),void 0===s&&(s=8),new Ql(i,n,s,t,t,t.center,null,null,null,null,e.Arrays.empty,0)}}class Jl extends Yl{constructor(t,e,i,n){super(),this.root=Ql.empty(t,e,i,n),this.stem=null,this.childMap=null}updateRoot(t){const e=this.root.geoBounds,i=t.geoBounds;this.root=t,this.stem=null,i.equals(e)||this.onSetGeoBounds(i,e)}getStem(t){let e=this.stem;return null===e&&(e=this.root.getTree(t),this.stem=e),e}get childCount(){return this.root.size}get children(){const t=[];return this.root.forEach((function(e){t.push(e)}),this),t}firstChild(){const t=this.root.forEach((function(t){return t}),this);return void 0!==t?t:null}lastChild(){const t=this.root.forEachReverse((function(t){return t}),this);return void 0!==t?t:null}nextChild(t){if(t.parent===this){let e=null;const i=this.root.forEachReverse((function(i){if(i===t)return e;e=i}),this);if(void 0!==i)return i}return null}previousChild(t){if(t.parent===this){let e=null;const i=this.root.forEach((function(i){if(i===t)return e;e=i}),this);if(void 0!==i)return i}return null}forEachChild(t,e){return this.root.forEach(t,e)}insertChildMap(t){const e=t.key;if(void 0!==e){let i=this.childMap;null===i&&(i={},this.childMap=i),i[e]=t}}removeChildMap(t){const e=t.key;if(void 0!==e){const t=this.childMap;null!==t&&delete t[e]}}getChild(t,e){const i=this.childMap;if(null!==i){const n=i[t];if(void 0!==n&&(void 0===e||n instanceof e))return n}return null}setChild(t,e){if(null!==e){if(!((e=fn.fromAny(e))instanceof Yl))throw new TypeError(""+e);e.remove()}const i=this.getChild(t);return null!==i&&(this.willRemoveChild(i),i.detachParent(this),this.removeChildMap(i),this.updateRoot(this.root.removed(i,i.geoBounds)),this.onRemoveChild(i),this.didRemoveChild(i),i.setKey(void 0)),null!==e&&(e.setKey(t),this.updateRoot(this.root.inserted(e,e.geoBounds)),this.insertChildMap(e),e.attachParent(this),this.onInsertChild(e,null),this.didInsertChild(e,null),e.cascadeInsert()),i}appendChild(t,e){if(!((t=fn.fromAny(t))instanceof Yl))throw new TypeError(""+t);return t.remove(),void 0!==e&&(this.removeChild(e),t.setKey(e)),this.willInsertChild(t,null),this.updateRoot(this.root.inserted(t,t.geoBounds)),this.insertChildMap(t),t.attachParent(this),this.onInsertChild(t,null),this.didInsertChild(t,null),t.cascadeInsert(),t}prependChild(t,e){if(!((t=fn.fromAny(t))instanceof Yl))throw new TypeError(""+t);return t.remove(),void 0!==e&&(this.removeChild(e),t.setKey(e)),this.willInsertChild(t,null),this.updateRoot(this.root.inserted(t,t.geoBounds)),this.insertChildMap(t),t.attachParent(this),this.onInsertChild(t,null),this.didInsertChild(t,null),t.cascadeInsert(),t}insertChild(t,e,i){if(null!==e&&e.parent!==this)throw new TypeError(""+e);if(!((t=fn.fromAny(t))instanceof Yl))throw new TypeError(""+t);return t.remove(),void 0!==i&&(this.removeChild(i),t.setKey(i)),this.willInsertChild(t,e),this.updateRoot(this.root.inserted(t,t.geoBounds)),this.insertChildMap(t),t.attachParent(this),this.onInsertChild(t,e),this.didInsertChild(t,e),t.cascadeInsert(),t}replaceChild(t,e){if(!(e instanceof Yl))throw new TypeError(""+e);if(e.parent!==this)throw new TypeError(""+e);if(!((t=fn.fromAny(t))instanceof Yl))throw new TypeError(""+t);return t!==e&&(this.removeChild(e),this.appendChild(t)),e}removeChild(t){let e;if("string"==typeof t){if(e=this.getChild(t),null===e)return null}else if(e=t,e.parent!==this)throw new Error("not a child view");if(!(e instanceof Yl))throw new TypeError(""+e);return this.willRemoveChild(e),e.detachParent(this),this.removeChildMap(e),this.updateRoot(this.root.removed(e,e.geoBounds)),this.onRemoveChild(e),this.didRemoveChild(e),e.setKey(void 0),e}removeChildren(){this.root.forEach((function(t){this.removeChild(t)}),this)}willProject(t){super.willProject(t),this.stem=null}processChildren(t,e,i){const n=this.getStem(e.geoViewport.geoFrame);this.processTree(n,t,e,i)}processTree(t,e,i,n){null!==t.southWest&&t.southWest.geoFrame.intersects(i.geoViewport.geoFrame)&&this.processTree(t.southWest,e,i,n),null!==t.northWest&&t.northWest.geoFrame.intersects(i.geoViewport.geoFrame)&&this.processTree(t.northWest,e,i,n),null!==t.southEast&&t.southEast.geoFrame.intersects(i.geoViewport.geoFrame)&&this.processTree(t.southEast,e,i,n),null!==t.northEast&&t.northEast.geoFrame.intersects(i.geoViewport.geoFrame)&&this.processTree(t.northEast,e,i,n);const s=t.views;for(let t=0;t<s.length;t+=1){const o=s[t];n.call(this,o,e,i),0!=(o.flags&fn.RemovingFlag)&&(o.setFlags(o.flags&~fn.RemovingFlag),this.removeChild(o))}}onRender(t){super.onRender(t);const e=this.geoTreeColor.value;null!==e&&this.renderGeoTree(t,e)}renderGeoTree(t,e){const i=t.renderer;i instanceof as&&!this.isHidden()&&!this.culled&&this.renderGeoTreeOutline(this.root,t.geoViewport,i.context,e)}renderGeoTreeOutline(t,e,i,n){null!==t.southWest&&this.renderGeoTreeOutline(t.southWest,e,i,n),null!==t.northWest&&this.renderGeoTreeOutline(t.northWest,e,i,n),null!==t.southEast&&this.renderGeoTreeOutline(t.southEast,e,i,n),null!==t.northEast&&this.renderGeoTreeOutline(t.northEast,e,i,n);if(t.depth>=2){const s=(t.depth-2)/(t.maxDepth-2),o=4*(1-s)+.5*s;this.renderGeoOutline(t.geoFrame,e,i,n,o)}}displayChildren(t,e,i){const n=this.getStem(e.geoViewport.geoFrame);this.displayTree(n,t,e,i)}displayTree(t,e,i,n){null!==t.southWest&&t.southWest.geoFrame.intersects(i.geoViewport.geoFrame)&&this.displayTree(t.southWest,e,i,n),null!==t.northWest&&t.northWest.geoFrame.intersects(i.geoViewport.geoFrame)&&this.displayTree(t.northWest,e,i,n),null!==t.southEast&&t.southEast.geoFrame.intersects(i.geoViewport.geoFrame)&&this.displayTree(t.southEast,e,i,n),null!==t.northEast&&t.northEast.geoFrame.intersects(i.geoViewport.geoFrame)&&this.displayTree(t.northEast,e,i,n);const s=t.views;for(let t=0;t<s.length;t+=1){const o=s[t];n.call(this,o,e,i),0!=(o.flags&fn.RemovingFlag)&&(o.setFlags(o.flags&~fn.RemovingFlag),this.removeChild(o))}}onSetChildGeoBounds(t,e,i){this.updateRoot(this.root.moved(t,e,i))}hitTest(t,e,i){const n=i.geoViewport,s=n.unproject(t,e),o=this.getStem(n.geoFrame);return this.hitTestTree(o,t,e,s,i)}hitTestTree(t,e,i,n,s){let o=null;if(null!==t.southWest&&t.southWest.geoFrame.contains(n)&&(o=this.hitTestTree(t.southWest,e,i,n,s)),null===o&&null!==t.northWest&&t.northWest.geoFrame.contains(n)&&(o=this.hitTestTree(t.northWest,e,i,n,s)),null===o&&null!==t.southEast&&t.southEast.geoFrame.contains(n)&&(o=this.hitTestTree(t.southEast,e,i,n,s)),null===o&&null!==t.northEast&&t.northEast.geoFrame.contains(n)&&(o=this.hitTestTree(t.northEast,e,i,n,s)),null===o){const n=t.views;for(let t=0;t<n.length;t+=1){if(o=n[t].cascadeHitTest(e,i,s),null!==o)break}}return o}init(t){super.init(t),void 0!==t.geoTreeColor&&this.geoTreeColor(t.geoTreeColor)}}u([Ht({type:z,state:null})],Jl.prototype,"geoTreeColor",void 0),Object.defineProperty(Jl.prototype,"geoBounds",{get(){return this.root.geoBounds},configurable:!0});class $l extends Kl{}u([eo({traitType:_l,observesTrait:!0,willAttachTrait(t){this.owner.callObservers("controllerWillAttachGeoTrait",t,this.owner)},didAttachTrait(t){const e=t.features.traits;for(const t in e){const i=e[t];this.owner.features.addTraitController(i)}},willDetachTrait(t){const e=t.features.traits;for(const t in e){const i=e[t];this.owner.features.deleteTraitController(i)}},didDetachTrait(t){this.owner.callObservers("controllerDidDetachGeoTrait",t,this.owner)},traitWillSetGeoBounds(t,e){this.owner.callObservers("controllerWillSetGeoBounds",t,e,this.owner)},traitDidSetGeoBounds(t,e){this.owner.callObservers("controllerDidSetGeoBounds",t,e,this.owner)},traitWillAttachFeature(t,e){this.owner.features.addTraitController(t,e)},traitDidDetachFeature(t){this.owner.features.deleteTraitController(t)},viewType:Jl,willAttachView(t){this.owner.callObservers("controllerWillAttachGeoView",t,this.owner)},didAttachView(t){const e=this.owner.features.controllers;for(const i in e){const n=e[i],s=n.geo.view;null!==s&&null===s.parent&&n.geo.insertView(t)}},didDetachView(t){this.owner.callObservers("controllerDidDetachGeoView",t,this.owner)}})],$l.prototype,"geo",void 0),u([oo({type:Kl,binds:!0,observes:!0,get parentView(){return this.owner.geo.view},getTraitViewRef:t=>t.geo,willAttachController(t){this.owner.callObservers("controllerWillAttachFeature",t,this.owner)},didAttachController(t){const e=t.geo.trait;null!==e&&this.attachFeatureTrait(e,t);const i=t.geo.view;null!==i&&this.attachFeatureView(i,t)},willDetachController(t){const e=t.geo.view;null!==e&&this.detachFeatureView(e,t);const i=t.geo.trait;null!==i&&this.detachFeatureTrait(i,t)},didDetachController(t){this.owner.callObservers("controllerDidDetachFeature",t,this.owner)},controllerWillAttachGeoTrait(t,e){this.owner.callObservers("controllerWillAttachFeatureTrait",t,e,this.owner),this.attachFeatureTrait(t,e)},controllerDidDetachGeoTrait(t,e){this.detachFeatureTrait(t,e),this.owner.callObservers("controllerDidDetachFeatureTrait",t,e,this.owner)},attachFeatureTrait(t,e){},detachFeatureTrait(t,e){},controllerWillAttachGeoView(t,e){this.owner.callObservers("controllerWillAttachFeatureView",t,e,this.owner),this.attachFeatureView(t,e)},controllerDidDetachGeoView(t,e){this.detachFeatureView(t,e),this.owner.callObservers("controllerDidDetachFeatureView",t,e,this.owner)},attachFeatureView(t,e){},detachFeatureView(t,e){t.remove()},controllerWillSetGeoBounds(t,e,i){this.owner.callObservers("controllerWillSetFeatureGeoBounds",t,e,i,this.owner)},controllerDidSetGeoBounds(t,e,i){this.owner.callObservers("controllerDidSetFeatureGeoBounds",t,e,i,this.owner)},createController(t){return void 0!==t?Kl.fromTrait(t):oo.prototype.createController.call(this)}})],$l.prototype,"features",void 0);class ta extends Zl{constructor(){super(),Object.defineProperty(this,"viewBounds",{value:s.R2Box.undefined(),writable:!0,enumerable:!0,configurable:!0}),this.setFlags(this.flags|fn.UnboundedFlag)}onProject(t){super.onProject(t),this.projectRipple(t)}projectGeoCenter(t){if(this.mounted){const e=this.viewContext,i=null!==t&&t.isDefined()?e.geoViewport.project(t):null;this.viewCenter.setInterpolatedValue(this.viewCenter.value,i),this.projectRipple(e)}}projectRipple(t){if(this.viewCenter.hasAffinity(i.Affinity.Intrinsic)){const e=this.geoCenter.value,i=null!==e&&e.isDefined()?t.geoViewport.project(e):null;this.viewCenter.setValue(i)}}onRender(t){super.onRender(t);const e=t.renderer;e instanceof as&&!this.isHidden()&&!this.culled&&this.renderRipple(e.context,t.viewFrame)}renderRipple(t,e){const i=this.viewCenter.value;if(null!==i&&i.isDefined()){const n=Math.min(e.width,e.height),s=this.radius.getValue().pxValue(n),o=this.stroke.value;if(null!==o){const e=t.lineWidth,r=t.strokeStyle;t.beginPath(),t.arc(i.x,i.y,s,0,2*Math.PI);const l=this.strokeWidth.value;null!==l&&(t.lineWidth=l.pxValue(n)),t.strokeStyle=o.toString(),t.stroke(),t.lineWidth=e,t.strokeStyle=r}}}renderGeoBounds(t,e,i){}updateGeoBounds(){}updateViewBounds(){this.viewBounds=this.deriveViewBounds()}deriveViewBounds(){const t=this.viewCenter.value;return null!==t&&t.isDefined()?t.bounds:s.R2Box.undefined()}ripple(t){let n,o,r,l,a,h;n=void 0===t||void 0===t.source?null:t.source,o=void 0===t||void 0===t.center||null===t.center?null:c.GeoPoint.fromAny(t.center),r=void 0===t||void 0===t.width||null===t.width?null:s.Length.fromAny(t.width),l=void 0===t||void 0===t.radius||null===t.radius?s.Length.pct(12.5):s.Length.fromAny(t.radius),a=void 0===t||void 0===t.color||null===t.color?this.getLookOr(At.accentColor,null):t.color instanceof At?this.getLookOr(t.color,null):z.fromAny(t.color),h=void 0===t||void 0===t.timing||!0===t.timing?this.getLookOr(At.timing,Et.ambient,!1):"number"==typeof t.timing?e.Easing.linear.withDuration(t.timing):e.Timing.fromAny(t.timing);const d=void 0!==t?t.opacity:void 0;return null!==n&&this.source.setView(n),null!==o&&this.geoCenter.setState(o,i.Affinity.Intrinsic),null!==r&&this.strokeWidth.setState(r,i.Affinity.Intrinsic),this.radius.setState(l,h),null!==a&&(this.stroke.setState(void 0!==d?a.alpha(d):a),this.stroke.setState(a.alpha(0),h)),this}static ripple(t,e){if(document.hidden||t.isHidden()||t.culled||!t.geoBounds.intersects(t.geoViewport.geoFrame))return null;{const i=ta.create();i.source.setView(t);let n=t.getBase(Yl);return null===n&&(n=t),n.appendChild(i),i.ripple(e),i}}}u([i.Animator({type:c.GeoPoint,state:null,didSetState(t,e){this.owner.projectGeoCenter(t)},willSetValue(t,e){this.owner.callObservers("viewWillSetGeoCenter",t,e,this.owner)},didSetValue(t,e){this.owner.setGeoBounds(null!==t?t.bounds:c.GeoBox.undefined()),this.mounted&&this.owner.projectRipple(this.owner.viewContext),this.owner.callObservers("viewDidSetGeoCenter",t,e,this.owner)}})],ta.prototype,"geoCenter",void 0),u([i.Animator({type:s.R2Point,state:s.R2Point.undefined(),updateFlags:fn.NeedsRender,didSetValue(t,e){this.owner.updateViewBounds()}})],ta.prototype,"viewCenter",void 0),u([Ht({type:s.Length,state:s.Length.zero(),updateFlags:fn.NeedsRender,didTransition(){this.owner.source.setView(null),this.owner.remove()}})],ta.prototype,"radius",void 0),u([Ht({type:z,state:null,look:At.accentColor,inherits:!0,updateFlags:fn.NeedsRender})],ta.prototype,"stroke",void 0),u([Ht({type:s.Length,state:s.Length.px(1),inherits:!0,updateFlags:fn.NeedsRender})],ta.prototype,"strokeWidth",void 0),u([vn({observes:!0,didAttachView(t){this.owner.geoCenter.setState(t.geoBounds.center,i.Affinity.Intrinsic)},viewDidUnmount(t){this.owner.remove()},viewDidSetGeoBounds(t,e,n){this.owner.geoCenter.setState(t.center,i.Affinity.Intrinsic)}})],ta.prototype,"source",void 0);class ea extends Zl{constructor(){super(),this.canvas=this.createCanvas(),Object.defineProperty(this,"renderer",{value:this.createRenderer(),writable:!0,enumerable:!0,configurable:!0}),this.ownRasterFrame=null}get pixelRatio(){return window.devicePixelRatio||1}get compositor(){const t=this.parent;return t instanceof ns?t.renderer:null}setRenderer(t){"string"==typeof t&&(t=this.createRenderer(t)),this.renderer=t,this.requireUpdate(fn.NeedsRender|fn.NeedsComposite)}createRenderer(t="canvas"){if("canvas"===t){const t=this.canvas.getContext("2d");if(null!==t)return new cs(t,s.Transform.identity(),this.pixelRatio);throw new Error("Failed to create canvas rendering context")}if("webgl"===t){const t=this.canvas.getContext("webgl");if(null!==t)return new us(t,this.pixelRatio);throw new Error("Failed to create webgl rendering context")}throw new Error("Failed to create "+t+" renderer")}needsUpdate(t,e){const i=(t=super.needsUpdate(t,e))&(fn.NeedsRender|fn.NeedsComposite);return 0!==i&&(t|=fn.NeedsComposite,this.setFlags(this.flags|fn.NeedsDisplay|fn.NeedsComposite|i)),t}needsProcess(t,e){return 0==(this.flags&fn.ProcessMask)&&0==(t&(fn.NeedsResize|fn.NeedsProject))&&(t=0),t}onResize(t){super.onResize(t),this.requireUpdate(fn.NeedsRender|fn.NeedsComposite)}onProject(t){super.onProject(t),this.projectRaster(t)}projectGeoAnchor(t){if(this.mounted){const e=this.viewContext,i=null!==t&&t.isDefined()?e.geoViewport.project(t):null;this.viewAnchor.setInterpolatedValue(this.viewAnchor.value,i),this.projectRaster(e)}}projectRaster(t){let e;if(this.viewAnchor.hasAffinity(i.Affinity.Intrinsic)){const i=this.geoAnchor.value;e=null!==i&&i.isDefined()?t.geoViewport.project(i):null,this.viewAnchor.setValue(e)}else e=this.viewAnchor.value;if(null!==e){const i=t.viewFrame,n=i.width,o=i.height,r=Math.min(n,o);let l=this.width.value;l=l instanceof s.Length?l.pxValue(r):n;let a=this.height.value;a=a instanceof s.Length?a.pxValue(r):o;const h=e.x-l*this.xAlign.getValue(),d=e.y-a*this.yAlign.getValue(),c=new s.R2Box(h,d,h+l,d+a);this.setRasterFrame(c),this.setViewFrame(c),this.setCulled(!i.intersects(c))}else this.setCulled(!this.viewFrame.intersects(this.rasterFrame))}needsDisplay(t,e){return 0!=(this.flags&fn.DisplayMask)?t|=fn.NeedsComposite:t=0!=(t&fn.NeedsComposite)?fn.NeedsDisplay|fn.NeedsComposite:0,t}onRender(t){const e=this.rasterFrame;this.resizeCanvas(this.canvas,e),this.resetRenderer(e),this.clearCanvas(e),super.onRender(t)}didComposite(t){this.compositeImage(t),super.didComposite(t)}onSetHidden(t){t||this.requireUpdate(fn.NeedsRender|fn.NeedsComposite)}extendViewContext(t){const e=Object.create(t);return e.compositor=t.renderer,e.renderer=this.renderer,e}get rasterFrame(){let t=this.ownRasterFrame;return null===t&&(t=this.deriveRasterFrame()),t}setRasterFrame(t){this.ownRasterFrame=t}deriveRasterFrame(){return this.deriveViewBounds()}createCanvas(){return document.createElement("canvas")}resizeCanvas(t,e){const i=this.pixelRatio,n=e.width,s=e.height,o=n*i,r=s*i,l=t.width,a=t.height;o===l&&r===a||(t.width=o,t.height=r,t.style.width=n+"px",t.style.height=s+"px")}clearCanvas(t){const e=this.renderer;if(e instanceof cs)e.context.clearRect(0,0,t.xMax,t.yMax);else if(e instanceof us){const t=e.context;t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT)}}resetRenderer(t){const e=this.renderer;if(e instanceof cs){const i=this.pixelRatio,n=t.xMin*i,o=t.yMin*i;e.context.setTransform(i,0,0,i,-n,-o),e.setTransform(s.Transform.affine(i,0,0,i,-n,-o))}else e instanceof us&&e.context.viewport(t.x,t.y,t.xMax,t.yMax)}compositeImage(t){const e=t.compositor;if(e instanceof cs){const t=e.context,i=this.rasterFrame,n=this.canvas;if(i.isDefined()&&0!==i.width&&0!==i.height&&0!==n.width&&0!==n.height){const e=t.globalAlpha,s=t.globalCompositeOperation;t.globalAlpha=this.opacity.getValue(),t.globalCompositeOperation=this.compositeOperation.getValue(),t.drawImage(n,i.x,i.y,i.width,i.height),t.globalAlpha=e,t.globalCompositeOperation=s}}}ripple(t){return ta.ripple(this,t)}init(t){super.init(t),void 0!==t.geoAnchor&&this.geoAnchor(t.geoAnchor),void 0!==t.viewAnchor&&this.viewAnchor(t.viewAnchor),void 0!==t.xAlign&&this.xAlign(t.xAlign),void 0!==t.yAlign&&this.yAlign(t.yAlign),void 0!==t.width&&this.width(t.width),void 0!==t.height&&this.height(t.height),void 0!==t.opacity&&this.opacity(t.opacity),void 0!==t.compositeOperation&&this.compositeOperation(t.compositeOperation)}}ea.MountFlags=Zl.MountFlags|fn.NeedsRender|fn.NeedsComposite,ea.UncullFlags=Zl.UncullFlags|fn.NeedsRender|fn.NeedsComposite,u([i.Animator({type:c.GeoPoint,state:null,didSetState(t,e){this.owner.projectGeoAnchor(t)},willSetValue(t,e){this.owner.callObservers("viewWillSetGeoAnchor",t,e,this.owner)},didSetValue(t,e){this.owner.setGeoBounds(null!==t?t.bounds:c.GeoBox.undefined()),this.mounted&&this.owner.projectRaster(this.owner.viewContext),this.owner.callObservers("viewDidSetGeoAnchor",t,e,this.owner)}})],ea.prototype,"geoAnchor",void 0),u([i.Animator({type:s.R2Point,state:s.R2Point.undefined()})],ea.prototype,"viewAnchor",void 0),u([i.Animator({type:Number,state:.5,updateFlags:fn.NeedsComposite})],ea.prototype,"xAlign",void 0),u([i.Animator({type:Number,state:.5,updateFlags:fn.NeedsComposite})],ea.prototype,"yAlign",void 0),u([Ht({type:s.Length,state:null,updateFlags:fn.NeedsResize|fn.NeedsLayout|fn.NeedsRender|fn.NeedsComposite})],ea.prototype,"width",void 0),u([Ht({type:s.Length,state:null,updateFlags:fn.NeedsResize|fn.NeedsLayout|fn.NeedsRender|fn.NeedsComposite})],ea.prototype,"height",void 0),u([Ht({type:Number,state:1,updateFlags:fn.NeedsComposite})],ea.prototype,"opacity",void 0),u([i.Animator({type:String,state:"source-over",updateFlags:fn.NeedsComposite})],ea.prototype,"compositeOperation",void 0);class ia extends Zl{constructor(t){super(),this.geoTile=t,Object.defineProperty(this,"geoBounds",{value:t.bounds,writable:!0,enumerable:!0,configurable:!0})}setGeoBounds(t){}updateGeoBounds(){}}class na extends _l{constructor(t){super(),this.geoTile=t,this.geoBounds=t.bounds}setGeoBounds(t){}createTileTrait(t){return new na(t)}createTileModel(t){const e=this.createTileTrait(t);if(null!==e){const t=new m;return t.setTrait("tile",e),t}return null}initTiles(){let t=this.getChild("southWest");null===t&&(t=this.createTileModel(this.geoTile.southWestTile),null!==t&&this.setChild("southWest",t));let e=this.getChild("northWest");null===e&&(e=this.createTileModel(this.geoTile.northWestTile),null!==e&&this.setChild("northWest",e));let i=this.getChild("southEast");null===i&&(i=this.createTileModel(this.geoTile.southEastTile),null!==i&&this.setChild("southEast",i));let n=this.getChild("northEast");null===n&&(n=this.createTileModel(this.geoTile.northEastTile),null!==n&&this.setChild("northEast",n))}onStartConsuming(){super.onStartConsuming(),this.initTiles()}}u([T({extends:!0,detectModel(t){const e=t.getTrait(Xl);return e instanceof na?null:e}})],na.prototype,"features",void 0),u([T({type:na,binds:!0,willAttachTrait(t){this.owner.callObservers("traitWillAttachTile",t,this.owner)},didDetachTrait(t){this.owner.callObservers("traitDidDetachTile",t,this.owner)},detectModel:t=>t.getTrait(na),detectTrait:t=>null})],na.prototype,"tiles",void 0);class sa extends $l{constructor(t){super(),this.geoTile=t}get minCullZoom(){return this.geoTile.z}get maxCullZoom(){return 1/0}autoCullGeoView(t,e){const i=this.minCullZoom<=t.zoom&&t.zoom<this.maxCullZoom&&t.geoFrame.intersects(e.geoBounds);e.setCulled(!i)}get minConsumeZoom(){return this.geoTile.z}get maxConsumeZoom(){return 1/0}autoConsumeGeoView(t,e){const i=this.geo.trait;if(null!==i){this.minConsumeZoom<=t.zoom&&t.zoom<this.maxConsumeZoom&&t.geoFrame.intersects(e.geoBounds)?i.consume(this):i.unconsume(this)}}}u([eo({extends:!0,traitType:na,observesTrait:!0,didAttachTrait(t,e){const i=t.tiles.traits;for(const t in i){const e=i[t];this.owner.tiles.addTraitController(e)}const n=this.view;null===n||n.culled||t.consume(this.owner),$l.geo.prototype.didAttachTrait.call(this,t,e)},willDetachTrait(t){$l.geo.prototype.willDetachTrait.call(this,t),t.unconsume(this.owner);const e=t.tiles.traits;for(const t in e){const i=e[t];this.owner.tiles.deleteTraitController(i)}},traitWillAttachTile(t,e){this.owner.tiles.addTraitController(t,e)},traitDidDetachTile(t){this.owner.tiles.deleteTraitController(t)},viewType:ia,observesView:!0,didAttachView(t,e){$l.geo.prototype.didAttachView.call(this,t,e),t.setCulled(!0);const i=this.owner.tiles.controllers;for(const e in i){const n=i[e],s=n.geo.view;null!==s&&null===s.parent&&n.geo.insertView(t)}},viewDidProject(t,e){this.owner.autoCullGeoView(t.geoViewport,e),this.owner.autoConsumeGeoView(t.geoViewport,e)},createView(){return new ia(this.owner.geoTile)}})],sa.prototype,"geo",void 0),u([oo({extends:!0,detectController:t=>t instanceof Kl&&!(t instanceof sa)?t:null})],sa.prototype,"features",void 0),u([oo({type:sa,binds:!0,observes:!0,get parentView(){return this.owner.geo.view},getTraitViewRef:t=>t.geo,willAttachController(t){this.owner.callObservers("controllerWillAttachTile",t,this.owner)},didAttachController(t){const e=t.geo.trait;null!==e&&this.attachTileTrait(e,t);const i=t.geo.view;null!==i&&this.attachTileView(i,t)},willDetachController(t){const e=t.geo.view;null!==e&&this.detachTileView(e,t);const i=t.geo.trait;null!==i&&this.detachTileTrait(i,t)},didDetachController(t){this.owner.callObservers("controllerDidDetachTile",t,this.owner)},controllerWillAttachGeoTrait(t,e){this.owner.callObservers("controllerWillAttachTileTrait",t,e,this.owner),this.attachTileTrait(t,e)},controllerDidDetachGeoTrait(t,e){this.detachTileTrait(t,e),this.owner.callObservers("controllerDidDetachTileTrait",t,e,this.owner)},attachTileTrait(t,e){},detachTileTrait(t,e){},controllerWillAttachGeoView(t,e){this.owner.callObservers("controllerWillAttachTileView",t,e,this.owner),this.attachTileView(t,e)},controllerDidDetachGeoView(t,e){this.detachTileView(t,e),this.owner.callObservers("controllerDidDetachTileView",t,e,this.owner)},attachTileView(t,e){},detachTileView(t,e){t.remove()},createController(t){return void 0!==t?new sa(t.geoTile):oo.prototype.createController.call(this)}})],sa.prototype,"tiles",void 0);class oa extends Zl{constructor(){super(),Object.defineProperty(this,"viewBounds",{value:s.R2Box.undefined(),writable:!0,enumerable:!0,configurable:!0})}onProject(t){super.onProject(t),this.projectCircle(t)}projectGeoCenter(t){if(this.mounted){const e=this.viewContext,i=null!==t&&t.isDefined()?e.geoViewport.project(t):null;this.viewCenter.setInterpolatedValue(this.viewCenter.value,i),this.projectCircle(e)}}projectCircle(t){if(i.Affinity.Intrinsic>=this.viewCenter.affinity){const e=this.geoCenter.value,i=null!==e&&e.isDefined()?t.geoViewport.project(e):null;this.viewCenter.value=i}const e=t.viewFrame,n=Math.min(e.width,e.height),o=this.radius.getValue().pxValue(n),r=this.viewCenter.value,l=this.viewCenter.state;null!==r&&null!==l&&(e.intersectsCircle(new s.R2Circle(r.x,r.y,o))||e.intersectsSegment(new s.R2Segment(r.x,r.y,l.x,l.y)))?this.setCulled(!1):this.setCulled(!0)}onRender(t){super.onRender(t);const e=t.renderer;e instanceof as&&!this.isHidden()&&!this.culled&&this.renderCircle(e.context,t.viewFrame)}renderCircle(t,e){const i=this.viewCenter.value;if(null!==i&&i.isDefined()){const n=t.fillStyle,s=t.lineWidth,o=t.strokeStyle,r=Math.min(e.width,e.height),l=this.radius.getValue().pxValue(r);t.beginPath(),t.arc(i.x,i.y,l,0,2*Math.PI);const a=this.fill.value;null!==a&&(t.fillStyle=a.toString(),t.fill());const h=this.stroke.value;if(null!==h){const e=this.strokeWidth.value;null!==e&&(t.lineWidth=e.pxValue(r)),t.strokeStyle=h.toString(),t.stroke()}t.fillStyle=n,t.lineWidth=s,t.strokeStyle=o}}renderGeoBounds(t,e,i){}updateGeoBounds(){}deriveViewBounds(){const t=this.viewCenter.value;if(null!==t&&t.isDefined()){const e=this.viewContext.viewFrame,i=Math.min(e.width,e.height),n=this.radius.getValue().pxValue(i);return new s.R2Box(t.x-n,t.y-n,t.x+n,t.y+n)}return s.R2Box.undefined()}get popoverFrame(){const t=this.viewCenter.value;if(null!==t&&t.isDefined()){const e=this.viewContext.viewFrame,i=Math.min(e.width,e.height),n=this.pageTransform.inverse(),o=n.transformX(t.x,t.y),r=n.transformY(t.x,t.y),l=this.radius.getValue().pxValue(i);return new s.R2Box(o-l,r-l,o+l,r+l)}return this.pageBounds}get hitBounds(){const t=this.viewCenter.value;if(null!==t&&t.isDefined()){const e=this.viewContext.viewFrame,i=Math.min(e.width,e.height),n=this.radius.getValue().pxValue(i),o=Math.max(this.hitRadius.getStateOr(n),n);return new s.R2Box(t.x-o,t.y-o,t.x+o,t.y+o)}return this.viewBounds}hitTest(t,e,i){const n=i.renderer;return n instanceof cs?this.hitTestCircle(t,e,n.context,i.viewFrame,n.transform):null}hitTestCircle(t,e,i,n,s){const o=this.viewCenter.value;if(null!==o&&o.isDefined()){const r=Math.min(n.width,n.height),l=this.radius.getValue().pxValue(r);if(null!==this.fill.value){const i=Math.max(this.hitRadius.getStateOr(l),l),n=o.x-t,s=o.y-e;if(n*n+s*s<i*i)return this}const a=this.strokeWidth.value;if(null!==this.stroke.value&&null!==a){const n=i.lineWidth,h=s.transform(t,e);i.beginPath(),i.arc(o.x,o.y,l,0,2*Math.PI),i.lineWidth=a.pxValue(r);const d=i.isPointInStroke(h.x,h.y);if(i.lineWidth=n,d)return this}}return null}ripple(t){return ta.ripple(this,t)}init(t){super.init(t),void 0!==t.geoCenter&&this.geoCenter(t.geoCenter),void 0!==t.viewCenter&&this.viewCenter(t.viewCenter),void 0!==t.radius&&this.radius(t.radius),void 0!==t.hitRadius&&this.hitRadius(t.hitRadius),void 0!==t.fill&&this.fill(t.fill),void 0!==t.stroke&&this.stroke(t.stroke),void 0!==t.strokeWidth&&this.strokeWidth(t.strokeWidth)}}u([i.Animator({type:c.GeoPoint,state:null,didSetState(t,e){this.owner.projectGeoCenter(t)},willSetValue(t,e){this.owner.callObservers("viewWillSetGeoCenter",t,e,this.owner)},didSetValue(t,e){this.owner.setGeoBounds(null!==t?t.bounds:c.GeoBox.undefined()),this.mounted&&this.owner.projectCircle(this.owner.viewContext),this.owner.callObservers("viewDidSetGeoCenter",t,e,this.owner)}})],oa.prototype,"geoCenter",void 0),u([i.Animator({type:s.R2Point,state:s.R2Point.undefined(),updateFlags:fn.NeedsRender})],oa.prototype,"viewCenter",void 0),u([Ht({type:s.Length,state:s.Length.zero(),updateFlags:fn.NeedsRender})],oa.prototype,"radius",void 0),u([Ht({type:z,state:null,inherits:!0,updateFlags:fn.NeedsRender})],oa.prototype,"fill",void 0),u([Ht({type:z,state:null,inherits:!0,updateFlags:fn.NeedsRender})],oa.prototype,"stroke",void 0),u([Ht({type:s.Length,state:null,inherits:!0,updateFlags:fn.NeedsRender})],oa.prototype,"strokeWidth",void 0),u([i.Property({type:Number})],oa.prototype,"hitRadius",void 0);class ra extends Zl{constructor(){super(),Object.defineProperty(this,"viewBounds",{value:s.R2Box.undefined(),writable:!0,enumerable:!0,configurable:!0})}get value(){const t=this.viewCenter.value;return null!==t&&t.isDefined()?new ms(t,this.innerRadius.value,this.outerRadius.value,this.startAngle.value,this.sweepAngle.value,this.padAngle.value,this.padRadius.value,this.cornerRadius.value):null}get state(){const t=this.viewCenter.state;return null!==t&&t.isDefined()?new ms(t,this.innerRadius.state,this.outerRadius.state,this.startAngle.state,this.sweepAngle.state,this.padAngle.state,this.padRadius.state,this.cornerRadius.state):null}onProject(t){super.onProject(t),this.projectArc(t)}projectGeoCenter(t){if(this.mounted){const e=this.viewContext,i=null!==t&&t.isDefined()?e.geoViewport.project(t):null;this.viewCenter.setInterpolatedValue(this.viewCenter.value,i),this.projectArc(e)}}projectArc(t){if(i.Affinity.Intrinsic>=this.viewCenter.affinity){const e=this.geoCenter.value,i=null!==e&&e.isDefined()?t.geoViewport.project(e):null;this.viewCenter.value=i}const e=t.viewFrame,n=Math.min(e.width,e.height),o=this.outerRadius.getValue().pxValue(n),r=this.viewCenter.value,l=this.viewCenter.state;null!==r&&null!==l&&(e.intersectsCircle(new s.R2Circle(r.x,r.y,o))||e.intersectsSegment(new s.R2Segment(r.x,r.y,l.x,l.y)))?this.setCulled(!1):this.setCulled(!0)}onRender(t){super.onRender(t);const e=t.renderer;e instanceof as&&!this.isHidden()&&!this.culled&&this.renderArc(e.context,t.viewFrame)}renderArc(t,e){const i=this.value;if(null!==i&&e.isDefined()){const n=t.fillStyle,s=t.lineWidth,o=t.strokeStyle;t.beginPath(),i.draw(t,e);const r=this.fill.value;null!==r&&(t.fillStyle=r.toString(),t.fill());const l=this.stroke.value;if(null!==l){const i=this.strokeWidth.value;if(null!==i){const n=Math.min(e.width,e.height);t.lineWidth=i.pxValue(n)}t.strokeStyle=l.toString(),t.stroke()}t.fillStyle=n,t.lineWidth=s,t.strokeStyle=o}}renderGeoBounds(t,e,i){}updateGeoBounds(){}deriveViewBounds(){const t=this.viewCenter.value;if(null!==t&&t.isDefined()){const e=this.viewContext.viewFrame,i=Math.min(e.width,e.height),n=this.outerRadius.getValue().pxValue(i);return new s.R2Box(t.x-n,t.y-n,t.x+n,t.y+n)}return s.R2Box.undefined()}get popoverFrame(){const t=this.viewCenter.value;if(null!==t&&t.isDefined()){const e=this.viewContext.viewFrame,i=Math.min(e.width,e.height),n=this.pageTransform.inverse(),o=n.transformX(t.x,t.y),r=n.transformY(t.x,t.y),l=(this.innerRadius.getValue().pxValue(i)+this.outerRadius.getValue().pxValue(i))/2,a=this.startAngle.getValue().radValue()+this.sweepAngle.getValue().radValue()/2,h=o+l*Math.cos(a),d=r+l*Math.sin(a);return new s.R2Box(h,d,h,d)}return this.pageBounds}hitTest(t,e,i){const n=i.renderer;if(n instanceof cs){const s=n.transform.transform(t,e);return this.hitTestArc(s.x,s.y,n.context,i.viewFrame)}return null}hitTestArc(t,e,i,n){const s=this.value;if(null!==s){if(i.beginPath(),s.draw(i,n),null!==this.fill.value&&i.isPointInPath(t,e))return this;if(void 0!==this.stroke.value){const s=this.strokeWidth.value;if(null!==s){const o=i.lineWidth,r=Math.min(n.width,n.height);i.lineWidth=s.pxValue(r);const l=i.isPointInStroke(t,e);if(i.lineWidth=o,l)return this}}}return null}ripple(t){return ta.ripple(this,t)}init(t){super.init(t),void 0!==t.geoCenter&&this.geoCenter(t.geoCenter),void 0!==t.viewCenter&&this.viewCenter(t.viewCenter),void 0!==t.innerRadius&&this.innerRadius(t.innerRadius),void 0!==t.outerRadius&&this.outerRadius(t.outerRadius),void 0!==t.startAngle&&this.startAngle(t.startAngle),void 0!==t.sweepAngle&&this.sweepAngle(t.sweepAngle),void 0!==t.padAngle&&this.padAngle(t.padAngle),void 0!==t.padRadius&&this.padRadius(t.padRadius),void 0!==t.cornerRadius&&this.cornerRadius(t.cornerRadius),void 0!==t.fill&&this.fill(t.fill),void 0!==t.stroke&&this.stroke(t.stroke),void 0!==t.strokeWidth&&this.strokeWidth(t.strokeWidth)}}u([i.Animator({type:c.GeoPoint,state:null,didSetState(t,e){this.owner.projectGeoCenter(t)},willSetValue(t,e){this.owner.callObservers("viewWillSetGeoCenter",t,e,this.owner)},didSetValue(t,e){this.owner.setGeoBounds(null!==t?t.bounds:c.GeoBox.undefined()),this.mounted&&this.owner.projectArc(this.owner.viewContext),this.owner.callObservers("viewDidSetGeoCenter",t,e,this.owner)}})],ra.prototype,"geoCenter",void 0),u([i.Animator({type:s.R2Point,state:s.R2Point.undefined(),updateFlags:fn.NeedsRender})],ra.prototype,"viewCenter",void 0),u([Ht({type:s.Length,state:s.Length.zero(),updateFlags:fn.NeedsRender})],ra.prototype,"innerRadius",void 0),u([Ht({type:s.Length,state:s.Length.zero(),updateFlags:fn.NeedsRender})],ra.prototype,"outerRadius",void 0),u([Ht({type:s.Angle,state:s.Angle.zero(),updateFlags:fn.NeedsRender})],ra.prototype,"startAngle",void 0),u([Ht({type:s.Angle,state:s.Angle.zero(),updateFlags:fn.NeedsRender})],ra.prototype,"sweepAngle",void 0),u([Ht({type:s.Angle,state:s.Angle.zero(),updateFlags:fn.NeedsRender})],ra.prototype,"padAngle",void 0),u([Ht({type:s.Length,state:null,updateFlags:fn.NeedsRender})],ra.prototype,"padRadius",void 0),u([Ht({type:s.Length,state:s.Length.zero(),updateFlags:fn.NeedsRender})],ra.prototype,"cornerRadius",void 0),u([Ht({type:z,state:null,inherits:!0,updateFlags:fn.NeedsRender})],ra.prototype,"fill",void 0),u([Ht({type:z,state:null,inherits:!0,updateFlags:fn.NeedsRender})],ra.prototype,"stroke",void 0),u([Ht({type:s.Length,state:null,inherits:!0,updateFlags:fn.NeedsRender})],ra.prototype,"strokeWidth",void 0);class la extends Zl{constructor(){super(),Object.defineProperty(this,"viewBounds",{value:s.R2Box.undefined(),writable:!0,enumerable:!0,configurable:!0})}onProject(t){super.onProject(t),this.projectPath(t)}projectPath(t){const e=t.geoViewport;let n;if(this.viewPath.hasAffinity(i.Affinity.Intrinsic)){const t=this.geoPath.value;n=null!==t&&t.isDefined()?t.project(e):null,this.viewPath.setState(n,i.Affinity.Intrinsic)}else n=this.viewPath.value;if(this.viewCentroid.hasAffinity(i.Affinity.Intrinsic)){const t=this.geoCentroid.value,n=null!==t&&t.isDefined()?e.project(t):null;this.viewCentroid.setState(n,i.Affinity.Intrinsic)}this.viewBounds=null!==n?n.bounds:t.viewFrame,this.cullGeoFrame(t.geoViewport.geoFrame)}updateGeoBounds(){}get popoverFrame(){const t=this.pageTransform.inverse(),e=this.viewCentroid.value;if(null!==e&&e.isDefined()){const i=t.transformX(e.x,e.y),n=t.transformY(e.x,e.y);return new s.R2Box(i,n,i,n)}return this.viewBounds.transform(t)}ripple(t){return ta.ripple(this,t)}init(t){super.init(t),void 0!==t.geoPath&&this.geoPath(t.geoPath)}}u([i.Animator({type:c.GeoPath,state:null,willSetValue(t,e){this.owner.callObservers("viewWillSetGeoPath",t,e,this.owner)},didSetValue(t,e){this.owner.setGeoBounds(null!==t?t.bounds:c.GeoBox.undefined()),this.mounted&&this.owner.projectPath(this.owner.viewContext),this.owner.callObservers("viewDidSetGeoPath",t,e,this.owner)}})],la.prototype,"geoPath",void 0),u([i.Animator({type:s.R2Path,state:null})],la.prototype,"viewPath",void 0),u([i.Animator({type:c.GeoPoint,state:null})],la.prototype,"geoCentroid",void 0),u([i.Animator({type:s.R2Point,state:null})],la.prototype,"viewCentroid",void 0);class aa extends la{onRender(t){super.onRender(t);const e=t.renderer;e instanceof as&&!this.isHidden()&&!this.culled&&this.renderLine(e.context,t.viewFrame)}renderLine(t,e){const i=this.viewPath.value;if(null!==i&&i.isDefined()){const n=this.stroke.value,s=this.strokeWidth.value;if(null!==n&&null!==s){const o=t.lineWidth,r=t.strokeStyle;t.beginPath(),i.draw(t);const l=Math.min(e.width,e.height);t.lineWidth=s.pxValue(l),t.strokeStyle=n.toString(),t.stroke(),t.lineWidth=o,t.strokeStyle=r}}}hitTest(t,e,i){const n=i.renderer;if(n instanceof cs){const s=n.transform.transform(t,e);return this.hitTestLine(s.x,s.y,n.context,i.viewFrame)}return null}hitTestLine(t,e,i,n){const s=this.viewPath.value;if(null!==s&&s.isDefined()&&null!==this.stroke.value){const o=i.lineWidth;i.beginPath(),s.draw(i);let r=this.hitWidth.getStateOr(0);const l=this.strokeWidth.value;if(null!==l){const t=Math.min(n.width,n.height);r=Math.max(r,l.pxValue(t))}i.lineWidth=r;const a=i.isPointInStroke(t,e);if(i.lineWidth=o,a)return this}return null}init(t){super.init(t),void 0!==t.stroke&&this.stroke(t.stroke),void 0!==t.strokeWidth&&this.strokeWidth(t.strokeWidth),void 0!==t.hitWidth&&this.hitWidth(t.hitWidth)}}u([Ht({type:z,state:null,inherits:!0,updateFlags:fn.NeedsRender,willSetValue(t,e){this.owner.callObservers("viewWillSetStroke",t,e,this.owner)},didSetValue(t,e){this.owner.callObservers("viewDidSetStroke",t,e,this.owner)}})],aa.prototype,"stroke",void 0),u([Ht({type:s.Length,state:null,inherits:!0,updateFlags:fn.NeedsRender,willSetValue(t,e){this.owner.callObservers("viewWillSetStrokeWidth",t,e,this.owner)},didSetValue(t,e){this.owner.callObservers("viewDidSetStrokeWidth",t,e,this.owner)}})],aa.prototype,"strokeWidth",void 0),u([i.Property({type:Number})],aa.prototype,"hitWidth",void 0);class ha extends la{cullGeoFrame(t=this.geoFrame){let e;if(t.intersects(this.geoBounds)){const t=this.viewContext.viewFrame,i=this.viewBounds;e=!(!this.clipViewport.state||t.xMin-4*t.width<=i.xMin&&i.xMax<=t.xMax+4*t.width&&t.yMin-4*t.height<=i.yMin&&i.yMax<=t.yMax+4*t.height)||!t.intersects(i)}else e=!0;this.setCulled(e)}onRender(t){super.onRender(t);const e=t.renderer;e instanceof as&&!this.isHidden()&&!this.culled&&this.renderArea(e.context,t.viewFrame)}renderArea(t,e){const i=this.viewPath.value;if(null!==i&&i.isDefined()){const n=t.fillStyle,s=t.lineWidth,o=t.strokeStyle;t.beginPath(),i.draw(t);const r=this.fill.value;null!==r&&(t.fillStyle=r.toString(),t.fill());const l=this.stroke.value,a=this.strokeWidth.value;if(null!==l&&null!==a){const i=Math.min(e.width,e.height);t.lineWidth=a.pxValue(i),t.strokeStyle=l.toString(),t.stroke()}t.fillStyle=n,t.lineWidth=s,t.strokeStyle=o}}hitTest(t,e,i){const n=i.renderer;if(n instanceof cs){const s=n.transform.transform(t,e);return this.hitTestArea(s.x,s.y,n.context,i.viewFrame)}return null}hitTestArea(t,e,i,n){const s=this.viewPath.value;if(null!==s&&s.isDefined()){if(i.beginPath(),s.draw(i),null!==this.fill.value&&i.isPointInPath(t,e))return this;if(null!==this.stroke.value){const s=this.strokeWidth.value;if(null!==s){const o=i.lineWidth,r=Math.min(n.width,n.height);i.lineWidth=s.pxValue(r);const l=i.isPointInStroke(t,e);if(i.lineWidth=o,l)return this}}}return null}init(t){super.init(t),void 0!==t.fill&&this.fill(t.fill),void 0!==t.stroke&&this.stroke(t.stroke),void 0!==t.strokeWidth&&this.strokeWidth(t.strokeWidth),void 0!==t.clipViewport&&this.clipViewport(t.clipViewport)}}u([Ht({type:z,state:null,inherits:!0,updateFlags:fn.NeedsRender,willSetValue(t,e){this.owner.callObservers("viewWillSetFill",t,e,this.owner)},didSetValue(t,e){this.owner.callObservers("viewDidSetFill",t,e,this.owner)}})],ha.prototype,"fill",void 0),u([Ht({type:z,state:null,inherits:!0,updateFlags:fn.NeedsRender,willSetValue(t,e){this.owner.callObservers("viewWillSetStroke",t,e,this.owner)},didSetValue(t,e){this.owner.callObservers("viewDidSetStroke",t,e,this.owner)}})],ha.prototype,"stroke",void 0),u([Ht({type:s.Length,state:null,inherits:!0,updateFlags:fn.NeedsRender,willSetValue(t,e){this.owner.callObservers("viewWillSetStrokeWidth",t,e,this.owner)},didSetValue(t,e){this.owner.callObservers("viewDidSetStrokeWidth",t,e,this.owner)}})],ha.prototype,"strokeWidth",void 0),u([i.Property({type:Boolean,state:!0})],ha.prototype,"clipViewport",void 0);class da extends Xl{get geoBounds(){const t=this.geoPath.state;return null!==t?t.bounds:c.GeoBox.undefined()}}u([i.Property({type:c.GeoPath,state:null,willSetState(t,e){this.owner.callObservers("traitWillSetGeoPath",t,e,this.owner)},didSetState(t,e){this.owner.callObservers("traitDidSetGeoPath",t,e,this.owner)}})],da.prototype,"geoPath",void 0);class ca extends da{}u([i.Property({state:null,willSetState(t,e){this.owner.callObservers("traitWillSetStroke",t,e,this.owner)},didSetState(t,e){this.owner.callObservers("traitDidSetStroke",t,e,this.owner)},fromAny:t=>(null===t||t instanceof At||(t=z.fromAny(t)),t)})],ca.prototype,"stroke",void 0),u([i.Property({type:s.Length,state:null,willSetState(t,e){this.owner.callObservers("traitWillSetStrokeWidth",t,e,this.owner)},didSetState(t,e){this.owner.callObservers("traitDidSetStrokeWidth",t,e,this.owner)}})],ca.prototype,"strokeWidth",void 0);class ua extends da{}u([i.Property({state:null,willSetState(t,e){this.owner.callObservers("traitWillSetFill",t,e,this.owner)},didSetState(t,e){this.owner.callObservers("traitDidSetFill",t,e,this.owner)},fromAny:t=>(null===t||t instanceof At||(t=z.fromAny(t)),t)})],ua.prototype,"fill",void 0),u([i.Property({state:null,willSetState(t,e){this.owner.callObservers("traitWillSetStroke",t,e,this.owner)},didSetState(t,e){this.owner.callObservers("traitDidSetStroke",t,e,this.owner)},fromAny:t=>(null===t||t instanceof At||(t=z.fromAny(t)),t)})],ua.prototype,"stroke",void 0),u([i.Property({type:s.Length,state:null,willSetState(t,e){this.owner.callObservers("traitWillSetStrokeWidth",t,e,this.owner)},didSetState(t,e){this.owner.callObservers("traitDidSetStrokeWidth",t,e,this.owner)}})],ua.prototype,"strokeWidth",void 0);class pa extends Kl{}class fa extends pa{setGeoPath(t,n,s){const o=this.geo.view;null!==o&&(void 0===s||!0===s?!0===(s=this.geoTiming.state)&&(s=o.getLook(At.timing,Et.ambient)):s=e.Timing.fromAny(s),o.geoPath.setState(t,s,i.Affinity.Intrinsic))}setStroke(t,n,s){const o=this.geo.view;null!==o&&(void 0===s||!0===s?!0===(s=this.geoTiming.state)&&(s=o.getLook(At.timing,Et.ambient)):s=e.Timing.fromAny(s),t instanceof At?o.stroke.setLook(t,s,i.Affinity.Intrinsic):o.stroke.setState(t,s,i.Affinity.Intrinsic))}setStrokeWidth(t,n,s){const o=this.geo.view;null!==o&&(void 0===s||!0===s?!0===(s=this.geoTiming.state)&&(s=o.getLook(At.timing,Et.ambient)):s=e.Timing.fromAny(s),o.strokeWidth.setState(t,s,i.Affinity.Intrinsic))}}u([eo({traitType:ca,observesTrait:!0,willAttachTrait(t){this.owner.callObservers("controllerWillAttachGeoTrait",t,this.owner)},didAttachTrait(t){if(null!==this.view){this.owner.setGeoPath(t.geoPath.state,t);const e=t.stroke.state;null!==e&&this.owner.setStroke(e,t);const i=t.strokeWidth.state;null!==i&&this.owner.setStrokeWidth(i,t)}},didDetachTrait(t){this.owner.callObservers("controllerDidDetachGeoTrait",t,this.owner)},traitDidSetGeoPath(t,e,i){this.owner.setGeoPath(t,i)},traitDidSetStroke(t,e,i){this.owner.setStroke(t,i)},traitDidSetStrokeWidth(t,e,i){this.owner.setStrokeWidth(t,i)},viewType:aa,observesView:!0,willAttachView(t){this.owner.callObservers("controllerWillAttachGeoView",t,this.owner)},didAttachView(t){const e=this.trait;if(null!==e){this.owner.setGeoPath(e.geoPath.state,e);const t=e.stroke.state;null!==t&&this.owner.setStroke(t,e);const i=e.strokeWidth.state;null!==i&&this.owner.setStrokeWidth(i,e)}},didDetachView(t){this.owner.callObservers("controllerDidDetachGeoView",t,this.owner)},viewWillSetGeoPath(t,e){this.owner.callObservers("controllerWillSetGeoPath",t,e,this.owner)},viewDidSetGeoPath(t,e){this.owner.callObservers("controllerDidSetGeoPath",t,e,this.owner)},viewWillSetStroke(t,e){this.owner.callObservers("controllerWillSetStroke",t,e,this.owner)},viewDidSetStroke(t,e){this.owner.callObservers("controllerDidSetStroke",t,e,this.owner)},viewWillSetStrokeWidth(t,e){this.owner.callObservers("controllerWillSetStrokeWidth",t,e,this.owner)},viewDidSetStrokeWidth(t,e){this.owner.callObservers("controllerDidSetStrokeWidth",t,e,this.owner)}})],fa.prototype,"geo",void 0);class ga extends pa{setGeoPath(t,n,s){const o=this.geo.view;null!==o&&(void 0===s||!0===s?!0===(s=this.geoTiming.state)&&(s=o.getLook(At.timing,Et.ambient)):s=e.Timing.fromAny(s),o.geoPath.setState(t,s,i.Affinity.Intrinsic))}setFill(t,n,s){const o=this.geo.view;null!==o&&(void 0===s||!0===s?!0===(s=this.geoTiming.state)&&(s=o.getLook(At.timing,Et.ambient)):s=e.Timing.fromAny(s),t instanceof At?o.fill.setLook(t,s,i.Affinity.Intrinsic):o.fill.setState(t,s,i.Affinity.Intrinsic))}setStroke(t,n,s){const o=this.geo.view;null!==o&&(void 0===s||!0===s?!0===(s=this.geoTiming.state)&&(s=o.getLook(At.timing,Et.ambient)):s=e.Timing.fromAny(s),t instanceof At?o.stroke.setLook(t,s,i.Affinity.Intrinsic):o.stroke.setState(t,s,i.Affinity.Intrinsic))}setStrokeWidth(t,n,s){const o=this.geo.view;null!==o&&(void 0===s||!0===s?!0===(s=this.geoTiming.state)&&(s=o.getLook(At.timing,Et.ambient)):s=e.Timing.fromAny(s),o.strokeWidth.setState(t,s,i.Affinity.Intrinsic))}}u([eo({traitType:ua,observesTrait:!0,willAttachTrait(t){this.owner.callObservers("controllerWillAttachGeoTrait",t,this.owner)},didAttachTrait(t){if(null!==this.view){this.owner.setGeoPath(t.geoPath.state,t);const e=t.fill.state;null!==e&&this.owner.setFill(e,t);const i=t.stroke.state;null!==i&&this.owner.setStroke(i,t);const n=t.strokeWidth.state;null!==n&&this.owner.setStrokeWidth(n,t)}},didDetachTrait(t){this.owner.callObservers("controllerDidDetachGeoTrait",t,this.owner)},traitDidSetGeoPath(t,e,i){this.owner.setGeoPath(t,i)},traitDidSetFill(t,e,i){this.owner.setFill(t,i)},traitDidSetStroke(t,e,i){this.owner.setStroke(t,i)},traitDidSetStrokeWidth(t,e,i){this.owner.setStrokeWidth(t,i)},viewType:ha,observesView:!0,willAttachView(t){this.owner.callObservers("controllerWillAttachGeoView",t,this.owner)},didAttachView(t){const e=this.trait;if(null!==e){this.owner.setGeoPath(e.geoPath.state,e);const t=e.fill.state;null!==t&&this.owner.setFill(t,e);const i=e.stroke.state;null!==i&&this.owner.setStroke(i,e);const n=e.strokeWidth.state;null!==n&&this.owner.setStrokeWidth(n,e)}},didDetachView(t){this.owner.callObservers("controllerDidDetachGeoView",t,this.owner)},viewWillSetGeoPath(t,e){this.owner.callObservers("controllerWillSetGeoPath",t,e,this.owner)},viewDidSetGeoPath(t,e){this.owner.callObservers("controllerDidSetGeoPath",t,e,this.owner)},viewWillSetFill(t,e){this.owner.callObservers("controllerWillSetFill",t,e,this.owner)},viewDidSetFill(t,e){this.owner.callObservers("controllerDidSetFill",t,e,this.owner)},viewWillSetStroke(t,e){this.owner.callObservers("controllerWillSetStroke",t,e,this.owner)},viewDidSetStroke(t,e){this.owner.callObservers("controllerDidSetStroke",t,e,this.owner)},viewWillSetStrokeWidth(t,e){this.owner.callObservers("controllerWillSetStrokeWidth",t,e,this.owner)},viewDidSetStrokeWidth(t,e){this.owner.callObservers("controllerDidSetStrokeWidth",t,e,this.owner)}})],ga.prototype,"geo",void 0);class va extends Zl{isGradientStop(){return null!==this.color.value||void 0!==this.opacity.value}setState(t,e){let i;i=t instanceof va||t instanceof c.GeoPoint?t.toAny():c.GeoPoint.isTuple(t)?{lng:t[0],lat:t[1]}:t,void 0!==i.lng&&void 0!==i.lat?this.geoPoint(new c.GeoPoint(i.lng,i.lat),e):void 0!==i.x&&void 0!==i.y&&this.viewPoint(new s.R2Point(i.x,i.y),e),void 0!==i.radius&&this.radius(i.radius,e),void 0!==i.hitRadius&&this.hitRadius(i.hitRadius),void 0!==i.color&&this.color(i.color,e),void 0!==i.opacity&&this.opacity(i.opacity,e),void 0!==i.labelPadding&&this.labelPadding(i.labelPadding,e),void 0!==i.labelPlacement&&this.labelPlacement(i.labelPlacement),void 0!==i.font&&this.font(i.font,e),void 0!==i.textColor&&this.textColor(i.textColor,e),void 0!==i.label&&this.label(i.label)}needsProcess(t,e){return 0!=(t&fn.NeedsProject)&&null!==this.label.view&&this.requireUpdate(fn.NeedsLayout),t}onProject(t){if(super.onProject(t),this.viewPoint.hasAffinity(i.Affinity.Intrinsic)){const e=t.geoViewport.project(this.geoPoint.getValue());this.viewPoint.setInterpolatedValue(e,e)}}onLayout(t){super.onLayout(t);const e=this.label.view;null!==e&&this.layoutLabel(e,t.viewFrame)}layoutLabel(t,e){const n=this.labelPlacement.state,o=Math.min(e.width,e.height),r=this.labelPadding.getValue().pxValue(o),{x:l,y:a}=this.viewPoint.getValue();let h=a;"top"===n?h-=r:"bottom"===n&&(h+=r),Cs.is(t)&&(t.textAlign.setState("center",i.Affinity.Intrinsic),t.textBaseline.setState("bottom",i.Affinity.Intrinsic),t.textOrigin.setState(new s.R2Point(l,h),i.Affinity.Intrinsic))}updateGeoBounds(){}get hitBounds(){const{x:t,y:e}=this.viewPoint.getValue(),i=this.hitRadius.getStateOr(0);return new s.R2Box(t-i,e-i,t+i,e+i)}hitTest(t,e,i){const n=i.renderer;return n instanceof cs?this.hitTestPoint(t,e,n.context,i.viewFrame):null}hitTestPoint(t,e,i,n){const{x:s,y:o}=this.viewPoint.getValue(),r=this.radius.value;let l=this.hitRadius.getStateOr(0);if(null!==r){const t=Math.min(n.width,n.height);l=Math.max(l,r.pxValue(t))}const a=s-t,h=o-e;return a*a+h*h<l*l?this:null}ripple(t){return ta.ripple(this,t)}toAny(){const t={};return t.lng=this.geoPoint.value.lng,t.lat=this.geoPoint.value.lat,this.viewPoint.hasAffinity(i.Affinity.Intrinsic)||(t.x=this.viewPoint.value.x,t.y=this.viewPoint.value.y),null!==this.radius.value&&(t.radius=this.radius.value),void 0!==this.hitRadius.state&&(t.hitRadius=this.hitRadius.state),null!==this.color.value&&(t.color=this.color.value),void 0!==this.opacity.value&&(t.opacity=this.opacity.value),null!==this.labelPadding.value&&(t.labelPadding=this.labelPadding.value),void 0!==this.labelPlacement.state&&(t.labelPlacement=this.labelPlacement.state),t}init(t){t instanceof c.GeoPoint||c.GeoPoint.isTuple(t)?this.setState(t):super.init(t)}}u([i.Animator({type:c.GeoPoint,state:c.GeoPoint.origin(),updateFlags:fn.NeedsProject,willSetValue(t,e){this.owner.callObservers("viewWillSetGeoPoint",t,e,this.owner)},didSetValue(t,e){this.owner.setGeoBounds(t.bounds),this.owner.callObservers("viewDidSetGeoPoint",t,e,this.owner)}})],va.prototype,"geoPoint",void 0),u([i.Animator({type:s.R2Point,state:s.R2Point.origin()})],va.prototype,"viewPoint",void 0),u([Ht({type:s.Length,state:null})],va.prototype,"radius",void 0),u([Ht({type:z,state:null})],va.prototype,"color",void 0),u([Ht({type:Number})],va.prototype,"opacity",void 0),u([Ht({type:s.Length,state:null})],va.prototype,"labelPadding",void 0),u([Ht({type:E,state:null,inherits:!0})],va.prototype,"font",void 0),u([Ht({type:z,state:null,inherits:!0})],va.prototype,"textColor",void 0),u([i.Property({type:Number})],va.prototype,"hitRadius",void 0),u([vn({key:!0,type:As,binds:!0,willAttachView(t){this.owner.callObservers("viewWillAttachGeoLabel",t,this.owner)},didDetachView(t){this.owner.callObservers("viewDidDetachGeoLabel",t,this.owner)},fromAny(t){return"string"==typeof t?this.view instanceof As?(this.view.text(t),this.view):As.fromAny(t):ns.fromAny(t)}})],va.prototype,"label",void 0),u([i.Property({type:String,state:"auto"})],va.prototype,"labelPlacement",void 0),Object.defineProperty(va.prototype,"viewBounds",{get(){const{x:t,y:e}=this.viewPoint.getValue();return new s.R2Box(t,e,t,e)},configurable:!0});class ya extends Zl{constructor(){super(),this.gradientStops=0,Object.defineProperty(this,"viewBounds",{value:s.R2Box.undefined(),writable:!0,enumerable:!0,configurable:!0})}points(t,e){const n=this.children;if(void 0===t){const t=[];for(let e=0;e<n.length;e+=1){const i=n[e];i instanceof va&&t.push(i)}return t}{const e=this.geoBounds;let s=1/0,o=1/0,r=-1/0,l=-1/0,a=0,h=0,d=!1,u=0,p=0;for(;u<n.length&&p<t.length;){const e=n[u];if(e instanceof va){const i=t[p];e.setState(i);const{lng:n,lat:c}=e.geoPoint.getValue();a+=n,h+=c,s=Math.min(s,n),o=Math.min(o,c),r=Math.max(n,r),l=Math.max(c,l),d=d||!isFinite(n)||!isFinite(c),p+=1}u+=1}for(;p<t.length;){const e=va.fromAny(t[p]);this.appendChild(e);const{lng:i,lat:n}=e.geoPoint.getValue();a+=i,h+=n,s=Math.min(s,i),o=Math.min(o,n),r=Math.max(i,r),l=Math.max(n,l),d=d||!isFinite(i)||!isFinite(n),u+=1,p+=1}for(;u<n.length;){const t=n[u];t instanceof va?this.removeChild(t):u+=1}d||0===p?(this.geoCentroid.setState(c.GeoPoint.origin(),i.Affinity.Intrinsic),this.geoBounds=c.GeoBox.undefined()):(a/=p,h/=p,this.geoCentroid.setState(new c.GeoPoint(a,h),i.Affinity.Intrinsic),this.geoBounds=new c.GeoBox(s,o,r,l));const f=this.geoBounds;return e.equals(f)||(this.willSetGeoBounds(f,e),this.onSetGeoBounds(f,e),this.didSetGeoBounds(f,e)),this}}appendPoint(t,e){return t=va.fromAny(t),this.appendChild(t,e),t}setPoint(t,e){return e=va.fromAny(e),this.setChild(t,e),e}onInsertChild(t,e){super.onInsertChild(t,e),t instanceof va&&this.onInsertPoint(t)}onInsertPoint(t){t.requireUpdate(fn.NeedsAnimate|fn.NeedsProject)}didProject(t){const e=this.geoBounds;let n=1/0,o=1/0,r=-1/0,l=-1/0,a=0,h=0,d=1/0,u=1/0,p=-1/0,f=-1/0,g=0,v=0,y=!1,w=0,m=0;const b=this.children;for(let t=0;t<b.length;t+=1){const e=b[t];if(e instanceof va){const{lng:t,lat:i}=e.geoPoint.getValue();a+=t,h+=i,n=Math.min(n,t),o=Math.min(o,i),r=Math.max(t,r),l=Math.max(i,l),y=y||!isFinite(t)||!isFinite(i);const{x:s,y:c}=e.viewPoint.getValue();d=Math.min(d,s),u=Math.min(u,c),p=Math.max(s,p),f=Math.max(c,f),g+=s,v+=c,y=y||!isFinite(s)||!isFinite(c),e.isGradientStop()&&(w+=1),m+=1}}y||0===m?(this.geoCentroid.setState(c.GeoPoint.origin(),i.Affinity.Intrinsic),this.geoBounds=c.GeoBox.undefined(),this.viewCentroid.setState(s.R2Point.origin(),i.Affinity.Intrinsic),this.viewBounds=s.R2Box.undefined(),this.setCulled(!0)):(a/=m,h/=m,this.geoCentroid.setState(new c.GeoPoint(a,h),i.Affinity.Intrinsic),this.geoBounds=new c.GeoBox(n,o,r,l),g/=m,v/=m,this.viewCentroid.setState(new s.R2Point(g,v),i.Affinity.Intrinsic),this.viewBounds=new s.R2Box(d,u,p,f),this.cullGeoFrame(t.geoViewport.geoFrame)),this.gradientStops=w;const C=this.geoBounds;e.equals(C)||(this.willSetGeoBounds(C,e),this.onSetGeoBounds(C,e),this.didSetGeoBounds(C,e)),super.didProject(t)}onRender(t){super.onRender(t);const e=t.renderer;e instanceof as&&!this.isHidden()&&!this.culled&&(0!==this.gradientStops&&e instanceof cs?this.renderPlotGradient(e.context,t.viewFrame):this.renderPlotStroke(e.context,t.viewFrame))}renderPlotStroke(t,e){const i=this.stroke.value;if(null!==i){const n=this.children,s=n.length;let o=0;t.beginPath();for(let e=0;e<s;e+=1){const i=n[e];if(i instanceof va){const{x:e,y:n}=i.viewPoint.getValue();0===o?t.moveTo(e,n):t.lineTo(e,n),o+=1}}if(0!==o){const n=t.lineWidth,s=t.strokeStyle,o=Math.min(e.width,e.height),r=this.strokeWidth.getValue().pxValue(o);t.lineWidth=r,t.strokeStyle=i.toString(),t.stroke(),t.lineWidth=n,t.strokeStyle=s}}}renderPlotGradient(t,e){const i=this.stroke.getValue(),n=Math.min(e.width,e.height),s=this.strokeWidth.getValue().pxValue(n),o=this.children,r=o.length,l=t.lineWidth,a=t.strokeStyle;let h;for(let e=0;e<r;e+=1){const n=o[e];if(n instanceof va){if(void 0!==h){const e=h.viewPoint.getValue().x,o=h.viewPoint.getValue().y,r=n.viewPoint.getValue().x,l=n.viewPoint.getValue().y,a=t.createLinearGradient(e,o,r,l);let d=h.color.getValueOr(i),c=h.opacity.value;"number"==typeof c&&(d=d.alpha(c)),a.addColorStop(0,d.toString()),d=n.color.getValueOr(i),c=n.opacity.value,"number"==typeof c&&(d=d.alpha(c)),a.addColorStop(1,d.toString()),t.beginPath(),t.moveTo(e,o),t.lineTo(r,l),t.lineWidth=s,t.strokeStyle=a,t.stroke()}h=n}}t.lineWidth=l,t.strokeStyle=a}updateGeoBounds(){}get popoverFrame(){const t=this.viewCentroid.state,e=this.pageTransform.inverse(),i=e.transformX(t.x,t.y),n=e.transformY(t.x,t.y);return new s.R2Box(i,n,i,n)}hitTest(t,e,i){const n=i.renderer;if(n instanceof cs){const s=n.transform.transform(t,e);return this.hitTestPlot(s.x,s.y,n.context,i.viewFrame)}return null}hitTestPlot(t,e,i,n){const s=this.children.length;let o=0;i.beginPath();for(let t=0;t<s;t+=1){const e=this.children[t];if(e instanceof va){const{x:n,y:s}=e.viewPoint.getValue();0===t?i.moveTo(n,s):i.lineTo(n,s),o+=1}}if(0!==o){const s=i.lineWidth;let o=this.hitWidth.getStateOr(0);const r=this.strokeWidth.value;if(null!==r){const t=Math.min(n.width,n.height);o=Math.max(o,r.pxValue(t))}i.lineWidth=o;const l=i.isPointInStroke(t,e);if(i.lineWidth=s,l)return this}return null}ripple(t){return ta.ripple(this,t)}init(t){super.init(t),void 0!==t.stroke&&this.stroke(t.stroke),void 0!==t.strokeWidth&&this.strokeWidth(t.strokeWidth),void 0!==t.hitWidth&&this.hitWidth(t.hitWidth),void 0!==t.font&&this.font(t.font),void 0!==t.textColor&&this.textColor(t.textColor);const e=t.points;void 0!==e&&this.points(e)}}u([i.Property({type:c.GeoPoint,state:c.GeoPoint.origin()})],ya.prototype,"geoCentroid",void 0),u([i.Property({type:s.R2Point,state:s.R2Point.origin()})],ya.prototype,"viewCentroid",void 0),u([Ht({type:z,state:null,inherits:!0,updateFlags:fn.NeedsRender})],ya.prototype,"stroke",void 0),u([Ht({type:s.Length,state:null,inherits:!0,updateFlags:fn.NeedsRender})],ya.prototype,"strokeWidth",void 0),u([Ht({type:E,state:null,inherits:!0})],ya.prototype,"font",void 0),u([Ht({type:z,state:null,inherits:!0})],ya.prototype,"textColor",void 0),u([i.Property({type:Number})],ya.prototype,"hitWidth",void 0);class wa extends Zl{constructor(){super(),this.sprite=null,Object.defineProperty(this,"viewBounds",{value:s.R2Box.undefined(),writable:!0,enumerable:!0,configurable:!0})}onApplyTheme(t,e,n){if(super.onApplyTheme(t,e,n),!this.graphics.inherited){const s=this.graphics.value;if(s instanceof Ds){const o=s.withTheme(t,e);this.graphics.setState(o,!!s.isThemed()&&n,i.Affinity.Reflexive)}}}onProject(t){super.onProject(t),this.projectIcon(t)}projectGeoCenter(t){if(this.mounted){const e=this.viewContext,i=null!==t&&t.isDefined()?e.geoViewport.project(t):null;this.viewCenter.setInterpolatedValue(this.viewCenter.value,i),this.projectIcon(e)}}projectIcon(t){if(i.Affinity.Intrinsic>=this.viewCenter.affinity){const e=this.geoCenter.value,i=null!==e&&e.isDefined()?t.geoViewport.project(e):null;this.viewCenter.value=i}const e=t.viewFrame;this.viewBounds=this.deriveViewBounds(e);const n=this.viewCenter.value,o=this.viewCenter.state;null!==n&&null!==o&&(e.intersectsBox(this.viewBounds)||e.intersectsSegment(new s.R2Segment(n.x,n.y,o.x,o.y)))?this.setCulled(!1):this.setCulled(!0)}onRasterize(t){super.onRasterize(t),this.isHidden()||this.culled||this.rasterizeIcon(this.viewBounds)}rasterizeIcon(t){let e=this.sprite;const i=this.graphics.value;if(null!==i&&t.isDefined()){const n=t.width,o=t.height;null!==e&&(e.width<n||e.height<o||n<e.width/2&&o<e.height/2)&&(this.sprite=null,e.release(),e=null),null===e&&(e=this.spriteProvider.service.acquireSprite(n,o),this.sprite=e);const r=e.getRenderer(),l=r.context;l.clearRect(0,0,e.width,e.height),l.beginPath(),i.render(r,new s.R2Box(0,0,n,o))}else null!==e&&(this.sprite=null,e.release())}onComposite(t){super.onComposite(t);const e=t.renderer;e instanceof cs&&!this.isHidden()&&!this.culled&&this.compositeIcon(e,this.viewBounds)}compositeIcon(t,e){const i=this.sprite;null!==i&&i.draw(t.context,e)}renderGeoBounds(t,e,i){}updateGeoBounds(){}deriveViewBounds(t){const e=this.viewCenter.value;if(null!==e&&e.isDefined()){void 0===t&&(t=this.viewContext.viewFrame);const i=Math.min(t.width,t.height);let n=this.iconWidth.value;n=n instanceof s.Length?n.pxValue(i):i;let o=this.iconHeight.value;o=o instanceof s.Length?o.pxValue(i):i;const r=e.x-n*this.xAlign.value,l=e.y-o*this.yAlign.value;return new s.R2Box(r,l,r+n,l+o)}return s.R2Box.undefined()}get popoverFrame(){const t=this.viewCenter.value;if(null!==t&&t.isDefined()){const e=this.viewContext.viewFrame,i=Math.min(e.width,e.height),n=this.pageTransform.inverse(),o=n.transformX(t.x,t.y),r=n.transformY(t.x,t.y);let l=this.iconWidth.value;l=l instanceof s.Length?l.pxValue(i):i;let a=this.iconHeight.value;a=a instanceof s.Length?a.pxValue(i):i;const h=o-l*this.xAlign.getValue(),d=r-a*this.yAlign.getValue();return new s.R2Box(h,d,h+l,d+a)}return this.pageBounds}hitTest(t,e,i){const n=i.renderer;return n instanceof cs?this.hitTestIcon(t,e,n,this.viewBounds):null}hitTestIcon(t,e,i,n){return this.hitBounds.contains(t,e)?this:null}ripple(t){return ta.ripple(this,t)}onUnmount(){super.onUnmount();const t=this.sprite;null!==t&&(this.sprite=null,t.release())}init(t){super.init(t),Os.init(this,t),void 0!==t.geoCenter&&this.geoCenter(t.geoCenter),void 0!==t.viewCenter&&this.viewCenter(t.viewCenter)}}wa.MountFlags=Zl.MountFlags|fn.NeedsRasterize,wa.UncullFlags=Zl.UncullFlags|fn.NeedsRasterize,u([i.Animator({type:c.GeoPoint,state:null,didSetState(t,e){this.owner.projectGeoCenter(t)},willSetValue(t,e){this.owner.callObservers("viewWillSetGeoCenter",t,e,this.owner)},didSetValue(t,e){this.owner.setGeoBounds(null!==t?t.bounds:c.GeoBox.undefined()),this.mounted&&this.owner.projectIcon(this.owner.viewContext),this.owner.callObservers("viewDidSetGeoCenter",t,e,this.owner)}})],wa.prototype,"geoCenter",void 0),u([i.Animator({type:s.R2Point,state:s.R2Point.undefined(),updateFlags:fn.NeedsComposite})],wa.prototype,"viewCenter",void 0),u([i.Animator({type:Number,state:.5,updateFlags:fn.NeedsProject|fn.NeedsRender|fn.NeedsRasterize|fn.NeedsComposite})],wa.prototype,"xAlign",void 0),u([i.Animator({type:Number,state:.5,updateFlags:fn.NeedsProject|fn.NeedsRender|fn.NeedsRasterize|fn.NeedsComposite})],wa.prototype,"yAlign",void 0),u([Ht({type:s.Length,state:null,updateFlags:fn.NeedsProject|fn.NeedsRender|fn.NeedsRasterize|fn.NeedsComposite})],wa.prototype,"iconWidth",void 0),u([Ht({type:s.Length,state:null,updateFlags:fn.NeedsProject|fn.NeedsRender|fn.NeedsRasterize|fn.NeedsComposite})],wa.prototype,"iconHeight",void 0),u([Ht({type:z,state:null,updateFlags:fn.NeedsRender|fn.NeedsRasterize|fn.NeedsComposite,didSetValue(t,e){if(null!==t){const e=this.owner.graphics.value;if(e instanceof Ts){const n=e.withFillColor(t);this.owner.graphics.setState(n,i.Affinity.Reflexive)}}}})],wa.prototype,"iconColor",void 0),u([Ht({extends:Es,type:Object,updateFlags:fn.NeedsRender|fn.NeedsRasterize|fn.NeedsComposite,willSetValue(t,e){this.owner.callObservers("viewWillSetGraphics",t,e,this.owner)},didSetValue(t,e){this.owner.callObservers("viewDidSetGraphics",t,e,this.owner)}})],wa.prototype,"graphics",void 0);class ma extends Xl{get geoBounds(){const t=this.geoCenter.state;return null!==t?t.bounds:c.GeoBox.undefined()}}u([i.Property({type:c.GeoPoint,state:null,willSetState(t,e){this.owner.callObservers("traitWillSetGeoCenter",t,e,this.owner)},didSetState(t,e){this.owner.callObservers("traitDidSetGeoCenter",t,e,this.owner)}})],ma.prototype,"geoCenter",void 0),u([i.Property({type:xs,state:null,willSetState(t,e){this.owner.callObservers("traitWillSetIconLayout",t,e,this.owner)},didSetState(t,e){this.owner.callObservers("traitDidSetIconLayout",t,e,this.owner)}})],ma.prototype,"iconLayout",void 0),u([i.Property({state:null,willSetState(t,e){this.owner.callObservers("traitWillSetGraphics",t,e,this.owner)},didSetState(t,e){this.owner.callObservers("traitDidSetGraphics",t,e,this.owner)}})],ma.prototype,"graphics",void 0);class ba extends Kl{setGeoCenter(t,n,s){const o=this.geo.view;null!==o&&(void 0===s||!0===s?!0===(s=this.geoTiming.state)&&(s=o.getLook(At.timing,Et.ambient)):s=e.Timing.fromAny(s),o.geoCenter.setState(t,s,i.Affinity.Intrinsic))}setIconLayout(t,n,s){const o=this.geo.view;null!==o&&null!==t&&(void 0===s||!0===s?!0===(s=this.geoTiming.state)&&(s=o.getLook(At.timing,Et.ambient)):s=e.Timing.fromAny(s),o.iconWidth.setState(t.iconWidth,s,i.Affinity.Intrinsic),o.iconHeight.setState(t.iconHeight,s,i.Affinity.Intrinsic),void 0!==t.xAlign&&o.xAlign.setState(t.xAlign,s,i.Affinity.Intrinsic),void 0!==t.yAlign&&o.yAlign.setState(t.yAlign,s,i.Affinity.Intrinsic))}setGraphics(t,n,s){const o=this.geo.view;null!==o&&(void 0===s||!0===s?!0===(s=this.geoTiming.state)&&(s=o.getLook(At.timing,Et.ambient)):s=e.Timing.fromAny(s),o.graphics.setState(t,s,i.Affinity.Intrinsic))}}u([eo({traitType:ma,observesTrait:!0,willAttachTrait(t){this.owner.callObservers("controllerWillAttachGeoTrait",t,this.owner)},didAttachTrait(t){null!==this.view&&(this.owner.setGeoCenter(t.geoCenter.state,t),this.owner.setIconLayout(t.iconLayout.state,t),this.owner.setGraphics(t.graphics.state,t))},didDetachTrait(t){this.owner.callObservers("controllerDidDetachGeoTrait",t,this.owner)},traitDidSetGeoCenter(t,e,i){this.owner.setGeoCenter(t,i)},traitDidSetIconLayout(t,e,i){this.owner.setIconLayout(t,i)},traitDidSetGraphics(t,e,i){this.owner.setGraphics(t,i)},viewType:wa,observesView:!0,willAttachView(t){this.owner.callObservers("controllerWillAttachGeoView",t,this.owner)},didAttachView(t){const e=this.trait;null!==e&&(this.owner.setGeoCenter(e.geoCenter.state,e),this.owner.setIconLayout(e.iconLayout.state,e),this.owner.setGraphics(e.graphics.state,e))},didDetachView(t){this.owner.callObservers("controllerDidDetachGeoView",t,this.owner)},viewWillSetGeoCenter(t,e){this.owner.callObservers("controllerWillSetGeoCenter",t,e,this.owner)},viewDidSetGeoCenter(t,e){this.owner.callObservers("controllerDidSetGeoCenter",t,e,this.owner)},viewWillSetGraphics(t,e){this.owner.callObservers("controllerWillSetGraphics",t,e,this.owner)},viewDidSetGraphics(t,e){this.owner.callObservers("controllerDidSetGraphics",t,e,this.owner)}})],ba.prototype,"geo",void 0);class Ca extends Zl{needsProcess(t,e){return 0!=(t&fn.NeedsResize)&&(t|=fn.NeedsProject),t}extendViewContext(t){const e=Object.create(t);return e.geoViewport=this.geoViewport,e}get geoFrame(){return this.geoViewport.geoFrame}}u([vn({type:ps,willAttachView(t){this.owner.callObservers("viewWillAttachMapCanvas",t,this.owner)},didDetachView(t){this.owner.callObservers("viewDidDetachMapCanvas",t,this.owner)}})],Ca.prototype,"canvas",void 0),u([vn({type:Kn,willAttachView(t){this.owner.callObservers("viewWillAttachMapContainer",t,this.owner)},didDetachView(t){this.owner.callObservers("viewDidDetachMapContainer",t,this.owner)}})],Ca.prototype,"container",void 0);class Sa extends Xl{get geoBounds(){return c.GeoBox.globe()}startConsumingLayers(){const t=this.layers.traits;for(const e in t){t[e].consume(this)}}stopConsumingLayers(){const t=this.layers.traits;for(const e in t){t[e].unconsume(this)}}onStartConsuming(){super.onStartConsuming(),this.startConsumingLayers()}onStopConsuming(){super.onStopConsuming(),this.stopConsumingLayers()}}u([i.Property({type:Gl,state:null,willSetState(t,e){this.owner.callObservers("traitWillSetGeoPerspective",t,e,this.owner)},didSetState(t,e){this.owner.callObservers("traitDidSetGeoPerspective",t,e,this.owner)}})],Sa.prototype,"geoPerspective",void 0),u([T({type:Xl,binds:!0,willAttachTrait(t,e){this.owner.callObservers("traitWillAttachLayer",t,e,this.owner)},didAttachTrait(t){this.owner.consuming&&t.consume(this.owner)},willDetachTrait(t){this.owner.consuming&&t.unconsume(this.owner)},didDetachTrait(t){this.owner.callObservers("traitDidDetachLayer",t,this.owner)},detectModel:t=>t.getTrait(Xl),detectTrait:t=>null})],Sa.prototype,"layers",void 0);class Aa extends Qs{setGeoPerspective(t){if(null!==t){const e=this.map.view;null!==e&&e.moveTo(t)}}}u([eo({traitType:Sa,observesTrait:!0,willAttachTrait(t){this.owner.callObservers("controllerWillAttachMapTrait",t,this.owner)},didAttachTrait(t){null!==this.view&&this.owner.setGeoPerspective(t.geoPerspective.state);const e=t.layers.traits;for(const t in e){const i=e[t];this.owner.layers.addTraitController(i)}},willDetachTrait(t){const e=t.layers.traits;for(const t in e){const i=e[t];this.owner.layers.deleteTraitController(i)}},didDetachTrait(t){this.owner.callObservers("controllerDidDetachMapTrait",t,this.owner)},traitDidSetGeoPerspective(t,e){this.owner.setGeoPerspective(t)},traitWillAttachLayer(t,e){this.owner.layers.addTraitController(t,e)},traitDidDetachLayer(t){this.owner.layers.deleteTraitController(t)},viewType:Ca,observesView:!0,willAttachView(t){this.owner.callObservers("controllerWillAttachMapView",t,this.owner)},didAttachView(t){this.owner.canvas.setView(t.canvas.view),this.owner.container.setView(t.container.view);const e=this.trait;null!==e&&this.owner.setGeoPerspective(e.geoPerspective.state);const i=this.owner.layers.controllers;for(const e in i){const n=i[e],s=n.geo.view;null!==s&&null===s.parent&&n.geo.insertView(t)}},willDetachView(t){this.owner.canvas.setView(null),this.owner.container.setView(null)},didDetachView(t){this.owner.callObservers("controllerDidDetachMapView",t,this.owner)},viewWillSetGeoViewport(t,e){this.owner.callObservers("controllerWillSetGeoViewport",t,e,this.owner)},viewDidSetGeoViewport(t,e){this.owner.callObservers("controllerDidSetGeoViewport",t,e,this.owner)},viewWillAttachMapCanvas(t){this.owner.canvas.setView(t)},viewDidDetachMapCanvas(t){this.owner.canvas.setView(null)},viewWillAttachMapContainer(t){this.owner.container.setView(t)},viewDidDetachMapContainer(t){this.owner.container.setView(null)}})],Aa.prototype,"map",void 0),u([vn({type:ps,willAttachView(t){this.owner.callObservers("controllerWillAttachMapCanvasView",t,this.owner)},didDetachView(t){this.owner.callObservers("controllerDidDetachMapCanvasView",t,this.owner)}})],Aa.prototype,"canvas",void 0),u([vn({type:Kn,willAttachView(t){this.owner.callObservers("controllerWillAttachMapContainerView",t,this.owner)},didAttachView(t){const e=this.owner.createMapView(t);e.container.setView(t),this.owner.map.setView(e)},didDetachView(t){this.owner.callObservers("controllerDidDetachMapContainerView",t,this.owner)}})],Aa.prototype,"container",void 0),u([i.Property({type:e.Timing,state:!0})],Aa.prototype,"geoTiming",void 0),u([oo({type:Kl,binds:!0,observes:!0,get parentView(){return this.owner.map.view},getTraitViewRef:t=>t.geo,willAttachController(t){this.owner.callObservers("controllerWillAttachLayer",t,this.owner)},didAttachController(t){const e=t.geo.trait;null!==e&&this.attachLayerTrait(e,t);const i=t.geo.view;null!==i&&this.attachLayerView(i,t)},willDetachController(t){const e=t.geo.view;null!==e&&this.detachLayerView(e,t);const i=t.geo.trait;null!==i&&this.detachLayerTrait(i,t)},didDetachController(t){this.owner.callObservers("controllerDidDetachLayer",t,this.owner)},controllerWillAttachGeoTrait(t,e){this.owner.callObservers("controllerWillAttachLayerTrait",t,e,this.owner),this.attachLayerTrait(t,e)},controllerDidDetachGeoTrait(t,e){this.detachLayerTrait(t,e),this.owner.callObservers("controllerDidDetachLayerTrait",t,e,this.owner)},attachLayerTrait(t,e){},detachLayerTrait(t,e){},controllerWillAttachGeoView(t,e){this.owner.callObservers("controllerWillAttachLayerView",t,e,this.owner),this.attachLayerView(t,e)},controllerDidDetachGeoView(t,e){this.detachLayerView(t,e),this.owner.callObservers("controllerDidDetachLayerView",t,e,this.owner)},attachLayerView(t,e){},detachLayerView(t,e){t.remove()},controllerWillSetGeoBounds(t,e,i){this.owner.callObservers("controllerWillSetLayerGeoBounds",t,e,i,this.owner)},controllerDidSetGeoBounds(t,e,i){this.owner.callObservers("controllerDidSetLayerGeoBounds",t,e,i,this.owner)},createController(t){return void 0!==t?Kl.fromTrait(t):oo.prototype.createController.call(this)}})],Aa.prototype,"layers",void 0);class xa{get geoFrame(){return c.GeoBox.globe()}get geoCenter(){return c.GeoPoint.origin()}get zoom(){return 0}get heading(){return 0}get tilt(){return 0}canEqual(t){return t instanceof xa&&this.constructor===t.constructor}equals(t){return this===t||t instanceof xa&&(t.canEqual(this)&&this.viewFrame.equals(t.viewFrame))}}class Da extends xa{constructor(t){super(),this.viewFrame=t}withViewFrame(t){let e=t.xMin,i=t.yMin,n=t.xMax,o=t.yMax;const r=n-e,l=o-i,a=r/l;if(a<2){const a=(l-r/2)/2;i+=a,o-=a,t=new s.R2Box(e,i,n,o)}else if(a>2){const a=(r-2*l)/2;e+=a,n-=a,t=new s.R2Box(e,i,n,o)}return new Da(t)}project(t,e){1===arguments.length&&(Array.isArray(t)?(e=t[1],t=t[0]):(e=t.lat,t=t.lng));const i=this.viewFrame,n=i.xMin+(180+t)/360*i.width,o=i.yMax-(90+e)/180*i.height;return new s.R2Point(n,o)}unproject(t,e){1===arguments.length&&(Array.isArray(t)?(e=t[1],t=t[0]):(e=t.y,t=t.x));const i=this.viewFrame,n=360*(t-i.xMin)/i.width-180,s=180*(i.yMax-e)/i.height-90;return new c.GeoPoint(n,s)}}class Ta extends Ca{constructor(t){super(),Object.defineProperty(this,"geoViewport",{value:t,writable:!0,enumerable:!0,configurable:!0})}willSetGeoViewport(t,e){this.callObservers("viewWillSetGeoViewport",t,e,this)}onSetGeoViewport(t,e){}didSetGeoViewport(t,e){this.callObservers("viewDidSetGeoViewport",t,e,this)}updateGeoViewport(){const t=this.geoViewport,e=t.withViewFrame(this.viewFrame);return!e.equals(t)&&(this.willSetGeoViewport(e,t),this.geoViewport=e,this.onSetGeoViewport(e,t),this.didSetGeoViewport(e,t),!0)}willProcess(t,e){0!=(t&fn.NeedsProject)&&(this.updateGeoViewport(),e.geoViewport=this.geoViewport),super.willProcess(t,e)}moveTo(t,e){}static create(t){return void 0===t&&(t=new Da(s.R2Box.undefined())),new Ta(t)}}u([vn({extends:!0,didAttachView(t,e){null===this.owner.parent&&t.appendChild(this.owner),Ca.canvas.prototype.didAttachView.call(this,t,e)},willDetachView(t){Ca.canvas.prototype.willDetachView.call(this,t),this.owner.parent===t&&t.removeChild(this.owner)}})],Ta.prototype,"canvas",void 0),u([vn({extends:!0,didAttachView(t,e){this.owner.canvas.insertView(t),Ca.container.prototype.didAttachView.call(this,t,e)},willDetachView(t){Ca.container.prototype.willDetachView.call(this,t);const e=this.owner.canvas.view;null!==e&&e.parent===t&&t.removeChild(e)}})],Ta.prototype,"container",void 0);class Pa{constructor(t,e,i,n,s,o){this.map=t,this.geoFrame=e,this.geoCenter=i,this.zoom=n,this.heading=s,this.tilt=o}project(t,e){let i;i="number"==typeof t?new mapboxgl.LngLat(t,e):t;const n=this.map.project(i);return new s.R2Point(n.x,n.y)}unproject(t,e){let i;i="number"==typeof t?new mapboxgl.Point(t,e):Array.isArray(t)?t:new mapboxgl.Point(t.x,t.y);const n=this.map.unproject(i);return new c.GeoPoint(n.lng,n.lat)}equals(t){return this===t||t instanceof Pa&&(this.map===t.map&&this.geoFrame.equals(t.geoFrame)&&this.geoCenter.equals(t.geoCenter)&&this.zoom===t.zoom&&this.heading===t.heading&&this.tilt===t.tilt)}static create(t){const e=t.getBounds(),i=new c.GeoBox(e.getWest(),e.getSouth(),e.getEast(),e.getNorth()),n=t.getCenter(),s=new c.GeoPoint(n.lng,n.lat),o=t.getZoom(),r=t.getBearing(),l=t.getPitch();return new Pa(t,i,s,o,r,l)}}class Va extends Ca{constructor(t){super(),this.map=t,Object.defineProperty(this,"geoViewport",{value:Pa.create(t),writable:!0,enumerable:!0,configurable:!0}),this.onMapRender=this.onMapRender.bind(this),this.onMoveStart=this.onMoveStart.bind(this),this.onMoveEnd=this.onMoveEnd.bind(this),this.initMap(t)}initMap(t){t.on("render",this.onMapRender),t.on("movestart",this.onMoveStart),t.on("moveend",this.onMoveEnd)}willSetGeoViewport(t,e){this.callObservers("viewWillSetGeoViewport",t,e,this)}onSetGeoViewport(t,e){}didSetGeoViewport(t,e){this.callObservers("viewDidSetGeoViewport",t,e,this)}updateGeoViewport(){const t=this.geoViewport,e=Pa.create(this.map);return!e.equals(t)&&(this.willSetGeoViewport(e,t),this.geoViewport=e,this.onSetGeoViewport(e,t),this.didSetGeoViewport(e,t),!0)}onMapRender(){if(this.updateGeoViewport()){const t=!this.isHidden()&&!this.culled;this.requireUpdate(fn.NeedsProject,t)}}onMoveStart(){this.willMoveMap()}onMoveEnd(){this.didMoveMap()}moveTo(t,i){const n={},s=this.geoViewport;let o=t.geoCenter;null!=o&&(o=c.GeoPoint.fromAny(o),s.geoCenter.equivalentTo(o,1e-5)||(n.center=o));const r=t.zoom;void 0===r||e.Equivalent(s.zoom,r,1e-5)||(n.zoom=r);const l=t.heading;void 0===l||e.Equivalent(s.heading,l,1e-5)||(n.bearing=l);const a=t.tilt;void 0===a||e.Equivalent(s.tilt,a,1e-5)||(n.pitch=a),(i=void 0===i||!0===i?this.getLookOr(At.timing,Et.ambient,!1):e.Timing.fromAny(i))instanceof e.Timing&&(n.duration=i.duration),this.map.flyTo(n)}willMoveMap(){this.callObservers("viewWillMoveMap",this)}didMoveMap(){this.callObservers("viewDidMoveMap",this)}}u([vn({extends:!0,didAttachView(t,e){null===this.owner.parent&&(t.appendChild(this.owner),t.setEventNode(this.owner.map.getCanvasContainer())),Ca.canvas.prototype.didAttachView.call(this,t,e)},willDetachView(t){Ca.canvas.prototype.willDetachView.call(this,t),this.owner.parent===t&&t.removeChild(this.owner)}})],Va.prototype,"canvas",void 0),u([vn({extends:!0,didAttachView(t,e){Kn.fromNode(this.owner.map.getContainer());const i=Kn.fromNode(this.owner.map.getCanvasContainer());this.owner.canvas.insertView(i),Ca.container.prototype.didAttachView.call(this,t,e)},willDetachView(t){Ca.container.prototype.willDetachView.call(this,t);const e=this.owner.canvas.view,i=Kn.fromNode(this.owner.map.getCanvasContainer());null!==e&&e.parent===i&&i.removeChild(t)}})],Va.prototype,"container",void 0);class Ia{constructor(t,e,i,n,s,o,r){this.map=t,this.geoFrame=e,this.geoCenter=i,this.viewOrigin=n,this.zoom=s,this.heading=o,this.tilt=r}project(t,e){const i=this.viewOrigin;let n;n="number"==typeof t?new L.LatLng(e,t):Array.isArray(t)?new L.LatLng(t[1],t[0]):t;const o=this.map.project(n,this.zoom);return new s.R2Point(o.x-i.x,o.y-i.y)}unproject(t,e){const i=this.viewOrigin;let n;n="number"==typeof t?new L.Point(t+i.x,e+i.y):Array.isArray(t)?new L.Point(t[0]+i.x,t[1]+i.y):new L.Point(t.x+i.x,t.y+i.y);const s=this.map.unproject(n,this.zoom);return new c.GeoPoint(s.lng,s.lat)}equals(t){return this===t||t instanceof Ia&&(this.map===t.map&&this.geoFrame.equals(t.geoFrame)&&this.geoCenter.equals(t.geoCenter)&&this.viewOrigin.equals(t.viewOrigin)&&this.zoom===t.zoom&&this.heading===t.heading&&this.tilt===t.tilt)}static create(t){const e=t.getBounds(),i=new c.GeoBox(e.getWest(),e.getSouth(),e.getEast(),e.getNorth()),n=t.getCenter(),o=new c.GeoPoint(n.lng,n.lat);let{x:r,y:l}=t.getPixelOrigin();try{const e=s.Transform.parse(t.getPane("mapPane").style.transform);e instanceof s.TranslateTransform&&(r-=e.x.pxValue(),l-=e.y.pxValue())}catch(t){}const a=new s.R2Point(r,l),h=t.getZoom();return new Ia(t,i,o,a,h,0,0)}}class Ma extends Ca{constructor(t){super(),this.map=t,Object.defineProperty(this,"geoViewport",{value:Ia.create(t),writable:!0,enumerable:!0,configurable:!0}),this.onMapRender=this.onMapRender.bind(this),this.onMoveStart=this.onMoveStart.bind(this),this.onMoveEnd=this.onMoveEnd.bind(this),this.initMap(t)}initMap(t){t.on("move",this.onMapRender),t.on("movestart",this.onMoveStart),t.on("moveend",this.onMoveEnd)}willSetGeoViewport(t,e){this.callObservers("viewWillSetGeoViewport",t,e,this)}onSetGeoViewport(t,e){}didSetGeoViewport(t,e){this.callObservers("viewDidSetGeoViewport",t,e,this)}updateGeoViewport(){const t=this.geoViewport,e=Ia.create(this.map);return!e.equals(t)&&(this.willSetGeoViewport(e,t),this.geoViewport=e,this.onSetGeoViewport(e,t),this.didSetGeoViewport(e,t),!0)}onMapRender(){if(this.updateGeoViewport()){const t=!this.isHidden()&&!this.culled;this.requireUpdate(fn.NeedsProject,t)}}onMoveStart(){this.willMoveMap()}onMoveEnd(){this.didMoveMap()}moveTo(t,i){const n={},s=this.geoViewport;let o=t.geoCenter;o=null!=o?c.GeoPoint.fromAny(o):s.geoCenter;const r=t.zoom;(i=void 0===i||!0===i?this.getLookOr(At.timing,Et.ambient,!1):e.Timing.fromAny(i))instanceof e.Timing&&(n.animate=!0,n.duration=i.duration),this.map.flyTo(o,r,n)}willMoveMap(){this.callObservers("viewWillMoveMap",this)}didMoveMap(){this.callObservers("viewDidMoveMap",this)}}u([vn({extends:!0,didAttachView(t,e){null===this.owner.parent&&t.appendChild(this.owner),Ca.canvas.prototype.didAttachView.call(this,t,e)},willDetachView(t){Ca.canvas.prototype.willDetachView.call(this,t),this.owner.parent===t&&t.removeChild(this.owner)}})],Ma.prototype,"canvas",void 0),u([vn({extends:!0,didAttachView(t,e){const n=Kn.fromNode(t.node.querySelector(".leaflet-control-container")),s=this.owner.canvas.insertView(t,void 0,n);null!==s&&s.zIndex.setState(500,i.Affinity.Intrinsic),Ca.container.prototype.didAttachView.call(this,t,e)},willDetachView(t){Ca.container.prototype.willDetachView.call(this,t);const e=this.owner.canvas.view;null!==e&&e.parent===t&&t.removeChild(t)}})],Ma.prototype,"container",void 0);class Ra{constructor(t,e,i,n,s,o){this.projection=t,this.geoFrame=e,this.geoCenter=i,this.zoom=n,this.heading=s,this.tilt=o}project(t,e){const i=this.projection;if(null!==i){let n;n="number"==typeof t?new google.maps.LatLng(e,t):Array.isArray(t)?new google.maps.LatLng(t[1],t[0]):new google.maps.LatLng(t.lat,t.lng);const o=i.fromLatLngToContainerPixel(n);if(null!==o)return new s.R2Point(o.x,o.y)}return s.R2Point.undefined()}unproject(t,e){const i=this.projection;if(null!==i){let n;n="number"==typeof t?new google.maps.Point(t,e):Array.isArray(t)?new google.maps.Point(t[0],t[1]):new google.maps.Point(t.x,t.y);const s=i.fromContainerPixelToLatLng(n);if(null!==s)return new c.GeoPoint(s.lng(),s.lat())}return c.GeoPoint.undefined()}equals(t){return this===t||t instanceof Ra&&(this.projection===t.projection&&this.geoFrame.equals(t.geoFrame)&&this.geoCenter.equals(t.geoCenter)&&this.zoom===t.zoom&&this.heading===t.heading&&this.tilt===t.tilt)}static create(t,e){void 0===e&&(e=null);const i=t.getBounds();let n;if(null!=i){const t=i.getSouthWest(),e=i.getNorthEast();n=new c.GeoBox(t.lng(),t.lat(),e.lng(),e.lat())}else n=c.GeoBox.undefined();const s=t.getCenter(),o=void 0!==s?new c.GeoPoint(s.lng(),s.lat()):c.GeoPoint.origin();let r=t.getZoom();void 0===r&&(r=0);let l=t.getHeading();void 0===l&&(l=0);let a=t.getTilt();return void 0===a&&(a=0),new Ra(e,n,o,r,l,a)}}class Fa extends Ca{constructor(t){super(),this.map=t,this.mapOverlay=this.createMapOverlay(t),Object.defineProperty(this,"geoViewport",{value:Ra.create(this.map,this.mapOverlay.getProjection()),writable:!0,enumerable:!0,configurable:!0}),this.onMapDraw=this.onMapDraw.bind(this),this.onMapIdle=this.onMapIdle.bind(this),this.initMap(t)}initMap(t){t.addListener("idle",this.onMapIdle)}createMapOverlay(t){const e=new Fa.MapOverlay(this);return e.setMap(t),e}static get MapOverlay(){return class extends google.maps.OverlayView{constructor(t){super(),this.owner=t}onAdd(){const t=this.owner.container.view;null!==t&&this.owner.container.materializeView(t)}onRemove(){this.owner.canvas.removeView()}draw(){this.owner.onMapDraw()}}}willSetGeoViewport(t,e){this.callObservers("viewWillSetGeoViewport",t,e,this)}onSetGeoViewport(t,e){}didSetGeoViewport(t,e){this.callObservers("viewDidSetGeoViewport",t,e,this)}updateGeoViewport(){const t=this.geoViewport,e=Ra.create(this.map,this.mapOverlay.getProjection());return!e.equals(t)&&(this.willSetGeoViewport(e,t),this.geoViewport=e,this.onSetGeoViewport(e,t),this.didSetGeoViewport(e,t),!0)}willProcess(t,e){0!=(this.flags&fn.NeedsProject)&&this.updateGeoViewport()&&(e.geoViewport=this.geoViewport),super.willProcess(t,e)}onMapDraw(){if(this.updateGeoViewport()){const t=!this.isHidden()&&!this.culled;this.requireUpdate(fn.NeedsProject,t)}}onMapIdle(){this.requireUpdate(fn.NeedsProject)}moveTo(t,i){const n=this.geoViewport;let s=t.geoCenter;null!=s&&(s=c.GeoPoint.fromAny(s),n.geoCenter.equivalentTo(s,1e-5)||this.map.panTo(s));const o=t.zoom;void 0===o||e.Equivalent(n.zoom,o,1e-5)||this.map.setZoom(o);const r=t.heading;void 0===r||e.Equivalent(n.heading,r,1e-5)||this.map.setHeading(r);const l=t.tilt;void 0===l||e.Equivalent(n.tilt,l,1e-5)||this.map.setTilt(l)}}u([vn({extends:!0,didAttachView(t,e){null===this.owner.parent&&t.appendChild(this.owner),Ca.canvas.prototype.didAttachView.call(this,t,e)},willDetachView(t){Ca.canvas.prototype.willDetachView.call(this,t),this.owner.parent===t&&t.removeChild(this.owner)}})],Fa.prototype,"canvas",void 0),u([vn({extends:!0,materializeView(t){const e=this.owner.mapOverlay.getPanes();if(null!=e){!function t(e){const i=e.parentNode;return i instanceof HTMLElement&&void 0===i.view&&t(i),Kn.fromNode(e)}(e.overlayMouseTarget);const t=e.overlayMouseTarget.view.parent.parent;this.owner.canvas.insertView(t)}else null===this.owner.canvas.view&&this.owner.canvas.attachView()},didAttachView(t,e){this.materializeView(t),Ca.container.prototype.didAttachView.call(this,t,e)},willDetachView(t){Ca.container.prototype.willDetachView.call(this,t);const e=this.owner.canvas.view,i=this.owner.mapOverlay.getPanes();if(null!=i){const n=i.overlayMouseTarget.view.parent.parent;null!==e&&e.parent===n&&n.removeChild(t)}}})],Fa.prototype,"container",void 0),u([e.Lazy],Fa,"MapOverlay",null);class La{constructor(t,e,i,n,s,o){this.map=t,this.geoFrame=e,this.geoCenter=i,this.zoom=n,this.heading=s,this.tilt=o}equals(t){return this===t||t instanceof La&&(this.map===t.map&&this.geoFrame.equals(t.geoFrame)&&this.geoCenter.equals(t.geoCenter)&&this.zoom===t.zoom&&this.heading===t.heading&&this.tilt===t.tilt)}static init(){void 0===La.webMercatorUtils&&window.require(["esri/geometry/support/webMercatorUtils"],(function(t){La.webMercatorUtils=t}))}}La.webMercatorUtils=void 0;class ka extends Ca{constructor(){super(),La.init()}}class Oa extends La{constructor(t,e,i,n,s,o){super(t,e,i,n,s,o)}project(t,e){let i;i="number"==typeof t?{x:t,y:e,spatialReference:{wkid:4326}}:Array.isArray(t)?{x:t[0],y:t[1],spatialReference:{wkid:4326}}:{x:t.lng,y:t.lat,spatialReference:{wkid:4326}};const n=this.map.toScreen(i);return null!==n?new s.R2Point(n.x,n.y):s.R2Point.origin()}unproject(t,e){let i;i="number"==typeof t?{x:t,y:e}:Array.isArray(t)?{x:t[0],y:t[1]}:t;const n=this.map.toMap(i);return null!==n?new c.GeoPoint(n.longitude,n.latitude):c.GeoPoint.origin()}static create(t){let e,i=t.extent;null!==i?(i=La.webMercatorUtils.webMercatorToGeographic(i),e=new c.GeoBox(i.xmin,i.ymin,i.xmax,i.ymax)):e=c.GeoBox.undefined();const n=t.center,s=new c.GeoPoint(n.longitude,n.latitude),o=t.zoom,r=t.rotation;return new Oa(t,e,s,o,r,0)}}class Ea extends ka{constructor(t){super(),this.map=t,Object.defineProperty(this,"geoViewport",{value:Oa.create(t),writable:!0,enumerable:!0,configurable:!0}),this.onMapRender=this.onMapRender.bind(this),this.initMap(t)}initMap(t){t.watch("extent",this.onMapRender)}willSetGeoViewport(t,e){this.callObservers("viewWillSetGeoViewport",t,e,this)}onSetGeoViewport(t,e){}didSetGeoViewport(t,e){this.callObservers("viewDidSetGeoViewport",t,e,this)}updateGeoViewport(){const t=this.geoViewport,e=Oa.create(this.map);return!e.equals(t)&&(this.willSetGeoViewport(e,t),this.geoViewport=e,this.onSetGeoViewport(e,t),this.didSetGeoViewport(e,t),!0)}onMapRender(){if(this.updateGeoViewport()){const t=!this.isHidden()&&!this.culled;this.requireUpdate(fn.NeedsProject,t)}}moveTo(t,i){const n={},s={},o=this.geoViewport;let r=t.geoCenter;null!=r&&(r=c.GeoPoint.fromAny(r),o.geoCenter.equivalentTo(r,1e-5)||(n.center=[r.lng,r.lat]));const l=t.zoom;void 0===l||e.Equivalent(o.zoom,l,1e-5)||(n.zoom=l);const a=t.heading;void 0===a||e.Equivalent(o.heading,a,1e-5)||(n.heading=a);const h=t.tilt;void 0===h||e.Equivalent(o.tilt,h,1e-5)||(n.tilt=h),(i=void 0===i||!0===i?this.getLookOr(At.timing,Et.ambient,!1):e.Timing.fromAny(i))instanceof e.Timing&&(s.duration=i.duration),this.map.goTo(n,s)}}u([vn({extends:!0,didAttachView(t,e){null===this.owner.parent&&(t.appendChild(this.owner),t.setEventNode(this.owner.map.container.querySelector(".esri-view-root"))),ka.canvas.prototype.didAttachView.call(this,t,e)},willDetachView(t){ka.canvas.prototype.willDetachView.call(this,t),this.owner.parent===t&&t.removeChild(this.owner)}})],Ea.prototype,"canvas",void 0),u([vn({extends:!0,didAttachView(t,e){const i=Kn.fromNode(this.owner.map.container),n=Kn.fromNode(i.node.querySelector(".esri-view-root")),s=Kn.fromNode(n.node.querySelector(".esri-overlay-surface"));this.owner.canvas.insertView(s),ka.container.prototype.didAttachView.call(this,t,e)},willDetachView(t){ka.container.prototype.willDetachView.call(this,t);const e=this.owner.canvas.view,i=Kn.fromNode(this.owner.map.container),n=Kn.fromNode(i.node.querySelector(".esri-view-root")),s=Kn.fromNode(n.node.querySelector(".esri-overlay-surface"));null!==e&&e.parent===s&&s.removeChild(t)}})],Ea.prototype,"container",void 0);class Wa extends La{constructor(t,e,i,n,s,o){super(t,e,i,n,s,o)}project(t,e){let i;i="number"==typeof t?{x:t,y:e,spatialReference:{wkid:4326}}:Array.isArray(t)?{x:t[0],y:t[1],spatialReference:{wkid:4326}}:{x:t.lng,y:t.lat,spatialReference:{wkid:4326}};const n=this.map.toScreen(i);return null!==n?new s.R2Point(n.x,n.y):s.R2Point.origin()}unproject(t,e){let i;i="number"==typeof t?{x:t,y:e}:Array.isArray(t)?{x:t[0],y:t[1]}:t;const n=this.map.toMap(i);return null!==n?new c.GeoPoint(n.longitude,n.latitude):c.GeoPoint.origin()}static create(t){let e,i=t.extent;null!==i?(i=La.webMercatorUtils.webMercatorToGeographic(i),e=new c.GeoBox(i.xmin,i.ymin,i.xmax,i.ymax)):e=c.GeoBox.undefined();const n=t.center,s=new c.GeoPoint(n.longitude,n.latitude),o=t.zoom,r=t.camera.heading,l=t.camera.tilt;return new Wa(t,e,s,o,r,l)}}class Na extends ka{constructor(t){super(),this.map=t,Object.defineProperty(this,"geoViewport",{value:Wa.create(t),writable:!0,enumerable:!0,configurable:!0}),this.onMapRender=this.onMapRender.bind(this),this.initMap(t)}initMap(t){t.watch("extent",this.onMapRender)}willSetGeoViewport(t,e){this.callObservers("viewWillSetGeoViewport",t,e,this)}onSetGeoViewport(t,e){}didSetGeoViewport(t,e){this.callObservers("viewDidSetGeoViewport",t,e,this)}updateGeoViewport(){const t=this.geoViewport,e=Wa.create(this.map);return!e.equals(t)&&(this.willSetGeoViewport(e,t),this.geoViewport=e,this.onSetGeoViewport(e,t),this.didSetGeoViewport(e,t),!0)}onMapRender(){if(this.updateGeoViewport()){const t=!this.isHidden()&&!this.culled;this.requireUpdate(fn.NeedsProject,t)}}moveTo(t,i){const n={},s={},o=this.geoViewport;let r=t.geoCenter;null!=r&&(r=c.GeoPoint.fromAny(r),o.geoCenter.equivalentTo(r,1e-5)||(n.center=[r.lng,r.lat]));const l=t.zoom;void 0===l||e.Equivalent(o.zoom,l,1e-5)||(n.zoom=l);const a=t.heading;void 0===a||e.Equivalent(o.heading,a,1e-5)||(n.heading=a);const h=t.tilt;void 0===h||e.Equivalent(o.tilt,h,1e-5)||(n.tilt=h),(i=void 0===i||!0===i?this.getLookOr(At.timing,Et.ambient,!1):e.Timing.fromAny(i))instanceof e.Timing&&(s.duration=i.duration),this.map.goTo(n,s)}}u([vn({extends:!0,didAttachView(t,e){null===this.owner.parent&&(t.appendChild(this.owner),t.setEventNode(this.owner.map.container.querySelector(".esri-view-root"))),ka.canvas.prototype.didAttachView.call(this,t,e)},willDetachView(t){ka.canvas.prototype.willDetachView.call(this,t),this.owner.parent===t&&t.removeChild(this.owner)}})],Na.prototype,"canvas",void 0),u([vn({extends:!0,didAttachView(t,e){const i=Kn.fromNode(this.owner.map.container),n=Kn.fromNode(i.node.querySelector(".esri-view-root")),s=Kn.fromNode(n.node.querySelector(".esri-view-surface"));this.owner.canvas.insertView(s),ka.container.prototype.didAttachView.call(this,t,e)},willDetachView(t){ka.container.prototype.willDetachView.call(this,t);const e=this.owner.canvas.view,i=Kn.fromNode(this.owner.map.container),n=Kn.fromNode(i.node.querySelector(".esri-view-root")),s=Kn.fromNode(n.node.querySelector(".esri-view-surface"));null!==e&&e.parent===s&&s.removeChild(t)}})],Na.prototype,"container",void 0),t.AngleThemeAnimator=Yt,t.Arc=ms,t.ArcView=bs,t.AreaPlotController=Zr,t.AreaPlotTrait=qr,t.AreaPlotView=Wr,t.AttributeAnimator=bn,t.AxisController=El,t.AxisTrait=Rl,t.AxisView=Tl,t.BooleanAttributeAnimator=An,t.BooleanThemeAnimator=jt,t.BottomAxisController=Bl,t.BottomAxisTrait=kl,t.BottomAxisView=Il,t.BottomTickView=xl,t.BoxShadow=rt,t.BoxShadowForm=at,t.BoxShadowInterpolator=lt,t.BoxShadowParser=ht,t.BoxShadowStyleAnimator=Ln,t.BrightnessFeel=kt,t.BubblePlotController=Xr,t.BubblePlotTrait=Ur,t.BubblePlotView=Or,t.ButtonGlow=ro,t.ButtonItem=ho,t.ButtonMembrane=lo,t.ButtonStack=co,t.CanvasRenderer=cs,t.CanvasView=ps,t.CellController=Do,t.CellTrait=So,t.CellView=wo,t.ChartController=ql,t.ChartTrait=Hl,t.ChartView=Ul,t.CircleIcon=Is,t.CircleIconInterpolator=Ms,t.ColController=Eo,t.ColLayout=vo,t.ColTrait=Oo,t.ColView=ko,t.Color=z,t.ColorAttributeAnimator=Dn,t.ColorChannel=q,t.ColorChannelParser=G,t.ColorForm=U,t.ColorLook=Tt,t.ColorParser=H,t.ColorStop=J,t.ColorStopInterpolator=$,t.ColorStopListParser=et,t.ColorStopParser=tt,t.ColorStyleAnimator=Rn,t.ColorThemeAnimator=Zt,t.ContinuousScaleAnimator=Vr,t.Controller=_s,t.ControllerContext=zs,t.ControllerRef=$s,t.ControllerRelation=Js,t.ControllerSet=to,t.CssContext=zn,t.CssRule=Un,t.DataPointController=Tr,t.DataPointTrait=xr,t.DataPointView=Ar,t.DataSetController=Pr,t.DataSetTrait=Dr,t.DeckBar=sr,t.DeckButton=$o,t.DeckButtonBackIcon=er,t.DeckButtonCloseIcon=tr,t.DeckButtonLabel=ir,t.DeckCard=or,t.DeckPost=Xo,t.DeckRail=Ko,t.DeckSlider=_o,t.DeckSliderItem=Qo,t.DeckSlot=Zo,t.DeckView=rr,t.DeckViewBar=lr,t.DeckViewCard=ar,t.DialController=pr,t.DialTrait=ur,t.DialView=cr,t.DisclosureButton=po,t.DisclosureCellView=Co,t.DisplayProvider=Hi,t.DisplayService=Ui,t.DomProvider=mn,t.DomService=wn,t.DownlinkTrait=V,t.DrawerButton=Yo,t.DrawerView=jo,t.DrawingRenderer=os,t.ElementView=Xn,t.EnclosedIcon=Ls,t.EnclosedIconInterpolator=ks,t.EphemeralStorageService=Ks,t.EquirectangularMapViewport=Da,t.EsriMapView=Ea,t.EsriMapViewport=Oa,t.EsriSceneView=Na,t.EsriSceneViewport=Wa,t.EsriView=ka,t.EsriViewport=La,t.ExecuteProvider=Hs,t.ExecuteService=Us,t.Expansion=gt,t.ExpansionInterpolator=ft,t.ExpansionThemeAnimator=$t,t.Feel=Rt,t.FeelVector=Mt,t.FeelVectorInterpolator=Ft,t.FillView=gs,t.FilledIcon=Ts,t.FloatingButton=ao,t.Focus=ct,t.FocusInterpolator=dt,t.FocusThemeAnimator=Qt,t.Font=E,t.FontFamily=k,t.FontFamilyParser=O,t.FontFamilyStyleAnimator=Fn,t.FontForm=N,t.FontInterpolator=W,t.FontLook=Pt,t.FontParser=B,t.FontSize=R,t.FontThemeAnimator=_t,t.GaugeController=vr,t.GaugeTrait=gr,t.GaugeView=fr,t.GenericController=Qs,t.GenericModel=m,t.GeoArcView=ra,t.GeoAreaController=ga,t.GeoAreaTrait=ua,t.GeoAreaView=ha,t.GeoCircleView=oa,t.GeoController=Kl,t.GeoGridController=sa,t.GeoGridTrait=na,t.GeoGridView=ia,t.GeoIconController=ba,t.GeoIconTrait=ma,t.GeoIconView=wa,t.GeoLayerController=$l,t.GeoLayerTrait=_l,t.GeoLayerView=Zl,t.GeoLineController=fa,t.GeoLineTrait=ca,t.GeoLineView=aa,t.GeoPathController=pa,t.GeoPathTrait=da,t.GeoPathView=la,t.GeoPerspective=Gl,t.GeoPlotView=ya,t.GeoPointView=va,t.GeoRasterView=ea,t.GeoRippleView=ta,t.GeoTrait=Xl,t.GeoTree=Ql,t.GeoTreeView=Jl,t.GeoView=Yl,t.GeoViewport=jl,t.Gesture=Qi,t.GestureInput=_i,t.GoogleMapView=Fa,t.GoogleMapViewport=Ra,t.GraphController=Jr,t.GraphTrait=Qr,t.GraphView=_r,t.GraphicsIconView=Ws,t.GraphicsRenderer=is,t.GraphicsView=ns,t.HeaderController=Bo,t.HeaderTrait=No,t.HeaderView=Wo,t.HexColorParser=X,t.HistoryProvider=js,t.HistoryService=Gs,t.HistoryState=qs,t.HslColor=Z,t.HslColorInterpolator=_,t.HslColorParser=Q,t.HtmlIconView=Bs,t.HtmlView=Kn,t.HtmlViewTagFactory=Zn,t.Icon=Ds,t.IconButton=uo,t.IconCellController=Po,t.IconCellTrait=xo,t.IconCellView=bo,t.IconGraphicsAnimator=Es,t.IconLayout=xs,t.IconView=Os,t.InputTokenView=go,t.InterpolatedFeel=Lt,t.LayerView=ss,t.LayoutProvider=Gi,t.LayoutService=qi,t.LeafController=Mo,t.LeafTrait=Io,t.LeafView=Vo,t.LeafletView=Ma,t.LeafletViewport=Ia,t.LeftAxisController=zl,t.LeftAxisTrait=Ol,t.LeftAxisView=Ml,t.LeftTickView=Dl,t.LengthAttributeAnimator=xn,t.LengthLook=Dt,t.LengthStyleAnimator=Mn,t.LengthStyleConstraintAnimator=Wn,t.LengthThemeAnimator=Xt,t.LengthThemeConstraintAnimator=ie,t.LineHeight=F,t.LinePlotController=Kr,t.LinePlotTrait=Hr,t.LinePlotView=Er,t.LinearGradient=it,t.LinearGradientAngleParser=st,t.LinearGradientInterpolator=nt,t.LinearGradientParser=ot,t.Look=At,t.LookVector=St,t.MapController=Aa,t.MapDownlinkTrait=M,t.MapTrait=Sa,t.MapView=Ca,t.MapboxView=Va,t.MapboxViewport=Pa,t.MediaRule=qn,t.Modal=Xi,t.ModalProvider=Zi,t.ModalService=Ki,t.Model=w,t.ModelContext=p,t.ModelRef=C,t.ModelRelation=b,t.ModelSet=S,t.MomentumGesture=on,t.MomentumGestureInput=sn,t.Mood=Et,t.MoodMatrix=Nt,t.MoodVector=Wt,t.MouseMomentumGesture=an,t.MousePositionGesture=nn,t.MouseScaleGesture=pn,t.NodeView=jn,t.NumberAttributeAnimator=Sn,t.NumberLook=xt,t.NumberStyleAnimator=In,t.NumberStyleConstraintAnimator=En,t.NumberThemeAnimator=Gt,t.NumberThemeConstraintAnimator=ee,t.NumberTickGenerator=wl,t.OpacityFeel=Ot,t.PaintingRenderer=as,t.PathContext=rs,t.PathRenderer=ls,t.PieController=Sr,t.PieTrait=Cr,t.PieView=br,t.PlotController=Gr,t.PlotTrait=Nr,t.PointerMomentumGesture=rn,t.PointerPositionGesture=tn,t.PointerScaleGesture=cn,t.PolygonIcon=Rs,t.PolygonIconInterpolator=Fs,t.PopoverView=Go,t.PositionGesture=$i,t.PositionGestureInput=Ji,t.Presence=pt,t.PresenceInterpolator=ut,t.PresenceThemeAnimator=Jt,t.RasterView=fs,t.Rect=ys,t.RectView=ws,t.RefreshProvider=g,t.RefreshService=f,t.RgbColor=j,t.RgbColorInterpolator=Y,t.RgbColorParser=K,t.RightAxisController=Nl,t.RightAxisTrait=Ll,t.RightAxisView=Vl,t.RightTickView=Al,t.RowController=Lo,t.RowTrait=Fo,t.RowView=Ro,t.ScaleGesture=dn,t.ScaleGestureInput=hn,t.ScaledView=Fr,t.ScaledXView=Ir,t.ScaledXYView=Rr,t.ScaledYView=Mr,t.ScatterPlotController=jr,t.ScatterPlotTrait=Br,t.ScatterPlotView=Lr,t.ScrimView=qo,t.SelectableTrait=P,t.SelectionProvider=y,t.SelectionService=v,t.SeriesPlotController=Yr,t.SeriesPlotTrait=zr,t.SeriesPlotView=kr,t.ShadowLook=Vt,t.SliceController=mr,t.SliceTrait=wr,t.SliceView=yr,t.Sprite=$n,t.SpriteService=es,t.SpriteSheet=ts,t.StorageProvider=Zs,t.StorageService=Ys,t.StringAttributeAnimator=Cn,t.StringStyleAnimator=Vn,t.StringThemeAnimator=qt,t.StrokeView=vs,t.StyleAnimator=Pn,t.StyleConstraintAnimator=On,t.StyleContext=Nn,t.StyleMap=Bn,t.StyleRule=Hn,t.StyleSheet=Gn,t.StyleValue=vt,t.StyleValueForm=yt,t.StyleValueParser=wt,t.StyleView=_n,t.SvgContext=hs,t.SvgIconView=Ns,t.SvgRenderer=ds,t.SvgView=Qn,t.SvgViewTagFactory=Jn,t.TableController=Ho,t.TableLayout=yo,t.TableTrait=Uo,t.TableView=zo,t.TextCellController=To,t.TextCellTrait=Ao,t.TextCellView=mo,t.TextRun=Ss,t.TextRunView=As,t.TextView=Yn,t.Theme=Bt,t.ThemeAnimator=Ht,t.ThemeConstraintAnimator=te,t.ThemeContext=Ut,t.ThemeMatrix=zt,t.ThemeProvider=Yi,t.ThemeService=ji,t.TickGenerator=yl,t.TickView=Cl,t.TimeTickGenerator=ml,t.TimingLook=It,t.TitleDeckBar=dr,t.TitleDeckView=class extends rr{constructor(t){super(t),this.initBar()}initBar(){let t=this.bar.view;t instanceof dr||(t=dr.create(),this.bar.setView(t))}willPushCard(t,e){super.willPushCard(t,e);const n=this.bar.view;if(n instanceof dr){n.pushTitle(t.cardTitle.getStateOr(""));const e=n.backMembrane.view;null!==e&&e.pointerEvents.setState("none",i.Affinity.Intrinsic)}}didPushCard(t,e){const n=this.bar.view;if(n instanceof dr){const t=n.backMembrane.view;null!==t&&t.pointerEvents.setState("auto",i.Affinity.Intrinsic)}super.didPushCard(t,e)}willPopCard(t,e){super.willPopCard(t,e);const i=this.bar.view;i instanceof dr&&i.popTitle()}didPressBackButton(t){this.deckPhase.tweening||this.popCard(),super.didPressBackButton(t)}},t.ToAttributeString=mt,t.ToCssValue=Ct,t.ToStyleString=bt,t.TokenView=fo,t.TopAxisController=Wl,t.TopAxisTrait=Fl,t.TopAxisView=Pl,t.TopTickView=Sl,t.TouchMomentumGesture=ln,t.TouchPositionGesture=en,t.TouchScaleGesture=un,t.Trait=A,t.TraitControllerRef=io,t.TraitControllerSet=no,t.TraitRef=D,t.TraitRelation=x,t.TraitSet=T,t.TraitViewControllerRef=so,t.TraitViewControllerSet=oo,t.TraitViewRef=eo,t.TransformAttributeAnimator=Tn,t.TransformStyleAnimator=kn,t.TransformThemeAnimator=Kt,t.TypesetView=Cs,t.ValueDownlinkTrait=I,t.VectorIcon=Ps,t.VectorIconInterpolator=Vs,t.View=fn,t.ViewContext=Ni,t.ViewRef=vn,t.ViewRelation=gn,t.ViewSet=yn,t.Viewport=Wi,t.ViewportProvider=zi,t.ViewportService=Bi,t.WebGLRenderer=us,t.WebStorageService=Xs,t.WorldMapView=Ta,t.WorldMapViewport=xa,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=swim-toolkit.min.js.map