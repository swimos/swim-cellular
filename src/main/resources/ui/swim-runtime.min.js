// swim-runtime-4.0.0-dev.20210927.1; copyright 2015-2021 Swim Inc.
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).swim=t.swim||{})}(this,(function(t){"use strict";function e(t,e,r,i){var n,s=arguments.length,o=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(s<3?n(o):s>3?n(e,r,o):n(e,r))||o);return s>3&&o&&Object.defineProperty(e,r,o),o}const r=function(){const t={};return"undefined"!=typeof window&&void 0!==window.crypto?t.fillBytes=function(t){window.crypto.getRandomValues(t)}:"undefined"!=typeof window&&void 0!==window.msCrypto?t.fillBytes=function(t){window.msCrypto.getRandomValues(t)}:t.fillBytes=function(t){if(t instanceof Int8Array)for(let e=0;e<t.length;e+=1)t[e]=128-Math.round(256*Math.random());else if(t instanceof Uint8Array)for(let e=0;e<t.length;e+=1)t[e]=Math.round(256*Math.random());else if(t instanceof Int16Array)for(let e=0;e<t.length;e+=1)t[e]=32768-Math.round(65536*Math.random());else if(t instanceof Uint16Array)for(let e=0;e<t.length;e+=1)t[e]=Math.round(65536*Math.random());else if(t instanceof Int32Array)for(let e=0;e<t.length;e+=1)t[e]=2147483648-Math.round(4294967296*Math.random());else{if(!(t instanceof Uint32Array))throw new TypeError(""+t);for(let e=0;e<t.length;e+=1)t[e]=Math.round(4294967296*Math.random())}},t}(),i=function(){const t={};return Object.defineProperty(t,"BigEndian",{value:"BE",enumerable:!0}),Object.defineProperty(t,"LittleEndian",{value:"LE",enumerable:!0}),Object.defineProperty(t,"NativeOrder",{get(){let e;const r=new ArrayBuffer(2);new Uint16Array(r)[0]=65279;const i=new Uint8Array(r);if(254===i[0]&&255===i[1])e=t.BigEndian;else{if(255!==i[0]||254!==i[1])throw new Error;e=t.LittleEndian}return Object.defineProperty(t,"NativeOrder",{value:e,enumerable:!0}),e},configurable:!0,enumerable:!0}),t}(),n=function(){const t={mix:function(e,r){return r=3432918353*(65535&r)+((3432918353*(r>>>16)&65535)<<16)&4294967295,e^=r=461845907*(65535&(r=t.rotl(r,15)))+((461845907*(r>>>16)&65535)<<16)&4294967295,e=27492+(65535&(e=5*(65535&(e=t.rotl(e,13)))+((5*(e>>>16)&65535)<<16)&4294967295))+((58964+(e>>>16)&65535)<<16)},mixUint8Array:function(e,r){if(i.NativeOrder===i.BigEndian)return t.mixUint8ArrayBE(e,r);if(i.NativeOrder===i.LittleEndian)return t.mixUInt8ArrayLE(e,r);throw new Error},mixUint8ArrayBE:function(e,r){let i=0;const n=r.length;for(;i+3<n;){const n=(255&r[i])<<24|(255&r[i+1])<<16|(255&r[i+2])<<8|255&r[i+3];e=t.mix(e,n),i+=4}if(i<n){let s=(255&r[i])<<24;i+1<n&&(s|=(255&r[i+1])<<16,i+2<n&&(s|=(255&r[i+2])<<8)),s=3432918353*(65535&s)+((3432918353*(s>>>16)&65535)<<16)&4294967295,s=t.rotl(s,15),s=461845907*(65535&s)+((461845907*(s>>>16)&65535)<<16)&4294967295,e^=s}return e^n},mixUInt8ArrayLE:function(e,r){let i=0;const n=r.length;for(;i+3<n;){const n=255&r[i]|(255&r[i+1])<<8|(255&r[i+2])<<16|(255&r[i+3])<<24;e=t.mix(e,n),i+=4}if(i<n){let s=255&r[i];i+1<n&&(s|=(255&r[i+1])<<8,i+2<n&&(s|=(255&r[i+2])<<16)),s=3432918353*(65535&s)+((3432918353*(s>>>16)&65535)<<16)&4294967295,s=t.rotl(s,15),s=461845907*(65535&s)+((461845907*(s>>>16)&65535)<<16)&4294967295,e^=s}return e^n},mixString:function(e,r){if(i.NativeOrder===i.BigEndian)return t.mixStringBE(e,r);if(i.NativeOrder===i.LittleEndian)return t.mixStringLE(e,r);throw new Error},mixStringBE:function(e,r){let i=0,n=32,s=0;const o=r.length;let a=0;for(;s<o;){let o=r.codePointAt(s);void 0===o&&(o=r.charCodeAt(s)),o>=0&&o<=127?(n-=8,i|=o<<n,0===n&&(e=t.mix(e,i),i=0,n=32),a+=1):o>=128&&o<=2047?(n-=8,i|=(192|o>>>6)<<n,0===n&&(e=t.mix(e,i),i=0,n=32),n-=8,i|=(128|63&o)<<n,0===n&&(e=t.mix(e,i),i=0,n=32),a+=2):o>=2048&&o<=65535||o>=57344&&o<=65535?(n-=8,i|=(224|o>>>12)<<n,0===n&&(e=t.mix(e,i),i=0,n=32),n-=8,i|=(128|o>>>6&63)<<n,0===n&&(e=t.mix(e,i),i=0,n=32),n-=8,i|=(128|63&o)<<n,0===n&&(e=t.mix(e,i),i=0,n=32),a+=3):o>=65536&&o<=1114111?(n-=8,i|=(240|o>>>18)<<n,0===n&&(e=t.mix(e,i),i=0,n=32),n-=8,i|=(128|o>>>12&63)<<n,0===n&&(e=t.mix(e,i),i=0,n=32),n-=8,i|=(128|o>>>6&63)<<n,0===n&&(e=t.mix(e,i),i=0,n=32),n-=8,i|=(128|63&o)<<n,0===n&&(e=t.mix(e,i),i=0,n=32),a+=4):(n-=8,i|=239<<n,0===n&&(e=t.mix(e,i),i=0,n=32),n-=8,i|=191<<n,0===n&&(e=t.mix(e,i),i=0,n=32),n-=8,i|=189<<n,0===n&&(e=t.mix(e,i),i=0,n=32),a+=3),s=l.offsetByCodePoints(r,s,1)}return 32!==n&&(i=3432918353*(65535&i)+((3432918353*(i>>>16)&65535)<<16)&4294967295,i=t.rotl(i,15),i=461845907*(65535&i)+((461845907*(i>>>16)&65535)<<16)&4294967295,e^=i),e^a},mixStringLE:function(e,r){let i=0,n=0,s=0;const o=r.length;let a=0;for(;s<o;){let o=r.codePointAt(s);void 0===o&&(o=r.charCodeAt(s)),o>=0&&o<=127?(i|=o<<n,n+=8,32===n&&(e=t.mix(e,i),i=0,n=0),a+=1):o>=128&&o<=2047?(i|=(192|o>>>6)<<n,n+=8,32===n&&(e=t.mix(e,i),i=0,n=0),i|=(128|63&o)<<n,n+=8,32===n&&(e=t.mix(e,i),i=0,n=0),a+=2):o>=2048&&o<=65535||o>=57344&&o<=65535?(i|=(224|o>>>12)<<n,n+=8,32===n&&(e=t.mix(e,i),i=0,n=0),i|=(128|o>>>6&63)<<n,n+=8,32===n&&(e=t.mix(e,i),i=0,n=0),i|=(128|63&o)<<n,n+=8,32===n&&(e=t.mix(e,i),i=0,n=0),a+=3):o>=65536&&o<=1114111?(i|=(240|o>>>18)<<n,n+=8,32===n&&(e=t.mix(e,i),i=0,n=0),i|=(128|o>>>12&63)<<n,n+=8,32===n&&(e=t.mix(e,i),i=0,n=0),i|=(128|o>>>6&63)<<n,n+=8,32===n&&(e=t.mix(e,i),i=0,n=0),i|=(128|63&o)<<n,n+=8,32===n&&(e=t.mix(e,i),i=0,n=0),a+=4):(i|=239<<n,n+=8,32===n&&(e=t.mix(e,i),i=0,n=0),i|=191<<n,n+=8,32===n&&(e=t.mix(e,i),i=0,n=0),i|=189<<n,n+=8,32===n&&(e=t.mix(e,i),i=0,n=0),a+=3),s=l.offsetByCodePoints(r,s,1)}return 32!==n&&(i=3432918353*(65535&i)+((3432918353*(i>>>16)&65535)<<16)&4294967295,i=t.rotl(i,15),i=461845907*(65535&i)+((461845907*(i>>>16)&65535)<<16)&4294967295,e^=i),e^a},mash:function(t){return t=2246822507*(65535&(t^=t>>>16))+((2246822507*(t>>>16)&65535)<<16)&4294967295,t=3266489909*(65535&(t^=t>>>13))+((3266489909*(t>>>16)&65535)<<16)&4294967295,(t^=t>>>16)>>>0},rotl:function(t,e){return t<<e|t>>>32-e}};return t}(),s=function(t,e,r){const i=r.writable,n=r.enumerable,s=r.configurable;if(void 0!==r.get){const o=r.get;r.get=function(){const r=o.call(this);return Object.defineProperty(t,e,{value:r,writable:i,enumerable:n,configurable:s}),r}}else{if(void 0===r.value)throw new Error("invalid lazy property descriptor");{const o=r.value;r.value=function(){const r=o.call(this);return Object.defineProperty(t,e,{value:function(){return r},writable:i,enumerable:n,configurable:s}),r}}}},o=function(){const t={compare:function(e,r){if("object"==typeof e&&null!==e){if("object"==typeof r&&null!==r){const i=t.hash(e),n=t.hash(r);return i<n?-1:i>n?1:0}return-1}return null===e?void 0===r?-1:null===r?0:1:void 0===e?void 0===r?0:1:NaN}};let e=1;return t.hash=function(t){if("object"==typeof t&&null!==t){let r=t._hashCode;return void 0===r&&(r=~~e,e+=1,Object.defineProperty(t,"_hashCode",{value:r,configurable:!0})),r}if(null===t)return 1;if(void 0===t)return 0;throw new TypeError(""+t)},t}(),a=function(){const t={compare:function(t,e){return"boolean"==typeof t?"boolean"==typeof e?t&&!e?-1:!t&&e?1:0:-1:null===t?void 0===e?-1:null===e?0:1:void 0===t?void 0===e?0:1:NaN},hash:function(t){if(!0===t)return 3;if(!1===t)return 2;if(null===t)return 1;if(void 0===t)return 0;throw new TypeError(""+t)}};return t}(),u=function(){const t=function(t,e,r){return t===e||null!=t&&"function"==typeof t.equivalentTo&&t.equivalentTo(e,r)};return t.is=function(t){return null!=t&&"function"==typeof t.equivalentTo},t.Epsilon=1e-8,t}(),h=function(){const t={equal:function(t,e){return t===e||"number"==typeof t&&"number"==typeof e&&isNaN(t)&&isNaN(e)},equivalent:function(t,e,r){return t===e||"number"==typeof t&&"number"==typeof e&&(isNaN(t)&&isNaN(e)||Math.abs(e-t)<(void 0!==r?r:u.Epsilon))},compare:function(t,e){return"number"==typeof t?"number"==typeof e?t<e?-1:t>e?1:isNaN(e)?isNaN(t)?0:-1:isNaN(t)?1:0:-1:null===t?void 0===e?-1:null===e?0:1:void 0===t?void 0===e?0:1:NaN}},e=new ArrayBuffer(8),r=new Float64Array(e),i=new Int32Array(e);return t.hash=function(t){if("number"==typeof t)return t===~~t?~~t:(r[0]=t,i[0]^i[1]);if(null===t)return 1;if(void 0===t)return 0;throw new TypeError(""+t)},t}(),l=function(){const t={compare:function(t,e){return"string"==typeof t?"string"==typeof e?t<e?-1:t>e?1:0:-1:null===t?void 0===e?-1:null===e?0:1:void 0===t?void 0===e?0:1:NaN},hash:function(t){if("string"==typeof t)return n.mash(n.mixString(0,t));if(null===t)return 1;if(void 0===t)return 0;throw new TypeError(""+t)},codePointAt:function(t,e){const r=t.length;if((e=e?Number(e):0)!=e&&(e=0),e>=0&&e<r){const i=t.charCodeAt(e);if(i<=55295||i>=57344)return i;if(i<=56319&&e+1<r){const r=t.charCodeAt(e+1);if(r>=56320&&r<=57343)return 65536+((1023&i)<<10+r&1023)}}},offsetByCodePoints:function(t,e,r){if(r>0){const i=t.length;for(;r>0&&e<i;){const n=t.charCodeAt(e);if(n<=55295||n>=57344)e+=1;else if(n<=56319&&e+1<i){const r=t.charCodeAt(e+1);e+=r>=56320&&r<=57343?2:1}else e+=1;r-=1}}else if(r<0)for(;r<0&&e>0;){const i=t.charCodeAt(e-1);if(i<=55295||i>=57344)e-=1;else if(i>=56320&&i<=57343&&e-1>0){const r=t.charCodeAt(e-2);e-=r>=55296&&r<=57343?2:1}else e-=1;r-=1}return e}};return t}(),c=function(){const t={isStartChar:function(t){return t>=65&&t<=90||95===t||t>=97&&t<=122||t>=192&&t<=214||t>=216&&t<=246||t>=248&&t<=767||t>=880&&t<=893||t>=895&&t<=8191||t>=8204&&t<=8205||t>=8304&&t<=8591||t>=11264&&t<=12271||t>=12289&&t<=55295||t>=63744&&t<=64975||t>=65008&&t<=65533||t>=65536&&t<=983039},isPartChar:function(t){return 45===t||t>=48&&t<=57||t>=65&&t<=90||95===t||t>=97&&t<=122||183===t||t>=192&&t<=214||t>=216&&t<=246||t>=248&&t<=893||t>=895&&t<=8191||t>=8204&&t<=8205||t>=8255&&t<=8256||t>=8304&&t<=8591||t>=11264&&t<=12271||t>=12289&&t<=55295||t>=63744&&t<=64975||t>=65008&&t<=65533||t>=65536&&t<=983039},isValid:function(e){const r=e.length;if(0!==r){let i=e.codePointAt(0);if(void 0!==i&&t.isStartChar(i)){let n=l.offsetByCodePoints(e,0,1);for(;n<r&&(i=e.codePointAt(0),void 0!==i&&t.isPartChar(i));)n=l.offsetByCodePoints(e,n,1);return n===r&&!t.isReserved(e)}}return!1},isReserved:function(t){switch(t){case"await":case"break":case"case":case"catch":case"class":case"const":case"continue":case"debugger":case"default":case"delete":case"do":case"else":case"enum":case"export":case"extends":case"false":case"finally":case"for":case"function":case"if":case"import":case"in":case"instanceof":case"new":case"null":case"return":case"super":case"switch":case"this":case"throw":case"true":case"try":case"typeof":case"var":case"void":case"while":case"with":case"yield":return!0;default:return!1}}};return t}(),d=function(){const t={compare:function(e,r){if("function"==typeof e){if("function"==typeof r){const i=t.hash(e),n=t.hash(r);return i<n?-1:i>n?1:0}return-1}return null===e?void 0===r?-1:null===r?0:1:void 0===e?void 0===r?0:1:NaN}};let e=-1;return t.hash=function(t){if("function"==typeof t){let r=t._hashCode;return void 0===r&&(r=~~e,e-=1,Object.defineProperty(t,"_hashCode",{value:r,configurable:!0})),r}if(null===t)return 1;if(void 0===t)return 0;throw new TypeError(""+t)},t}(),p=function(){const t={compare:function(e,r){if("function"==typeof e){if("function"==typeof r){const i=t.hash(e),n=t.hash(r);return i<n?-1:i>n?1:0}return-1}return null===e?void 0===r?-1:null===r?0:1:void 0===e?void 0===r?0:1:NaN},hash:function(t){if("function"==typeof t){let e=t._hashCode;return void 0===e&&(e=n.mash(n.mixString(0,t.name)),Object.defineProperty(t,"_hashCode",{value:e,configurable:!0})),e}if(null===t)return 1;if(void 0===t)return 0;throw new TypeError(""+t)}};return t}(),f=function(){const t=function(t,e){return t===e||null!=t&&"function"==typeof t.equals&&t.equals(e)};return t.is=function(t){return null!=t&&"function"==typeof t.equals},t}(),y=function(){const t=function(t){return void 0===t?0:null===t?1:t.hashCode()};return t.is=function(t){return null!=t&&"function"==typeof t.hashCode},t}(),m=function(){const t=function(t,e){return void 0===t?void 0===e?0:1:null===t?void 0===e?-1:null===e?0:1:"function"==typeof t.compareTo?null==e?-1:t.compareTo(e):NaN};return t.is=function(t){return null!=t&&"function"==typeof t.compareTo},t}(),w=function(){const t={equal:function(t,e){if(t===e)return!0;if("object"==typeof t&&null!==t&&"object"==typeof e&&null!==e){const r=Object.keys(t),i=Object.keys(e),n=r.length;if(n!==i.length)return!1;for(let s=0;s<n;s+=1){const n=r[s];if(n!==i[s]||!g.equal(t[n],e[n]))return!1}return!0}return!1},equivalent:function(t,e,r){if(t===e)return!0;if("object"==typeof t&&null!==t&&"object"==typeof e&&null!==e){const i=Object.keys(t),n=Object.keys(e),s=i.length;if(s!==n.length)return!1;for(let o=0;o<s;o+=1){const s=i[o];if(s!==n[o]||!g.equivalent(t[s],e[s],r))return!1}return!0}return!1},compare:function(t,e){if("object"==typeof t&&null!==t){if("object"==typeof e&&null!==e){if(t!==e){const r=Object.keys(t),i=Object.keys(e),n=r.length,s=i.length,o=Math.min(n,s);let a=0;for(let n=0;n<o&&0===a;n+=1){const s=r[n],o=i[n];a=l.compare(s,o),0===a&&(a=g.compare(t[s],e[o]))}return 0!==a?a:n>s?1:n<s?-1:0}return 0}return-1}return null===t?void 0===e?-1:null===e?0:1:void 0===t?void 0===e?0:1:NaN},hash:function(t){if("object"==typeof t&&null!==t){let e=0;const r=Object.keys(t);for(let i=0,s=r.length;i<s;i+=1){const s=r[i];e=n.mix(n.mix(e,l.hash(s)),g.hash(t[s]))}return n.mash(e)}if(null===t)return 1;if(void 0===t)return 0;throw new TypeError(""+t)}};return t}(),g=function(){const t={equal:function(t,e){if(t instanceof Date&&(t=t.getTime()),e instanceof Date&&(e=e.getTime()),t===e)return!0;if("number"==typeof t){if("number"==typeof e)return isNaN(t)&&isNaN(e)}else{if(f.is(t))return t.equals(e);if(Array.isArray(t)){if(Array.isArray(e))return v.equal(t,e)}else if("object"==typeof t&&null!==t&&"object"==typeof e&&null!==e)return w.equal(t,e)}return!1},hash:function(t){if(void 0===t)return 0;if(null===t)return 1;if(!1===t)return 2;if(!0===t)return 3;if("number"==typeof t)return h.hash(t);if("string"==typeof t)return l.hash(t);if(y.is(t))return t.hashCode();if("function"==typeof t)return d.hash(t);if(Array.isArray(t))return v.hash(t);if("object"==typeof t)return w.hash(t);throw new TypeError(""+t)},equivalent:function(t,e,r=u.Epsilon){if(t instanceof Date&&(t=t.getTime()),e instanceof Date&&(e=e.getTime()),t===e)return!0;if("number"==typeof t){if("number"==typeof e)return isNaN(t)&&isNaN(e)||Math.abs(e-t)<r}else{if(u.is(t))return t.equivalentTo(e,r);if(Array.isArray(t)){if(Array.isArray(e))return v.equivalent(t,e,r)}else if("object"==typeof t&&null!==t&&"object"==typeof e&&null!==e)return w.equivalent(t,e,r)}return!1},compare:function(t,e){return t instanceof Date&&(t=t.getTime()),e instanceof Date&&(e=e.getTime()),void 0===t?void 0===e?0:1:null===t?void 0===e?-1:null===e?0:1:"boolean"==typeof t?null==e?-1:"boolean"==typeof e?t&&!e?-1:!t&&e?1:0:1:"number"==typeof t?null==e||"boolean"==typeof e?-1:"number"==typeof e?t<e?-1:t>e?1:isNaN(e)?isNaN(t)?0:-1:isNaN(t)?1:0:1:"string"==typeof t?null==e||"boolean"==typeof e||"number"==typeof e?-1:"string"==typeof e?t<e?-1:t>e?1:0:1:m.is(t)?t.compareTo(e):"function"==typeof t?null==e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e?-1:"function"==typeof e?d.compare(t,e):1:Array.isArray(t)?null==e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"function"==typeof e?-1:Array.isArray(e)?v.compare(t,e):1:"object"==typeof t?null==e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"function"==typeof e||Array.isArray(e)?-1:"object"==typeof e?w.compare(t,e):1:NaN}};return t}(),v=function(){const t={};return Object.defineProperty(t,"empty",{value:Object.freeze([]),enumerable:!0,configurable:!0}),t.inserted=function(t,e){const r=null!=e?e.length:0,i=new Array(r+1);for(let n=0;n<r;n+=1){const r=e[n];if(r===t)return e;i[n]=r}return i[r]=t,i},t.removed=function(e,r){const i=null!=r?r.length:0;if(0===i)return null!=r?r:t.empty;if(1===i)return r[0]!==e?r:t.empty;{const t=new Array(i-1);let n=0;for(;n<i;){const s=r[n];if(s===e){for(n+=1;n<i;)t[n-1]=r[n],n+=1;return t}t[n]=s,n+=1}return r}},t.equal=function(t,e){if(t===e)return!0;if("object"==typeof t&&null!==t&&"object"==typeof e&&null!==e){const r=t.length;if(r!==e.length)return!1;for(let i=0;i<r;i+=1)if(!g.equal(t[i],e[i]))return!1;return!0}return!1},t.equivalent=function(t,e,r){if(t===e)return!0;if("object"==typeof t&&null!==t&&"object"==typeof e&&null!==e){const i=t.length;if(i!==e.length)return!1;for(let n=0;n<i;n+=1)if(!g.equivalent(t[n],e[n],r))return!1;return!0}return!1},t.compare=function(t,e){if("object"==typeof t&&null!==t){if("object"==typeof e&&null!==e){if(t!==e){const r=t.length,i=e.length;let n=0;for(let s=0,o=Math.min(r,i);s<o&&0===n;s+=1)n=g.compare(t[s],e[s]);return 0!==n?n:r>i?1:r<i?-1:0}return 0}return-1}return null===t?void 0===e?-1:null===e?0:1:void 0===t?void 0===e?0:1:NaN},t.hash=function(t){if("object"==typeof t&&null!==t){let e=0;for(let r=0,i=t.length;r<i;r+=1)e=n.mix(e,g.hash(t[r]));return n.mash(e)}if(null===t)return 1;if(void 0===t)return 0;throw new TypeError(""+t)},t}(),b=function(){const t={is:function(t){return null!=t&&"function"==typeof t.fromAny}};return t}(),x=function(){const t={is:function(t){return null!=t&&"function"==typeof t.toAny}};return t}(),C=function(t){const e=function(t,r){const i=function(t){return i.range(i.domain(t))};return Object.setPrototypeOf(i,e.prototype),i.domain=t,i.range=r,i};return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.prototype.equivalentTo=function(t,r){return this===t||t instanceof e&&(this.domain.equivalentTo(t.domain,r)&&this.range.equivalentTo(t.range,r))},e.prototype.canEqual=function(t){return t instanceof e},e.prototype.equals=function(t){return this===t||t instanceof e&&(t.canEqual(this)&&this.domain.equals(t.domain)&&this.range.equals(t.range))},e.prototype.toString=function(){return"Mapping("+this.domain+", "+this.range+")"},e}(Function),O=function(t){const e=function(t,r){const i=function(t){return g.equal(t,i[1])?1:0};return Object.setPrototypeOf(i,e.prototype),i[0]=t,i[1]=r,i};return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,Object.defineProperty(e.prototype,"domain",{get(){return this},configurable:!0}),Object.defineProperty(e.prototype,"range",{get:()=>S.unit,configurable:!0}),e.prototype.contains=function(t){return g.compare(this[0],t)<=0&&g.compare(t,this[1])<=0},e.prototype.equivalentTo=function(t,r){return this===t||t instanceof e&&(g.equivalent(this[0],t[0],r)&&g.equivalent(this[1],t[1],r))},e.prototype.canEqual=function(t){return t instanceof e},e.prototype.equals=function(t){return this===t||t instanceof e&&(t.canEqual(this)&&g.equal(this[0],t[0])&&g.equal(this[1],t[1]))},e.prototype.toString=function(){return"Domain("+this[0]+", "+this[1]+")"},Object.defineProperty(e,"unit",{get(){const t=U(0,1);return Object.defineProperty(e,"unit",{value:t,enumerable:!0,configurable:!0}),t},enumerable:!0,configurable:!0}),e}(C),S=function(t){const e=function(t,r){const i=function(t){return t<1?i[0]:i[1]};return Object.setPrototypeOf(i,e.prototype),i[0]=t,i[1]=r,i};return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,Object.defineProperty(e.prototype,"domain",{get:()=>O.unit,configurable:!0}),Object.defineProperty(e.prototype,"range",{get(){return this},configurable:!0}),e.prototype.equivalentTo=function(t,r){return this===t||t instanceof e&&(g.equivalent(this[0],t[0],r)&&g.equivalent(this[1],t[1],r))},e.prototype.canEqual=function(t){return t instanceof e},e.prototype.equals=function(t){return this===t||t instanceof e&&(t.canEqual(this)&&g.equal(this[0],t[0])&&g.equal(this[1],t[1]))},e.prototype.toString=function(){return"Range("+this[0]+", "+this[1]+")"},Object.defineProperty(e,"unit",{get(){const t=N(0,1);return Object.defineProperty(e,"unit",{value:t,enumerable:!0,configurable:!0}),t},enumerable:!0,configurable:!0}),e}(C),E=function(){const t=function(t,e){return null!=t&&"function"==typeof t.interpolateTo?t.interpolateTo(e):null};return t.is=function(t){return null!=t&&"function"==typeof t.interpolateTo},t}(),k=function(t){const e=function(t,e){let r;return t===e?r=M(t):"number"==typeof t&&"number"==typeof e?r=I(t,e):Array.isArray(t)&&Array.isArray(e)?r=P(t,e):(r=E(t,e),null===r&&(r=D(t,e))),r};return(e.prototype=Object.create(t.prototype)).constructor=e,e.prototype.map=function(t){return A(this,t)},e.prototype.interpolateTo=function(t){return t instanceof e?T(this,t):null},e.prototype.canEqual=function(t){return t instanceof this.constructor},e.prototype.equals=function(t){return this===t||t instanceof e&&(t.canEqual(this)&&g.equal(this[0],t[0])&&g.equal(this[1],t[1]))},e.prototype.toString=function(){return"Interpolator("+this[0]+", "+this[1]+")"},e}(S),A=function(t){const e=function(t,r){const i=function(t){return i.transform(i.interpolator(t))};return Object.setPrototypeOf(i,e.prototype),i.interpolator=t,i.transform=r,i};return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,Object.defineProperty(e.prototype,0,{get(){return this.transform(this.interpolator[0])},configurable:!0}),Object.defineProperty(e.prototype,1,{get(){return this.transform(this.interpolator[1])},configurable:!0}),e.prototype.equals=function(t){return this===t||t instanceof e&&(this.interpolator.equals(t.interpolator)&&this.transform===t.transform)},e}(k),M=function(t){const e=function(t){const r=function(t){return r.value};return Object.setPrototypeOf(r,e.prototype),r.value=t,r};return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,Object.defineProperty(e.prototype,0,{get(){return this.value},configurable:!0}),Object.defineProperty(e.prototype,1,{get(){return this.value},configurable:!0}),e.prototype.equals=function(t){return this===t||t instanceof e&&this.value===t.value},e}(k),D=function(t){const e=function(t,r){const i=function(t){return t<1?i[0]:i[1]};return Object.setPrototypeOf(i,e.prototype),i[0]=t,i[1]=r,i};return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e}(k),I=function(t){const e=function(t,r){const i=function(t){const e=i[0];return e+t*(i[1]-e)};return Object.setPrototypeOf(i,e.prototype),i[0]=t,i[1]=r,i};return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e}(k),P=function(t){const e=function(t,r){const i=function(t){const e=i.interpolators,r=e.length,n=new Array(r);for(let i=0;i<r;i+=1)n[i]=e[i](t);return n};Object.setPrototypeOf(i,e.prototype);const n=Math.min(t.length,r.length),s=new Array(n);for(let e=0;e<n;e+=1)s[e]=k(t[e],r[e]);return i.interpolators=s,i};return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,Object.defineProperty(e.prototype,0,{get(){const t=this.interpolators,e=t.length,r=new Array(e);for(let i=0;i<e;i+=1)r[i]=t[i][0];return r},configurable:!0}),Object.defineProperty(e.prototype,1,{get(){const t=this.interpolators,e=t.length,r=new Array(e);for(let i=0;i<e;i+=1)r[i]=t[i][1];return r},configurable:!0}),e.prototype.equals=function(t){if(this===t)return!0;if(t instanceof e){const e=this.interpolators.length;if(e===t.interpolators.length){for(let r=0;r<e;r+=1)if(!this.interpolators[r].equals(t.interpolators[r]))return!1;return!0}}return!1},e}(k),T=function(t){const e=function(t,r){const i=function(t){return 0===t?i[0]:1===t?i[1]:k(i[0](t),i[1](t))};return Object.setPrototypeOf(i,e.prototype),i[0]=t,i[1]=r,i};return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e}(k),V=function(t){const e=function(t,r,i){const n=function(t){const e=n[0],r=n[1];return n.easing(Math.min(Math.max(0,(t-e)/(r-e)),1))};return Object.setPrototypeOf(n,e.prototype),n.easing=t,n[0]=r,n[1]=i,n};return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,Object.defineProperty(e.prototype,"duration",{get(){return this[1]-this[0]},configurable:!0}),e.prototype.contains=function(t){return this[0]<=t&&t<=this[1]},e.prototype.withDomain=function(t,r){return e(this.easing,t,r)},e.prototype.withDuration=function(t){const r=this[0];return e(this.easing,r,r+t)},e.prototype.overRange=function(t,e){let r;return r=1===arguments.length?t:k(t,e),q(this,r)},e.prototype.equivalentTo=function(t,r){return this===t||t instanceof e&&(this.easing.equivalentTo(t.easing,r)&&g.equivalent(this[0],t[0],r)&&g.equivalent(this[1],t[1],r))},e.prototype.canEqual=function(t){return t instanceof e},e.prototype.equals=function(t){return this===t||t instanceof e&&(t.canEqual(this)&&this.easing.equals(t.easing)&&g.equal(this[0],t[0])&&g.equal(this[1],t[1]))},e.prototype.toString=function(){return"Timing("+this.easing+", "+this[0]+", "+this[1]+")"},e.fromInit=function(t){let r=t.easing;void 0===r?r=F.linear:"string"==typeof r&&(r=F(r));let i=t.t0;void 0===i&&(i=0);let n=t.t1;if(void 0===n){const e=t.dt;n=void 0!==e?i+e:i}return e(r,i,n)},e.fromAny=function(t){if(null==t)return!1;if(t instanceof e||"boolean"==typeof t)return t;if("object"==typeof t)return e.fromInit(t);throw new TypeError(""+t)},e}(O),F=function(t){const e=function(t){switch(t){case"linear":return e.linear;case"quad-in":return e.quadIn;case"quad-out":return e.quadOut;case"quad-in-out":return e.quadInOut;case"cubic-in":return e.cubicIn;case"cubic-out":return e.cubicOut;case"cubic-in-out":return e.cubicInOut;case"quart-in":return e.quartIn;case"quart-out":return e.quartOut;case"quart-in-out":return e.quartInOut;case"expo-in":return e.expoIn;case"expo-out":return e.expoOut;case"expo-in-out":return e.expoInOut;case"circ-in":return e.circIn;case"circ-out":return e.circOut;case"circ-in-out":return e.circInOut;case"back-in":return e.backIn;case"back-out":return e.backOut;case"back-in-out":return e.backInOut;case"elastic-in":return e.elasticIn;case"elastic-out":return e.elasticOut;case"elastic-in-out":return e.elasticInOut;case"bounce-in":return e.bounceIn;case"bounce-out":return e.bounceOut;case"bounce-in-out":return e.bounceInOut;default:throw new Error("unknown easing: "+t)}};return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,Object.defineProperty(e.prototype,0,{value:0}),Object.defineProperty(e.prototype,1,{value:1}),Object.defineProperty(e.prototype,"easing",{get(){return this}}),e.prototype.equivalentTo=function(t,e){return this===t},e.prototype.canEqual=function(t){return t instanceof e},e.prototype.equals=function(t){return this===t},e.prototype.toString=function(){return'Easing("'+this.type+'")'},e.fromAny=function(t){if(t instanceof e)return t;if("string"==typeof t)return e(t);throw new TypeError(""+t)},e.linear=function(t){return t},Object.setPrototypeOf(e.linear,e.prototype),e.linear.type="linear",e.quadIn=function(t){return t*t},Object.setPrototypeOf(e.quadIn,e.prototype),e.quadIn.type="quad-in",e.quadOut=function(t){return t*(2-t)},Object.setPrototypeOf(e.quadOut,e.prototype),e.quadOut.type="quad-out",e.quadInOut=function(t){return(t*=2)<=1?t*=t:(t-=1,t*=2-t,t+=1),t/=2},Object.setPrototypeOf(e.quadInOut,e.prototype),e.quadInOut.type="quad-in-out",e.cubicIn=function(t){return t*t*t},Object.setPrototypeOf(e.cubicIn,e.prototype),e.cubicIn.type="cubic-in",e.cubicOut=function(t){return t-=1,t*=t*t,t+=1},Object.setPrototypeOf(e.cubicOut,e.prototype),e.cubicOut.type="cubic-out",e.cubicInOut=function(t){return(t*=2)<=1?t*=t*t:(t-=2,t*=t*t,t+=2),t/=2},Object.setPrototypeOf(e.cubicInOut,e.prototype),e.cubicInOut.type="cubic-in-out",e.quartIn=function(t){return t*t*t*t},Object.setPrototypeOf(e.quartIn,e.prototype),e.quartIn.type="quart-in",e.quartOut=function(t){return 1-(t-=1)*t*t*t},Object.setPrototypeOf(e.quartOut,e.prototype),e.quartOut.type="quart-out",e.quartInOut=function(t){const e=t-1;return t<.5?8*t*t*t*t:1-8*e*e*e*e},Object.setPrototypeOf(e.quartInOut,e.prototype),e.quartInOut.type="quart-in-out",e.expoIn=function(t){return 0===t?0:Math.pow(2,10*(t-1))},Object.setPrototypeOf(e.expoIn,e.prototype),e.expoIn.type="expo-in",e.expoOut=function(t){return 1===t?1:1-Math.pow(2,-10*t)},Object.setPrototypeOf(e.expoOut,e.prototype),e.expoOut.type="expo-out",e.expoInOut=function(t){return 1===t||0===t?t:(t*=2)<1?.5*Math.pow(2,10*(t-1)):.5*(2-Math.pow(2,-10*(t-1)))},Object.setPrototypeOf(e.expoInOut,e.prototype),e.expoInOut.type="expo-in-out",e.circIn=function(t){return-1*(Math.sqrt(1-t/1*t)-1)},Object.setPrototypeOf(e.circIn,e.prototype),e.circIn.type="circ-in",e.circOut=function(t){return t-=1,Math.sqrt(1-t*t)},Object.setPrototypeOf(e.circOut,e.prototype),e.circOut.type="circ-out",e.circInOut=function(t){if((t*=2)<1)return-.5*(Math.sqrt(1-t*t)-1);const e=t-2;return.5*(Math.sqrt(1-e*e)+1)},Object.setPrototypeOf(e.circInOut,e.prototype),e.circInOut.type="circ-in-out",e.backIn=function(t){const e=1.70158;return t*t*((e+1)*t-e)},Object.setPrototypeOf(e.backIn,e.prototype),e.backIn.type="back-in",e.backOut=function(t){const e=1.70158,r=t/1-1;return r*r*((e+1)*e+e)+1},Object.setPrototypeOf(e.backOut,e.prototype),e.backOut.type="back-out",e.backInOut=function(t){const e=2.5949095;if((t*=2)<1)return.5*t*t*((e+1)*t-e);const r=t-2;return.5*(r*r*((e+1)*r+e)+2)},Object.setPrototypeOf(e.backInOut,e.prototype),e.backInOut.type="back-in-out",e.elasticIn=function(t){if(0===t||1===t)return t;const e=t/1-1,r=(1-.7)/2*Math.PI*Math.asin(1);return-Math.pow(2,10*e)*Math.sin(2*(e-r)*Math.PI/(1-.7))},Object.setPrototypeOf(e.elasticIn,e.prototype),e.elasticIn.type="elastic-in",e.elasticOut=function(t){if(0===t||1===t)return t;const e=(1-.7)/(2*Math.PI)*Math.asin(1);return t*=2,Math.pow(2,-10*t)*Math.sin(2*(t-e)*Math.PI/(1-.7))+1},Object.setPrototypeOf(e.elasticOut,e.prototype),e.elasticOut.type="elastic-out",e.elasticInOut=function(t){if(0===t||1===t)return t;const e=.65,r=(1-e)/(2*Math.PI)*Math.asin(1),i=2*t,n=i-1;return i<1?Math.pow(2,10*n)*Math.sin(2*(n-r)*Math.PI/(1-e))*-.5:Math.pow(2,-10*n)*Math.sin(2*(n-r)*Math.PI/(1-e))*.5+1},Object.setPrototypeOf(e.elasticInOut,e.prototype),e.elasticInOut.type="elastic-in-out",e.bounceIn=function(t){const e=7.5625;return(t=1-t)<1/2.75?1-e*t*t:t<2/2.75?1-(e*(t-=1.5/2.75)*t+.75):t<2.5/2.75?1-(e*(t-=2.25/2.75)*t+.9375):1-(e*(t-=2.625/2.75)*t+.984375)},Object.setPrototypeOf(e.bounceIn,e.prototype),e.bounceIn.type="bounce-in",e.bounceOut=function(t){const e=7.5625;return t<1/2.75?e*t*t:t<2/2.75?e*(t-=1.5/2.75)*t+.75:t<2.5/2.75?e*(t-=2.25/2.75)*t+.9375:e*(t-=2.625/2.75)*t+.984375},Object.setPrototypeOf(e.bounceOut,e.prototype),e.bounceOut.type="bounce-out",e.bounceInOut=function(t){const e=t<.5,r=7.5625;return(t=e?1-2*t:2*t-1)<1/2.75?t*=r*t:t=t<2/2.75?r*(t-=1.5/2.75)*t+.75:t<2.5/2.75?r*(t-=2.25/2.75)*t+.9375:r*(t-=2.625/2.75)*t+.984375,e?.5*(1-t):.5*t+.5},Object.setPrototypeOf(e.bounceInOut,e.prototype),e.bounceInOut.type="bounce-in-out",e}(V),q=function(t){const e=function(t,r){const i=function(t){return i.range(i.domain(t))};return Object.setPrototypeOf(i,e.prototype),i.domain=t,i.range=r,i};return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.prototype.withDomain=function(t,e){return this.domain.withDomain(t,e).overRange(this.range)},e.prototype.canEqual=function(t){return t instanceof e},e.prototype.equals=function(t){return this===t||t instanceof e&&(this.domain.equals(t.domain)&&this.range.equals(t.range))},e.prototype.toString=function(){return"Tweening("+this.domain+", "+this.range+")"},e}(C),U=function(t){const e=function(t,r){const i=function(t){const e=i[0],r=i[1]-e;return 0!==r?(t-e)/r:0};return Object.setPrototypeOf(i,e.prototype),i[0]=t,i[1]=r,i};return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,Object.defineProperty(e.prototype,"inverse",{get(){return N(this[0],this[1])},configurable:!0}),e.prototype.contains=function(t){return this[0]<=t&&t<=this[1]},e.prototype.interpolateTo=function(t){return t instanceof e?R(this,t):null},e.prototype.canEqual=function(t){return t instanceof e},e.prototype.equals=function(t){return this===t||t instanceof e&&(t.canEqual(this)&&this[0]===t[0]&&this[1]===t[1])},e.prototype.toString=function(){return"LinearDomain("+this[0]+", "+this[1]+")"},e}(O),R=function(t){const e=function(t,r){const i=function(t){const e=i[0],r=e[0],n=e[1],s=i[1],o=s[0],a=s[1];return U(r+t*(o-r),n+t*(a-n))};return Object.setPrototypeOf(i,e.prototype),i[0]=t,i[1]=r,i};return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e}(k),N=function(t){const e=function(t,r){const i=function(t){const e=i[0];return e+t*(i[1]-e)};return Object.setPrototypeOf(i,e.prototype),i[0]=t,i[1]=r,i};return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,Object.defineProperty(e.prototype,"inverse",{get(){return U(this[0],this[1])},configurable:!0}),e.prototype.interpolateTo=function(t){return t instanceof e?z(this,t):null},e.prototype.canEqual=function(t){return t instanceof e},e.prototype.equals=function(t){return this===t||t instanceof e&&(t.canEqual(this)&&this[0]===t[0]&&this[1]===t[1])},e.prototype.toString=function(){return"LinearRange("+this[0]+", "+this[1]+")"},e}(S),z=function(t){const e=function(t,r){const i=function(t){const e=i[0],r=e[0],n=e[1],s=i[1],o=s[0],a=s[1];return N(r+t*(o-r),n+t*(a-n))};return Object.setPrototypeOf(i,e.prototype),i[0]=t,i[1]=r,i};return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e}(k),j=function(t){const e=function(){throw new Error};return(e.prototype=Object.create(t.prototype)).constructor=e,e.prototype.canEqual=function(t){return t instanceof e},e.prototype.equals=function(t){return this===t||t instanceof e&&(this.domain.equals(t.domain)&&this.range.equals(t.range))},e.prototype.toString=function(){return"Scale("+this.domain+", "+this.range+")"},e}(C),L=function(t){const e=function(){throw new Error};return(e.prototype=Object.create(t.prototype)).constructor=e,e.prototype.canEqual=function(t){return t instanceof e},e.prototype.equals=function(t){return this===t||t instanceof e&&(this.domain.equals(t.domain)&&this.range.equals(t.range))},e.prototype.toString=function(){return"ContinuousScale("+this.domain+", "+this.range+")"},e}(j),K=function(t){const e=function(t,r){const i=function(t){return i.range(i.domain(t))};return Object.setPrototypeOf(i,e.prototype),i.domain=t,i.range=r,i};return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,Object.defineProperty(e.prototype,"inverse",{get(){return e(this.range.inverse,this.domain.inverse)},configurable:!0}),e.prototype.withDomain=function(t,r){let i;return i=1===arguments.length?t:U(t,r),e(i,this.range)},e.prototype.overRange=function(t,r){let i;return i=1===arguments.length?t:N(t,r),e(this.domain,i)},e.prototype.clampDomain=function(t,r,i,n,s){void 0===s&&(s=u.Epsilon);let o=this.domain[0],a=this.domain[1];void 0!==t&&void 0!==r&&Math.abs(a-o)>r-t?o<a?(o=t,a=r):(a=t,o=r):(void 0!==t&&(o<a&&o<t?(a+=t-o,o=t):a<o&&a<t&&(o+=t-a,a=t)),void 0!==r&&(o<a&&a>r?(o-=a-r,a=r):a<o&&o>r&&(a-=o-r,o=r)));const h=this(o),l=this(a),c=h<l?l-h:h-l,d=Math.abs(c/(a-o));if(void 0!==i&&d<1/i){const t=c*i,e=o+a;o=(e-t)/2,a=(e+t)/2}else if(void 0!==n&&d>1/n){const t=c*n,e=o+a;o=(e-t)/2,a=(e+t)/2}return Math.abs(o-this.domain[0])<s&&Math.abs(a-this.domain[1])<s?this:e(U(o,a),this.range)},e.prototype.solveDomain=function(t,r,i,n,s,o){void 0===o&&(o=u.Epsilon);const a=this.domain[1]-this.domain[0],h=this.range[0],l=this.range[1];let c;void 0===i||void 0===n||Math.abs(i-t)<o||Math.abs(n-r)<o?c=(l-h)/(0!==a?a:o):(c=(n-r)/(i-t),void 0!==s&&s||c<0==(l-h)/a<0||(c=-c));const d=r-c*t,p=(h-d)/c,f=(l-d)/c;return Math.abs(p-this.domain[0])<o&&Math.abs(f-this.domain[1])<o?this:e(U(p,f),this.range)},e.prototype.interpolateTo=function(t){return t instanceof e?B(this,t):null},e.prototype.canEqual=function(t){return t instanceof e},e.prototype.equals=function(t){return this===t||t instanceof e&&(this.domain.equals(t.domain)&&this.range.equals(t.range))},e.prototype.toString=function(){return"LinearScale("+this.domain+", "+this.range+")"},e}(L),B=function(t){const e=function(t,r){const i=function(t){const e=i[0],r=i[1],n=e.domain,s=n[0],o=n[1],a=r.domain,u=a[0],h=a[1],l=U(s+t*(u-s),o+t*(h-o)),c=e.range,d=c[0],p=c[1],f=r.range,y=f[0],m=f[1],w=N(d+t*(y-d),p+t*(m-p));return K(l,w)};return Object.setPrototypeOf(i,e.prototype),i[0]=t,i[1]=r,i};return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e}(k),W=function(){const t={is:function(t){if("object"==typeof t&&null!==t||"function"==typeof t){return"create"in t}return!1}};return t}(),H=function(){const t={is:function(t){if("object"==typeof t&&null!==t||"function"==typeof t){return"init"in t}return!1}};return t}(),X=function(){const t={is:function(t){if("object"==typeof t&&null!==t||"function"==typeof t){return"observe"in t}return!1}};return t}(),Y=function(){const t={is:function(t){if("object"==typeof t&&null!==t||"function"==typeof t){return"consume"in t}return!1}};return t}();class G{constructor(){this.roots=v.empty,this.observers=v.empty}attachRoot(t){const e=this.roots,r=v.inserted(t,e);if(e!==r){const i=0===e.length;i&&this.willAttach(),this.willAttachRoot(t),this.roots=r,i&&this.onAttach(),this.onAttachRoot(t),this.didAttachRoot(t),i&&this.didAttach()}}willAttachRoot(t){const e=this.observers;for(let r=0,i=e.length;r<i;r+=1){const i=e[r];void 0!==i.serviceWillAttachRoot&&i.serviceWillAttachRoot(t,this)}}onAttachRoot(t){}didAttachRoot(t){const e=this.observers;for(let r=0,i=e.length;r<i;r+=1){const i=e[r];void 0!==i.serviceDidAttachRoot&&i.serviceDidAttachRoot(t,this)}}detachRoot(t){const e=this.roots,r=v.removed(t,e);if(e!==r){const i=1===e.length;i&&this.willDetach(),this.willDetachRoot(t),this.roots=r,i&&this.onDetach(),this.onDetachRoot(t),this.didDetachRoot(t),i&&this.didDetach()}}willDetachRoot(t){const e=this.observers;for(let r=0,i=e.length;r<i;r+=1){const i=e[r];void 0!==i.serviceWillDetachRoot&&i.serviceWillDetachRoot(t,this)}}onDetachRoot(t){}didDetachRoot(t){const e=this.observers;for(let r=0,i=e.length;r<i;r+=1){const i=e[r];void 0!==i.serviceDidDetachRoot&&i.serviceDidDetachRoot(t,this)}}get attached(){return 0!==this.roots.length}willAttach(){const t=this.observers;for(let e=0,r=t.length;e<r;e+=1){const r=t[e];void 0!==r.serviceWillAttach&&r.serviceWillAttach(this)}}onAttach(){}didAttach(){const t=this.observers;for(let e=0,r=t.length;e<r;e+=1){const r=t[e];void 0!==r.serviceDidAttach&&r.serviceDidAttach(this)}}willDetach(){const t=this.observers;for(let e=0,r=t.length;e<r;e+=1){const r=t[e];void 0!==r.serviceWillDetach&&r.serviceWillDetach(this)}}onDetach(){}didDetach(){const t=this.observers;for(let e=0,r=t.length;e<r;e+=1){const r=t[e];void 0!==r.serviceDidDetach&&r.serviceDidDetach(this)}}observe(t){const e=this.observers,r=v.inserted(t,e);e!==r&&(this.willObserve(t),this.observers=r,this.onObserve(t),this.didObserve(t))}willObserve(t){}onObserve(t){}didObserve(t){}unobserve(t){const e=this.observers,r=v.removed(t,e);e!==r&&(this.willUnobserve(t),this.observers=r,this.onUnobserve(t),this.didUnobserve(t))}willUnobserve(t){}onUnobserve(t){}didUnobserve(t){}forEachObserver(t){let e;const r=this.observers;for(let i=0,n=r.length;i<n;i+=1){const n=r[i];if(e=t.call(this,n),void 0!==e)return e}return e}}class _{set(t){throw new Error("immutable")}delete(){throw new Error("immutable")}static empty(){return new Q}static unary(t){return new Z(t)}static array(t,e,r){return void 0===e&&(e=0),void 0===r&&(r=t.length),new J(t,e,r)}}e([s],_,"empty",null);class Q extends _{isEmpty(){return!0}head(){throw new Error("empty")}step(){throw new Error("empty")}skip(t){}hasNext(){return!1}nextIndex(){return 0}next(){return{done:!0}}hasPrevious(){return!1}previousIndex(){return-1}previous(){return{done:!0}}}class Z extends _{constructor(t){super(),this.value=t,this.index=0}isEmpty(){return 0!==this.index}head(){if(0===this.index)return this.value;throw new Error("empty")}step(){if(0!==this.index)throw new Error("empty");this.index=1}skip(t){this.index=Math.min(Math.max(0,this.index+t),1)}hasNext(){return 0===this.index}nextIndex(){return this.index}next(){return 0===this.index?(this.index=1,{value:this.value,done:!0}):{done:!0}}hasPrevious(){return 1===this.index}previousIndex(){return this.index-1}previous(){return 1===this.index?(this.index=0,{value:this.value,done:!0}):{done:!0}}}class J extends _{constructor(t,e,r){super(),this.array=t,this.index=e,this.limit=r}isEmpty(){return this.index>=this.limit}head(){if(this.index<this.limit)return this.array[this.index];throw new Error("empty")}step(){if(!(this.index<this.limit))throw new Error("empty");this.index+=1}skip(t){this.index=Math.min(this.index+t,this.limit)}hasNext(){return this.index<this.limit}nextIndex(){return this.index}next(){const t=this.index;return t<this.limit?(this.index+=1,{value:this.array[t],done:this.index===this.limit}):(this.index=this.limit,{done:!0})}hasPrevious(){return this.index>0}previousIndex(){return this.index-1}previous(){const t=this.index-1;return t>=0?(this.index=t,{value:this.array[t],done:0===t}):(this.index=0,{done:!0})}}class ${constructor(t){this.buckets=new Array(t),this.gen4Hits=0,this.gen3Hits=0,this.gen2Hits=0,this.gen1Hits=0,this.misses=0}get(t){if(0===this.buckets.length)return;const e=Math.abs(g.hash(t))%this.buckets.length,r=this.buckets[e];if(void 0===r)return;const i=r.gen4Key;if(void 0!==i&&g.equal(t,i)){const t=r.gen4Val;if(void 0!==t)return this.gen4Hits+=1,r.gen4Weight++,t;r.gen4Key=void 0}const n=r.gen3Key;if(void 0!==n&&g.equal(t,n)){const t=r.gen3Val;if(void 0!==t)return this.gen3Hits+=1,r.gen3Weight++>r.gen4Weight&&(this.buckets[e]=new tt(r.gen3Key,r.gen3Val,r.gen3Weight,r.gen4Key,r.gen4Val,r.gen4Weight,r.gen2Key,r.gen2Val,r.gen2Weight,r.gen1Key,r.gen1Val,r.gen1Weight)),t;r.gen3Key=void 0}const s=r.gen2Key;if(void 0!==s&&g.equal(t,s)){const t=r.gen2Val;if(void 0!==t)return this.gen2Hits+=1,r.gen2Weight++>r.gen3Weight&&(this.buckets[e]=new tt(r.gen4Key,r.gen4Val,r.gen4Weight,r.gen2Key,r.gen2Val,r.gen2Weight,r.gen3Key,r.gen3Val,r.gen3Weight,r.gen1Key,r.gen1Val,r.gen1Weight)),t;r.gen2Key=void 0}const o=r.gen1Key;if(void 0!==o&&g.equal(t,o)){const t=r.gen1Val;if(void 0!==t)return this.gen1Hits+=1,r.gen1Weight++>r.gen2Weight&&(this.buckets[e]=new tt(r.gen4Key,r.gen4Val,r.gen4Weight,r.gen3Key,r.gen3Val,r.gen3Weight,r.gen1Key,r.gen1Val,r.gen1Weight,r.gen2Key,r.gen2Val,r.gen2Weight)),t;r.gen1Key=void 0}this.misses+=1}put(t,e){if(0===this.buckets.length)return e;const r=Math.abs(g.hash(t))%this.buckets.length,i=this.buckets[r]||new tt;let n=i.gen4Key;if(void 0!==n&&g.equal(t,n)){const t=i.gen4Val;if(void 0!==t)return this.gen4Hits+=1,i.gen4Weight++,t;i.gen4Key=void 0,n=void 0}let s=i.gen3Key;if(void 0!==s&&g.equal(t,s)){const t=i.gen3Val;if(void 0!==t)return this.gen3Hits+=1,i.gen3Weight++>i.gen4Weight&&(this.buckets[r]=new tt(i.gen3Key,i.gen3Val,i.gen3Weight,i.gen4Key,i.gen4Val,i.gen4Weight,i.gen2Key,i.gen2Val,i.gen2Weight,i.gen1Key,i.gen1Val,i.gen1Weight)),t;i.gen3Key=void 0,s=void 0}let o=i.gen2Key;if(void 0!==o&&g.equal(t,o)){const t=i.gen2Val;if(void 0!==t)return this.gen2Hits+=1,i.gen2Weight++>i.gen3Weight&&(this.buckets[r]=new tt(i.gen4Key,i.gen4Val,i.gen4Weight,i.gen2Key,i.gen2Val,i.gen2Weight,i.gen3Key,i.gen3Val,i.gen3Weight,i.gen1Key,i.gen1Val,i.gen1Weight)),t;i.gen2Key=void 0,o=void 0}let a=i.gen1Key;if(void 0!==a&&g.equal(t,a)){const t=i.gen1Val;if(void 0!==t)return this.gen1Hits+=1,i.gen1Weight++>i.gen2Weight&&(this.buckets[r]=new tt(i.gen4Key,i.gen4Val,i.gen4Weight,i.gen3Key,i.gen3Val,i.gen3Weight,i.gen1Key,i.gen1Val,i.gen1Weight,i.gen2Key,i.gen2Val,i.gen2Weight)),t;i.gen1Key=void 0,a=void 0}return this.misses+=1,this.buckets[r]=void 0===n?new tt(i.gen3Key,i.gen3Val,i.gen3Weight,i.gen2Key,i.gen2Val,i.gen2Weight,i.gen1Key,i.gen1Val,i.gen1Weight,t,e,1):void 0===s?new tt(i.gen4Key,i.gen4Val,i.gen4Weight,i.gen2Key,i.gen2Val,i.gen2Weight,i.gen1Key,i.gen1Val,i.gen1Weight,t,e,1):void 0===o?new tt(i.gen4Key,i.gen4Val,i.gen4Weight,i.gen3Key,i.gen3Val,i.gen3Weight,i.gen1Key,i.gen1Val,i.gen1Weight,t,e,1):void 0===a?new tt(i.gen4Key,i.gen4Val,i.gen4Weight,i.gen3Key,i.gen3Val,i.gen3Weight,i.gen2Key,i.gen2Val,i.gen2Weight,t,e,1):new tt(i.gen4Key,i.gen4Val,i.gen4Weight-1,i.gen3Key,i.gen3Val,i.gen3Weight-1,i.gen1Key,i.gen1Val,i.gen1Weight,t,e,1),e}remove(t){if(0===this.buckets.length)return;const e=Math.abs(g.hash(t))%this.buckets.length,r=this.buckets[e];if(void 0===r)return;const i=r.gen4Key;if(void 0!==i&&g.equal(t,i)){const t=r.gen4Val;return this.buckets[e]=new tt(r.gen3Key,r.gen3Val,r.gen3Weight,r.gen2Key,r.gen2Val,r.gen2Weight,r.gen1Key,r.gen1Val,r.gen1Weight,void 0,void 0,0),t}const n=r.gen3Key;if(void 0!==n&&g.equal(t,n)){const t=r.gen3Val;return this.buckets[e]=new tt(r.gen4Key,r.gen4Val,r.gen4Weight,r.gen2Key,r.gen2Val,r.gen2Weight,r.gen1Key,r.gen1Val,r.gen1Weight,void 0,void 0,0),t}const s=r.gen2Key;if(void 0!==s&&g.equal(t,s)){const t=r.gen2Val;return this.buckets[e]=new tt(r.gen4Key,r.gen4Val,r.gen4Weight,r.gen3Key,r.gen3Val,r.gen3Weight,r.gen1Key,r.gen1Val,r.gen1Weight,void 0,void 0,0),t}const o=r.gen1Key;if(void 0!==o&&g.equal(t,o)){const t=r.gen1Val;return this.buckets[e]=new tt(r.gen4Key,r.gen4Val,r.gen4Weight,r.gen3Key,r.gen3Val,r.gen3Weight,r.gen2Key,r.gen2Val,r.gen2Weight,void 0,void 0,0),t}}clear(){for(let t=0;t<this.buckets.length;t+=1)this.buckets[t]=void 0}hits(){return this.gen4Hits+this.gen3Hits+this.gen2Hits+this.gen1Hits}hitRatio(){const t=this.hits();return t/(t+this.misses)}}class tt{constructor(t,e,r=0,i,n,s=0,o,a,u=0,h,l,c=0){this.gen4Key=t,this.gen4Val=e,this.gen4Weight=r,this.gen3Key=i,this.gen3Val=n,this.gen3Weight=s,this.gen2Key=o,this.gen2Val=a,this.gen2Weight=u,this.gen1Key=h,this.gen1Val=l,this.gen1Weight=c}}class et{constructor(t){this.buckets=new Array(t),this.gen4Hits=0,this.gen3Hits=0,this.gen2Hits=0,this.gen1Hits=0,this.misses=0}put(t){if(0===this.buckets.length)return t;const e=Math.abs(g.hash(t))%this.buckets.length,r=this.buckets[e]||new rt,i=r.gen4Val;if(void 0!==i&&g.equal(t,i))return this.gen4Hits+=1,r.gen4Weight++,i;const n=r.gen3Val;if(void 0!==n&&g.equal(t,n))return this.gen3Hits+=1,r.gen3Weight++>r.gen4Weight&&(this.buckets[e]=new rt(r.gen3Val,r.gen3Weight,r.gen4Val,r.gen4Weight,r.gen2Val,r.gen2Weight,r.gen1Val,r.gen1Weight)),n;const s=r.gen2Val;if(void 0!==s&&g.equal(t,s))return this.gen2Hits+=1,r.gen2Weight++>r.gen3Weight&&(this.buckets[e]=new rt(r.gen4Val,r.gen4Weight,r.gen2Val,r.gen2Weight,r.gen3Val,r.gen3Weight,r.gen1Val,r.gen1Weight)),s;const o=r.gen1Val;return void 0!==o&&g.equal(t,o)?(this.gen1Hits+=1,r.gen1Weight++>r.gen2Weight&&(this.buckets[e]=new rt(r.gen4Val,r.gen4Weight,r.gen3Val,r.gen3Weight,r.gen1Val,r.gen1Weight,r.gen2Val,r.gen2Weight)),o):(this.misses+=1,this.buckets[e]=void 0===i?new rt(r.gen3Val,r.gen3Weight,r.gen2Val,r.gen2Weight,r.gen1Val,r.gen1Weight,t,1):void 0===n?new rt(r.gen4Val,r.gen4Weight,r.gen2Val,r.gen2Weight,r.gen1Val,r.gen1Weight,t,1):void 0===s?new rt(r.gen4Val,r.gen4Weight,r.gen3Val,r.gen3Weight,r.gen1Val,r.gen1Weight,t,1):void 0===o?new rt(r.gen4Val,r.gen4Weight,r.gen3Val,r.gen3Weight,r.gen2Val,r.gen2Weight,t,1):new rt(r.gen4Val,r.gen4Weight-1,r.gen3Val,r.gen3Weight-1,r.gen1Val,r.gen1Weight,t,1),t)}remove(t){if(0===this.buckets.length)return!1;const e=Math.abs(g.hash(t))%this.buckets.length,r=this.buckets[e];if(void 0===r)return!1;const i=r.gen4Val;if(void 0!==i&&g.equal(t,i))return this.buckets[e]=new rt(r.gen3Val,r.gen3Weight,r.gen2Val,r.gen2Weight,r.gen1Val,r.gen1Weight,void 0,0),!0;const n=r.gen3Val;if(void 0!==n&&g.equal(t,n))return this.buckets[e]=new rt(r.gen4Val,r.gen4Weight,r.gen2Val,r.gen2Weight,r.gen1Val,r.gen1Weight,void 0,0),!0;const s=r.gen2Val;if(void 0!==s&&g.equal(t,s))return this.buckets[e]=new rt(r.gen4Val,r.gen4Weight,r.gen3Val,r.gen3Weight,r.gen1Val,r.gen1Weight,void 0,0),!0;const o=r.gen1Val;return!(void 0===o||!g.equal(t,o))&&(this.buckets[e]=new rt(r.gen4Val,r.gen4Weight,r.gen3Val,r.gen3Weight,r.gen2Val,r.gen2Weight,void 0,0),!0)}clear(){for(let t=0;t<this.buckets.length;t+=1)this.buckets[t]=void 0}get hits(){return this.gen4Hits+this.gen3Hits+this.gen2Hits+this.gen1Hits}get hitRatio(){const t=this.hits;return t/(t+this.misses)}}class rt{constructor(t,e=0,r,i=0,n,s=0,o,a=0){this.gen4Val=t,this.gen4Weight=e,this.gen3Val=r,this.gen3Weight=i,this.gen2Val=n,this.gen2Weight=s,this.gen1Val=o,this.gen1Weight=a}}class it extends Error{constructor(t){super(t),Object.setPrototypeOf(this,it.prototype)}}const nt=function(){const t=function(t,e){if(!t)throw new it(e)};return t.ok=function(t,e){if(!t)throw new it(e)},t.notOk=function(t,e){if(t)throw new it(e)},t.equal=function(t,e,r){if(!g.equal(t,e))throw new it(r)},t.notEqual=function(t,e,r){if(g.equal(t,e))throw new it(r)},t.identical=function(t,e,r){if(t!==e)throw new it(r)},t.notIdentical=function(t,e,r){if(t===e)throw new it(r)},t.instanceOf=function(t,e,r){if(!(t instanceof e))throw new it(r)},t.notInstanceOf=function(t,e,r){if(t instanceof e)throw new it(r)},t.compareLessThan=function(t,e,r){if(!(g.compare(t,e)<0))throw new it(r)},t.compareNotLessThan=function(t,e,r){if(g.compare(t,e)<0)throw new it(r)},t.compareLessThanOrEqual=function(t,e,r){if(!(g.compare(t,e)<=0))throw new it(r)},t.compareNotLessThanOrEqual=function(t,e,r){if(g.compare(t,e)<=0)throw new it(r)},t.compareEqual=function(t,e,r){if(0!==g.compare(t,e))throw new it(r)},t.compareNotEqual=function(t,e,r){if(0===g.compare(t,e))throw new it(r)},t.compareGreaterThanOrEqual=function(t,e,r){if(!(g.compare(t,e)>=0))throw new it(r)},t.compareNotGreaterThanOrEqual=function(t,e,r){if(g.compare(t,e)>=0)throw new it(r)},t.compareGreaterThan=function(t,e,r){if(!(g.compare(t,e)>0))throw new it(r)},t.compareNotGreaterThan=function(t,e,r){if(g.compare(t,e)>0)throw new it(r)},t}();class st{constructor(t,e){this.level=t,this.label=e}isTrace(){return this.level===st.TRACE_LEVEL}isDebug(){return this.level===st.DEBUG_LEVEL}isInfo(){return this.level===st.INFO_LEVEL}isNote(){return this.level===st.NOTE_LEVEL}isWarning(){return this.level===st.WARNING_LEVEL}isError(){return this.level===st.ERROR_LEVEL}isAlert(){return this.level===st.ALERT_LEVEL}isFatal(){return this.level===st.FATAL_LEVEL}compareTo(t){return this===t?0:t instanceof st?this.level<t.level?-1:this.level>t.level?1:this.label.localeCompare(t.label):NaN}equals(t){return this===t||t instanceof st&&(this.level===t.level&&this.label===t.label)}hashCode(){return n.mash(n.mix(n.mix(p.hash(st),h.hash(this.level)),l.hash(this.label)))}toString(){return this.label}static create(t,e){switch(t){case st.TRACE_LEVEL:return st.trace(e);case st.DEBUG_LEVEL:return st.debug(e);case st.INFO_LEVEL:return st.info(e);case st.NOTE_LEVEL:return st.note(e);case st.WARNING_LEVEL:return st.warning(e);case st.ERROR_LEVEL:return st.error(e);case st.ALERT_LEVEL:return st.alert(e);case st.FATAL_LEVEL:return st.fatal(e);default:throw new Error(""+t)}}static trace(t="trace"){return"trace"===t?(void 0===st._trace&&(st._trace=new st(st.TRACE_LEVEL,t)),st._trace):new st(st.TRACE_LEVEL,t)}static debug(t="debug"){return"debug"===t?(void 0===st._debug&&(st._debug=new st(st.DEBUG_LEVEL,t)),st._debug):new st(st.DEBUG_LEVEL,t)}static info(t="info"){return"info"===t?(void 0===st._info&&(st._info=new st(st.INFO_LEVEL,t)),st._info):new st(st.INFO_LEVEL,t)}static note(t="note"){return"note"===t?(void 0===st._note&&(st._note=new st(st.NOTE_LEVEL,t)),st._note):new st(st.NOTE_LEVEL,t)}static warning(t="warning"){return"warning"===t?(void 0===st._warning&&(st._warning=new st(st.WARNING_LEVEL,t)),st._warning):new st(st.WARNING_LEVEL,t)}static error(t="error"){return"error"===t?(void 0===st._error&&(st._error=new st(st.ERROR_LEVEL,t)),st._error):new st(st.ERROR_LEVEL,t)}static alert(t="alert"){return"alert"===t?(void 0===st._alert&&(st._alert=new st(st.ALERT_LEVEL,t)),st._alert):new st(st.ALERT_LEVEL,t)}static fatal(t="fatal"){return"fatal"===t?(void 0===st._fatal&&(st._fatal=new st(st.FATAL_LEVEL,t)),st._fatal):new st(st.FATAL_LEVEL,t)}}st.TRACE_LEVEL=0,st.DEBUG_LEVEL=1,st.INFO_LEVEL=2,st.NOTE_LEVEL=3,st.WARNING_LEVEL=4,st.ERROR_LEVEL=5,st.ALERT_LEVEL=6,st.FATAL_LEVEL=7;class ot{}class at extends ot{constructor(t,e,r,i){super(),this.offset=t,this.line=e,this.column=r,this.note=i}withNote(t){return this.note!==t?at.at(this.offset,this.line,this.column,t):this}min(t){return this.offset<=t.offset?this:t}max(t){return this.offset>=t.offset?this:t}get start(){return this}get end(){return this}union(t){if(t instanceof at)return this.offset===t.offset&&this.line===t.line&&this.column===t.column?this:ut.from(this,t);if(t instanceof ut){const e=this.min(t.start),r=this.max(t.end);return e===t.start&&r===t.end?t:ut.from(e,r)}throw new Error(t.toString())}shift(t){const e=this.offset+(this.offset-t.offset),r=this.line+(this.line-t.line);let i=this.column;return 1===r&&(i+=this.column-t.column),e===this.offset&&r===this.line&&i===this.column?this:at.at(e,r,i,this.note)}equals(t){return this===t||t instanceof at&&(this.offset===t.offset&&this.line===t.line&&this.column===t.column&&this.note===t.note)}hashCode(){return n.mash(n.mix(n.mix(n.mix(n.mix(p.hash(at),h.hash(this.offset)),h.hash(this.line)),h.hash(this.column)),l.hash(this.note)))}display(t){return t=(t=Ot.displayNumber(t,this.line)).write(58),t=Ot.displayNumber(t,this.column),void 0!==this.note&&(t=t.write(58).write(32).write(this.note)),t}debug(t){return t=t.write("Mark").write(".").write("at").write("("),t=(t=Ot.debugNumber(t,this.offset)).write(", "),t=(t=Ot.debugNumber(t,this.line)).write(", "),t=Ot.debugNumber(t,this.column),void 0!==this.note&&(t=t.write(", "),t=Ot.debugString(t,this.note)),t=t.write(")")}toString(){return Ot.display(this)}static get zero(){return new at(0,1,1,void 0)}static at(t,e,r,i){return new at(t,e,r,i)}}e([s],at,"zero",null);class ut extends ot{constructor(t,e){super(),this.start=t,this.end=e}union(t){if(t instanceof at){const e=this.start.min(t),r=this.end.max(t);return e===this.start&&r===this.end?this:ut.from(e,r)}if(t instanceof ut){const e=this.start.min(t.start),r=this.end.max(t.end);return e===this.start&&r===this.end?this:ut.from(e,r)}throw new Error(t.toString())}shift(t){const e=this.start.shift(t),r=this.end.shift(t);return e===this.start&&r===this.end?this:ut.from(e,r)}equals(t){return this===t||t instanceof ut&&(this.start.equals(t.start)&&this.end.equals(t.end))}hashCode(){return n.mash(n.mix(n.mix(p.hash(ut),this.start.hashCode()),this.end.hashCode()))}display(t){return void 0!==this.start.note&&(t=t.write(this.start.note).write(58).write(32)),t=(t=Ot.displayNumber(t,this.start.line)).write(58),t=(t=Ot.displayNumber(t,this.start.column)).write(45),t=(t=Ot.displayNumber(t,this.end.line)).write(58),t=Ot.displayNumber(t,this.end.column),void 0!==this.end.note&&(t=t.write(58).write(32).write(this.end.note)),t}debug(t){return t=t.write("Span").write(".").write("from").write("("),t=(t=this.start.debug(t)).write(", "),t=(t=this.end.debug(t)).write(")")}toString(){return Ot.display(this)}static from(t,e){if(t.offset>e.offset){const r=t;t=e,e=r}return new ut(t,e)}}const ht=function(){const t={reset:function(t){return t.settings.isStyled()&&(t=t.write(27).write(91).write(48).write(109)),t},bold:function(t){return t.settings.isStyled()&&(t=t.write(27).write(91).write(49).write(109)),t},faint:function(t){return t.settings.isStyled()&&(t=t.write(27).write(91).write(50).write(109)),t},black:function(t){return t.settings.isStyled()&&(t=t.write(27).write(91).write(48).write(59).write(51).write(48).write(109)),t},red:function(t){return t.settings.isStyled()&&(t=t.write(27).write(91).write(48).write(59).write(51).write(49).write(109)),t},green:function(t){return t.settings.isStyled()&&(t=t.write(27).write(91).write(48).write(59).write(51).write(50).write(109)),t},yellow:function(t){return t.settings.isStyled()&&(t=t.write(27).write(91).write(48).write(59).write(51).write(51).write(109)),t},blue:function(t){return t.settings.isStyled()&&(t=t.write(27).write(91).write(48).write(59).write(51).write(52).write(109)),t},magenta:function(t){return t.settings.isStyled()&&(t=t.write(27).write(91).write(48).write(59).write(51).write(53).write(109)),t},cyan:function(t){return t.settings.isStyled()&&(t=t.write(27).write(91).write(48).write(59).write(51).write(54).write(109)),t},gray:function(t){return t.settings.isStyled()&&(t=t.write(27).write(91).write(48).write(59).write(51).write(55).write(109)),t},blackBold:function(t){return t.settings.isStyled()&&(t=t.write(27).write(91).write(49).write(59).write(51).write(48).write(109)),t},redBold:function(t){return t.settings.isStyled()&&(t=t.write(27).write(91).write(49).write(59).write(51).write(49).write(109)),t},greenBold:function(t){return t.settings.isStyled()&&(t=t.write(27).write(91).write(49).write(59).write(51).write(50).write(109)),t},yellowBold:function(t){return t.settings.isStyled()&&(t=t.write(27).write(91).write(49).write(59).write(51).write(51).write(109)),t},blueBold:function(t){return t.settings.isStyled()&&(t=t.write(27).write(91).write(49).write(59).write(51).write(52).write(109)),t},magentaBold:function(t){return t.settings.isStyled()&&(t=t.write(27).write(91).write(49).write(59).write(51).write(53).write(109)),t},cyanBold:function(t){return t.settings.isStyled()&&(t=t.write(27).write(91).write(49).write(59).write(51).write(54).write(109)),t},grayBold:function(t){return t.settings.isStyled()&&(t=t.write(27).write(91).write(49).write(59).write(51).write(55).write(109)),t}};return t}();class lt{constructor(t,e,r,i){Object.defineProperty(this,"lineSeparator",{value:t,enumerable:!0}),Object.defineProperty(this,"pretty",{value:e,enumerable:!0}),Object.defineProperty(this,"styled",{value:r,enumerable:!0}),Object.defineProperty(this,"precision",{value:i,enumerable:!0})}withLineSeparator(t){return this.copy(t,this.pretty,this.styled,this.precision)}isPretty(){return this.pretty}asPretty(t){return this.copy(this.lineSeparator,t,this.styled,this.precision)}isStyled(){return this.styled}asStyled(t){return this.copy(this.lineSeparator,this.pretty,t,this.precision)}withPrecision(t){return this.copy(this.lineSeparator,this.pretty,this.styled,t)}copy(t,e,r,i){return lt.create(t,e,r,i)}canEqual(t){return t instanceof lt}equals(t){return this===t||t instanceof lt&&(t.canEqual(this)&&this.lineSeparator===t.lineSeparator&&this.pretty===t.pretty&&this.styled===t.styled&&this.precision===t.precision)}hashCode(){return n.mash(n.mix(n.mix(n.mix(n.mix(p.hash(lt),l.hash(this.lineSeparator)),a.hash(this.pretty)),a.hash(this.styled)),h.hash(this.precision)))}debug(t){return t=t.write("OutputSettings").write(46),t=(t=this.pretty||this.styled?this.pretty&&!this.styled?t.write("pretty"):!this.pretty&&this.styled?t.write("styled"):t.write("prettyStyled"):t.write("standard")).write(40).write(41),this.lineSeparator!==Ot.lineSeparator&&(t=t.write(46).write("lineSeparator").write(40).display(this.lineSeparator).write(41)),-1!==this.precision&&(t=t.write(46).write("precision").write(40).display(this.precision).write(41)),t}toString(){return Ot.debug(this)}static standard(){return new lt(Ot.lineSeparator,!1,!1,-1)}static pretty(){return new lt(Ot.lineSeparator,!0,!1,-1)}static styled(){return new lt(Ot.lineSeparator,!1,!0,-1)}static prettyStyled(){return new lt(Ot.lineSeparator,!0,!0,-1)}static create(t,e,r,i){return"string"!=typeof t&&(t=Ot.lineSeparator),"boolean"!=typeof e&&(e=!1),"boolean"!=typeof r&&(r=!1),"number"!=typeof i&&(i=-1),t===Ot.lineSeparator&&-1===i?e||r?e&&!r?lt.pretty():!e&&r?lt.styled():lt.prettyStyled():lt.standard():new lt(t,e,r,i)}static fromInit(t){return lt.create(t.lineSeparator,t.isPretty,t.isStyled,t.precision)}static fromAny(t){return t instanceof lt?t:"object"==typeof t&&null!==t?lt.fromInit(t):lt.standard()}}e([s],lt,"standard",null),e([s],lt,"pretty",null),e([s],lt,"styled",null),e([s],lt,"prettyStyled",null);class ct extends Error{constructor(t){super(t),Object.setPrototypeOf(this,ct.prototype)}}class dt{constructor(t){Object.defineProperty(this,"stripped",{value:t,enumerable:!0})}isStripped(){return this.stripped}asStripped(t){return this.copy(t)}copy(t){return dt.create(t)}canEqual(t){return t instanceof dt}equals(t){return this===t||t instanceof dt&&(t.canEqual(this)&&this.stripped===t.stripped)}hashCode(){return n.mash(n.mix(p.hash(dt),a.hash(this.stripped)))}debug(t){return t=t.write("InputSettings").write(46),t=(t=this.stripped?t.write("stripped"):t.write("standard")).write(40).write(41)}toString(){return Ot.debug(this)}static standard(){return new dt(!1)}static stripped(){return new dt(!0)}static create(t){return t?dt.stripped():dt.standard()}static fromAny(t){return t instanceof dt?t:"object"==typeof t&&null!==t?dt.create(t.isStripped):dt.standard()}}e([s],dt,"standard",null),e([s],dt,"stripped",null);class pt{trap(){throw new ct}static empty(){return new kt(void 0,at.zero,dt.standard())}static done(){return new At(void 0,at.zero,dt.standard())}static error(t){return new ft(t,void 0,at.zero,dt.standard())}}e([s],pt,"empty",null),e([s],pt,"done",null);class ft extends pt{constructor(t,e,r,i){super(),Object.defineProperty(this,"error",{value:t,enumerable:!0}),Object.defineProperty(this,"id",{value:e,enumerable:!0}),Object.defineProperty(this,"mark",{value:r,enumerable:!0}),Object.defineProperty(this,"settings",{value:i,enumerable:!0})}isCont(){return!1}isEmpty(){return!1}isDone(){return!1}isError(){return!0}isPart(){return!1}asPart(t){return this}head(){throw new ct}step(){const t=new ct("error step");return new ft(t,this.id,this.mark,this.settings)}trap(){return this.error}seek(t){const e=new ct("error seek");return new ft(e,this.id,this.mark,this.settings)}withId(t){return new ft(this.error,t,this.mark,this.settings)}withMark(t){return new ft(this.error,this.id,t,this.settings)}get offset(){return this.mark.offset}get line(){return this.mark.line}get column(){return this.mark.column}withSettings(t){return t=dt.fromAny(t),new ft(this.error,this.id,this.mark,t)}clone(){return this}}class yt extends pt{constructor(t,e,r,i,n,s,o,a){super(),this.string=t,this.index=o,this.part=a,this.id=e,this.offset=r,this.line=i,this.column=n,this.settings=s}isCont(){return this.index<this.string.length}isEmpty(){return this.part&&this.index>=this.string.length}isDone(){return!this.part&&this.index>=this.string.length}isError(){return!1}isPart(){return this.part}asPart(t){return this.part=t,this}head(){const t=this.string,e=this.index;if(e<t.length){const r=t.codePointAt(e);return void 0!==r?r:t.charCodeAt(e)}throw new ct}step(){const t=this.string,e=this.index;if(e<t.length){const r=t.codePointAt(e);return this.index=l.offsetByCodePoints(t,e,1),this.offset+=this.index-e,10===r?(this.line+=1,this.column=1):this.column+=1,this}{const t=new ct("invalid step");return new ft(t,this.id,this.mark,this.settings)}}seek(t){if(void 0!==t){const e=this.index+(t.offset-this.offset);if(0<=e&&e<=this.string.length)return this.index=e,this.offset=t.offset,this.line=t.line,this.column=t.column,this;{const e=new ct("invalid seek to "+t);return new ft(e,this.id,this.mark,this.settings)}}return this.index=0,this.offset=0,this.line=1,this.column=1,this}withId(t){return this.id=t,this}get mark(){return at.at(this.offset,this.line,this.column)}withMark(t){return this.offset=t.offset,this.line=t.line,this.column=t.column,this}withSettings(t){return t=dt.fromAny(t),this.settings=t,this}clone(){return new yt(this.string,this.id,this.offset,this.line,this.column,this.settings,this.index,this.part)}static create(t){return new yt(t,void 0,0,1,1,dt.standard(),0,!1)}}class mt extends Error{constructor(t){super(t),Object.setPrototypeOf(this,mt.prototype)}}class wt{writeln(t){return"string"==typeof t&&this.write(t),this.write(this.settings.lineSeparator)}display(t){return Ot.displayAny(this,t)}debug(t){return Ot.debugAny(this,t)}flush(){return this}push(...t){const e=t.length;for(let r=0;r<e;r+=1)this.write(t[r])}trap(){throw new mt}clone(){throw new Error}static full(){return new Tt(lt.standard())}static done(){return new Vt(lt.standard())}static error(t){return new Ft(t,lt.standard())}}e([s],wt,"full",null),e([s],wt,"done",null);class gt extends wt{constructor(t,e){super(),this.string=t,this.settings=e}isCont(){return!0}isFull(){return!1}isDone(){return!1}isError(){return!1}isPart(){return!1}asPart(t){return this}write(t){if("number"==typeof t)if(t>=0&&t<=55295||t>=57344&&t<=65535)t=String.fromCharCode(t);else if(t>=65536&&t<=1114111){const e=t-65536;t=String.fromCharCode(55296|e>>>10,56320|1023&e)}else t="";return this.string+=t,this}writeln(t){return void 0!==t&&(this.string=this.string.concat(t)),this.string=this.string.concat(this.settings.lineSeparator),this}withSettings(t){return t=lt.fromAny(t),this.settings=t,this}bind(){return this.string}clone(){return new gt(this.string,this.settings)}toString(){return this.string}}class vt extends Error{constructor(t){super(t),Object.setPrototypeOf(this,vt.prototype)}}class bt{isCont(){return!0}isDone(){return!1}isError(){return!1}feed(t){throw new vt}fork(t){return this}bind(){throw new vt}trap(){throw new vt}asDone(){throw new vt}asError(){throw new vt}andThen(t){return new Xt(this,t)}static end(){return new Bt}static done(t){return new Wt(t)}static error(t){return new Ht(t)}}e([s],bt,"end",null);class xt extends bt{constructor(t,e,r=0){super(),this.value=t,this.input=e,this.index=r}feed(t){return new xt(t,""+t)}pull(t){return xt.write(t,this.value,this.input,this.index)}static write(t,e,r,i=0){const n=r.length;for(;i<n&&t.isCont();){let e=r.codePointAt(i);void 0===e&&(e=r.charCodeAt(i)),t=t.write(e),i=l.offsetByCodePoints(r,i,1)}return i===n?bt.done(e):t.isDone()?bt.error(new vt("truncated")):t.isError()?bt.error(t.trap()):new xt(e,r,i)}}const Ct=function(){const t={stringInput:function(t){return yt.create(t)},stringOutput:function(t,e){return void 0===e&&"string"!=typeof t?(e=t,t=""):"string"!=typeof t&&(t=""),e=lt.fromAny(e),new gt(t,e)},stringWriter:function(t){return void 0===t?new xt(void 0,""):new xt(t,""+t)},writeString:function(t,e){return xt.write(t,void 0,""+e)},isAlpha:function(t){return t>=65&&t<=90||t>=97&&t<=122},isDigit:function(t){return t>=48&&t<=57},isSpace:function(t){return 32===t||9===t},isNewline:function(t){return 10===t||13===t},isWhitespace:function(e){return t.isSpace(e)||t.isNewline(e)}};return t}(),Ot=function(){const t={};return Object.defineProperty(t,"lineSeparator",{value:"\n",enumerable:!0,configurable:!0}),function(){if("function"==typeof require)try{return Promise.resolve(require("os"))}catch(t){}return Promise.reject(void 0)}().then((e=>{Object.defineProperty(t,"lineSeparator",{value:e.EOL,enumerable:!0,configurable:!0})}),(t=>{})),t.display=function(t,e){if(void 0===t)return"undefined";if(null===t)return"null";if("number"==typeof t)return""+t;if("string"==typeof t)return t;if("function"==typeof t.display){let r=Ct.stringOutput(e);return r=t.display(r),r.bind()}return""+t},t.debug=function(e,r){if(void 0===e)return"undefined";if(null===e)return"null";if("number"==typeof e)return""+e;if("string"==typeof e){let i=Ct.stringOutput(r);return i=t.debugString(i,e),i.bind()}if("function"==typeof e.debug){let t=Ct.stringOutput(r);return t=e.debug(t),t.bind()}return""+e},t.displayAny=function(e,r){return e=void 0===r?e.write("undefined"):null===r?e.write("null"):"number"==typeof r?t.displayNumber(e,r):"string"==typeof r?e.write(r):"function"==typeof r.display?r.display(e):e.write(""+r)},t.debugAny=function(e,r){return e=void 0===r?e.write("undefined"):null===r?e.write("null"):"number"==typeof r?t.debugNumber(e,r):"string"==typeof r?t.debugString(e,r):"function"==typeof r.debug?r.debug(e):e.write(""+r)},t.displayNumber=function(e,r){if(isFinite(r)&&Math.floor(r)===r&&Math.abs(r)<2147483648)if(r<0&&(e=e.write(45)),r>-10&&r<10)e=e.write(48+Math.abs(r));else{const t=new Array(19);let i=r,n=18;for(;0!==i;)t[n]=Math.abs(i%10|0),i=i/10|0,n-=1;for(n+=1;n<19;)e=e.write(48+t[n]),n+=1}else e=e.write(t.decimal(r,e.settings.precision));return e},t.debugNumber=function(e,r){return t.displayNumber(e,r)},t.debugChar=function(e,r){switch(e=e.write(39),r){case 8:e.write(92).write(98);break;case 9:e.write(92).write(116);break;case 10:e.write(92).write(110);break;case 12:e.write(92).write(102);break;case 13:e.write(92).write(114);break;case 34:e.write(92).write(34);break;case 39:e.write(92).write(39);break;case 92:e.write(92).write(92);break;default:e=r>=0&&r<=31||r>=127&&r<=159?e.write(92).write(117).write(t.encodeHex(r>>>12&15)).write(t.encodeHex(r>>>8&15)).write(t.encodeHex(r>>>4&15)).write(t.encodeHex(15&r)):e.write(r)}return e=e.write(39)},t.debugString=function(e,r){e=e.write(34);let i=Ct.stringInput(r);for(;i.isCont();){const r=i.head();switch(r){case 8:e.write(92).write(98);break;case 9:e.write(92).write(116);break;case 10:e.write(92).write(110);break;case 12:e.write(92).write(102);break;case 13:e.write(92).write(114);break;case 34:e.write(92).write(34);break;case 92:e.write(92).write(92);break;default:e=r>=0&&r<=31||r>=127&&r<=159?e.write(92).write(117).write(t.encodeHex(r>>>12&15)).write(t.encodeHex(r>>>8&15)).write(t.encodeHex(r>>>4&15)).write(t.encodeHex(15&r)):e.write(r)}i=i.step()}return e=e.write(34)},t.encodeHex=function(t){return t<10?48+t:t-10+65},t.prefix=function(){const e=["y","z","a","f","p","n","","m","","k","M","G","T","P","E"," Z","Y"];return function(r,i=1){if(isFinite(r)){const n=Math.abs(r).toExponential(),s=n.indexOf("e"),o=s>=0?+n.slice(s+1):NaN,a=3*Math.min(Math.max(-8,Math.floor(o/3)),8),u=Math.pow(10,-a)*r;let h=t.trimTrailingZeros(Math.abs(u).toFixed(i));return u<0&&0!=+h&&(h="-"+h),h+=e[8+a/3],h}return""+r}}(),t.decimal=function(e,r=-1){if(r>=0){let i=t.trimTrailingZeros(Math.abs(e).toFixed(r));return e<0&&0!=+i&&(i="-"+i),i}return""+e},t.trimTrailingZeros=function(t){let e,r=-1;for(let i=1,n=t.length;i<n;i+=1){const n=t.charCodeAt(i);if(46===n)r=i,e=i;else if(48===n)0===r&&(r=i),e=i;else if(n>=49&&n<=57)r>0&&(r=0);else if(r>0)break}return r>0&&(t=t.slice(0,r)+t.slice(e+1)),t},t.duration=function(t,e=" "){if(isFinite(t)){const r=1e3,i=60*r,n=60*i,s=24*n,o=7*s;let a,u,h,l,c;t>o&&(a=Math.floor(t/o),t%=o),t>s&&(u=Math.floor(t/s),t%=s),t>n&&(h=Math.floor(t/n),t%=n),t>i&&(l=Math.floor(t/i),t%=i),t>r&&(c=Math.floor(t/r),t%=r);let d="";return void 0!==a&&(d+=a+"w"),void 0!==u&&(d+=(0!==d.length?e:"")+u+"d"),void 0!==h&&(d+=(0!==d.length?e:"")+h+"h"),void 0!==l&&(d+=(0!==d.length?e:"")+l+"m"),void 0===c&&0!==t||(d+=(0!==d.length?e:"")+(void 0!==c?c:0)+"s"),0!==t&&0===d.length&&(d+=t+"ms"),d}return""+t},t}(),St=function(){const t={isDigit:function(t){return t>=48&&t<=57},decodeDigit:function(t){if(t>=48&&t<=57)return t-48;{let e=Ct.stringOutput();throw e=e.write("Invalid base-10 digit: "),e=Ot.debugChar(e,t),new Error(e.bind())}},encodeDigit:function(t){if(t>=0&&t<=9)return 48+t;throw new Error(""+t)},countDigits:function(t){let e=0;do{e+=1,t=t/10|0}while(0!==t);return e},integerParser:function(){return new ne(void 0,void 0,0)},parseInteger:function(t){return ne.parse(t,void 0,void 0,0)},decimalParser:function(){return new ne(void 0,void 0,1)},parseDecimal:function(t){return ne.parse(t,void 0,void 0,1)},numberParser:function(){return new ne},parseNumber:function(t){return ne.parse(t)},integerWriter:function(t){return new oe(void 0,void 0===t?0:t)},writeInteger:function(t,e){return oe.write(t,void 0,e)}};return t}();class Et{constructor(t,e,r,i,n,s){this.input=t,this.tag=e,this.severity=r,this.message=i,this.note=n,this.cause=s}lineDigits(){let t=St.countDigits(this.tag.end.line);return null!==this.cause&&(t=Math.max(t,this.cause.lineDigits())),t}display(t){const e=this.input.clone(),r=this.tag.start,i=this.tag.end,n=this.severity,s=this.message,o=this.note,a=this.cause,u=this.lineDigits();return t=Et.display(t,e,r,i,n,s,o,a,2,u)}static display(t,e,r,i,n,s,o,a,u,h){for(;;){void 0!==s&&(t=(t=Et.displayMessage(t,n,s)).writeln()),t=(t=Et.displayAnchor(t,e,r,h)).writeln();const l=Et.displayContext(t,e,r,i,n,o,a,u,h),c=l[0];if(t=l[1],null===c)break;t=t.writeln(),e=c.input.clone(),r=c.tag.start,i=c.tag.end,n=c.severity,s=c.message,o=c.note,a=c.cause}return t}static displayMessage(t,e,r){return t=(t=Et.formatSeverity(t,e)).write(e.label),t=ht.reset(t),t=(t=ht.bold(t)).write(58),void 0!==r&&(t=t.write(32).write(r)),t=ht.reset(t)}static displayAnchor(t,e,r,i){t=(t=Et.displayLineLeadArrow(t,i)).write(32);const n=e.id;return void 0!==n&&(t=Ot.displayAny(t,n)),t=t.write(58),t=(t=Ot.displayNumber(t,r.line)).write(58),t=(t=Ot.displayNumber(t,r.column)).writeln(),t=Et.displayLineLead(t,i)}static displayContext(t,e,r,i,n,s,o,a,u){let h=o;const l=null!==o&&void 0===o.message&&g.equal(e.id,o.input.id)?r.offset<=o.tag.start.offset?-1:1:0;if(1===l){const e=Et.displayContext(t,o.input.clone(),o.tag.start,o.tag.end,o.severity,o.note,o.cause,a,u);h=e[0],t=(t=e[1]).writeln(),t=(t=Et.displayLineLeadEllipsis(t,u)).writeln()}if(t=Et.displayLines(t,e,r,i,n,a,u),void 0!==s&&(t=Et.displayNote(t,s,u)),-1===l){t=t.writeln(),t=(t=Et.displayLineLeadEllipsis(t,u)).writeln();const e=Et.displayContext(t,o.input.clone(),o.tag.start,o.tag.end,o.severity,o.note,o.cause,a,u);h=e[0],t=e[1]}return[h,t]}static displayLines(t,e,r,i,n,s,o){const a=r.line,u=i.line;let h=e.line;for(;h<a;)Et.consumeLineText(e,h),h+=1;if(u-a>2*s+2){for(;h<=a+s;)t=Et.displayLine(t,e,r,i,n,h,o),h+=1;for(t=(t=Et.displayLineLeadEllipsis(t,o)).write(32),t=(t=Et.formatSeverity(t,n)).write(124),t=(t=ht.reset(t)).writeln();h<u-s;)Et.consumeLineText(e,h),h+=1}for(;h<=u;)t=Et.displayLine(t,e,r,i,n,h,o),h+=1;return t}static displayNote(t,e,r){return t=t.writeln(),t=(t=Et.displayLineLead(t,r)).writeln(),t=Et.displayLineComment(t,"note",e,r)}static displayLine(t,e,r,i,n,s,o){return t=r.line===s&&i.line===s?Et.displaySingleLine(t,e,r,i,n,s,o):r.line===s?Et.displayStartLine(t,e,r,n,s,o):i.line===s?Et.displayEndLine(t,e,i,n,s,o):Et.displayMidLine(t,e,n,s,o)}static displaySingleLine(t,e,r,i,n,s,o){t=(t=Et.displayLineLeadNumber(t,s,o)).write(32);for(let r=1;r<e.column;r+=1)t=t.write(32);t=Et.displayLineText(t,e,s),t=(t=Et.displayLineLead(t,o)).write(32);let a=1;for(;a<r.column;)t=t.write(32),a+=1;for(t=Et.formatSeverity(t,n);a<=i.column;)t=t.write(94),a+=1;return void 0!==i.note&&(t=t.write(32).write(i.note)),t=ht.reset(t)}static displayStartLine(t,e,r,i,n,s){t=(t=Et.displayLineLeadNumber(t,n,s)).write(32).write(32).write(32);for(let r=1;r<e.column;r+=1)t=t.write(32);t=Et.displayLineText(t,e,n),t=(t=Et.displayLineLead(t,s)).write(32).write(32),t=(t=Et.formatSeverity(t,i)).write(95);let o=1;for(;o<r.column;)t=t.write(95),o+=1;return t=t.write(94),void 0!==r.note&&(t=t.write(32).write(r.note)),t=(t=ht.reset(t)).writeln()}static displayEndLine(t,e,r,i,n,s){t=(t=Et.displayLineLeadNumber(t,n,s)).write(32),t=(t=Et.formatSeverity(t,i)).write(124),t=(t=ht.reset(t)).write(32),t=Et.displayLineText(t,e,n),t=(t=Et.displayLineLead(t,s)).write(32),t=(t=Et.formatSeverity(t,i)).write(124).write(95);let o=1;for(;o<r.column;)t=t.write(95),o+=1;return t=t.write(94),void 0!==r.note&&(t=t.write(32).write(r.note)),t=ht.reset(t)}static displayMidLine(t,e,r,i,n){return t=(t=Et.displayLineLeadNumber(t,i,n)).write(32),t=(t=Et.formatSeverity(t,r)).write(124),t=(t=ht.reset(t)).write(32),t=Et.displayLineText(t,e,i)}static displayLineComment(t,e,r,i){return t=(t=Et.displayLineLeadComment(t,i)).write(32),t=(t=ht.bold(t)).write(e).write(58),t=ht.reset(t),void 0!==r&&(t=t.write(32).write(r)),t}static displayLineLead(t,e){t=ht.blueBold(t);const r=1+e;for(let e=0;e<r;e+=1)t=t.write(32);return t=t.write(124),t=ht.reset(t)}static displayLineLeadComment(t,e){t=ht.blueBold(t);const r=1+e;for(let e=0;e<r;e+=1)t=t.write(32);return t=t.write(61),t=ht.reset(t)}static displayLineLeadArrow(t,e){for(let r=0;r<e;r+=1)t=t.write(32);return t=(t=ht.blueBold(t)).write(45).write(45).write(62),t=ht.reset(t)}static displayLineLeadEllipsis(t,e){t=ht.blueBold(t);for(let r=0;r<e;r+=1)t=t.write(46);return t=(t=ht.reset(t)).write(32).write(32)}static displayLineLeadNumber(t,e,r){const i=r-St.countDigits(e);for(let e=0;e<i;e+=1)t=t.write(32);return t=ht.blueBold(t),t=(t=Ot.displayNumber(t,e)).write(32).write(124),t=ht.reset(t)}static displayLineText(t,e,r){for(;e.isCont()&&e.line===r;)t=t.write(e.head()),e=e.step();return e.line===r&&(t=t.writeln()),t}static consumeLineText(t,e){for(;t.isCont()&&t.line===e;)t=t.step()}static formatSeverity(t,e){switch(e.level){case st.FATAL_LEVEL:case st.ALERT_LEVEL:case st.ERROR_LEVEL:t=ht.redBold(t);break;case st.WARNING_LEVEL:t=ht.yellowBold(t);break;case st.NOTE_LEVEL:t=ht.greenBold(t);break;case st.INFO_LEVEL:t=ht.cyanBold(t);break;case st.DEBUG_LEVEL:case st.TRACE_LEVEL:default:t=ht.magentaBold(t)}return t}toString(t){return Ot.display(this,t)}static create(t,e,r,i,n,s){return 3===arguments.length?(s=null,n=void 0,i=void 0):4===arguments.length?null===i||i instanceof Et?(s=i,i=void 0):s=null:5===arguments.length?null===n||n instanceof Et?(s=n,n=void 0):s=null:void 0===s&&(s=null),new Et(t.clone(),e,r,i,n,s)}static message(t,e,r,i,n){2===arguments.length?(n=null,i=void 0,r=st.error()):3===arguments.length?null===r||r instanceof Et?(n=r,r=st.error()):"string"==typeof r?(n=null,i=r,r=st.error()):n=null:4===arguments.length?"string"==typeof r?(n=i,i=r,r=st.error()):null===i||i instanceof Et?(n=i,i=void 0):n=null:void 0===n&&(n=null);const s=e.mark,o=e.clone();return o.seek(),new Et(o,s,r,t,i,n)}static unexpected(t,e,r,i){let n;if(1===arguments.length?(i=null,e=st.error()):2===arguments.length?null===e||e instanceof Et?(i=e,e=st.error()):"string"==typeof e?(i=null,r=e,e=st.error()):i=null:3===arguments.length?"string"==typeof e?(i=r,r=e,e=st.error()):null===r||r instanceof Et?(i=r,r=void 0):i=null:void 0===i&&(i=null),t.isCont()){let e=Ct.stringOutput().write("unexpected").write(32);e=Ot.debugChar(e,t.head()),n=e.bind()}else n="unexpected end of input";const s=t.mark,o=t.clone();return o.seek(),new Et(o,s,e,n,r,i)}static expected(t,e,r,i,n){2===arguments.length?(n=null,r=st.error()):3===arguments.length?null===r||r instanceof Et?(n=r,r=st.error()):"string"==typeof r?(n=null,i=r,r=st.error()):n=null:4===arguments.length?"string"==typeof r?(n=i,i=r,r=st.error()):null===i||i instanceof Et?(n=i,i=void 0):n=null:void 0===n&&(n=null);let s=Ct.stringOutput().write("expected").write(32);s="number"==typeof t?Ot.debugChar(s,t):s.write(t),s=s.write(44).write(32).write("but found").write(32),s=e.isCont()?Ot.debugChar(s,e.head()):s.write("end of input");const o=s.bind(),a=e.mark,u=e.clone();return u.seek(),new Et(u,a,r,o,i,n)}}class kt extends pt{constructor(t,e,r){super(),Object.defineProperty(this,"id",{value:t,enumerable:!0}),Object.defineProperty(this,"mark",{value:e,enumerable:!0}),Object.defineProperty(this,"settings",{value:r,enumerable:!0})}isCont(){return!1}isEmpty(){return!0}isDone(){return!1}isError(){return!1}isPart(){return!0}asPart(t){return t?this:new At(this.id,this.mark,this.settings)}head(){throw new ct}step(){const t=new ct("empty step");return new ft(t,this.id,this.mark,this.settings)}seek(t){const e=new ct("empty seek");return new ft(e,this.id,this.mark,this.settings)}withId(t){return new kt(t,this.mark,this.settings)}withMark(t){return new kt(this.id,t,this.settings)}get offset(){return this.mark.offset}get line(){return this.mark.line}get column(){return this.mark.column}withSettings(t){return t=dt.fromAny(t),new kt(this.id,this.mark,t)}clone(){return this}}class At extends pt{constructor(t,e,r){super(),Object.defineProperty(this,"id",{value:t,enumerable:!0}),Object.defineProperty(this,"mark",{value:e,enumerable:!0}),Object.defineProperty(this,"settings",{value:r,enumerable:!0})}isCont(){return!1}isEmpty(){return!1}isDone(){return!0}isError(){return!1}isPart(){return!1}asPart(t){return t?new kt(this.id,this.mark,this.settings):this}head(){throw new ct}step(){const t=new ct("done step");return new ft(t,this.id,this.mark,this.settings)}seek(t){const e=new ct("empty seek");return new ft(e,this.id,this.mark,this.settings)}withId(t){return new At(t,this.mark,this.settings)}withMark(t){return new At(this.id,t,this.settings)}get offset(){return this.mark.offset}get line(){return this.mark.line}get column(){return this.mark.column}withSettings(t){return t=dt.fromAny(t),new At(this.id,this.mark,t)}clone(){return this}}class Mt extends pt{static empty(){return new Dt(void 0,at.zero,dt.standard())}static done(){return new It(void 0,at.zero,dt.standard())}static error(t){return new Pt(t,void 0,at.zero,dt.standard())}}e([s],Mt,"empty",null),e([s],Mt,"done",null);class Dt extends Mt{constructor(t,e,r){super(),Object.defineProperty(this,"id",{value:t,enumerable:!0}),Object.defineProperty(this,"mark",{value:e,enumerable:!0}),Object.defineProperty(this,"settings",{value:r,enumerable:!0})}isCont(){return!1}isEmpty(){return!0}isDone(){return!1}isError(){return!1}isPart(){return!0}asPart(t){return t?this:new It(this.id,this.mark,this.settings)}get index(){return 0}withIndex(t){if(0===t)return this;{const t=new ct("invalid index");return new Pt(t,this.id,this.mark,this.settings)}}get limit(){return 0}withLimit(t){if(0===t)return this;{const t=new ct("invalid limit");return new Pt(t,this.id,this.mark,this.settings)}}get capacity(){return 0}get remaining(){return 0}has(t){return!1}get(t){throw new ct}set(t,e){throw new ct}head(){throw new ct}step(t){const e=new ct("empty step");return new Pt(e,this.id,this.mark,this.settings)}seek(t){const e=new ct("empty seek");return new Pt(e,this.id,this.mark,this.settings)}withId(t){return new Dt(t,this.mark,this.settings)}withMark(t){return new Dt(this.id,t,this.settings)}get offset(){return this.mark.offset}get line(){return this.mark.line}get column(){return this.mark.column}withSettings(t){return t=dt.fromAny(t),new Dt(this.id,this.mark,t)}clone(){return this}}class It extends Mt{constructor(t,e,r){super(),Object.defineProperty(this,"id",{value:t,enumerable:!0}),Object.defineProperty(this,"mark",{value:e,enumerable:!0}),Object.defineProperty(this,"settings",{value:r,enumerable:!0})}isCont(){return!1}isEmpty(){return!1}isDone(){return!0}isError(){return!1}isPart(){return!1}asPart(t){return t?new Dt(this.id,this.mark,this.settings):this}get index(){return 0}withIndex(t){if(0===t)return this;{const t=new ct("invalid index");return new Pt(t,this.id,this.mark,this.settings)}}get limit(){return 0}withLimit(t){if(0===t)return this;{const t=new ct("invalid limit");return new Pt(t,this.id,this.mark,this.settings)}}get capacity(){return 0}get remaining(){return 0}has(t){return!1}get(t){throw new ct}set(t,e){throw new ct}head(){throw new ct}step(t){const e=new ct("done step");return new Pt(e,this.id,this.mark,this.settings)}seek(t){const e=new ct("done seek");return new Pt(e,this.id,this.mark,this.settings)}withId(t){return new It(t,this.mark,this.settings)}withMark(t){return new It(this.id,t,this.settings)}get offset(){return this.mark.offset}get line(){return this.mark.line}get column(){return this.mark.column}withSettings(t){return t=dt.fromAny(t),new It(this.id,this.mark,t)}clone(){return this}}class Pt extends Mt{constructor(t,e,r,i){super(),Object.defineProperty(this,"error",{value:t,enumerable:!0}),Object.defineProperty(this,"id",{value:e,enumerable:!0}),Object.defineProperty(this,"mark",{value:r,enumerable:!0}),Object.defineProperty(this,"settings",{value:i,enumerable:!0})}isCont(){return!1}isEmpty(){return!1}isDone(){return!1}isError(){return!0}isPart(){return!1}asPart(t){return this}get index(){return 0}withIndex(t){if(0===t)return this;{const t=new ct("invalid index");return new Pt(t,this.id,this.mark,this.settings)}}get limit(){return 0}withLimit(t){if(0===t)return this;{const t=new ct("invalid limit");return new Pt(t,this.id,this.mark,this.settings)}}get capacity(){return 0}get remaining(){return 0}has(t){return!1}get(t){throw new ct}set(t,e){throw new ct}head(){throw new ct}step(t){const e=new ct("error step");return new Pt(e,this.id,this.mark,this.settings)}trap(){return this.error}seek(t){const e=new ct("error seek");return new Pt(e,this.id,this.mark,this.settings)}withId(t){return new Pt(this.error,t,this.mark,this.settings)}withMark(t){return new Pt(this.error,this.id,t,this.settings)}get offset(){return this.mark.offset}get line(){return this.mark.line}get column(){return this.mark.column}withSettings(t){return t=dt.fromAny(t),new Pt(this.error,this.id,this.mark,t)}clone(){return this}}class Tt extends wt{constructor(t){super(),Object.defineProperty(this,"settings",{value:t,enumerable:!0})}isCont(){return!1}isFull(){return!0}isDone(){return!1}isError(){return!1}isPart(){return!0}asPart(t){return t?this:new Vt(this.settings)}write(t){return new Ft(new mt("full"),this.settings)}writeln(t){return new Ft(new mt("full"),this.settings)}bind(){throw new mt}withSettings(t){return t=lt.fromAny(t),new Tt(t)}clone(){return this}}class Vt extends wt{constructor(t){super(),Object.defineProperty(this,"settings",{value:t,enumerable:!0})}isCont(){return!1}isFull(){return!1}isDone(){return!0}isError(){return!1}isPart(){return!1}asPart(t){return t?new Tt(this.settings):this}write(t){return new Ft(new mt("done"),this.settings)}writeln(t){return new Ft(new mt("done"),this.settings)}bind(){throw new mt}withSettings(t){return t=lt.fromAny(t),new Vt(t)}clone(){return this}}class Ft extends wt{constructor(t,e){super(),Object.defineProperty(this,"error",{value:t,enumerable:!0}),Object.defineProperty(this,"settings",{value:e,enumerable:!0})}isCont(){return!1}isFull(){return!1}isDone(){return!1}isError(){return!0}isPart(){return!1}asPart(t){return this}write(t){return this}writeln(t){return this}bind(){throw new mt}trap(){return this.error}withSettings(t){return t=lt.fromAny(t),new Ft(this.error,t)}clone(){return this}}class qt extends wt{writeln(t){return"string"==typeof t&&this.write(t),this.write(this.settings.lineSeparator)}flush(){return this}clone(){throw new Error}static full(){return new Ut(lt.standard())}static done(){return new Rt(lt.standard())}static error(t){return new Nt(t,lt.standard())}}e([s],qt,"full",null),e([s],qt,"done",null);class Ut extends qt{constructor(t){super(),Object.defineProperty(this,"settings",{value:t,enumerable:!0})}isCont(){return!1}isFull(){return!0}isDone(){return!1}isError(){return!1}isPart(){return!0}asPart(t){return t?this:new Rt(this.settings)}get index(){return 0}withIndex(t){return 0===t?this:new Nt(new mt("invalid index"),this.settings)}get limit(){return 0}withLimit(t){return 0===t?this:new Nt(new mt("invalid limit"),this.settings)}get capacity(){return 0}get remaining(){return 0}has(t){return!1}get(t){throw new mt}set(t,e){throw new mt}write(t){return new Nt(new mt("full"),this.settings)}writeln(t){return new Nt(new mt("full"),this.settings)}step(t=1){return 0===t?this:new Nt(new mt("invalid step"),this.settings)}bind(){throw new mt}withSettings(t){return t=lt.fromAny(t),new Ut(t)}clone(){return this}}class Rt extends qt{constructor(t){super(),Object.defineProperty(this,"settings",{value:t,enumerable:!0})}isCont(){return!1}isFull(){return!1}isDone(){return!0}isError(){return!1}isPart(){return!1}asPart(t){return t?new Ut(this.settings):this}get index(){return 0}withIndex(t){return 0===t?this:new Nt(new mt("invalid index"),this.settings)}get limit(){return 0}withLimit(t){return 0===t?this:new Nt(new mt("invalid limit"),this.settings)}get capacity(){return 0}get remaining(){return 0}has(t){return!1}get(t){throw new mt}set(t,e){throw new mt}write(t){return new Nt(new mt("done"),this.settings)}writeln(t){return new Nt(new mt("done"),this.settings)}step(t=1){return 0===t?this:new Nt(new mt("invalid step"),this.settings)}bind(){throw new mt}withSettings(t){return t=lt.fromAny(t),new Rt(t)}clone(){return this}}class Nt extends qt{constructor(t,e){super(),Object.defineProperty(this,"error",{value:t,enumerable:!0}),Object.defineProperty(this,"settings",{value:e,enumerable:!0})}isCont(){return!1}isFull(){return!1}isDone(){return!1}isError(){return!0}isPart(){return!1}asPart(t){return this}get index(){return 0}withIndex(t){return 0===t?this:new Nt(new mt("invalid index"),this.settings)}get limit(){return 0}withLimit(t){return 0===t?this:new Nt(new mt("invalid limit"),this.settings)}get capacity(){return 0}get remaining(){return 0}has(t){return!1}get(t){throw new mt}set(t,e){throw new mt}write(t){return this}writeln(t){return this}step(t=1){return 0===t?this:new Nt(new mt("invalid step"),this.settings)}bind(){throw new mt}trap(){return this.error}withSettings(t){return t=lt.fromAny(t),new Nt(this.error,t)}clone(){return this}}class zt extends Error{constructor(t){super(t instanceof Et?t.message:t),Object.setPrototypeOf(this,zt.prototype),this.diagnostic=t instanceof Et?t:null}toString(){return null!==this.diagnostic?this.diagnostic.toString():super.toString()}}class jt{isCont(){return!0}isDone(){return!1}isError(){return!1}fork(t){return this}bind(){throw new zt}trap(){throw new zt}asError(){throw new zt}static done(t){return new Lt(t)}static error(t){return t instanceof Error?new Kt(t):new Kt(new zt(t))}}class Lt extends jt{constructor(t){super(),Object.defineProperty(this,"value",{value:t,enumerable:!0})}isCont(){return!1}isDone(){return!0}feed(t){return this}bind(){return this.value}}class Kt extends jt{constructor(t){super(),Object.defineProperty(this,"error",{value:t,enumerable:!0})}isCont(){return!1}isError(){return!0}feed(t){return this}bind(){throw this.error}trap(){return this.error}asError(){return this}}class Bt extends bt{constructor(){super()}isCont(){return!1}isDone(){return!0}pull(t){return this}bind(){throw new vt}asDone(){return this}andThen(t){return t}}class Wt extends bt{constructor(t){super(),Object.defineProperty(this,"value",{value:t,enumerable:!0})}isCont(){return!1}isDone(){return!0}pull(t){return this}bind(){return this.value}asDone(){return this}andThen(t){return t}}class Ht extends bt{constructor(t){super(),Object.defineProperty(this,"error",{value:t,enumerable:!0})}isCont(){return!1}isError(){return!0}pull(t){return this}bind(){throw this.error}trap(){return this.error}asError(){return this}andThen(t){return this}}class Xt extends bt{constructor(t,e){super(),this.head=t,this.tail=e}pull(t){let e=this.head;return e.isCont()&&(e=e.pull(t)),e.isError()?e.asError():e.isDone()?this.tail.pull(t):new Xt(e,this.tail)}}class Yt extends wt{constructor(t,e,r){super(),this.array=t,this.size=e,this.settings=r}isCont(){return!0}isFull(){return!1}isDone(){return!1}isError(){return!1}isPart(){return!1}asPart(t){return this}write(t){if("number"==typeof t){const e=this.size,r=this.array;let i;return null===r||e+1>r.length?(i=new Uint8Array(Yt.expand(e+1)),null!==r&&i.set(r,0),this.array=i):i=r,i[e]=t,this.size=e+1,this}throw new TypeError(""+t)}writeln(t){throw new TypeError(""+t)}toUint8Array(){const t=this.size,e=this.array;if(null!==e&&t===e.length)return e;{const r=new Uint8Array(t);return null!==e&&r.set(e.slice(0,t),0),this.array=r,r}}cloneArray(){const t=this.array;return null!==t?t.slice(0,this.size):null}withSettings(t){return t=lt.fromAny(t),this.settings=t,this}static expand(t){return t=Math.max(32,t)-1,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,(t|=t>>16)+1}}class Gt extends Yt{constructor(t,e,r){super(t,e,r)}bind(){return this.toUint8Array()}clone(){return new Gt(this.cloneArray(),this.size,this.settings)}}class _t extends qt{constructor(t,e,r,i,n){super(),this.array=t,this.index=e,this.limit=r,this.part=i,this.settings=n}isCont(){return this.index<this.limit}isFull(){return this.part&&this.index>=this.limit}isDone(){return!this.part&&this.index>=this.limit}isError(){return!1}isPart(){return this.part}asPart(t){return this.part=t,this}withIndex(t){return 0<=t&&t<=this.limit?(this.index=t,this):new Nt(new mt("invalid index"),this.settings)}withLimit(t){return 0<=t&&t<=this.array.length?(this.limit=t,this):new Nt(new mt("invalid limit"),this.settings)}get capacity(){return this.array.length}get remaining(){return this.limit-this.index}has(t){return 0<=t&&t<this.limit}get(t){if(0<=t&&t<this.limit)return this.array[t];throw new mt}set(t,e){if(!(0<=t&&t<this.limit))throw new mt;this.array[t]=e}write(t){if("number"==typeof t){const e=this.index;return e<this.limit?(this.array[e]=t,this.index+=1,this):new Nt(new mt("full"),this.settings)}return new Nt(new mt("binary output"),this.settings)}writeln(t){return new Nt(new mt("binary output"),this.settings)}step(t){const e=this.index+t;return 0<=e&&e<=this.limit?(this.index=e,this):new Nt(new mt("invalid step"),this.settings)}bind(){return new Uint8Array(this.array.buffer,0,this.index)}withSettings(t){return t=lt.fromAny(t),this.settings=t,this}clone(){return new _t(this.array,this.index,this.limit,this.part,this.settings)}static create(t,e,r){return void 0===e&&(e=0),void 0===r&&(r=t.length),new _t(t,e,e+r,!1,lt.standard())}}const Qt=function(){const t={output:function(t,e){let r;return void 0===e&&"number"!=typeof t?(e=t,t=void 0):"number"!=typeof t&&(t=void 0),r="number"==typeof t?new Uint8Array(t):null,e=lt.fromAny(e),new Gt(r,0,e)},outputBuffer:function(t,e,r){return _t.create(t,e,r)}};return t}();class Zt{isFatal(){return!1}isReplacement(){return!1}toString(){return Ot.debug(this)}static fatal(){return new Jt(!1)}static fatalNonZero(){return new Jt(!0)}static replacement(){return new $t(65533,!1)}static replacementNonZero(){return new $t(65533,!0)}}e([s],Zt,"fatal",null),e([s],Zt,"fatalNonZero",null),e([s],Zt,"replacement",null),e([s],Zt,"replacementNonZero",null);class Jt extends Zt{constructor(t){super(),Object.defineProperty(this,"nonZero",{value:t,enumerable:!0})}isFatal(){return!0}get replacementChar(){return 65533}isNonZero(){return this.nonZero}asNonZero(t){return t?Zt.fatalNonZero():Zt.fatal()}equals(t){return this===t||t instanceof Jt&&this.nonZero===t.nonZero}hashCode(){return n.mash(n.mix(p.hash(Jt),a.hash(this.nonZero)))}debug(t){return t=t.write("UtfErrorMode").write(46).write(this.nonZero?"fatalNonZero":"fatal").write(40).write(41)}}class $t extends Zt{constructor(t,e){super(),Object.defineProperty(this,"replacementChar",{value:t,enumerable:!0}),Object.defineProperty(this,"nonZero",{value:e,enumerable:!0})}isReplacement(){return!0}isNonZero(){return this.nonZero}asNonZero(t){return 65533===this.replacementChar?t?Zt.replacementNonZero():Zt.replacement():new $t(this.replacementChar,t)}equals(t){return this===t||t instanceof $t&&(this.replacementChar===t.replacementChar&&this.nonZero===t.nonZero)}hashCode(){return n.mash(n.mix(n.mix(p.hash($t),h.hash(this.replacementChar)),a.hash(this.nonZero)))}debug(t){return t=t.write("UtfErrorMode").write(46).write(this.nonZero?"replacementNonZero":"replacement").write(40).write(41)}}class te{constructor(t){Object.defineProperty(this,"alphabet",{value:t,enumerable:!0})}encodeDigit(t){return this.alphabet.charCodeAt(t)}uint8ArrayWriter(t){return void 0===t?new ue(this,void 0,null):new ue(this,t,t)}writeUint8Array(t,e){return ue.write(t,this,void 0,e)}writeInteger(t,e,r=0){return he.write(t,this,void 0,e,r)}writeIntegerLiteral(t,e,r=0){return he.writeLiteral(t,this,void 0,e,r)}static get lowercase(){return new te("0123456789abcdef")}static get uppercase(){return new te("0123456789ABCDEF")}static isDigit(t){return t>=48&&t<=57||t>=65&&t<=70||t>=97&&t<=102}static decodeDigit(t){if(t>=48&&t<=57)return t-48;if(t>=65&&t<=70)return t-65+10;if(t>=97&&t<=102)return t-97+10;{let e=Ct.stringOutput();throw e=e.write("Invalid base-16 digit: "),e=Ot.debugChar(e,t),new Error(e.bind())}}static writeQuantum(t,e,r){const i=te.decodeDigit(e),n=te.decodeDigit(r);return t=t.write(i<<4|n)}static parser(t){return new ae(t)}static parse(t,e){return ae.parse(t,e)}static parseUint8Array(t){return ae.parse(t,Qt.output())}}e([s],te,"lowercase",null),e([s],te,"uppercase",null);class ee extends wt{constructor(t,e,r,i,n,s){super(),this.output=t,this.errorMode=e,this.c1=r,this.c2=i,this.c3=n,this.have=s}isCont(){return this.output.isCont()}isFull(){return this.output.isFull()}isDone(){return this.output.isDone()}isError(){return this.output.isError()}isPart(){return this.output.isPart()}asPart(t){return this.output=this.output.asPart(t),this}write(t){if("number"==typeof t){let e=this.c1,r=this.c2,i=this.c3,n=-1,s=this.have;if(t>=0)switch(s){case 0:e=255&t,s=1;break;case 1:r=255&t,s=2;break;case 2:i=255&t,s=3;break;case 3:n=255&t,s=4;break;default:throw new Error("unreachable")}if(0===e&&this.errorMode.isNonZero())return wt.error(new mt("unexpected NUL byte"));if(e>=0&&e<=127)this.output=this.output.write(e),this.have=0;else if(e>=194&&e<=244)if(e>=194&&e<=223&&r>=128&&r<=191)this.output=this.output.write((31&e)<<6|63&r),this.c1=-1,this.have=0;else if(224===e&&r>=160&&r<=191||e>=225&&e<=236&&r>=128&&r<=191||237===e&&r>=128&&r<=159||e>=238&&e<=239&&r>=128&&r<=191)if(i>=128&&i<=191)this.output=this.output.write((15&e)<<12|(63&r)<<6|63&i),this.c1=-1,this.c2=-1,this.have=0;else if(i>=0){if(this.errorMode.isFatal())return wt.error(new mt(ee.invalid(e,r,i)));this.output=this.output.write(this.errorMode.replacementChar),this.c1=i,this.c2=-1,this.have=1}else{if(t<0||this.output.isDone())return wt.error(new mt(ee.invalid(e,r)));this.c2=r,this.have=2}else if(240===e&&r>=144&&r<=191||e>=241&&e<=243&&r>=128&&r<=191||244===e&&r>=128&&r<=143)if(i>=128&&i<=191)if(n>=128&&n<=191)this.have=4,this.output=this.output.write((7&e)<<18|(63&r)<<12|(63&i)<<6|63&n),this.c1=-1,this.c2=-1,this.c3=-1,this.have=0;else if(n>=0){if(this.errorMode.isFatal())return wt.error(new mt(ee.invalid(e,r,i,n)));this.output=this.output.write(this.errorMode.replacementChar),this.c1=n,this.c2=-1,this.c3=-1,this.have=1}else{if(t<0||this.output.isDone())return wt.error(new mt(ee.invalid(e,r,i)));this.c3=i,this.have=3}else if(i>=0){if(this.errorMode.isFatal())return wt.error(new mt(ee.invalid(e,r,i)));this.output=this.output.write(this.errorMode.replacementChar),this.c1=i,this.c2=-1,this.have=1}else{if(t<0||this.output.isDone())return wt.error(new mt(ee.invalid(e,r)));this.c2=r,this.have=2}else if(r>=0){if(this.errorMode.isFatal())return wt.error(new mt(ee.invalid(e,r)));this.output=this.output.write(this.errorMode.replacementChar),this.c1=r,this.have=1}else{if(t<0||this.output.isDone())return wt.error(new mt(ee.invalid(e)));this.c1=e,this.have=1}else if(e>=0){if(this.errorMode.isFatal())return wt.error(new mt(ee.invalid(e)));this.output=this.output.write(this.errorMode.replacementChar),this.have=0}return this.output.isError()?this.output:this}if("string"==typeof t)return this.output=this.output.write(t),this;throw new TypeError(""+t)}static invalid(t,e,r,i){let n=Ct.stringOutput();n=n.write("invalid UTF-8 code unit sequence: ");const s=te.uppercase;return s.writeIntegerLiteral(n,t,2),void 0!==e&&(n=n.write(" "),s.writeIntegerLiteral(n,e,2),void 0!==r&&(n=n.write(" "),s.writeIntegerLiteral(n,r,2),void 0!==i&&(n=n.write(" "),s.writeIntegerLiteral(n,i,2)))),n.bind()}get settings(){return this.output.settings}withSettings(t){return this.output=this.output.withSettings(t),this}bind(){return 0===this.have?this.output.bind():this.write(-1).bind()}trap(){return this.output.trap()}clone(){return new ee(this.output.clone(),this.errorMode,this.c1,this.c2,this.c3,this.have)}static create(t,e){return void 0===e&&(e=Zt.fatal()),new ee(t,e,-1,-1,-1,0)}}class re extends wt{constructor(t,e,r,i,n,s){super(),this.output=t,this.errorMode=e,this.c2=r,this.c3=i,this.c4=n,this.index=s}isCont(){return this.output.isCont()}isFull(){return this.output.isFull()}isDone(){return this.output.isDone()}isError(){return!1}isPart(){return this.output.isPart()}asPart(t){return this.output=this.output.asPart(t),this}write(t){if("number"==typeof t){let e=0,r=this.c2,i=this.c3,n=this.c4,s=this.output,o=this.index;for(;o<4;){if(!s.isCont())return wt.error(new mt("unable to flush buffered code units"));switch(o){case 1:s=s.write(r),this.c2=0;break;case 2:s=s.write(i),this.c3=0;break;case 3:s=s.write(n),this.c4=0;break;default:throw new Error("unreachable")}o+=1}if(t>=0&&t<=127)n=t,o=3;else if(t>=128&&t<=2047)i=192|t>>>6,n=128|63&t,o=2;else if(t>=2048&&t<=65535||t>=57344&&t<=65535)r=224|t>>>12,i=128|t>>>6&63,n=128|63&t,o=1;else{if(!(t>=65536&&t<=1114111))return this.errorMode.isFatal()?wt.error(new mt("invalid code point: "+t)):this.write(this.errorMode.replacementChar);e=240|t>>>18,r=128|t>>>12&63,i=128|t>>>6&63,n=128|63&t,o=0}do{switch(o){case 0:s=s.write(e);break;case 1:s=s.write(r),this.c2=0;break;case 2:s=s.write(i),this.c3=0;break;case 3:s=s.write(n),this.c4=0;break;default:throw new Error("unreachable")}this.output=s,o+=1}while(o<4&&s.isCont());return o<4&&(o<3&&(o<2&&(this.c2=r),this.c3=i),this.c4=n),this.output=s,this.index=o,this}if("string"==typeof t)return this.output=this.output.write(t),this;throw new TypeError(""+t)}flush(){let t=this.output,e=this.index;for(;e<4;){if(!t.isCont())return wt.error(new mt("unable to flush buffered code units"));switch(e){case 1:t=t.write(this.c2),this.c2=0;break;case 2:t=t.write(this.c3),this.c3=0;break;case 3:t=t.write(this.c4),this.c4=0;break;default:throw new Error("unreachable")}e+=1}return this.output=t,this.index=e,this}get settings(){return this.output.settings}withSettings(t){return this.output=this.output.withSettings(t),this}bind(){return this.output.bind()}clone(){return new re(this.output.clone(),this.errorMode,this.c2,this.c3,this.c4,this.index)}static create(t,e){return void 0===e&&(e=Zt.fatal()),new re(t,e,0,0,0,4)}}const ie=function(){const t={sizeOf:function(e,r){if("number"==typeof e||void 0===e){if("number"==typeof e){if(0===e&&void 0!==r&&r.isNonZero())return 2;if(e>=0&&e<=127)return 1;if(e>=128&&e<=2047)return 2;if(e>=2048&&e<=65535||e>=57344&&e<=65535)return 3;if(e>=65536&&e<=1114111)return 4}return void 0===r?3:r.isReplacement()?t.sizeOf(r.replacementChar):0}if("string"==typeof e){let i=0;for(let n=0,s=e.length;n<s;n=l.offsetByCodePoints(e,n,1))i+=t.sizeOf(e.charCodeAt(n),r);return i}throw new TypeError(""+e)},decodedOutput:function(t,e){return ee.create(t,e)},encodedOutput:function(t,e){return re.create(t,e)},decodedString:function(){return t.decodedOutput(Ct.stringOutput())}};return t}();class ne extends jt{constructor(t=1,e=0,r=2,i=1){super(),this.sign=t,this.value=e,this.mode=r,this.step=i}feed(t){return ne.parse(t,this.sign,this.value,this.mode,this.step)}static parse(t,e=1,r=0,i=2,n=1){let s=0;if(1===n)if(t.isCont())s=t.head(),45===s?(t=t.step(),e=-1):43===s&&(t=t.step(),e=1),n=2;else if(t.isDone())return jt.error(Et.expected("number",t));if(2===n)if(t.isCont())if(s=t.head(),48===s)t=t.step(),n=4;else{if(!(s>=49&&s<=57)){if(i>0&&46===s){let r=Ct.stringOutput();return e<0&&(r=r.write(45)),se.parse(t,r,i)}return jt.error(Et.expected("number",t))}t=t.step(),r=e*(s-48),n=3}else if(t.isDone())return jt.error(Et.expected("number",t));if(3===n){for(;t.isCont()&&(s=t.head(),s>=48&&s<=57);){const i=10*r+e*(s-48);if(!(-9007199254740991<=i&&i<=9007199254740992))return jt.error(Et.message("integer overflow",t));r=i,t=t.step()}if(t.isCont())n=4;else if(t.isDone())return jt.done(r)}if(4===n){if(t.isCont()){if(s=t.head(),i>0&&46===s||i>1&&(69===s||101===s)){let n=Ct.stringOutput();return n=e<0&&0===r?n.write(45).write(48):n.write(""+r),se.parse(t,n,i)}return jt.done(r)}if(t.isDone())return jt.done(r)}return new ne(e,r,i,n)}}class se extends jt{constructor(t,e=2,r=1){super(),this.output=t,this.mode=e,this.step=r}feed(t){return se.parse(t,this.output,this.mode,this.step)}static parse(t,e,r=2,i=1){let n=0;if(1===i)if(t.isCont())if(n=t.head(),46===n)t=t.step(),e=e.write(n),i=2;else{if(!(r>1)||69!==n&&101!==n)return jt.error(Et.expected("decimal or exponent",t));t=t.step(),e=e.write(n),i=5}else if(t.isDone())return jt.error(Et.expected("decimal or exponent",t));if(2===i)if(t.isCont()){if(n=t.head(),!(n>=48&&n<=57))return jt.error(Et.expected("digit",t));t=t.step(),e=e.write(n),i=3}else if(t.isDone())return jt.error(Et.expected("digit",t));if(3===i){for(;t.isCont()&&(n=t.head(),n>=48&&n<=57);)t=t.step(),e=e.write(n);if(t.isCont()){if(!(r>1))return jt.done(+e.bind());i=4}else if(t.isDone())return jt.done(+e.bind())}if(4===i){if(n=t.head(),69!==n&&101!==n)return jt.done(+e.bind());t=t.step(),e=e.write(n),i=5}if(5===i)if(t.isCont())n=t.head(),43!==n&&45!==n||(t=t.step(),e=e.write(n)),i=6;else if(t.isDone())return jt.error(Et.unexpected(t));if(6===i)if(t.isCont()){if(n=t.head(),!(n>=48&&n<=57))return jt.error(Et.expected("digit",t));t=t.step(),e=e.write(n),i=7}else if(t.isDone())return jt.error(Et.expected("digit",t));if(7===i){for(;t.isCont()&&(n=t.head(),n>=48&&n<=57);)t=t.step(),e=e.write(n);if(!t.isEmpty())return jt.done(+e.bind())}return new se(e,r,i)}}class oe extends bt{constructor(t,e,r=0,i=1){super(),this.value=t,this.input=e,this.index=r,this.step=i}pull(t){return oe.write(t,this.value,this.input,this.index,this.step)}static write(t,e,r,i=0,n=1){if(0===n)return bt.end();if(1===n&&(r<0?t.isCont()&&(t=t.write(45),n=2):n=2),2===n)if(r>-10&&r<10){if(t.isCont())return t=t.write(St.encodeDigit(Math.abs(0|r))),bt.done(e)}else{const n=new Array(19);let s=r,o=18;for(;0!==s;)n[o]=Math.abs(s%10|0),s=s/10|0,o-=1;for(o+=1+i;o<19&&t.isCont();)t=t.write(St.encodeDigit(n[o])),i+=1,o+=1;if(19===o)return bt.done(e)}return t.isDone()?bt.error(new vt("truncated")):t.isError()?bt.error(t.trap()):new oe(e,r,i,n)}}class ae extends jt{constructor(t,e=0,r=1){super(),this.output=t,this.p=e,this.step=r}feed(t){return ae.parse(t,this.output.clone(),this.p,this.step)}static parse(t,e,r=0,i=1){let n=0;for(;!t.isEmpty();){if(1===i)if(t.isCont()&&(n=t.head(),te.isDigit(n)))t=t.step(),r=n,i=2;else if(!t.isEmpty())return jt.done(e.bind());if(2===i)if(t.isCont()&&(n=t.head(),te.isDigit(n)))t=t.step(),e=te.writeQuantum(e,r,n),r=0,i=1;else if(!t.isEmpty())return jt.error(Et.expected("base16 digit",t))}return new ae(e,r,i)}}class ue extends bt{constructor(t,e,r,i=0,n=1){super(),this.base16=t,this.value=e,this.input=r,this.index=i,this.step=n}feed(t){if(t instanceof Uint8Array)return new ue(this.base16,void 0,t);throw new TypeError(""+t)}pull(t){if(null===this.input)throw new vt;return ue.write(t,this.base16,this.value,this.input,this.index,this.step)}static write(t,e,r,i,n=0,s=1){for(;n<i.length;){const r=i[n];1===s&&t.isCont()&&(t=t.write(e.encodeDigit(r>>>4)),s=2),2===s&&t.isCont()&&(t=t.write(e.encodeDigit(15&r)),n+=1,s=1)}return n===i.length?bt.done(r):t.isDone()?bt.error(new vt("truncated")):t.isError()?bt.error(t.trap()):new ue(e,r,i,n,s)}}class he extends bt{constructor(t,e,r,i,n=0,s=3){super(),this.base16=t,this.value=e,this.input=r,this.width=i,this.index=n,this.step=s}pull(t){return he.write(t,this.base16,this.value,this.input,this.width,this.index,this.step)}static write(t,e,r,i,n,s=0,o=3){if(o<=0)return bt.end();if(1===o&&t.isCont()&&(t=t.write(48),o=2),2===o&&t.isCont()&&(t=t.write(120),o=3),3===o)if(i>=0&&i<16&&n<=1){if(t.isCont())return t=t.write(e.encodeDigit(i)),bt.done(r)}else{let o=15;const a=new Array(16);let u=i;for(;0!==u||o>=16-n;)a[o]=15&u,u>>>=4,o-=1;for(o+=1+s;o<16&&t.isCont();)t=t.write(e.encodeDigit(a[o])),s+=1,o+=1;if(16===o)return bt.done(r)}return t.isDone()?bt.error(new vt("truncated")):t.isError()?bt.error(t.trap()):new he(e,r,i,n,s,o)}static writeLiteral(t,e,r,i,n){return he.write(t,e,r,i,n,0,1)}}class le{decodeDigit(t){if(t>=65&&t<=90)return t-65;if(t>=97&&t<=122)return t+-71;if(t>=48&&t<=57)return t+4;if(43===t||45===t)return 62;if(47===t||95===t)return 63;{let e=Ct.stringOutput();throw e=e.write("Invalid base-64 digit: "),e=Ot.debugChar(e,t),new Error(e.bind())}}encodeDigit(t){return this.alphabet.charCodeAt(t)}writeQuantum(t,e,r,i,n){const s=this.decodeDigit(e),o=this.decodeDigit(r);if(61!==i){const e=this.decodeDigit(i);if(61!==n){const r=this.decodeDigit(n);t=(t=(t=t.write(s<<2|o>>>4)).write(o<<4|e>>>2)).write(e<<6|r)}else t=(t=t.write(s<<2|o>>>4)).write(o<<4|e>>>2)}else{if(61!==n)return wt.error(new Error("Improperly padded base-64"));t=t.write(s<<2|o>>>4)}return t}parser(t){return new pe(this,t)}parse(t,e){return pe.parse(t,this,e)}parseUint8Array(t){return pe.parse(t,this,Qt.output())}uint8ArrayWriter(t){return void 0===t?new fe(this,void 0,null):new fe(this,t,t)}writeUint8Array(t,e){return fe.write(t,this,void 0,e)}static get standardPadded(){return new ce(!0)}static get standardUnpadded(){return new ce(!1)}static standard(t=!0){return t?le.standardPadded:le.standardUnpadded}static get urlPadded(){return new de(!0)}static get urlUnpadded(){return new de(!1)}static url(t=!0){return t?le.urlPadded:le.urlUnpadded}}e([s],le,"standardPadded",null),e([s],le,"standardUnpadded",null),e([s],le,"urlPadded",null),e([s],le,"urlUnpadded",null);class ce extends le{constructor(t){super(),Object.defineProperty(this,"padded",{value:t,enumerable:!0})}get alphabet(){return"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"}isPadded(){return this.padded}asPadded(t){return t===this.padded?this:le.standard(t)}isDigit(t){return t>=48&&t<=57||t>=65&&t<=90||t>=97&&t<=122||43===t||47===t}}class de extends le{constructor(t){super(),Object.defineProperty(this,"padded",{value:t,enumerable:!0})}get alphabet(){return"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"}isPadded(){return this.padded}asPadded(t){return t===this.padded?this:le.url(t)}isDigit(t){return t>=48&&t<=57||t>=65&&t<=90||t>=97&&t<=122||45===t||95===t}}class pe extends jt{constructor(t,e,r=0,i=0,n=0,s=1){super(),this.base64=t,this.output=e,this.p=r,this.q=i,this.r=n,this.step=s}feed(t){return pe.parse(t,this.base64,this.output.clone(),this.p,this.q,this.r,this.step)}static parse(t,e,r,i=0,n=0,s=0,o=1){let a=0;for(;!t.isEmpty();){if(1===o)if(t.isCont()&&(a=t.head(),e.isDigit(a)))t=t.step(),i=a,o=2;else if(!t.isEmpty())return jt.done(r.bind());if(2===o)if(t.isCont()&&(a=t.head(),e.isDigit(a)))t=t.step(),n=a,o=3;else if(!t.isEmpty())return jt.error(Et.expected("base64 digit",t));if(3===o)if(t.isCont()&&(a=t.head(),e.isDigit(a)||61===a))t=t.step(),s=a,o=61!==a?4:5;else if(!t.isEmpty())return e.isPadded()?jt.error(Et.unexpected(t)):(r=e.writeQuantum(r,i,n,61,61),jt.done(r.bind()));if(4===o){if(t.isCont()&&(a=t.head(),e.isDigit(a)||61===a)){if(t=t.step(),r=e.writeQuantum(r,i,n,s,a),s=0,n=0,i=0,61===a)return jt.done(r.bind());o=1}else if(!t.isEmpty())return e.isPadded()?jt.error(Et.unexpected(t)):(r=e.writeQuantum(r,i,n,s,61),jt.done(r.bind()))}else if(5===o){if(t.isCont()&&(a=t.head(),61===a))return t=t.step(),r=e.writeQuantum(r,i,n,s,a),s=0,n=0,i=0,jt.done(r.bind());if(!t.isEmpty())return jt.error(Et.expected(61,t))}}return new pe(e,r,i,n,s,o)}}class fe extends bt{constructor(t,e,r,i=0,n=1){super(),this.base64=t,this.value=e,this.input=r,this.index=i,this.step=n}feed(t){if(t instanceof Uint8Array)return new fe(this.base64,null,t);throw new TypeError(""+t)}pull(t){if(null===this.input)throw new vt;return fe.write(t,this.base64,this.value,this.input,this.index,this.step)}static write(t,e,r,i,n=0,s=1){for(;n+2<i.length&&t.isCont();){const r=i[n],o=i[n+1],a=i[n+2];1===s&&t.isCont()&&(t=t.write(e.encodeDigit(r>>>2)),s=2),2===s&&t.isCont()&&(t=t.write(e.encodeDigit(63&(r<<4|o>>>4))),s=3),3===s&&t.isCont()&&(t=t.write(e.encodeDigit(63&(o<<2|a>>>6))),s=4),4===s&&t.isCont()&&(t=t.write(e.encodeDigit(63&a)),n+=3,s=1)}if(n+1<i.length&&t.isCont()){const r=i[n],o=i[n+1];1===s&&t.isCont()&&(t=t.write(e.encodeDigit(r>>>2)),s=2),2===s&&t.isCont()&&(t=t.write(e.encodeDigit(63&(r<<4|o>>>4))),s=3),3===s&&t.isCont()&&(t=t.write(e.encodeDigit(o<<2&63)),s=4),4===s&&(e.isPadded()?t.isCont()&&(t=t.write(61),n+=2):n+=2)}else if(n<i.length&&t.isCont()){const r=i[n];1===s&&t.isCont()&&(t=t.write(e.encodeDigit(r>>>2)),s=2),2===s&&t.isCont()&&(t=t.write(e.encodeDigit(r<<4&63)),s=3),3===s&&(e.isPadded()?t.isCont()&&(t=t.write(61),s=4):n+=1),4===s&&t.isCont()&&(t=t.write(61),n+=1)}return n===i.length?bt.done(r):t.isDone()?bt.error(new vt("truncated")):t.isError()?bt.error(t.trap()):new fe(e,r,i,n,s)}}const ye=function(){const t={Transient:0,Inherited:1,Intrinsic:2,Extrinsic:3,Reflexive:4,Shift:2};return t.Mask=(1<<t.Shift)-1,t}(),me=function(){const t={getLazyFastener:function(e,r,i){let n=e.getFastener(r);if(null===n){const s=e.constructor,o=t.getFastenerClass(s,r,i);null!==o&&(n=o.create(e),e.setFastener(r,n))}else null==i||n instanceof i||(n=null);return n},getFastenerClass:function(t,e,r){do{if(Object.prototype.hasOwnProperty.call(t,"fastenerClassMap")){const i=t.fastenerClassMap[e];if(void 0!==i&&(null==r||i.prototype instanceof r))return i}t=Object.getPrototypeOf(t)}while(null!==t);return null},getSuperFastenerClass:function(e,r,i){const n=Object.getPrototypeOf(e),s=t.getFastenerClass(n,r,i);if(null===s)throw new Error("No "+r+" "+(null!=i?i.name:"fastener")+" class in "+n.constructor.name);return s},decorate:function(e,r,i,n){const s=i.constructor,o=n.toString(),a=r.extends;"string"==typeof a?Object.defineProperty(r,"extends",{value:t.getSuperFastenerClass(s,a),writable:!0,enumerable:!0,configurable:!0}):!0===a?Object.defineProperty(r,"extends",{value:t.getSuperFastenerClass(s,o),writable:!0,enumerable:!0,configurable:!0}):!1===a&&Object.defineProperty(r,"extends",{value:null,writable:!0,enumerable:!0,configurable:!0});const u=e.define(o,r);u.contextClass=s,Object.prototype.hasOwnProperty.call(s,"fastenerClassMap")||(s.fastenerClassMap={}),s.fastenerClassMap[o]=u,u.prototype.lazy||(Object.prototype.hasOwnProperty.call(s,"fastenerClassInitMap")||(s.fastenerClassInitMap={}),s.fastenerClassInitMap[o]=u);let h=u.prototype.static;!1!==h&&(!0===h&&(h=o),s[h]=u),Object.defineProperty(i,n,{get:function(){let t=this.getFastener(o);return null===t&&(t=u.create(this),this.setFastener(o,t)),t},configurable:!0})},decorator:function(e,r){return t.decorate.bind(t,e,r)},init:function(t){let e=t.constructor;do{if(Object.prototype.hasOwnProperty.call(e,"fastenerClassInitMap")){const r=e.fastenerClassInitMap;for(const e in r){const i=r[e];if(!t.hasFastener(e)){const r=i.create(t);t.setFastener(e,r)}}}e=Object.getPrototypeOf(e)}while(null!==e)},has:function(t,e){return("object"==typeof t&&null!==t||"function"==typeof t)&&e in t},is:function(t){if("object"==typeof t&&null!==t||"function"==typeof t){return"hasFastener"in t}return!1}};return t}(),we=function(t){const e=function(t){return me.decorator(e,t)};return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.prototype.init=function(){},Object.defineProperty(e.prototype,"familyType",{get:function(){return null},configurable:!0}),Object.defineProperty(e.prototype,"name",{value:"",configurable:!0}),e.prototype.setFlags=function(t){this.flags=t},Object.defineProperty(e.prototype,"affinity",{get(){return this.flags&ye.Mask},configurable:!0}),e.prototype.hasAffinity=function(t){return t>=this.affinity},e.prototype.initAffinity=function(t){this.flags=this.flags&~ye.Mask|t&ye.Mask},e.prototype.minAffinity=function(t){const e=this.affinity;if(void 0===t)t=ye.Extrinsic;else if(t===ye.Reflexive)t=e;else if(0!=(t&~ye.Mask))throw new Error("invalid affinity: "+t);return t>e&&(this.willSetAffinity(t,e),this.setFlags(this.flags&~ye.Mask|t),this.onSetAffinity(t,e),this.didSetAffinity(t,e)),t>=e},e.prototype.setAffinity=function(t){if(0!=(t&~ye.Mask))throw new Error("invalid affinity: "+t);const e=this.affinity;t!==e&&(this.willSetAffinity(t,e),this.setFlags(this.flags&~ye.Mask|t),this.onSetAffinity(t,e),this.didSetAffinity(t,e))},e.prototype.willSetAffinity=function(t,e){},e.prototype.onSetAffinity=function(t,e){if(t>e&&this.inherited){const e=this.superFastener;null!==e&&Math.min(e.affinity,ye.Intrinsic)<t&&this.setInherited(!1,e)}else if(t<e&&this.inherits){const e=this.superFastener;null!==e&&Math.min(e.affinity,ye.Intrinsic)>=t&&this.setInherited(!0,e)}},e.prototype.didSetAffinity=function(t,e){},Object.defineProperty(e.prototype,"inherits",{get:function(){return 0!=(this.flags&e.InheritsFlag)},configurable:!0}),e.prototype.initInherits=function(t){let r;"string"==typeof t&&(r=t,t=!0),t?(void 0!==r&&Object.defineProperty(this,"name",{value:r,enumerable:!0,configurable:!0}),this.flags=this.flags|e.InheritsFlag):this.flags=this.flags&~e.InheritsFlag},e.prototype.setInherits=function(t){let r;"string"==typeof t&&(t!==this.name&&(r=t),t=!0),t===(0!=(this.flags&e.InheritsFlag))&&void 0===r||(this.unbindSuperFastener(),this.willSetInherits(t,r),t?(void 0!==r&&Object.defineProperty(this,"name",{value:r,enumerable:!0,configurable:!0}),this.setFlags(this.flags|e.InheritsFlag)):this.setFlags(this.flags&~e.InheritsFlag),this.onSetInherits(t,r),this.didSetInherits(t,r),this.bindSuperFastener())},e.prototype.willSetInherits=function(t,e){},e.prototype.onSetInherits=function(t,e){},e.prototype.didSetInherits=function(t,e){},Object.defineProperty(e.prototype,"inherited",{get:function(){return 0!=(this.flags&e.InheritedFlag)},configurable:!0}),e.prototype.setInherited=function(t,r){t&&0==(this.flags&e.InheritedFlag)?(this.willInherit(r),this.setFlags(this.flags|e.InheritedFlag),this.onInherit(r),this.didInherit(r)):t||0==(this.flags&e.InheritedFlag)||(this.willUninherit(r),this.setFlags(this.flags&~e.InheritedFlag),this.onUninherit(r),this.didUninherit(r))},e.prototype.willInherit=function(t){},e.prototype.onInherit=function(t){},e.prototype.didInherit=function(t){},e.prototype.willUninherit=function(t){},e.prototype.onUninherit=function(t){},e.prototype.didUninherit=function(t){},Object.defineProperty(e.prototype,"superName",{get:function(){return this.inherits?this.name:void 0},configurable:!0}),Object.defineProperty(e.prototype,"superFastener",{get:function(){return this.getSuperFastener()},configurable:!0}),e.prototype.getSuperFastener=function(){const t=this.superName;if(void 0!==t){const e=this.owner;if(me.is(e)){const r=e.getSuperFastener(t,this.familyType);if(null!==r)return r}}return null},e.prototype.bindSuperFastener=function(){const t=this.superName;if(void 0!==t){const e=this.owner;if(me.is(e)){const r=e.getSuperFastener(t,this.familyType);null!==r&&(this.willBindSuperFastener(r),r.attachSubFastener(this),this.onBindSuperFastener(r),this.didBindSuperFastener(r))}}},e.prototype.willBindSuperFastener=function(t){},e.prototype.onBindSuperFastener=function(t){t.affinity>=this.affinity&&this.setInherited(!0,t)},e.prototype.didBindSuperFastener=function(t){},e.prototype.unbindSuperFastener=function(){const t=this.superFastener;null!==t&&(this.willUnbindSuperFastener(t),t.detachSubFastener(this),this.onUnbindSuperFastener(t),this.didUnbindSuperFastener(t))},e.prototype.willUnbindSuperFastener=function(t){},e.prototype.onUnbindSuperFastener=function(t){this.setInherited(!1,t)},e.prototype.didUnbindSuperFastener=function(t){},e.prototype.attachSubFastener=function(t){},e.prototype.detachSubFastener=function(t){},Object.defineProperty(e.prototype,"coherent",{get:function(){return 0==(this.flags&e.DecoherentFlag)},configurable:!0}),e.prototype.setCoherent=function(t){t?this.setFlags(this.flags&~e.DecoherentFlag):this.setFlags(this.flags|e.DecoherentFlag)},e.prototype.decohere=function(){const t=this.owner;me.has(t,"decohereFastener")&&t.decohereFastener(this)},e.prototype.recohere=function(t){},Object.defineProperty(e.prototype,"mounted",{get:function(){return 0!=(this.flags&e.MountedFlag)},configurable:!0}),e.prototype.mount=function(){0==(this.flags&e.MountedFlag)&&(this.willMount(),this.setFlags(this.flags|e.MountedFlag),this.onMount(),this.didMount())},e.prototype.willMount=function(){},e.prototype.onMount=function(){this.bindSuperFastener()},e.prototype.didMount=function(){},e.prototype.unmount=function(){0!=(this.flags&e.MountedFlag)&&(this.willUnmount(),this.setFlags(this.flags&~e.MountedFlag),this.onUnmount(),this.didUnmount())},e.prototype.willUnmount=function(){},e.prototype.onUnmount=function(){this.unbindSuperFastener()},e.prototype.didUnmount=function(){},e.prototype.toString=function(){return this.name},Object.defineProperty(e.prototype,"lazy",{get:function(){return!0},configurable:!0}),Object.defineProperty(e.prototype,"static",{get:function(){return!1},configurable:!0}),e.create=function(t){const e=this.construct(this,null,t);return e.init(),e},e.construct=function(t,e,r){return null===e&&(e=Object.create(t.prototype)),e.owner=r,e.flags=0,e},e.extend=function(t,e){let r,i;null!=e&&"string"==typeof e.name&&c.isValid(e.name)?(r=e.name,t=r):c.isValid(t)&&(r=t),void 0!==r?i=new Function("FastenerContext","return function "+t+"(descriptor) { return FastenerContext.decorator("+t+", descriptor); }")(me):(i=function(t){return me.decorator(i,t)},Object.defineProperty(i,"name",{value:t,configurable:!0}));const n={};if(null!=e){n.name={value:t,configurable:!0};const r=Object.getOwnPropertyNames(e);for(let t=0;t<r.length;t+=1){const i=r[t];n[i]=Object.getOwnPropertyDescriptor(e,i)}}else n.name={value:"",configurable:!0};return Object.setPrototypeOf(i,this),i.prototype=Object.create(this.prototype,n),i.prototype.constructor=i,i},e.define=function(t,e){let r=e.extends;const i=e.affinity,n=e.inherits;delete e.extends,delete e.affinity,delete e.inherits,null==r&&(r=this);const s=r.extend(t,e);return s.construct=function(t,e,s){return e=r.construct(t,e,s),void 0!==i&&e.initAffinity(i),void 0!==n&&e.initInherits(n),e},s},e.MountedFlag=1<<ye.Shift+0,e.InheritsFlag=1<<ye.Shift+1,e.InheritedFlag=1<<ye.Shift+2,e.DecoherentFlag=1<<ye.Shift+3,e.FlagShift=ye.Shift+4,e.FlagMask=(1<<e.FlagShift)-1,e}(Object),ge=function(t){const e=t.extend("Property");return Object.defineProperty(e.prototype,"familyType",{get:function(){return e},configurable:!0}),e.prototype.onInherit=function(t){this.setState(t.state,ye.Reflexive)},e.prototype.onBindSuperFastener=function(e){this.superFastener=e,t.prototype.onBindSuperFastener.call(this,e)},e.prototype.onUnbindSuperFastener=function(e){t.prototype.onUnbindSuperFastener.call(this,e),this.superFastener=null},e.prototype.attachSubFastener=function(t){let e=this.subFasteners;null===e&&(e=[],this.subFasteners=e),e.push(t)},e.prototype.detachSubFastener=function(t){const e=this.subFasteners;if(null!==e){const r=e.indexOf(t);r>=0&&e.splice(r,1)}},Object.defineProperty(e.prototype,"superState",{get:function(){const t=this.superFastener;return null!==t?t.state:void 0},configurable:!0}),e.prototype.getSuperState=function(){const t=this.superState;if(null==t){let e=t+" ";throw 0!==this.name.length&&(e+=this.name+" "),e+="super state",new TypeError(e)}return t},e.prototype.getSuperStateOr=function(t){let e=this.superState;return null==e&&(e=t),e},e.prototype.getState=function(){const t=this.state;if(null==t){let e=t+" ";throw 0!==this.name.length&&(e+=this.name+" "),e+="state",new TypeError(e)}return t},e.prototype.getStateOr=function(t){let e=this.state;return null==e&&(e=t),e},e.prototype.setState=function(t,e){if(this.minAffinity(e)){t=this.fromAny(t);const e=this.state;this.equalState(t,e)||(this.willSetState(t,e),this.state=t,this.onSetState(t,e),this.didSetState(t,e),this.setCoherent(!0),this.decohereSubFasteners())}},e.prototype.willSetState=function(t,e){},e.prototype.onSetState=function(t,e){const r=this.updateFlags,i=this.owner;void 0!==r&&me.has(i,"requireUpdate")&&i.requireUpdate(r)},e.prototype.didSetState=function(t,e){},e.prototype.decohereSubFasteners=function(){const t=this.subFasteners;for(let e=0,r=null!==t?t.length:0;e<r;e+=1)this.decohereSubFastener(t[e])},e.prototype.decohereSubFastener=function(t){!t.inherited&&Math.min(this.affinity,ye.Intrinsic)>=t.affinity?t.setInherited(!0,this):t.inherited&&t.coherent&&(t.setCoherent(!1),t.decohere())},e.prototype.recohere=function(t){if(this.inherited){const t=this.superFastener;null!==t&&this.setState(t.state,ye.Reflexive)}},e.prototype.isDefined=function(t){return null!=t},e.prototype.equalState=function(t,e){return f(t,e)},e.prototype.fromAny=function(t){return t},e.construct=function(e,r,i){return null===r&&(r=function(t,e){return 0===arguments.length?r.state:(r.setState(t,e),r.owner)},delete r.name,Object.setPrototypeOf(r,e.prototype)),r=t.construct(e,r,i),Object.defineProperty(r,"superFastener",{value:null,writable:!0,enumerable:!0,configurable:!0}),r.subFasteners=null,r.state=void 0,r},e.specialize=function(t){return t===String?ve:t===Number?be:t===Boolean?xe:null},e.define=function(t,e){let r=e.extends;const i=e.affinity,n=e.inherits,s=e.state,o=e.initState;delete e.extends,delete e.affinity,delete e.inherits,delete e.state,delete e.initState,null==r&&(r=this.specialize(e.type)),null===r&&(r=this,void 0===e.fromAny&&b.is(e.type)&&(e.fromAny=e.type.fromAny));const a=r.extend(t,e);return a.construct=function(t,e,a){return e=r.construct(t,e,a),void 0!==i&&e.initAffinity(i),void 0!==n&&e.initInherits(n),void 0!==o?e.state=e.fromAny(o()):void 0!==s&&(e.state=e.fromAny(s)),e},a},e}(we),ve=function(t){const e=t.extend("StringProperty");return e.prototype.fromAny=function(t){return t},e.prototype.equalState=function(t,e){return t===e},e}(ge),be=function(t){const e=t.extend("NumberProperty");return e.prototype.fromAny=function(t){if("string"==typeof t){const e=+t;if(isFinite(e))return e;throw new Error(t)}return t},e.prototype.equalState=function(t,e){return t===e},e}(ge),xe=function(t){const e=t.extend("BooleanProperty");return e.prototype.fromAny=function(t){return!!t},e.prototype.equalState=function(t,e){return t===e},e}(ge),Ce=function(t){const e=t.extend("Animator");return e.prototype.onInherit=function(t){const r=t.state,i=this.state,n=!this.equalState(r,i);n&&(this.willSetState(r,i),this.state=r,this.timing=null,this.interpolator=null,this.onSetState(r,i)),t instanceof e?this.setValue(t.value):this.setValue(r),n&&(this.didSetState(r,i),this.tweening&&this.didInterrupt(this.value)),t instanceof e&&t.tweening?this.startTweening():this.stopTweening()},e.prototype.setState=function(t,r,i){if("number"==typeof r&&(i=r,r=void 0),this.minAffinity(i)){t=this.fromAny(t);const i=this.state;if(!this.equalState(t,i)){const n=!1!==(r=null!=r&&!1!==r&&(!0===r?null!==this.timing&&this.timing:V.fromAny(r)))&&this.isDefined(i);this.willSetState(t,i),this.state=t,n?(this.timing=r,this.interpolator=k(this.value,t),this.tweening?this.setFlags(this.flags|e.DivergedFlag|e.InterruptFlag):this.setFlags(this.flags|e.DivergedFlag)):(this.timing=null,this.interpolator=null),this.onSetState(t,i),n||this.setValue(t),this.didSetState(t,i),n?this.startTweening():this.tweening&&(this.didInterrupt(this.value),this.stopTweening())}}},e.prototype.onSetState=function(t,e){},Object.defineProperty(e.prototype,"superValue",{get:function(){const t=this.superFastener;return t instanceof e?t.value:void 0},configurable:!0}),e.prototype.getSuperValue=function(){const t=this.superValue;if(null==t){let e=t+" ";throw 0!==this.name.length&&(e+=this.name+" "),e+="super value",new TypeError(e)}return t},e.prototype.getSuperValueOr=function(t){let e=this.superValue;return null==e&&(e=t),e},e.prototype.getValue=function(){const t=this.value;if(null==t){let e=t+" ";throw 0!==this.name.length&&(e+=this.name+" "),e+="value",new TypeError(e)}return t},e.prototype.getValueOr=function(t){let e=this.value;return null==e&&(e=t),e},e.prototype.setValue=function(t,e){1===arguments.length&&(e=this.value),this.equalState(t,e)||(this.willSetValue(t,e),this.value=t,this.onSetValue(t,e),this.didSetValue(t,e),this.decohereSubFasteners())},e.prototype.willSetValue=function(t,e){},e.prototype.onSetValue=function(t,e){const r=this.updateFlags,i=this.owner;void 0!==r&&me.has(i,"requireUpdate")&&i.requireUpdate(r)},e.prototype.didSetValue=function(t,e){},e.prototype.setInterpolatedValue=function(t,e){const r=arguments.length>1?this.state:void 0,i=arguments.length>1&&!this.equalState(e,r);i&&(this.willSetState(e,r),this.state=e,this.timing=null,this.interpolator=null,this.onSetState(e,r)),this.setValue(t),i&&(this.didSetState(e,r),this.tweening&&(this.didInterrupt(this.value),this.stopTweening()))},e.prototype.decohereSubFastener=function(t){!t.inherited&&Math.min(this.affinity,ye.Intrinsic)>=t.affinity?t.setInherited(!0,this):t.inherited&&(this.tweening&&t instanceof e&&t.startTweening(),t.coherent&&(t.setCoherent(!1),t.decohere()))},e.prototype.recohere=function(t){this.inherited?this.tweenInherited(t):this.tweening&&this.tween(t)},e.prototype.tween=function(t){const r=this.value;let i=this.timing;null===i&&(i=F.linear.withDomain(t,t),this.timing=i);let n=this.interpolator;null===n&&(n=k(r,this.state),this.interpolator=n),0!=(this.flags&e.InterruptFlag)&&(this.setFlags(this.flags&~e.InterruptFlag),this.didInterrupt(r)),0!=(this.flags&e.DivergedFlag)&&(this.setFlags(this.flags&~e.DivergedFlag),i=this.equalState(this.state,r)?i.withDomain(t-i.duration,t):i.withDomain(t,t+i.duration),this.timing=i,this.willTransition(r));const s=i(t),o=n(s);this.setValue(o),s<1?this.decohere():this.tweening?(this.stopTweening(),this.interpolator=null,this.didTransition(o)):this.setCoherent(!0)},e.prototype.tweenInherited=function(t){const r=this.superFastener;if(null!==r){const t=r.state,i=this.state,n=!this.equalState(t,i);n&&(this.willSetState(t,i),this.state=t,this.timing=null,this.interpolator=null,this.onSetState(t,i)),r instanceof e?this.setValue(r.value):this.setValue(r.state),n&&(this.didSetState(t,i),this.tweening&&this.didInterrupt(this.value)),r instanceof e&&r.tweening?this.decohere():this.tweening?this.stopTweening():this.setCoherent(!0)}else this.stopTweening()},Object.defineProperty(e.prototype,"tweening",{get:function(){return 0!=(this.flags&e.TweeningFlag)},configurable:!0}),e.prototype.startTweening=function(){0==(this.flags&e.TweeningFlag)&&(this.willStartTweening(),this.setFlags(this.flags|e.TweeningFlag),this.onStartTweening(),this.didStartTweening())},e.prototype.willStartTweening=function(){},e.prototype.onStartTweening=function(){this.coherent&&(this.setCoherent(!1),this.decohere()),this.decohereSubFasteners()},e.prototype.didStartTweening=function(){},e.prototype.stopTweening=function(){0!=(this.flags&e.TweeningFlag)&&(this.willStopTweening(),this.setFlags(this.flags&~e.TweeningFlag),this.onStopTweening(),this.didStopTweening())},e.prototype.willStopTweening=function(){},e.prototype.onStopTweening=function(){this.setCoherent(!0)},e.prototype.didStopTweening=function(){},e.prototype.willTransition=function(t){},e.prototype.didTransition=function(t){},e.prototype.didInterrupt=function(t){},e.prototype.onUnmount=function(){this.stopTweening(),t.prototype.onUnmount.call(this)},e.construct=function(e,r,i){return null===r&&(r=function(t,e,i){return 0===arguments.length?r.value:(2===arguments.length?r.setState(t,e):r.setState(t,e,i),r.owner)},delete r.name,Object.setPrototypeOf(r,e.prototype)),(r=t.construct(e,r,i)).value=r.state,r.timing=null,r.interpolator=null,r},e.specialize=function(t){return t===String?Oe:t===Number?Se:t===Boolean?Ee:null},e.define=function(t,e){let r=e.extends;const i=e.affinity,n=e.inherits,s=e.state,o=e.initState;delete e.extends,delete e.affinity,delete e.inherits,delete e.state,delete e.initState,null==r&&(r=this.specialize(e.type)),null===r&&(r=this,void 0===e.fromAny&&b.is(e.type)&&(e.fromAny=e.type.fromAny));const a=r.extend(t,e);return a.construct=function(t,e,a){return e=r.construct(t,e,a),void 0!==i&&e.initAffinity(i),void 0!==n&&e.initInherits(n),void 0!==o?(e.state=e.fromAny(o()),e.value=e.state):void 0!==s&&(e.state=e.fromAny(s),e.value=e.state),e},a},e.TweeningFlag=1<<t.FlagShift+0,e.DivergedFlag=1<<t.FlagShift+1,e.InterruptFlag=1<<t.FlagShift+2,e.FlagShift=t.FlagShift+3,e.FlagMask=(1<<e.FlagShift)-1,e}(ge),Oe=function(t){const e=t.extend("StringAnimator");return e.prototype.fromAny=function(t){return t},e.prototype.equalState=function(t,e){return t===e},e}(Ce),Se=function(t){const e=t.extend("NumberAnimator");return e.prototype.fromAny=function(t){if("string"==typeof t){const e=+t;if(isFinite(e))return e;throw new Error(t)}return t},e.prototype.equalState=function(t,e){return t===e},e}(Ce),Ee=function(t){const e=t.extend("BooleanAnimator");return e.prototype.fromAny=function(t){return!!t},e.prototype.equalState=function(t,e){return t===e},e}(Ce),ke=function(t){const e=t.extend("Provider");return Object.defineProperty(e.prototype,"familyType",{get:function(){return e},configurable:!0}),e.prototype.onInherit=function(t){this.service=t.service},e.prototype.onBindSuperFastener=function(e){this.inherits&&this.affinity===ye.Inherited&&this.initAffinity(ye.Transient),t.prototype.onBindSuperFastener.call(this,e)},e.prototype.onUnbindSuperFastener=function(e){t.prototype.onUnbindSuperFastener.call(this,e),this.inherits&&this.affinity===ye.Transient&&this.initAffinity(ye.Inherited)},e.prototype.getService=function(){const t=this.service;if(null==t){let e=t+" ";throw 0!==this.name.length&&(e+=this.name+" "),e+="service",new TypeError(e)}return t},e.prototype.getServiceOr=function(t){let e=this.service;return null==e&&(e=t),e},e.prototype.createService=function(){return this.service},e.prototype.onMount=function(){t.prototype.onMount.call(this);let e=this.service;null==e&&(e=this.createService(),this.service=e),X.is(e)&&(!this.inherited&&e instanceof G&&e.attachRoot(this.owner),!1!==this.observes&&e.observe(this))},e.prototype.onUnmount=function(){const e=this.service;X.is(e)&&(!1!==this.observes&&e.unobserve(this),!this.inherited&&e instanceof G&&e.detachRoot(this.owner)),t.prototype.onUnmount.call(this)},e.construct=function(e,r,i){return null===r&&(delete(r=function(){return r.service}).name,Object.setPrototypeOf(r,e.prototype)),(r=t.construct(e,r,i)).service=void 0,r.initAffinity(ye.Inherited),r.initInherits(!0),r},e.define=function(t,e){let r=e.extends;const i=e.affinity,n=e.inherits,s=e.service;delete e.extends,delete e.affinity,delete e.inherits,delete e.service,null==r&&(r=this);const o=r.extend(t,e);return o.construct=function(t,e,o){return e=r.construct(t,e,o),void 0!==i&&e.initAffinity(i),void 0!==n&&e.initInherits(n),void 0!==s&&(e.service=s),e},o},e}(we);class Ae{constructor(){this.uid=this.constructor.uid(),this.key=void 0,this.flags=0,this.fasteners=null,this.decoherent=null,this.observers=v.empty}setKey(t){this.key=t}setFlags(t){this.flags=t}attachParent(t){this.willAttachParent(t),t.mounted&&this.cascadeMount(),this.onAttachParent(t),this.didAttachParent(t)}willAttachParent(t){}onAttachParent(t){}didAttachParent(t){}detachParent(t){this.willDetachParent(t),this.mounted&&this.cascadeUnmount(),this.onDetachParent(t),this.didDetachParent(t)}willDetachParent(t){}onDetachParent(t){}didDetachParent(t){}get insertChildFlags(){return this.constructor.InsertChildFlags}willInsertChild(t,e){}onInsertChild(t,e){this.requireUpdate(this.insertChildFlags)}didInsertChild(t,e){}cascadeInsert(){}get removeChildFlags(){return this.constructor.RemoveChildFlags}willRemoveChild(t){}onRemoveChild(t){this.requireUpdate(this.removeChildFlags)}didRemoveChild(t){}remove(){const t=this.parent;null!==t&&(this.traversing?this.setFlags(this.flags|Ae.RemovingFlag):t.removeChild(this))}getSuper(t){const e=this.parent;return null===e?null:e instanceof t?e:e.getSuper(t)}getBase(t){const e=this.parent;if(null===e)return null;{const r=e.getBase(t);return null!==r?r:e instanceof t?e:null}}get mounted(){return 0!=(this.flags&Ae.MountedFlag)}get mountFlags(){return this.constructor.MountFlags}cascadeMount(){if(0!=(this.flags&Ae.MountedFlag))throw new Error("already mounted");this.setFlags(this.flags|Ae.MountedFlag|Ae.TraversingFlag);try{this.willMount(),this.onMount(),this.mountChildren(),this.didMount()}finally{this.setFlags(this.flags&~Ae.TraversingFlag)}}willMount(){}onMount(){this.requireUpdate(this.mountFlags),this.mountFasteners()}didMount(){}mountChildren(){this.forEachChild((function(t){t.cascadeMount(),0!=(t.flags&Ae.RemovingFlag)&&(t.setFlags(t.flags&~Ae.RemovingFlag),this.removeChild(t))}),this)}cascadeUnmount(){if(0==(this.flags&Ae.MountedFlag))throw new Error("already unmounted");this.setFlags(this.flags&~Ae.MountedFlag|Ae.TraversingFlag);try{this.willUnmount(),this.unmountChildren(),this.onUnmount(),this.didUnmount()}finally{this.setFlags(this.flags&~Ae.TraversingFlag)}}willUnmount(){}onUnmount(){this.unmountFasteners(),this.setFlags(this.flags&~Ae.RemovingFlag)}didUnmount(){}unmountChildren(){this.forEachChild((function(t){t.cascadeUnmount(),0!=(t.flags&Ae.RemovingFlag)&&(t.setFlags(t.flags&~Ae.RemovingFlag),this.removeChild(t))}),this)}get traversing(){return 0!=(this.flags&Ae.TraversingFlag)}requireUpdate(t,e){}hasFastener(t,e){const r=this.fasteners;if(null!==r){const i=r[t];if(void 0!==i&&(null==e||i instanceof e))return!0}return!1}getFastener(t,e){const r=this.fasteners;if(null!==r){const i=r[t];if(void 0!==i&&(null==e||i instanceof e))return i}return null}setFastener(t,e){var r;const i=this.fasteners,n=null!==i&&null!==(r=i[t])&&void 0!==r?r:null;n!==e&&(null!==n&&this.detachFastener(t,n),null!==e&&this.attachFastener(t,e))}attachFastener(t,e){let r=this.fasteners;null===r&&(r={},this.fasteners=r),this.willAttachFastener(t,e),r[t]=e,this.mounted&&e.mount(),this.onAttachFastener(t,e),this.didAttachFastener(t,e)}willAttachFastener(t,e){}onAttachFastener(t,e){}didAttachFastener(t,e){}detachFastener(t,e){const r=this.fasteners;this.willDetachFastener(t,e),this.onDetachFastener(t,e),this.mounted&&e.unmount(),delete r[t],this.didDetachFastener(t,e)}willDetachFastener(t,e){}onDetachFastener(t,e){}didDetachFastener(t,e){}getLazyFastener(t,e){return me.getLazyFastener(this,t,e)}getSuperFastener(t,e){const r=this.parent;if(null===r)return null;{const i=r.getLazyFastener(t,e);return null!==i?i:r.getSuperFastener(t,e)}}mountFasteners(){const t=this.fasteners;for(const e in t){t[e].mount()}me.init(this)}unmountFasteners(){const t=this.fasteners;for(const e in t){t[e].unmount()}}decohereFastener(t){let e=this.decoherent;null===e&&(e=[],this.decoherent=e),e.push(t)}recohereFasteners(t){const e=this.decoherent;if(null!==e){const r=e.length;if(0!==r){void 0===t&&(t=performance.now()),this.decoherent=null;for(let i=0;i<r;i+=1){e[i].recohere(t)}}}}observe(t){const e=this.observers,r=v.inserted(t,e);e!==r&&(this.willObserve(t),this.observers=r,this.onObserve(t),this.didObserve(t))}willObserve(t){}onObserve(t){}didObserve(t){}unobserve(t){const e=this.observers,r=v.removed(t,e);e!==r&&(this.willUnobserve(t),this.observers=r,this.onUnobserve(t),this.didUnobserve(t))}willUnobserve(t){}onUnobserve(t){}didUnobserve(t){}forEachObserver(t){let e;const r=this.observers;for(let i=0,n=r.length;i<n;i+=1){const n=r[i];if(e=t.call(this,n),void 0!==e)return e}return e}callObservers(t,...e){const r=this.observers;for(let i=0,n=r.length;i<n;i+=1){const n=r[i],s=n[t];"function"==typeof s&&s.call(n,...e)}}equals(t){return this===t}hashCode(){return this.uid}}Ae.uid=function(){let t=1;return function(){const e=~~t;return t+=1,e}}(),Ae.MountedFlag=1,Ae.RemovingFlag=2,Ae.TraversingFlag=4,Ae.FlagShift=3,Ae.FlagMask=(1<<Ae.FlagShift)-1,Ae.MountFlags=0,Ae.InsertChildFlags=0,Ae.RemoveChildFlags=0;class Me extends _{constructor(t){super(),this.cursor=t}isEmpty(){return this.cursor.isEmpty()}head(){return this.cursor.head()[0]}step(){this.cursor.step()}skip(t){this.cursor.skip(t)}hasNext(){return this.cursor.hasNext()}nextIndex(){return this.cursor.nextIndex()}next(){const{value:t,done:e}=this.cursor.next();return{value:t&&t[0],done:e}}hasPrevious(){return this.cursor.hasPrevious()}previousIndex(){return this.cursor.previousIndex()}previous(){const{value:t,done:e}=this.cursor.previous();return{value:t&&t[0],done:e}}delete(){this.cursor.delete()}}class De extends _{constructor(t){super(),this.cursor=t}isEmpty(){return this.cursor.isEmpty()}head(){return this.cursor.head()[1]}step(){this.cursor.step()}skip(t){this.cursor.skip(t)}hasNext(){return this.cursor.hasNext()}nextIndex(){return this.cursor.nextIndex()}next(){const{value:t,done:e}=this.cursor.next();return{value:t&&t[1],done:e}}hasPrevious(){return this.cursor.hasPrevious()}previousIndex(){return this.cursor.previousIndex()}previous(){const{value:t,done:e}=this.cursor.previous();return{value:t&&t[1],done:e}}delete(){this.cursor.delete()}}class Ie extends _{constructor(t,e,r,i){super(),this.pages=t,this.index=e,this.childIndex=r,this.childCursor=i}isEmpty(){for(;;)if(null!==this.childCursor){if(!this.childCursor.isEmpty())return!1;this.childCursor=null}else{if(!(this.childIndex<this.pages.length))return this.childIndex=this.pages.length,!0;this.childCursor=this.pageCursor(this.pages[this.childIndex]),this.childIndex+=1}}head(){for(;;)if(null!==this.childCursor){if(!this.childCursor.isEmpty())return this.childCursor.head();this.childCursor=null}else{if(!(this.childIndex<this.pages.length))throw this.childIndex=this.pages.length,new Error("empty");this.childCursor=this.pageCursor(this.pages[this.childIndex]),this.childIndex+=1}}step(){for(;;)if(null!==this.childCursor){if(!this.childCursor.isEmpty())return void(this.index+=1);this.childCursor=null}else{if(!(this.childIndex<this.pages.length))throw this.childIndex=this.pages.length,new Error("empty");this.childCursor=this.pageCursor(this.pages[this.childIndex]),this.childIndex+=1}}skip(t){for(;t>0;)if(null!==this.childCursor)this.childCursor.hasNext()?(this.index+=1,t-=1,this.childCursor.next()):this.childCursor=null;else{if(!(this.childIndex<this.pages.length))break;{const e=this.pages[this.childIndex],r=this.pageSize(e);if(this.childIndex+=1,r<t){this.childCursor=this.pageCursor(e),t>0&&(this.index+=t,this.childCursor.skip(t),t=0);break}this.index+=r,t-=r}}}hasNext(){for(;;)if(null!==this.childCursor){if(this.childCursor.hasNext())return!0;this.childCursor=null}else{if(!(this.childIndex<this.pages.length))return this.childIndex=this.pages.length,!1;this.childCursor=this.pageCursor(this.pages[this.childIndex]),this.childIndex+=1}}nextIndex(){return this.index}next(){for(;;)if(null!==this.childCursor){if(this.childCursor.hasNext())return this.index+=1,this.childCursor.next();this.childCursor=null}else{if(!(this.childIndex<this.pages.length))return this.childIndex=this.pages.length,{done:!0};this.childCursor=this.pageCursor(this.pages[this.childIndex]),this.childIndex+=1}}hasPrevious(){for(;;)if(null!==this.childCursor){if(this.childCursor.hasPrevious())return!0;this.childCursor=null}else{if(!(this.childIndex>0))return this.childIndex=0,!1;this.childCursor=this.reversePageCursor(this.pages[this.childIndex-1]),this.childIndex-=1}}previousIndex(){return this.index-1}previous(){for(;;)if(null!==this.childCursor){if(this.childCursor.hasPrevious())return this.index-=1,this.childCursor.previous();this.childCursor=null}else{if(!(this.childIndex>0))return this.childIndex=0,{done:!0};this.childCursor=this.reversePageCursor(this.pages[this.childIndex-1]),this.childIndex-=1}}set(t){this.childCursor.set(t)}delete(){this.childCursor.delete()}}class Pe{constructor(){this.pageSplitSize=32}compare(t,e){return g.compare(t,e)}pageShouldSplit(t){return t.arity>this.pageSplitSize}pageShouldMerge(t){return t.arity<this.pageSplitSize>>>1}}class Te extends Pe{constructor(t){super(),void 0===t&&(t=Ve.empty()),this.root=t}get size(){return this.root.size}isEmpty(){return this.root.isEmpty()}has(t){return this.root.has(t,this)}get(t){return this.root.get(t,this)}getEntry(t){return this.root.getEntry(t)}firstKey(){const t=this.root.firstEntry();return void 0!==t?t[0]:void 0}firstValue(){const t=this.root.firstEntry();return void 0!==t?t[1]:void 0}firstEntry(){return this.root.firstEntry()}lastKey(){const t=this.root.lastEntry();return void 0!==t?t[0]:void 0}lastValue(){const t=this.root.lastEntry();return void 0!==t?t[1]:void 0}lastEntry(){return this.root.lastEntry()}nextKey(t){const e=this.root.nextEntry(t,this);return void 0!==e?e[0]:void 0}nextValue(t){const e=this.root.nextEntry(t,this);return void 0!==e?e[1]:void 0}nextEntry(t){return this.root.nextEntry(t,this)}previousKey(t){const e=this.root.previousEntry(t,this);return void 0!==e?e[0]:void 0}previousValue(t){const e=this.root.previousEntry(t,this);return void 0!==e?e[1]:void 0}previousEntry(t){return this.root.previousEntry(t,this)}set(t,e){const r=this.root;let i=this.root.updated(t,e,this);return r!==i&&(i.size>r.size&&(i=i.balanced(this)),this.root=i),this}delete(t){const e=this.root,r=this.root.removed(t,this);return e!==r&&(this.root=r,!0)}drop(t){return t>0&&this.root.size>0&&(t<this.root.size?this.root=this.root.drop(t,this):this.root=Ve.empty()),this}take(t){return t<this.root.size&&this.root.size>0&&(this.root=t>0?this.root.take(t,this):Ve.empty()),this}clear(){this.root=Ve.empty()}updated(t,e){const r=this.root;let i=r.updated(t,e,this);return r!==i?(i.size>r.size&&(i=i.balanced(this)),this.copy(i)):this}removed(t){const e=this.root,r=e.removed(t,this);return e!==r?this.copy(r):this}cleared(){return this.root.isEmpty()?this:this.copy(Ve.empty())}reduced(t,e,r){const i=this.root,n=i.reduced(t,e,r);return i!==n&&(this.root=n),n.fold}forEach(t,e){return this.root.forEach(t,e)}forEachKey(t,e){return this.root.forEachKey(t,e)}forEachValue(t,e){return this.root.forEachValue(t,e)}keys(){return this.root.keys()}values(){return this.root.values()}entries(){return this.root.entries()}reverseKeys(){return this.root.reverseKeys()}reverseValues(){return this.root.reverseValues()}reverseEntries(){return this.root.reverseEntries()}clone(){return this.copy(this.root)}copy(t){const e=new Te(t);return e.compare!==this.compare&&(e.compare=this.compare),e.pageSplitSize!==this.pageSplitSize&&(e.pageSplitSize=this.pageSplitSize),e}}class Ve{keys(){return new Me(this.entries())}values(){return new De(this.entries())}reverseKeys(){return new Me(this.reverseEntries())}reverseValues(){return new De(this.reverseEntries())}static empty(){return new Fe([],void 0)}}e([s],Ve,"empty",null);class Fe extends Ve{constructor(t,e){super(),this.slots=t,this.fold=e}get arity(){return this.slots.length}get size(){return this.slots.length}isEmpty(){return 0===this.slots.length}minKey(){return this.slots[0][0]}maxKey(){return this.slots[this.slots.length-1][0]}has(t,e){return this.lookup(t,e)>=0}get(t,e){const r=this.lookup(t,e);return r>=0?this.slots[r][1]:void 0}getEntry(t){return this.slots[t]}firstEntry(){const t=this.slots;return 0!==t.length?t[0]:void 0}lastEntry(){const t=this.slots;return 0!==t.length?t[t.length-1]:void 0}nextEntry(t,e){let r=this.lookup(t,e);return r>=0?r+=1:r=-(r+1),this.slots[r]}previousEntry(t,e){let r=this.lookup(t,e);return r>=0?r-=1:r=-(r+2),this.slots[r]}updated(t,e,r){let i=this.lookup(t,r);return i>=0?this.updatedSlot(i,t,e):(i=-(i+1),this.insertedSlot(i,t,e))}updatedSlot(t,e,r){const i=this.slots;if(r!==i[t][1]){const n=i.slice(0);return n[t]=[e,r],new Fe(n,void 0)}return this}insertedSlot(t,e,r){const i=this.slots,n=i.length+1,s=new Array(n);for(let e=0;e<t;e+=1)s[e]=i[e];s[t]=[e,r];for(let e=t;e<n-1;e+=1)s[e+1]=i[e];return new Fe(s,void 0)}removed(t,e){const r=this.lookup(t,e);return r>=0?this.slots.length>1?this.removedSlot(r):Ve.empty():this}removedSlot(t){const e=this.slots,r=new Array(e.length-1);for(let i=0;i<t;i+=1)r[i]=e[i];for(let i=t;i<r.length;i+=1)r[i]=e[i+1];return new Fe(r,void 0)}drop(t,e){if(t>0){const e=this.slots;if(t<e.length){const r=e.length-t,i=new Array(r);for(let n=0;n<r;n+=1)i[n]=e[n+t];return new Fe(i,void 0)}return Ve.empty()}return this}take(t,e){const r=this.slots;if(t<r.length){if(t>0){const e=new Array(t);for(let i=0;i<t;i+=1)e[i]=r[i];return new Fe(e,void 0)}return Ve.empty()}return this}balanced(t){const e=this.slots.length;if(e>1&&t.pageShouldSplit(this)){const t=e>>>1;return this.split(t)}return this}split(t){const e=new Array(2),r=this.splitLeft(t),i=this.splitRight(t);e[0]=r,e[1]=i;const n=new Array(1);return n[0]=i.minKey(),new qe(e,n,void 0,this.slots.length)}splitLeft(t){const e=this.slots,r=new Array(t);for(let i=0;i<t;i+=1)r[i]=e[i];return new Fe(r,void 0)}splitRight(t){const e=this.slots,r=e.length-t,i=new Array(r);for(let n=0;n<r;n+=1)i[n]=e[n+t];return new Fe(i,void 0)}reduced(t,e,r){if(void 0===this.fold){const r=this.slots;let i=t;for(let t=0,n=r.length;t<n;t+=1)i=e(i,r[t][1]);return new Fe(r,i)}return this}forEach(t,e){const r=this.slots;for(let i=0,n=r.length;i<n;i+=1){const n=r[i],s=t.call(e,n[0],n[1]);if(void 0!==s)return s}}forEachKey(t,e){const r=this.slots;for(let i=0,n=r.length;i<n;i+=1){const n=r[i],s=t.call(e,n[0]);if(void 0!==s)return s}}forEachValue(t,e){const r=this.slots;for(let i=0,n=r.length;i<n;i+=1){const n=r[i],s=t.call(e,n[1]);if(void 0!==s)return s}}entries(){return _.array(this.slots)}reverseEntries(){return _.array(this.slots,this.slots.length)}lookup(t,e){let r=0,i=this.slots.length-1;for(;r<=i;){const n=r+i>>>1,s=e.compare(t,this.slots[n][0]);if(s>0)r=n+1;else{if(!(s<0))return n;i=n-1}}return-(r+1)}}class qe extends Ve{constructor(t,e,r,i){super(),this.pages=t,this.knots=e,this.fold=r,this.size=i}get arity(){return this.pages.length}isEmpty(){return 0===this.size}minKey(){return this.pages[0].minKey()}maxKey(){return this.pages[this.pages.length-1].maxKey()}has(t,e){let r=this.lookup(t,e);if(r>0)r+=1;else{if(!(r<0))return!0;r=-(r+1)}return this.pages[r].has(t,e)}get(t,e){let r=this.lookup(t,e);return r>=0?r+=1:r=-(r+1),this.pages[r].get(t,e)}getEntry(t){const e=this.pages;for(let r=0,i=e.length;r<i;r+=1){const i=e[r];if(t<i.size)return i.getEntry(t);t-=i.size}}firstEntry(){const t=this.pages;return 0!==t.length?t[0].firstEntry():void 0}lastEntry(){const t=this.pages;return 0!==t.length?t[t.length-1].lastEntry():void 0}nextEntry(t,e){let r=this.lookup(t,e);r>=0?r+=1:r=-(r+1);const i=this.pages;let n=i[r].nextEntry(t,e);return void 0===n&&r+1<i.length&&(n=i[r+1].nextEntry(t,e)),n}previousEntry(t,e){let r=this.lookup(t,e);r>=0?r+=1:r=-(r+1);const i=this.pages;let n=i[r].previousEntry(t,e);return void 0===n&&r>0&&(n=i[r-1].previousEntry(t,e)),n}updated(t,e,r){let i=this.lookup(t,r);i>=0?i+=1:i=-(i+1);const n=this.pages[i],s=n.updated(t,e,r);return n!==s?n.size!==s.size&&r.pageShouldSplit(s)?this.updatedPageSplit(i,s,n):this.updatedPage(i,s,n):this}updatedPage(t,e,r){const i=this.pages.slice(0);i[t]=e;const n=this.knots;let s;n.length>0?(s=n.slice(0),t>0&&(s[t-1]=e.minKey())):s=[];const o=this.size-r.size+e.size;return new qe(i,s,void 0,o)}updatedPageSplit(t,e,r){const i=this.pages,n=new Array(i.length+1);for(let e=0;e<t;e+=1)n[e]=i[e];const s=e.splitLeft(e.arity>>>1),o=e.splitRight(e.arity>>>1);n[t]=s,n[t+1]=o;for(let e=t+1;e<i.length;e+=1)n[e+1]=i[e];const a=this.knots,u=new Array(i.length);if(t>0){for(let e=0;e<t-1;e+=1)u[e]=a[e];u[t-1]=s.minKey(),u[t]=o.minKey();for(let e=t;e<a.length;e+=1)u[e+1]=a[e]}else{u[0]=o.minKey();for(let t=0;t<a.length;t+=1)u[t+1]=a[t]}const h=this.size-r.size+e.size;return new qe(n,u,void 0,h)}updatedPageMerge(t,e,r){const i=this.pages,n=e.pages,s=new Array(i.length+n.length-1);for(let e=0;e<t;e+=1)s[e]=i[e];for(let e=0;e<n.length;e+=1)s[e+t]=n[e];for(let e=t+1;e<i.length;e+=1)s[e+n.length-1]=i[e];const o=this.knots,a=e.knots,u=new Array(s.length-1);if(t>0){for(let e=0;e<t-1;e+=1)u[e]=o[e];u[t-1]=n[0].minKey();for(let e=0;e<a.length;e+=1)u[e+t]=a[e];for(let e=t;e<o.length;e+=1)u[e+a.length]=o[e]}else{for(let t=0;t<a.length;t+=1)u[t]=a[t];u[a.length]=i[1].minKey();for(let t=1;t<o.length;t+=1)u[t+a.length]=o[t]}const h=this.size-r.size+e.size;return new qe(s,u,void 0,h)}removed(t,e){let r=this.lookup(t,e);r>=0?r+=1:r=-(r+1);const i=this.pages[r],n=i.removed(t,e);return i!==n?this.replacedPage(r,n,i,e):this}replacedPage(t,e,r,i){return e.isEmpty()?this.pages.length>2?this.removedPage(t,e,r):this.pages.length>1?0===t?this.pages[1]:this.pages[0]:Ve.empty():e instanceof qe&&i.pageShouldMerge(e)?this.updatedPageMerge(t,e,r):this.updatedPage(t,e,r)}removedPage(t,e,r){const i=this.pages,n=new Array(i.length-1);for(let e=0;e<t;e+=1)n[e]=i[e];for(let e=t+1;e<i.length;e+=1)n[e-1]=i[e];const s=this.knots,o=new Array(s.length-1);if(t>0){for(let e=0;e<t-1;e+=1)o[e]=s[e];for(let e=t;e<s.length;e+=1)o[e-1]=s[e]}else for(let t=1;t<s.length;t+=1)o[t-1]=s[t];const a=this.size-r.size;return new qe(n,o,void 0,a)}drop(t,e){if(t>0){let r=this.size;if(t<r){const i=this.pages;let n=0;for(;n<i.length;){const e=i[n].size;if(!(e<=t))break;r-=e,t-=e,n+=1}const s=i.length-n;if(s>1){let o;if(n>0){const t=new Array(s);for(let e=0;e<s;e+=1)t[e]=i[e+n];const e=new Array(s-1);for(let t=0;t<e.length;t+=1)e[t]=this.knots[t+n];o=new qe(t,e,void 0,r)}else o=this;if(t>0){const r=i[n],s=r.drop(t,e);return o.replacedPage(0,s,r,e)}return o}return i[n].drop(t,e)}return Ve.empty()}return this}take(t,e){if(t<this.size){if(t>0){const r=this.pages;let i=0,n=0;for(;i<r.length&&t>0;){const e=r[i].size;if(n+=e,i+=1,!(e<=t))break;t-=e}const s=0===t?i:i+1;if(s>1){let o;if(i<r.length){const t=new Array(s);for(let e=0;e<s;e+=1)t[e]=r[e];const e=new Array(s-1);for(let t=0;t<e.length;t+=1)e[t]=this.knots[t];o=new qe(t,e,void 0,n)}else o=this;if(t>0){const n=r[i-1],s=n.take(t,e);return o.replacedPage(i-1,s,n,e)}return o}return t>0?r[0].take(t,e):r[0]}return Ve.empty()}return this}balanced(t){if(this.pages.length>1&&t.pageShouldSplit(this)){const t=this.knots.length>>>1;return this.split(t)}return this}split(t){const e=new Array(2),r=this.splitLeft(t),i=this.splitRight(t);e[0]=r,e[1]=i;const n=new Array(1);return n[0]=i.minKey(),new qe(e,n,void 0,this.size)}splitLeft(t){const e=this.pages,r=new Array(t+1);for(let i=0;i<t+1;i+=1)r[i]=e[i];const i=this.knots,n=new Array(t);for(let e=0;e<t;e+=1)n[e]=i[e];let s=0;for(let e=0;e<=t;e+=1)s+=r[e].size;return new qe(r,n,void 0,s)}splitRight(t){const e=this.pages,r=e.length-(t+1),i=new Array(r);for(let n=0;n<r;n+=1)i[n]=e[n+(t+1)];const n=this.knots,s=new Array(r-1);for(let e=0;e<s.length;e+=1)s[e]=n[e+(t+1)];let o=0;for(let t=0;t<r;t+=1)o+=i[t].size;return new qe(i,s,void 0,o)}reduced(t,e,r){if(void 0===this.fold){const i=this.pages,n=i.length,s=new Array(n);for(let o=0;o<n;o+=1)s[o]=i[o].reduced(t,e,r);let o=s[0].fold;for(let t=1;t<n;t+=1)o=r(o,s[t].fold);return new qe(s,this.knots,o,this.size)}return this}forEach(t,e){const r=this.pages;for(let i=0,n=r.length;i<n;i+=1){const n=r[i].forEach(t,e);if(void 0!==n)return n}}forEachKey(t,e){const r=this.pages;for(let i=0,n=r.length;i<n;i+=1){const n=r[i].forEachKey(t,e);if(void 0!==n)return n}}forEachValue(t,e){const r=this.pages;for(let i=0,n=r.length;i<n;i+=1){const n=r[i].forEachValue(t,e);if(void 0!==n)return n}}entries(){return new Ue(this.pages)}reverseEntries(){return new Ue(this.pages,this.size,this.pages.length)}lookup(t,e){let r=0,i=this.knots.length-1;for(;r<=i;){const n=r+i>>>1,s=e.compare(t,this.knots[n]);if(s>0)r=n+1;else{if(!(s<0))return n;i=n-1}}return-(r+1)}}class Ue extends Ie{constructor(t,e=0,r=0,i=null){super(t,e,r,i)}pageSize(t){return t.size}pageCursor(t){return t.entries()}reversePageCursor(t){return t.reverseEntries()}}class Re{constructor(){this.pageSplitSize=32}identify(t){const e=new Uint8Array(6);return r.fillBytes(e),e}compare(t,e){return g.compare(t,e)}pageShouldSplit(t){return t.arity>this.pageSplitSize}pageShouldMerge(t){return t.arity<this.pageSplitSize>>>1}}class Ne extends Re{constructor(t){super(),void 0===t&&(t=ze.empty()),this.root=t}get length(){return this.root.size}isEmpty(){return this.root.isEmpty()}get(t,e){if(!(void 0!==e&&(t=this.lookup(e,t))<0))return this.root.get(t)}getEntry(t,e){if(!(void 0!==e&&(t=this.lookup(e,t))<0))return this.root.getEntry(t)}set(t,e,r){if(void 0!==r&&(t=this.lookup(r,t))<0)throw new RangeError(""+r);const i=this.root;if(t<0||t>=i.size)throw new RangeError(""+t);return this.root=i.updated(t,e,this),this}insert(t,e,r){const i=this.root;if(t<0||t>i.size)throw new RangeError(""+t);return this.root=i.inserted(t,e,r,this).balanced(this),this}remove(t,e){if(void 0!==e&&(t=this.lookup(e,t))<0)throw new RangeError(""+e);const r=this.root;if(t<0||t>r.size)throw new RangeError(""+t);return this.root=r.removed(t,this),this}push(...t){let e=this.root;for(let r=0;r<t.length;r+=1)e=e.inserted(e.size,t[r],void 0,this).balanced(this);return this.root=e,e.size}pop(){const t=this.root,e=t.size-1;if(e>=0){const r=t.get(e);return this.root=t.removed(e,this),r}}unshift(...t){let e=this.root;for(let r=t.length-1;r>=0;r-=1)e=e.inserted(0,t[r],void 0,this).balanced(this);return this.root=e,e.size}shift(){const t=this.root;if(t.size>0){const e=t.get(0);return this.root=t.removed(0,this),e}}move(t,e,r){if(void 0!==r&&(t=this.lookup(r,t))<0)throw new RangeError(""+r);const i=this.root;if(t<0||t>=i.size)throw new RangeError(""+t);if(e<0||e>=i.size)throw new RangeError(""+e);if(t!==e){const r=i.getEntry(t);this.root=i.removed(t,this).inserted(e,r[1],r[0],this).balanced(this)}return this}splice(t,e,...r){let i=this.root;t<0&&(t=i.size+t),t=Math.min(Math.max(0,t),i.size),void 0===e&&(e=i.size-t);const n=[];for(let r=t,s=t+e;r<s;r+=1)n.push(i.get(t)),i=i.removed(t,this);for(let e=0;e<r.length;e+=1)i=i.inserted(t+e,r[e],void 0,this).balanced(this);return this.root=i,n}drop(t){const e=this.root;return t>0&&e.size>0&&(t<e.size?this.root=e.drop(t,this):this.root=ze.empty()),this}take(t){const e=this.root;return t<e.size&&e.size>0&&(this.root=t>0?e.take(t,this):ze.empty()),this}clear(){this.root=ze.empty()}forEach(t,e){return this.root.forEach(t,e,0)}keys(){return this.root.keys()}values(){return this.root.values()}entries(){return this.root.entries()}reverseKeys(){return this.root.reverseKeys()}reverseValues(){return this.root.reverseValues()}reverseEntries(){return this.root.reverseEntries()}clone(){return this.copy(this.root)}copy(t){const e=new Ne(t);return e.identify!==this.identify&&(e.identify=this.identify),e.compare!==this.compare&&(e.compare=this.compare),e.pageSplitSize!==this.pageSplitSize&&(e.pageSplitSize=this.pageSplitSize),e}lookup(t,e=0){const r=this.root;let i=e=Math.min(Math.max(0,e),r.size-1);do{const e=r.getEntry(i);if(void 0!==e&&0===this.compare(e[0],t))return i;i=(i+1)%r.size}while(isFinite(i)&&i!==e);return-1}}class ze{keys(){return new Me(this.entries())}values(){return new De(this.entries())}reverseKeys(){return new Me(this.reverseEntries())}reverseValues(){return new De(this.reverseEntries())}static empty(){return new je([])}}e([s],ze,"empty",null);class je extends ze{constructor(t){super(),this.slots=t}get arity(){return this.slots.length}get size(){return this.slots.length}isEmpty(){return 0===this.slots.length}get(t){const e=this.slots[t];return void 0!==e?e[1]:void 0}getEntry(t){return this.slots[t]}updated(t,e,r){if(t<0||t>=this.slots.length)throw new RangeError(""+t);return this.updatedItem(t,e)}updatedItem(t,e){const r=this.slots,i=r[t];if(void 0!==i&&e!==i[1]){const n=r.slice(0);return n[t]=[i[0],e],new je(n)}return this}inserted(t,e,r,i){if(t<0||t>this.slots.length)throw new RangeError(""+t);return this.insertedItem(t,e,r,i)}insertedItem(t,e,r,i){void 0===r&&(r=i.identify(e));const n=this.slots,s=new Array(n.length+1);for(let e=0;e<t;e+=1)s[e]=n[e];s[t]=[r,e];for(let e=t;e<n.length;e+=1)s[e+1]=n[e];return new je(s)}removed(t,e){if(t<0||t>=this.slots.length)throw new RangeError(""+t);return this.slots.length>1?this.removedSlot(t):ze.empty()}removedSlot(t){const e=this.slots,r=new Array(e.length-1);for(let i=0;i<t;i+=1)r[i]=e[i];for(let i=t;i<r.length;i+=1)r[i]=e[i+1];return new je(r)}drop(t,e){const r=this.slots;if(t>0&&r.length>0){if(t<r.length){const e=r.length-t,i=new Array(e);for(let n=0;n<e;n+=1)i[n]=r[n+t];return new je(i)}return ze.empty()}return this}take(t,e){const r=this.slots;if(t<r.length&&r.length>0){if(t>0){const e=new Array(t);for(let i=0;i<t;i+=1)e[i]=r[i];return new je(e)}return ze.empty()}return this}balanced(t){const e=this.slots.length;return e>1&&t.pageShouldSplit(this)?this.split(e>>>1):this}split(t){const e=new Array(2),r=this.splitLeft(t),i=this.splitRight(t);e[0]=r,e[1]=i;const n=new Array(1);return n[0]=t,new Le(e,n,this.slots.length)}splitLeft(t){const e=this.slots,r=new Array(t);for(let i=0;i<t;i+=1)r[i]=e[i];return new je(r)}splitRight(t){const e=this.slots,r=e.length-t,i=new Array(r);for(let n=0;n<r;n+=1)i[n]=e[n+t];return new je(i)}forEach(t,e,r){for(let i=0;i<this.slots.length;i+=1){const n=this.slots[i],s=t.call(e,n[1],r+i,n[0]);if(void 0!==s)return s}}entries(){return _.array(this.slots)}reverseEntries(){return _.array(this.slots,this.slots.length)}}class Le extends ze{constructor(t,e,r){super(),this.pages=t,this.knots=e,this.size=r}get arity(){return this.pages.length}isEmpty(){return 0===this.size}get(t){let e=this.lookup(t);e>=0?e+=1:e=-(e+1);const r=0===e?t:t-this.knots[e-1];return this.pages[e].get(r)}getEntry(t){let e=this.lookup(t);e>=0?e+=1:e=-(e+1);const r=0===e?t:t-this.knots[e-1];return this.pages[e].getEntry(r)}updated(t,e,r){let i=this.lookup(t);i>=0?i+=1:i=-(i+1);const n=0===i?t:t-this.knots[i-1],s=this.pages[i],o=s.updated(n,e,r);return s!==o?s.size!==o.size&&r.pageShouldSplit(o)?this.updatedPageSplit(i,o,s):this.updatedPage(i,o,s):this}updatedPage(t,e,r){const i=this.pages,n=i.slice(0);n[t]=e;const s=this.knots;let o,a;if(i.length-1>0){o=s.slice(0),a=t>0?s[t-1]:0;for(let e=t;e<o.length;e+=1)a+=n[e].size,o[e]=a;a+=n[o.length].size}else o=[],a=0;return new Le(n,o,a)}updatedPageSplit(t,e,r){const i=this.pages,n=new Array(i.length+1);for(let e=0;e<t;e+=1)n[e]=i[e];const s=e.splitLeft(e.arity>>>1),o=e.splitRight(e.arity>>>1);n[t]=s,n[t+1]=o;for(let e=t+1;e<i.length;e+=1)n[e+1]=i[e];return Le.create(n)}updatedPageMerge(t,e,r){const i=this.pages,n=e.pages,s=new Array(i.length+n.length-1);for(let e=0;e<t;e+=1)s[e]=i[e];for(let e=0;e<n.length;e+=1)s[e+t]=n[e];for(let e=t+1;e<i.length;e+=1)s[e+n.length-1]=i[e];return Le.create(s)}inserted(t,e,r,i){let n=this.lookup(t);n>=0?n+=1:n=-(n+1);const s=0===n?t:t-this.knots[n-1],o=this.pages[n],a=o.inserted(s,e,r,i);return o!==a?i.pageShouldSplit(a)?this.updatedPageSplit(n,a,o):this.updatedPage(n,a,o):this}removed(t,e){let r=this.lookup(t);r>=0?r+=1:r=-(r+1);const i=0===r?t:t-this.knots[r-1],n=this.pages[r],s=n.removed(i,e);return n!==s?this.replacedPage(r,s,n,e):this}replacedPage(t,e,r,i){return e.isEmpty()?this.pages.length>2?this.removedPage(t,e,r):this.pages.length>1?0===t?this.pages[1]:this.pages[0]:ze.empty():e instanceof Le&&i.pageShouldMerge(e)?this.updatedPageMerge(t,e,r):this.updatedPage(t,e,r)}removedPage(t,e,r){const i=this.pages,n=new Array(i.length-1);for(let e=0;e<t;e+=1)n[e]=i[e];for(let e=t+1;e<i.length;e+=1)n[e-1]=i[e];const s=this.knots,o=new Array(s.length-1);let a;if(t>0){for(let e=0;e<t;e+=1)o[e]=s[e];a=s[t-1]}else a=0;for(let e=t;e<o.length;e+=1)a+=n[e].size,o[e]=a;return a+=n[o.length].size,new Le(n,o,a)}drop(t,e){if(t>0){if(t<this.size){let r=this.lookup(t);r>=0?r+=1:r=-(r+1),t=0===r?t:t-this.knots[r-1];const i=this.pages,n=i.length-r;if(n>1){let s;if(r>0){const t=new Array(n);for(let e=0;e<n;e+=1)t[e]=i[e+r];s=Le.create(t)}else s=this;if(t>0){const n=i[r],o=n.drop(t,e);return s.replacedPage(0,o,n,e)}return s}return i[r].drop(t,e)}return ze.empty()}return this}take(t,e){if(t<this.size){if(t>0){let r=this.lookup(t);r>=0?r+=1:r=-(r+1),t=0===r?t:t-this.knots[r-1];const i=this.pages,n=0===t?r:r+1;if(n>1){let s;if(r<i.length){const t=new Array(n);for(let e=0;e<n;e+=1)t[e]=i[e];const e=new Array(n-1);for(let t=0;t<e.length;t+=1)e[t]=this.knots[t];const r=e[n-2]+t[n-1].size;s=new Le(t,e,r)}else s=this;if(t>0){const n=i[r],o=n.take(t,e);return s.replacedPage(r,o,n,e)}return s}return t>0?i[0].take(t,e):i[0]}return ze.empty()}return this}balanced(t){if(this.pages.length>1&&t.pageShouldSplit(this)){const t=this.knots.length>>>1;return this.split(t)}return this}split(t){const e=new Array(2),r=this.splitLeft(t),i=this.splitRight(t);e[0]=r,e[1]=i;const n=new Array(1);return n[0]=r.size,new Le(e,n,this.size)}splitLeft(t){const e=this.pages,r=new Array(t+1);for(let i=0;i<t+1;i+=1)r[i]=e[i];const i=this.knots,n=new Array(t);for(let e=0;e<t;e+=1)n[e]=i[e];let s=0;for(let e=0;e<=t;e+=1)s+=r[e].size;return new Le(r,n,s)}splitRight(t){const e=this.pages,r=e.length-(t+1),i=new Array(r);for(let n=0;n<r;n+=1)i[n]=e[n+(t+1)];const n=new Array(r-1);let s;if(r>0){s=i[0].size;for(let t=1;t<r;t+=1)n[t-1]=s,s+=i[t].size}else s=0;return new Le(i,n,s)}forEach(t,e,r){for(let i=0;i<this.pages.length;i+=1){const n=this.pages[i],s=n.forEach(t,e,r);if(void 0!==s)return s;r+=n.size}}entries(){return new Ke(this.pages)}reverseEntries(){return new Ke(this.pages,this.size,this.pages.length)}lookup(t){let e=0,r=this.knots.length-1;for(;e<=r;){const i=e+r>>>1;if(t>this.knots[i])e=i+1;else{if(!(t<this.knots[i]))return i;r=i-1}}return-(e+1)}static create(t){const e=new Array(t.length-1);let r=0;for(let i=0,n=e.length;i<n;i+=1)r+=t[i].size,e[i]=r;return r+=t[e.length].size,new Le(t,e,r)}}class Ke extends Ie{constructor(t,e=0,r=0,i=null){super(t,e,r,i)}pageSize(t){return t.size}pageCursor(t){return t.entries()}reversePageCursor(t){return t.reverseEntries()}}const Be=function(){const t={};let e=1;return t.next=function(){const t=~~e;return e+=1,t},t}();class We{constructor(t,e){this.index=void 0!==t?t:{},this.array=void 0!==e?e:[]}get size(){return this.array.length}isEmpty(){return 0===this.array.length}has(t){return void 0!==this.index[t.id]}get(t){const e=this.index[t.id];return void 0!==e?this.array[e][1]:void 0}getField(t){const e=this.index[t.id];return void 0!==e?this.array[e]:void 0}getEntry(t){return this.array[t]}set(t,e){const r=this.index[t.id];if(void 0!==r){const t=this.array[r],i=t[1];return t[1]=e,i}return this.index[t.id]=this.array.length,void this.array.push([t,e])}delete(t){const e=this.index[t.id];if(void 0!==e){delete this.index[t.id];const r=this.array[e],i=this.array.pop();return r!==i&&(this.array[e]=i,this.index[i[0].id]=e),!0}return!1}remove(t){const e=this.index[t.id];if(void 0!==e){delete this.index[t.id];const r=this.array[e],i=this.array.pop();return r!==i&&(this.array[e]=i,this.index[i[0].id]=e),r[1]}}clear(){this.index={},this.array.length=0}forEach(t,e){const r=this.array;for(let i=0,n=r.length;i<n;i+=1){const n=r[i],s=t.call(e,n[0],n[1]);if(void 0!==s)return s}}clone(){const t=this.array,e=t.length,r={},i=new Array(e);for(let n=0;n<e;n+=1){const[e,s]=t[n];i[n]=[e,s],r[e.id]=n}return new We(r,i)}}const He={};class Xe{constructor(){this.id=Be.next()}isExternal(){return!1}isDummy(){return!1}isInvalid(){return!1}addConstraintCondition(t,e){}removeConstraintCondition(t,e){}updateConstraintSolution(t){}}class Ye{constructor(){this.id=Be.next()}isExternal(){return!1}isDummy(){return!0}isInvalid(){return!1}addConstraintCondition(t,e){}removeConstraintCondition(t,e){}updateConstraintSolution(t){}}class Ge{constructor(){this.id=Be.next()}isExternal(){return!1}isDummy(){return!1}isInvalid(){return!1}addConstraintCondition(t,e){}removeConstraintCondition(t,e){}updateConstraintSolution(t){}}class _e{get id(){return-1}isExternal(){return!1}isDummy(){return!1}isInvalid(){return!0}addConstraintCondition(t,e){}removeConstraintCondition(t,e){}updateConstraintSolution(t){}}He.invalid=new _e;const Qe=function(){const t={fromAny:function(e){return"number"==typeof e?t.constant(e):e},sum:function(...t){const e=new We;let r=0;for(let i=0,n=t.length;i<n;i+=1){const n=t[i];if("number"==typeof n)r+=n;else if(Je.is(n)){const t=n.variable;if(null!==t){const r=e.getField(t);void 0!==r?r[1]+=n.coefficient:e.set(t,n.coefficient)}else r+=n.constant}else{const t=n.terms;for(let r=0,i=t.size;r<i;r+=1){const[i,n]=t.getEntry(r),s=e.getField(i);void 0!==s?s[1]+=n:e.set(i,n)}r+=n.constant}}return new Ze(e,r)},product:function(t,e){return new $e(t,e)},constant:function(e){return 0===e?t.zero:new tr(e)}};return t}();class Ze{constructor(t,e){this.terms=t,this.constant=e}isConstant(){return this.terms.isEmpty()}plus(t){return Qe.sum(this,t)}negative(){const t=this.terms,e=new We;for(let r=0,i=t.size;r<i;r+=1){const[i,n]=t.getEntry(r);e.set(i,-n)}return new Ze(e,-this.constant)}minus(t){return t="number"==typeof t?Qe.constant(t):t.negative(),Qe.sum(this,t)}times(t){const e=this.terms,r=new We;for(let i=0,n=e.size;i<n;i+=1){const[n,s]=e.getEntry(i);r.set(n,s*t)}return new Ze(r,this.constant*t)}divide(t){const e=this.terms,r=new We;for(let i=0,n=e.size;i<n;i+=1){const[n,s]=e.getEntry(i);r.set(n,s/t)}return new Ze(r,this.constant/t)}debug(t){t=t.write("ConstraintExpression").write(46).write("sum").write(40);const e=this.terms.size;for(let r=0;r<e;r+=1){const[e,i]=this.terms.getEntry(r);r>0&&(t=t.write(", ")),t=1===i?t.debug(e):t.debug(Qe.product(i,e))}return 0!==this.constant&&(e>0&&(t=t.write(", ")),t=t.debug(this.constant)),t=t.write(41)}toString(){return Ot.debug(this)}}const Je=function(){const t={is:function(t){if("object"==typeof t&&null!==t||"function"==typeof t){const e=t;return"coefficient"in e&&"variable"in e}return!1}};return t}();class $e{constructor(t,e){this.coefficient=t,this.variable=e}isConstant(){return!1}get terms(){const t=new We;return t.set(this.variable,this.coefficient),t}get constant(){return 0}plus(t){return(t=Qe.fromAny(t))instanceof $e&&this.variable===t.variable?Qe.product(this.coefficient+t.coefficient,this.variable):this.variable===t?Qe.product(this.coefficient+1,this.variable):Qe.sum(this,t)}negative(){return Qe.product(-this.coefficient,this.variable)}minus(t){return(t=Qe.fromAny(t))instanceof $e&&this.variable===t.variable?Qe.product(this.coefficient-t.coefficient,this.variable):this.variable===t?Qe.product(this.coefficient-1,this.variable):Qe.sum(this,t.negative())}times(t){return Qe.product(this.coefficient*t,this.variable)}divide(t){return Qe.product(this.coefficient/t,this.variable)}debug(t){return t=t.write("ConstraintExpression").write(46).write("product").write(40).debug(this.coefficient).write(", ").debug(this.variable).write(41)}toString(){return Ot.debug(this)}}class tr{constructor(t){this.constant=t}isConstant(){return!0}get coefficient(){return 0}get variable(){return null}get terms(){return new We}plus(t){return(t=Qe.fromAny(t))instanceof tr?Qe.constant(this.constant+t.constant):Qe.sum(this,t)}negative(){return Qe.constant(-this.constant)}minus(t){return(t=Qe.fromAny(t))instanceof tr?Qe.constant(this.constant-t.constant):Qe.sum(this,t.negative())}times(t){return Qe.constant(this.constant*t)}divide(t){return Qe.constant(this.constant/t)}debug(t){return t=t.write("ConstraintExpression").write(46),t=0===this.constant?t.write("zero"):t.write("constant").write(40).debug(this.constant).write(41)}toString(){return Ot.debug(this)}}Qe.zero=new tr(0);const er=function(t){const e=t.extend("ConstraintProperty");return e.prototype.isExternal=function(){return!0},e.prototype.isDummy=function(){return!1},e.prototype.isInvalid=function(){return!1},e.prototype.isConstant=function(){return!1},e.prototype.evaluateConstraintVariable=function(){},e.prototype.updateConstraintSolution=function(t){this.constrained&&this.toNumber(this.state)!==t&&this.setState(t,ye.Reflexive)},e.prototype.setStrength=function(t){this.strength=ir.fromAny(t)},Object.defineProperty(e.prototype,"coefficient",{get:()=>1,configurable:!0}),Object.defineProperty(e.prototype,"variable",{get(){return this},configurable:!0}),Object.defineProperty(e.prototype,"terms",{get(){const t=new We;return t.set(this,1),t},configurable:!0}),Object.defineProperty(e.prototype,"constant",{get:()=>0,configurable:!0}),e.prototype.plus=function(t){return this===(t=Qe.fromAny(t))?Qe.product(2,this):Qe.sum(this,t)},e.prototype.negative=function(){return Qe.product(-1,this)},e.prototype.minus=function(t){return this===(t=Qe.fromAny(t))?Qe.zero:Qe.sum(this,t.negative())},e.prototype.times=function(t){return Qe.product(t,this)},e.prototype.divide=function(t){return Qe.product(1/t,this)},Object.defineProperty(e.prototype,"constrained",{get(){return 0!=(this.flags&e.ConstrainedFlag)},configurable:!0}),e.prototype.constrain=function(t){void 0===t&&(t=!0);const r=this.flags;return t&&0==(r&e.ConstrainedFlag)?(this.setFlags(r|e.ConstrainedFlag),0!==this.conditionCount&&this.mounted&&this.stopConstraining()):t||0==(r&e.ConstrainedFlag)||(this.setFlags(r&~e.ConstrainedFlag),0!==this.conditionCount&&this.mounted&&(this.startConstraining(),this.updateConstraintVariable())),this},e.prototype.addConstraintCondition=function(t,e){this.conditionCount+=1,!this.constrained&&1===this.conditionCount&&this.mounted&&(this.startConstraining(),this.updateConstraintVariable())},e.prototype.removeConstraintCondition=function(t,e){this.conditionCount-=1,!this.constrained&&0===this.conditionCount&&this.mounted&&this.stopConstraining()},Object.defineProperty(e.prototype,"constraining",{get(){return 0!=(this.flags&e.ConstrainingFlag)},configurable:!0}),e.prototype.startConstraining=function(){0==(this.flags&e.ConstrainingFlag)&&(this.willStartConstraining(),this.setFlags(this.flags|e.ConstrainingFlag),this.onStartConstraining(),this.didStartConstraining())},e.prototype.willStartConstraining=function(){},e.prototype.onStartConstraining=function(){const t=this.owner;sr.is(t)&&t.addConstraintVariable(this)},e.prototype.didStartConstraining=function(){},e.prototype.stopConstraining=function(){0!=(this.flags&e.ConstrainingFlag)&&(this.willStopConstraining(),this.setFlags(this.flags&~e.ConstrainingFlag),this.onStopConstraining(),this.didStopConstraining())},e.prototype.willStopConstraining=function(){},e.prototype.onStopConstraining=function(){const t=this.owner;sr.is(t)&&t.removeConstraintVariable(this)},e.prototype.didStopConstraining=function(){},e.prototype.updateConstraintVariable=function(){const t=this.owner,e=this.state;void 0!==e&&sr.is(t)&&t.setConstraintVariable(this,this.toNumber(e))},e.prototype.onSetState=function(e,r){t.prototype.onSetState.call(this,e,r);const i=this.owner;this.constraining&&sr.is(i)&&i.setConstraintVariable(this,null!=e?this.toNumber(e):0)},e.prototype.onMount=function(){t.prototype.onMount.call(this),this.constrained||0===this.conditionCount||this.startConstraining()},e.prototype.onUnmount=function(){this.constrained||0===this.conditionCount||this.stopConstraining(),t.prototype.onUnmount.call(this)},e.prototype.fromAny=function(t){if("string"==typeof t){const e=+t;if(isFinite(e))return e}return t},e.prototype.toNumber=function(t){return null!=t?+t:0},e.construct=function(e,r,i){return(r=t.construct(e,r,i)).id=Be.next(),r.strength=ir.Strong,r.conditionCount=0,r},e.specialize=function(t){return null},e.define=function(t,e){let r=e.extends;const i=e.affinity,n=e.inherits,s=void 0!==e.strength?ir.fromAny(e.strength):void 0,o=e.constrain,a=e.state,u=e.initState;delete e.extends,delete e.affinity,delete e.inherits,delete e.strength,delete e.constrain,delete e.state,delete e.initState,null==r&&(r=this.specialize(e.type)),null===r&&(r=this,void 0===e.fromAny&&b.is(e.type)&&(e.fromAny=e.type.fromAny));const h=r.extend(t,e);return h.construct=function(t,e,h){return e=r.construct(t,e,h),void 0!==i&&e.initAffinity(i),void 0!==n&&e.initInherits(n),void 0!==s&&(e.strength=s),void 0!==u?e.state=e.fromAny(u()):void 0!==a&&(e.state=e.fromAny(a)),!0===o&&e.constrain(),e},h},e.ConstrainedFlag=1<<t.FlagShift+0,e.ConstrainingFlag=1<<t.FlagShift+1,e.FlagShift=t.FlagShift+2,e.FlagMask=(1<<e.FlagShift)-1,e}(ge),rr=function(t){const e=t.extend("ConstraintAnimator");return e.prototype.isExternal=function(){return!0},e.prototype.isDummy=function(){return!1},e.prototype.isInvalid=function(){return!1},e.prototype.isConstant=function(){return!1},e.prototype.evaluateConstraintVariable=function(){},e.prototype.updateConstraintSolution=function(t){this.constrained&&this.toNumber(this.state)!==t&&this.setState(t,ye.Reflexive)},e.prototype.setStrength=function(t){this.strength=ir.fromAny(t)},Object.defineProperty(e.prototype,"coefficient",{get:()=>1,configurable:!0}),Object.defineProperty(e.prototype,"variable",{get(){return this},configurable:!0}),Object.defineProperty(e.prototype,"terms",{get(){const t=new We;return t.set(this,1),t},configurable:!0}),Object.defineProperty(e.prototype,"constant",{get:()=>0,configurable:!0}),e.prototype.plus=function(t){return this===(t=Qe.fromAny(t))?Qe.product(2,this):Qe.sum(this,t)},e.prototype.negative=function(){return Qe.product(-1,this)},e.prototype.minus=function(t){return this===(t=Qe.fromAny(t))?Qe.zero:Qe.sum(this,t.negative())},e.prototype.times=function(t){return Qe.product(t,this)},e.prototype.divide=function(t){return Qe.product(1/t,this)},Object.defineProperty(e.prototype,"constrained",{get(){return 0!=(this.flags&e.ConstrainedFlag)},configurable:!0}),e.prototype.constrain=function(t){void 0===t&&(t=!0);const r=this.flags;return t&&0==(r&e.ConstrainedFlag)?(this.setFlags(r|e.ConstrainedFlag),0!==this.conditionCount&&this.mounted&&this.stopConstraining()):t||0==(r&e.ConstrainedFlag)||(this.setFlags(r&~e.ConstrainedFlag),0!==this.conditionCount&&this.mounted&&(this.startConstraining(),this.updateConstraintVariable())),this},e.prototype.addConstraintCondition=function(t,e){this.conditionCount+=1,!this.constrained&&1===this.conditionCount&&this.mounted&&(this.startConstraining(),this.updateConstraintVariable())},e.prototype.removeConstraintCondition=function(t,e){this.conditionCount-=1,!this.constrained&&0===this.conditionCount&&this.mounted&&this.stopConstraining()},Object.defineProperty(e.prototype,"constraining",{get(){return 0!=(this.flags&e.ConstrainingFlag)},configurable:!0}),e.prototype.startConstraining=function(){0==(this.flags&e.ConstrainingFlag)&&(this.willStartConstraining(),this.setFlags(this.flags|e.ConstrainingFlag),this.onStartConstraining(),this.didStartConstraining())},e.prototype.willStartConstraining=function(){},e.prototype.onStartConstraining=function(){const t=this.owner;sr.is(t)&&t.addConstraintVariable(this)},e.prototype.didStartConstraining=function(){},e.prototype.stopConstraining=function(){0!=(this.flags&e.ConstrainingFlag)&&(this.willStopConstraining(),this.setFlags(this.flags&~e.ConstrainingFlag),this.onStopConstraining(),this.didStopConstraining())},e.prototype.willStopConstraining=function(){},e.prototype.onStopConstraining=function(){const t=this.owner;sr.is(t)&&t.removeConstraintVariable(this)},e.prototype.didStopConstraining=function(){},e.prototype.updateConstraintVariable=function(){const t=this.owner,e=this.value;void 0!==e&&sr.is(t)&&t.setConstraintVariable(this,this.toNumber(e))},e.prototype.onSetValue=function(e,r){t.prototype.onSetValue.call(this,e,r);const i=this.owner;this.constraining&&sr.is(i)&&i.setConstraintVariable(this,null!=e?this.toNumber(e):0)},e.prototype.onMount=function(){t.prototype.onMount.call(this),this.constrained||0===this.conditionCount||this.startConstraining()},e.prototype.onUnmount=function(){this.constrained||0===this.conditionCount||this.stopConstraining(),t.prototype.onUnmount.call(this)},e.prototype.fromAny=function(t){if("string"==typeof t){const e=+t;if(isFinite(e))return e}return t},e.prototype.toNumber=function(t){return null!=t?+t:0},e.construct=function(e,r,i){return(r=t.construct(e,r,i)).id=Be.next(),r.strength=ir.Strong,r.conditionCount=0,r},e.specialize=function(t){return null},e.define=function(t,e){let r=e.extends;const i=e.affinity,n=e.inherits,s=void 0!==e.strength?ir.fromAny(e.strength):void 0,o=e.constrain,a=e.state,u=e.initState;delete e.extends,delete e.affinity,delete e.inherits,delete e.strength,delete e.constrain,delete e.state,delete e.initState,null==r&&(r=this.specialize(e.type)),null===r&&(r=this,void 0===e.fromAny&&b.is(e.type)&&(e.fromAny=e.type.fromAny));const h=r.extend(t,e);return h.construct=function(t,e,h){return e=r.construct(t,e,h),void 0!==i&&e.initAffinity(i),void 0!==n&&e.initInherits(n),void 0!==s&&(e.strength=s),void 0!==u?(e.state=e.fromAny(u()),e.value=e.state):void 0!==a&&(e.state=e.fromAny(a),e.value=e.state),!0===o&&e.constrain(),e},h},e.ConstrainedFlag=1<<t.FlagShift+0,e.ConstrainingFlag=1<<t.FlagShift+1,e.FlagShift=t.FlagShift+2,e.FlagMask=(1<<e.FlagShift)-1,e}(Ce),ir=function(){const t={Required:1001001e3,Strong:1e6,Medium:1e3,Weak:1,Unbound:-1,clip:function(e){return Math.min(Math.max(0,e),t.Required)},fromAny:function(e){if("number"==typeof e)return t.clip(e);if("required"===e)return t.Required;if("strong"===e)return t.Strong;if("medium"===e)return t.Medium;if("weak"===e)return t.Weak;throw new TypeError(""+e)}};return t}();class nr{constructor(t,e,r,i){this.id=Be.next(),this.scope=t,this.expression=e,this.relation=r,this.strength=i}isConstrained(){return this.scope.hasConstraint(this)}constrain(t=!0){return t?this.scope.addConstraint(this):this.scope.removeConstraint(this),this}debug(t){return t=t.debug(this.scope).write(46).write("constraint").write(40).debug(this.expression).write(", ").debug(this.relation).write(", ").debug(void 0).write(", "),t=(t=this.strength===ir.Required?t.debug("required"):this.strength===ir.Strong?t.debug("strong"):this.strength===ir.Medium?t.debug("medium"):this.strength===ir.Weak?t.debug("weak"):t.debug(this.strength)).write(41)}toString(){return Ot.debug(this)}}const sr=function(){const t={is:function(t){if("object"==typeof t&&null!==t||"function"==typeof t){return"constraint"in t}return!1}};return t}();class or{constructor(t,e,r,i){this.solver=t,this.symbol=e,this.cells=r,this.constant=i}setSymbol(t){this.symbol=t,this.invalidate()}setConstant(t){this.constant!==t&&(this.constant=t,this.invalidate())}isConstant(){return this.cells.isEmpty()}isDummy(){for(let t=0,e=this.cells.size;t<e;t+=1){if(!(this.cells.getEntry(t)[0]instanceof Ye))return!1}return!0}clone(){return new or(this.solver,this.symbol,this.cells.clone(),this.constant)}add(t){const e=this.constant+t;return this.setConstant(e),e}insertSymbol(t,e=1){var r;e+=null!==(r=this.cells.get(t))&&void 0!==r?r:0,Math.abs(e)<u.Epsilon?this.cells.remove(t):this.cells.set(t,e)}insertRow(t,e){this.setConstant(this.constant+t.constant*e);for(let r=0,i=t.cells.size;r<i;r+=1){const[i,n]=t.cells.getEntry(r);this.insertSymbol(i,n*e)}}removeSymbol(t){this.cells.remove(t)}negate(){this.setConstant(-this.constant);for(let t=0,e=this.cells.size;t<e;t+=1){const e=this.cells.getEntry(t);e[1]=-e[1]}}solveFor(t){const e=this.cells.remove(t);if(void 0!==e){const t=-1/e;this.setConstant(this.constant*t);for(let e=0,r=this.cells.size;e<r;e+=1){this.cells.getEntry(e)[1]*=t}}}solveForEx(t,e){this.insertSymbol(t,-1),this.solveFor(e)}coefficientFor(t){const e=this.cells.get(t);return void 0!==e?e:0}substitute(t,e){const r=this.cells.remove(t);void 0!==r&&this.insertRow(e,r)}invalidate(){const t=this.symbol;null!==t&&this.solver.invalidate(t,this)}}class ar{constructor(){}updated(t,e){const r=mr.create(2);return r.push(this),r.set(t,e),r}updatedAttr(t,e){const r=mr.create(2);return r.push(this),r.setAttr(t,e),r}updatedSlot(t,e){const r=mr.create(2);return r.push(this),r.setSlot(t,e),r}appended(...t){const e=mr.create(1+arguments.length);return e.push(this),e.push(...t),e}prepended(...t){const e=mr.create(arguments.length+1);return e.push(...t),e.push(this),e}concat(...t){const e=mr.create();e.push(this);for(let r=0,i=t.length;r<i;r+=1)ar.fromAny(t[r]).forEach((function(t){e.push(t)}));return e}lt(t){return t=ar.fromAny(t),this.compareTo(t)<0?Mr.from(!0):ar.absent()}le(t){return t=ar.fromAny(t),this.compareTo(t)<=0?Mr.from(!0):ar.absent()}eq(t){return t=ar.fromAny(t),this.equals(t)?Mr.from(!0):ar.absent()}ne(t){return t=ar.fromAny(t),this.equals(t)?ar.absent():Mr.from(!0)}ge(t){return t=ar.fromAny(t),this.compareTo(t)>=0?Mr.from(!0):ar.absent()}gt(t){return t=ar.fromAny(t),this.compareTo(t)>0?Mr.from(!0):ar.absent()}invoke(t){return ar.absent()}filter(t){const e=li.literal(this);return 0===arguments.length?e.filter():e.filter(t)}max(t){return this.compareTo(t)>=0?this:t}min(t){return this.compareTo(t)<=0?this:t}evaluate(t){return this}substitute(t){return this}cast(t,e){let r=t.cast(this);return void 0===r&&(r=e),r}coerce(t,e){let r=t.cast(this);return void 0===r&&(r=t.unit),void 0===r&&(r=e),r}get precedence(){return 11}forEach(t,e){return t.call(e,this,0)}iterator(){return _.unary(this)}interpolateTo(t){return t instanceof ar?ur(this,t):null}display(t){return this.debug(t)}toString(){return Ot.debug(this)}static empty(){return mr.empty()}static extant(){return Dr.extant()}static absent(){return Ir.absent()}static fromAny(t){return t instanceof ar?t:yr.fromAny(t)}static globalScope(){return mr.create(1).slot("math",Si.scope).commit()}}e([s],ar,"globalScope",null);const ur=function(t){const e=function(t,r){const i=function(t){return t<1?i[0]:i[1]};return Object.setPrototypeOf(i,e.prototype),i[0]=t.commit(),i[1]=r.commit(),i};return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e}(k);class hr extends ar{constructor(){super()}isDefined(){return!0}isDistinct(){return!0}isDefinite(){return!0}toValue(){return this.value}get tag(){}get target(){return this.value}flattened(){return yr.absent()}unflattened(){return mr.of(this)}header(t){return yr.absent()}headers(t){}head(){return ar.absent()}tail(){return mr.empty()}body(){return yr.absent()}get length(){return 0}has(t){return!1}get(t){return yr.absent()}getAttr(t){return yr.absent()}getSlot(t){return yr.absent()}getField(t){}getItem(t){return ar.absent()}deleted(t){return this}conditional(t,e){return t=ar.fromAny(t)}or(t){return this}and(t){return t=ar.fromAny(t)}lambda(t){return yr.absent()}stringValue(t){return this.value.stringValue(t)}numberValue(t){return this.value.numberValue(t)}booleanValue(t){return this.value.booleanValue(t)}interpolateTo(t){return t instanceof hr?cr(this,t):super.interpolateTo(t)}static of(t,e){let r;return"string"==typeof t?r=t:t instanceof Sr&&(r=t.value),void 0!==r&&64===r.charCodeAt(0)?(r=r.slice(1),1===arguments.length?dr.of(r):dr.of(r,e)):1===arguments.length?lr.of(t):lr.of(t,e)}static fromAny(t){if(t instanceof hr)return t;if("object"==typeof t&&null!==t){if(void 0!==t.$key)return hr.of(t.$key,t.$value);for(const e in t)return hr.of(e,t[e])}throw new TypeError(""+t)}}hr.ImmutableFlag=1;class lr extends hr{constructor(t,e,r){super(),this.key=t.commit(),this.value=e,this.flags=void 0!==r?r:0}isConstant(){return this.key.isConstant()&&this.value.isConstant()}setValue(t){if(0!=(this.flags&hr.ImmutableFlag))throw new Error("immutable");const e=this.value;return this.value=t,e}updatedValue(t){return new lr(this.key,t)}bitwiseOr(t){if((t=ar.fromAny(t))instanceof Pr)return new Wr(this,t);let e;return e=t instanceof lr&&this.key.equals(t.key)?this.value.bitwiseOr(t.value):t instanceof yr?this.value.bitwiseOr(t):yr.absent(),e.isDefined()?new lr(this.key,e):ar.absent()}bitwiseXor(t){if((t=ar.fromAny(t))instanceof Pr)return new Hr(this,t);let e;return e=t instanceof lr&&this.key.equals(t.key)?this.value.bitwiseXor(t.value):t instanceof yr?this.value.bitwiseXor(t):yr.absent(),e.isDefined()?new lr(this.key,e):ar.absent()}bitwiseAnd(t){if((t=ar.fromAny(t))instanceof Pr)return new Xr(this,t);let e;return e=t instanceof lr&&this.key.equals(t.key)?this.value.bitwiseAnd(t.value):t instanceof yr?this.value.bitwiseAnd(t):yr.absent(),e.isDefined()?new lr(this.key,e):ar.absent()}plus(t){if((t=ar.fromAny(t))instanceof Pr)return new $r(this,t);let e;return e=t instanceof lr&&this.key.equals(t.key)?this.value.plus(t.value):t instanceof yr?this.value.plus(t):yr.absent(),e.isDefined()?new lr(this.key,e):ar.absent()}minus(t){if((t=ar.fromAny(t))instanceof Pr)return new ti(this,t);let e;return e=t instanceof lr&&this.key.equals(t.key)?this.value.minus(t.value):t instanceof yr?this.value.minus(t):yr.absent(),e.isDefined()?new lr(this.key,e):ar.absent()}times(t){if((t=ar.fromAny(t))instanceof Pr)return new ei(this,t);let e;return e=t instanceof lr&&this.key.equals(t.key)?this.value.times(t.value):t instanceof yr?this.value.times(t):yr.absent(),e.isDefined()?new lr(this.key,e):ar.absent()}divide(t){if((t=ar.fromAny(t))instanceof Pr)return new ri(this,t);let e;return e=t instanceof lr&&this.key.equals(t.key)?this.value.divide(t.value):t instanceof yr?this.value.divide(t):yr.absent(),e.isDefined()?new lr(this.key,e):ar.absent()}modulo(t){if((t=ar.fromAny(t))instanceof Pr)return new ii(this,t);let e;return e=t instanceof lr&&this.key.equals(t.key)?this.value.modulo(t.value):t instanceof yr?this.value.modulo(t):yr.absent(),e.isDefined()?new lr(this.key,e):ar.absent()}not(){const t=this.value.not();return t.isDefined()?new lr(this.key,t):ar.absent()}bitwiseNot(){const t=this.value.bitwiseNot();return t.isDefined()?new lr(this.key,t):ar.absent()}negative(){const t=this.value.negative();return t.isDefined()?new lr(this.key,t):ar.absent()}positive(){const t=this.value.positive();return t.isDefined()?new lr(this.key,t):ar.absent()}inverse(){const t=this.value.inverse();return t.isDefined()?new lr(this.key,t):ar.absent()}evaluate(t){t=Lr.fromAny(t);const e=this.key.evaluate(t).toValue(),r=this.value.evaluate(t).toValue();return e===this.key&&r===this.value?this:e.isDefined()&&r.isDefined()?new lr(e,r):ar.absent()}substitute(t){t=Lr.fromAny(t);const e=this.key.substitute(t).toValue(),r=this.value.substitute(t).toValue();return e===this.key&&r===this.value?this:e.isDefined()&&r.isDefined()?new lr(e,r):ar.absent()}toAny(){const t={};return this.key instanceof Sr?t[this.key.value]=this.value.toAny():(t.$key=this.key.toAny(),t.$value=this.value.toAny()),t}isAliased(){return!1}isMutable(){return 0==(this.flags&hr.ImmutableFlag)}alias(){this.flags|=hr.ImmutableFlag}branch(){return 0!=(this.flags&hr.ImmutableFlag)?new lr(this.key,this.value,this.flags&~hr.ImmutableFlag):this}clone(){return new lr(this.key.clone(),this.value.clone())}commit(){return this.flags|=hr.ImmutableFlag,this.value.commit(),this}interpolateTo(t){return t instanceof lr?fr(this,t):super.interpolateTo(t)}get typeOrder(){return 2}compareTo(t){if(t instanceof lr){let e=this.key.compareTo(t.key);return 0===e&&(e=this.value.compareTo(t.value)),e}return t instanceof ar?h.compare(this.typeOrder,t.typeOrder):NaN}equivalentTo(t,e){return this===t||t instanceof lr&&(this.key.equals(t.key)&&this.value.equivalentTo(t.value,e))}keyEquals(t){return"string"==typeof t&&this.key instanceof Sr?this.key.value===t:t instanceof hr?this.key.equals(t.key):this.key.equals(t)}equals(t){return this===t||t instanceof lr&&(this.key.equals(t.key)&&this.value.equals(t.value))}hashCode(){return n.mash(n.mix(n.mix(p.hash(lr),this.key.hashCode()),this.value.hashCode()))}debug(t){return t=t.write("Slot").write(46).write("of").write(40).display(this.key),this.value instanceof Dr||(t=t.write(44).write(32).display(this.value)),t=t.write(41)}static of(t,e){return t=yr.fromAny(t),e=1===arguments.length?yr.extant():yr.fromAny(e),new lr(t,e)}}const cr=function(t){const e=function(t,r){const i=function(t){const e=i.keyInterpolator(t),r=i.valueInterpolator(t);return lr.of(e,r)};return Object.setPrototypeOf(i,e.prototype),i.keyInterpolator=t.key.interpolateTo(r.key),i.valueInterpolator=t.value.interpolateTo(r.value),i};return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,Object.defineProperty(e.prototype,0,{get(){return lr.of(this.keyInterpolator[0],this.valueInterpolator[0])},configurable:!0}),Object.defineProperty(e.prototype,1,{get(){return lr.of(this.keyInterpolator[1],this.valueInterpolator[1])},configurable:!0}),e.prototype.equals=function(t){return this===t||t instanceof e&&(this.keyInterpolator.equals(t.keyInterpolator)&&this.valueInterpolator.equals(t.valueInterpolator))},e}(k);class dr extends hr{constructor(t,e,r){super(),this.key=t,this.value=e,this.flags=void 0!==r?r:0}isConstant(){return this.key.isConstant()&&this.value.isConstant()}get name(){return this.key.value}setValue(t){if(0!=(this.flags&hr.ImmutableFlag))throw new Error("immutable");const e=this.value;return this.value=t,e}updatedValue(t){return new dr(this.key,t)}bitwiseOr(t){if((t=ar.fromAny(t))instanceof Pr)return new Wr(this,t);let e;return e=t instanceof dr&&this.key.equals(t.key)?this.value.bitwiseOr(t.value):t instanceof yr?this.value.bitwiseOr(t):yr.absent(),e.isDefined()?new dr(this.key,e):ar.absent()}bitwiseXor(t){if((t=ar.fromAny(t))instanceof Pr)return new Hr(this,t);let e;return e=t instanceof dr&&this.key.equals(t.key)?this.value.bitwiseXor(t.value):t instanceof yr?this.value.bitwiseXor(t):yr.absent(),e.isDefined()?new dr(this.key,e):ar.absent()}bitwiseAnd(t){if((t=ar.fromAny(t))instanceof Pr)return new Xr(this,t);let e;return e=t instanceof dr&&this.key.equals(t.key)?this.value.bitwiseAnd(t.value):t instanceof yr?this.value.bitwiseAnd(t):yr.absent(),e.isDefined()?new dr(this.key,e):ar.absent()}plus(t){if((t=ar.fromAny(t))instanceof Pr)return new $r(this,t);let e;return e=t instanceof dr&&this.key.equals(t.key)?this.value.plus(t.value):t instanceof yr?this.value.plus(t):yr.absent(),e.isDefined()?new dr(this.key,e):ar.absent()}minus(t){if((t=ar.fromAny(t))instanceof Pr)return new ti(this,t);let e;return e=t instanceof dr&&this.key.equals(t.key)?this.value.minus(t.value):t instanceof yr?this.value.minus(t):yr.absent(),e.isDefined()?new dr(this.key,e):ar.absent()}times(t){if((t=ar.fromAny(t))instanceof Pr)return new ei(this,t);let e;return e=t instanceof dr&&this.key.equals(t.key)?this.value.times(t.value):t instanceof yr?this.value.times(t):yr.absent(),e.isDefined()?new dr(this.key,e):ar.absent()}divide(t){if((t=ar.fromAny(t))instanceof Pr)return new ri(this,t);let e;return e=t instanceof dr&&this.key.equals(t.key)?this.value.divide(t.value):t instanceof yr?this.value.divide(t):yr.absent(),e.isDefined()?new dr(this.key,e):ar.absent()}modulo(t){if((t=ar.fromAny(t))instanceof Pr)return new ii(this,t);let e;return e=t instanceof dr&&this.key.equals(t.key)?this.value.modulo(t.value):t instanceof yr?this.value.modulo(t):yr.absent(),e.isDefined()?new dr(this.key,e):ar.absent()}not(){const t=this.value.not();return t.isDefined()?new dr(this.key,t):ar.absent()}bitwiseNot(){const t=this.value.bitwiseNot();return t.isDefined()?new dr(this.key,t):ar.absent()}negative(){const t=this.value.negative();return t.isDefined()?new dr(this.key,t):ar.absent()}positive(){const t=this.value.positive();return t.isDefined()?new dr(this.key,t):ar.absent()}inverse(){const t=this.value.inverse();return t.isDefined()?new dr(this.key,t):ar.absent()}evaluate(t){t=Lr.fromAny(t);const e=this.key.evaluate(t).toValue(),r=this.value.evaluate(t).toValue();return e===this.key&&r===this.value?this:e.isDefined()&&r.isDefined()?e instanceof Sr?new dr(e,r):new lr(e,r):ar.absent()}substitute(t){t=Lr.fromAny(t);const e=this.key.substitute(t).toValue(),r=this.value.substitute(t).toValue();return e===this.key&&r===this.value?this:e.isDefined()&&r.isDefined()?e instanceof Sr?new dr(e,r):new lr(e,r):ar.absent()}toAny(){const t={};return t["@"+this.key.value]=this.value.toAny(),t}isAliased(){return!1}isMutable(){return 0==(this.flags&hr.ImmutableFlag)}alias(){this.flags|=hr.ImmutableFlag}branch(){return 0!=(this.flags&hr.ImmutableFlag)?new dr(this.key,this.value,this.flags&~hr.ImmutableFlag):this}clone(){return new dr(this.key.clone(),this.value.clone())}commit(){return this.flags|=hr.ImmutableFlag,this.value.commit(),this}interpolateTo(t){return t instanceof dr?pr(this,t):super.interpolateTo(t)}get typeOrder(){return 1}compareTo(t){if(t instanceof dr){let e=this.key.compareTo(t.key);return 0===e&&(e=this.value.compareTo(t.value)),e}return t instanceof ar?h.compare(this.typeOrder,t.typeOrder):NaN}equivalentTo(t,e){return this===t||t instanceof dr&&(this.key.equals(t.key)&&this.value.equivalentTo(t.value,e))}keyEquals(t){return"string"==typeof t?this.key.value===t:t instanceof hr?this.key.equals(t.key):this.key.equals(t)}equals(t){return this===t||t instanceof dr&&(this.key.equals(t.key)&&this.value.equals(t.value))}hashCode(){return n.mash(n.mix(n.mix(p.hash(dr),this.key.hashCode()),this.value.hashCode()))}debug(t){return t=t.write("Attr").write(46).write("of").write(40).display(this.key),this.value instanceof Dr||(t=t.write(44).write(32).display(this.value)),t=t.write(41)}static of(t,e){return t=Sr.fromAny(t),e=1===arguments.length?yr.extant():yr.fromAny(e),new dr(t,e)}}const pr=function(t){const e=function(t,r){const i=function(t){const e=i.keyInterpolator(t),r=i.valueInterpolator(t);return dr.of(e,r)};return Object.setPrototypeOf(i,e.prototype),i.keyInterpolator=t.key.interpolateTo(r.key),i.valueInterpolator=t.value.interpolateTo(r.value),i};return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,Object.defineProperty(e.prototype,0,{get(){return dr.of(this.keyInterpolator[0],this.valueInterpolator[0])},configurable:!0}),Object.defineProperty(e.prototype,1,{get(){return dr.of(this.keyInterpolator[1],this.valueInterpolator[1])},configurable:!0}),e.prototype.equals=function(t){return this===t||t instanceof e&&(this.keyInterpolator.equals(t.keyInterpolator)&&this.valueInterpolator.equals(t.valueInterpolator))},e}(k),fr=function(t){const e=function(t,r){const i=function(t){const e=i.keyInterpolator(t),r=i.valueInterpolator(t);return lr.of(e,r)};return Object.setPrototypeOf(i,e.prototype),i.keyInterpolator=t.key.interpolateTo(r.key),i.valueInterpolator=t.value.interpolateTo(r.value),i};return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,Object.defineProperty(e.prototype,0,{get(){return lr.of(this.keyInterpolator[0],this.valueInterpolator[0])},configurable:!0}),Object.defineProperty(e.prototype,1,{get(){return lr.of(this.keyInterpolator[1],this.valueInterpolator[1])},configurable:!0}),e.prototype.equals=function(t){return this===t||t instanceof e&&(this.keyInterpolator.equals(t.keyInterpolator)&&this.valueInterpolator.equals(t.valueInterpolator))},e}(k);class yr extends ar{constructor(){super()}isDefined(){return!0}isDistinct(){return!0}isDefinite(){return!0}get key(){return yr.absent()}toValue(){return this}get tag(){}get target(){return this}flattened(){return this}unflattened(){return mr.of(this)}header(t){return yr.absent()}headers(t){}head(){return ar.absent()}tail(){return mr.empty()}body(){return yr.extant()}get length(){return 0}has(t){return!1}get(t){return yr.absent()}getAttr(t){return yr.absent()}getSlot(t){return yr.absent()}getField(t){}getItem(t){return ar.absent()}deleted(t){return this}conditional(t,e){return t=ar.fromAny(t)}or(t){return this}and(t){return t=ar.fromAny(t)}bitwiseOr(t){if((t=ar.fromAny(t))instanceof Pr)return new Wr(this,t);if(t instanceof dr){const e=this.bitwiseOr(t.value);if(e.isDefined())return new dr(t.key,e)}else if(t instanceof lr){const e=this.bitwiseOr(t.value);if(e.isDefined())return new lr(t.key,e)}return ar.absent()}bitwiseXor(t){if((t=ar.fromAny(t))instanceof Pr)return new Hr(this,t);if(t instanceof dr){const e=this.bitwiseXor(t.value);if(e.isDefined())return new dr(t.key,e)}else if(t instanceof lr){const e=this.bitwiseXor(t.value);if(e.isDefined())return new lr(t.key,e)}return ar.absent()}bitwiseAnd(t){if((t=ar.fromAny(t))instanceof Pr)return new Xr(this,t);if(t instanceof dr){const e=this.bitwiseAnd(t.value);if(e.isDefined())return new dr(t.key,e)}else if(t instanceof lr){const e=this.bitwiseAnd(t.value);if(e.isDefined())return new lr(t.key,e)}return ar.absent()}lt(t){return(t=ar.fromAny(t))instanceof Pr?new Yr(this,t):super.lt(t)}le(t){return(t=ar.fromAny(t))instanceof Pr?new Gr(this,t):super.le(t)}eq(t){return(t=ar.fromAny(t))instanceof Pr?new _r(this,t):super.eq(t)}ne(t){return(t=ar.fromAny(t))instanceof Pr?new Qr(this,t):super.ne(t)}ge(t){return(t=ar.fromAny(t))instanceof Pr?new Zr(this,t):super.ge(t)}gt(t){return(t=ar.fromAny(t))instanceof Pr?new Jr(this,t):super.gt(t)}plus(t){if((t=ar.fromAny(t))instanceof Pr)return new $r(this,t);if(t instanceof dr){const e=this.plus(t.value);if(e.isDefined())return new dr(t.key,e)}else if(t instanceof lr){const e=this.plus(t.value);if(e.isDefined())return new lr(t.key,e)}return ar.absent()}minus(t){if((t=ar.fromAny(t))instanceof Pr)return new ti(this,t);if(t instanceof dr){const e=this.minus(t.value);if(e.isDefined())return new dr(t.key,e)}else if(t instanceof lr){const e=this.minus(t.value);if(e.isDefined())return new lr(t.key,e)}return ar.absent()}times(t){if((t=ar.fromAny(t))instanceof Pr)return new ei(this,t);if(t instanceof dr){const e=this.times(t.value);if(e.isDefined())return new dr(t.key,e)}else if(t instanceof lr){const e=this.times(t.value);if(e.isDefined())return new lr(t.key,e)}return ar.absent()}divide(t){if((t=ar.fromAny(t))instanceof Pr)return new ri(this,t);if(t instanceof dr){const e=this.divide(t.value);if(e.isDefined())return new dr(t.key,e)}else if(t instanceof lr){const e=this.divide(t.value);if(e.isDefined())return new lr(t.key,e)}return ar.absent()}modulo(t){if((t=ar.fromAny(t))instanceof Pr)return new ii(this,t);if(t instanceof dr){const e=this.modulo(t.value);if(e.isDefined())return new dr(t.key,e)}else if(t instanceof lr){const e=this.modulo(t.value);if(e.isDefined())return new lr(t.key,e)}return ar.absent()}not(){return yr.absent()}bitwiseNot(){return yr.absent()}negative(){return yr.absent()}positive(){return yr.absent()}inverse(){return yr.absent()}lambda(t){return new Ci(this,t)}stringValue(t){return t}numberValue(t){return t}booleanValue(t){return t}isAliased(){return!1}isMutable(){return!1}alias(){}branch(){return this}clone(){return this}commit(){return this}interpolateTo(t){return super.interpolateTo(t)}keyEquals(t){return!1}static builder(){return new wr}static empty(){return mr.empty()}static extant(){return Dr.extant()}static absent(){return Ir.absent()}static fromAny(t){if(t instanceof yr)return t;if(void 0===t)return Ir.absent();if(null===t)return Dr.extant();if("boolean"==typeof t)return Mr.from(t);if("number"==typeof t)return kr.from(t);if("string"==typeof t)return Sr.from(t);if(t instanceof Uint8Array)return Cr.wrap(t);if(Array.isArray(t))return mr.fromArray(t);if("object"==typeof t)return mr.fromObject(t);throw new TypeError(""+t)}}class mr extends yr{constructor(){super()}isDefinite(){return!this.isEmpty()}isArray(){return 0===this.fieldCount}isObject(){return 0===this.valueCount}get valueCount(){let t=0;return this.forEach((function(e){e instanceof yr&&(t+=1)}),this),t}isConstant(){return void 0===this.forEach((function(t){return!!t.isConstant()&&void 0}),this)}get tag(){const t=this.head();if(t instanceof dr)return t.key.value}get target(){let t,e,r=!1;return this.forEach((function(i){i instanceof dr?r=!0:void 0===t&&i instanceof yr?t=i:(void 0===e&&(e=mr.create(),void 0!==t&&e.push(t)),e.push(i))}),this),void 0===t?yr.extant():void 0===e?t:r?e:this}flattened(){if(this.isEmpty())return yr.extant();{const t=this.iterator(),e=t.head();return t.step(),t.isEmpty()&&e instanceof yr?e:this.branch()}}unflattened(){return this}header(t){const e=this.head();return e instanceof dr&&e.key.value===t?e.value:yr.absent()}headers(t){const e=this.head();if(e instanceof dr&&e.key.value===t){const t=e.value;return t instanceof mr?t:mr.of(t)}}head(){return this.forEach((function(t){return t}),this)||ar.absent()}tail(){const t=mr.create();return this.forEach((function(e,r){r>0&&t.push(e)}),this),t}body(){const t=this.tail();return t.isEmpty()?yr.absent():t.flattened()}has(t){return t=yr.fromAny(t),this.forEach((function(e){return!!(e instanceof hr&&e.key.equals(t))||void 0}),this)||!1}indexOf(t,e=0){t=ar.fromAny(t),e<0&&(e=Math.max(0,this.length+e));const r=this.forEach((function(r,i){return i>=e&&t.equals(r)?i:void 0}),this);return void 0!==r?r:-1}lastIndexOf(t,e){t=ar.fromAny(t);const r=this.length;for(void 0===e?e=r-1:e<0&&(e=r+e),e=Math.min(e,r-1);e>=0;){if(t.equals(this.getItem(e)))return e;e-=1}return-1}get(t){return t=yr.fromAny(t),this.forEach((function(e){return e instanceof hr&&e.key.equals(t)?e.value:void 0}),this)||yr.absent()}getAttr(t){return t=Sr.fromAny(t),this.forEach((function(e){return e instanceof dr&&e.key.equals(t)?e.value:void 0}),this)||yr.absent()}getSlot(t){return t=yr.fromAny(t),this.forEach((function(e){return e instanceof lr&&e.key.equals(t)?e.value:void 0}),this)||yr.absent()}getField(t){return t=yr.fromAny(t),this.forEach((function(e){return e instanceof hr&&e.key.equals(t)?e:void 0}),this)}set(t,e){t=yr.fromAny(t),e=yr.fromAny(e);const r=this.iterator();for(;!r.isEmpty();){const i=r.head();if(i instanceof hr&&i.key.equals(t))return i.isMutable()?i.setValue(e):r.set(i.updatedValue(e)),this;r.step()}return this.push(new lr(t,e)),this}setAttr(t,e){t=Sr.fromAny(t),e=yr.fromAny(e);const r=this.iterator();for(;!r.isEmpty();){const i=r.head();if(i instanceof hr&&i.key.equals(t))return i instanceof dr&&i.isMutable()?i.setValue(e):r.set(new dr(t,e)),this;r.step()}return this.push(new dr(t,e)),this}setSlot(t,e){t=yr.fromAny(t),e=yr.fromAny(e);const r=this.iterator();for(;!r.isEmpty();){const i=r.head();if(i instanceof hr&&i.key.equals(t))return i instanceof lr&&i.isMutable()?i.setValue(e):r.set(new lr(t,e)),this;r.step()}return this.push(new lr(t,e)),this}updated(t,e){t=yr.fromAny(t),e=yr.fromAny(e);const r=this.isMutable()?this:this.branch(),i=r.iterator();for(;!i.isEmpty();){const n=i.head();if(n.key.equals(t))return n instanceof hr&&n.isMutable()?n.setValue(e):i.set(new lr(t,e)),r;i.step()}return r.push(new lr(t,e)),r}updatedAttr(t,e){t=Sr.fromAny(t),e=yr.fromAny(e);const r=this.isMutable()?this:this.branch(),i=r.iterator();for(;!i.isEmpty();){const n=i.head();if(n.key.equals(t))return n instanceof dr&&n.isMutable()?n.setValue(e):i.set(new dr(t,e)),r;i.step()}return r.push(new dr(t,e)),r}updatedSlot(t,e){t=yr.fromAny(t),e=yr.fromAny(e);const r=this.isMutable()?this:this.branch(),i=r.iterator();for(;!i.isEmpty();){const n=i.head();if(n.key.equals(t))return n instanceof lr&&n.isMutable()?n.setValue(e):i.set(new lr(t,e)),r;i.step()}return r.push(new lr(t,e)),r}appended(...t){const e=this.isMutable()?this:this.branch();return e.push(...t),e}prepended(...t){const e=this.isMutable()?this:this.branch();return e.splice(0,0,...t),e}deleted(t){const e=this.isMutable()?this:this.branch();return e.delete(t),e}concat(...t){const e=this.isMutable()?this:this.branch();for(let r=0,i=t.length;r<i;r+=1)ar.fromAny(t[r]).forEach((function(t){e.push(t)}));return e}slice(t,e){return this.subRecord(t,e).branch()}attr(t,e){let r;return r=1===arguments.length?dr.of(t):dr.of(t,e),this.push(r),this}slot(t,e){let r;return r=1===arguments.length?lr.of(t):lr.of(t,e),this.push(r),this}item(t){return this.push(t),this}items(...t){return this.push(this,...t),this}evaluate(t){t=Lr.fromAny(t);const e=mr.create();t.pushScope(e);let r=!1;return this.forEach((function(i){const n=i.evaluate(t);n.isDefined()&&e.push(n),i!==n&&(r=!0)}),this),t.popScope(),r?e:this}substitute(t){t=Lr.fromAny(t);const e=mr.create();t.pushScope(e);let r=!1;return this.forEach((function(i){const n=i.substitute(t);n.isDefined()&&e.push(n),i!==n&&(r=!0)}),this),t.popScope(),r?e:this}stringValue(t){let e="";return void 0===this.forEach((function(t){if(t instanceof yr){const r=t.stringValue();if(void 0!==r)return void(e+=r)}return null}),this)?e:void 0}toAny(){return!this.isEmpty()&&this.isArray()?this.toArray():this.toObject()}toArray(){const t=new Array(this.length);return this.forEach((function(e,r){e instanceof yr?t[r]=e.toAny():e instanceof hr&&(t[r]={$key:e.key.toAny(),$value:e.value.toAny()})}),this),t}toObject(){const t={};return this.forEach((function(e,r){e instanceof dr?t["@"+e.key.value]=e.value.toAny():e instanceof lr?e.key instanceof Sr?t[e.key.value]=e.value.toAny():t["$"+r]={$key:e.key.toAny(),$value:e.value.toAny()}:e instanceof yr&&(t["$"+r]=e.toAny())}),this),t}isAliased(){return!1}isMutable(){return!0}alias(){}branch(){const t=mr.create();return this.forEach((function(e){t.push(e)}),this),t}clone(){const t=mr.create();return this.forEach((function(e){t.push(e.clone())}),this),t}commit(){return this}bind(){return this}subRecord(t,e){const r=this.length;void 0===t?t=0:t<0&&(t=r+t),t=Math.min(Math.max(0,t),r),void 0===e?e=r:e<0&&(e=r+e);const i=mr.create();return this.forEach((function(r,n){return n<t?void 0:n<e?void i.push(r):null}),this),i}iterator(){return new vr(this)}interpolateTo(t){return t instanceof mr?gr(this,t):super.interpolateTo(t)}get typeOrder(){return 3}compareTo(t){if(t instanceof mr){const e=this.iterator(),r=t.iterator();let i=0;do{if(e.isEmpty()||r.isEmpty())break;i=e.head().compareTo(r.head()),e.step(),r.step()}while(0===i);return 0!==i?i:e.isEmpty()&&!r.isEmpty()?-1:!e.isEmpty()&&r.isEmpty()?1:0}return t instanceof ar?h.compare(this.typeOrder,t.typeOrder):NaN}equivalentTo(t,e){if(this===t)return!0;if(t instanceof mr){const r=this.iterator(),i=t.iterator();for(;!r.isEmpty()&&!i.isEmpty();){if(!r.head().equivalentTo(i.head(),e))return!1;r.step(),i.step()}return r.isEmpty()&&i.isEmpty()}return!1}equals(t){if(this===t)return!0;if(t instanceof mr){const e=this.iterator(),r=t.iterator();for(;!e.isEmpty()&&!r.isEmpty();){if(!e.head().equals(r.head()))return!1;e.step(),r.step()}return e.isEmpty()&&r.isEmpty()}return!1}hashCode(){let t=p.hash(mr);return this.forEach((function(e){t=n.mix(t,e.hashCode())}),this),t}debug(t){return t=t.write("Record").write(46),this.isEmpty()?t=t.write("empty").write(40).write(41):(t=t.write("of").write(40),this.forEach((function(e,r){0!==r&&(t=t.write(44).write(32)),t=t.display(e)}),this),t=t.write(41)),t}static empty(){return br.empty()}static create(t){return br.create(t)}static of(...t){return br.of(...t)}static fromAny(t){if(t instanceof mr)return t;if(Array.isArray(t))return mr.fromArray(t);if("object"==typeof t&&null!==t)return mr.fromObject(t);throw new TypeError(""+t)}static fromArray(t){const e=t.length||0,r=mr.create(e);for(let i=0;i<e;i+=1)r.push(ar.fromAny(t[i]));return r}static fromObject(t){const e=mr.create();for(const r in t){const i=t[r];36===r.charCodeAt(0)?i&&"object"==typeof i&&Object.prototype.hasOwnProperty.call(i,"$key")?e.push(hr.of(i.$key,i.$value)):e.push(yr.fromAny(i)):e.push(hr.of(r,i))}return e}static expand(t){return t=Math.max(8,t)-1,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,(t|=t>>16)+1}}mr.AliasedFlag=1,mr.ImmutableFlag=2,Object.defineProperty(mr.prototype,"fieldCount",{get(){let t=0;return this.forEach((function(e){e instanceof hr&&(t+=1)}),this),t},configurable:!0});class wr{constructor(){this.record=null,this.value=null}push(...t){for(let e=0,r=t.length;e<r;e+=1){const r=t[e];if(r instanceof hr)return this.pushField(r);if(r instanceof yr)return this.pushValue(r);throw new TypeError(""+r)}}pushField(t){null===this.record&&(this.record=mr.create(),null!==this.value&&(this.record.push(this.value),this.value=null)),this.record.push(t)}pushValue(t){null!==this.record?this.record.push(t):null===this.value?this.value=t:(this.record=mr.create(),this.record.push(this.value),this.value=null,this.record.push(t))}bind(){return null!==this.record?this.record:null!==this.value?this.value:yr.absent()}}const gr=function(t){const e=function(t,r){const i=function(t){const e=i.interpolators,r=e.length,n=mr.create(r);for(let i=0;i<r;i+=1)n.push(e[i](t));return n};Object.setPrototypeOf(i,e.prototype);const n=Math.min(t.length,r.length),s=new Array(n);for(let e=0;e<n;e+=1)s[e]=t.getItem(e).interpolateTo(r.getItem(e));return i.interpolators=s,i};return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,Object.defineProperty(e.prototype,0,{get(){const t=this.interpolators,e=t.length,r=mr.create(e);for(let i=0;i<e;i+=1)r.push(t[i][0]);return r},configurable:!0}),Object.defineProperty(e.prototype,1,{get(){const t=this.interpolators,e=t.length,r=mr.create(e);for(let i=0;i<e;i+=1)r.push(t[i][1]);return r},configurable:!0}),e.prototype.equals=function(t){if(this===t)return!0;if(t instanceof e){const e=this.interpolators.length;if(e===t.interpolators.length){for(let r=0;r<e;r+=1)if(!this.interpolators[r].equals(t.interpolators[r]))return!1;return!0}}return!1},e}(k);class vr extends _{constructor(t,e,r,i){super(),void 0===e&&(e=0),void 0===r&&(r=t.length),void 0===i&&(i=e),this.record=t,this.lower=e,this.upper=r,this.index=i,this.direction=0}isEmpty(){return this.index>=this.upper}head(){if(this.direction=0,this.index<this.upper)return this.record.getItem(this.index);throw new Error("empty")}step(){this.direction=0;const t=this.index;if(!(t<this.upper))throw new Error("empty");this.index=t+1}skip(t){this.index=Math.min(Math.max(this.lower,this.index+t,this.upper))}hasNext(){return this.index<this.upper}nextIndex(){return this.index-this.lower}next(){this.direction=1;const t=this.index;return t<this.upper?(this.index=t+1,{value:this.record.getItem(t),done:this.index===this.upper}):(this.index=this.upper,{done:!0})}hasPrevious(){return this.index>this.lower}previousIndex(){return this.index-this.lower-1}previous(){this.direction=-1;const t=this.index-1;return t>=this.lower?(this.index=t,{value:this.record.getItem(t),done:t===this.lower}):(this.index=0,{done:!0})}set(t){this.direction>0?this.record.setItem(this.index-1,t):this.record.setItem(this.index,t)}delete(){let t=this.index;this.direction>0&&(t-=1,this.index=t),this.record.splice(t,1),this.direction=0}}class br extends mr{constructor(t,e,r,i,n){super(),this.array=t,this.table=e,Object.defineProperty(this,"length",{value:r,writable:!0,enumerable:!0,configurable:!0}),Object.defineProperty(this,"fieldCount",{value:i,writable:!0,enumerable:!0,configurable:!0}),this.flags=n}isEmpty(){return 0===this.length}get valueCount(){return this.length-this.fieldCount}isConstant(){const t=this.array;for(let e=0,r=this.length;e<r;e+=1)if(!t[e].isConstant())return!1;return!0}get tag(){if(this.fieldCount>0){const t=this.array[0];if(t instanceof dr)return t.key.value}}get target(){let t,e,r=!1;const i=this.array;for(let n=0,s=this.length;n<s;n+=1){const s=i[n];s instanceof dr?r=!0:void 0===t&&s instanceof yr?t=s:(void 0===e&&(e=mr.create(),void 0!==t&&e.push(t)),e.push(s))}return void 0===t?yr.extant():void 0===e?t:r?e:this}head(){return this.length>0?this.array[0]:ar.absent()}tail(){const t=this.length;return t>0?new xr(this,1,t):mr.empty()}body(){const t=this.length;if(t>2)return new xr(this,1,t).branch();if(2===t){const t=this.array[1];return t instanceof yr?t:mr.of(t)}return yr.absent()}has(t){if(0!==this.fieldCount){t=yr.fromAny(t);const e=this.hashTable(),r=e.length,i=Math.abs(t.hashCode()%r);let n=i;do{const i=e[n];if(void 0===i)break;if(i.key.equals(t))return!0;n=(n+1)%r}while(n!==i)}return!1}indexOf(t,e=0){t=ar.fromAny(t);const r=this.array,i=this.length;for(e<0&&(e=Math.max(0,i+e));e<i;){if(t.equals(r[e]))return e;e+=1}return-1}lastIndexOf(t,e){t=ar.fromAny(t);const r=this.array,i=this.length;for(void 0===e?e=i-1:e<0&&(e=i+e),e=Math.min(e,i-1);e>=0;){if(t.equals(r[e]))return e;e-=1}return-1}get(t){if(this.fieldCount>0){t=yr.fromAny(t);const e=this.hashTable(),r=e.length,i=Math.abs(t.hashCode()%r);let n=i;do{const i=e[n];if(void 0===i)break;if(i.key.equals(t))return i.value;n=(n+1)%r}while(n!==i)}return yr.absent()}getAttr(t){if(this.fieldCount>0){t=Sr.fromAny(t);const e=this.hashTable(),r=e.length,i=Math.abs(t.hashCode()%r);let n=i;do{const i=e[n];if(void 0===i)break;if(i instanceof dr&&i.key.equals(t))return i.value;n=(n+1)%r}while(n!==i)}return yr.absent()}getSlot(t){if(this.fieldCount>0){t=yr.fromAny(t);const e=this.hashTable(),r=e.length,i=Math.abs(t.hashCode()%r);let n=i;do{const i=e[n];if(void 0===i)break;if(i instanceof lr&&i.key.equals(t))return i.value;n=(n+1)%r}while(n!==i)}return yr.absent()}getField(t){if(this.fieldCount>0){t=yr.fromAny(t);const e=this.hashTable(),r=e.length,i=Math.abs(t.hashCode()%r);let n=i;do{const i=e[n];if(void 0===i)break;if(i.key.equals(t))return i;n=(n+1)%r}while(n!==i)}}getItem(t){t instanceof kr&&(t=t.value);const e=this.length;return t<0&&(t=e+t),t>=0&&t<e?this.array[t]:ar.absent()}set(t,e){if(0!=(this.flags&mr.ImmutableFlag))throw new Error("immutable");return t=yr.fromAny(t),e=yr.fromAny(e),0!=(this.flags&mr.AliasedFlag)?this.fieldCount>0?this.setAliased(t,e):this.pushAliased(new lr(t,e)):this.fieldCount>0?null!==this.table?this.setMutable(t,e):this.updateMutable(t,e):this.pushMutable(new lr(t,e)),this}setAliased(t,e){const r=this.length,i=this.array,n=new Array(mr.expand(r+1));for(let s=0;s<r;s+=1){const o=i[s];if(o instanceof hr&&o.key.equals(t)){for(n[s]=o.updatedValue(e),s+=1;s<r;)n[s]=i[s],s+=1;return this.array=n,this.table=null,void(this.flags&=~mr.AliasedFlag)}n[s]=o}n[r]=new lr(t,e),this.array=n,this.table=null,this.length=r+1,this.fieldCount+=1,this.flags&=~mr.AliasedFlag}setMutable(t,e){const r=this.table,i=r.length,n=Math.abs(t.hashCode()%i);let s=n;do{const n=r[s];if(void 0===n)break;if(n.key.equals(t))return n.isMutable()?void n.setValue(e):void this.updateMutable(t,e);s=(s+1)%i}while(s!==n);const o=new lr(t,e);this.pushMutable(o),br.put(r,o)}updateMutable(t,e){const r=this.array;for(let i=0,n=this.length;i<n;i+=1){const n=r[i];if(n instanceof hr&&n.key.equals(t))return r[i]=n.updatedValue(e),void(this.table=null)}const i=new lr(t,e);this.pushMutable(i),br.put(this.table,i)}setAttr(t,e){if(0!=(this.flags&mr.ImmutableFlag))throw new Error("immutable");return t=Sr.fromAny(t),e=yr.fromAny(e),0!=(this.flags&mr.AliasedFlag)?this.fieldCount>0?this.setAttrAliased(t,e):this.pushAliased(new dr(t,e)):this.fieldCount>0?null!==this.table?this.setAttrMutable(t,e):this.updateAttrMutable(t,e):this.pushMutable(new dr(t,e)),this}setAttrAliased(t,e){const r=this.length,i=this.array,n=new Array(mr.expand(r+1));for(let s=0;s<r;s+=1){const o=i[s];if(o instanceof hr&&o.key.equals(t)){for(n[s]=new dr(t,e),s+=1;s<r;)n[s]=i[s],s+=1;return this.array=n,this.table=null,void(this.flags&=~mr.AliasedFlag)}n[s]=o}n[r]=new dr(t,e),this.array=n,this.table=null,this.length=r+1,this.fieldCount+=1,this.flags&=~mr.AliasedFlag}setAttrMutable(t,e){const r=this.table,i=r.length,n=Math.abs(t.hashCode()%i);let s=n;do{const n=r[s];if(void 0===n)break;if(n.key.equals(t))return void(n instanceof dr&&n.isMutable()?n.setValue(e):this.updateAttrMutable(t,e));s=(s+1)%i}while(s!==n);const o=new dr(t,e);this.push(o),br.put(r,o)}updateAttrMutable(t,e){const r=this.array;for(let i=0,n=this.length;i<n;i+=1){const n=r[i];if(n instanceof hr&&n.key.equals(t))return r[i]=new dr(t,e),void(this.table=null)}const i=new dr(t,e);this.push(i),br.put(this.table,i)}setSlot(t,e){if(0!=(this.flags&mr.ImmutableFlag))throw new Error("immutable");return t=yr.fromAny(t),e=yr.fromAny(e),0!=(this.flags&mr.AliasedFlag)?this.fieldCount>0?this.setSlotAliased(t,e):this.pushAliased(new lr(t,e)):this.fieldCount>0?null!==this.table?this.setSlotMutable(t,e):this.updateSlotMutable(t,e):this.pushMutable(new lr(t,e)),this}setSlotAliased(t,e){const r=this.length,i=this.array,n=new Array(mr.expand(r+1));for(let s=0;s<r;s+=1){const o=i[s];if(o instanceof hr&&o.key.equals(t)){for(n[s]=new lr(t,e),s+=1;s<r;)n[s]=i[s],s+=1;return this.array=n,this.table=null,void(this.flags&=~mr.AliasedFlag)}n[s]=o}n[r]=new lr(t,e),this.array=n,this.table=null,this.length=r+1,this.fieldCount+=1,this.flags&=~mr.AliasedFlag}setSlotMutable(t,e){const r=this.table,i=r.length,n=Math.abs(t.hashCode()%i);let s=n;do{const n=r[s];if(void 0===n)break;if(n.key.equals(t))return void(n instanceof lr&&n.isMutable()?n.setValue(e):this.updateSlotMutable(t,e));s=(s+1)%i}while(s!==n);const o=new lr(t,e);this.push(o),br.put(r,o)}updateSlotMutable(t,e){const r=this.array;for(let i=0,n=this.length;i<n;i+=1){const n=r[i];if(n instanceof hr&&n.key.equals(t))return r[i]=new lr(t,e),void(this.table=null)}const i=new lr(t,e);this.push(i),br.put(this.table,i)}setItem(t,e){if(0!=(this.flags&mr.ImmutableFlag))throw new Error("immutable");e=ar.fromAny(e);const r=this.length;if(t<0&&(t=r+t),t<0||t>r)throw new RangeError(""+t);return 0!=(this.flags&mr.AliasedFlag)?this.setItemAliased(t,e):this.setItemMutable(t,e),this}setItemAliased(t,e){const r=this.length,i=this.array,n=new Array(mr.expand(r));for(let t=0;t<r;t+=1)n[t]=i[t];const s=i[t];n[t]=e,this.array=n,this.table=null,e instanceof hr?s instanceof hr||(this.fieldCount+=1):s instanceof hr&&(this.fieldCount-=1),this.flags&=~mr.AliasedFlag}setItemMutable(t,e){const r=this.array,i=r[t];r[t]=e,e instanceof hr?(this.table=null,i instanceof hr||(this.fieldCount+=1)):i instanceof hr&&(this.table=null,this.fieldCount-=1)}updated(t,e){t=yr.fromAny(t),e=yr.fromAny(e);const r=0==(this.flags&mr.ImmutableFlag)?this:this.branch();return 0!=(r.flags&mr.AliasedFlag)?r.fieldCount>0?r.setAliased(t,e):r.pushAliased(new lr(t,e)):r.fieldCount>0?null!==r.table?r.setMutable(t,e):r.updateMutable(t,e):r.pushMutable(new lr(t,e)),r}updatedAttr(t,e){t=Sr.fromAny(t),e=yr.fromAny(e);const r=0==(this.flags&mr.ImmutableFlag)?this:this.branch();return 0!=(r.flags&mr.AliasedFlag)?r.fieldCount>0?r.setAttrAliased(t,e):r.pushAliased(new dr(t,e)):r.fieldCount>0?null!==r.table?r.setAttrMutable(t,e):r.updateAttrMutable(t,e):r.pushMutable(new dr(t,e)),r}updatedSlot(t,e){t=yr.fromAny(t),e=yr.fromAny(e);const r=0==(this.flags&mr.ImmutableFlag)?this:this.branch();return 0!=(r.flags&mr.AliasedFlag)?r.fieldCount>0?r.setSlotAliased(t,e):r.pushAliased(new lr(t,e)):r.fieldCount>0?null!==r.table?r.setSlotMutable(t,e):r.updateSlotMutable(t,e):r.pushMutable(new lr(t,e)),r}push(...t){if(0!=(this.flags&mr.ImmutableFlag))throw new Error("immutable");return 0!=(this.flags&mr.AliasedFlag)?this.pushAliased(...t):this.pushMutable(...t),this.length}pushAliased(...t){const e=t.length;let r=this.length,i=this.fieldCount;const n=this.array,s=new Array(mr.expand(r+e));if(null!==n)for(let t=0;t<r;t+=1)s[t]=n[t];for(let n=0;n<e;n+=1){const e=ar.fromAny(t[n]);s[r]=e,r+=1,e instanceof hr&&(i+=1)}this.array=s,this.table=null,this.length=r,this.fieldCount=i,this.flags&=~mr.AliasedFlag}pushMutable(...t){const e=t.length;let r=this.length,i=this.fieldCount;const n=this.array;let s;if(null===n||r+e>n.length){if(s=new Array(mr.expand(r+e)),null!==n)for(let t=0;t<r;t+=1)s[t]=n[t]}else s=n;for(let n=0;n<e;n+=1){const e=ar.fromAny(t[n]);s[r]=e,r+=1,e instanceof hr&&(i+=1,this.table=null)}this.array=s,this.length=r,this.fieldCount=i}splice(t,e=0,...r){if(0!=(this.flags&mr.ImmutableFlag))throw new Error("immutable");const i=this.length;return t<0&&(t=i+t),t=Math.min(Math.max(0,t),i),e=Math.min(Math.max(0,e),i-t),0!=(this.flags&mr.AliasedFlag)?this.spliceAliased(t,e,...r):this.spliceMutable(t,e,...r)}spliceAliased(t,e,...r){const i=r.length;let n=this.length,s=this.fieldCount;const o=this.array,a=new Array(mr.expand(n-e+i));for(let e=0;e<t;e+=1)a[e]=o[e];const u=[];for(let r=t;r<t+e;r+=1){const t=o[r];u.push(t),n-=1,t instanceof hr&&(s-=1)}for(let r=t;r<n;r+=1)a[r+i]=o[r+e];for(let e=0;e<i;e+=1){const i=ar.fromAny(r[e]);a[e+t]=i,n+=1,i instanceof hr&&(s+=1)}return this.array=a,this.table=null,this.length=n,this.fieldCount=s,this.flags&=~mr.AliasedFlag,u}spliceMutable(t,e,...r){const i=r.length;let n=this.length,s=this.fieldCount;const o=this.array;let a;if(null===o||n-e+i>o.length){if(a=new Array(mr.expand(n-e+i)),null!==o)for(let e=0;e<t;e+=1)a[e]=o[e]}else a=o;const u=[];for(let r=t;r<t+e;r+=1){const t=o[r];u.push(t),n-=1,t instanceof hr&&(s-=1)}if(i>e)for(let r=n-1;r>=t;r-=1)a[r+i]=o[r+e];else for(let r=t;r<n;r+=1)a[r+i]=o[r+e];for(let e=0;e<i;e+=1){const i=ar.fromAny(r[e]);a[e+t]=i,n+=1,i instanceof hr&&(s+=1)}return this.array=a,this.length=n,this.fieldCount=s,u}delete(t){if(0!=(this.flags&mr.ImmutableFlag))throw new Error("immutable");return t=yr.fromAny(t),0!=(this.flags&mr.AliasedFlag)?this.deleteAliased(t):this.deleteMutable(t)}deleteAliased(t){const e=this.length,r=this.array,i=new Array(mr.expand(e));for(let n=0;n<e;n+=1){const s=r[n];if(s instanceof hr&&s.key.equals(t)){for(let t=n+1;t<e;t+=1,n+=1)i[n]=r[t];return this.array=i,this.table=null,this.length=e-1,this.fieldCount-=1,this.flags&=~mr.AliasedFlag,s}i[n]=s}return ar.absent()}deleteMutable(t){const e=this.length,r=this.array;for(let i=0;i<e;i+=1){const n=r[i];if(n instanceof hr&&n.key.equals(t)){for(let t=i+1;t<e;t+=1,i+=1)r[i]=r[t];return r[e-1]=void 0,this.table=null,this.length=e-1,this.fieldCount-=1,n}}return ar.absent()}clear(){if(0!=(this.flags&mr.ImmutableFlag))throw new Error("immutable");this.array=null,this.table=null,this.length=0,this.fieldCount=0,this.flags=0}isAliased(){return 0!=(this.flags&mr.AliasedFlag)}isMutable(){return 0==(this.flags&mr.ImmutableFlag)}alias(){this.flags|=mr.AliasedFlag}branch(){if(0==(this.flags&(mr.AliasedFlag|mr.ImmutableFlag))){const t=this.array;for(let e=0,r=this.length;e<r;e+=1)t[e].alias()}return this.flags|=mr.AliasedFlag,new br(this.array,this.table,this.length,this.fieldCount,mr.AliasedFlag)}clone(){const t=this.length,e=this.array,r=new Array(t);for(let i=0;i<t;i+=1)r[i]=e[i].clone();return new br(r,null,t,this.fieldCount,0)}commit(){if(0==(this.flags&mr.ImmutableFlag)){this.flags|=mr.ImmutableFlag;const t=this.array;for(let e=0,r=this.length;e<r;e+=1)t[e].commit()}return this}hashTable(){const t=this.fieldCount;let e=this.table;if(0!==t&&null===e){e=new Array(mr.expand(Math.max(t,10*t/7)));const r=this.array;for(let t=0,i=this.length;t<i;t+=1){const i=r[t];i instanceof hr&&br.put(e,i)}this.table=e}return e}static put(t,e){if(null!==t){const r=t.length,i=Math.abs(e.key.hashCode()%r);let n=i;do{const i=t[n];if(void 0===i)return void(t[n]=e);if(e.key.equals(i.key))return void(t[n]=e);n=(n+1)%r}while(n!==i);throw new Error}}evaluate(t){t=Lr.fromAny(t);const e=this.array,r=this.length,i=mr.create(r);t.pushScope(i);let n=!1;for(let s=0;s<r;s+=1){const r=e[s],o=r.evaluate(t);o.isDefined()&&i.push(o),r!==o&&(n=!0)}return t.popScope(),n?i:this}substitute(t){t=Lr.fromAny(t);const e=this.array,r=this.length,i=mr.create(r);t.pushScope(i);let n=!1;for(let s=0;s<r;s+=1){const r=e[s],o=r.substitute(t);o.isDefined()&&i.push(o),r!==o&&(n=!0)}return t.popScope(),n?i:this}subRecord(t,e){const r=this.length;if(void 0===t?t=0:t<0&&(t=r+t),void 0===e?e=r:e<0&&(e=r+e),t<0||e>r||t>e)throw new RangeError(t+", "+e);return new xr(this,t,e)}forEach(t,e){const r=this.array;for(let i=0,n=this.length;i<n;i+=1){const n=t.call(e,r[i],i);if(void 0!==n)return n}}static empty(){return new br(null,null,0,0,mr.AliasedFlag|mr.ImmutableFlag)}static create(t){return void 0===t?new br(null,null,0,0,mr.AliasedFlag):new br(new Array(t),null,0,0,0)}static of(...t){const e=t.length;if(0===e)return new br(null,null,0,0,mr.AliasedFlag);{const r=new Array(e);let i=0,n=0;for(let s=0;s<e;s+=1){const e=ar.fromAny(t[s]);r[s]=e,i+=1,e instanceof hr&&(n+=1)}return new br(r,null,i,n,0)}}}e([s],br,"empty",null);class xr extends mr{constructor(t,e,r){super(),this.record=t,this.lower=e,this.upper=r}isEmpty(){return this.lower===this.upper}isArray(){const t=this.record.array;for(let e=this.lower,r=this.upper;e<r;e+=1)if(t[e]instanceof hr)return!1;return!0}isObject(){const t=this.record.array;for(let e=this.lower,r=this.upper;e<r;e+=1)if(t[e]instanceof yr)return!1;return!0}get length(){return this.upper-this.lower}get valueCount(){let t=0;const e=this.record.array;for(let r=this.lower,i=this.upper;r<i;r+=1)e[r]instanceof yr&&(t+=1);return t}isConstant(){const t=this.record.array;for(let e=this.lower,r=this.upper;e<r;e+=1)if(!t[e].isConstant())return!1;return!0}get tag(){if(this.length>0){const t=this.record.array[this.lower];if(t instanceof dr)return t.key.value}}get target(){let t,e,r=!1;const i=this.record.array;for(let n=this.lower,s=this.upper;n<s;n+=1){const s=i[n];s instanceof dr?r=!0:void 0===t&&s instanceof yr?t=s:(void 0===e&&(e=mr.create(),void 0!==t&&e.push(t)),e.push(s))}return void 0===t?yr.extant():void 0===e?t:r?e:this}head(){return this.length>0?this.record.array[this.lower]:ar.absent()}tail(){return this.length>0?new xr(this.record,this.lower+1,this.upper):mr.empty()}body(){const t=this.length;if(t>2)return new xr(this.record,this.lower+1,this.upper).branch();if(2===t){const t=this.record.array[this.lower+1];return t instanceof yr?t:mr.of(t)}return yr.absent()}indexOf(t,e=0){t=ar.fromAny(t);const r=this.record.array,i=this.length;for(e<0&&(e=Math.max(0,i+e)),e=this.lower+e;e<this.upper;){if(t.equals(r[e]))return e-this.lower;e+=1}return-1}lastIndexOf(t,e){t=ar.fromAny(t);const r=this.record.array,i=this.length;for(void 0===e?e=i-1:e<0&&(e=i+e),e=this.lower+Math.min(e,i-1);e>=this.lower;){if(t.equals(r[e]))return e-this.lower;e-=1}return-1}getItem(t){t instanceof kr&&(t=t.value);const e=this.length;return t<0&&(t=e+t),t>=0&&t<e?this.record.array[this.lower+t]:ar.absent()}setItem(t,e){if(0!=(this.record.flags&mr.ImmutableFlag))throw new Error("immutable");e=ar.fromAny(e);const r=this.length;if(t<0&&(t=r+t),t<0||t>r)throw new RangeError(""+t);return 0!=(this.record.flags&mr.AliasedFlag)?this.setItemAliased(t,e):this.setItemMutable(t,e),this}setItemAliased(t,e){const r=this.record,i=r.length,n=r.array,s=new Array(mr.expand(i));for(let t=0;t<i;t+=1)s[t]=n[t];const o=null!==n?n[this.lower+t]:null;s[this.lower+t]=e,r.array=s,r.table=null,e instanceof hr?o instanceof hr||(r.fieldCount+=1):o instanceof hr&&(r.fieldCount-=1),r.flags&=~mr.AliasedFlag}setItemMutable(t,e){const r=this.record,i=r.array,n=i[this.lower+t];i[this.lower+t]=e,e instanceof hr?(r.table=null,n instanceof hr||(r.fieldCount+=1)):n instanceof hr&&(r.table=null,r.fieldCount-=1)}push(...t){if(0!=(this.record.flags&mr.ImmutableFlag))throw new Error("immutable");return 0!=(this.record.flags&mr.AliasedFlag)?this.pushAliased(...t):this.pushMutable(...t),this.length}pushAliased(...t){const e=this.record,r=t.length;let i=e.length,n=e.fieldCount;const s=e.array,o=new Array(mr.expand(i+r));if(null!==s){for(let t=0;t<this.upper;t+=1)o[t]=s[t];for(let t=this.upper;t<i;t+=1)o[t+r]=s[t]}for(let e=0;e<r;e+=1){const r=ar.fromAny(t[e]);o[e+this.upper]=r,i+=1,r instanceof hr&&(n+=1)}e.array=o,e.table=null,e.length=i,e.fieldCount=n,e.flags&=~mr.AliasedFlag,this.upper+=r}pushMutable(...t){const e=this.record,r=t.length;let i=e.length,n=e.fieldCount;const s=e.array;let o;if(null===s||i+r>s.length){if(o=new Array(mr.expand(i+r)),null!==s)for(let t=0;t<this.upper;t+=1)o[t]=s[t]}else o=s;for(let t=i-1;t>=this.upper;t-=1)o[t+r]=s[t];for(let s=0;s<r;s+=1){const r=ar.fromAny(t[s]);o[s+this.upper]=r,i+=1,r instanceof hr&&(n+=1,e.table=null)}e.array=o,e.length=i,e.fieldCount=n,this.upper+=r}splice(t,e=0,...r){if(0!=(this.record.flags&mr.ImmutableFlag))throw new Error("immutable");const i=this.length;let n;return t<0&&(t=i+t),t=Math.min(Math.max(0,t),i),e=Math.min(Math.max(0,e),i-t),n=0!=(this.record.flags&mr.AliasedFlag)?this.record.spliceAliased(this.lower+t,e,...r):this.record.spliceMutable(this.lower+t,e,...r),this.upper+=r.length-n.length,n}delete(t){if(0!=(this.record.flags&mr.ImmutableFlag))throw new Error("immutable");return t=yr.fromAny(t),0!=(this.record.flags&mr.AliasedFlag)?this.deleteAliased(t):this.deleteMutable(t)}deleteAliased(t){const e=this.record,r=e.length,i=e.array,n=new Array(mr.expand(r));for(let s=this.lower;s<this.upper;s+=1){const o=i[s];if(o instanceof hr&&o.key.equals(t)){for(let t=s+1;t<r;t+=1,s+=1)n[s]=i[t];return e.array=n,e.table=null,e.length=r-1,e.fieldCount-=1,e.flags&=~mr.AliasedFlag,this.upper-=1,o}n[s]=o}return ar.absent()}deleteMutable(t){const e=this.record,r=e.length,i=e.array;for(let n=this.lower;n<this.upper;n+=1){const s=i[n];if(s instanceof hr&&s.key.equals(t)){for(let t=n+1;t<r;t+=1,n+=1)i[n]=i[t];return i[r-1]=void 0,e.table=null,e.length=r-1,e.fieldCount-=1,this.upper-=1,s}}return ar.absent()}clear(){if(0!=(this.record.flags&mr.ImmutableFlag))throw new Error("immutable");0!=(this.record.flags&mr.AliasedFlag)?this.clearAliased():this.clearMutable()}clearAliased(){const t=this.record,e=t.length;let r=t.fieldCount;const i=e-this.length,n=t.array,s=new Array(mr.expand(i));let o=0;for(;o<this.lower;)s[o]=n[o],o+=1;for(;o<this.upper;)n[o]instanceof hr&&(r-=1),o+=1;o=this.lower;let a=this.upper;for(;a<e;)s[o]=n[a],o+=1,a+=1;t.array=s,t.table=null,t.length=i,t.fieldCount=r,t.flags&=~mr.AliasedFlag,this.upper=this.lower}clearMutable(){const t=this.record,e=t.length;let r=t.fieldCount;const i=t.array;let n=this.lower;for(;n<this.upper;)i[n]instanceof hr&&(r-=1),n+=1;n=this.lower;let s=this.upper;for(;s<e;){const e=i[s];e instanceof hr&&(t.table=null),i[n]=e,n+=1,s+=1}for(t.length=n,t.fieldCount=r;n<e;)i[n]=void 0,n+=1;this.upper=this.lower}isAliased(){return 0!=(this.record.flags&mr.AliasedFlag)}isMutable(){return 0==(this.record.flags&mr.ImmutableFlag)}alias(){this.record.flags|=mr.AliasedFlag}branch(){const t=this.length;let e=0;const r=this.record.array,i=new Array(mr.expand(t));let n=this.lower,s=0;for(;s<t;){const t=r[n];i[s]=t,t instanceof hr&&(e+=1),n+=1,s+=1}return new br(i,null,t,e,0)}clone(){const t=this.length;let e=0;const r=this.record.array,i=new Array(mr.expand(t));let n=this.lower,s=0;for(;s<t;){const t=r[n];i[s]=t.clone(),t instanceof hr&&(e+=1),n+=1,s+=1}return new br(i,null,t,e,0)}commit(){return this.record.commit(),this}subRecord(t,e){const r=this.length;if(void 0===t?t=0:t<0&&(t=r+t),void 0===e?e=r:e<0&&(e=r+e),t<0||e>r||t>e)throw new RangeError(t+", "+e);return new xr(this.record,this.lower+t,this.upper+e)}forEach(t,e){const r=this.record.array;for(let i=this.lower,n=this.upper;i<n;i+=1){const n=t.call(e,r[i],i);if(void 0!==n)return n}}}Object.defineProperty(xr.prototype,"fieldCount",{get(){const t=this.record.array;let e=0;for(let r=this.lower,i=this.upper;r<i;r+=1)t[r]instanceof hr&&(e+=1);return e},configurable:!0});class Cr extends yr{constructor(t,e,r){super(),this.array=t,this.size=e,this.flags=r}isConstant(){return!0}getByte(t){if(t<0||t>=this.size)throw new RangeError(""+t);return this.array[t]}setByte(t,e){const r=this.flags;if(0!=(r&Cr.ImmutableFlag))throw new Error("immutable");if(t<0||t>=this.size)throw new RangeError(""+t);return 0!=(r&Cr.AliasedFlag)?this.setByteAliased(t,e):this.setByteMutable(t,e)}setByteAliased(t,e){const r=this.size,i=this.array,n=new Uint8Array(Cr.expand(r));return n.set(i,0),n[t]=e,this.array=n,this.flags&=~Cr.AliasedFlag,this}setByteMutable(t,e){return this.array[t]=e,this}addByte(t){const e=this.flags;if(0!=(e&Cr.ImmutableFlag))throw new Error("immutable");return 0!=(e&Cr.AliasedFlag)?this.addByteAliased(t):this.addByteMutable(t)}addByteAliased(t){const e=this.size,r=this.array,i=new Uint8Array(Cr.expand(e+1));return null!==r&&i.set(r,0),i[e]=t,this.array=i,this.size=e+1,this.flags&=~Cr.AliasedFlag,this}addByteMutable(t){const e=this.size,r=this.array;let i;return null===r||e+1>r.length?(i=new Uint8Array(Cr.expand(e+1)),null!==r&&i.set(r,0),this.array=i):i=r,i[e]=t,this.size=e+1,this}addData(t){let e=t.array;if(null!==e){const r=t.size;return e.length>r&&(e=e.slice(0,r)),this.addUint8Array(e)}return this}addUint8Array(t){const e=this.flags;if(0!=(e&Cr.ImmutableFlag))throw new Error("immutable");return 0!=(e&Cr.AliasedFlag)?this.addUint8ArrayAliased(t):this.addUint8ArrayMutable(t)}addUint8ArrayAliased(t){const e=t.length;if(0===e)return this;const r=this.size,i=this.array,n=new Uint8Array(Cr.expand(r+e));return null!==i&&n.set(i,0),n.set(t,r),this.array=n,this.size=r+e,this.flags&=~Cr.AliasedFlag,this}addUint8ArrayMutable(t){const e=t.length;if(0===e)return this;const r=this.size,i=this.array;let n;return null===i||r+e>i.length?(n=new Uint8Array(Cr.expand(r+e)),null!==i&&n.set(i,0),this.array=n):n=i,n.set(t,r),this.size=r+e,this}clear(){if(0!=(this.flags&Cr.ImmutableFlag))throw new Error("immutable");this.array=null,this.size=0,this.flags=Cr.AliasedFlag}toUint8Array(){const t=this.array,e=this.flags;if(0!=(e&Cr.ImmutableFlag))return null!==t?t.slice(0):new Uint8Array(0);if(0!=(e&Cr.AliasedFlag)||this.size!==t.length){const e=null!==t?t.slice(0):new Uint8Array(0);return this.array=e,this.flags&=~Cr.AliasedFlag,e}return t}asUint8Array(){let t;return null!==this.array&&this.size>0?(t=this.array,t.length!==this.size&&(t=new Uint8Array(t.buffer,t.byteOffset,this.size))):t=void 0,t}toAny(){return this.toUint8Array()}isAliased(){return 0!=(this.flags&Cr.AliasedFlag)}isMutable(){return 0==(this.flags&Cr.ImmutableFlag)}branch(){return this.flags|=Cr.AliasedFlag,new Cr(this.array,this.size,Cr.AliasedFlag)}clone(){return this.branch()}commit(){return this.flags|=Cr.ImmutableFlag,this}writeBase16(t,e=te.uppercase){let r=this.array;const i=this.size;return null!==r&&0!==i?(r.length!==i&&(r=r.slice(0,i)),e.writeUint8Array(t,r)):bt.end()}toBase16(t=te.uppercase){const e=Ct.stringOutput();return this.writeBase16(e,t).bind(),e.bind()}writeBase64(t,e=le.standard()){let r=this.array;const i=this.size;return null!==r&&0!==i?(r.length!==i&&(r=r.slice(0,i)),e.writeUint8Array(t,r)):bt.end()}toBase64(t=le.standard()){const e=Ct.stringOutput();return this.writeBase64(e,t),e.bind()}interpolateTo(t){return super.interpolateTo(t)}get typeOrder(){return 4}compareTo(t){if(t instanceof Cr){const e=this.array,r=t.array,i=this.size,n=t.size;let s=0,o=0;do{if(!(o<i&&o<n))break;s=e[o]-r[o],o+=1}while(0===s);return s>0?1:s<0?-1:i>n?1:i<n?-1:0}return t instanceof ar?h.compare(this.typeOrder,t.typeOrder):NaN}equivalentTo(t){return this.equals(t)}equals(t){if(this===t)return!0;if(t instanceof Cr){const e=this.array,r=t.array,i=this.size;if(i!==t.size)return!1;for(let t=0;t<i;t+=1)if(e[t]!==r[t])return!1;return!0}return!1}hashCode(){return n.mash(n.mixUint8Array(p.hash(Cr),null!==this.array?this.array:new Uint8Array(0)))}debug(t){if(t=t.write("Data").write(46),0===this.size)t=t.write("empty").write(40).write(41);else{t=t.write("base16").write(40).write(34);const e=this.writeBase16(t);if(!e.isDone())return wt.error(e.trap());t=t.write(34).write(41)}return t}static empty(){return new Cr(null,0,Cr.AliasedFlag|Cr.ImmutableFlag)}static create(t){return void 0===t?new Cr(null,0,Cr.AliasedFlag):new Cr(new Uint8Array(t),0,0)}static wrap(t){return new Cr(t,t.length,Cr.AliasedFlag)}static fromBase16(t){return"string"==typeof t&&(t=Ct.stringInput(t)),te.parse(t,Cr.output()).bind()}static fromBase64(t,e=le.standard()){return"string"==typeof t&&(t=Ct.stringInput(t)),e.parse(t,Cr.output()).bind()}static fromAny(t){if(t instanceof Cr)return t;if(t instanceof Uint8Array)return Cr.wrap(t);throw new TypeError(""+t)}static random(t){const e=new Uint8Array(t);return r.fillBytes(e),Cr.wrap(e)}static output(t){return t instanceof Cr||(t=Cr.create(t)),new Or(t,lt.standard())}static expand(t){return t=Math.max(32,t)-1,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,(t|=t>>16)+1}}Cr.AliasedFlag=1,Cr.ImmutableFlag=2,e([s],Cr,"empty",null);class Or extends wt{constructor(t,e){super(),this.data=t,this.settings=e}isCont(){return!0}isFull(){return!1}isDone(){return!1}isError(){return!1}isPart(){return!1}asPart(t){return this}write(t){if("number"==typeof t)return this.data.addByte(t),this;throw new TypeError(""+t)}writeln(t){throw new TypeError(""+t)}withSettings(t){return t=lt.fromAny(t),this.settings=t,this}bind(){return this.data}clone(){return new Or(this.data.branch(),this.settings)}}class Sr extends yr{constructor(t){super(),this.value=t,this.hashValue=void 0}isConstant(){return!0}get size(){return this.value.length}stringValue(t){return this.value}numberValue(t){try{return kr.parse(this.value).numberValue()}catch(e){return t}}booleanValue(t){return"true"===this.value||"false"!==this.value&&t}toAny(){return this.value}valueOf(){return this.value}plus(t){return(t=ar.fromAny(t))instanceof Sr?Sr.from(this.value+t.value):super.plus(t)}branch(){return this}clone(){return this}commit(){return this}interpolateTo(t){return super.interpolateTo(t)}get typeOrder(){return 5}compareTo(t){return t instanceof Sr?this.value.localeCompare(t.value):t instanceof ar?h.compare(this.typeOrder,t.typeOrder):NaN}equivalentTo(t){return this.equals(t)}equals(t){return this===t||t instanceof Sr&&this.value===t.value}hashCode(){let t=this.hashValue;return void 0===t&&(t=l.hash(this.value),this.hashValue=t),t}debug(t){return t=t.write("Text").write(46),t=0===this.value.length?t.write("empty").write(40).write(41):t.write("from").write(40).debug(this.value).write(41)}display(t){return Ot.debugAny(t,this.value)}toString(){return this.value}static empty(){return new Sr("")}static from(t){const e=t.length;if(0===e)return Sr.empty();{let r=new Sr(t);return e<=64&&(r=Sr.cache.put(r)),r}}static fromAny(t){if(t instanceof Sr)return t;if("string"==typeof t)return Sr.from(t);throw new TypeError(""+t)}static output(t){return void 0===t&&(t=lt.standard()),new Er("",t)}static get cache(){return new et(128)}}e([s],Sr,"empty",null),e([s],Sr,"cache",null);class Er extends wt{constructor(t,e){super(),this.string=t,this.settings=e}isCont(){return!0}isFull(){return!1}isDone(){return!1}isError(){return!1}isPart(){return!1}asPart(t){return this}write(t){if("number"==typeof t)if(t>=0&&t<=55295||t>=57344&&t<=65535)t=String.fromCharCode(t);else if(t>=65536&&t<=1114111){const e=t-65536;t=String.fromCharCode(55296|e>>>10,56320|1023&e)}else t="";return this.string+=t,this}withSettings(t){return t=lt.fromAny(t),this.settings=t,this}bind(){return Sr.from(this.string)}clone(){return new Er(this.string,this.settings)}toString(){return this.string}}class kr extends yr{constructor(t,e){super(),this.value=t,this.flags=void 0!==e?e:0}isConstant(){return!0}isNaN(){return isNaN(this.value)}isInfinite(){return!isNaN(this.value)&&!isFinite(this.value)}isUint32(){return 0!=(this.flags&kr.Uint32Flag)}isUint64(){return 0!=(this.flags&kr.Uint64Flag)}stringValue(t){return""+this.value}numberValue(t){return this.value}booleanValue(t){return!!this.value}toAny(){return this.value}valueOf(){return this.value}bitwiseOr(t){return(t=ar.fromAny(t))instanceof kr?kr.from((this.value|t.value)>>>0):super.bitwiseOr(t)}bitwiseXor(t){return(t=ar.fromAny(t))instanceof kr?kr.from((this.value^t.value)>>>0):super.bitwiseXor(t)}bitwiseAnd(t){return(t=ar.fromAny(t))instanceof kr?kr.from((this.value&t.value)>>>0):super.bitwiseAnd(t)}plus(t){return(t=ar.fromAny(t))instanceof kr?kr.from(this.value+t.value):super.plus(t)}minus(t){return(t=ar.fromAny(t))instanceof kr?kr.from(this.value-t.value):super.minus(t)}times(t){return(t=ar.fromAny(t))instanceof kr?kr.from(this.value*t.value):super.times(t)}divide(t){return(t=ar.fromAny(t))instanceof kr?kr.from(this.value/t.value):super.divide(t)}modulo(t){return(t=ar.fromAny(t))instanceof kr?kr.from(this.value%t.value):super.modulo(t)}bitwiseNot(){return kr.from(~this.value>>>0)}negative(){return kr.from(-this.value)}positive(){return this}inverse(){return kr.from(1/this.value)}abs(){return kr.from(Math.abs(this.value))}ceil(){return kr.from(Math.ceil(this.value))}floor(){return kr.from(Math.floor(this.value))}round(){return kr.from(Math.round(this.value))}sqrt(){return kr.from(Math.sqrt(this.value))}pow(t){return t=kr.fromAny(t),kr.from(Math.pow(this.value,t.value))}max(t){return this.compareTo(t)>=0?this:t}min(t){return this.compareTo(t)<=0?this:t}interpolateTo(t){return t instanceof kr?Ar(this,t):super.interpolateTo(t)}get typeOrder(){return 6}compareTo(t){if(t instanceof kr){const e=this.value,r=t.value;return e<r?-1:e>r?1:isNaN(r)?isNaN(e)?0:-1:isNaN(e)?1:0}return t instanceof ar?h.compare(this.typeOrder,t.typeOrder):NaN}equivalentTo(t,e){if(this===t)return!0;if(t instanceof kr){const r=this.value,i=t.value;return r===i||isNaN(r)&&isNaN(i)||Math.abs(i-r)<(void 0!==e?e:u.Epsilon)}return!1}equals(t){if(this===t)return!0;if(t instanceof kr){const e=this.value,r=t.value;return e===r||isNaN(e)&&isNaN(r)}return!1}hashCode(){return h.hash(this.value)}debug(t){return t=t.write("Num").write(46).write("from").write(40).display(this).write(41)}display(t){return Ot.displayNumber(t,this.value)}static get zero(){return new kr(0)}static get negativeZero(){return new kr(-0)}static get one(){return new kr(1)}static get negativeOne(){return new kr(-1)}static get nan(){return new kr(NaN)}static uint32(t){return new kr(t,kr.Uint32Flag)}static uint64(t){return new kr(t,kr.Uint64Flag)}static from(t){return 0===t?1/t==-1/0?kr.negativeZero:kr.zero:1===t?kr.one:-1===t?kr.negativeOne:isNaN(t)?kr.nan:kr.cache.put(new kr(t))}static fromAny(t){if(t instanceof kr)return t;if("number"==typeof t)return kr.from(t);throw new TypeError(""+t)}static parse(t){if("NaN"===t)return kr.nan;{const e=+t;if(isFinite(e))return kr.from(e)}throw new Error(t)}static get cache(){return new et(128)}}kr.Uint32Flag=1,kr.Uint64Flag=2,kr.TypeMask=3,e([s],kr,"zero",null),e([s],kr,"negativeZero",null),e([s],kr,"one",null),e([s],kr,"negativeOne",null),e([s],kr,"nan",null),e([s],kr,"cache",null);const Ar=function(t){const e=function(t,r){const i=function(t){const e=i[0].value,r=i[1].value;return kr.from(e+t*(r-e))};return Object.setPrototypeOf(i,e.prototype),i[0]=t,i[1]=r,i};return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e}(k);class Mr extends yr{constructor(t){super(),Object.defineProperty(this,"value",{value:t,enumerable:!0}),Object.defineProperty(this,"hashValue",{value:l.hash(t?"true":"false")})}isDefinite(){return this.value}isConstant(){return!0}stringValue(t){return this.value?"true":"false"}booleanValue(t){return this.value}toAny(){return this.value}valueOf(){return this.value}conditional(t,e){return this.value?ar.fromAny(t):ar.fromAny(e)}or(t){return this.value?this:ar.fromAny(t)}and(t){return this.value?ar.fromAny(t):this}not(){return Mr.from(!this.value)}get typeOrder(){return 7}compareTo(t){return t instanceof Mr?this.value&&!t.value?-1:!this.value&&t.value?1:0:t instanceof ar?h.compare(this.typeOrder,t.typeOrder):NaN}equivalentTo(t){return this.equals(t)}equals(t){return this===t||t instanceof Mr&&this.value===t.value}hashCode(){return this.hashValue}debug(t){return t=t.write("Bool").write(46).write("from").write(40).write(this.value?"true":"false").write(41)}display(t){return t=t.write(this.value?"true":"false")}static get true(){return new Mr(!0)}static get false(){return new Mr(!1)}static from(t){return t?Mr.true:Mr.false}static fromAny(t){if(t instanceof Mr)return t;if("boolean"==typeof t)return Mr.from(t);throw new TypeError(""+t)}}e([s],Mr,"true",null),e([s],Mr,"false",null);class Dr extends yr{constructor(){super()}isDefined(){return!0}isDistinct(){return!1}isDefinite(){return!1}isConstant(){return!0}unflattened(){return mr.empty()}not(){return yr.absent()}stringValue(t){return""}booleanValue(t){return!0}toAny(){return null}interpolateTo(t){return super.interpolateTo(t)}get typeOrder(){return 98}compareTo(t){return t instanceof ar?h.compare(this.typeOrder,t.typeOrder):NaN}equivalentTo(t){return this===t}equals(t){return this===t}hashCode(){return p.hash(Dr)}debug(t){return t=t.write("Value").write(46).write("extant").write(40).write(41)}display(t){return t=t.write("null")}static extant(){return new Dr}static fromAny(t){if(t instanceof Dr)return t;if(null===t)return Dr.extant();throw new TypeError(""+t)}}e([s],Dr,"extant",null);class Ir extends yr{constructor(){super()}isDefined(){return!1}isDistinct(){return!1}isDefinite(){return!1}isConstant(){return!0}unflattened(){return mr.empty()}updated(t,e){return mr.of(lr.of(t,e))}updatedAttr(t,e){return mr.of(dr.of(t,e))}updatedSlot(t,e){return mr.of(lr.of(t,e))}appended(...t){return mr.of(t)}prepended(...t){return mr.of(t)}concat(...t){const e=mr.create();for(let r=0,i=t.length;r<i;r+=1)ar.fromAny(t[r]).forEach((function(t){e.push(t)}));return e}conditional(t,e){return ar.fromAny(e)}or(t){return ar.fromAny(t)}and(t){return this}not(){return yr.extant()}booleanValue(t){return!1}toAny(){}forEach(t,e){}iterator(){return _.empty()}interpolateTo(t){return super.interpolateTo(t)}get typeOrder(){return 99}compareTo(t){return t instanceof ar?h.compare(this.typeOrder,t.typeOrder):NaN}equivalentTo(t){return this===t}equals(t){return this===t}hashCode(){return p.hash(Ir)}debug(t){return t=t.write("Value").write(46).write("absent").write(40).write(41)}display(t){return t=t.write("undefined")}static absent(){return new Ir}static fromAny(t){if(t instanceof Ir)return t;if(void 0===t)return Ir.absent();throw new TypeError(""+t)}}e([s],Ir,"absent",null);class Pr extends yr{constructor(){super()}conditional(t,e){return t=ar.fromAny(t),e=ar.fromAny(e),new Rr(this,t,e)}or(t){return t=ar.fromAny(t),new Kr(this,t)}and(t){return t=ar.fromAny(t),new Br(this,t)}bitwiseOr(t){return t=ar.fromAny(t),new Wr(this,t)}bitwiseXor(t){return t=ar.fromAny(t),new Hr(this,t)}bitwiseAnd(t){return t=ar.fromAny(t),new Xr(this,t)}lt(t){return t=ar.fromAny(t),new Yr(this,t)}le(t){return t=ar.fromAny(t),new Gr(this,t)}eq(t){return t=ar.fromAny(t),new _r(this,t)}ne(t){return t=ar.fromAny(t),new Qr(this,t)}ge(t){return t=ar.fromAny(t),new Zr(this,t)}gt(t){return t=ar.fromAny(t),new Jr(this,t)}plus(t){return t=ar.fromAny(t),new $r(this,t)}minus(t){return t=ar.fromAny(t),new ti(this,t)}times(t){return t=ar.fromAny(t),new ei(this,t)}divide(t){return t=ar.fromAny(t),new ri(this,t)}modulo(t){return t=ar.fromAny(t),new ii(this,t)}not(){return new ni(this)}bitwiseNot(){return new si(this)}negative(){return new oi(this)}positive(){return new ai(this)}inverse(){return new ri(kr.one,this)}toAny(){return this}}class Tr extends Pr{constructor(){super()}static binary(t,e,r){switch(e){case"||":return new Kr(t,r);case"&&":return new Br(t,r);case"|":return new Wr(t,r);case"^":return new Hr(t,r);case"&":return new Xr(t,r);case"<":return new Yr(t,r);case"<=":return new Gr(t,r);case"==":return new _r(t,r);case"!=":return new Qr(t,r);case">=":return new Zr(t,r);case">":return new Jr(t,r);case"+":return new $r(t,r);case"-":return new ti(t,r);case"*":return new ei(t,r);case"/":return new ri(t,r);case"%":return new ii(t,r);default:throw new Error(e)}}static unary(t,e){switch(t){case"!":return new ni(e);case"~":return new si(e);case"-":return new oi(e);case"+":return new ai(e);default:throw new Error(t)}}}class Vr extends Tr{constructor(t,e){super(),this.operand1=t,this.operand2=e}isConstant(){return this.operand1.isConstant()&&this.operand2.isConstant()}interpolateTo(t){return t instanceof Vr&&this.operator===t.operator?Fr(this,t):super.interpolateTo(t)}}const Fr=function(t){const e=function(t,r){const i=t.operator;if(i!==r.operator)throw new Error;const n=function(t){const e=n.operand1Interpolator(t),r=n.operand2Interpolator(t);return Tr.binary(e,n.operator,r)};return Object.setPrototypeOf(n,e.prototype),n.operand1Interpolator=t.operand1.interpolateTo(r.operand1),n.operator=i,n.operand2Interpolator=t.operand2.interpolateTo(r.operand2),n};return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,Object.defineProperty(e.prototype,0,{get(){const t=this.operand1Interpolator[0],e=this.operand2Interpolator[0];return Tr.binary(t,this.operator,e)},configurable:!0}),Object.defineProperty(e.prototype,1,{get(){const t=this.operand1Interpolator[1],e=this.operand2Interpolator[1];return Tr.binary(t,this.operator,e)},configurable:!0}),e.prototype.equals=function(t){return this===t||t instanceof e&&(this.operator===t.operator&&this.operand1Interpolator.equals(t.operand1Interpolator)&&this.operand2Interpolator.equals(t.operand2Interpolator))},e}(k);class qr extends Tr{constructor(t){super(),this.operand=t}isConstant(){return this.operand.isConstant()}interpolateTo(t){return t instanceof qr&&this.operator===t.operator?Ur(this,t):super.interpolateTo(t)}}const Ur=function(t){const e=function(t,r){const i=t.operator;if(i!==r.operator)throw new Error;const n=function(t){const e=n.operandInterpolator(t);return Tr.unary(n.operator,e)};return Object.setPrototypeOf(n,e.prototype),n.operator=i,n.operandInterpolator=t.operand.interpolateTo(r.operand),n};return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,Object.defineProperty(e.prototype,0,{get(){const t=this.operandInterpolator[0];return Tr.unary(this.operator,t)},configurable:!0}),Object.defineProperty(e.prototype,1,{get(){const t=this.operandInterpolator[1];return Tr.unary(this.operator,t)},configurable:!0}),e.prototype.equals=function(t){return this===t||t instanceof e&&(this.operator===t.operator&&this.operandInterpolator.equals(t.operandInterpolator))},e}(k);class Rr extends Tr{constructor(t,e,r){super(),this.ifTerm=t.commit(),this.thenTerm=e.commit(),this.elseTerm=r.commit()}isConstant(){return this.ifTerm.isConstant()&&this.thenTerm.isConstant()&&this.elseTerm.isConstant()}get precedence(){return 2}evaluate(t){let e;(t=Lr.fromAny(t)).willOperate(this);if(this.ifTerm.evaluate(t).isDefinite()){e=this.thenTerm.evaluate(t)}else{e=this.elseTerm.evaluate(t)}return t.didOperate(this,e),e}substitute(t){t=Lr.fromAny(t);const e=this.ifTerm.substitute(t),r=this.thenTerm.substitute(t),i=this.elseTerm.substitute(t);return new Rr(e,r,i)}interpolateTo(t){return t instanceof Rr?Nr(this,t):super.interpolateTo(t)}get typeOrder(){return 20}compareTo(t){if(t instanceof Rr){let e=this.ifTerm.compareTo(t.ifTerm);return 0===e&&(e=this.thenTerm.compareTo(t.thenTerm),0===e&&(e=this.elseTerm.compareTo(t.elseTerm))),e}return t instanceof ar?h.compare(this.typeOrder,t.typeOrder):NaN}equivalentTo(t,e){return this===t||t instanceof Rr&&(this.ifTerm.equivalentTo(t.ifTerm,e)&&this.thenTerm.equivalentTo(t.thenTerm,e)&&this.elseTerm.equivalentTo(t.elseTerm,e))}equals(t){return this===t||t instanceof Rr&&(this.ifTerm.equals(t.ifTerm)&&this.thenTerm.equals(t.thenTerm)&&this.elseTerm.equals(t.elseTerm))}hashCode(){return n.mash(n.mix(n.mix(n.mix(p.hash(Rr),this.ifTerm.hashCode()),this.thenTerm.hashCode()),this.elseTerm.hashCode()))}debug(t){return t=t.debug(this.ifTerm).write(46).write("conditional").write(40).debug(this.thenTerm).write(44).write(32).debug(this.elseTerm).write(41)}clone(){return new Rr(this.ifTerm.clone(),this.thenTerm.clone(),this.elseTerm.clone())}}const Nr=function(t){const e=function(t,r){const i=function(t){const e=i.ifTermInterpolator(t),r=i.thenTermInterpolator(t),n=i.elseTermInterpolator(t);return new Rr(e,r,n)};return Object.setPrototypeOf(i,e.prototype),i.ifTermInterpolator=t.ifTerm.interpolateTo(r.ifTerm),i.thenTermInterpolator=t.thenTerm.interpolateTo(r.thenTerm),i.elseTermInterpolator=t.elseTerm.interpolateTo(r.elseTerm),i};return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,Object.defineProperty(e.prototype,0,{get(){const t=this.ifTermInterpolator[0],e=this.thenTermInterpolator[0],r=this.elseTermInterpolator[0];return new Rr(t,e,r)},configurable:!0}),Object.defineProperty(e.prototype,1,{get(){const t=this.ifTermInterpolator[1],e=this.thenTermInterpolator[1],r=this.elseTermInterpolator[1];return new Rr(t,e,r)},configurable:!0}),e.prototype.equals=function(t){return this===t||t instanceof e&&(this.ifTermInterpolator.equals(t.ifTermInterpolator)&&this.thenTermInterpolator.equals(t.thenTermInterpolator)&&this.elseTermInterpolator.equals(t.elseTermInterpolator))},e}(k);class zr extends Error{constructor(t){super(t),Object.setPrototypeOf(this,zr.prototype)}}class jr{constructor(t){Object.defineProperty(this,"maxScopeDepth",{value:t,enumerable:!0})}withMaxScopeDepth(t){return this.copy(t)}copy(t){return new jr(t)}canEqual(t){return t instanceof jr}equals(t){return this===t||t instanceof jr&&(t.canEqual(this)&&this.maxScopeDepth===t.maxScopeDepth)}hashCode(){return n.mash(n.mix(p.hash(jr),h.hash(this.maxScopeDepth)))}debug(t){return t=t.write("new").write(32).write("InterpreterSettings").write(40).debug(this.maxScopeDepth).write(41)}toString(){return Ot.debug(this)}static standard(){return new jr(1024)}}e([s],jr,"standard",null);class Lr{constructor(t,e,r){this.settings=void 0!==t?t:jr.standard(),this.scopeStack=void 0!==e?e:null,this.scopeDepth=void 0!==r?r:0}withSettings(t){return this.settings=t,this}peekScope(){const t=this.scopeDepth;if(t<=0)throw new zr("scope stack empty");return this.scopeStack[t-1]}getScope(t){if(t<0||t>=this.scopeDepth)throw new RangeError(""+t);return this.scopeStack[t]}pushScope(t){const e=this.scopeDepth;if(e>=this.settings.maxScopeDepth)throw new zr("scope stack overflow");const r=this.scopeStack;let i;if(null===r||e+1>r.length){if(i=new Array(Lr.expand(e+1)),null!==r)for(let t=0;t<e;t+=1)i[t]=r[t];this.scopeStack=i}else i=r;i[e]=t,this.scopeDepth+=1}popScope(){const t=this.scopeDepth;if(t<=0)throw new zr("scope stack empty");const e=this.scopeStack,r=e[t-1];return e[t-1]=void 0,this.scopeDepth-=1,r}swapScope(t){const e=this.scopeDepth;if(e<=0)throw new zr("scope stack empty");const r=this.scopeStack,i=r[e-1];return r[e-1]=t,i}willOperate(t){}didOperate(t,e){}willSelect(t){}didSelect(t,e){}willTransform(t){}didTransform(t,e){}static of(...t){const e=t.length,r=new Array(Lr.expand(e));for(let i=0;i<e;i+=1){const e=ar.fromAny(t[i]);r[i]=e}return new Lr(jr.standard(),r,e)}static fromAny(t,e=ar.globalScope()){if(!(t instanceof Lr)){const r=t;t=new Lr,void 0!==e&&t.pushScope(e),void 0!==r&&t.pushScope(ar.fromAny(r))}return t}static expand(t){return t=Math.max(32,t)-1,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,(t|=t>>16)+1}}class Kr extends Vr{constructor(t,e){super(t,e)}get operator(){return"||"}get precedence(){return 3}evaluate(t){let e;(t=Lr.fromAny(t)).willOperate(this);const r=this.operand1.evaluate(t);if(r.isDefinite())e=r;else{e=this.operand2.evaluate(t)}return t.didOperate(this,e),e}substitute(t){t=Lr.fromAny(t);const e=this.operand1.substitute(t),r=this.operand2.substitute(t);return e.or(r)}get typeOrder(){return 21}compareTo(t){if(t instanceof Kr){let e=this.operand1.compareTo(t.operand1);return 0===e&&(e=this.operand2.compareTo(t.operand2)),e}return t instanceof ar?h.compare(this.typeOrder,t.typeOrder):NaN}equivalentTo(t,e){return this===t||t instanceof Kr&&(this.operand1.equivalentTo(t.operand1,e)&&this.operand2.equivalentTo(t.operand2,e))}equals(t){return this===t||t instanceof Kr&&(this.operand1.equals(t.operand1)&&this.operand2.equals(t.operand2))}hashCode(){return n.mash(n.mix(n.mix(p.hash(Kr),this.operand1.hashCode()),this.operand2.hashCode()))}debug(t){return t=t.debug(this.operand1).write(46).write("or").write(40).debug(this.operand2).write(41)}clone(){return new Kr(this.operand1.clone(),this.operand2.clone())}}class Br extends Vr{constructor(t,e){super(t,e)}get operator(){return"&&"}get precedence(){return 4}evaluate(t){let e;(t=Lr.fromAny(t)).willOperate(this);const r=this.operand1.evaluate(t);if(r.isDefinite()){e=this.operand2.evaluate(t)}else e=r;return t.didOperate(this,e),e}substitute(t){t=Lr.fromAny(t);const e=this.operand1.substitute(t),r=this.operand2.substitute(t);return e.and(r)}get typeOrder(){return 22}compareTo(t){if(t instanceof Br){let e=this.operand1.compareTo(t.operand1);return 0===e&&(e=this.operand2.compareTo(t.operand2)),e}return t instanceof ar?h.compare(this.typeOrder,t.typeOrder):NaN}equivalentTo(t,e){return this===t||t instanceof Br&&(this.operand1.equivalentTo(t.operand1,e)&&this.operand2.equivalentTo(t.operand2,e))}equals(t){return this===t||t instanceof Br&&(this.operand1.equals(t.operand1)&&this.operand2.equals(t.operand2))}hashCode(){return n.mash(n.mix(n.mix(p.hash(Br),this.operand1.hashCode()),this.operand2.hashCode()))}debug(t){return t=t.debug(this.operand1).write(46).write("and").write(40).debug(this.operand2).write(41)}clone(){return new Br(this.operand1.clone(),this.operand2.clone())}}class Wr extends Vr{constructor(t,e){super(t,e)}get operator(){return"|"}get precedence(){return 5}evaluate(t){(t=Lr.fromAny(t)).willOperate(this);const e=this.operand1.evaluate(t),r=this.operand2.evaluate(t),i=e.bitwiseOr(r);return t.didOperate(this,i),i}substitute(t){t=Lr.fromAny(t);const e=this.operand1.substitute(t),r=this.operand2.substitute(t);return e.bitwiseOr(r)}get typeOrder(){return 23}compareTo(t){if(t instanceof Wr){let e=this.operand1.compareTo(t.operand1);return 0===e&&(e=this.operand2.compareTo(t.operand2)),e}return t instanceof ar?h.compare(this.typeOrder,t.typeOrder):NaN}equivalentTo(t,e){return this===t||t instanceof Wr&&(this.operand1.equivalentTo(t.operand1,e)&&this.operand2.equivalentTo(t.operand2,e))}equals(t){return this===t||t instanceof Wr&&(this.operand1.equals(t.operand1)&&this.operand2.equals(t.operand2))}hashCode(){return n.mash(n.mix(n.mix(p.hash(Wr),this.operand1.hashCode()),this.operand2.hashCode()))}debug(t){return t=t.debug(this.operand1).write(46).write("bitwiseOr").write(40).debug(this.operand2).write(41)}clone(){return new Wr(this.operand1.clone(),this.operand2.clone())}}class Hr extends Vr{constructor(t,e){super(t,e)}get operator(){return"^"}get precedence(){return 6}evaluate(t){(t=Lr.fromAny(t)).willOperate(this);const e=this.operand1.evaluate(t),r=this.operand2.evaluate(t),i=e.bitwiseXor(r);return t.didOperate(this,i),i}substitute(t){t=Lr.fromAny(t);const e=this.operand1.substitute(t),r=this.operand2.substitute(t);return e.bitwiseXor(r)}get typeOrder(){return 24}compareTo(t){if(t instanceof Hr){let e=this.operand1.compareTo(t.operand1);return 0===e&&(e=this.operand2.compareTo(t.operand2)),e}return t instanceof ar?h.compare(this.typeOrder,t.typeOrder):NaN}equivalentTo(t,e){return this===t||t instanceof Hr&&(this.operand1.equivalentTo(t.operand1,e)&&this.operand2.equivalentTo(t.operand2,e))}equals(t){return this===t||t instanceof Hr&&(this.operand1.equals(t.operand1)&&this.operand2.equals(t.operand2))}hashCode(){return n.mash(n.mix(n.mix(p.hash(Hr),this.operand1.hashCode()),this.operand2.hashCode()))}debug(t){return t=t.debug(this.operand1).write(46).write("bitwiseXor").write(40).debug(this.operand2).write(41)}clone(){return new Hr(this.operand1.clone(),this.operand2.clone())}}class Xr extends Vr{constructor(t,e){super(t,e)}get operator(){return"&"}get precedence(){return 7}evaluate(t){(t=Lr.fromAny(t)).willOperate(this);const e=this.operand1.evaluate(t),r=this.operand2.evaluate(t),i=e.bitwiseAnd(r);return t.didOperate(this,i),i}substitute(t){t=Lr.fromAny(t);const e=this.operand1.substitute(t),r=this.operand2.substitute(t);return e.bitwiseAnd(r)}get typeOrder(){return 25}compareTo(t){if(t instanceof Xr){let e=this.operand1.compareTo(t.operand1);return 0===e&&(e=this.operand2.compareTo(t.operand2)),e}return t instanceof ar?h.compare(this.typeOrder,t.typeOrder):NaN}equivalentTo(t,e){return this===t||t instanceof Xr&&(this.operand1.equivalentTo(t.operand1,e)&&this.operand2.equivalentTo(t.operand2,e))}equals(t){return this===t||t instanceof Xr&&(this.operand1.equals(t.operand1)&&this.operand2.equals(t.operand2))}hashCode(){return n.mash(n.mix(n.mix(p.hash(Xr),this.operand1.hashCode()),this.operand2.hashCode()))}debug(t){return t=t.debug(this.operand1).write(46).write("bitwiseAnd").write(40).debug(this.operand2).write(41)}clone(){return new Xr(this.operand1.clone(),this.operand2.clone())}}class Yr extends Vr{constructor(t,e){super(t,e)}get operator(){return"<"}get precedence(){return 0}evaluate(t){(t=Lr.fromAny(t)).willOperate(this);const e=this.operand1.evaluate(t),r=this.operand2.evaluate(t),i=e.lt(r);return t.didOperate(this,i),i}substitute(t){t=Lr.fromAny(t);const e=this.operand1.substitute(t),r=this.operand2.substitute(t);return e.lt(r)}get typeOrder(){return 26}compareTo(t){if(t instanceof Yr){let e=this.operand1.compareTo(t.operand1);return 0===e&&(e=this.operand2.compareTo(t.operand2)),e}return t instanceof ar?h.compare(this.typeOrder,t.typeOrder):NaN}equivalentTo(t,e){return this===t||t instanceof Yr&&(this.operand1.equivalentTo(t.operand1,e)&&this.operand2.equivalentTo(t.operand2,e))}equals(t){return this===t||t instanceof Yr&&(this.operand1.equals(t.operand1)&&this.operand2.equals(t.operand2))}hashCode(){return n.mash(n.mix(n.mix(p.hash(Yr),this.operand1.hashCode()),this.operand2.hashCode()))}debug(t){return t.debug(this.operand1).write(46).write("lt").write(40).debug(this.operand2).write(41)}clone(){return new Yr(this.operand1.clone(),this.operand2.clone())}}class Gr extends Vr{constructor(t,e){super(t,e)}get operator(){return"<="}get precedence(){return 0}evaluate(t){(t=Lr.fromAny(t)).willOperate(this);const e=this.operand1.evaluate(t),r=this.operand2.evaluate(t),i=e.le(r);return t.didOperate(this,i),i}substitute(t){t=Lr.fromAny(t);const e=this.operand1.substitute(t),r=this.operand2.substitute(t);return e.le(r)}get typeOrder(){return 27}compareTo(t){if(t instanceof Gr){let e=this.operand1.compareTo(t.operand1);return 0===e&&(e=this.operand2.compareTo(t.operand2)),e}return t instanceof ar?h.compare(this.typeOrder,t.typeOrder):NaN}equivalentTo(t,e){return this===t||t instanceof Gr&&(this.operand1.equivalentTo(t.operand1,e)&&this.operand2.equivalentTo(t.operand2,e))}equals(t){return this===t||t instanceof Gr&&(this.operand1.equals(t.operand1)&&this.operand2.equals(t.operand2))}hashCode(){return n.mash(n.mix(n.mix(p.hash(Gr),this.operand1.hashCode()),this.operand2.hashCode()))}debug(t){return t.debug(this.operand1).write(46).write("le").write(40).debug(this.operand2).write(41)}clone(){return new Gr(this.operand1.clone(),this.operand2.clone())}}class _r extends Vr{constructor(t,e){super(t,e)}get operator(){return"=="}get precedence(){return 0}evaluate(t){(t=Lr.fromAny(t)).willOperate(this);const e=this.operand1.evaluate(t),r=this.operand2.evaluate(t),i=e.eq(r);return t.didOperate(this,i),i}substitute(t){t=Lr.fromAny(t);const e=this.operand1.substitute(t),r=this.operand2.substitute(t);return e.eq(r)}get typeOrder(){return 28}compareTo(t){if(t instanceof _r){let e=this.operand1.compareTo(t.operand1);return 0===e&&(e=this.operand2.compareTo(t.operand2)),e}return t instanceof ar?h.compare(this.typeOrder,t.typeOrder):NaN}equivalentTo(t,e){return this===t||t instanceof _r&&(this.operand1.equivalentTo(t.operand1,e)&&this.operand2.equivalentTo(t.operand2,e))}equals(t){return this===t||t instanceof _r&&(this.operand1.equals(t.operand1)&&this.operand2.equals(t.operand2))}hashCode(){return n.mash(n.mix(n.mix(p.hash(_r),this.operand1.hashCode()),this.operand2.hashCode()))}debug(t){return t=t.debug(this.operand1).write(46).write("eq").write(40).debug(this.operand2).write(41)}clone(){return new _r(this.operand1.clone(),this.operand2.clone())}}class Qr extends Vr{constructor(t,e){super(t,e)}get operator(){return"!="}get precedence(){return 0}evaluate(t){(t=Lr.fromAny(t)).willOperate(this);const e=this.operand1.evaluate(t),r=this.operand2.evaluate(t),i=e.ne(r);return t.didOperate(this,i),i}substitute(t){t=Lr.fromAny(t);const e=this.operand1.substitute(t),r=this.operand2.substitute(t);return e.ne(r)}get typeOrder(){return 29}compareTo(t){if(t instanceof Qr){let e=this.operand1.compareTo(t.operand1);return 0===e&&(e=this.operand2.compareTo(t.operand2)),e}return t instanceof ar?h.compare(this.typeOrder,t.typeOrder):NaN}equivalentTo(t,e){return this===t||t instanceof Qr&&(this.operand1.equivalentTo(t.operand1,e)&&this.operand2.equivalentTo(t.operand2,e))}equals(t){return this===t||t instanceof Qr&&(this.operand1.equals(t.operand1)&&this.operand2.equals(t.operand2))}hashCode(){return n.mash(n.mix(n.mix(p.hash(Qr),this.operand1.hashCode()),this.operand2.hashCode()))}debug(t){return t=t.debug(this.operand1).write(46).write("ne").write(40).debug(this.operand2).write(41)}clone(){return new Qr(this.operand1.clone(),this.operand2.clone())}}class Zr extends Vr{constructor(t,e){super(t,e)}get operator(){return">="}get precedence(){return 0}evaluate(t){(t=Lr.fromAny(t)).willOperate(this);const e=this.operand1.evaluate(t),r=this.operand2.evaluate(t),i=e.ge(r);return t.didOperate(this,i),i}substitute(t){t=Lr.fromAny(t);const e=this.operand1.substitute(t),r=this.operand2.substitute(t);return e.ge(r)}get typeOrder(){return 30}compareTo(t){if(t instanceof Zr){let e=this.operand1.compareTo(t.operand1);return 0===e&&(e=this.operand2.compareTo(t.operand2)),e}return t instanceof ar?h.compare(this.typeOrder,t.typeOrder):NaN}equivalentTo(t,e){return this===t||t instanceof Zr&&(this.operand1.equivalentTo(t.operand1,e)&&this.operand2.equivalentTo(t.operand2,e))}equals(t){return this===t||t instanceof Zr&&(this.operand1.equals(t.operand1)&&this.operand2.equals(t.operand2))}hashCode(){return n.mash(n.mix(n.mix(p.hash(Zr),this.operand1.hashCode()),this.operand2.hashCode()))}debug(t){return t=t.debug(this.operand1).write(46).write("ge").write(40).debug(this.operand2).write(41)}clone(){return new Zr(this.operand1.clone(),this.operand2.clone())}}class Jr extends Vr{constructor(t,e){super(t,e)}get operator(){return">"}get precedence(){return 0}evaluate(t){(t=Lr.fromAny(t)).willOperate(this);const e=this.operand1.evaluate(t),r=this.operand2.evaluate(t),i=e.gt(r);return t.didOperate(this,i),i}substitute(t){t=Lr.fromAny(t);const e=this.operand1.substitute(t),r=this.operand2.substitute(t);return e.gt(r)}get typeOrder(){return 31}compareTo(t){if(t instanceof Jr){let e=this.operand1.compareTo(t.operand1);return 0===e&&(e=this.operand2.compareTo(t.operand2)),e}return t instanceof ar?h.compare(this.typeOrder,t.typeOrder):NaN}equivalentTo(t,e){return this===t||t instanceof Jr&&(this.operand1.equivalentTo(t.operand1,e)&&this.operand2.equivalentTo(t.operand2,e))}equals(t){return this===t||t instanceof Jr&&(this.operand1.equals(t.operand1)&&this.operand2.equals(t.operand2))}hashCode(){return n.mash(n.mix(n.mix(p.hash(Jr),this.operand1.hashCode()),this.operand2.hashCode()))}debug(t){return t=t.debug(this.operand1).write(46).write("gt").write(40).debug(this.operand2).write(41)}clone(){return new Jr(this.operand1.clone(),this.operand2.clone())}}class $r extends Vr{constructor(t,e){super(t,e)}get operator(){return"+"}get precedence(){return 8}evaluate(t){(t=Lr.fromAny(t)).willOperate(this);const e=this.operand1.evaluate(t),r=this.operand2.evaluate(t),i=e.plus(r);return t.didOperate(this,i),i}substitute(t){t=Lr.fromAny(t);const e=this.operand1.substitute(t),r=this.operand2.substitute(t);return e.plus(r)}get typeOrder(){return 32}compareTo(t){if(t instanceof $r){let e=this.operand1.compareTo(t.operand1);return 0===e&&(e=this.operand2.compareTo(t.operand2)),e}return t instanceof ar?h.compare(this.typeOrder,t.typeOrder):NaN}equivalentTo(t,e){return this===t||t instanceof $r&&(this.operand1.equivalentTo(t.operand1,e)&&this.operand2.equivalentTo(t.operand2,e))}equals(t){return this===t||t instanceof $r&&(this.operand1.equals(t.operand1)&&this.operand2.equals(t.operand2))}hashCode(){return n.mash(n.mix(n.mix(p.hash($r),this.operand1.hashCode()),this.operand2.hashCode()))}debug(t){return t=t.debug(this.operand1).write(46).write("plus").write(40).debug(this.operand2).write(41)}clone(){return new $r(this.operand1.clone(),this.operand2.clone())}}class ti extends Vr{constructor(t,e){super(t,e)}get operator(){return"-"}get precedence(){return 8}evaluate(t){(t=Lr.fromAny(t)).willOperate(this);const e=this.operand1.evaluate(t),r=this.operand2.evaluate(t),i=e.minus(r);return t.didOperate(this,i),i}substitute(t){t=Lr.fromAny(t);const e=this.operand1.substitute(t),r=this.operand2.substitute(t);return e.minus(r)}get typeOrder(){return 33}compareTo(t){if(t instanceof ti){let e=this.operand1.compareTo(t.operand1);return 0===e&&(e=this.operand2.compareTo(t.operand2)),e}return t instanceof ar?h.compare(this.typeOrder,t.typeOrder):NaN}equivalentTo(t,e){return this===t||t instanceof ti&&(this.operand1.equivalentTo(t.operand1,e)&&this.operand2.equivalentTo(t.operand2,e))}equals(t){return this===t||t instanceof ti&&(this.operand1.equals(t.operand1)&&this.operand2.equals(t.operand2))}hashCode(){return n.mash(n.mix(n.mix(p.hash(ti),this.operand1.hashCode()),this.operand2.hashCode()))}debug(t){return t=t.debug(this.operand1).write(46).write("minus").write(40).debug(this.operand2).write(41)}clone(){return new ti(this.operand1.clone(),this.operand2.clone())}}class ei extends Vr{constructor(t,e){super(t,e)}get operator(){return"*"}get precedence(){return 9}evaluate(t){(t=Lr.fromAny(t)).willOperate(this);const e=this.operand1.evaluate(t),r=this.operand2.evaluate(t),i=e.times(r);return t.didOperate(this,i),i}substitute(t){t=Lr.fromAny(t);const e=this.operand1.substitute(t),r=this.operand2.substitute(t);return e.times(r)}get typeOrder(){return 34}compareTo(t){if(t instanceof ei){let e=this.operand1.compareTo(t.operand1);return 0===e&&(e=this.operand2.compareTo(t.operand2)),e}return t instanceof ar?h.compare(this.typeOrder,t.typeOrder):NaN}equivalentTo(t,e){return this===t||t instanceof ei&&(this.operand1.equivalentTo(t.operand1,e)&&this.operand2.equivalentTo(t.operand2,e))}equals(t){return this===t||t instanceof ei&&(this.operand1.equals(t.operand1)&&this.operand2.equals(t.operand2))}hashCode(){return n.mash(n.mix(n.mix(p.hash(ei),this.operand1.hashCode()),this.operand2.hashCode()))}debug(t){return t=t.debug(this.operand1).write(46).write("times").write(40).debug(this.operand2).write(41)}clone(){return new ei(this.operand1.clone(),this.operand2.clone())}}class ri extends Vr{constructor(t,e){super(t,e)}get operator(){return"/"}get precedence(){return 9}evaluate(t){(t=Lr.fromAny(t)).willOperate(this);const e=this.operand1.evaluate(t),r=this.operand2.evaluate(t),i=e.divide(r);return t.didOperate(this,i),i}substitute(t){t=Lr.fromAny(t);const e=this.operand1.substitute(t),r=this.operand2.substitute(t);return e.divide(r)}get typeOrder(){return 35}compareTo(t){if(t instanceof ri){let e=this.operand1.compareTo(t.operand1);return 0===e&&(e=this.operand2.compareTo(t.operand2)),e}return t instanceof ar?h.compare(this.typeOrder,t.typeOrder):NaN}equivalentTo(t,e){return this===t||t instanceof ri&&(this.operand1.equivalentTo(t.operand1,e)&&this.operand2.equivalentTo(t.operand2,e))}equals(t){return this===t||t instanceof ri&&(this.operand1.equals(t.operand1)&&this.operand2.equals(t.operand2))}hashCode(){return n.mash(n.mix(n.mix(p.hash(ri),this.operand1.hashCode()),this.operand2.hashCode()))}debug(t){return t=t.debug(this.operand1).write(46).write("divide").write(40).debug(this.operand2).write(41)}clone(){return new ri(this.operand1.clone(),this.operand2.clone())}}class ii extends Vr{constructor(t,e){super(t,e)}get operator(){return"%"}get precedence(){return 9}evaluate(t){(t=Lr.fromAny(t)).willOperate(this);const e=this.operand1.evaluate(t),r=this.operand2.evaluate(t),i=e.modulo(r);return t.didOperate(this,i),i}substitute(t){t=Lr.fromAny(t);const e=this.operand1.substitute(t),r=this.operand2.substitute(t);return e.modulo(r)}get typeOrder(){return 36}compareTo(t){if(t instanceof ii){let e=this.operand1.compareTo(t.operand1);return 0===e&&(e=this.operand2.compareTo(t.operand2)),e}return t instanceof ar?h.compare(this.typeOrder,t.typeOrder):NaN}equivalentTo(t,e){return this===t||t instanceof ii&&(this.operand1.equivalentTo(t.operand1,e)&&this.operand2.equivalentTo(t.operand2,e))}equals(t){return this===t||t instanceof ii&&(this.operand1.equals(t.operand1)&&this.operand2.equals(t.operand2))}hashCode(){return n.mash(n.mix(n.mix(p.hash(ii),this.operand1.hashCode()),this.operand2.hashCode()))}debug(t){return t=t.debug(this.operand1).write(46).write("modulo").write(40).debug(this.operand2).write(41)}clone(){return new ii(this.operand1.clone(),this.operand2.clone())}}class ni extends qr{constructor(t){super(t)}get operator(){return"!"}get precedence(){return 10}evaluate(t){t=Lr.fromAny(t);return this.operand.evaluate(t).not()}substitute(t){t=Lr.fromAny(t);return this.operand.substitute(t).not()}get typeOrder(){return 37}compareTo(t){return h.compare(this.typeOrder,t.typeOrder)}equivalentTo(t,e){return this===t||t instanceof ni&&this.operand.equivalentTo(t.operand,e)}equals(t){return this===t||t instanceof ni&&this.operand.equals(t.operand)}hashCode(){return n.mash(n.mix(p.hash(ni),this.operand.hashCode()))}debug(t){return t=t.debug(this.operand).write(46).write("not").write(40).write(41)}clone(){return new ni(this.operand.clone())}}class si extends qr{constructor(t){super(t)}get operator(){return"~"}get precedence(){return 10}evaluate(t){t=Lr.fromAny(t);return this.operand.evaluate(t).bitwiseNot()}substitute(t){t=Lr.fromAny(t);return this.operand.substitute(t).bitwiseNot()}get typeOrder(){return 38}compareTo(t){return t instanceof si?this.operand.compareTo(t.operand):t instanceof ar?h.compare(this.typeOrder,t.typeOrder):NaN}equivalentTo(t,e){return this===t||t instanceof si&&this.operand.equivalentTo(t.operand,e)}equals(t){return this===t||t instanceof si&&this.operand.equals(t.operand)}hashCode(){return n.mash(n.mix(p.hash(si),this.operand.hashCode()))}debug(t){return t=t.debug(this.operand).write(46).write("bitwiseNot").write(40).write(41)}clone(){return new si(this.operand.clone())}}class oi extends qr{constructor(t){super(t)}get operator(){return"-"}get precedence(){return 10}evaluate(t){t=Lr.fromAny(t);return this.operand.evaluate(t).negative()}substitute(t){t=Lr.fromAny(t);return this.operand.substitute(t).negative()}get typeOrder(){return 39}compareTo(t){return t instanceof oi?this.operand.compareTo(t.operand):t instanceof ar?h.compare(this.typeOrder,t.typeOrder):NaN}equivalentTo(t,e){return this===t||t instanceof oi&&this.operand.equivalentTo(t.operand,e)}equals(t){return this===t||t instanceof oi&&this.operand.equals(t.operand)}hashCode(){return n.mash(n.mix(p.hash(oi),this.operand.hashCode()))}debug(t){return t=t.debug(this.operand).write(46).write("negative").write(40).write(41)}clone(){return new oi(this.operand.clone())}}class ai extends qr{constructor(t){super(t)}get operator(){return"+"}get precedence(){return 10}evaluate(t){t=Lr.fromAny(t);return this.operand.evaluate(t).positive()}substitute(t){t=Lr.fromAny(t);return this.operand.substitute(t).positive()}get typeOrder(){return 40}compareTo(t){return t instanceof ai?this.operand.compareTo(t.operand):t instanceof ar?h.compare(this.typeOrder,t.typeOrder):NaN}equivalentTo(t,e){return this===t||t instanceof ai&&this.operand.equivalentTo(t.operand,e)}equals(t){return this===t||t instanceof ai&&this.operand.equals(t.operand)}hashCode(){return n.mash(n.mix(p.hash(ai),this.operand.hashCode()))}debug(t){return t=t.debug(this.operand).write(46).write("positive").write(40).write(41)}clone(){return new ai(this.operand.clone())}}class ui extends Tr{constructor(t,e){super(),this.func=t,this.args=e.commit(),this.state=void 0}setState(t){this.state=t}isConstant(){return this.func.isConstant()&&this.args.isConstant()}get precedence(){return 11}evaluate(t){t=Lr.fromAny(t);const e=this.func.evaluate(t);return e instanceof xi?e.invoke(this.args,t,this):ar.absent()}substitute(t){t=Lr.fromAny(t);const e=this.func.evaluate(t);if(e instanceof xi){const r=e.expand(this.args,t,this);if(void 0!==r)return r}const r=this.args.substitute(t).toValue();return new ui(this.func,r)}interpolateTo(t){return t instanceof ui?hi(this,t):super.interpolateTo(t)}get typeOrder(){return 41}compareTo(t){if(t instanceof ui){let e=this.func.compareTo(t.func);return 0===e&&(e=this.args.compareTo(t.args)),e}return t instanceof ar?h.compare(this.typeOrder,t.typeOrder):NaN}equivalentTo(t,e){return this===t||t instanceof ui&&(this.func.equals(t.func)&&this.args.equivalentTo(t.args,e))}equals(t){return this===t||t instanceof ui&&(this.func.equals(t.func)&&this.args.equals(t.args))}hashCode(){return n.mash(n.mix(n.mix(p.hash(ui),this.func.hashCode()),this.args.hashCode()))}debug(t){return t=t.debug(this.func).write(46).write("invoke").write(40).debug(this.args).write(41)}clone(){return new ui(this.func.clone(),this.args.clone())}}const hi=function(t){const e=function(t,r){const i=function(t){const e=i.funcInterpolator(t),r=i.argsInterpolator(t);return new ui(e,r)};return Object.setPrototypeOf(i,e.prototype),i.funcInterpolator=t.func.interpolateTo(r.func),i.argsInterpolator=t.args.interpolateTo(r.args),i};return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,Object.defineProperty(e.prototype,0,{get(){const t=this.funcInterpolator[0],e=this.argsInterpolator[0];return new ui(t,e)},configurable:!0}),Object.defineProperty(e.prototype,1,{get(){const t=this.funcInterpolator[1],e=this.argsInterpolator[1];return new ui(t,e)},configurable:!0}),e.prototype.equals=function(t){return this===t||t instanceof e&&(this.funcInterpolator.equals(t.funcInterpolator)&&this.argsInterpolator.equals(t.argsInterpolator))},e}(k);class li extends Pr{constructor(){super()}isConstant(){return!1}evaluate(t){t=Lr.fromAny(t);const e=mr.create();return this.forSelected(t,(function(t){const r=t.peekScope();void 0!==r&&e.push(r)}),this),e.isEmpty()?ar.absent():e.flattened()}get(t){return t=yr.fromAny(t),this.andThen(new di(t,li.identity()))}getAttr(t){return t=Sr.fromAny(t),this.andThen(new pi(t,li.identity()))}getItem(t){return t=kr.fromAny(t),this.andThen(new fi(t,li.identity()))}keys(){return this.andThen(li.keys())}values(){return this.andThen(li.values())}children(){return this.andThen(li.children())}descendants(){return this.andThen(li.descendants())}filter(t){return 0===arguments.length?new vi(this,li.identity()):(t=ar.fromAny(t),this.andThen(t.filter()))}invoke(t){return new ui(this,t)}get precedence(){return 11}debug(t){return t=t.write("Selector").write(46).write("identity").write(40).write(41),t=this.debugThen(t)}static identity(){return new ci}static get(t){return t=yr.fromAny(t),new di(t,li.identity())}static getAttr(t){return t=Sr.fromAny(t),new pi(t,li.identity())}static getItem(t){return t=kr.fromAny(t),new fi(t,li.identity())}static keys(){return new yi(li.identity())}static values(){return new mi(li.identity())}static children(){return new wi(li.identity())}static descendants(){return new gi(li.identity())}static literal(t){return(t=ar.fromAny(t))instanceof li||(t=new bi(t,li.identity())),t}}e([s],li,"identity",null),e([s],li,"keys",null),e([s],li,"values",null),e([s],li,"children",null),e([s],li,"descendants",null);class ci extends li{get then(){return this}forSelected(t,e,r){let i;if(t.willSelect(this),0!==t.scopeDepth){const n=t.popScope(),s=n.evaluate(t);t.pushScope(s),i=e.call(r,t),t.swapScope(n)}return t.didSelect(this,i),i}mapSelected(t,e,r){return e.call(r,t)}substitute(t){return(t=Lr.fromAny(t)).peekScope().substitute(t)}get(t){return t=yr.fromAny(t),new di(t,this)}getAttr(t){return t=Sr.fromAny(t),new pi(t,this)}getItem(t){return t=kr.fromAny(t),new fi(t,this)}andThen(t){return t}keys(){return li.keys()}values(){return li.values()}children(){return li.children()}descendants(){return li.descendants()}filter(t){return 0===arguments.length?new vi(this,this):(t=ar.fromAny(t)).filter()}get typeOrder(){return 10}compareTo(t){return t instanceof ar?h.compare(this.typeOrder,t.typeOrder):NaN}equivalentTo(t){return this===t}equals(t){return this===t}hashCode(){return p.hash(ci)}debugThen(t){return t}clone(){return this}}class di extends li{constructor(t,e){super(),this.item=t.commit(),this.then=e}forSelected(t,e,r){t.willSelect(this);const i=this.item.evaluate(t).toValue(),n=di.forSelected(i,this.then,t,e,r);return t.didSelect(this,n),n}static forSelected(t,e,r,i,n){let s;if(0!==r.scopeDepth){const o=r.popScope().toValue();let a;o instanceof mr&&(a=o.getField(t),void 0!==a&&(r.pushScope(a.toValue()),s=e.forSelected(r,i,n),r.popScope())),void 0===a&&void 0===s&&di.forSelected(t,e,r,i,n),r.pushScope(o)}return s}mapSelected(t,e,r){let i;t.willTransform(this);const n=this.item.evaluate(t).toValue();if(0!==t.scopeDepth){const s=t.popScope().toValue();if(s instanceof mr){const i=s.getField(n);if(void 0!==i){t.pushScope(i.toValue());const o=this.then.mapSelected(t,e,r);t.popScope(),o instanceof hr?n.equals(o.key)?s.set(n,o.toValue()):(s.delete(n),s.push(o)):o.isDefined()?s.set(n,o.toValue()):s.delete(n)}}t.pushScope(s),i=s}else i=ar.absent();return t.didTransform(this,i),i}substitute(t){t=Lr.fromAny(t);const e=this.item.evaluate(t).toValue(),r=di.substitute(e,this.then,t);if(void 0!==r)return r;let i=this.then.substitute(t);return i instanceof li||(i=this.then),new di(this.item,i)}static substitute(t,e,r){let i;if(0!==r.scopeDepth){const n=r.popScope().toValue();let s;n instanceof mr&&(s=n.getField(t),void 0!==s&&(i=s.toValue().substitute(r))),void 0===s&&void 0===i&&di.substitute(t,e,r),r.pushScope(n)}return i}andThen(t){return new di(this.item,this.then.andThen(t))}get typeOrder(){return 12}compareTo(t){if(t instanceof di){let e=this.item.compareTo(t.item);return 0===e&&(e=this.then.compareTo(t.then)),e}return t instanceof ar?h.compare(this.typeOrder,t.typeOrder):NaN}equivalentTo(t,e){return this===t||t instanceof di&&(this.item.equals(t.item)&&this.then.equivalentTo(t.then,e))}equals(t){return this===t||t instanceof di&&(this.item.equals(t.item)&&this.then.equals(t.then))}hashCode(){return n.mash(n.mix(n.mix(p.hash(di),this.item.hashCode()),this.then.hashCode()))}debugThen(t){return t=t.write(46).write("get").write(40).debug(this.item).write(41),t=this.then.debugThen(t)}clone(){return new di(this.item.clone(),this.then.clone())}}class pi extends li{constructor(t,e){super(),this.item=t,this.then=e}forSelected(t,e,r){t.willSelect(this);const i=this.item,n=pi.forSelected(i,this.then,t,e);return t.didSelect(this,n),n}static forSelected(t,e,r,i,n){let s;if(0!==r.scopeDepth){const o=r.popScope().toValue();let a;o instanceof mr&&(a=o.getField(t),a instanceof dr&&(r.pushScope(a.toValue()),s=e.forSelected(r,i,n),r.popScope())),void 0===a&&void 0===s&&pi.forSelected(t,e,r,i,n),r.pushScope(o)}return s}mapSelected(t,e,r){let i;t.willTransform(this);const n=this.item;if(0!==t.scopeDepth){const s=t.popScope().toValue();if(s instanceof mr){const i=s.getField(n);if(i instanceof dr){t.pushScope(i.toValue());const o=this.then.mapSelected(t,e,r);t.popScope(),o instanceof hr?n.equals(o.key)?s.setAttr(n,o.toValue()):(s.delete(n),s.push(o)):o.isDefined()?s.setAttr(n,o.toValue()):s.delete(n)}}t.pushScope(s),i=s}else i=ar.absent();return t.didTransform(this,i),i}substitute(t){t=Lr.fromAny(t);const e=this.item,r=pi.substitute(e,this.then,t);if(void 0!==r)return r;let i=this.then.substitute(t);return i instanceof li||(i=this.then),new pi(this.item,i)}static substitute(t,e,r){let i;if(0!==r.scopeDepth){const n=r.popScope().toValue();let s;n instanceof mr&&(s=n.getField(t),s instanceof dr&&(i=s.toValue().substitute(r))),void 0===s&&void 0===i&&pi.substitute(t,e,r),r.pushScope(n)}return i}andThen(t){return new pi(this.item,this.then.andThen(t))}get typeOrder(){return 13}compareTo(t){if(t instanceof pi){let e=this.item.compareTo(t.item);return 0===e&&(e=this.then.compareTo(t.then)),e}return t instanceof ar?h.compare(this.typeOrder,t.typeOrder):NaN}equivalentTo(t,e){return this===t||t instanceof pi&&(this.item.equals(t.item)&&this.then.equivalentTo(t.then,e))}equals(t){return this===t||t instanceof pi&&(this.item.equals(t.item)&&this.then.equals(t.then))}hashCode(){return n.mash(n.mix(n.mix(p.hash(pi),this.item.hashCode()),this.then.hashCode()))}debugThen(t){return t=t.write(46).write("getAttr").write(40).debug(this.item).write(41),t=this.then.debugThen(t)}clone(){return new pi(this.item.clone(),this.then.clone())}}class fi extends li{constructor(t,e){super(),this.item=t,this.then=e}forSelected(t,e,r){let i;t.willSelect(this);const n=this.item.numberValue();if(0!==t.scopeDepth){const s=t.popScope().toValue();if(s instanceof mr&&n<s.length){const o=s.getItem(n);t.pushScope(o),i=this.then.forSelected(t,e,r),t.popScope()}t.pushScope(s)}return t.didSelect(this,i),i}mapSelected(t,e,r){let i;if(t.willTransform(this),0!==t.scopeDepth){const n=t.popScope().toValue(),s=this.item.numberValue();if(n instanceof mr&&s<n.length){const i=n.getItem(s);t.pushScope(i);const o=this.then.mapSelected(t,e,r);t.popScope(),o.isDefined()?n.setItem(s,o):n.splice(s,1)}t.pushScope(n),i=n}else i=ar.absent();return t.didTransform(this,i),i}substitute(t){t=Lr.fromAny(t);const e=this.item.numberValue();if(0!==t.scopeDepth){const r=t.popScope().toValue();let i;if(r instanceof mr&&e<r.length){i=r.getItem(e).substitute(t)}if(t.pushScope(r),void 0!==i)return i}let r=this.then.substitute(t);return r instanceof li||(r=this.then),new fi(this.item,r)}andThen(t){return new fi(this.item,this.then.andThen(t))}get typeOrder(){return 14}compareTo(t){if(t instanceof fi){let e=this.item.compareTo(t.item);return 0===e&&(e=this.then.compareTo(t.then)),e}return t instanceof ar?h.compare(this.typeOrder,t.typeOrder):NaN}equivalentTo(t,e){return this===t||t instanceof fi&&(this.item.equals(t.item)&&this.then.equivalentTo(t.then,e))}equals(t){return this===t||t instanceof fi&&(this.item.equals(t.item)&&this.then.equals(t.then))}hashCode(){return n.mash(n.mix(n.mix(p.hash(fi),this.item.hashCode()),this.then.hashCode()))}debugThen(t){return t=t.write(46).write("getItem").write(40).debug(this.item).write(41),t=this.then.debugThen(t)}clone(){return new fi(this.item,this.then.clone())}}class yi extends li{constructor(t){super(),this.then=t}forSelected(t,e,r){let i;if(t.willSelect(this),0!==t.scopeDepth){const n=t.popScope();if(n instanceof mr){const s=n.iterator();for(;void 0===i&&s.hasNext();){const n=s.next().value;n instanceof hr&&(t.pushScope(n.key),i=this.then.forSelected(t,e,r),t.popScope())}}else n instanceof hr&&(t.pushScope(n.key),i=this.then.forSelected(t,e,r),t.popScope());t.pushScope(n)}return t.didSelect(this,i),i}mapSelected(t,e,r){let i;if(t.willTransform(this),0!==t.scopeDepth){let n=t.popScope();if(n instanceof mr){const i=n.iterator();for(;i.hasNext();){const s=i.next().value;if(s instanceof hr){const o=s.key;t.pushScope(o);const a=this.then.mapSelected(t,e,r).toValue();t.popScope(),a.isDefined()?o!==a&&(n instanceof dr&&a instanceof Sr?i.set(dr.of(a,n.toValue())):i.set(lr.of(a,n.toValue()))):i.delete()}}}else if(n instanceof hr){const i=n.key;t.pushScope(i);const s=this.then.mapSelected(t,e,r).toValue();t.popScope(),s.isDefined()?i!==s&&(n=n instanceof dr&&s instanceof Sr?dr.of(s,n.toValue()):lr.of(s,n.toValue())):n=ar.absent()}t.pushScope(n),i=n}else i=ar.absent();return t.didTransform(this,i),i}substitute(t){t=Lr.fromAny(t);let e=this.then.substitute(t);return e instanceof li||(e=this.then),new yi(e)}andThen(t){return new yi(this.then.andThen(t))}get typeOrder(){return 15}compareTo(t){return t instanceof yi?this.then.compareTo(t.then):t instanceof ar?h.compare(this.typeOrder,t.typeOrder):NaN}equivalentTo(t,e){return this===t||t instanceof yi&&this.then.equivalentTo(t.then,e)}equals(t){return this===t||t instanceof yi&&this.then.equals(t.then)}hashCode(){return n.mash(n.mix(p.hash(yi),this.then.hashCode()))}debugThen(t){return t=t.write(46).write("keys").write(40).write(41),t=this.then.debugThen(t)}clone(){return new yi(this.then.clone())}}class mi extends li{constructor(t){super(),this.then=t}forSelected(t,e,r){let i;if(t.willSelect(this),0!==t.scopeDepth){const n=t.popScope();if(n instanceof mr){const s=n.iterator();for(;void 0===i&&s.hasNext();){const n=s.next().value;t.pushScope(n.toValue()),i=this.then.forSelected(t,e,r),t.popScope()}}else t.pushScope(n.toValue()),i=this.then.forSelected(t,e,r),t.popScope();t.pushScope(n)}return t.didSelect(this,i),i}mapSelected(t,e,r){let i;if(t.willTransform(this),0!==t.scopeDepth){let n=t.popScope();if(n instanceof mr){const i=n.iterator();for(;i.hasNext();){const n=i.next().value;if(n instanceof hr){const s=n.toValue();t.pushScope(s);const o=this.then.mapSelected(t,e,r);t.popScope(),o.isDefined()?o instanceof hr?i.set(o):o!==s&&i.set(n.updatedValue(o.toValue())):i.delete()}else{t.pushScope(n.toValue());const s=this.then.mapSelected(t,e,r);t.popScope(),s.isDefined()?n!==s&&i.set(s):i.delete()}}}else if(n instanceof hr){const i=n.toValue();t.pushScope(i);const s=this.then.mapSelected(t,e,r);t.popScope(),s.isDefined()?s instanceof hr?n=s:s!==i&&(n=n.updatedValue(s.toValue())):n=ar.absent()}else t.pushScope(n),n=this.then.mapSelected(t,e,r),t.popScope();t.pushScope(n),i=n}else i=ar.absent();return t.didTransform(this,i),i}substitute(t){t=Lr.fromAny(t);let e=this.then.substitute(t);return e instanceof li||(e=this.then),new mi(e)}andThen(t){return new mi(this.then.andThen(t))}get typeOrder(){return 16}compareTo(t){return t instanceof mi?this.then.compareTo(t.then):t instanceof ar?h.compare(this.typeOrder,t.typeOrder):NaN}equivalentTo(t,e){return this===t||t instanceof mi&&this.then.equivalentTo(t.then,e)}equals(t){return this===t||t instanceof mi&&this.then.equals(t.then)}hashCode(){return n.mash(n.mix(p.hash(mi),this.then.hashCode()))}debugThen(t){return t=t.write(46).write("values").write(40).write(41),t=this.then.debugThen(t)}clone(){return new mi(this.then.clone())}}class wi extends li{constructor(t){super(),this.then=t}forSelected(t,e,r){let i;if(t.willSelect(this),0!==t.scopeDepth){const n=t.popScope().toValue();if(n instanceof mr){const s=n.iterator();for(;void 0===i&&s.hasNext();){const n=s.next().value;t.pushScope(n),i=this.then.forSelected(t,e,r),t.popScope()}}t.pushScope(n)}return t.didSelect(this,i),i}mapSelected(t,e,r){let i;if(t.willTransform(this),0!==t.scopeDepth){const r=t.popScope().toValue();if(r instanceof mr){const i=r.iterator();for(;i.hasNext();){const r=i.next().value;t.pushScope(r);const n=this.then.mapSelected(t,e);t.popScope(),n.isDefined()?n!==r&&i.set(n):i.delete()}}t.pushScope(r),i=r}else i=ar.absent();return t.didTransform(this,i),i}substitute(t){t=Lr.fromAny(t);let e=this.then.substitute(t);return e instanceof li||(e=this.then),new wi(e)}andThen(t){return new wi(this.then.andThen(t))}get typeOrder(){return 17}compareTo(t){return t instanceof wi?this.then.compareTo(t.then):t instanceof ar?h.compare(this.typeOrder,t.typeOrder):NaN}equivalentTo(t,e){return this===t||t instanceof wi&&this.then.equivalentTo(t.then,e)}equals(t){return this===t||t instanceof wi&&this.then.equals(t.then)}hashCode(){return n.mash(n.mix(p.hash(wi),this.then.hashCode()))}debugThen(t){return t=t.write(46).write("children").write(40).write(41),t=this.then.debugThen(t)}clone(){return new wi(this.then.clone())}}class gi extends li{constructor(t){super(),this.then=t}forSelected(t,e,r){let i;if(t.willSelect(this),0!==t.scopeDepth){const n=t.popScope().toValue();if(n instanceof mr){const s=n.iterator();for(;void 0===i&&s.hasNext();){const n=s.next().value;t.pushScope(n),i=this.then.forSelected(t,e,r),void 0===i&&this.forSelected(t,e,r),t.popScope()}}t.pushScope(n)}return t.didSelect(this,i),i}mapSelected(t,e,r){let i;if(t.willTransform(this),0!==t.scopeDepth){const n=t.popScope().toValue();if(n instanceof mr){const i=n.iterator();for(;i.hasNext();){const n=i.next().value;t.pushScope(n);let s=this.then.mapSelected(t,e,r);s.isDefined()&&(s=this.mapSelected(t,e,r)),t.popScope(),s.isDefined()?s!==n&&i.set(s):i.delete()}}t.pushScope(n),i=n}else i=ar.absent();return t.didTransform(this,i),i}substitute(t){t=Lr.fromAny(t);let e=this.then.substitute(t);return e instanceof li||(e=this.then),new gi(e)}andThen(t){return new gi(this.then.andThen(t))}get typeOrder(){return 18}compareTo(t){return t instanceof gi?this.then.compareTo(t.then):t instanceof ar?h.compare(this.typeOrder,t.typeOrder):NaN}equivalentTo(t,e){return this===t||t instanceof gi&&this.then.equivalentTo(t.then,e)}equals(t){return this===t||t instanceof gi&&this.then.equals(t.then)}hashCode(){return n.mash(n.mix(p.hash(gi),this.then.hashCode()))}debugThen(t){return t=t.write(46).write("descendants").write(40).write(41),t=this.then.debugThen(t)}clone(){return new gi(this.then.clone())}}class vi extends li{constructor(t,e){super(),this.predicate=t,this.then=e}forSelected(t,e,r){let i;return t.willSelect(this),0!==t.scopeDepth&&this.filterSelected(t)&&(i=this.then.forSelected(t,e,r)),t.didSelect(this,i),i}mapSelected(t,e,r){let i;return t.willTransform(this),i=0!==t.scopeDepth?this.filterSelected(t)?this.then.mapSelected(t,e,r):t.peekScope().toValue():ar.absent(),t.didTransform(this,i),i}substitute(t){t=Lr.fromAny(t);let e=this.predicate.substitute(t);e instanceof li||(e=this.predicate);let r=this.then.substitute(t);return r instanceof li||(r=this.then),new vi(e,r)}filterSelected(t){return void 0!==this.predicate.forSelected(t,this.selected,this)}selected(t){return null}andThen(t){return new vi(this.predicate,this.then.andThen(t))}filter(t){return 0===arguments.length?this:(t=ar.fromAny(t),this.andThen(t.filter()))}get typeOrder(){return 19}compareTo(t){if(t instanceof vi){let e=this.predicate.compareTo(t.predicate);return 0===e&&(e=this.then.compareTo(t.then)),e}return t instanceof ar?h.compare(this.typeOrder,t.typeOrder):NaN}equivalentTo(t,e){return this===t||t instanceof vi&&(this.predicate.equivalentTo(t.predicate,e)&&this.then.equivalentTo(t.then,e))}equals(t){return this===t||t instanceof vi&&(this.predicate.equals(t.predicate)&&this.then.equals(t.then))}hashCode(){return n.mash(n.mix(n.mix(p.hash(vi),this.predicate.hashCode()),this.then.hashCode()))}debugThen(t){return t=t.write(46).write("filter").write(40).debug(this.predicate).write(41),t=this.then.debugThen(t)}clone(){return new vi(this.predicate.clone(),this.then.clone())}}class bi extends li{constructor(t,e){super(),this.item=t.commit(),this.then=e}forSelected(t,e,r){let i;if(t.willSelect(this),0!==t.scopeDepth){const n=this.item.evaluate(t);n.isDefined()&&(t.pushScope(n),i=this.then.forSelected(t,e,r),t.popScope())}return t.didSelect(this,i),i}mapSelected(t,e,r){let i;if(t.willTransform(this),0!==t.scopeDepth){let n=this.item.evaluate(t);n.isDefined()&&(t.pushScope(n),n=this.then.mapSelected(t,e,r),t.popScope()),i=n}else i=ar.absent();return t.didTransform(this,i),i}substitute(t){t=Lr.fromAny(t);const e=this.item.substitute(t);let r=this.then.substitute(t);return r instanceof li||(r=this.then),new bi(e,r)}andThen(t){return new bi(this.item,this.then.andThen(t))}get precedence(){return this.item.precedence}get typeOrder(){return 11}compareTo(t){if(t instanceof bi){let e=this.item.compareTo(t.item);return 0===e&&(e=this.then.compareTo(t.then)),e}return t instanceof ar?h.compare(this.typeOrder,t.typeOrder):NaN}equivalentTo(t,e){return this===t||t instanceof bi&&(this.item.equivalentTo(t.item,e)&&this.then.equivalentTo(t.then,e))}equals(t){return this===t||t instanceof bi&&(this.item.equals(t.item)&&this.then.equals(t.then))}hashCode(){return n.mash(n.mix(n.mix(p.hash(bi),this.item.hashCode()),this.then.hashCode()))}debug(t){return t=t.write("Selector").write(46).write("literal").write(40).debug(this.item).write(41),t=this.then.debugThen(t)}debugThen(t){return t}clone(){return new bi(this.item.clone(),this.then.clone())}}class xi extends Pr{constructor(){super()}isConstant(){return!1}expand(t,e,r){}}class Ci extends xi{constructor(t,e){super(),this.bindings=t,this.template=e}get precedence(){return 1}invoke(t,e,r){e=Lr.fromAny(e);const i=this.bindings,n=Math.max(1,i.length),s=mr.create(n);let o=0,a=0;for(;o<n;){const e=i instanceof mr?i.getItem(o):0===o?i:ar.absent(),r=t instanceof mr?t.getItem(a).toValue():0===a?t:yr.absent();e instanceof Sr&&r.isDistinct()?(s.push(lr.of(e,r)),a+=1):e instanceof lr&&(r.isDistinct()?s.push(e.updatedValue(r)):s.push(e),a+=1),o+=1}e.pushScope(s);const u=this.template.evaluate(e);return e.popScope(),u}get typeOrder(){return 50}compareTo(t){if(t instanceof Ci){let e=this.bindings.compareTo(t.bindings);return 0===e&&(e=this.template.compareTo(t.template)),e}return t instanceof ar?h.compare(this.typeOrder,t.typeOrder):NaN}equivalentTo(t,e){return this===t||t instanceof Ci&&(this.bindings.equivalentTo(t.bindings,e)&&this.template.equivalentTo(t.template,e))}equals(t){return this===t||t instanceof Ci&&(this.bindings.equals(t.bindings)&&this.template.equals(t.template))}hashCode(){return n.mash(n.mix(n.mix(p.hash(Ci),this.bindings.hashCode()),this.template.hashCode()))}debug(t){return t=t.debug(this.bindings).write(46).write("lambda").write(40).debug(this.template).write(41)}}class Oi extends xi{get typeOrder(){return 51}compareTo(t){return t instanceof Oi?p.compare(this.constructor,t.constructor):t instanceof ar?h.compare(this.typeOrder,t.typeOrder):NaN}equivalentTo(t){return this===t}equals(t){return this===t}hashCode(){return p.hash(this.constructor)}debug(t){return t=t.write(this.constructor.name)}}const Si=function(){const t={};Object.defineProperty(t,"max",{get(){const r=new e;return Object.defineProperty(t,"max",{value:r,enumerable:!0,configurable:!0}),r},enumerable:!0,configurable:!0}),Object.defineProperty(t,"min",{get(){const e=new r;return Object.defineProperty(t,"min",{value:e,enumerable:!0,configurable:!0}),e},enumerable:!0,configurable:!0}),Object.defineProperty(t,"abs",{get(){const e=new i;return Object.defineProperty(t,"abs",{value:e,enumerable:!0,configurable:!0}),e},enumerable:!0,configurable:!0}),Object.defineProperty(t,"ceil",{get(){const e=new n;return Object.defineProperty(t,"ceil",{value:e,enumerable:!0,configurable:!0}),e},enumerable:!0,configurable:!0}),Object.defineProperty(t,"floor",{get(){const e=new s;return Object.defineProperty(t,"floor",{value:e,enumerable:!0,configurable:!0}),e},enumerable:!0,configurable:!0}),Object.defineProperty(t,"round",{get(){const e=new o;return Object.defineProperty(t,"round",{value:e,enumerable:!0,configurable:!0}),e},enumerable:!0,configurable:!0}),Object.defineProperty(t,"sqrt",{get(){const e=new a;return Object.defineProperty(t,"sqrt",{value:e,enumerable:!0,configurable:!0}),e},enumerable:!0,configurable:!0}),Object.defineProperty(t,"pow",{get(){const e=new u;return Object.defineProperty(t,"pow",{value:e,enumerable:!0,configurable:!0}),e},enumerable:!0,configurable:!0}),Object.defineProperty(t,"rate",{get(){const e=new h;return Object.defineProperty(t,"rate",{value:e,enumerable:!0,configurable:!0}),e},enumerable:!0,configurable:!0}),Object.defineProperty(t,"random",{get(){const e=new l;return Object.defineProperty(t,"random",{value:e,enumerable:!0,configurable:!0}),e},enumerable:!0,configurable:!0}),Object.defineProperty(t,"scope",{get(){const e=mr.create(10).slot("max",t.max).slot("min",t.min).slot("abs",t.abs).slot("ceil",t.ceil).slot("floor",t.floor).slot("round",t.round).slot("pow",t.pow).slot("sqrt",t.sqrt).slot("rate",t.rate).slot("random",t.random).commit();return Object.defineProperty(t,"scope",{value:e,configurable:!0,enumerable:!0}),e},enumerable:!0,configurable:!0});class e extends Oi{invoke(t,e,r){let i,n;if(e=Lr.fromAny(e),t.length>=2?(i=t.getItem(0).evaluate(e),n=t.getItem(1).evaluate(e)):i=t.evaluate(e),void 0!==n)return i.max(n);if(void 0!==r){n=r.state;const t=void 0!==n?i.max(n):i;return r.setState(t),t}return ar.absent()}expand(t,e,r){if(1===t.length)return t=t.evaluate(e).toValue(),this.invoke(t,e,r)}}class r extends Oi{invoke(t,e,r){let i,n;if(e=Lr.fromAny(e),t.length>=2?(i=t.getItem(0).evaluate(e),n=t.getItem(1).evaluate(e)):i=t.evaluate(e),void 0!==n)return i.min(n);if(void 0!==r){n=r.state;const t=void 0!==n?i.min(n):i;return r.setState(t),t}return ar.absent()}expand(t,e,r){if(1===t.length)return t=t.evaluate(e).toValue(),this.invoke(t,e,r)}}class i extends Oi{invoke(t,e,r){return(t=t.evaluate(e).toValue())instanceof kr?t.abs():ar.absent()}}class n extends Oi{invoke(t,e,r){return(t=t.evaluate(e).toValue())instanceof kr?t.ceil():ar.absent()}}class s extends Oi{invoke(t,e,r){return(t=t.evaluate(e).toValue())instanceof kr?t.floor():ar.absent()}}class o extends Oi{invoke(t,e,r){return(t=t.evaluate(e).toValue())instanceof kr?t.round():ar.absent()}}class a extends Oi{invoke(t,e,r){return(t=t.evaluate(e).toValue())instanceof kr?t.sqrt():ar.absent()}}class u extends Oi{invoke(t,e,r){e=Lr.fromAny(e);const i=t.getItem(0).evaluate(e),n=t.getItem(1).evaluate(e);return i instanceof kr&&n instanceof kr?i.pow(n):ar.absent()}}class h extends Oi{invoke(t,e,r){let i,n;if(e=Lr.fromAny(e),t.length>=2?(i=t.getItem(0).evaluate(e).numberValue(NaN),n=t.getItem(1).evaluate(e).numberValue(1e3)):(i=t.evaluate(e).numberValue(NaN),n=1e3),isFinite(i)&&void 0!==r){let t=r.state;if(void 0===t)t={v0:i,t0:Date.now(),dv:0,dt:0},r.setState(t);else{const e=Date.now(),s=e-t.t0;if(s>n&&e>t.t0||s>2*n){const r=i-t.v0;t.v0=i,t.t0=e,t.dv=r,t.dt=s}if(r.setState(t),0!==t.dt){const e=n*t.dv/t.dt;return kr.from(e)}}}return ar.absent()}expand(t,e,r){return t=t.evaluate(e).toValue(),this.invoke(t,e,r)}}class l extends Oi{invoke(t,e,r){const i=(t=t.evaluate(e).toValue()).length>=1?t.getItem(0).numberValue(0):0,n=t.length>=2?t.getItem(1).numberValue(i+1):i+1,s=i+Math.random()*(n-i);return kr.from(s)}}return t}();class Ei extends Error{constructor(t){super(t),Object.setPrototypeOf(this,Ei.prototype)}}class ki{withTag(t){return void 0!==t&&t!==this.tag?new Ai(this,t):this}withUnit(t){return t!==this.unit?new Mi(this,t):this}static forString(){return new Di("")}static forNumber(){return new Ii(0)}static forBoolean(){return new Pi(!1)}static forAny(){return new Ti(void 0)}static forItem(){return new Vi(ar.absent())}static forValue(){return new Fi(yr.absent())}}e([s],ki,"forString",null),e([s],ki,"forNumber",null),e([s],ki,"forBoolean",null),e([s],ki,"forAny",null),e([s],ki,"forItem",null),e([s],ki,"forValue",null),Object.defineProperty(ki.prototype,"tag",{get(){},configurable:!0}),Object.defineProperty(ki.prototype,"unit",{get(){},configurable:!0});class Ai extends ki{constructor(t,e){super(),this.form=t,this.tag=e}withTag(t){return void 0!==t&&t!==this.tag?new Ai(this.form,t):void 0===t?this.form:this}withUnit(t){return t!==this.unit?new Ai(this.form.withUnit(t),this.tag):this}mold(t,e){return(e=this.form.mold(t,e)).header(this.tag).isDefined()||(e=e.prepended(dr.of(this.tag))),e}cast(t,e){return t.header(this.tag).isDefined()?this.form.cast(t,e):t.keyEquals(this.tag)?this.form.cast(t.toValue(),e):void 0}}Object.defineProperty(Ai.prototype,"unit",{get(){return this.form.unit},configurable:!0});class Mi extends ki{constructor(t,e){super(),this.form=t,Object.defineProperty(this,"unit",{value:e,enumerable:!0})}withTag(t){return t!==this.tag?new Mi(this.form.withTag(t),this.unit):this}withUnit(t){return t!==this.unit?new Mi(this.form,t):t===this.form.unit?this.form:this}mold(t,e){return 1===arguments.length?this.form.mold(t):this.form.mold(t,e)}cast(t,e){return 1===arguments.length?this.form.cast(t):this.form.cast(t,e)}}Object.defineProperty(Mi.prototype,"tag",{get(){return this.form.tag},configurable:!0});class Di extends ki{constructor(t){super(),Object.defineProperty(this,"unit",{value:t,enumerable:!0})}withUnit(t){return t!==this.unit?new Di(t):this}mold(t,e){return void 0===e?Sr.from(t):e.concat(Sr.from(t))}cast(t,e){const r=t.target;try{return r.stringValue()}catch(t){return}}}class Ii extends ki{constructor(t){super(),Object.defineProperty(this,"unit",{value:t,enumerable:!0})}withUnit(t){return t!==this.unit?new Ii(t):this}mold(t,e){return void 0===e?kr.from(t):e.concat(kr.from(t))}cast(t,e){const r=t.target;try{return r.numberValue()}catch(t){return}}}class Pi extends ki{constructor(t){super(),Object.defineProperty(this,"unit",{value:t,enumerable:!0})}withUnit(t){return t!==this.unit?new Pi(t):this}mold(t,e){return void 0===e?Mr.from(t):e.concat(Mr.from(t))}cast(t,e){const r=t.target;try{return r.booleanValue()}catch(t){return}}}class Ti extends ki{constructor(t){super(),Object.defineProperty(this,"unit",{value:t,enumerable:!0})}withUnit(t){return t!==this.unit?new Ti(t):this}mold(t,e){return t=ar.fromAny(t),void 0!==e&&(t=e.concat(t)),t}cast(t,e){return t.toAny()}}class Vi extends ki{constructor(t){super(),Object.defineProperty(this,"unit",{value:void 0!==t?t.commit():void 0,enumerable:!0})}withUnit(t){return t!==this.unit?new Vi(t):this}mold(t,e){return t=ar.fromAny(t),void 0!==e&&(t=e.concat(t)),t}cast(t,e){return t}}class Fi extends ki{constructor(t){super(),Object.defineProperty(this,"unit",{value:void 0!==t?t.commit():void 0,enumerable:!0})}withUnit(t){return t!==this.unit?new Fi(t):this}mold(t,e){return t=yr.fromAny(t),void 0!==e&&(t=e.concat(t)),t}cast(t,e){return t.toValue()}}class qi extends _{constructor(t,e){super(),this.cursor=t,this.form=e}isEmpty(){return this.cursor.isEmpty()}head(){return this.cursor.head().coerce(this.form)}step(){this.cursor.step()}skip(t){this.cursor.skip(t)}hasNext(){return this.cursor.hasNext()}nextIndex(){return this.cursor.nextIndex()}next(){const{value:t,done:e}=this.cursor.next();return void 0!==t?{value:t.coerce(this.form),done:e}:{done:e}}hasPrevious(){return this.cursor.hasPrevious()}previousIndex(){return this.cursor.previousIndex()}previous(){const{value:t,done:e}=this.cursor.previous();return void 0!==t?{value:t.coerce(this.form),done:e}:{done:e}}delete(){this.cursor.delete()}}class Ui extends _{constructor(t,e,r){super(),this.cursor=t,this.keyForm=e,this.valueForm=r}isEmpty(){return this.cursor.isEmpty()}head(){const t=this.cursor.head();return[t[0].coerce(this.keyForm),t[1].coerce(this.valueForm)]}step(){this.cursor.step()}skip(t){this.cursor.skip(t)}hasNext(){return this.cursor.hasNext()}nextIndex(){return this.cursor.nextIndex()}next(){const{value:t,done:e}=this.cursor.next();return void 0!==t?{value:[t[0].coerce(this.keyForm),t[1].coerce(this.valueForm)],done:e}:{done:e}}hasPrevious(){return this.cursor.hasPrevious()}previousIndex(){return this.cursor.previousIndex()}previous(){const{value:t,done:e}=this.cursor.previous();return void 0!==t?{value:[t[0].coerce(this.keyForm),t[1].coerce(this.valueForm)],done:e}:{done:e}}delete(){this.cursor.delete()}}const Ri=function(){const t={is:function(t){if("object"==typeof t&&null!==t||"function"==typeof t){const e=t;return"input"in e&&"function"==typeof e.bindInput&&"function"==typeof e.unbindInput}return!1}};return t}(),Ni=function(){const t={is:function(t){if("object"==typeof t&&null!==t){const e=t;return"function"==typeof e.outputIterator&&"function"==typeof e.bindOutput&&"function"==typeof e.unbindOutput}return!1}};return t}(),zi=function(){const t={define:function(e){Object.prototype.hasOwnProperty.call(e,"memoize")||(e.memoize=t.memoize),Object.prototype.hasOwnProperty.call(e,"map")||(e.map=t.map),Object.prototype.hasOwnProperty.call(e,"watch")||(e.watch=t.watch)},memoize:function(){const t=new on;return t.bindInput(this),t},map:function(t){const e=new cn(t);return e.bindInput(this),e},watch:function(t){return new wn(t).bindInput(this),this}};return t}();var ji;t.KeyEffect=void 0,(ji=t.KeyEffect||(t.KeyEffect={}))[ji.Update=0]="Update",ji[ji.Remove=1]="Remove";const Li=function(){const t={is:function(t){if("object"==typeof t&&null!==t){const e=t;return Ri.is(e)&&"function"==typeof e.decohereOutputKey&&"function"==typeof e.recohereOutputKey}return!1}};return t}(),Ki=function(){const t={is:function(t){if("object"==typeof t&&null!==t){const e=t;return Ni.is(e)&&"function"==typeof e.keyIterator&&"function"==typeof e.outlet}return!1}};return t}(),Bi=function(){const t={define:function(e){Object.prototype.hasOwnProperty.call(e,"memoize")||(e.memoize=t.memoize),Object.prototype.hasOwnProperty.call(e,"filterr")||(e.filter=t.filter),Object.prototype.hasOwnProperty.call(e,"map")||(e.map=t.map),Object.prototype.hasOwnProperty.call(e,"reduce")||(e.reduce=t.reduce),Object.prototype.hasOwnProperty.call(e,"watch")||(e.watch=t.watch)},memoize:function(){const t=new an;return t.bindInput(this),t},filter:function(t){const e=new hn(t);return e.bindInput(this),e},map:function(t){if(1===t.length){const e=new cn(t);return e.bindInput(this),e}{const e=new pn(t);return e.bindInput(this),e}},reduce:function(t,e,r){const i=new yn(t,e,r);return i.bindInput(this),i},watch:function(t){if(1===t.length){return new wn(t).bindInput(this),this}return new vn(t).bindInput(this),this}};return t}();class Wi extends Error{constructor(t){super(t),Object.setPrototypeOf(this,Wi.prototype)}}const Hi=function(){const t={is:function(t){if("object"==typeof t&&null!==t||"function"==typeof t){const e=t;return"streamletScope"in e&&"streamletContext"in e&&"function"==typeof e.outlet}return!1}};return t}(),Xi=function(){const t={is:function(t){if("object"==typeof t&&null!==t||"function"==typeof t){const e=t;return"streamletScope"in e&&"function"==typeof e.setStreamletScope&&"streamletContext"in e&&"function"==typeof e.setStreamletContext}return!1}};return t}();class Yi{constructor(){this.input=null,this.version=-1}bindInput(t){const e=this.input;e!==t&&(null!==e&&e.unbindOutput(this),this.input=t,null!==t&&t.bindOutput(this))}unbindInput(){const t=this.input;null!==t&&(t.unbindOutput(this),this.input=null)}disconnectInputs(){const t=this.input;null!==t&&(t.unbindOutput(this),this.input=null,t.disconnectInputs())}disconnectOutputs(){}decohereOutput(){this.version>=0&&(this.willDecohereOutput(),this.version=-1,this.onDecohereOutput(),this.didDecohereOutput())}recohereOutput(t){this.version<0&&(this.willRecohereOutput(t),this.version=t,null!==this.input&&this.input.recohereInput(t),this.onRecohereOutput(t),this.didRecohereOutput(t))}willDecohereOutput(){}onDecohereOutput(){}didDecohereOutput(){}willRecohereOutput(t){}onRecohereOutput(t){}didRecohereOutput(t){}}class Gi{constructor(){this.outputs=v.empty,this.version=-1}outputIterator(){return _.array(this.outputs)}bindOutput(t){this.outputs=v.inserted(t,this.outputs)}unbindOutput(t){this.outputs=v.removed(t,this.outputs)}unbindOutputs(){const t=this.outputs;this.outputs=v.empty;for(let e=0,r=t.length;e<r;e+=1){t[e].unbindInput()}}disconnectOutputs(){const t=this.outputs;this.outputs=v.empty;for(let e=0,r=t.length;e<r;e+=1){const r=t[e];r.unbindInput(),r.disconnectOutputs()}}disconnectInputs(){}decohereInput(){if(this.version>=0){this.willDecohereInput(),this.version=-1,this.onDecohereInput();const t=this.outputs;for(let e=0,r=t.length;e<r;e+=1)t[e].decohereOutput();this.didDecohereInput()}}recohereInput(t){if(this.version<0){this.willRecohereInput(t),this.version=t,this.onRecohereInput(t);const e=this.outputs;for(let r=0,i=e.length;r<i;r+=1)e[r].recohereOutput(t);this.didRecohereInput(t)}}willDecohereInput(){}onDecohereInput(){}didDecohereInput(){}willRecohereInput(t){}onRecohereInput(t){}didRecohereInput(t){}}zi.define(Gi.prototype);class _i{constructor(){this.input=null,this.outputs=v.empty,this.version=-1}bindInput(t){const e=this.input;e!==t&&(null!==e&&e.unbindOutput(this),this.input=t,null!==t&&t.bindOutput(this))}unbindInput(){const t=this.input;null!==t&&(t.unbindOutput(this),this.input=null)}disconnectInputs(){const t=this.input;null!==t&&(t.unbindOutput(this),this.input=null,t.disconnectInputs())}outputIterator(){return _.array(this.outputs)}bindOutput(t){this.outputs=v.inserted(t,this.outputs)}unbindOutput(t){this.outputs=v.removed(t,this.outputs)}unbindOutputs(){const t=this.outputs;this.outputs=v.empty;for(let e=0,r=t.length;e<r;e+=1){t[e].unbindInput()}}disconnectOutputs(){const t=this.outputs;this.outputs=v.empty;for(let e=0,r=t.length;e<r;e+=1){const r=t[e];r.unbindInput(),r.disconnectOutputs()}}decohereOutput(){this.decohere()}decohereInput(){this.decohere()}decohere(){if(this.version>=0){this.willDecohere(),this.version=-1,this.onDecohere();const t=this.outputs;for(let e=0,r=t.length;e<r;e+=1)t[e].decohereOutput();this.didDecohere()}}recohereOutput(t){this.recohere(t)}recohereInput(t){this.recohere(t)}recohere(t){if(this.version<0){this.willRecohere(t),this.version=t,null!==this.input&&this.input.recohereInput(t),this.onRecohere(t);const e=this.outputs;for(let r=0,i=e.length;r<i;r+=1)e[r].recohereOutput(t);this.didRecohere(t)}}willDecohere(){}onDecohere(){}didDecohere(){}willRecohere(t){}onRecohere(t){}didRecohere(t){}}zi.define(_i.prototype);class Qi extends Gi{constructor(t,e){super(),this.input=t,this.key=e}get(){return this.input.get(this.key)}}class Zi{constructor(){this.input=null,this.effects=new Te,this.version=-1}bindInput(t){if(!Ki.is(t))throw new TypeError(""+t);const e=this.input;e!==t&&(null!==e&&e.unbindOutput(this),this.input=t,null!==t&&t.bindOutput(this))}unbindInput(){const t=this.input;null!==t&&(t.unbindOutput(this),this.input=null)}disconnectInputs(){const t=this.input;null!==t&&(t.unbindOutput(this),this.input=null,t.disconnectInputs())}disconnectOutputs(){}decohereOutputKey(t,e){const r=this.effects;r.get(t)!==e&&(this.willDecohereOutputKey(t,e),this.effects=r.updated(t,e),this.version=-1,this.onDecohereOutputKey(t,e),this.didDecohereOutputKey(t,e))}decohereOutput(){this.version>=0&&(this.willDecohereOutput(),this.version=-1,this.onDecohereOutput(),this.didDecohereOutput())}recohereOutputKey(t,e){if(this.version<0){const r=this.effects,i=r.get(t);void 0!==i&&(this.willRecohereOutputKey(t,i,e),this.effects=r.removed(t),null!==this.input&&this.input.recohereInputKey(t,e),this.onRecohereOutputKey(t,i,e),this.didRecohereOutputKey(t,i,e))}}recohereOutput(t){this.version<0&&(this.willRecohereOutput(t),this.effects.forEach((function(e){this.recohereOutputKey(e,t)}),this),this.version=t,this.onRecohereOutput(t),this.didRecohereOutput(t))}willDecohereOutputKey(t,e){}onDecohereOutputKey(t,e){}didDecohereOutputKey(t,e){}willDecohereOutput(){}onDecohereOutput(){}didDecohereOutput(){}willRecohereOutputKey(t,e,r){}onRecohereOutputKey(t,e,r){}didRecohereOutputKey(t,e,r){}willRecohereOutput(t){}onRecohereOutput(t){}didRecohereOutput(t){}}class Ji{constructor(){this.effects=new Te,this.outlets=new Te,this.outputs=v.empty,this.version=-1}outlet(t){const e=this.outlets;let r=e.get(t);return void 0===r&&(r=new Qi(this,t),this.outlets=e.updated(t,r)),r}outputIterator(){return _.array(this.outputs)}bindOutput(t){this.outputs=v.inserted(t,this.outputs)}unbindOutput(t){this.outputs=v.removed(t,this.outputs)}unbindOutputs(){const t=this.outlets;t.isEmpty()&&(this.outlets=new Te,t.forEach((function(t,e){e.unbindOutputs()}),this));const e=this.outputs;this.outputs=v.empty;for(let t=0,r=e.length;t<r;t+=1){e[t].unbindInput()}}disconnectOutputs(){const t=this.outlets;t.isEmpty()&&(this.outlets=new Te,t.forEach((function(t,e){e.disconnectOutputs()}),this));const e=this.outputs;this.outputs=v.empty;for(let t=0,r=e.length;t<r;t+=1){const r=e[t];r.unbindInput(),r.disconnectOutputs()}}disconnectInputs(){}decohereInputKey(t,e){const r=this.effects;if(r.get(t)!==e){this.willDecohereInputKey(t,e),this.effects=r.updated(t,e),this.version=-1,this.onDecohereInputKey(t,e);const i=this.outputs;for(let r=0,n=i.length;r<n;r+=1){const n=i[r];Li.is(n)?n.decohereOutputKey(t,e):n.decohereOutput()}const n=this.outlets.get(t);void 0!==n&&n.decohereInput(),this.didDecohereInputKey(t,e)}}decohereInput(){if(this.version>=0){this.willDecohereInput(),this.version=-1,this.onDecohereInput();const t=this.outputs;for(let e=0,r=t.length;e<r;e+=1){t[e].decohereOutput()}this.outlets.forEach((function(t,e){e.decohereInput()}),this),this.didDecohereInput()}}recohereInputKey(t,e){if(this.version<0){const r=this.effects,i=r.get(t);if(void 0!==i){this.willRecohereInputKey(t,i,e),this.effects=r.removed(t),this.onRecohereInputKey(t,i,e);const n=this.outputs;for(let r=0,i=n.length;r<i;r+=1){const i=n[r];Li.is(i)&&i.recohereOutputKey(t,e)}const s=this.outlets.get(t);void 0!==s&&s.recohereInput(e),this.didRecohereInputKey(t,i,e)}}}recohereInput(t){if(this.version<0){this.willRecohereInput(t),this.effects.forEach((function(e){this.recohereInputKey(e,t)}),this),this.version=t,this.onRecohereInput(t);const e=this.outputs;for(let r=0,i=e.length;r<i;r+=1){e[r].recohereOutput(t)}this.didRecohereInput(t)}}willDecohereInputKey(t,e){}onDecohereInputKey(t,e){}didDecohereInputKey(t,e){}willDecohereInput(){}onDecohereInput(){}didDecohereInput(){}willRecohereInputKey(t,e,r){}onRecohereInputKey(t,e,r){}didRecohereInputKey(t,e,r){}willRecohereInput(t){}onRecohereInput(t){}didRecohereInput(t){}}Bi.define(Ji.prototype);class $i{constructor(){this.input=null,this.effects=new Te,this.outlets=new Te,this.outputs=v.empty,this.version=-1}bindInput(t){if(!Ki.is(t))throw new TypeError(""+t);const e=this.input;e!==t&&(null!==e&&e.unbindOutput(this),this.input=t,null!==t&&t.bindOutput(this))}unbindInput(){const t=this.input;null!==t&&(t.unbindOutput(this),this.input=null)}disconnectInputs(){const t=this.input;null!==t&&(t.unbindOutput(this),this.input=null,t.disconnectInputs())}outlet(t){const e=this.outlets;let r=e.get(t);return void 0===r&&(r=new Qi(this,t),this.outlets=e.updated(t,r)),r}outputIterator(){return _.array(this.outputs)}bindOutput(t){this.outputs=v.inserted(t,this.outputs)}unbindOutput(t){this.outputs=v.removed(t,this.outputs)}unbindOutputs(){const t=this.outlets;t.isEmpty()&&(this.outlets=new Te,t.forEach((function(t,e){e.unbindOutputs()}),this));const e=this.outputs;this.outputs=v.empty;for(let t=0,r=e.length;t<r;t+=1){e[t].unbindInput()}}disconnectOutputs(){const t=this.outlets;t.isEmpty()&&(this.outlets=new Te,t.forEach((function(t,e){e.disconnectOutputs()}),this));const e=this.outputs;this.outputs=v.empty;for(let t=0,r=e.length;t<r;t+=1){const r=e[t];r.unbindInput(),r.disconnectOutputs()}}decohereOutputKey(t,e){this.decohereKey(t,e)}decohereInputKey(t,e){this.decohereKey(t,e)}decohereKey(t,e){const r=this.effects;if(r.get(t)!==e){this.willDecohereKey(t,e),this.effects=r.updated(t,e),this.version=-1,this.onDecohereKey(t,e);const i=this.outputs;for(let r=0,n=i.length;r<n;r+=1){const n=i[r];Li.is(n)?n.decohereOutputKey(t,e):n.decohereOutput()}const n=this.outlets.get(t);void 0!==n&&n.decohereInput(),this.didDecohereKey(t,e)}}decohereOutput(){this.decohere()}decohereInput(){this.decohere()}decohere(){if(this.version>=0){this.willDecohere(),this.version=-1,this.onDecohere();const t=this.outputs;for(let e=0,r=t.length;e<r;e+=1){t[e].decohereOutput()}this.outlets.forEach((function(t,e){e.decohereInput()}),this),this.didDecohere()}}recohereOutputKey(t,e){this.recohereKey(t,e)}recohereInputKey(t,e){this.recohereKey(t,e)}recohereKey(t,e){if(this.version<0){const r=this.effects,i=r.get(t);if(void 0!==i){this.willRecohereKey(t,i,e),this.effects=r.removed(t),null!==this.input&&this.input.recohereInputKey(t,e),this.onRecohereKey(t,i,e);const n=this.outputs;for(let r=0,i=n.length;r<i;r+=1){const i=n[r];Li.is(i)&&i.recohereOutputKey(t,e)}const s=this.outlets.get(t);void 0!==s&&s.recohereInput(e),this.didRecohereKey(t,i,e)}}}recohereOutput(t){this.recohere(t)}recohereInput(t){this.recohere(t)}recohere(t){if(this.version<0){this.willRecohere(t),this.effects.forEach((function(e){this.recohereKey(e,t)}),this),this.version=t,this.onRecohere(t);const e=this.outputs;for(let r=0,i=e.length;r<i;r+=1){e[r].recohereOutput(t)}this.didRecohere(t)}}willDecohereKey(t,e){}onDecohereKey(t,e){}didDecohereKey(t,e){}willDecohere(){}onDecohere(){}didDecohere(){}willRecohereKey(t,e,r){}onRecohereKey(t,e,r){}didRecohereKey(t,e,r){}willRecohere(t){}onRecohere(t){}didRecohere(t){}}Bi.define($i.prototype);class tn{constructor(){this.input=null,this.effects=new Te,this.outputs=v.empty,this.version=-1}bindInput(t){if(!Ki.is(t))throw new TypeError(""+t);const e=this.input;e!==t&&(null!==e&&e.unbindOutput(this),this.input=t,null!==t&&t.bindOutput(this))}unbindInput(){const t=this.input;null!==t&&(t.unbindOutput(this),this.input=null)}disconnectInputs(){const t=this.input;null!==t&&(t.unbindOutput(this),this.input=null,t.disconnectInputs())}outputIterator(){return _.array(this.outputs)}bindOutput(t){this.outputs=v.inserted(t,this.outputs)}unbindOutput(t){this.outputs=v.removed(t,this.outputs)}unbindOutputs(){const t=this.outputs;this.outputs=v.empty;for(let e=0,r=t.length;e<r;e+=1){t[e].unbindInput()}}disconnectOutputs(){const t=this.outputs;this.outputs=v.empty;for(let e=0,r=t.length;e<r;e+=1){const r=t[e];r.unbindInput(),r.disconnectOutputs()}}decohereOutputKey(t,e){const r=this.effects;if(r.get(t)!==e){this.willDecohereOutputKey(t,e),this.effects=r.updated(t,e),this.version=-1,this.onDecohereOutputKey(t,e);const i=this.outputs;for(let t=0,e=i.length;t<e;t+=1){i[t].decohereOutput()}this.didDecohereOutputKey(t,e)}}decohereOutput(){this.decohere()}decohereInput(){this.decohere()}decohere(){if(this.version>=0){this.willDecohere(),this.version=-1,this.onDecohere();const t=this.outputs;for(let e=0,r=t.length;e<r;e+=1){t[e].decohereOutput()}this.didDecohere()}}recohereOutputKey(t,e){if(this.version<0){const r=this.effects,i=r.get(t);void 0!==i&&(this.willRecohereOutputKey(t,i,e),this.effects=r.removed(t),null!==this.input&&this.input.recohereInputKey(t,e),this.onRecohereOutputKey(t,i,e),this.didRecohereOutputKey(t,i,e))}}recohereOutput(t){this.recohere(t)}recohereInput(t){this.recohere(t)}recohere(t){if(this.version<0){this.willRecohere(t),this.effects.forEach((function(e){this.recohereOutputKey(e,t)}),this),this.version=t,this.onRecohere(t);const e=this.outputs;for(let r=0,i=e.length;r<i;r+=1){e[r].recohereOutput(t)}this.didRecohere(t)}}willDecohereOutputKey(t,e){}onDecohereOutputKey(t,e){}didDecohereOutputKey(t,e){}willDecohere(){}onDecohere(){}didDecohere(){}willRecohereOutputKey(t,e,r){}onRecohereOutputKey(t,e,r){}didRecohereOutputKey(t,e,r){}willRecohere(t){}onRecohere(t){}didRecohere(t){}}zi.define(tn.prototype);class en{constructor(){this.input=null,this.outputEffects=new Te,this.inputEffects=new Te,this.outlets=new Te,this.outputs=v.empty,this.version=-1}bindInput(t){if(!Ki.is(t))throw new TypeError(""+t);const e=this.input;e!==t&&(null!==e&&e.unbindOutput(this),this.input=t,null!==t&&t.bindOutput(this))}unbindInput(){const t=this.input;null!==t&&(t.unbindOutput(this),this.input=null)}disconnectInputs(){const t=this.input;null!==t&&(t.unbindOutput(this),this.input=null,t.disconnectInputs())}outlet(t){const e=this.outlets;let r=e.get(t);return void 0===r&&(r=new Qi(this,t),this.outlets=e.updated(t,r)),r}outputIterator(){return _.array(this.outputs)}bindOutput(t){this.outputs=v.inserted(t,this.outputs)}unbindOutput(t){this.outputs=v.removed(t,this.outputs)}unbindOutputs(){const t=this.outlets;t.isEmpty()&&(this.outlets=new Te,t.forEach((function(t,e){e.unbindOutputs()}),this));const e=this.outputs;this.outputs=v.empty;for(let t=0,r=e.length;t<r;t+=1){e[t].unbindInput()}}disconnectOutputs(){const t=this.outlets;t.isEmpty()&&(this.outlets=new Te,t.forEach((function(t,e){e.disconnectOutputs()}),this));const e=this.outputs;this.outputs=v.empty;for(let t=0,r=e.length;t<r;t+=1){const r=e[t];r.unbindInput(),r.disconnectOutputs()}}decohereOutputKey(t,e){const r=this.outputEffects;r.get(t)!==e&&(this.willDecohereOutputKey(t,e),this.outputEffects=r.updated(t,e),this.version=-1,this.onDecohereOutputKey(t,e),this.didDecohereOutputKey(t,e))}decohereInputKey(t,e){const r=this.inputEffects;if(r.get(t)!==e){this.willDecohereInputKey(t,e),this.inputEffects=r.updated(t,e),this.version=-1,this.onDecohereInputKey(t,e);const i=this.outputs;for(let r=0,n=i.length;r<n;r+=1){const n=i[r];Li.is(n)?n.decohereOutputKey(t,e):n.decohereOutput()}const n=this.outlets.get(t);void 0!==n&&n.decohereInput(),this.didDecohereInputKey(t,e)}}decohereOutput(){this.decohere()}decohereInput(){this.decohere()}decohere(){if(this.version>=0){this.willDecohere(),this.version=-1,this.onDecohere();const t=this.outputs;for(let e=0,r=t.length;e<r;e+=1){t[e].decohereOutput()}this.outlets.forEach((function(t,e){e.decohereInput()}),this),this.didDecohere()}}recohereOutputKey(t,e){if(this.version<0){const r=this.outputEffects,i=r.get(t);void 0!==i&&(this.willRecohereOutputKey(t,i,e),this.outputEffects=r.removed(t),null!==this.input&&this.input.recohereInputKey(t,e),this.onRecohereOutputKey(t,i,e),this.didRecohereOutputKey(t,i,e))}}recohereInputKey(t,e){if(this.version<0){const r=this.inputEffects,i=r.get(t);if(void 0!==i){const n=this.willRecohereInputKey(t,i,e);i!==n&&this.decohereInputKey(t,n),this.inputEffects=r.removed(t),this.onRecohereInputKey(t,n,e);const s=this.outputs;for(let r=0,i=s.length;r<i;r+=1){const i=s[r];Li.is(i)&&i.recohereOutputKey(t,e)}const o=this.outlets.get(t);void 0!==o&&o.recohereInput(e),this.didRecohereInputKey(t,n,e)}}}recohereOutput(t){this.recohere(t)}recohereInput(t){this.recohere(t)}recohere(t){if(this.version<0){this.willRecohere(t),this.outputEffects.forEach((function(e){this.recohereOutputKey(e,t)}),this),this.inputEffects.forEach((function(e){this.recohereInputKey(e,t)}),this),this.version=t,this.onRecohere(t);const e=this.outputs;for(let r=0,i=e.length;r<i;r+=1){e[r].recohereOutput(t)}this.didRecohere(t)}}willDecohereOutputKey(t,e){}onDecohereOutputKey(t,e){}didDecohereOutputKey(t,e){}willDecohereInputKey(t,e){}onDecohereInputKey(t,e){}didDecohereInputKey(t,e){}willDecohere(){}onDecohere(){}didDecohere(){}willRecohereOutputKey(t,e,r){}onRecohereOutputKey(t,e,r){}didRecohereOutputKey(t,e,r){}willRecohereInputKey(t,e,r){return e}onRecohereInputKey(t,e,r){}didRecohereInputKey(t,e,r){}willRecohere(t){}onRecohere(t){}didRecohere(t){}}Bi.define(en.prototype);class rn extends Yi{constructor(t){super(),this.outlet=t}onDecohereOutput(){this.outlet.decohereInput()}onRecohereOutput(t){this.outlet.recohereInput(t)}}class nn extends Zi{constructor(t){super(),this.outlet=t}onDecohereOutputKey(t,e){this.outlet.decohereInput()}onDecohereOutput(){this.outlet.decohereInput()}onRecohereOutputKey(t,e,r){this.outlet.recohereInput(r)}onRecohereOutput(t){this.outlet.recohereInput(t)}}class sn extends Gi{constructor(t){super(),this.state=t}get(){return this.state}set(t){const e=this.state;return e!==t&&(this.state=t,this.decohereInput()),e}}class on extends _i{constructor(){super(),this.state=void 0}get(){return this.state}onRecohere(t){const e=this.input;null!==e&&(this.state=e.get())}memoize(){return this}}class an extends $i{constructor(){super(),this.state=void 0,this.cache=new Te}has(t){return this.cache.has(t)}get(t){if(void 0===t){let t=this.state;const e=this.input;return void 0===t&&null!==e&&(t=e.get(),this.state=t),t}return this.cache.get(t)}keyIterator(){return this.cache.keys()}onRecohereKey(t,e,r){if(0===e){const e=this.input;if(null!==e){const r=e.get(t);this.cache=void 0!==r?this.cache.updated(t,r):this.cache.removed(t)}}else 1===e&&(this.cache=this.cache.removed(t))}onRecohere(t){this.state=void 0}memoize(){return this}}class un extends en{has(t){const e=this.input;if(null!==e){const r=e.get(t);return void 0!==r&&this.evaluate(t,r)}return!1}get(t){if(void 0===t){const t=new Te,e=this.keyIterator();for(;;){const r=e.next();if(r.done)break;{const e=r.value,i=this.input.get(e);void 0!==i&&this.evaluate(e,i)&&t.set(e,i)}}return t}{const e=this.input;if(null!==e){const r=e.get(t);if(void 0!==r&&this.evaluate(t,r))return r}return}}keyIterator(){const t=this.input;return null!==t?t.keyIterator():_.empty()}onDecohereOutputKey(t,e){this.decohereInputKey(t,e)}onRecohereOutputKey(t,e,r){this.recohereInputKey(t,r)}willRecohereInputKey(t,e,r){if(0===e){const e=this.input;if(null!==e){const r=e.get(t);if(void 0===r||!this.evaluate(t,r))return 1}}return e}}class hn extends un{constructor(t){super(),this.func=t}evaluate(t,e){return(0,this.func)(t,e)}}class ln extends _i{get(){const t=this.input;return null!==t?this.evaluate(t.get()):void 0}}class cn extends ln{constructor(t){super(),this.func=t}evaluate(t){if(void 0!==t){return(0,this.func)(t)}}}class dn extends $i{has(t){const e=this.input;return null!==e&&e.has(t)}get(t){if(void 0===t){const t=new Te,e=this.keyIterator();for(;;){const r=e.next();if(r.done)break;{const e=r.value,i=this.evaluate(e,this.input.get(e));void 0!==i&&t.set(e,i)}}return t}{const e=this.input;return null!==e?this.evaluate(t,e.get(t)):void 0}}keyIterator(){const t=this.input;return null!==t?t.keyIterator():_.empty()}}class pn extends dn{constructor(t){super(),this.func=t}evaluate(t,e){if(void 0!==e){return(0,this.func)(t,e)}}}class fn extends tn{constructor(){super(),this.state=new Te}get(){return this.state.reduced(this.identity,this.accumulate.bind(this),this.combine.bind(this))}onRecohereOutputKey(t,e,r){if(0===e){const e=this.input;if(null!==e){const r=e.get(t);void 0!==r?this.state.set(t,r):this.state.delete(t)}}else 1===e&&this.state.delete(t)}}class yn extends fn{constructor(t,e,r){super(),this.identity=t,this.accumulator=e,this.combiner=r}get(){return this.state.reduced(this.identity,this.accumulator,this.combiner)}accumulate(t,e){return(0,this.accumulator)(t,e)}combine(t,e){return(0,this.combiner)(t,e)}}class mn extends Yi{onRecohereOutput(t){const e=this.input;null!==e&&this.evaluate(e.get())}}class wn extends mn{constructor(t){super(),this.func=t}evaluate(t){if(void 0!==t){return(0,this.func)(t)}}}class gn extends Zi{onRecohereOutputKey(t,e,r){if(0===e){const e=this.input;null!==e?this.evaluate(t,e.get(t)):this.evaluate(t,void 0)}else 1===e&&this.evaluate(t,void 0)}}class vn extends gn{constructor(t){super(),this.func=t}evaluate(t,e){if(void 0!==e){return(0,this.func)(t,e)}}}class bn extends Yi{constructor(t){super(),this.streamlet=t}willDecohereOutput(){const t=this.streamlet;void 0!==t.willDecohereInlet&&t.willDecohereInlet(this)}didDecohereOutput(){const t=this.streamlet;void 0!==t.didDecohereInlet?t.didDecohereInlet(this):t.decohere()}willRecohereOutput(t){const e=this.streamlet;void 0!==e.willRecohereInlet&&e.willRecohereInlet(this,t)}didRecohereOutput(t){const e=this.streamlet;void 0!==e.didRecohereInlet?e.didRecohereInlet(this,t):e.recohere(t)}}class xn extends Gi{constructor(t){super(),this.streamlet=t}get(){const t=this.streamlet;return void 0!==t.getOutput?t.getOutput(this):void 0}willDecohereInput(){const t=this.streamlet;void 0!==t.willDecohereOutlet&&t.willDecohereOutlet(this)}didDecohereInput(){const t=this.streamlet;void 0!==t.didDecohereOutlet?t.didDecohereOutlet(this):t.decohere()}willRecohereInput(t){const e=this.streamlet;void 0!==e.willRecohereOutlet&&e.willRecohereOutlet(this,t)}didRecohereInput(t){const e=this.streamlet;void 0!==e.didRecohereOutlet&&e.didRecohereOutlet(this,t)}}class Cn extends _i{constructor(t){super(),this.streamlet=t}get(){const t=this.streamlet;if(void 0!==t.getOutput){const e=t.getOutput(this);if(void 0!==e)return e}const e=this.input;return null!==e?e.get():void 0}willDecohere(){const t=this.streamlet;void 0!==t.willDecohereOutlet&&t.willDecohereOutlet(this)}didDecohere(){const t=this.streamlet;void 0!==t.didDecohereOutlet?t.didDecohereOutlet(this):t.decohere()}willRecohere(t){const e=this.streamlet;void 0!==e.willRecohereOutlet&&e.willRecohereOutlet(this,t)}didRecohere(t){const e=this.streamlet;void 0!==e.didRecohereOutlet&&e.didRecohereOutlet(this,t)}}class On{constructor(t,e,r){this.key=t,this.name=e,this.type=r}}class Sn{constructor(t,e,r){this.key=t,this.name=e,this.type=r}}class En{constructor(t,e,r){this.key=t,this.name=e,this.type=r}}class kn{constructor(t=null){this.streamletScope=t,this.streamletContext=null,this.version=-1}setStreamletScope(t){this.streamletScope=t}setStreamletContext(t){this.streamletContext=t}inlet(t){return void 0===t?new bn(this):kn.reflectInletKey(t,this,Object.getPrototypeOf(this))}bindInput(t,e){const r=this.inlet(t);if(null===r)throw new Error(""+t);r.bindInput(e)}unbindInput(t){const e=this.inlet(t);if(null===e)throw new Error(""+t);e.unbindInput()}outlet(t){return void 0===t?new xn(this):"string"==typeof t?kn.reflectOutletKey(t,this,Object.getPrototypeOf(this)):t}inoutlet(){return new Cn(this)}decohere(){this.version>=0&&(this.willDecohere(),this.version=-1,this.onDecohere(),this.onDecohereOutlets(),this.didDecohere())}recohere(t){this.version<0&&(this.willRecohere(t),this.version=t,this.onRecohereInlets(t),this.onRecohere(t),this.onRecohereOutlets(t),this.didRecohere(t))}getInput(t,e){let r;if("string"==typeof t&&(t=this.inlet(t)),null!==t){const e=t.input;null!==e&&(r=e.get())}return void 0===r&&(r=e),r}getOutput(t){}disconnectInputs(){kn.disconnectInputs(this,Object.getPrototypeOf(this))}static disconnectInputs(t,e){for(;null!==e;){if(Object.prototype.hasOwnProperty.call(e,"inlets"))for(const r in e.inlets){const i=e.inlets[r];if(i instanceof On){kn.reflectInletField(t,i).disconnectInputs()}else if(i instanceof En){kn.reflectInoutletField(t,i).disconnectInputs()}}e=Object.getPrototypeOf(e)}}disconnectOutputs(){kn.disconnectOutputs(this,Object.getPrototypeOf(this))}static disconnectOutputs(t,e){for(;null!==e;){if(Object.prototype.hasOwnProperty.call(e,"outlets"))for(const r in e.outlets){const i=e.outlets[r];if(i instanceof Sn){kn.reflectOutletField(t,i).disconnectOutputs()}else if(i instanceof En){kn.reflectInoutletField(t,i).disconnectOutputs()}}e=Object.getPrototypeOf(e)}}willDecohereInlet(t){}didDecohereInlet(t){this.decohere()}willRecohereInlet(t,e){}didRecohereInlet(t,e){this.recohere(e)}willDecohereOutlet(t){}didDecohereOutlet(t){}willRecohereOutlet(t,e){}didRecohereOutlet(t,e){}willDecohere(){}onDecohere(){}onDecohereOutlets(){kn.decohereOutlets(this,Object.getPrototypeOf(this))}static decohereOutlets(t,e){for(;null!==e;){if(Object.prototype.hasOwnProperty.call(e,"outlets"))for(const r in e.outlets){const i=e.outlets[r];if(i instanceof Sn){kn.reflectOutletField(t,i).decohereInput()}else if(i instanceof En){kn.reflectInoutletField(t,i).decohereInput()}}e=Object.getPrototypeOf(e)}}didDecohere(){}willRecohere(t){}onRecohereInlets(t){kn.recohereInlets(t,this,Object.getPrototypeOf(this))}static recohereInlets(t,e,r){for(;null!==r;){if(Object.prototype.hasOwnProperty.call(r,"inlets"))for(const i in r.inlets){const n=r.inlets[i];if(n instanceof On){kn.reflectInletField(e,n).recohereOutput(t)}else if(n instanceof En){kn.reflectInoutletField(e,n).recohereOutput(t)}}r=Object.getPrototypeOf(r)}}onRecohere(t){}onRecohereOutlets(t){kn.recohereOutlets(t,this,Object.getPrototypeOf(this))}static recohereOutlets(t,e,r){for(;null!==r;){if(Object.prototype.hasOwnProperty.call(r,"outlets"))for(const i in r.outlets){const n=r.outlets[i];if(n instanceof Sn){kn.reflectOutletField(e,n).recohereInput(t)}else if(n instanceof En){kn.reflectInoutletField(e,n).recohereInput(t)}}r=Object.getPrototypeOf(r)}}didRecohere(t){}static reflectEachInlet(t,e,r,i){let n=0;for(;null!==e;){if(Object.prototype.hasOwnProperty.call(e,"inlets"))for(const s in e.inlets){const o=e.inlets[s];let a;if(a=o instanceof On?kn.reflectInletField(t,o):o instanceof En?kn.reflectInoutletField(t,o):null,null!==a){const t=r.call(i,a,o.name,n);if(void 0!==t)return t;n+=1}}e=Object.getPrototypeOf(e)}}static reflectEachOutlet(t,e,r,i){let n=0;for(;null!==e;){if(Object.prototype.hasOwnProperty.call(e,"outlets"))for(const s in e.outlets){const o=e.outlets[s];let a;if(a=o instanceof Sn?kn.reflectOutletField(t,o):o instanceof En?kn.reflectInoutletField(t,o):null,null!==a){const t=r.call(i,a,o.name,n);if(void 0!==t)return t;n+=1}}e=Object.getPrototypeOf(e)}}static reflectInletCount(t){let e=0;for(;null!==t;){if(Object.prototype.hasOwnProperty.call(t,"inlets"))for(const r in t.inlets)e+=1;t=Object.getPrototypeOf(t)}return e}static reflectOutletCount(t){let e=0;for(;null!==t;){if(Object.prototype.hasOwnProperty.call(t,"outlets"))for(const r in t.outlets)e+=1;t=Object.getPrototypeOf(t)}return e}static reflectInletIndex(t,e,r){for(;null!==r;){if(Object.prototype.hasOwnProperty.call(r,"inlets"))for(const i in r.inlets){if(0===t){const t=r.inlets[i];return t instanceof On?[t.name,kn.reflectInletField(e,t)]:t instanceof En?[t.name,kn.reflectInoutletField(e,t)]:null}t-=1}r=Object.getPrototypeOf(r)}return null}static reflectOutletIndex(t,e,r){for(;null!==r;){if(Object.prototype.hasOwnProperty.call(r,"outlets"))for(const i in r.outlets){if(0===t){const t=r.outlets[i];return t instanceof Sn?[t.name,kn.reflectOutletField(e,t)]:t instanceof En?[t.name,kn.reflectInoutletField(e,t)]:null}t-=1}r=Object.getPrototypeOf(r)}return null}static reflectInletKey(t,e,r){for(;null!==r;){if(Object.prototype.hasOwnProperty.call(r,"inlets")){const i=r.inlets[t];if(void 0!==i)return i instanceof On?kn.reflectInletField(e,i):i instanceof En?kn.reflectInoutletField(e,i):null}r=Object.getPrototypeOf(r)}return null}static reflectOutletKey(t,e,r){for(;null!==r;){if(Object.prototype.hasOwnProperty.call(r,"outlets")){const i=r.outlets[t];if(void 0!==i)return i instanceof Sn?kn.reflectOutletField(e,i):i instanceof En?kn.reflectInoutletField(e,i):null}r=Object.getPrototypeOf(r)}return null}static reflectInletField(t,e){if("value"===e.type)return kn.reflectValueInletField(t,e.key);if("map"===e.type)return kn.reflectMapInletField(t,e.key);throw new TypeError(e.type)}static reflectValueInletField(t,e){let r=t[e];return void 0===r&&(r=t instanceof kn?t.inlet():new bn(t),t[e]=r),r}static reflectMapInletField(t,e){return null}static reflectOutletField(t,e){if("value"===e.type)return kn.reflectValueOutletField(t,e.key);if("map"===e.type)return kn.reflectMapOutletField(t,e.key);throw new TypeError(e.type)}static reflectValueOutletField(t,e){let r=t[e];return void 0===r&&(r=t instanceof kn?t.outlet():new xn(t),t[e]=r),r}static reflectMapOutletField(t,e){return null}static reflectInoutletField(t,e){if("value"===e.type)return kn.reflectValueInoutletField(t,e.key);if("map"===e.type)return kn.reflectMapInoutletField(t,e.key);throw new TypeError(e.type)}static reflectValueInoutletField(t,e){let r=t[e];return void 0===r&&(r=t instanceof kn?t.inoutlet():new Cn(t),t[e]=r),r}static reflectMapInoutletField(t,e){return null}static init(t){Object.prototype.hasOwnProperty.call(t,"inlets")||(t.inlets={}),Object.prototype.hasOwnProperty.call(t,"outlets")||(t.outlets={}),Object.prototype.hasOwnProperty.call(t,"inoutlets")||(t.inoutlets={})}static decorateInlet(t,e,r){kn.init(e);const i=void 0!==t.name?t.name:r.toString(),n=void 0!==t.type?t.type:"value",s=new On(r.toString(),i,n);e.inlets[i]=s}static decorateOutlet(t,e,r){kn.init(e);const i=void 0!==t.name?t.name:r.toString(),n=void 0!==t.type?t.type:"value",s=new Sn(r.toString(),i,n);e.outlets[i]=s}static decorateInoutlet(t,e,r){kn.init(e);const i=void 0!==t.name?t.name:r.toString(),n=void 0!==t.type?t.type:"value",s=new En(r.toString(),i,n);e.inlets[i]=s,e.outlets[i]=s,e.inoutlets[i]=s}}function An(t,e){if(1===arguments.length)return"string"==typeof t&&(t={name:t}),kn.decorateOutlet.bind(void 0,t);kn.decorateOutlet({},t,e)}function Mn(t,e){if(1===arguments.length)return"string"==typeof t&&(t={name:t}),kn.decorateInoutlet.bind(void 0,t);kn.decorateInoutlet({},t,e)}const Dn=function(){const t={is:function(t){if("object"==typeof t&&null!==t){const e=t;return Ki.is(e)&&Hi.is(e)}return!1}};return t}();class In extends mr{constructor(){super(),this.effects=new Te,this.outlets=new Te,this.outputs=v.empty,this.version=-1}get streamletContext(){const t=this.streamletScope;return null!==t?t.streamletContext:null}hasOwn(t){return this.has(t)}get(t){return void 0===t?this:super.get(t)}outlet(t){if("string"==typeof t&&(t=Sr.from(t)),!this.hasOwn(t)){const e=this.streamletScope;if(Dn.is(e)&&e.has(t))return e.outlet(t)}const e=this.outlets;let r=e.get(t);return void 0===r&&(r=new Qi(this,t),this.outlets=e.updated(t,r),this.decohereInputKey(t,0)),r}outputIterator(){return _.array(this.outputs)}bindOutput(t){this.outputs=v.inserted(t,this.outputs)}unbindOutput(t){this.outputs=v.removed(t,this.outputs)}unbindOutputs(){const t=this.outlets;t.isEmpty()&&(this.outlets=new Te,t.forEach((function(t,e){e.unbindOutputs()}),this));const e=this.outputs;this.outputs=v.empty;for(let t=0,r=e.length;t<r;t+=1){e[t].unbindInput()}}disconnectOutputs(){const t=this.outlets;t.isEmpty()&&(this.outlets=new Te,t.forEach((function(t,e){e.disconnectOutputs()}),this));const e=this.outputs;this.outputs=v.empty;for(let t=0,r=e.length;t<r;t+=1){const r=e[t];r.unbindInput(),r.disconnectOutputs()}this.forEach((function(t){t instanceof hr&&(t=t.toValue()),(t instanceof In||t instanceof Pn||Dn.is(t))&&t.disconnectOutputs()}),this)}disconnectInputs(){}decohereInputKey(t,e){const r=this.effects;if(r.get(t)!==e){this.willDecohereInputKey(t,e),this.effects=r.updated(t,e),this.version=-1,this.onDecohereInputKey(t,e);const i=this.outputs;for(let r=0,n=i.length;r<n;r+=1){const n=i[r];Li.is(n)?n.decohereOutputKey(t,e):n.decohereOutput()}const n=this.outlets.get(t);void 0!==n&&n.decohereInput(),this.didDecohereInputKey(t,e)}}decohereInput(){if(this.version>=0){this.willDecohereInput(),this.version=-1,this.onDecohereInput();const t=this.outputs;for(let e=0,r=t.length;e<r;e+=1){t[e].decohereOutput()}this.outlets.forEach((function(t,e){e.decohereInput()}),this),this.didDecohereInput()}}recohereInputKey(t,e){if(this.version<0){const r=this.effects,i=r.get(t);if(void 0!==i){this.willRecohereInputKey(t,i,e),this.effects=r.removed(t),this.onRecohereInputKey(t,i,e);const n=this.outputs;for(let r=0,i=n.length;r<i;r+=1){const i=n[r];Li.is(i)&&i.recohereOutputKey(t,e)}const s=this.outlets.get(t);void 0!==s&&s.recohereInput(e),this.didRecohereInputKey(t,i,e)}}}recohereInput(t){if(this.version<0){this.willRecohereInput(t),this.effects.forEach((function(e){this.recohereInputKey(e,t)}),this),this.version=t,this.onRecohereInput(t);const e=this.outputs;for(let r=0,i=e.length;r<i;r+=1){e[r].recohereOutput(t)}this.forEach((function(e){e instanceof hr&&(e=e.toValue()),e instanceof In?e.recohereInput(t):e instanceof Pn?e.recohere(t):Dn.is(e)&&e.recohereInput(t)}),this),this.didRecohereInput(t)}}willDecohereInputKey(t,e){}onDecohereInputKey(t,e){}didDecohereInputKey(t,e){}willDecohereInput(){}onDecohereInput(){}didDecohereInput(){}willRecohereInputKey(t,e,r){}onRecohereInputKey(t,e,r){}didRecohereInputKey(t,e,r){}willRecohereInput(t){}onRecohereInput(t){}didRecohereInput(t){}filter(t){if("function"!=typeof t)return super.filter(t);{const e=new hn(t);return e.bindInput(this),e}}}Object.defineProperty(In.prototype,"streamletScope",{get:()=>null,configurable:!0}),Bi.define(In.prototype);class Pn extends mr{isConstant(){return!1}compile(){kn.reflectEachInlet(this,Object.getPrototypeOf(this),(function(t,e){null===t.input&&this.compileInlet(t,e)}),this)}compileInlet(t,e){const r=this.streamletScope;if(null!==r){const i=r.outlet(e);null!==i&&t.bindInput(i)}}}class Tn extends Pn{constructor(t=null){super(),this.streamletScope=t,this.streamletContext=null,this.version=-1}setStreamletScope(t){this.streamletScope=t}setStreamletContext(t){this.streamletContext=t}isEmpty(){return 0!==this.length}get length(){return kn.reflectOutletCount(Object.getPrototypeOf(this))}has(t){if(t instanceof Sr)t=t.value;else if("string"!=typeof t)return!1;return null!==this.outlet(t)}get(t){if(t instanceof Sr)t=t.value;else if("string"!=typeof t)return yr.absent();const e=this.outlet(t);if(null!==e){const t=e.get();if(void 0!==t)return t}return yr.absent()}getAttr(t){return yr.absent()}getSlot(t){return this.get(t)}getField(t){if("string"==typeof t)t=Sr.from(t);else if(!(t instanceof Sr))return;const e=this.get(t);if(e.isDefined())return lr.of(t,e)}getItem(t){t instanceof kr&&(t=t.value);const e=kn.reflectOutletIndex(t,this,Object.getPrototypeOf(this));if(null!==e){const t=e[0];let r=e[1].get();return void 0===r&&(r=yr.extant()),lr.of(t,r)}return ar.absent()}set(t,e){throw new Error("unsupported")}setAttr(t,e){throw new Error("unsupported")}setSlot(t,e){throw new Error("unsupported")}setItem(t,e){throw new Error("unsupported")}push(...t){throw new Error("unsupported")}splice(t,e,...r){throw new Error("unsupported")}delete(t){throw new Error("unsupported")}clear(){throw new Error("unsupported")}forEach(t,e){return kn.reflectEachOutlet(this,Object.getPrototypeOf(this),(function(r,i,n){const s=r.get();if(void 0!==s){const r=t.call(e,s,n);if(void 0!==r)return r}}),this)}inlet(t){return void 0===t?new bn(this):kn.reflectInletKey(t,this,Object.getPrototypeOf(this))}bindInput(t,e){const r=this.inlet(t);if(null===r)throw new Error(t);r.bindInput(e)}unbindInput(t){const e=this.inlet(t);if(null===e)throw new Error(t);e.unbindInput()}outlet(t){return void 0===t?new xn(this):"string"==typeof t?kn.reflectOutletKey(t,this,Object.getPrototypeOf(this)):t}inoutlet(){return new Cn(this)}decohere(){this.version>=0&&(this.willDecohere(),this.version=-1,this.onDecohere(),this.onDecohereOutlets(),this.didDecohere())}recohere(t){this.version<0&&(this.willRecohere(t),this.version=t,this.onRecohereInlets(t),this.onRecohere(t),this.onRecohereOutlets(t),this.didRecohere(t))}getInput(t,e){let r;if("string"==typeof t&&(t=this.inlet(t)),null!==t){const e=t.input;null!==e&&(r=e.get())}return void 0===r&&(r=e),r}castInput(t,e,r){const i=this.getInput(t);let n;return void 0!==i&&(n=e.cast(i)),void 0===n&&(n=r),n}coerceInput(t,e,r){const i=this.getInput(t);let n;return void 0!==i&&(n=e.cast(i)),void 0===n&&(n=e.unit),void 0===n&&(n=r),n}getOutput(t){}disconnectInputs(){kn.disconnectInputs(this,Object.getPrototypeOf(this))}disconnectOutputs(){kn.disconnectOutputs(this,Object.getPrototypeOf(this))}willDecohereInlet(t){}didDecohereInlet(t){this.decohere()}willRecohereInlet(t,e){}didRecohereInlet(t,e){this.recohere(e)}willDecohereOutlet(t){}didDecohereOutlet(t){}willRecohereOutlet(t,e){}didRecohereOutlet(t,e){}willDecohere(){}onDecohere(){}didDecohere(){}onDecohereOutlets(){kn.decohereOutlets(this,Object.getPrototypeOf(this))}willRecohere(t){}onRecohereInlets(t){kn.recohereInlets(t,this,Object.getPrototypeOf(this))}onRecohere(t){}onRecohereOutlets(t){kn.recohereOutlets(t,this,Object.getPrototypeOf(this))}didRecohere(t){}}class Vn extends Yi{constructor(t,e){super(),this.record=t,this.key=e}onDecohereOutput(){const t=this.record;Dn.is(t)&&t.decohereInputKey(this.key,0)}onRecohereOutput(t){const e=this.input;if(null!==e){const t=e.get();void 0!==t?this.record.set(this.key,t):this.record.delete(this.key)}}}class Fn extends In{constructor(t){super(),void 0===t&&(t=mr.create()),this.state=t,this.fieldUpdaters=new Te}isEmpty(){return this.state.isEmpty()}isArray(){return this.state.isArray()}isObject(){return this.state.isObject()}get length(){return this.state.length}get valueCount(){return this.state.valueCount}has(t){if(this.state.has(t))return!0;{const e=this.streamletScope;return e instanceof mr&&e.has(t)}}hasOwn(t){return this.state.has(t)}indexOf(t,e){return this.state.indexOf(t,e)}lastIndexOf(t,e=0){return this.state.lastIndexOf(t,e)}get(t){if(void 0===t)return this;{t=yr.fromAny(t);let e=this.state.get(t);if(!e.isDefined()){const r=this.streamletScope;r instanceof mr&&(e=r.get(t))}return e}}getAttr(t){t=Sr.fromAny(t);let e=this.state.getAttr(t);if(!e.isDefined()){const r=this.streamletScope;r instanceof mr&&(e=r.getAttr(t))}return e}getSlot(t){t=yr.fromAny(t);let e=this.state.getSlot(t);if(!e.isDefined()){const r=this.streamletScope;r instanceof mr&&(e=r.getSlot(t))}return e}getField(t){t=yr.fromAny(t);let e=this.state.getField(t);if(void 0===e){const r=this.streamletScope;r instanceof mr&&(e=r.getField(t))}return e}getItem(t){return this.state.getItem(t)}bindValue(t,e){const r=new Vn(this,t),i=us.compile(e,this);r.bindInput(i),this.fieldUpdaters=this.fieldUpdaters.updated(t,r)}set(t,e){if(t=yr.fromAny(t),this.state.has(t))this.state.set(t,e);else{const r=this.streamletScope;r instanceof mr&&r.has(t)?r.set(t,e):this.state.set(t,e)}return this.decohereInputKey(t,0),this}setAttr(t,e){if(t=Sr.fromAny(t),this.state.has(t))this.state.setAttr(t,e);else{const r=this.streamletScope;r instanceof mr&&r.has(t)?r.setAttr(t,e):this.state.setAttr(t,e)}return this.decohereInputKey(t,0),this}setSlot(t,e){if(t=yr.fromAny(t),this.state.has(t))this.state.setSlot(t,e);else{const r=this.streamletScope;r instanceof mr&&r.has(t)?r.setSlot(t,e):this.state.setSlot(t,e)}return this.decohereInputKey(t,0),this}setItem(t,e){const r=this.state.getItem(t);return e=ar.fromAny(e),this.state.setItem(t,e),r instanceof hr&&e instanceof hr?r.key.equals(e.key)?this.decohereInputKey(r.key,0):(this.decohereInputKey(r.key,1),this.decohereInputKey(e.key,0)):r instanceof hr?this.decohereInputKey(r.key,1):e instanceof hr?this.decohereInputKey(e.key,0):this.decohereInput(),this}push(...t){let e=this.state.length;const r=this.state.push(...t);for(;e<r;){const t=this.state.get(e);t instanceof hr&&this.decohereInputKey(t.key,0),e+=1}return r}splice(t,e=0,...r){const i=this.state.length;t<0&&(t=i+t),t=Math.max(0,t),e=Math.max(0,e);const n=this.state.splice(t,e,...r);for(let t=0;t<n.length;t+=1){const e=n[t];e instanceof hr&&this.decohereInputKey(e.key,1)}for(let e=t;e<t+r.length;e+=1){const t=this.state.get(e);t instanceof hr&&this.decohereInputKey(t.key,0)}return n}delete(t){const e=this.state.delete(t);return e instanceof hr&&this.decohereInputKey(e.key,1),e}clear(){const t=this.state.branch();this.state.clear(),t.forEach((function(t){t instanceof hr&&this.decohereInputKey(t.key,1)}),this)}forEach(t,e){return this.state.forEach(t,e)}keyIterator(){throw new Error}disconnectInputs(){const t=this.fieldUpdaters;t.isEmpty()||(this.fieldUpdaters=new Te,t.forEach((function(t,e){e.disconnectInputs()}),this))}memoize(){return this}materialize(t){t.forEach((function(t){this.materializeItem(t)}),this)}materializeItem(t){t instanceof hr?this.materializeField(t):this.materializeValue(t)}materializeField(t){const e=t.value;if(e instanceof Pn)e.setStreamletScope(this),this.state.push(t);else if(e instanceof mr){const r=new qn(this);r.materialize(e),this.state.push(t.updatedValue(r))}else this.state.push(t)}materializeValue(t){if(t instanceof Pn)t.setStreamletScope(this),this.state.push(t);else if(t instanceof mr){const e=new qn(this);e.materialize(t),this.state.push(e)}else this.state.push(t)}compile(t){t.forEach((function(t,e){this.compileItem(t,e)}),this)}compileItem(t,e){t instanceof hr?this.compileField(t,e):this.compileValue(t,e)}compileField(t,e){const r=t.key,i=t.value;r.isConstant()&&(i.isConstant()?this.decohereInputKey(r,0):i instanceof Pn?(i.compile(),this.decohereInputKey(r,0)):i instanceof mr?(this.state.getItem(e).toValue().compile(i),this.decohereInputKey(r,0)):(t.setValue(yr.extant()),this.bindValue(r,i)))}compileValue(t,e){t instanceof Pn?t.compile():t instanceof mr?this.state.getItem(e).compile(t):t.isConstant()}reify(t=Un.system()){this.forEach((function(e,r){const i=this.reifyItem(e,t);e!==i&&this.setItem(r,i)}),this)}reifyItem(t,e){null!==e&&(t=e.reify(t));const r=this.streamletScope;return r instanceof Fn?r.reifyItem(t,e):t}static from(t){const e=new Fn;return e.materialize(t),e.compile(t),e}static of(...t){return Fn.from(mr.of(...t))}static globalScope(){const t=new Fn;return t.materializeField(lr.of("math",Si.scope.branch())),t}}Object.defineProperty(Fn.prototype,"fieldCount",{get(){return this.state.fieldCount},configurable:!0});class qn extends Fn{constructor(t,e){super(e),Object.defineProperty(this,"streamletScope",{value:t,writable:!0,enumerable:!0,configurable:!0})}static from(t){const e=new qn(qn.globalScope());return e.materialize(t),e.compile(t),e}static of(...t){return qn.from(mr.of(...t))}}class Un{static system(){return null}}class Rn extends Gi{constructor(){super(),this.keyInlet=new rn(this),this.mapInlet=new nn(this)}get(){const t=this.keyInlet.input;if(null!==t){const e=t.get();if(void 0!==e){const t=this.mapInlet.input;if(null!==t){const r=t.get(e);if(void 0!==r)return r}}}return yr.absent()}}class Nn extends Gi{constructor(){super(),this.operand1Inlet=new rn(this),this.operand2Inlet=new rn(this)}get(){const t=this.operand1Inlet.input,e=this.operand2Inlet.input;if(null!==t&&null!==e){const r=t.get(),i=e.get();if(void 0!==r&&void 0!==i){return this.evaluate(r,i).toValue()}}return yr.absent()}}class zn extends Gi{constructor(){super(),this.operandInlet=new rn(this)}get(){const t=this.operandInlet.input;if(null!==t){const e=t.get();if(void 0!==e){return this.evaluate(e).toValue()}}return yr.absent()}}class jn extends Gi{constructor(){super(),this.ifInlet=new rn(this),this.thenInlet=new rn(this),this.elseInlet=new rn(this)}get(){const t=this.ifInlet.input;if(null!==t){const e=t.get();if(void 0!==e)if(e.isDefinite()){const t=this.thenInlet.input;if(null!==t){const e=t.get();if(void 0!==e)return e}}else{const t=this.elseInlet.input;if(null!==t){const e=t.get();if(void 0!==e)return e}}}return yr.absent()}}class Ln extends Gi{constructor(){super(),this.operand1Inlet=new rn(this),this.operand2Inlet=new rn(this)}get(){const t=this.operand1Inlet.input,e=null!==t?t.get():void 0;if(void 0!==e&&e.isDefinite())return e;const r=this.operand2Inlet.input,i=null!==r?r.get():void 0;return void 0!==i?i:yr.absent()}}class Kn extends Gi{constructor(){super(),this.operand1Inlet=new rn(this),this.operand2Inlet=new rn(this)}get(){const t=this.operand1Inlet.input,e=null!==t?t.get():void 0;if(void 0!==e){if(e.isDefinite()){const t=this.operand2Inlet.input,e=null!==t?t.get():void 0;if(void 0!==e)return e}return e}return yr.absent()}}class Bn extends Nn{evaluate(t,e){return t.bitwiseOr(e)}}class Wn extends Nn{evaluate(t,e){return t.bitwiseXor(e)}}class Hn extends Nn{evaluate(t,e){return t.bitwiseAnd(e)}}class Xn extends Nn{evaluate(t,e){return t.lt(e)}}class Yn extends Nn{evaluate(t,e){return t.le(e)}}class Gn extends Nn{evaluate(t,e){return t.eq(e)}}class _n extends Nn{evaluate(t,e){return t.ne(e)}}class Qn extends Nn{evaluate(t,e){return t.ge(e)}}class Zn extends Nn{evaluate(t,e){return t.gt(e)}}class Jn extends Nn{evaluate(t,e){return t.plus(e)}}class $n extends Nn{evaluate(t,e){return t.minus(e)}}class ts extends Nn{evaluate(t,e){return t.times(e)}}class es extends Nn{evaluate(t,e){return t.divide(e)}}class rs extends Nn{evaluate(t,e){return t.modulo(e)}}class is extends zn{evaluate(t){return t.not()}}class ns extends zn{evaluate(t){return t.bitwiseNot()}}class ss extends zn{evaluate(t){return t.negative()}}class os extends zn{evaluate(t){return t.positive()}}class as extends Gi{constructor(t){super(),this.scope=t,this.funcInlet=new rn(this),this.argsInlet=new rn(this)}get(){const t=this.funcInlet.input,e=this.argsInlet.input;if(null!==t&&null!==e){const r=t.get();if(r instanceof xi){const t=e.get();if(void 0!==t){const e=new Lr;e.pushScope(this.scope);return r.invoke(t,e,void 0).toValue()}}}return yr.absent()}}const us=function(){const t={compile:function(e,r){if(r instanceof Qi){const t=r.get();Ni.is(t)&&(r=t)}if(e.isConstant())return new sn(e);if(e instanceof li)return t.compileSelector(e,r);if(e instanceof Tr)return t.compileOperator(e,r);throw new TypeError(""+e)},compileSelector:function(e,r){if(e instanceof ci)return t.compileIdentitySelector(r);if(e instanceof di)return t.compileGetSelector(e,r);if(e instanceof pi)return t.compileGetAttrSelector(e,r);if(e instanceof fi)return t.compileGetItemSelector(e,r);if(e instanceof yi)return t.compileKeysSelector(r);if(e instanceof mi)return t.compileValuesSelector(r);if(e instanceof wi)return t.compileChildrenSelector(r);if(e instanceof gi)return t.compileDescendantsSelector(r);if(e instanceof vi)return t.compileFilterSelector(e,r);throw new TypeError(""+e)},compileIdentitySelector:function(t){return t},compileGetSelector:function(e,r){const i=e.item;if(!i.isConstant()){const e=new Rn,n=t.compile(i,r);return e.keyInlet.bindInput(n),e.mapInlet.bindInput(r),e}if(Dn.is(r)){const n=r.outlet(i);if(null!==n)return t.compile(e.then,n)}else if(Hi.is(r)){const n=i.stringValue(void 0);if(void 0!==n){const i=r.outlet(n);if(null!==i)return t.compile(e.then,i)}}return null},compileGetAttrSelector:function(t,e){throw new Error},compileGetItemSelector:function(t,e){throw new Error},compileKeysSelector:function(t){throw new Error},compileValuesSelector:function(t){throw new Error},compileChildrenSelector:function(t){throw new Error},compileDescendantsSelector:function(t){throw new Error},compileFilterSelector:function(t,e){throw new Error},compileOperator:function(e,r){if(e instanceof Rr)return t.compileConditionalOperator(e,r);if(e instanceof Vr)return t.compileBinaryOperator(e,r);if(e instanceof qr)return t.compileUnaryOperator(e,r);if(e instanceof ui)return t.compileInvokeOperator(e,r);throw new TypeError(""+e)},compileConditionalOperator:function(e,r){const i=new jn,n=e.ifTerm.toValue(),s=e.thenTerm.toValue(),o=e.elseTerm.toValue(),a=t.compile(n,r),u=t.compile(s,r),h=t.compile(o,r);return i.ifInlet.bindInput(a),i.thenInlet.bindInput(u),i.elseInlet.bindInput(h),i},compileBinaryOperator:function(e,r){if(e instanceof Kr)return t.compileOrOperator(e,r);if(e instanceof Br)return t.compileAndOperator(e,r);if(e instanceof Wr)return t.compileBitwiseOrOperator(e,r);if(e instanceof Hr)return t.compileBitwiseXorOperator(e,r);if(e instanceof Xr)return t.compileBitwiseAndOperator(e,r);if(e instanceof Yr)return t.compileLtOperator(e,r);if(e instanceof Gr)return t.compileLeOperator(e,r);if(e instanceof _r)return t.compileEqOperator(e,r);if(e instanceof Qr)return t.compileNeOperator(e,r);if(e instanceof Zr)return t.compileGeOperator(e,r);if(e instanceof Jr)return t.compileGtOperator(e,r);if(e instanceof $r)return t.compilePlusOperator(e,r);if(e instanceof ti)return t.compileMinusOperator(e,r);if(e instanceof ei)return t.compileTimesOperator(e,r);if(e instanceof ri)return t.compileDivideOperator(e,r);if(e instanceof ii)return t.compileModuloOperator(e,r);throw new TypeError(""+e)},compileBinaryOutlet:function(e,r,i){const n=e.operand1.toValue(),s=e.operand2.toValue(),o=t.compile(n,i),a=t.compile(s,i);return r.operand1Inlet.bindInput(o),r.operand2Inlet.bindInput(a),r},compileOrOperator:function(e,r){const i=new Ln,n=e.operand1.toValue(),s=e.operand2.toValue(),o=t.compile(n,r),a=t.compile(s,r);return i.operand1Inlet.bindInput(o),i.operand2Inlet.bindInput(a),i},compileAndOperator:function(e,r){const i=new Kn,n=e.operand1.toValue(),s=e.operand2.toValue(),o=t.compile(n,r),a=t.compile(s,r);return i.operand1Inlet.bindInput(o),i.operand2Inlet.bindInput(a),i},compileBitwiseOrOperator:function(e,r){return t.compileBinaryOutlet(e,new Bn,r)},compileBitwiseXorOperator:function(e,r){return t.compileBinaryOutlet(e,new Wn,r)},compileBitwiseAndOperator:function(e,r){return t.compileBinaryOutlet(e,new Hn,r)},compileLtOperator:function(e,r){return t.compileBinaryOutlet(e,new Xn,r)},compileLeOperator:function(e,r){return t.compileBinaryOutlet(e,new Yn,r)},compileEqOperator:function(e,r){return t.compileBinaryOutlet(e,new Gn,r)},compileNeOperator:function(e,r){return t.compileBinaryOutlet(e,new _n,r)},compileGeOperator:function(e,r){return t.compileBinaryOutlet(e,new Qn,r)},compileGtOperator:function(e,r){return t.compileBinaryOutlet(e,new Zn,r)},compilePlusOperator:function(e,r){return t.compileBinaryOutlet(e,new Jn,r)},compileMinusOperator:function(e,r){return t.compileBinaryOutlet(e,new $n,r)},compileTimesOperator:function(e,r){return t.compileBinaryOutlet(e,new ts,r)},compileDivideOperator:function(e,r){return t.compileBinaryOutlet(e,new es,r)},compileModuloOperator:function(e,r){return t.compileBinaryOutlet(e,new rs,r)},compileUnaryOperator:function(e,r){if(e instanceof ni)return t.compileNotOperator(e,r);if(e instanceof si)return t.compileBitwiseNotOperator(e,r);if(e instanceof oi)return t.compileNegativeOperator(e,r);if(e instanceof ai)return t.compilePositiveOperator(e,r);throw new TypeError(""+e)},compileUnaryOutlet:function(e,r,i){const n=e.operand.toValue(),s=t.compile(n,i);return r.operandInlet.bindInput(s),r},compileNotOperator:function(e,r){return t.compileUnaryOutlet(e,new is,r)},compileBitwiseNotOperator:function(e,r){return t.compileUnaryOutlet(e,new ns,r)},compileNegativeOperator:function(e,r){return t.compileUnaryOutlet(e,new ss,r)},compilePositiveOperator:function(e,r){return t.compileUnaryOutlet(e,new os,r)},compileInvokeOperator:function(e,r){const i=e.func,n=e.args,s=new as(r),o=t.compile(i,r),a=t.compile(n,r);return s.funcInlet.bindInput(o),s.argsInlet.bindInput(a),s}};return t}(),hs=function(){const t={};return Object.defineProperty(t,"structureParser",{value:function(){const e=new js;return Object.defineProperty(t,"structureParser",{value:function(){return e},enumerable:!0,configurable:!0}),e},enumerable:!0,configurable:!0}),Object.defineProperty(t,"structureWriter",{value:function(){const e=new lo;return Object.defineProperty(t,"structureWriter",{value:function(){return e},enumerable:!0,configurable:!0}),e},enumerable:!0,configurable:!0}),t.parse=function(e){return t.structureParser().parseBlockString(e)},t.parser=function(){return t.structureParser().blockParser()},t.sizeOf=function(e){return t.structureWriter().sizeOfItem(e)},t.sizeOfBlock=function(e){return t.structureWriter().sizeOfBlockItem(e)},t.write=function(e,r){return t.structureWriter().writeItem(e,r)},t.writeBlock=function(e,r){return t.structureWriter().writeBlockItem(e,r)},t.toString=function(e){let r=Ct.stringOutput();const i=t.write(r,e);return i.isDone()||(r=wt.error(i.trap())),r.bind()},t.toBlockString=function(e){let r=Ct.stringOutput();const i=t.writeBlock(r,e);return i.isDone()||(r=wt.error(i.trap())),r.bind()},t.toData=function(e){let r=ie.encodedOutput(Cr.output());const i=t.write(r,e);return i.isDone()||(r=wt.error(i.trap())),r.bind()},t.toBlockData=function(e){let r=ie.encodedOutput(Cr.output());const i=t.writeBlock(r,e);return i.isDone()||(r=wt.error(i.trap())),r.bind()},t.isSpace=function(t){return 32===t||9===t},t.isNewline=function(t){return 10===t||13===t},t.isWhitespace=function(e){return t.isSpace(e)||t.isNewline(e)},t.isIdentStartChar=function(t){return t>=65&&t<=90||95===t||t>=97&&t<=122||t>=192&&t<=214||t>=216&&t<=246||t>=248&&t<=767||t>=880&&t<=893||t>=895&&t<=8191||t>=8204&&t<=8205||t>=8304&&t<=8591||t>=11264&&t<=12271||t>=12289&&t<=55295||t>=63744&&t<=64975||t>=65008&&t<=65533||t>=65536&&t<=983039},t.isIdentChar=function(t){return 45===t||t>=48&&t<=57||t>=65&&t<=90||95===t||t>=97&&t<=122||183===t||t>=192&&t<=214||t>=216&&t<=246||t>=248&&t<=893||t>=895&&t<=8191||t>=8204&&t<=8205||t>=8255&&t<=8256||t>=8304&&t<=8591||t>=11264&&t<=12271||t>=12289&&t<=55295||t>=63744&&t<=64975||t>=65008&&t<=65533||t>=65536&&t<=983039},ar.prototype.toRecon=function(){return t.toString(this)},ar.prototype.toReconBlock=function(){return t.toBlockString(this)},t}();yr.parseRecon=function(t){return hs.parse(t)};class ls extends jt{constructor(t,e,r,i,n){super(),this.recon=t,this.builder=e,this.keyParser=r,this.valueParser=i,this.step=n}feed(t){return ls.parse(t,this.recon,this.builder,this.keyParser,this.valueParser,this.step)}static parse(t,e,r,i,n,s=1){let o=0;t:for(;;){if(1===s){for(;t.isCont()&&(o=t.head(),hs.isWhitespace(o));)t=t.step();if(t.isCont())if(33===o||34===o||36===o||37===o||39===o||40===o||43===o||45===o||o>=48&&o<=57||64===o||91===o||96===o||123===o||126===o||hs.isIdentStartChar(o))r=r||e.valueBuilder(),s=2;else{if(35!==o)return void 0!==r?jt.done(r.bind()):jt.done(e.absent());t=t.step(),s=7}else if(t.isDone())return void 0!==r?jt.done(r.bind()):jt.done(e.absent())}if(2===s){for(void 0===i&&(i=e.parseBlockExpression(t));i.isCont()&&!t.isEmpty();)i=i.feed(t);if(i.isDone())s=3;else if(i.isError())return i}if(3===s){for(;t.isCont()&&(o=t.head(),hs.isSpace(o));)t=t.step();if(t.isCont())58===o?(t=t.step(),s=4):(r.push(e.item(i.bind())),i=void 0,s=6);else if(t.isDone())return r.push(e.item(i.bind())),jt.done(r.bind())}if(4===s){for(;t.isCont()&&hs.isSpace(t.head());)t=t.step();if(t.isCont())s=5;else if(t.isDone())return r.push(e.slot(i.bind())),jt.done(r.bind())}if(5===s){for(void 0===n&&(n=e.parseBlockExpression(t));n.isCont()&&!t.isEmpty();)n=n.feed(t);if(n.isDone())r.push(e.slot(i.bind(),n.bind())),i=void 0,n=void 0,s=6;else if(n.isError())return n}if(6===s){for(;t.isCont()&&(o=t.head(),hs.isSpace(o));)t=t.step();if(t.isCont()){if(44===o||59===o||hs.isNewline(o)){t=t.step(),s=1;continue}if(35!==o)return jt.done(r.bind());t=t.step(),s=7}else if(t.isDone())return jt.done(r.bind())}if(7===s){for(;t.isCont();){if(o=t.head(),hs.isNewline(o)){s=1;continue t}t=t.step()}if(t.isDone()){s=1;continue}}break}return new ls(e,r,i,n,s)}}class cs extends jt{constructor(t,e,r,i){super(),this.recon=t,this.keyParser=e,this.valueParser=r,this.step=i}feed(t){return cs.parse(t,this.recon,this.keyParser,this.valueParser,this.step)}static parse(t,e,r,i,n=1){let s=0;if(1===n)if(t.isCont()){if(s=t.head(),64!==s)return jt.error(Et.expected(64,t));t=t.step(),n=2}else if(t.isDone())return jt.error(Et.expected(64,t));if(2===n){if(void 0===r){if(t.isCont())if(s=t.head(),34===s||39===s)r=e.parseString(t);else{if(!hs.isIdentStartChar(s))return jt.error(Et.expected("attribute name",t));r=e.parseIdent(t)}else if(t.isDone())return jt.error(Et.expected("attribute name",t))}else r=r.feed(t);if(void 0!==r)if(r.isDone())n=3;else if(r.isError())return r.asError()}if(3===n)if(t.isCont()&&40===t.head())t=t.step(),n=4;else if(!t.isEmpty())return jt.done(e.attr(r.bind()));if(4===n){for(;t.isCont()&&(s=t.head(),hs.isWhitespace(s));)t=t.step();if(t.isCont()){if(41===s)return t=t.step(),jt.done(e.attr(r.bind()));n=5}else if(t.isDone())return jt.error(Et.expected(")",t))}if(5===n){for(void 0===i&&(i=e.parseBlock(t));i.isCont()&&!t.isEmpty();)i=i.feed(t);if(i.isDone())n=6;else if(i.isError())return i.asError()}if(6===n){for(;t.isCont()&&(s=t.head(),hs.isWhitespace(s));)t=t.step();if(t.isCont())return 41===s?(t=t.step(),jt.done(e.attr(r.bind(),i.bind()))):jt.error(Et.expected(")",t));if(t.isDone())return jt.error(Et.expected(")",t))}return new cs(e,r,i,n)}}class ds extends jt{constructor(t,e,r,i,n){super(),this.recon=t,this.builder=e,this.fieldParser=r,this.valueParser=i,this.step=n}feed(t){return ds.parse(t,this.recon,this.builder,this.fieldParser,this.valueParser,this.step)}static parse(t,e,r,i,n,s=1){let o=0;for(;;){if(1===s)if(t.isCont())if(o=t.head(),64===o)i=e.parseAttr(t),s=2;else if(123===o)r=r||e.recordBuilder(),n=e.parseRecord(t,r),s=5;else if(91===o)r=r||e.recordBuilder(),n=e.parseMarkup(t,r),s=5;else if(hs.isIdentStartChar(o))n=e.parseIdent(t),s=4;else if(34===o||39===o)n=e.parseString(t),s=4;else if(96===o)n=e.parseRawString(t),s=4;else if(45===o||o>=48&&o<=57)n=e.parseNumber(t),s=4;else if(37===o)n=e.parseData(t),s=4;else{if(36!==o)return void 0===r?jt.done(e.extant()):jt.done(r.bind());n=e.parseSelector(t),s=4}else if(t.isDone())return void 0===r?jt.done(e.extant()):jt.done(r.bind());if(2===s){for(;i.isCont()&&!t.isEmpty();)i=i.feed(t);if(i.isDone())(r=r||e.valueBuilder()).push(i.bind()),i=void 0,s=3;else if(i.isError())return i.asError()}if(3===s){for(;t.isCont()&&hs.isSpace(t.head());)t=t.step();if(t.isCont()){s=1;continue}if(t.isDone())return jt.done(r.bind())}if(4===s){for(;n.isCont()&&!t.isEmpty();)n=n.feed(t);if(n.isDone())(r=r||e.valueBuilder()).push(e.item(n.bind())),n=void 0,s=6;else if(n.isError())return n}if(5===s){for(;n.isCont()&&!t.isEmpty();)n=n.feed(t);if(n.isDone())n=void 0,s=6;else if(n.isError())return n}if(6===s){for(;t.isCont()&&hs.isSpace(t.head());)t=t.step();if(t.isCont()){if(64!==t.head())return jt.done(r.bind());s=1}else if(t.isDone())return jt.done(r.bind())}break}return new ds(e,r,i,n,s)}}class ps extends jt{constructor(t,e,r,i,n){super(),this.recon=t,this.builder=e,this.fieldParser=r,this.valueParser=i,this.step=n}feed(t){return ps.parse(t,this.recon,this.builder,this.fieldParser,this.valueParser,this.step)}static parse(t,e,r,i,n,s=1){let o=0;if(1===s)if(t.isCont())if(o=t.head(),64===o)i=e.parseAttr(t),s=2;else if(123===o)void 0!==r?(n=e.parseRecord(t,r),s=5):(n=e.parseRecord(t),s=4);else{if(91!==o)return void 0===r?jt.done(e.extant()):jt.done(r.bind());void 0!==r?(n=e.parseMarkup(t,r),s=5):(n=e.parseMarkup(t),s=4)}else if(t.isDone())return void 0===r?jt.done(e.extant()):jt.done(r.bind());if(2===s){for(;i.isCont()&&!t.isEmpty();)i=i.feed(t);if(i.isDone())(r=r||e.valueBuilder()).push(i.bind()),i=void 0,s=3;else if(i.isError())return i.asError()}if(3===s)if(t.isCont())if(o=t.head(),123===o)n=e.parseRecord(t,r),s=5;else{if(91!==o)return jt.done(r.bind());n=e.parseMarkup(t,r),s=5}else if(t.isDone())return jt.done(r.bind());if(4===s){for(;n.isCont()&&!t.isEmpty();)n=n.feed(t);if(n.isDone())return(r=r||e.valueBuilder()).push(e.item(n.bind())),jt.done(r.bind());if(n.isError())return n}if(5===s){for(;n.isCont()&&!t.isEmpty();)n=n.feed(t);if(n.isDone())return jt.done(r.bind());if(n.isError())return n}return new ps(e,r,i,n,s)}}class fs extends jt{constructor(t,e,r,i,n){super(),this.recon=t,this.builder=e,this.keyParser=r,this.valueParser=i,this.step=n}feed(t){return fs.parse(t,this.recon,this.builder,this.keyParser,this.valueParser,this.step)}static parse(t,e,r,i,n,s=1){let o=0;if(1===s)if(t.isCont()){if(o=t.head(),123!==o)return jt.error(Et.expected(123,t));t=t.step(),s=2}else if(t.isDone())return jt.error(Et.expected(123,t));t:for(;;){if(2===s){for(;t.isCont()&&(o=t.head(),hs.isWhitespace(o));)t=t.step();if(t.isCont()){if(r=r||e.recordBuilder(),125===o)return t=t.step(),jt.done(r.bind());35===o?(t=t.step(),s=8):s=3}else if(t.isDone())return jt.error(Et.expected(125,t))}if(3===s){for(void 0===i&&(i=e.parseBlockExpression(t));i.isCont()&&!t.isEmpty();)i=i.feed(t);if(i.isDone())s=4;else if(i.isError())return i}if(4===s){for(;t.isCont()&&(o=t.head(),hs.isSpace(o));)t=t.step();if(t.isCont())58===o?(t=t.step(),s=5):(r.push(e.item(i.bind())),i=void 0,s=7);else if(t.isDone())return jt.error(Et.expected(125,t))}if(5===s){for(;t.isCont()&&hs.isSpace(t.head());)t=t.step();if(t.isCont())s=6;else if(t.isDone())return r.push(e.slot(i.bind())),jt.done(r.bind())}if(6===s){for(void 0===n&&(n=e.parseBlockExpression(t));n.isCont()&&!t.isEmpty();)n=n.feed(t);if(n.isDone())r.push(e.slot(i.bind(),n.bind())),i=void 0,n=void 0,s=7;else if(n.isError())return n}if(7===s){for(;t.isCont()&&(o=t.head(),hs.isSpace(o));)t=t.step();if(t.isCont()){if(44===o||59===o||hs.isNewline(o)){t=t.step(),s=2;continue}if(35!==o)return 125===o?(t=t.step(),jt.done(r.bind())):jt.error(Et.expected("'}', ';', ',', or newline",t));t=t.step(),s=8}else if(t.isDone())return jt.error(Et.expected(125,t))}if(8===s){for(;t.isCont();){if(o=t.head(),hs.isNewline(o)){s=2;continue t}t=t.step()}if(t.isDone()){s=2;continue}}break}return new fs(e,r,i,n,s)}}class ys extends jt{constructor(t,e,r,i,n){super(),this.recon=t,this.builder=e,this.textOutput=r,this.valueParser=i,this.step=n}feed(t){return ys.parse(t,this.recon,this.builder,this.textOutput,this.valueParser,this.step)}static parse(t,e,r,i,n,s=1){let o=0;if(1===s)if(t.isCont()){if(o=t.head(),91!==o)return jt.error(Et.expected(91,t));t=t.step(),s=2}else if(t.isDone())return jt.error(Et.expected(91,t));for(;;){if(2===s){for(;t.isCont()&&(o=t.head(),64!==o&&91!==o&&92!==o&&93!==o&&123!==o&&125!==o);)t=t.step(),(i=i||e.textOutput()).write(o);if(t.isCont()){if(93===o)return t=t.step(),r=r||e.recordBuilder(),void 0!==i&&r.push(e.item(i.bind())),jt.done(r.bind());if(64===o)r=r||e.recordBuilder(),void 0!==i&&(r.push(e.item(i.bind())),i=void 0),n=e.parseInlineItem(t),s=3;else if(123===o)r=r||e.recordBuilder(),void 0!==i&&(r.push(e.item(i.bind())),i=void 0),n=e.parseRecord(t,r),s=4;else if(91===o)r=r||e.recordBuilder(),void 0!==i&&(r.push(e.item(i.bind())),i=void 0),n=e.parseMarkup(t,r),s=4;else{if(92!==o)return jt.error(Et.unexpected(t));t=t.step(),s=5}}else if(t.isDone())return jt.error(Et.unexpected(t))}if(3===s){for(;n.isCont()&&!t.isEmpty();)n=n.feed(t);if(n.isDone()){r.push(e.item(n.bind())),n=void 0,s=2;continue}if(n.isError())return n}if(4===s){for(;n.isCont()&&!t.isEmpty();)n=n.feed(t);if(n.isDone()){n=void 0,s=2;continue}if(n.isError())return n}if(5===s){if(t.isCont()){if(o=t.head(),i=i||e.textOutput(),34===o||36===o||39===o||47===o||64===o||91===o||92===o||93===o||123===o||125===o)t=t.step(),i.write(o),s=2;else if(98===o)t=t.step(),i.write(8),s=2;else if(102===o)t=t.step(),i.write(12),s=2;else if(110===o)t=t.step(),i.write(10),s=2;else if(114===o)t=t.step(),i.write(13),s=2;else{if(116!==o)return jt.error(Et.expected("escape character",t));t=t.step(),i.write(9),s=2}continue}if(t.isDone())return jt.error(Et.expected("escape character",t))}break}return new ys(e,r,i,n,s)}}class ms extends jt{constructor(t,e,r){super(),this.recon=t,this.base64Parser=e,this.step=r}feed(t){return ms.parse(t,this.recon,this.base64Parser,this.step)}static parse(t,e,r,i=1){let n=0;if(1===i)if(t.isCont()){if(n=t.head(),37!==n)return jt.error(Et.expected(37,t));t=t.step(),i=2}else if(t.isDone())return jt.error(Et.expected(37,t));if(2===i){for(void 0===r&&(r=le.standard().parse(t,e.dataOutput()));r.isCont()&&!t.isEmpty();)r=r.feed(t);if(r.isDone())return r;if(r.isError())return r}return new ms(e,r,i)}}class ws extends jt{constructor(t,e,r){super(),this.recon=t,this.output=e,this.step=r}feed(t){return ws.parse(t,this.recon,this.output,this.step)}static parse(t,e,r,i=1){let n=0;if(1===i)if(t.isCont()){if(n=t.head(),!hs.isIdentStartChar(n))return jt.error(Et.expected("identifier",t));t=t.step(),r=(r=r||e.textOutput()).write(n),i=2}else if(t.isDone())return jt.error(Et.expected("identifier",t));if(2===i){for(;t.isCont()&&(n=t.head(),hs.isIdentChar(n));)t=t.step(),r.write(n);if(!t.isEmpty())return jt.done(e.ident(r.bind()))}return new ws(e,r,i)}}class gs extends jt{constructor(t,e,r,i,n){super(),this.recon=t,this.output=e,this.quote=r,this.code=i,this.step=n}feed(t){return gs.parse(t,this.recon,this.output,this.quote,this.code,this.step)}static parse(t,e,r,i=0,n=0,s=1){let o=0;if(1===s){for(;t.isCont()&&(o=t.head(),hs.isWhitespace(o));)t=t.step();if(t.isCont()){if(34!==o&&39!==o||i!==o&&0!==i)return jt.error(Et.expected("string",t));t=t.step(),r=r||e.textOutput(),i=o,s=2}else if(t.isDone())return jt.error(Et.expected("string",t))}t:for(;;){if(2===s){for(;t.isCont()&&(o=t.head(),o>=32&&o!==i&&92!==o);)t=t.step(),r=r.write(o);if(t.isCont()){if(o===i)return t=t.step(),jt.done(r.bind());if(92!==o)return jt.error(Et.expected(i,t));t=t.step(),s=3}else if(t.isDone())return jt.error(Et.expected(i,t))}if(3===s)if(t.isCont()){if(o=t.head(),34===o||36===o||39===o||47===o||64===o||91===o||92===o||93===o||123===o||125===o){t=t.step(),r=r.write(o),s=2;continue}if(98===o){t=t.step(),r=r.write(8),s=2;continue}if(102===o){t=t.step(),r=r.write(12),s=2;continue}if(110===o){t=t.step(),r=r.write(10),s=2;continue}if(114===o){t=t.step(),r=r.write(13),s=2;continue}if(116===o){t=t.step(),r=r.write(9),s=2;continue}if(117!==o)return jt.error(Et.expected("escape character",t));t=t.step(),s=4}else if(t.isDone())return jt.error(Et.expected("escape character",t));if(s>=4)for(;;){if(t.isCont()){if(o=t.head(),te.isDigit(o)){if(t=t.step(),n=16*n+te.decodeDigit(o),s<=6){s+=1;continue}r=r.write(n),n=0,s=2;continue t}return jt.error(Et.expected("hex digit",t))}if(t.isDone())return jt.error(Et.expected("hex digit",t));break}break}return new gs(e,r,i,n,s)}}class vs extends jt{constructor(t,e,r,i){super(),this.recon=t,this.output=e,this.count=r,this.step=i}feed(t){return vs.parse(t,this.recon,this.output,this.count,this.step)}static parse(t,e,r,i=0,n=1){let s=0;if(1===n){for(;t.isCont()&&(s=t.head(),hs.isWhitespace(s));)t=t.step();if(t.isCont()&&96===s)t=t.step(),i=1,n=2;else if(t.isDone())return jt.error(Et.expected("raw string",t))}if(2===n)if(t.isCont())96===t.head()?(t=t.step(),i=2,n=3):(r=r||e.textOutput(),n=4);else if(t.isDone())return jt.error(Et.expected("raw string",t));if(3===n)if(t.isCont()){if(96!==t.head())return r=r||e.textOutput(),jt.done(r.bind());t=t.step(),r=r||e.textOutput(),i=3,n=4}else if(t.isDone())return r=r||e.textOutput(),jt.done(r.bind());for(;;){if(4===n){for(;t.isCont()&&(s=t.head(),(1!==i||s>=32)&&96!==s&&92!==s);)t=t.step(),r=r.write(s);if(t.isCont())if(92===s)t=t.step(),n=5;else{if(96!==s)return jt.error(Et.expected(96,t));if(t=t.step(),1===i)return jt.done(r.bind());n=6}else if(t.isDone())return jt.error(Et.expected(96,t))}if(5===n){if(t.isCont()){s=t.head(),t=t.step(),92!==s&&96!==s&&(r=r.write(92)),r=r.write(s),n=4;continue}if(t.isDone())return jt.error(Et.expected("escape character",t))}if(6===n)if(t.isCont()){if(96!==t.head()){r=r.write(96),n=4;continue}t=t.step(),n=7}else if(t.isDone())return jt.error(Et.message("unclosed raw string",t));if(7===n){if(t.isCont()){if(96===t.head())return t=t.step(),jt.done(r.bind());r=(r=r.write(96)).write(96),n=4;continue}if(t.isDone())return jt.error(Et.message("unclosed raw string",t))}break}return new vs(e,r,i,n)}}class bs extends jt{constructor(t,e,r,i,n){super(),this.recon=t,this.sign=e,this.value=r,this.mode=i,this.step=n}feed(t){return bs.parse(t,this.recon,this.sign,this.value,this.mode,this.step)}static parse(t,e,r=1,i=0,n=2,s=1){let o=0;if(1===s){for(;t.isCont()&&(o=t.head(),hs.isWhitespace(o));)t=t.step();if(t.isCont())45===o&&(t=t.step(),r=-1),s=2;else if(t.isDone())return jt.error(Et.expected("number",t))}if(2===s)if(t.isCont())if(o=t.head(),48===o)t=t.step(),s=4;else{if(!(o>=49&&o<=57))return jt.error(Et.expected("digit",t));t=t.step(),i=r*(o-48),s=3}else if(t.isDone())return jt.error(Et.expected("digit",t));if(3===s){for(;t.isCont()&&(o=t.head(),o>=48&&o<=57);){const e=10*i+r*(o-48);if(!(-9007199254740991<=e&&e<=9007199254740992))return jt.error(Et.message("integer overflow",t));i=e,t=t.step()}if(t.isCont())s=4;else if(t.isDone())return jt.done(e.num(i))}if(4===s){if(t.isCont()){if(o=t.head(),n>0&&46===o||n>1&&(69===o||101===o)){let s=Ct.stringOutput();return s=r<0&&0===i?s.write(45).write(48):s.write(""+i),xs.parse(t,e,s,n)}return 120===o&&r>0&&0===i?(t=t.step(),Cs.parse(t,e)):jt.done(e.num(i))}if(t.isDone())return jt.done(e.num(i))}return new bs(e,r,i,n,s)}static parseInteger(t,e){return bs.parse(t,e,void 0,void 0,0)}static parseDecimal(t,e){return bs.parse(t,e,void 0,void 0,1)}}class xs extends jt{constructor(t,e,r,i){super(),this.recon=t,this.output=e,this.mode=r,this.step=i}feed(t){return xs.parse(t,this.recon,this.output,this.mode,this.step)}static parse(t,e,r,i=2,n=1){let s=0;if(1===n)if(t.isCont())if(s=t.head(),46===s)t=t.step(),r=r.write(s),n=2;else{if(!(i>1)||69!==s&&101!==s)return jt.error(Et.expected("decimal or exponent",t));t=t.step(),r=r.write(s),n=5}else if(t.isDone())return jt.error(Et.expected("decimal or exponent",t));if(2===n)if(t.isCont()){if(s=t.head(),!(s>=48&&s<=57))return jt.error(Et.expected("digit",t));t=t.step(),r=r.write(s),n=3}else if(t.isDone())return jt.error(Et.expected("digit",t));if(3===n){for(;t.isCont()&&(s=t.head(),s>=48&&s<=57);)t=t.step(),r=r.write(s);if(t.isCont()){if(!(i>1))return jt.done(e.num(r.bind()));n=4}else if(t.isDone())return jt.done(e.num(r.bind()))}if(4===n){if(s=t.head(),69!==s&&101!==s)return jt.done(e.num(r.bind()));t=t.step(),r=r.write(s),n=5}if(5===n)if(t.isCont())s=t.head(),43!==s&&45!==s||(t=t.step(),r=r.write(s)),n=6;else if(t.isDone())return jt.error(Et.unexpected(t));if(6===n)if(t.isCont()){if(s=t.head(),!(s>=48&&s<=57))return jt.error(Et.expected("digit",t));t=t.step(),r=r.write(s),n=7}else if(t.isDone())return jt.error(Et.expected("digit",t));if(7===n){for(;t.isCont()&&(s=t.head(),s>=48&&s<=57);)t=t.step(),r=r.write(s);if(!t.isEmpty())return jt.done(e.num(r.bind()))}return new xs(e,r,i,n)}}class Cs extends jt{constructor(t,e,r){super(),this.recon=t,this.value=e,this.size=r}feed(t){return Cs.parse(t,this.recon,this.value,this.size)}static parse(t,e,r=0,i=0){let n=0;for(;t.isCont()&&(n=t.head(),te.isDigit(n));)t=t.step(),r=16*r+te.decodeDigit(n),i+=1;return t.isEmpty()?new Cs(e,r,i):i>0?i<=8?jt.done(e.uint32(r)):jt.done(e.uint64(r)):jt.error(Et.expected("hex digit",t))}}class Os extends jt{constructor(t,e,r,i,n){super(),this.recon=t,this.builder=e,this.bindingsParser=r,this.templateParser=i,this.step=n}feed(t){return Os.parse(t,this.recon,this.builder,this.bindingsParser,this.templateParser,this.step)}static parse(t,e,r,i,n,s=1){let o=0;if(1===s){for(void 0===i&&(i=e.parseConditionalOperator(t,r));i.isCont()&&!t.isEmpty();)i=i.feed(t);if(i.isDone())s=2;else if(i.isError())return i.asError()}if(2===s)if(t.isCont()){if(o=t.head(),62!==o)return i;t=t.step(),s=3}else if(t.isDone())return i;if(3===s){for(void 0===n&&(n=e.parseConditionalOperator(t));n.isCont()&&!t.isEmpty();)n=n.feed(t);if(n.isDone()){const t=i.bind(),r=n.bind();return jt.done(e.lambda(t,r))}if(n.isError())return n.asError()}return new Os(e,r,i,n,s)}}class Ss extends jt{constructor(t,e,r,i,n,s){super(),this.recon=t,this.builder=e,this.ifParser=r,this.thenParser=i,this.elseParser=n,this.step=s}feed(t){return Ss.parse(t,this.recon,this.builder,this.ifParser,this.thenParser,this.elseParser,this.step)}static parse(t,e,r,i,n,s,o=1){let a=0;if(1===o){for(void 0===i&&(i=e.parseOrOperator(t,r));i.isCont()&&!t.isEmpty();)i=i.feed(t);if(i.isDone())o=2;else if(i.isError())return i.asError()}if(2===o){for(;t.isCont()&&(a=t.head(),hs.isSpace(a));)t=t.step();if(t.isCont()){if(63!==a)return i;t=t.step(),o=3}else if(t.isDone())return i}if(3===o){for(void 0===n&&(n=e.parseConditionalOperator(t,r));n.isCont()&&!t.isEmpty();)n=n.feed(t);if(n.isDone())o=4;else if(n.isError())return n.asError()}if(4===o){for(;t.isCont()&&(a=t.head(),hs.isSpace(a));)t=t.step();if(t.isCont()){if(58!==a)return jt.error(Et.expected(58,t));t=t.step(),o=5}else if(t.isDone())return jt.error(Et.expected(58,t))}if(5===o){for(void 0===s&&(s=e.parseConditionalOperator(t,r));s.isCont()&&!t.isEmpty();)s=s.feed(t);if(s.isDone()){const t=i.bind(),r=n.bind(),o=s.bind();return jt.done(e.conditional(t,r,o))}if(s.isError())return s.asError()}return new Ss(e,r,i,n,s,o)}}class Es extends jt{constructor(t,e,r,i,n){super(),this.recon=t,this.builder=e,this.lhsParser=r,this.rhsParser=i,this.step=n}feed(t){return Es.parse(t,this.recon,this.builder,this.lhsParser,this.rhsParser,this.step)}static parse(t,e,r,i,n,s=1){let o=0;for(;;){if(1===s){for(void 0===i&&(i=e.parseAndOperator(t,r));i.isCont()&&!t.isEmpty();)i=i.feed(t);if(i.isDone())s=2;else if(i.isError())return i.asError()}if(2===s)if(t.isCont()){if(o=t.head(),124!==o)return i;t=t.step(),s=3}else if(t.isDone())return i;if(3===s){for(void 0===n&&(n=e.parseAndOperator(t,r));n.isCont()&&!t.isEmpty();)n=n.feed(t);if(n.isDone()){const t=i.bind(),r=n.bind();i=jt.done(e.or(t,r)),n=void 0,s=2;continue}if(n.isError())return n.asError()}break}return new Es(e,r,i,n,s)}}class ks extends jt{constructor(t,e,r,i,n){super(),this.recon=t,this.builder=e,this.lhsParser=r,this.rhsParser=i,this.step=n}feed(t){return ks.parse(t,this.recon,this.builder,this.lhsParser,this.rhsParser,this.step)}static parse(t,e,r,i,n,s=1){let o=0;for(;;){if(1===s){for(void 0===i&&(i=e.parseBitwiseOrOperator(t,r));i.isCont()&&!t.isEmpty();)i=i.feed(t);if(i.isDone())s=2;else if(i.isError())return i.asError()}if(2===s)if(t.isCont()){if(o=t.head(),38!==o)return i;t=t.step(),s=3}else if(t.isDone())return i;if(3===s){for(void 0===n&&(n=e.parseBitwiseOrOperator(t,r));n.isCont()&&!t.isEmpty();)n=n.feed(t);if(n.isDone()){const t=i.bind(),r=n.bind();i=jt.done(e.and(t,r)),n=void 0,s=2;continue}if(n.isError())return n.asError()}break}return new ks(e,r,i,n,s)}}class As extends jt{constructor(t,e,r,i,n){super(),this.recon=t,this.builder=e,this.lhsParser=r,this.rhsParser=i,this.step=n}feed(t){return As.parse(t,this.recon,this.builder,this.lhsParser,this.rhsParser,this.step)}static parse(t,e,r,i,n,s=1){let o=0;for(;;){if(1===s){for(void 0===i&&(i=e.parseBitwiseXorOperator(t,r));i.isCont()&&!t.isEmpty();)i=i.feed(t);if(i.isDone())s=2;else if(i.isError())return i.asError()}if(2===s){for(;t.isCont()&&(o=t.head(),hs.isSpace(o));)t=t.step();if(t.isCont()){if(124!==o)return i;t=t.step(),s=3}else if(t.isDone())return i}if(3===s)if(t.isCont()){if(o=t.head(),124===o)return i;s=4}else if(t.isDone())return jt.error(Et.unexpected(t));if(4===s){for(void 0===n&&(n=e.parseBitwiseXorOperator(t,r));n.isCont()&&!t.isEmpty();)n=n.feed(t);if(n.isDone()){const t=i.bind(),r=n.bind();i=jt.done(e.bitwiseOr(t,r)),n=void 0,s=2;continue}if(n.isError())return n.asError()}break}return new As(e,r,i,n,s)}}class Ms extends jt{constructor(t,e,r,i,n){super(),this.recon=t,this.builder=e,this.lhsParser=r,this.rhsParser=i,this.step=n}feed(t){return Ms.parse(t,this.recon,this.builder,this.lhsParser,this.rhsParser,this.step)}static parse(t,e,r,i,n,s=1){let o=0;for(;;){if(1===s){for(void 0===i&&(i=e.parseBitwiseAndOperator(t,r));i.isCont()&&!t.isEmpty();)i=i.feed(t);if(i.isDone())s=2;else if(i.isError())return i.asError()}if(2===s){for(;t.isCont()&&(o=t.head(),hs.isSpace(o));)t=t.step();if(t.isCont()){if(94!==o)return i;t=t.step(),s=3}else if(t.isDone())return i}if(3===s){for(void 0===n&&(n=e.parseBitwiseAndOperator(t,r));n.isCont()&&!t.isEmpty();)n=n.feed(t);if(n.isDone()){const t=i.bind(),r=n.bind();i=jt.done(e.bitwiseXor(t,r)),n=void 0,s=2;continue}if(n.isError())return n.asError()}break}return new Ms(e,r,i,n,s)}}class Ds extends jt{constructor(t,e,r,i,n){super(),this.recon=t,this.builder=e,this.lhsParser=r,this.rhsParser=i,this.step=n}feed(t){return Ds.parse(t,this.recon,this.builder,this.lhsParser,this.rhsParser,this.step)}static parse(t,e,r,i,n,s=1){let o=0;for(;;){if(1===s){for(void 0===i&&(i=e.parseComparisonOperator(t,r));i.isCont()&&!t.isEmpty();)i=i.feed(t);if(i.isDone())s=2;else if(i.isError())return i.asError()}if(2===s){for(;t.isCont()&&(o=t.head(),hs.isSpace(o));)t=t.step();if(t.isCont()){if(38!==o)return i;t=t.step(),s=3}else if(t.isDone())return i}if(3===s)if(t.isCont()){if(o=t.head(),38===o)return i;s=4}else if(t.isDone())return jt.error(Et.unexpected(t));if(4===s){for(void 0===n&&(n=e.parseComparisonOperator(t,r));n.isCont()&&!t.isEmpty();)n=n.feed(t);if(n.isDone()){const t=i.bind(),r=n.bind();i=jt.done(e.bitwiseAnd(t,r)),n=void 0,s=2;continue}if(n.isError())return n.asError()}break}return new Ds(e,r,i,n,s)}}class Is extends jt{constructor(t,e,r,i,n,s){super(),this.recon=t,this.builder=e,this.lhsParser=r,this.operator=i,this.rhsParser=n,this.step=s}feed(t){return Is.parse(t,this.recon,this.builder,this.lhsParser,this.operator,this.rhsParser,this.step)}static parse(t,e,r,i,n,s,o=1){let a=0;if(1===o){for(void 0===i&&(i=e.parseAttrExpression(t,r));i.isCont()&&!t.isEmpty();)i=i.feed(t);if(i.isDone())o=2;else if(i.isError())return i.asError()}if(2===o){for(;t.isCont()&&(a=t.head(),hs.isSpace(a));)t=t.step();if(t.isCont())if(33===a)t=t.step(),o=3;else if(60===a)t=t.step(),o=4;else if(62===a)t=t.step(),o=5;else{if(61!==a)return i;t=t.step(),o=6}else if(t.isDone())return i}if(3===o)if(t.isCont())a=t.head(),61===a?(t=t.step(),n="!=",o=7):(n="!",o=7);else if(t.isDone())return jt.error(Et.unexpected(t));if(4===o)if(t.isCont())a=t.head(),61===a?(t=t.step(),n="<=",o=7):(n="<",o=7);else if(t.isDone())return jt.error(Et.unexpected(t));if(5===o)if(t.isCont())a=t.head(),61===a?(t=t.step(),n=">=",o=7):(n=">",o=7);else if(t.isDone())return jt.error(Et.unexpected(t));if(6===o)if(t.isCont())if(a=t.head(),61===a)t=t.step(),n="==",o=7;else{if(62===a)return i;n="=",o=7}else if(t.isDone())return jt.error(Et.unexpected(t));if(7===o){for(void 0===s&&(s=e.parseAttrExpression(t,r));s.isCont()&&!t.isEmpty();)s=s.feed(t);if(s.isDone()){const r=i.bind(),o=s.bind();return"<"===n?jt.done(e.lt(r,o)):"<="===n?jt.done(e.le(r,o)):"=="===n?jt.done(e.eq(r,o)):"!="===n?jt.done(e.ne(r,o)):">="===n?jt.done(e.ge(r,o)):">"===n?jt.done(e.gt(r,o)):jt.error(Et.message(n,t))}if(s.isError())return s.asError()}return new Is(e,r,i,n,s,o)}}class Ps extends jt{constructor(t,e,r,i,n){super(),this.recon=t,this.builder=e,this.fieldParser=r,this.valueParser=i,this.step=n}feed(t){return Ps.parse(t,this.recon,this.builder,this.fieldParser,this.valueParser,this.step)}static parse(t,e,r,i,n,s=1){let o=0;for(;;){if(1===s){for(;t.isCont()&&(o=t.head(),hs.isSpace(o));)t=t.step();if(t.isCont())if(64===o)s=2;else if(123===o||91===o)r=r||e.recordBuilder(),s=5;else if(40===o)s=4;else{if(!(33===o||34===o||36===o||37===o||39===o||43===o||45===o||o>=48&&o<=57||96===o||126===o||hs.isIdentStartChar(o)))return void 0===r?jt.done(e.extant()):jt.done(r.bind());s=3}else if(t.isDone())return void 0===r?jt.done(e.extant()):jt.done(r.bind())}if(2===s){for(void 0===i&&(i=e.parseAttr(t));i.isCont()&&!t.isEmpty();)i=i.feed(t);if(i.isDone()){(r=r||e.recordBuilder()).push(i.bind()),i=void 0,s=1;continue}if(i.isError())return i.asError()}if(3===s){for(void 0===n&&(n=e.parseAdditiveOperator(t));n.isCont()&&!t.isEmpty();)n=n.feed(t);if(n.isDone())(r=r||e.valueBuilder()).push(e.item(n.bind())),n=void 0,s=6;else if(n.isError())return n.asError()}if(4===s){for(void 0===n&&(n=e.parseAdditiveOperator(t,r));n.isCont()&&!t.isEmpty();)n=n.feed(t);if(n.isDone())void 0===r&&(r=e.valueBuilder()).push(e.item(n.bind())),n=void 0,s=6;else if(n.isError())return n.asError()}if(5===s){for(void 0===n&&(n=e.parseAdditiveOperator(t,r));n.isCont()&&!t.isEmpty();)n=n.feed(t);if(n.isDone())n=void 0,s=6;else if(n.isError())return n.asError()}if(6===s){for(;t.isCont()&&(o=t.head(),hs.isSpace(o));)t=t.step();if(t.isCont()){if(64===o){s=1;continue}return jt.done(r.bind())}if(t.isDone())return jt.done(r.bind())}break}return new Ps(e,r,i,n,s)}}class Ts extends jt{constructor(t,e,r,i,n,s){super(),this.recon=t,this.builder=e,this.lhsParser=r,this.operator=i,this.rhsParser=n,this.step=s}feed(t){return Ts.parse(t,this.recon,this.builder,this.lhsParser,this.operator,this.rhsParser,this.step)}static parse(t,e,r,i,n,s,o=1){let a=0;for(;;){if(1===o){for(void 0===i&&(i=e.parseMultiplicativeOperator(t,r));i.isCont()&&!t.isEmpty();)i=i.feed(t);if(i.isDone())o=2;else if(i.isError())return i.asError()}if(2===o){for(;t.isCont()&&(a=t.head(),hs.isSpace(a));)t=t.step();if(t.isCont())if(43===a)t=t.step(),n="+",o=3;else{if(45!==a)return i;t=t.step(),n="-",o=3}else if(t.isDone())return i}if(3===o){for(void 0===s&&(s=e.parseMultiplicativeOperator(t,r));s.isCont()&&!t.isEmpty();)s=s.feed(t);if(s.isDone()){const r=i.bind(),a=s.bind();if("+"===n)i=jt.done(e.plus(r,a));else{if("-"!==n)return jt.error(Et.message(n,t));i=jt.done(e.minus(r,a))}s=void 0,n=void 0,o=2;continue}if(s.isError())return s.asError()}break}return new Ts(e,r,i,n,s,o)}}class Vs extends jt{constructor(t,e,r,i,n,s){super(),this.recon=t,this.builder=e,this.lhsParser=r,this.operator=i,this.rhsParser=n,this.step=s}feed(t){return Vs.parse(t,this.recon,this.builder,this.lhsParser,this.operator,this.rhsParser,this.step)}static parse(t,e,r,i,n,s,o=1){let a=0;for(;;){if(1===o){for(void 0===i&&(i=e.parsePrefixOperator(t,r));i.isCont()&&!t.isEmpty();)i=i.feed(t);if(i.isDone())o=2;else if(i.isError())return i.asError()}if(2===o){for(;t.isCont()&&(a=t.head(),hs.isSpace(a));)t=t.step();if(t.isCont())if(42===a)t=t.step(),n="*",o=3;else if(47===a)t=t.step(),n="/",o=3;else{if(37!==a)return i;t=t.step(),n="%",o=3}else if(t.isDone())return i}if(3===o){for(void 0===s&&(s=e.parsePrefixOperator(t,r));s.isCont()&&!t.isEmpty();)s=s.feed(t);if(s.isDone()){const r=i.bind(),a=s.bind();if("*"===n)i=jt.done(e.times(r,a));else if("/"===n)i=jt.done(e.divide(r,a));else{if("%"!==n)return jt.error(Et.message(n,t));i=jt.done(e.modulo(r,a))}s=void 0,n=void 0,o=2;continue}if(s.isError())return s.asError()}break}return new Vs(e,r,i,n,s,o)}}class Fs extends jt{constructor(t,e,r,i,n){super(),this.recon=t,this.builder=e,this.operator=r,this.operandParser=i,this.step=n}feed(t){return Fs.parse(t,this.recon,this.builder,this.operator,this.operandParser,this.step)}static parse(t,e,r,i,n,s=1){let o=0;if(1===s){for(;t.isCont()&&(o=t.head(),hs.isSpace(o));)t=t.step();if(t.isCont()){if(33===o)t=t.step(),i="!";else if(126===o)t=t.step(),i="~";else if(45===o)t=t.step(),i="-";else{if(43!==o)return e.parseInvokeOperator(t,r);t=t.step(),i="+"}s=2}else if(t.isDone())return e.parseInvokeOperator(t,r)}if(2===s){for(void 0===n&&(n=e.parsePrefixOperator(t,r));n.isCont()&&!t.isEmpty();)n=n.feed(t);if(n.isDone()){const r=n.bind();return e.isDistinct(r)?"!"===i?jt.done(e.not(r)):"~"===i?jt.done(e.bitwiseNot(r)):"-"===i?jt.done(e.negative(r)):"+"===i?jt.done(e.positive(r)):jt.error(Et.message(i,t)):jt.error(Et.expected("value",t))}if(n.isError())return n.asError()}return new Fs(e,r,i,n,s)}}class qs extends jt{constructor(t,e,r,i,n){super(),this.recon=t,this.builder=e,this.exprParser=r,this.argsParser=i,this.step=n}feed(t){return qs.parse(t,this.recon,this.builder,this.exprParser,this.argsParser,this.step)}static parse(t,e,r,i,n,s=1){let o=0;if(1===s){for(void 0===i&&(i=e.parsePrimary(t,r));i.isCont()&&!t.isEmpty();)i=i.feed(t);if(i.isDone())s=2;else if(i.isError())return i.asError()}for(;;){if(2===s){for(;t.isCont()&&(o=t.head(),hs.isSpace(o));)t=t.step();if(t.isCont()){if(40!==o)return i;t=t.step(),s=3}else if(t.isDone())return i}if(3===s){for(;t.isCont()&&(o=t.head(),hs.isWhitespace(o));)t=t.step();if(t.isCont()){if(41===o){t=t.step();const r=i.bind();i=jt.done(e.invoke(r,e.extant())),s=2;continue}s=4}else if(t.isDone())return jt.error(Et.expected(41,t))}if(4===s){for(void 0===n&&(n=e.parseBlock(t));n.isCont()&&!t.isEmpty();)n=n.feed(t);if(n.isDone())s=5;else if(n.isError())return n.asError()}if(5===s){for(;t.isCont()&&(o=t.head(),hs.isWhitespace(o));)t=t.step();if(t.isCont()){if(41===o){t=t.step();const r=i.bind(),o=n.bind();i=jt.done(e.invoke(r,o)),n=void 0,s=2;continue}return jt.error(Et.expected(41,t))}if(t.isDone())return jt.error(Et.expected(41,t))}break}return new qs(e,r,i,n,s)}}class Us extends jt{constructor(t,e,r,i){super(),this.recon=t,this.builder=e,this.exprParser=r,this.step=i}feed(t){return Us.parse(t,this.recon,this.builder,this.exprParser,this.step)}static parse(t,e,r,i,n=1){let s=0;if(1===n){for(;t.isCont()&&(s=t.head(),hs.isSpace(s));)t=t.step();t.isCont()?40===s?(t=t.step(),n=3):n=2:t.isDone()&&(n=2)}if(2===n){for(void 0===i&&(i=e.parseLiteral(t,r));i.isCont()&&!t.isEmpty();)i=i.feed(t);if(i.isDone())return i;if(i.isError())return i.asError()}if(3===n){for(void 0===i&&(i=e.parseBlockExpression(t,r));i.isCont()&&!t.isEmpty();)i=i.feed(t);if(i.isDone())n=4;else if(i.isError())return i.asError()}for(;;){if(4===n){for(;t.isCont()&&(s=t.head(),hs.isSpace(s));)t=t.step();if(t.isCont()){if(44!==s)return 41===s?(t=t.step(),void 0!==i?i:jt.done(r.bind())):jt.error(Et.expected(41,t));t=t.step(),void 0!==i&&(void 0===r&&(r=e.recordBuilder()).push(e.item(i.bind())),i=void 0),n=5}else if(t.isDone())return jt.error(Et.expected(41,t))}if(5===n){for(void 0===i&&(i=e.parseBlockExpression(t,r));i.isCont()&&!t.isEmpty();)i=i.feed(t);if(i.isDone()){i=void 0,n=4;continue}if(i.isError())return i.asError()}break}return new Us(e,r,i,n)}}class Rs extends jt{constructor(t,e,r,i){super(),this.recon=t,this.builder=e,this.valueParser=r,this.step=i}feed(t){return Rs.parse(t,this.recon,this.builder,this.valueParser,this.step)}static parse(t,e,r,i,n=1){let s=0;if(1===n){for(;t.isCont()&&(s=t.head(),hs.isSpace(s));)t=t.step();if(t.isCont())if(40===s)t=t.step(),n=4;else if(123===s)r=r||e.recordBuilder(),i=e.parseRecord(t,r),n=3;else if(91===s)r=r||e.recordBuilder(),i=e.parseMarkup(t,r),n=3;else if(hs.isIdentStartChar(s))i=e.parseIdent(t),n=2;else if(34===s||39===s)i=e.parseString(t),n=2;else if(96===s)i=e.parseRawString(t),n=2;else if(45===s||s>=48&&s<=57)i=e.parseNumber(t),n=2;else if(37===s)i=e.parseData(t),n=2;else{if(36!==s)return void 0===r?jt.done(e.extant()):jt.done(r.bind());i=e.parseSelector(t),n=2}else if(t.isDone())return void 0===r?jt.done(e.extant()):jt.done(r.bind())}if(2===n){for(;i.isCont()&&!t.isEmpty();)i=i.feed(t);if(i.isDone())return(r=r||e.valueBuilder()).push(e.item(i.bind())),jt.done(r.bind());if(i.isError())return i.asError()}if(3===n){for(;i.isCont()&&!t.isEmpty();)i=i.feed(t);if(i.isDone())return jt.done(r.bind());if(i.isError())return i.asError()}if(4===n){for(void 0===i&&(i=e.parseBlockExpression(t));i.isCont()&&!t.isEmpty();)i=i.feed(t);if(i.isDone())n=5;else if(i.isError())return i.asError()}if(5===n){for(;t.isCont()&&(s=t.head(),hs.isWhitespace(s));)t=t.step();if(t.isCont())return 41===s?(t=t.step(),(r=r||e.valueBuilder()).push(e.item(i.bind())),jt.done(r.bind())):jt.error(Et.expected(41,t));if(t.isDone())return jt.error(Et.expected(41,t))}return new Rs(e,r,i,n)}}class Ns extends jt{constructor(t,e,r,i,n){super(),this.recon=t,this.builder=e,this.selector=r,this.valueParser=i,this.step=n}feed(t){return Ns.parse(t,this.recon,this.builder,this.selector,this.valueParser,this.step)}static parse(t,e,r,i,n,s=1){let o=0;if(1===s){for(;t.isCont()&&(o=t.head(),hs.isSpace(o));)t=t.step();if(t.isCont()&&36===o)t=t.step(),i=i||e.selector(),s=2;else if(t.isDone())return jt.error(Et.expected(36,t))}if(2===s)if(t.isCont())o=t.head(),91===o?(t=t.step(),s=8):64===o?(t=t.step(),s=7):58===o?(t=t.step(),s=6):42===o?(t=t.step(),s=5):35===o?(t=t.step(),s=4):s=3;else if(t.isDone())return jt.error(Et.unexpected(t));for(;;){if(3===s){for(void 0===n&&(n=e.parseLiteral(t,e.valueBuilder()));n.isCont()&&!t.isEmpty();)n=n.feed(t);if(n.isDone())i=e.get(i,n.bind()),n=void 0,s=10;else if(n.isError())return n.asError()}if(4===s){for(void 0===n&&(n=e.parseInteger(t));n.isCont()&&!t.isEmpty();)n=n.feed(t);if(n.isDone())i=e.value(e.getItem(i,n.bind())),n=void 0,s=10;else if(n.isError())return n.asError()}if(5===s&&(t.isCont()?(o=t.head(),58===o?(t=t.step(),i=e.keys(i),s=10):42===o?(t=t.step(),i=e.descendants(i),s=10):(i=e.children(i),s=10)):t.isDone()&&(i=e.children(i),s=10)),6===s)if(t.isCont()){if(o=t.head(),42!==o)return jt.error(Et.expected(42,t));t=t.step(),i=e.values(i),s=10}else if(t.isDone())return jt.error(Et.expected(42,t));if(7===s){for(void 0===n&&(n=e.parseIdent(t));n.isCont()&&!t.isEmpty();)n=n.feed(t);if(n.isDone())i=e.getAttr(i,n.bind()),n=void 0,s=10;else if(n.isError())return n.asError()}if(8===s){for(void 0===n&&(n=e.parseBlockExpression(t));n.isCont()&&!t.isEmpty();)n=n.feed(t);if(n.isDone())s=9;else if(n.isError())return n.asError()}if(9===s){for(;t.isCont()&&(o=t.head(),hs.isSpace(o));)t=t.step();if(t.isCont()){if(93!==o)return jt.error(Et.expected(93,t));t=t.step(),i=e.filter(i,n.bind()),n=void 0,s=10}else if(t.isDone())return jt.error(Et.expected(93,t))}if(10===s)if(t.isCont()){if(o=t.head(),91===o){t=t.step(),s=8;continue}if(35===o){t=t.step(),s=4;continue}if(46!==o)return void 0!==r?(r.push(e.item(i)),jt.done(r.bind())):jt.done(i);t=t.step(),s=11}else if(t.isDone())return void 0!==r?(r.push(e.item(i)),jt.done(r.bind())):jt.done(i);if(11===s){if(t.isCont()){if(o=t.head(),64===o){t=t.step(),s=7;continue}if(58===o){t=t.step(),s=6;continue}if(42===o){t=t.step(),s=5;continue}s=3;continue}if(t.isDone())return jt.error(Et.unexpected(t))}break}return new Ns(e,r,i,n,s)}}class zs{parseBlock(t){return ls.parse(t,this)}parseAttr(t){return cs.parse(t,this)}parseBlockItem(t){return ds.parse(t,this)}parseInlineItem(t){return ps.parse(t,this)}parseRecord(t,e){return fs.parse(t,this,e)}parseMarkup(t,e){return ys.parse(t,this,e)}parseData(t){return ms.parse(t,this)}parseIdent(t){return ws.parse(t,this)}parseString(t){return gs.parse(t,this)}parseRawString(t){return vs.parse(t,this)}parseNumber(t){return bs.parse(t,this)}parseInteger(t){return bs.parseInteger(t,this)}parseBlockExpression(t,e){return this.parseLambdaFunc(t,e)}parseLambdaFunc(t,e){return Os.parse(t,this,e)}parseConditionalOperator(t,e){return Ss.parse(t,this,e)}parseOrOperator(t,e){return Es.parse(t,this,e)}parseAndOperator(t,e){return ks.parse(t,this,e)}parseBitwiseOrOperator(t,e){return As.parse(t,this,e)}parseBitwiseXorOperator(t,e){return Ms.parse(t,this,e)}parseBitwiseAndOperator(t,e){return Ds.parse(t,this,e)}parseComparisonOperator(t,e){return Is.parse(t,this,e)}parseAttrExpression(t,e){return Ps.parse(t,this,e)}parseAdditiveOperator(t,e){return Ts.parse(t,this,e)}parseMultiplicativeOperator(t,e){return Vs.parse(t,this,e)}parsePrefixOperator(t,e){return Fs.parse(t,this,e)}parseInvokeOperator(t,e){return qs.parse(t,this,e)}parsePrimary(t,e){return Us.parse(t,this,e)}parseLiteral(t,e){return Rs.parse(t,this,e)}parseSelector(t,e){return Ns.parse(t,this,e)}blockParser(){return new ls(this)}parseBlockString(t){let e=Ct.stringInput(t);for(;e.isCont()&&hs.isWhitespace(e.head());)e=e.step();let r=this.parseBlock(e);if(r.isDone())for(;e.isCont()&&hs.isWhitespace(e.head());)e=e.step();return e.isCont()&&!r.isError()&&(r=jt.error(Et.unexpected(e))),r.bind()}}class js extends zs{isDistinct(t){return t.isDistinct()}item(t){return t}value(t){return t.toValue()}attr(t,e){return 1===arguments.length?dr.of(t):dr.of(t,e)}slot(t,e){return 1===arguments.length?lr.of(t):lr.of(t,e)}valueBuilder(){return yr.builder()}recordBuilder(){return mr.create()}dataOutput(){return Cr.output()}textOutput(){return Sr.output()}ident(t){if(t instanceof Sr){const e=t.stringValue();if("true"===e)return Mr.from(!0);if("false"===e)return Mr.from(!1)}return t}num(t){if("number"==typeof t)return kr.from(t);if("string"==typeof t)return kr.from(+t);throw new TypeError(""+t)}uint32(t){return kr.uint32(t)}uint64(t){return kr.uint64(t)}bool(t){return Mr.from(t)}selector(){return li.identity()}extant(){return yr.extant()}absent(){return yr.absent()}conditional(t,e,r){return t.conditional(e,r)}or(t,e){return new Kr(t,e)}and(t,e){return new Br(t,e)}bitwiseOr(t,e){return new Wr(t,e)}bitwiseXor(t,e){return new Hr(t,e)}bitwiseAnd(t,e){return new Xr(t,e)}lt(t,e){return new Yr(t,e)}le(t,e){return new Gr(t,e)}eq(t,e){return new _r(t,e)}ne(t,e){return new Qr(t,e)}ge(t,e){return new Zr(t,e)}gt(t,e){return new Jr(t,e)}plus(t,e){return new $r(t,e)}minus(t,e){return new ti(t,e)}times(t,e){return new ei(t,e)}divide(t,e){return new ri(t,e)}modulo(t,e){return new ii(t,e)}not(t){return new ni(t)}bitwiseNot(t){return new si(t)}negative(t){return t instanceof kr?t.negative():new oi(t)}positive(t){return new ai(t)}invoke(t,e){return new ui(t,e)}lambda(t,e){return t.lambda(e)}get(t,e){return t.get(e)}getAttr(t,e){return t.getAttr(e)}getItem(t,e){return t.getItem(e)}children(t){return li.literal(t).children()}descendants(t){return li.literal(t).descendants()}keys(t){return li.literal(t).keys()}values(t){return li.literal(t).values()}filter(t,e){return t.filter(e)}}class Ls extends bt{constructor(t,e,r,i,n){super(),this.recon=t,this.key=e,this.value=r,this.part=i,this.step=n}pull(t){return Ls.write(t,this.recon,this.key,this.value,this.part,this.step)}static sizeOf(t,e,r){let i=0;return i+=1,i+=t.sizeOfValue(e),t.isExtant(t.item(r))||(i+=1,i+=t.sizeOfBlockValue(r),i+=1),i}static write(t,e,r,i,n,s=1){if(1===s&&t.isCont()&&(t=t.write(64),s=2),2===s)if((n=void 0===n?e.writeValue(t,r):n.pull(t)).isDone()){if(n=void 0,e.isExtant(e.item(i)))return bt.end();s=3}else if(n.isError())return n.asError();if(3===s&&t.isCont()&&(t=t.write(40),s=4),4===s)if((n=void 0===n?e.writeBlockValue(t,i):n.pull(t)).isDone())n=void 0,s=5;else if(n.isError())return n.asError();return 5===s&&t.isCont()?(t=t.write(41),bt.end()):t.isDone()?bt.error(new vt("truncated")):t.isError()?bt.error(t.trap()):new Ls(e,r,i,n,s)}}class Ks extends bt{constructor(t,e,r,i,n){super(),this.recon=t,this.key=e,this.value=r,this.part=i,this.step=n}pull(t){return Ks.write(t,this.recon,this.key,this.value,this.part,this.step)}static sizeOf(t,e,r){let i=0;return i+=t.sizeOfValue(e),i+=1,t.isExtant(t.item(r))||(i+=t.sizeOfValue(r)),i}static write(t,e,r,i,n,s=1){if(1===s)if((n=void 0===n?e.writeValue(t,r):n.pull(t)).isDone())n=void 0,s=2;else if(n.isError())return n.asError();if(2===s&&t.isCont()){if(t=t.write(58),e.isExtant(e.item(i)))return bt.end();s=3}if(3===s){if((n=void 0===n?e.writeValue(t,i):n.pull(t)).isDone())return bt.end();if(n.isError())return n.asError()}return t.isDone()?bt.error(new vt("truncated")):t.isError()?bt.error(t.trap()):new Ks(e,r,i,n,s)}}class Bs extends bt{constructor(t,e,r,i,n,s,o,a,u,h,l,c){super(),this.recon=t,this.items=e,this.inBlock=r,this.inMarkup=i,this.inBraces=n,this.inBrackets=s,this.first=o,this.markupSafe=a,this.item=u,this.next=h,this.part=l,this.step=c}pull(t){return Bs.write(t,this.recon,this.items,this.inBlock,this.inMarkup,this.inBraces,this.inBrackets,this.first,this.markupSafe,this.item,this.next,this.part,this.step)}static sizeOf(t,e,r,i){let n,s=0,o=!1,a=!1,u=!0,h=!0;for(;void 0!==n||e.hasNext();){let l;void 0===n?l=e.next().value:(l=n,n=void 0),e.hasNext()&&(n=e.next().value),t.isExpression(l)&&(h=!1),a&&t.isAttr(l)&&(o&&(s+=1,o=!1),s+=1,a=!1),t.isAttr(l)?(o?(s+=1,o=!1):a&&(s+=1,a=!1),s+=t.sizeOfItem(l),u=!1):a&&t.isText(l)?(o&&(s+=1,o=!1),s+=t.sizeOfMarkupText(l)):o?(u?u=!1:s+=1,s+=Bs.sizeOfBlockItem(t,l)):a?t.isRecord(l)&&t.isMarkupSafe(t.items(l))?(s+=t.sizeOfBlock(t.items(l),!1,!0),void 0!==n&&t.isText(n)?(s+=t.sizeOfMarkupText(n),n=void 0):void 0===n||t.isAttr(n)?(s+=1,a=!1):(s+=1,o=!0,u=!0)):(s+=1,s+=t.sizeOfItem(l),o=!0,u=!1):!h||!t.isText(l)||void 0===n||t.isField(n)||t.isText(n)||t.isBool(n)?r&&!o?(u?u=!1:s+=1,s+=Bs.sizeOfBlockItem(t,l)):i&&t.isText(l)&&void 0===n?(s+=1,s+=t.sizeOfMarkupText(l),s+=1):!i&&t.isValue(l)&&!t.isRecord(l)&&(!u&&void 0===n||void 0!==n&&t.isAttr(n))?(!u&&(t.isText(l)&&t.isIdent(l)||t.isNum(l)||t.isBool(l))&&(s+=1),s+=t.sizeOfItem(l)):(s+=1,s+=t.sizeOfItem(l),o=!0,u=!1):(s+=1,s+=t.sizeOfMarkupText(l),a=!0)}return o&&(s+=1),a&&(s+=1),s}static sizeOfBlockItem(t,e){let r=0;return t.isField(e)?r+=t.sizeOfSlot(t.key(e),t.value(e)):r+=t.sizeOfItem(e),r}static write(t,e,r,i,n,s=!1,o=!1,a=!0,u=!0,h,l,c,d=1){for(;;){if(1===d){if(void 0===l&&!r.hasNext()){d=10;break}void 0===l?h=r.next().value:(h=l,l=void 0),r.hasNext()&&(l=r.next().value),e.isExpression(h)&&(u=!1),d=2}if(2===d&&t.isCont()&&(o&&e.isAttr(h)?(s&&(t=t.write(125),s=!1),d=3):d=4),3===d&&t.isCont()&&(t=t.write(93),o=!1,d=4),4===d&&t.isCont()&&(e.isAttr(h)?(s?(t=t.write(125),s=!1):o&&(t=t.write(93),o=!1),c=e.writeItem(t,h),a=!1,d=7):o&&e.isText(h)?(s&&(t=t.write(125),s=!1),c=e.writeMarkupText(t,h),d=7):s?(a?a=!1:t=t.write(44),c=Bs.writeBlockItem(t,e,h),d=7):o?e.isRecord(h)&&e.isMarkupSafe(e.items(h))?(c=e.writeBlock(t,e.items(h),!1,!0),d=5):(t=t.write(123),c=e.writeItem(t,h),s=!0,a=!1,d=7):!u||!e.isText(h)||void 0===l||e.isField(l)||e.isText(l)||e.isBool(l)?i&&!s?(a?a=!1:t=t.write(44),c=Bs.writeBlockItem(t,e,h),d=7):n&&e.isText(h)&&void 0===l?(t=t.write(91),c=e.writeMarkupText(t,h),d=8):!n&&e.isValue(h)&&!e.isRecord(h)&&(!a&&void 0===l||void 0!==l&&e.isAttr(l))?(!a&&(e.isText(h)&&e.isIdent(h)||e.isNum(h)||e.isBool(h))&&(t=t.write(32)),c=e.writeItem(t,h),d=7):(t=t.write(123),c=e.writeItem(t,h),s=!0,a=!1,d=7):(t=t.write(91),c=e.writeMarkupText(t,h),o=!0,d=7)),5===d)if((c=c.pull(t)).isDone())c=void 0,d=6;else if(c.isError())return c.asError();if(6===d&&t.isCont()){if(void 0===l||!e.isText(l)){if(void 0===l||e.isAttr(l)){t=t.write(93),o=!1,d=1;continue}t=t.write(123),s=!0,a=!0,d=1;continue}c=e.writeMarkupText(t,l),l=void 0,d=7}if(7===d){if((c=c.pull(t)).isDone()){c=void 0,d=1;continue}if(c.isError())return c.asError()}if(8===d)if((c=c.pull(t)).isDone())c=void 0,d=9;else if(c.isError())return c.asError();if(9!==d||!t.isCont())break;t=t.write(93),d=1}if(10===d&&(s?t.isCont()&&(t=t.write(125),d=11):d=11),11===d){if(!o)return bt.end();if(t.isCont())return t=t.write(93),bt.end()}return t.isDone()?bt.error(new vt("truncated")):t.isError()?bt.error(t.trap()):new Bs(e,r,i,n,s,o,a,u,h,l,c,d)}static writeBlockItem(t,e,r){return e.isField(r)?e.writeSlot(t,e.key(r),e.value(r)):e.writeItem(t,r)}}class Ws extends bt{constructor(t,e,r,i,n,s,o,a){super(),this.recon=t,this.items=e,this.inParens=r,this.first=i,this.item=n,this.next=s,this.part=o,this.step=a}pull(t){return Ws.write(t,this.recon,this.items,this.inParens,this.first,this.item,this.next,this.part,this.step)}static sizeOf(t,e){let r,i=0,n=!1,s=!0;for(;void 0!==r||e.hasNext();){let o;void 0===r?o=e.next().value:(o=r,r=void 0),e.hasNext()&&(r=e.next().value),n||s||(i+=1),t.isAttr(o)?(n&&(i+=1,n=!1),i+=t.sizeOfItem(o),s=!1):n?(s?s=!1:i+=1,i+=t.sizeOfBlockItem(o)):t.isValue(o)&&!t.isRecord(o)&&(!s&&void 0===r||void 0!==r&&t.isAttr(r))?i+=t.sizeOfItem(o):(i+=1,i+=t.sizeOfItem(o),n=!0,s=!1)}return n&&(i+=1),i}static write(t,e,r,i=!1,n=!0,s,o,a,u=1){for(;;){if(1===u){if(void 0===o&&!r.hasNext()){u=5;break}void 0===o?s=r.next().value:(s=o,o=void 0),r.hasNext()&&(o=r.next().value),u=2}if(2===u&&t.isCont()&&(i||n||(t=t.write(32)),u=3),3===u&&t.isCont()&&(e.isAttr(s)?(i&&(t=t.write(41),i=!1),a=e.writeItem(t,s),n=!1,u=4):i?(n?n=!1:t=t.write(44),a=e.writeBlockItem(t,s),u=4):e.isValue(s)&&!e.isRecord(s)&&(!n&&void 0===o||void 0!==o&&e.isAttr(o))?(a=e.writeItem(t,s),u=4):(t=t.write(40),a=e.writeItem(t,s),i=!0,n=!1,u=4)),4===u){if((a=a.pull(t)).isDone()){a=void 0,u=1;continue}if(a.isError())return a.asError()}break}if(5===u){if(!i)return bt.end();if(t.isCont())return t=t.write(41),bt.end()}return t.isDone()?bt.error(new vt("truncated")):t.isError()?bt.error(t.trap()):new Ws(e,r,i,n,s,o,a,u)}}class Hs extends bt{constructor(t,e,r,i){super(),this.text=t,this.index=e,this.escape=r,this.step=i}pull(t){return Hs.write(t,this.text,this.index,this.escape,this.step)}static sizeOf(t){let e=0;for(let r=0,i=t.length;r<i;r=l.offsetByCodePoints(t,r,1)){let i=t.codePointAt(r);void 0===i&&(i=t.charCodeAt(r)),e+=36===i||64===i||91===i||92===i||93===i||123===i||125===i||8===i||12===i||10===i||13===i||9===i?2:i<32?6:ie.sizeOf(i)}return e}static write(t,e,r=0,i=0,n=1){const s=e.length;for(;t.isCont();)if(1===n){if(!(r<s))return bt.end();{let s=e.codePointAt(r);void 0===s&&(s=e.charCodeAt(r)),r=l.offsetByCodePoints(e,r,1),36===s||64===s||91===s||92===s||93===s||123===s||125===s?(t=t.write(92),i=s,n=2):8===s?(t=t.write(92),i=98,n=2):12===s?(t=t.write(92),i=102,n=2):10===s?(t=t.write(92),i=110,n=2):13===s?(t=t.write(92),i=114,n=2):9===s?(t=t.write(92),i=116,n=2):s<32?(t=t.write(92),i=s,n=3):t=t.write(s)}}else 2===n?(t=t.write(i),i=0,n=1):3===n?(t=t.write(117),n=4):4===n?(t=t.write(te.uppercase.encodeDigit(i>>>12&15)),n=5):5===n?(t=t.write(te.uppercase.encodeDigit(i>>>8&15)),n=6):6===n?(t=t.write(te.uppercase.encodeDigit(i>>>4&15)),n=7):7===n&&(t=t.write(te.uppercase.encodeDigit(15&i)),i=0,n=1);return t.isDone()?bt.error(new vt("truncated")):t.isError()?bt.error(t.trap()):new Hs(e,r,i,n)}}class Xs extends bt{constructor(t,e,r){super(),this.array=t,this.part=e,this.step=r}pull(t){return Xs.write(t,this.array,this.part,this.step)}static sizeOf(t){return 1+(Math.floor(4*t/3)+3&-4)}static write(t,e,r,i=1){if(1===i&&t.isCont()&&(t=t.write(37),i=2),2===i){if((r=void 0===r?le.standard().writeUint8Array(t,e):r.pull(t)).isDone())return r=void 0,bt.end();if(r.isError())return r.asError()}return t.isDone()?bt.error(new vt("truncated")):t.isError()?bt.error(t.trap()):new Xs(e,r,i)}}class Ys extends bt{constructor(t,e){super(),this.ident=t,this.index=e}pull(t){return Ys.write(t,this.ident,this.index)}static sizeOf(t){return ie.sizeOf(t)}static write(t,e,r=0){let i;const n=e.length;if(0===n)return bt.error(new vt("empty identifier"));for(0===r&&t.isCont()&&(i=e.codePointAt(0),void 0===i&&(i=e.charCodeAt(0)),hs.isIdentStartChar(i)&&(t=t.write(i),r=l.offsetByCodePoints(e,0,1)));r<n&&t.isCont();){if(i=e.codePointAt(r),void 0===i&&(i=e.charCodeAt(r)),!hs.isIdentChar(i))return bt.error(new vt("invalid identifier"));t=t.write(i),r=l.offsetByCodePoints(e,r,1)}return r>=n?bt.end():t.isDone()?bt.error(new vt("truncated")):t.isError()?bt.error(t.trap()):new Ys(e,r)}}class Gs extends bt{constructor(t,e,r,i){super(),this.string=t,this.index=e,this.escape=r,this.step=i}pull(t){return Gs.write(t,this.string,this.index,this.escape,this.step)}static sizeOf(t){let e=0;e+=1;for(let r=0,i=t.length;r<i;r=l.offsetByCodePoints(t,r,1)){let i=t.codePointAt(r);void 0===i&&(i=t.charCodeAt(r)),e+=34===i||92===i||8===i||12===i||10===i||13===i||9===i?2:i<32?6:ie.sizeOf(i)}return e+=1,e}static write(t,e,r=0,i=0,n=1){1===n&&t.isCont()&&(t=t.write(34),n=2);const s=e.length;for(;n>=2&&n<=8&&t.isCont();)if(2===n){if(!(r<s)){n=9;break}{let s=e.codePointAt(r);void 0===s&&(s=e.charCodeAt(r)),r=l.offsetByCodePoints(e,r,1),34===s||92===s?(t=t.write(92),i=s,n=3):8===s?(t=t.write(92),i=98,n=3):12===s?(t=t.write(92),i=102,n=3):10===s?(t=t.write(92),i=110,n=3):13===s?(t=t.write(92),i=114,n=3):9===s?(t=t.write(92),i=116,n=3):s<32?(t=t.write("\\"),i=s,n=4):t=t.write(s)}}else 3===n?(t=t.write(i),i=0,n=2):4===n?(t=t.write(117),n=5):5===n?(t=t.write(te.uppercase.encodeDigit(i>>>12&15)),n=6):6===n?(t=t.write(te.uppercase.encodeDigit(i>>>8&15)),n=7):7===n?(t=t.write(te.uppercase.encodeDigit(i>>>4&15)),n=8):8===n&&(t=t.write(te.uppercase.encodeDigit(15&i)),i=0,n=2);return 9===n&&t.isCont()?(t=t.write(34),bt.end()):t.isDone()?bt.error(new vt("truncated")):t.isError()?bt.error(t.trap()):new Gs(e,r,i,n)}}class _s extends bt{constructor(t,e,r,i,n){super(),this.recon=t,this.bindings=e,this.template=r,this.part=i,this.step=n}pull(t){return _s.write(t,this.recon,this.bindings,this.template,this.part,this.step)}static sizeOf(t,e,r){let i=0;return i+=t.sizeOfPrimary(e),i+=4,i+=t.sizeOfValue(r),i}static write(t,e,r,i,n,s=1){if(1===s)if((n=void 0===n?e.writePrimary(t,r):n.pull(t)).isDone())n=void 0,s=2;else if(n.isError())return n.asError();if(2===s&&t.isCont()&&(t=t.write(32),s=3),3===s&&t.isCont()&&(t=t.write(61),s=4),4===s&&t.isCont()&&(t=t.write(62),s=5),5===s&&t.isCont()&&(t=t.write(32),s=6),6===s){if((n=void 0===n?e.writeValue(t,i):n.pull(t)).isDone())return bt.end();if(n.isError())return n.asError()}return t.isDone()?bt.error(new vt("truncated")):t.isError()?bt.error(t.trap()):new _s(e,r,i,n,s)}}class Qs extends bt{constructor(t,e,r,i,n,s,o){super(),this.recon=t,this.ifTerm=e,this.thenTerm=r,this.elseTerm=i,this.precedence=n,this.part=s,this.step=o}pull(t){return Qs.write(t,this.recon,this.ifTerm,this.thenTerm,this.elseTerm,this.precedence,this.part,this.step)}static sizeOf(t,e,r,i,n){let s=0;return t.precedence(e)>0&&t.precedence(e)<=n?(s+=1,s+=t.sizeOfItem(e),s+=1):s+=t.sizeOfItem(e),s+=3,s+=t.sizeOfItem(r),s+=3,s+=t.sizeOfItem(i),s}static write(t,e,r,i,n,s,o,a=1){if(1===a&&(e.precedence(r)>0&&e.precedence(r)<=s?t.isCont()&&(t=t.write(40),a=2):a=2),2===a)if((o=void 0===o?e.writeItem(t,r):o.pull(t)).isDone())o=void 0,a=3;else if(o.isError())return o.asError();if(3===a&&(e.precedence(r)>0&&e.precedence(r)<=s?t.isCont()&&(t=t.write(41),a=4):a=4),4===a&&t.isCont()&&(t=t.write(32),a=5),5===a&&t.isCont()&&(t=t.write(63),a=6),6===a&&t.isCont()&&(t=t.write(32),a=7),7===a)if((o=void 0===o?e.writeItem(t,i):o.pull(t)).isDone())o=void 0,a=8;else if(o.isError())return o.asError();if(8===a&&t.isCont()&&(t=t.write(32),a=9),9===a&&t.isCont()&&(t=t.write(58),a=10),10===a&&t.isCont()&&(t=t.write(32),a=11),11===a){if((o=void 0===o?e.writeItem(t,n):o.pull(t)).isDone())return bt.end();if(o.isError())return o.asError()}return t.isDone()?bt.error(new vt("truncated")):t.isError()?bt.error(t.trap()):new Qs(e,r,i,n,s,o,a)}}class Zs extends bt{constructor(t,e,r,i,n,s,o){super(),this.recon=t,this.lhs=e,this.operator=r,this.rhs=i,this.precedence=n,this.part=s,this.step=o}pull(t){return Zs.write(t,this.recon,this.lhs,this.operator,this.rhs,this.precedence,this.part,this.step)}static sizeOf(t,e,r,i,n){let s=0;return t.precedence(e)<n?(s+=1,s+=t.sizeOfItem(e),s+=1):s+=t.sizeOfItem(e),s+=1,s+=ie.sizeOf(r),s+=1,t.precedence(i)<n?(s+=1,s+=t.sizeOfItem(i),s+=1):s+=t.sizeOfItem(i),s}static write(t,e,r,i,n,s,o,a=1){if(1===a&&(e.precedence(r)<s?t.isCont()&&(t=t.write(40),a=2):a=2),2===a)if((o=void 0===o?e.writeItem(t,r):o.pull(t)).isDone())o=void 0,a=3;else if(o.isError())return o.asError();if(3===a&&(e.precedence(r)<s?t.isCont()&&(t=t.write(41),a=4):a=4),4===a&&t.isCont()&&(t=t.write(32),a=5),5===a)if((o=void 0===o?Ct.writeString(t,i):o.pull(t)).isDone())o=void 0,a=6;else if(o.isError())return o.asError();if(6===a&&t.isCont()&&(t=t.write(32),a=7),7===a&&(e.precedence(n)<s?t.isCont()&&(t=t.write(40),a=8):a=8),8===a)if((o=void 0===o?e.writeItem(t,n):o.pull(t)).isDone())o=void 0,a=9;else if(o.isError())return o.asError();if(9===a){if(!(e.precedence(n)<s))return bt.end();if(t.isCont())return t=t.write(41),bt.end()}return t.isDone()?bt.error(new vt("truncated")):t.isError()?bt.error(t.trap()):new Zs(e,r,i,n,s,o,a)}}class Js extends bt{constructor(t,e,r,i,n,s){super(),this.recon=t,this.operator=e,this.rhs=r,this.precedence=i,this.part=n,this.step=s}pull(t){return Js.write(t,this.recon,this.operator,this.rhs,this.precedence,this.part,this.step)}static sizeOf(t,e,r,i){let n=0;return n+=ie.sizeOf(e),t.precedence(r)<i?(n+=1,n+=t.sizeOfItem(r),n+=1):n+=t.sizeOfItem(r),n}static write(t,e,r,i,n,s,o=1){if(1===o)if((s=void 0===s?Ct.writeString(t,r):s.pull(t)).isDone())s=void 0,o=2;else if(s.isError())return s.asError();if(2===o&&(e.precedence(i)<n?t.isCont()&&(t=t.write(40),o=3):o=3),3===o)if((s=void 0===s?e.writeItem(t,i):s.pull(t)).isDone())s=void 0,o=4;else if(s.isError())return s.asError();if(4===o){if(!(e.precedence(i)<n))return bt.end();if(t.isCont())return t=t.write(41),bt.end()}return t.isDone()?bt.error(new vt("truncated")):t.isError()?bt.error(t.trap()):new Js(e,r,i,n,s,o)}}class $s extends bt{constructor(t,e,r,i,n){super(),this.recon=t,this.func=e,this.args=r,this.part=i,this.step=n}pull(t){return $s.write(t,this.recon,this.func,this.args,this.part,this.step)}static sizeOf(t,e,r){let i=0;return i+=t.sizeOfValue(e),i+=1,i+=t.sizeOfBlockValue(r),i+=1,i}static write(t,e,r,i,n,s=1){if(1===s)if((n=void 0===n?e.writeValue(t,r):n.pull(t)).isDone())n=void 0,s=2;else if(n.isError())return n.asError();if(2===s&&t.isCont()&&(t=t.write(40),s=3),3===s)if((n=void 0===n?e.writeBlockValue(t,i):n.pull(t)).isDone())n=void 0,s=4;else if(n.isError())return n.asError();return 4===s&&t.isCont()?(t=t.write(41),bt.end()):t.isDone()?bt.error(new vt("truncated")):t.isError()?bt.error(t.trap()):new $s(e,r,i,n,s)}}class to extends bt{constructor(t,e,r,i,n){super(),this.recon=t,this.item=e,this.then=r,this.part=i,this.step=n}pull(t){return to.write(t,this.recon,this.item,this.then,this.part,this.step)}static sizeOf(t,e,r){let i=0;return t.precedence(e)<t.precedence(t.item(r))?(i+=1,i+=t.sizeOfItem(e),i+=1):i+=t.sizeOfItem(e),i+=t.sizeOfThen(r),i}static write(t,e,r,i,n,s=1){if(1===s&&(e.precedence(r)<e.precedence(e.item(i))?t.isCont()&&(t=t.write(40),s=2):s=2),2===s)if((n=void 0===n?e.writeItem(t,r):n.pull(t)).isDone())n=void 0,s=3;else if(n.isError())return n.asError();return 3===s&&(e.precedence(r)<e.precedence(e.item(i))?t.isCont()&&(t=t.write(41),s=4):s=4),4===s?e.writeThen(t,i):t.isDone()?bt.error(new vt("truncated")):t.isError()?bt.error(t.trap()):new to(e,r,i,n,s)}}class eo extends bt{constructor(t,e,r,i,n){super(),this.recon=t,this.key=e,this.then=r,this.part=i,this.step=n}pull(t){return eo.write(t,this.recon,this.key,this.then,this.part,this.step)}static sizeOf(t,e,r){let i=1;return t.isRecord(t.item(e))?(i+=1,i+=t.sizeOfBlockValue(e),i+=1):i+=t.sizeOfValue(e),i+=t.sizeOfThen(r),i}static write(t,e,r,i,n,s=1){if(1===s&&t.isCont()?(t=t.write(36),s=3):2===s&&t.isCont()&&(t=t.write(46),s=3),3===s&&(e.isRecord(e.item(r))?t.isCont()&&(t=t.write(123),s=4):s=4),4===s)if((n=void 0===n?e.isRecord(e.item(r))?e.writeBlockValue(t,r):e.writeValue(t,r):n.pull(t)).isDone())n=void 0,s=5;else if(n.isError())return n.asError();return 5===s&&(e.isRecord(e.item(r))?t.isCont()&&(t=t.write(125),s=6):s=6),6===s?e.writeThen(t,i):t.isDone()?bt.error(new vt("truncated")):t.isError()?bt.error(t.trap()):new eo(e,r,i,n,s)}static writeThen(t,e,r,i){return eo.write(t,e,r,i,void 0,2)}}class ro extends bt{constructor(t,e,r,i,n){super(),this.recon=t,this.key=e,this.then=r,this.part=i,this.step=n}pull(t){return ro.write(t,this.recon,this.key,this.then,this.part,this.step)}static sizeOf(t,e,r){let i=2;return i+=t.sizeOfValue(e),i+=t.sizeOfThen(r),i}static write(t,e,r,i,n,s=1){if(1===s&&t.isCont()?(t=t.write(36),s=3):2===s&&t.isCont()&&(t=t.write(46),s=3),3===s&&t.isCont()&&(t=t.write(64),s=4),4===s){if((n=void 0===n?e.writeValue(t,r):n.pull(t)).isDone())return e.writeThen(t,i);if(n.isError())return n.asError()}return t.isDone()?bt.error(new vt("truncated")):t.isError()?bt.error(t.trap()):new ro(e,r,i,n,s)}static writeThen(t,e,r,i){return ro.write(t,e,r,i,void 0,2)}}class io extends bt{constructor(t,e,r,i,n){super(),this.recon=t,this.index=e,this.then=r,this.part=i,this.step=n}pull(t){return io.write(t,this.recon,this.index,this.then,this.part,this.step)}static sizeOf(t,e,r){let i=2;return i+=t.sizeOfValue(e),i+=t.sizeOfThen(r),i}static sizeOfThen(t,e,r){let i=1;return i+=t.sizeOfValue(e),i+=t.sizeOfThen(r),i}static write(t,e,r,i,n,s=1){if(1===s&&t.isCont()&&(t=t.write(36),s=2),2===s&&t.isCont()&&(t=t.write(35),s=3),3===s){if((n=void 0===n?e.writeValue(t,r):n.pull(t)).isDone())return e.writeThen(t,i);if(n.isError())return n.asError()}return t.isDone()?bt.error(new vt("truncated")):t.isError()?bt.error(t.trap()):new io(e,r,i,n,s)}static writeThen(t,e,r,i){return io.write(t,e,r,i,void 0,2)}}class no extends bt{constructor(t,e,r){super(),this.recon=t,this.then=e,this.step=r}pull(t){return no.write(t,this.recon,this.then,this.step)}static sizeOf(t,e){let r=3;return r+=t.sizeOfThen(e),r}static write(t,e,r,i=1){return 1===i&&t.isCont()?(t=t.write(36),i=3):2===i&&t.isCont()&&(t=t.write(46),i=3),3===i&&t.isCont()&&(t=t.write(42),i=4),4===i&&t.isCont()?(t=t.write(58),e.writeThen(t,r)):t.isDone()?bt.error(new vt("truncated")):t.isError()?bt.error(t.trap()):new no(e,r,i)}static writeThen(t,e,r){return no.write(t,e,r,2)}}class so extends bt{constructor(t,e,r){super(),this.recon=t,this.then=e,this.step=r}pull(t){return so.write(t,this.recon,this.then,this.step)}static sizeOf(t,e){let r=3;return r+=t.sizeOfThen(e),r}static write(t,e,r,i=1){return 1===i&&t.isCont()?(t=t.write(36),i=3):2===i&&t.isCont()&&(t=t.write(46),i=3),3===i&&t.isCont()&&(t=t.write(58),i=4),4===i&&t.isCont()?(t=t.write(42),e.writeThen(t,r)):t.isDone()?bt.error(new vt("truncated")):t.isError()?bt.error(t.trap()):new so(e,r,i)}static writeThen(t,e,r){return so.write(t,e,r,2)}}class oo extends bt{constructor(t,e,r){super(),this.recon=t,this.then=e,this.step=r}pull(t){return oo.write(t,this.recon,this.then,this.step)}static sizeOf(t,e){let r=2;return r+=t.sizeOfThen(e),r}static write(t,e,r,i=1){return 1===i&&t.isCont()?(t=t.write(36),i=3):2===i&&t.isCont()&&(t=t.write(46),i=3),3===i&&t.isCont()?(t=t.write(42),e.writeThen(t,r)):t.isDone()?bt.error(new vt("truncated")):t.isError()?bt.error(t.trap()):new oo(e,r,i)}static writeThen(t,e,r){return oo.write(t,e,r,2)}}class ao extends bt{constructor(t,e,r){super(),this.recon=t,this.then=e,this.step=r}pull(t){return ao.write(t,this.recon,this.then,this.step)}static sizeOf(t,e){let r=3;return r+=t.sizeOfThen(e),r}static write(t,e,r,i=1){return 1===i&&t.isCont()?(t=t.write(36),i=3):2===i&&t.isCont()&&(t=t.write(46),i=3),3===i&&t.isCont()&&(t=t.write(42),i=4),4===i&&t.isCont()?(t=t.write(42),e.writeThen(t,r)):t.isDone()?bt.error(new vt("truncated")):t.isError()?bt.error(t.trap()):new ao(e,r,i)}static writeThen(t,e,r){return ao.write(t,e,r,2)}}class uo extends bt{constructor(t,e,r,i,n){super(),this.recon=t,this.predicate=e,this.then=r,this.part=i,this.step=n}pull(t){return uo.write(t,this.recon,this.predicate,this.then,this.part,this.step)}static sizeOf(t,e,r){let i=2;return i+=t.sizeOfValue(e),i+=1,i+=t.sizeOfThen(r),i}static sizeOfThen(t,e,r){let i=1;return i+=t.sizeOfValue(e),i+=1,i+=t.sizeOfThen(r),i}static write(t,e,r,i,n,s=1){if(1===s&&t.isCont()&&(t=t.write(36),s=2),2===s&&t.isCont()&&(t=t.write(91),s=3),3===s)if((n=void 0===n?e.writeValue(t,r):n.pull(t)).isDone())n=void 0,s=4;else if(n.isError())return n.asError();return 4===s&&t.isCont()?(t=t.write(93),e.writeThen(t,i)):t.isDone()?bt.error(new vt("truncated")):t.isError()?bt.error(t.trap()):new uo(e,r,i,n,s)}static writeThen(t,e,r,i){return uo.write(t,e,r,i,void 0,2)}}class ho{sizeOfAttr(t,e){return Ls.sizeOf(this,t,e)}writeAttr(t,e,r){return Ls.write(t,this,e,r)}sizeOfSlot(t,e){return Ks.sizeOf(this,t,e)}writeSlot(t,e,r){return Ks.write(t,this,e,r)}sizeOfBlock(t,e,r){if(3===arguments.length)return Bs.sizeOf(this,t,e,r);{const e=this.items(t);return e.hasNext()?Bs.sizeOf(this,e,this.isBlockSafe(this.items(t)),!1):2}}writeBlock(t,e,r,i){if(4===arguments.length)return Bs.write(t,this,e,r,i);{const r=this.items(e);return r.hasNext()?Bs.write(t,this,r,this.isBlockSafe(this.items(e)),!1):Ct.writeString(t,"{}")}}sizeOfRecord(t){const e=this.items(t);return e.hasNext()?Bs.sizeOf(this,e,!1,!1):2}writeRecord(t,e){const r=this.items(e);return r.hasNext()?Bs.write(t,this,r,!1,!1):Ct.writeString(t,"{}")}sizeOfPrimary(t){if(this.isRecord(this.item(t))){const e=this.items(this.item(t));if(e.hasNext())return Ws.sizeOf(this,e)}else if(!this.isExtant(this.item(t)))return this.sizeOfValue(t);return 2}writePrimary(t,e){if(this.isRecord(this.item(e))){const r=this.items(this.item(e));if(r.hasNext())return Ws.write(t,this,r)}else if(!this.isExtant(this.item(e)))return this.writeValue(t,e);return Ct.writeString(t,"()")}isBlockSafe(t){for(;t.hasNext();)if(this.isAttr(t.next().value))return!1;return!0}isMarkupSafe(t){if(!t.hasNext()||!this.isAttr(t.next().value))return!1;for(;t.hasNext();)if(this.isAttr(t.next().value))return!1;return!0}sizeOfMarkupText(t){return"string"!=typeof t&&(t=this.string(t)),Hs.sizeOf(t)}writeMarkupText(t,e){return"string"!=typeof e&&(e=this.string(e)),Hs.write(t,e)}sizeOfData(t){return Xs.sizeOf(t)}writeData(t,e){return void 0!==e?Xs.write(t,e):Ct.writeString(t,"%")}isIdent(t){"string"!=typeof t&&(t=this.string(t));const e=t.length;let r;if(0===e||(r=t.codePointAt(0),void 0!==r&&!hs.isIdentStartChar(r)))return!1;for(let i=l.offsetByCodePoints(t,0,1);i<e;i=l.offsetByCodePoints(t,i,1))if(r=t.codePointAt(i),void 0===r||!hs.isIdentChar(r))return!1;return!0}sizeOfText(t){return this.isIdent(t)?Ys.sizeOf(t):Gs.sizeOf(t)}writeText(t,e){return this.isIdent(e)?Ys.write(t,e):Gs.write(t,e)}sizeOfNum(t){if(isFinite(t)&&Math.floor(t)===t&&Math.abs(t)<2147483648){let e=St.countDigits(t);return t<0&&(e+=1),e}return(""+t).length}writeNum(t,e){return isFinite(e)&&Math.floor(e)===e&&Math.abs(e)<2147483648?St.writeInteger(t,e):Ct.writeString(t,""+e)}sizeOfUint32(t){return 10}writeUint32(t,e){return te.lowercase.writeIntegerLiteral(t,e,8)}sizeOfUint64(t){return 18}writeUint64(t,e){return te.lowercase.writeIntegerLiteral(t,e,16)}sizeOfBool(t){return t?4:5}writeBool(t,e){return Ct.writeString(t,e?"true":"false")}sizeOfLambdaFunc(t,e){return _s.sizeOf(this,t,e)}writeLambdaFunc(t,e,r){return _s.write(t,this,e,r)}sizeOfConditionalOperator(t,e,r,i){return Qs.sizeOf(this,t,e,r,i)}writeConditionalOperator(t,e,r,i,n){return Qs.write(t,this,e,r,i,n)}sizeOfInfixOperator(t,e,r,i){return Zs.sizeOf(this,t,e,r,i)}writeInfixOperator(t,e,r,i,n){return Zs.write(t,this,e,r,i,n)}sizeOfPrefixOperator(t,e,r){return Js.sizeOf(this,t,e,r)}writePrefixOperator(t,e,r,i){return Js.write(t,this,e,r,i)}sizeOfInvokeOperator(t,e){return $s.sizeOf(this,t,e)}writeInvokeOperator(t,e,r){return $s.write(t,this,e,r)}sizeOfIdentitySelector(){return 0}writeIdentitySelector(t){return bt.end()}sizeOfThenIdentitySelector(){return 0}writeThenIdentitySelector(t){return bt.end()}sizeOfLiteralSelector(t,e){return to.sizeOf(this,t,e)}writeLiteralSelector(t,e,r){return to.write(t,this,e,r)}sizeOfThenLiteralSelector(t,e){return 0}writeThenLiteralSelector(t,e,r){return bt.end()}sizeOfGetSelector(t,e){return eo.sizeOf(this,t,e)}writeGetSelector(t,e,r){return eo.write(t,this,e,r)}sizeOfThenGetSelector(t,e){return eo.sizeOf(this,t,e)}writeThenGetSelector(t,e,r){return eo.writeThen(t,this,e,r)}sizeOfGetAttrSelector(t,e){return ro.sizeOf(this,t,e)}writeGetAttrSelector(t,e,r){return ro.write(t,this,e,r)}sizeOfThenGetAttrSelector(t,e){return ro.sizeOf(this,t,e)}writeThenGetAttrSelector(t,e,r){return ro.writeThen(t,this,e,r)}sizeOfGetItemSelector(t,e){return io.sizeOf(this,t,e)}writeGetItemSelector(t,e,r){return io.write(t,this,e,r)}sizeOfThenGetItemSelector(t,e){return io.sizeOfThen(this,t,e)}writeThenGetItemSelector(t,e,r){return io.writeThen(t,this,e,r)}sizeOfKeysSelector(t){return no.sizeOf(this,t)}writeKeysSelector(t,e){return no.write(t,this,e)}sizeOfThenKeysSelector(t){return no.sizeOf(this,t)}writeThenKeysSelector(t,e){return no.writeThen(t,this,e)}sizeOfValuesSelector(t){return so.sizeOf(this,t)}writeValuesSelector(t,e){return so.write(t,this,e)}sizeOfThenValuesSelector(t){return so.sizeOf(this,t)}writeThenValuesSelector(t,e){return so.writeThen(t,this,e)}sizeOfChildrenSelector(t){return oo.sizeOf(this,t)}writeChildrenSelector(t,e){return oo.write(t,this,e)}sizeOfThenChildrenSelector(t){return oo.sizeOf(this,t)}writeThenChildrenSelector(t,e){return oo.writeThen(t,this,e)}sizeOfDescendantsSelector(t){return ao.sizeOf(this,t)}writeDescendantsSelector(t,e){return ao.write(t,this,e)}sizeOfThenDescendantsSelector(t){return ao.sizeOf(this,t)}writeThenDescendantsSelector(t,e){return ao.writeThen(t,this,e)}sizeOfFilterSelector(t,e){return uo.sizeOf(this,t,e)}writeFilterSelector(t,e,r){return uo.write(t,this,e,r)}sizeOfThenFilterSelector(t,e){return uo.sizeOfThen(this,t,e)}writeThenFilterSelector(t,e,r){return uo.writeThen(t,this,e,r)}sizeOfExtant(){return 0}writeExtant(t){return bt.end()}sizeOfAbsent(){return 0}writeAbsent(t){return bt.end()}}class lo extends ho{isField(t){return t instanceof hr}isAttr(t){return t instanceof dr}isSlot(t){return t instanceof lr}isValue(t){return t instanceof yr}isRecord(t){return t instanceof mr}isText(t){return t instanceof Sr}isNum(t){return t instanceof kr}isBool(t){return t instanceof Mr}isExpression(t){return t instanceof Pr}isExtant(t){return t instanceof Dr}items(t){return t.iterator()}item(t){return t}key(t){return t.key}value(t){return t.toValue()}string(t){return t.stringValue("")}precedence(t){return t.precedence}sizeOfItem(t){if(t instanceof hr){if(t instanceof dr)return this.sizeOfAttr(t.key,t.value);if(t instanceof lr)return this.sizeOfSlot(t.key,t.value)}else if(t instanceof yr)return this.sizeOfValue(t);throw new vt("No Recon serialization for "+t)}writeItem(t,e){if(e instanceof hr){if(e instanceof dr)return this.writeAttr(t,e.key,e.value);if(e instanceof lr)return this.writeSlot(t,e.key,e.value)}else if(e instanceof yr)return this.writeValue(t,e);return bt.error(new vt("No Recon serialization for "+e))}sizeOfValue(t){if(t instanceof mr)return this.sizeOfRecord(t);if(t instanceof Cr)return this.sizeOfData(t.size);if(t instanceof Sr)return this.sizeOfText(t.value);if(t instanceof kr)return t.isUint32()?this.sizeOfUint32(t.value):t.isUint64()?this.sizeOfUint64(t.value):this.sizeOfNum(t.value);if(t instanceof Mr)return this.sizeOfBool(t.value);if(t instanceof li)return this.sizeOfSelector(t);if(t instanceof Tr)return this.sizeOfOperator(t);if(t instanceof xi)return this.sizeOfFunc(t);if(t instanceof Dr)return this.sizeOfExtant();if(t instanceof Ir)return this.sizeOfAbsent();throw new vt("No Recon serialization for "+t)}writeValue(t,e){return e instanceof mr?this.writeRecord(t,e):e instanceof Cr?this.writeData(t,e.asUint8Array()):e instanceof Sr?this.writeText(t,e.value):e instanceof kr?e.isUint32()?this.writeUint32(t,e.value):e.isUint64()?this.writeUint64(t,e.value):this.writeNum(t,e.value):e instanceof Mr?this.writeBool(t,e.value):e instanceof li?this.writeSelector(t,e):e instanceof Tr?this.writeOperator(t,e):e instanceof xi?this.writeFunc(t,e):e instanceof Dr?this.writeExtant(t):e instanceof Ir?this.writeAbsent(t):bt.error(new vt("No Recon serialization for "+e))}sizeOfSelector(t){if(t instanceof ci)return this.sizeOfIdentitySelector();if(t instanceof bi)return this.sizeOfLiteralSelector(t.item,t.then);if(t instanceof di)return this.sizeOfGetSelector(t.item,t.then);if(t instanceof pi)return this.sizeOfGetAttrSelector(t.item,t.then);if(t instanceof fi)return this.sizeOfGetItemSelector(t.item,t.then);if(t instanceof yi)return this.sizeOfKeysSelector(t.then);if(t instanceof mi)return this.sizeOfValuesSelector(t.then);if(t instanceof wi)return this.sizeOfChildrenSelector(t.then);if(t instanceof gi)return this.sizeOfDescendantsSelector(t.then);if(t instanceof vi)return this.sizeOfFilterSelector(t.predicate,t.then);throw new vt("No Recon serialization for "+t)}writeSelector(t,e){return e instanceof ci?this.writeIdentitySelector(t):e instanceof bi?this.writeLiteralSelector(t,e.item,e.then):e instanceof di?this.writeGetSelector(t,e.item,e.then):e instanceof pi?this.writeGetAttrSelector(t,e.item,e.then):e instanceof fi?this.writeGetItemSelector(t,e.item,e.then):e instanceof yi?this.writeKeysSelector(t,e.then):e instanceof mi?this.writeValuesSelector(t,e.then):e instanceof wi?this.writeChildrenSelector(t,e.then):e instanceof gi?this.writeDescendantsSelector(t,e.then):e instanceof vi?this.writeFilterSelector(t,e.predicate,e.then):bt.error(new vt("No Recon serialization for "+e))}sizeOfOperator(t){if(t instanceof Vr)return this.sizeOfInfixOperator(t.operand1,t.operator,t.operand2,t.precedence);if(t instanceof qr)return this.sizeOfPrefixOperator(t.operator,t.operand,t.precedence);if(t instanceof ui)return this.sizeOfInvokeOperator(t.func,t.args);if(t instanceof Rr)return this.sizeOfConditionalOperator(t.ifTerm,t.thenTerm,t.elseTerm,t.precedence);throw new vt("No Recon serialization for "+t)}writeOperator(t,e){return e instanceof Vr?this.writeInfixOperator(t,e.operand1,e.operator,e.operand2,e.precedence):e instanceof qr?this.writePrefixOperator(t,e.operator,e.operand,e.precedence):e instanceof ui?this.writeInvokeOperator(t,e.func,e.args):e instanceof Rr?this.writeConditionalOperator(t,e.ifTerm,e.thenTerm,e.elseTerm,e.precedence):bt.error(new vt("No Recon serialization for "+e))}sizeOfFunc(t){if(t instanceof Ci)return this.sizeOfLambdaFunc(t.bindings,t.template);if(t instanceof Oi)return 0;throw new vt("No Recon serialization for "+t)}writeFunc(t,e){return e instanceof Ci?this.writeLambdaFunc(t,e.bindings,e.template):e instanceof Oi?bt.end():bt.error(new vt("No Recon serialization for "+e))}sizeOfBlockItem(t){if(t instanceof hr)return this.sizeOfItem(t);if(t instanceof yr)return this.sizeOfBlockValue(t);throw new vt("No Recon serialization for "+t)}writeBlockItem(t,e){return e instanceof hr?this.writeItem(t,e):e instanceof yr?this.writeBlockValue(t,e):bt.error(new vt("No Recon serialization for "+e))}sizeOfBlockValue(t){return t instanceof mr?this.sizeOfBlock(t):this.sizeOfValue(t)}writeBlockValue(t,e){return e instanceof mr?this.writeBlock(t,e):this.writeValue(t,e)}sizeOfThen(t){if(t instanceof li){if(t instanceof ci)return this.sizeOfThenIdentitySelector();if(t instanceof bi)return this.sizeOfThenLiteralSelector(t.item,t.then);if(t instanceof di)return this.sizeOfThenGetSelector(t.item,t.then);if(t instanceof pi)return this.sizeOfThenGetAttrSelector(t.item,t.then);if(t instanceof fi)return this.sizeOfThenGetItemSelector(t.item,t.then);if(t instanceof yi)return this.sizeOfThenKeysSelector(t.then);if(t instanceof mi)return this.sizeOfThenValuesSelector(t.then);if(t instanceof wi)return this.sizeOfThenChildrenSelector(t.then);if(t instanceof gi)return this.sizeOfThenDescendantsSelector(t.then);if(t instanceof vi)return this.sizeOfThenFilterSelector(t.predicate,t.then)}throw new vt("No Recon serialization for "+t)}writeThen(t,e){if(e instanceof li){if(e instanceof ci)return this.writeThenIdentitySelector(t);if(e instanceof bi)return this.writeThenLiteralSelector(t,e.item,e.then);if(e instanceof di)return this.writeThenGetSelector(t,e.item,e.then);if(e instanceof pi)return this.writeThenGetAttrSelector(t,e.item,e.then);if(e instanceof fi)return this.writeThenGetItemSelector(t,e.item,e.then);if(e instanceof yi)return this.writeThenKeysSelector(t,e.then);if(e instanceof mi)return this.writeThenValuesSelector(t,e.then);if(e instanceof wi)return this.writeThenChildrenSelector(t,e.then);if(e instanceof gi)return this.writeThenDescendantsSelector(t,e.then);if(e instanceof vi)return this.writeThenFilterSelector(t,e.predicate,e.then)}return bt.error(new vt("No Recon serialization for "+e))}}class co extends Error{constructor(t){super(t instanceof Et?t.message:t),Object.setPrototypeOf(this,co.prototype),this.diagnostic=t instanceof Et?t:null}toString(){return null!==this.diagnostic?this.diagnostic.toString():super.toString()}}class po{constructor(t,e,r,i,n){this.scheme=t,this.authority=e,this.path=r,this.query=i,this.fragment=n,this.hashValue=void 0,this.stringValue=void 0}isDefined(){return this.scheme.isDefined()||this.authority.isDefined()||this.path.isDefined()||this.query.isDefined()||this.fragment.isDefined()}isEmpty(){return!this.scheme.isDefined()&&!this.authority.isDefined()&&this.path.isEmpty()&&!this.query.isDefined()&&!this.fragment.isDefined()}withScheme(t){return(t=fo.fromAny(t))!==this.scheme?this.copy(t,this.authority,this.path,this.query,this.fragment):this}get schemePart(){return this.scheme.toString()}withSchemePart(t){return this.withScheme(fo.parse(t))}get schemeName(){return this.scheme.name}withSchemeName(t){return this.withScheme(fo.create(t))}withAuthority(t){return(t=yo.fromAny(t))!==this.authority?this.copy(this.scheme,t,this.path,this.query,this.fragment):this}get authorityPart(){return this.authority.toString()}withAuthorityPart(t){return this.withAuthority(yo.parse(t))}get user(){return this.authority.user}withUser(t){return this.withAuthority(this.authority.withUser(t))}get userPart(){return this.authority.userPart}withUserPart(t){return this.withAuthority(this.authority.withUserPart(t))}get username(){return this.authority.username}withUsername(t,e){return 1===arguments.length?this.withAuthority(this.authority.withUsername(t)):this.withAuthority(this.authority.withUsername(t,e))}get password(){return this.authority.password}withPassword(t){return this.withAuthority(this.authority.withPassword(t))}get host(){return this.authority.host}withHost(t){return this.withAuthority(this.authority.withHost(t))}get hostPart(){return this.authority.hostPart}withHostPart(t){return this.withAuthority(this.authority.withHostPart(t))}get hostAddress(){return this.authority.hostAddress}get hostName(){return this.authority.hostName}withHostName(t){return this.withAuthority(this.authority.withHostName(t))}get hostIPv4(){return this.authority.hostIPv4}withHostIPv4(t){return this.withAuthority(this.authority.withHostIPv4(t))}get hostIPv6(){return this.authority.hostIPv6}withHostIPv6(t){return this.withAuthority(this.authority.withHostIPv6(t))}get port(){return this.authority.port}withPort(t){return this.withAuthority(this.authority.withPort(t))}get portPart(){return this.authority.portPart}withPortPart(t){return this.withAuthority(this.authority.withPortPart(t))}get portNumber(){return this.authority.portNumber}withPortNumber(t){return this.withAuthority(this.authority.withPortNumber(t))}withPath(...t){const e=Oo.of(...t);return e!==this.path?this.copy(this.scheme,this.authority,e,this.query,this.fragment):this}get pathPart(){return this.path.toString()}withPathPart(t){return this.withPath(Oo.parse(t))}get pathName(){return this.path.name}withPathName(t){return this.withPath(this.path.withName(t))}parentPath(){return this.path.parent()}basePath(){return this.path.base()}parent(){return po.create(this.scheme,this.authority,this.path.parent())}base(){return po.create(this.scheme,this.authority,this.path.base())}appendedPath(...t){return this.withPath(this.path.appended(...t))}appendedSlash(){return this.withPath(this.path.appendedSlash())}appendedSegment(t){return this.withPath(this.path.appendedSegment(t))}prependedPath(...t){return this.withPath(this.path.prepended(...t))}prependedSlash(){return this.withPath(this.path.prependedSlash())}prependedSegment(t){return this.withPath(this.path.prependedSegment(t))}withQuery(t){return(t=Do.fromAny(t))!==this.query?this.copy(this.scheme,this.authority,this.path,t,this.fragment):this}get queryPart(){return this.query.toString()}withQueryPart(t){return this.withQuery(Do.parse(t))}updatedQuery(t,e){return this.withQuery(this.query.updated(t,e))}removedQuery(t){return this.withQuery(this.query.removed(t))}appendedQuery(t,e){return this.withQuery(this.query.appended(t,e))}prependedQuery(t,e){return this.withQuery(this.query.prepended(t,e))}withFragment(t){return(t=Vo.fromAny(t))!==this.fragment?po.create(this.scheme,this.authority,this.path,this.query,t):this}get fragmentPart(){return this.fragment.toString()}withFragmentPart(t){return this.withFragment(Vo.parse(t))}get fragmentIdentifier(){return this.fragment.identifier}withFragmentIdentifier(t){return this.withFragment(Vo.create(t))}endpoint(){return this.path.isDefined()||this.query.isDefined()||this.fragment.isDefined()?po.create(this.scheme,this.authority):this}resolve(t){const e=po.fromAny(t);return e.scheme.isDefined()?this.copy(e.scheme,e.authority,e.path.removeDotSegments(),e.query,e.fragment):e.authority.isDefined()?this.copy(this.scheme,e.authority,e.path.removeDotSegments(),e.query,e.fragment):e.path.isEmpty()?this.copy(this.scheme,this.authority,this.path,e.query.isDefined()?e.query:this.query,e.fragment):e.path.isAbsolute()?this.copy(this.scheme,this.authority,e.path.removeDotSegments(),e.query,e.fragment):this.copy(this.scheme,this.authority,this.merge(e.path).removeDotSegments(),e.query,e.fragment)}merge(t){return this.authority.isDefined()&&this.path.isEmpty()?t.prependedSlash():this.path.isEmpty()?t:this.path.merge(t)}unresolve(t){const e=po.fromAny(t);return this.scheme.equals(e.scheme)&&this.authority.equals(e.authority)?po.create(fo.undefined(),yo.undefined(),this.path.unmerge(e.path),e.query,e.fragment):e}copy(t,e,r,i,n){return po.create(t,e,r,i,n)}toAny(){const t={};return t.scheme=this.scheme.toAny(),this.authority.toAny(t),t.path=this.path.toAny(),t.query=this.query.toAny(),t.fragment=this.fragment.toAny(),t}compareTo(t){return t instanceof po?this.toString().localeCompare(t.toString()):NaN}equals(t){return this===t||t instanceof po&&this.toString()===t.toString()}hashCode(){let t=this.hashValue;return void 0===t&&(t=l.hash(this.toString()),this.hashValue=t),t}debug(t){return t=t.write("Uri").write(46),t=this.isDefined()?t.write("parse").write(40).write(34).display(this).write(34).write(41):t.write("empty").write(40).write(41)}display(t){const e=this.stringValue;return void 0!==e?t=t.write(e):(this.scheme.isDefined()&&(t=t.display(this.scheme).write(58)),this.authority.isDefined()&&(t=t.write(47).write(47).display(this.authority)),t=t.display(this.path),this.query.isDefined()&&(t=t.write(63).display(this.query)),this.fragment.isDefined()&&(t=t.write(35).display(this.fragment))),t}toString(){let t=this.stringValue;return void 0===t&&(t=Ot.display(this),this.stringValue=t),t}static empty(){return new po(fo.undefined(),yo.undefined(),Oo.empty(),Do.undefined(),Vo.undefined())}static create(t=fo.undefined(),e=yo.undefined(),r=Oo.empty(),i=Do.undefined(),n=Vo.undefined()){return t.isDefined()||e.isDefined()||r.isDefined()||i.isDefined()||n.isDefined()?new po(t,e,r,i,n):po.empty()}static fromInit(t){const e=fo.fromAny(t.scheme),r=yo.fromAny(void 0!==t.authority?t.authority:t),i=Oo.fromAny(t.path),n=Do.fromAny(t.query),s=Vo.fromAny(t.fragment);return e.isDefined()||r.isDefined()||i.isDefined()||n.isDefined()||s.isDefined()?new po(e,r,i,n,s):po.empty()}static fromAny(t){if(null==t)return po.empty();if(t instanceof po)return t;if("object"==typeof t)return po.fromInit(t);if("string"==typeof t)return po.parse(t);throw new TypeError(""+t)}static scheme(t){return t=fo.fromAny(t),po.create(t,void 0,void 0,void 0,void 0)}static schemePart(t){const e=fo.parse(t);return po.create(e,void 0,void 0,void 0,void 0)}static schemeName(t){const e=fo.create(t);return po.create(e,void 0,void 0,void 0,void 0)}static authority(t){return t=yo.fromAny(t),po.create(void 0,t,void 0,void 0,void 0)}static authorityPart(t){const e=yo.parse(t);return po.create(void 0,e,void 0,void 0,void 0)}static user(t){const e=yo.user(t);return po.create(void 0,e,void 0,void 0,void 0)}static userPart(t){const e=yo.userPart(t);return po.create(void 0,e,void 0,void 0,void 0)}static username(t,e){const r=yo.username(t,e);return po.create(void 0,r,void 0,void 0,void 0)}static password(t){const e=yo.password(t);return po.create(void 0,e,void 0,void 0,void 0)}static host(t){const e=yo.host(t);return po.create(void 0,e,void 0,void 0,void 0)}static hostPart(t){const e=yo.hostPart(t);return po.create(void 0,e,void 0,void 0,void 0)}static hostName(t){const e=yo.hostName(t);return po.create(void 0,e,void 0,void 0,void 0)}static hostIPv4(t){const e=yo.hostIPv4(t);return po.create(void 0,e,void 0,void 0,void 0)}static hostIPv6(t){const e=yo.hostIPv6(t);return po.create(void 0,e,void 0,void 0,void 0)}static port(t){const e=yo.port(t);return po.create(void 0,e,void 0,void 0,void 0)}static portPart(t){const e=yo.portPart(t);return po.create(void 0,e,void 0,void 0,void 0)}static portNumber(t){const e=yo.portNumber(t);return po.create(void 0,e,void 0,void 0,void 0)}static path(...t){const e=Oo.of(...t);return po.create(void 0,void 0,e,void 0,void 0)}static pathPart(t){const e=Oo.parse(t);return po.create(void 0,void 0,e,void 0,void 0)}static query(t){return t=Do.fromAny(t),po.create(void 0,void 0,void 0,t,void 0)}static queryPart(t){const e=Do.parse(t);return po.create(void 0,void 0,void 0,e,void 0)}static fragment(t){return t=Vo.fromAny(t),po.create(void 0,void 0,void 0,void 0,t)}static fragmentPart(t){const e=Vo.parse(t);return po.create(void 0,void 0,void 0,void 0,e)}static fragmentIdentifier(t){const e=Vo.create(t);return po.create(void 0,void 0,void 0,void 0,e)}static get standardParser(){return new Uo}static parse(t){return po.standardParser.parseAbsoluteString(t)}static pathBuilder(){return new Ao}static queryBuilder(){return new To}static form(){return new Fo(po.empty())}static isUnreservedChar(t){return t>=65&&t<=90||t>=97&&t<=122||t>=48&&t<=57||45===t||46===t||95===t||126===t}static isSubDelimChar(t){return 33===t||36===t||38===t||40===t||41===t||42===t||43===t||44===t||59===t||61===t||39===t}static isSchemeChar(t){return t>=65&&t<=90||t>=97&&t<=122||t>=48&&t<=57||43===t||45===t||46===t}static isUserInfoChar(t){return po.isUnreservedChar(t)||po.isSubDelimChar(t)||58===t}static isUserChar(t){return po.isUnreservedChar(t)||po.isSubDelimChar(t)}static isHostChar(t){return po.isUnreservedChar(t)||po.isSubDelimChar(t)}static isPathChar(t){return po.isUnreservedChar(t)||po.isSubDelimChar(t)||58===t||64===t}static isQueryChar(t){return po.isUnreservedChar(t)||po.isSubDelimChar(t)||47===t||58===t||63===t||64===t}static isParamChar(t){return po.isUnreservedChar(t)||33===t||36===t||40===t||41===t||42===t||43===t||44===t||47===t||58===t||59===t||63===t||64===t||39===t}static isFragmentChar(t){return po.isUnreservedChar(t)||po.isSubDelimChar(t)||47===t||58===t||63===t||64===t}static isAlpha(t){return t>=65&&t<=90||t>=97&&t<=122}static toLowerCase(t){return t>=65&&t<=90?t+32:t}static writeScheme(t,e){for(let r=0,i=e.length;r<i;r+=1){const i=e.charCodeAt(r);t=r>0&&po.isSchemeChar(i)||0===r&&po.isAlpha(i)?t.write(i):wt.error(new co("Invalid scheme: "+e))}return t}static writeUserInfo(t,e){for(let r=0,i=e.length;r<i;r+=1){const i=e.charCodeAt(r);t=po.isUserInfoChar(i)?t.write(i):po.writeEncoded(t,i)}return t}static writeUser(t,e){for(let r=0,i=e.length;r<i;r+=1){const i=e.charCodeAt(r);t=po.isUserChar(i)?t.write(i):po.writeEncoded(t,i)}return t}static writeHost(t,e){for(let r=0,i=e.length;r<i;r+=1){const i=e.charCodeAt(r);t=po.isHostChar(i)?t.write(i):po.writeEncoded(t,i)}return t}static writeHostLiteral(t,e){for(let r=0,i=e.length;r<i;r+=1){const i=e.charCodeAt(r);t=po.isHostChar(i)||58===i?t.write(i):po.writeEncoded(t,i)}return t}static writePathSegment(t,e){for(let r=0,i=e.length;r<i;r+=1){const i=e.charCodeAt(r);t=po.isPathChar(i)?t.write(i):po.writeEncoded(t,i)}return t}static writeQuery(t,e){for(let r=0,i=e.length;r<i;r+=1){const i=e.charCodeAt(r);t=po.isQueryChar(i)?t.write(i):po.writeEncoded(t,i)}return t}static writeParam(t,e){for(let r=0,i=e.length;r<i;r+=1){const i=e.charCodeAt(r);t=po.isParamChar(i)?t.write(i):po.writeEncoded(t,i)}return t}static writeFragment(t,e){for(let r=0,i=e.length;r<i;r+=1){const i=e.charCodeAt(r);t=po.isFragmentChar(i)?t.write(i):po.writeEncoded(t,i)}return t}static writeEncoded(t,e){return 0===e?(t=po.writePctEncoded(t,192),t=po.writePctEncoded(t,128)):e>=0&&e<=127?t=po.writePctEncoded(t,e):e>=128&&e<=2047?(t=po.writePctEncoded(t,192|e>>>6),t=po.writePctEncoded(t,128|63&e)):e>=2048&&e<=65535?(t=po.writePctEncoded(t,224|e>>>12),t=po.writePctEncoded(t,128|e>>>6&63),t=po.writePctEncoded(t,128|63&e)):e>=65536&&e<=1114111?(t=po.writePctEncoded(t,240|e>>>18),t=po.writePctEncoded(t,128|e>>>12&63),t=po.writePctEncoded(t,128|e>>>6&63),t=po.writePctEncoded(t,128|63&e)):(t=po.writePctEncoded(t,239),t=po.writePctEncoded(t,191),t=po.writePctEncoded(t,189)),t}static writePctEncoded(t,e){const r=te.lowercase;return t=t.write(37).write(r.encodeDigit(e>>>4&15)).write(r.encodeDigit(15&e))}}e([s],po,"empty",null),e([s],po,"standardParser",null),e([s],po,"form",null);class fo{constructor(t){this.name=t}isDefined(){return 0!==this.name.length}toAny(){return 0!==this.name.length?this.name:void 0}compareTo(t){return t instanceof fo?this.name.localeCompare(t.name):NaN}equals(t){return this===t||t instanceof fo&&this.name===t.name}hashCode(){return l.hash(this.name)}debug(t){return t=t.write("UriScheme").write(46),t=this.isDefined()?t.write("parse").write(40).write(34).display(this).write(34).write(41):t.write("undefined").write(40).write(41)}display(t){return t=po.writeScheme(t,this.name)}toString(){return this.name}static undefined(){return new fo("")}static create(t){const e=fo.cache,r=e.get(t);return void 0!==r?r:e.put(t,new fo(t))}static fromAny(t){if(null==t)return fo.undefined();if(t instanceof fo)return t;if("string"==typeof t)return fo.parse(t);throw new TypeError(""+t)}static parse(t){return po.standardParser.parseSchemeString(t)}static get cache(){return new $(4)}}e([s],fo,"undefined",null),e([s],fo,"cache",null);class yo{constructor(t,e,r){this.user=t,this.host=e,this.port=r,this.hashValue=void 0,this.stringValue=void 0}isDefined(){return this.user.isDefined()||this.host.isDefined()||this.port.isDefined()}withUser(t){return(t=mo.fromAny(t))!==this.user?this.copy(t,this.host,this.port):this}get userPart(){return this.user.toString()}withUserPart(t){return this.withUser(mo.parse(t))}get username(){return this.user.username}withUsername(t,e){return 1===arguments.length?this.withUser(this.user.withUsername(t)):this.withUser(mo.create(t,e))}get password(){return this.user.password}withPassword(t){return this.withUser(this.user.withPassword(t))}withHost(t){return(t=wo.fromAny(t))!==this.host?this.copy(this.user,t,this.port):this}get hostPart(){return this.host.toString()}withHostPart(t){return this.withHost(wo.parse(t))}get hostAddress(){return this.host.address}get hostName(){return this.host.name}withHostName(t){return this.withHost(wo.hostname(t))}get hostIPv4(){return this.host.ipv4}withHostIPv4(t){return this.withHost(wo.ipv4(t))}get hostIPv6(){return this.host.ipv6}withHostIPv6(t){return this.withHost(wo.ipv6(t))}withPort(t){return(t=Co.fromAny(t))!==this.port?this.copy(this.user,this.host,t):this}get portPart(){return this.port.toString()}withPortPart(t){return this.withPort(Co.parse(t))}get portNumber(){return this.port.number}withPortNumber(t){return this.withPort(Co.create(t))}copy(t,e,r){return yo.create(t,e,r)}toAny(t){return this.isDefined()&&(void 0===t&&(t={}),this.user.toAny(t),this.host.isDefined()&&(t.host=this.host.toAny()),this.port.isDefined()&&(t.port=this.port.toAny())),t}compareTo(t){return t instanceof yo?this.toString().localeCompare(t.toString()):NaN}equals(t){return this===t||t instanceof yo&&this.toString()===t.toString()}hashCode(){let t=this.hashValue;return void 0===t&&(t=l.hash(this.toString()),this.hashValue=t),t}debug(t){return t=t.write("UriAuthority").write(46),t=this.isDefined()?t.write("parse").write(40).write(34).display(this).write(34).write(41):t.write("undefined").write(40).write(41)}display(t){const e=this.stringValue;if(void 0!==e)t=t.write(e);else{const e=this.user;e.isDefined()&&(t=t.display(e).write(64)),t=t.display(this.host);const r=this.port;r.isDefined()&&(t=t.write(58).display(r))}return t}toString(){let t=this.stringValue;return void 0===t&&(t=Ot.display(this),this.stringValue=t),t}static undefined(){return new yo(mo.undefined(),wo.undefined(),Co.undefined())}static create(t=mo.undefined(),e=wo.undefined(),r=Co.undefined()){return t.isDefined()||e.isDefined()||r.isDefined()?new yo(t,e,r):yo.undefined()}static fromInit(t){const e=mo.fromAny(void 0!==t.user?t.user:t),r=wo.fromAny(t.host),i=Co.fromAny(t.port);return yo.create(e,r,i)}static fromAny(t){if(null==t)return yo.undefined();if(t instanceof yo)return t;if("object"==typeof t)return yo.fromInit(t);if("string"==typeof t)return yo.parse(t);throw new TypeError(""+t)}static user(t){return t=mo.fromAny(t),yo.create(t,void 0,void 0)}static userPart(t){const e=mo.parse(t);return yo.create(e,void 0,void 0)}static username(t,e){const r=mo.create(t,e);return yo.create(r,void 0,void 0)}static password(t){const e=mo.create("",t);return yo.create(e,void 0,void 0)}static host(t){return t=wo.fromAny(t),yo.create(void 0,t,void 0)}static hostPart(t){const e=wo.parse(t);return yo.create(void 0,e,void 0)}static hostName(t){const e=wo.hostname(t);return yo.create(void 0,e,void 0)}static hostIPv4(t){const e=wo.ipv4(t);return yo.create(void 0,e,void 0)}static hostIPv6(t){const e=wo.ipv6(t);return yo.create(void 0,e,void 0)}static port(t){return t=Co.fromAny(t),yo.create(void 0,void 0,t)}static portPart(t){const e=Co.parse(t);return yo.create(void 0,void 0,e)}static portNumber(t){const e=Co.create(t);return yo.create(void 0,void 0,e)}static parse(t){return po.standardParser.parseAuthorityString(t)}}e([s],yo,"undefined",null);class mo{constructor(t,e){this.username=t,this.password=e}isDefined(){return void 0!==this.username}withUsername(t){return t!==this.username?this.copy(t,this.password):this}withPassword(t){return t!==this.password?this.copy(this.username,t):this}copy(t,e){return mo.create(t,e)}toAny(t){return void 0!==this.username&&(void 0===t&&(t={}),t.username=this.username,void 0!==this.password&&(t.password=this.password)),t}equals(t){return this===t||t instanceof mo&&(this.username===t.username&&this.password===t.password)}hashCode(){return l.hash(this.toString())}debug(t){return t=t.write("UriUser").write(46),t=this.isDefined()?t.write("parse").write(40).write(34).display(this).write(34).write(41):t.write("undefined").write(40).write(41)}display(t){return void 0!==this.username&&(t=po.writeUser(t,this.username),void 0!==this.password&&(t=t.write(58),t=po.writeUser(t,this.password))),t}toString(){return Ot.display(this)}static undefined(){return new mo(void 0,void 0)}static create(t,e){return void 0!==t||void 0!==e?new mo(t,e):mo.undefined()}static fromInit(t){return mo.create(t.username,t.password)}static fromAny(t){if(null==t)return mo.undefined();if(t instanceof mo)return t;if("object"==typeof t)return mo.fromInit(t);if("string"==typeof t)return mo.parse(t);throw new TypeError(""+t)}static parse(t){return po.standardParser.parseUserString(t)}}e([s],mo,"undefined",null);class wo{constructor(){}isDefined(){return!0}get name(){}get ipv4(){}get ipv6(){}toAny(){return this.toString()}compareTo(t){return t instanceof wo?this.toString().localeCompare(t.toString()):NaN}equals(t){return this===t||t instanceof wo&&this.toString()===t.toString()}hashCode(){return l.hash(this.toString())}static undefined(){return new xo}static hostname(t){const e=wo.cache,r=e.get(t);return r instanceof go?r:e.put(t,new go(t))}static ipv4(t){const e=wo.cache,r=e.get(t);return r instanceof vo?r:e.put(t,new vo(t))}static ipv6(t){const e=wo.cache,r=e.get(t);return r instanceof bo?r:e.put(t,new bo(t))}static fromAny(t){if(null==t)return wo.undefined();if(t instanceof wo)return t;if("string"==typeof t)return wo.parse(t);throw new TypeError(""+t)}static parse(t){return po.standardParser.parseHostString(t)}static get cache(){return new $(16)}}e([s],wo,"undefined",null),e([s],wo,"cache",null);class go extends wo{constructor(t){super(),this.address=t}get name(){return this.address}debug(t){return t=t.write("UriHost").write(46).write("hostname").write(40).debug(this.address).write(41)}display(t){return t=po.writeHost(t,this.address)}toString(){return this.address}}class vo extends wo{constructor(t){super(),this.address=t}get ipv4(){return this.address}debug(t){return t=t.write("UriHost").write(46).write("ipv4").write(40).debug(this.address).write(41)}display(t){return t=po.writeHost(t,this.address)}toString(){return this.address}}class bo extends wo{constructor(t){super(),this.address=t}get ipv6(){return this.address}debug(t){return t=t.write("UriHost").write(46).write("ipv6").write(40).debug(this.address).write(41)}display(t){return t=t.write(91),t=(t=po.writeHostLiteral(t,this.address)).write(93)}toString(){return"["+this.address+"]"}}class xo extends wo{constructor(){super()}isDefined(){return!1}get address(){return""}debug(t){return t=t.write("UriHost").write(46).write("undefined").write(40).write(41)}display(t){return t}toString(){return""}}class Co{constructor(t){this.number=t}isDefined(){return 0!==this.number}valueOf(){return this.number}toAny(){return this.number}compareTo(t){return t instanceof Co?this.number<t.number?-1:this.number>t.number?1:0:NaN}equals(t){return this===t||t instanceof Co&&this.number===t.number}hashCode(){return l.hash(this.toString())}debug(t){return t=t.write("UriPort").write(46),this.isDefined()?(t=t.write("create").write(40),t=Ot.displayNumber(t,this.number)):t=t.write("undefined").write(40),t=t.write(41)}display(t){return t=Ot.displayNumber(t,this.number)}toString(){return""+this.number}static undefined(){return new Co(0)}static create(t){if(0===t)return Co.undefined();if(t>0){const e=Co.cache,r=e.get(t);return void 0!==r?r:e.put(t,new Co(t))}throw new TypeError(""+t)}static fromAny(t){if(null==t)return Co.undefined();if(t instanceof Co)return t;if("number"==typeof t)return Co.create(t);if("string"==typeof t)return Co.parse(t);throw new TypeError(""+t)}static parse(t){return po.standardParser.parsePortString(t)}static get cache(){return new $(16)}}e([s],Co,"undefined",null),e([s],Co,"cache",null);class Oo{constructor(){}get length(){let t=0,e=this;for(;!e.isEmpty();)t+=1,e=e.tail();return t}get(t){let e=0,r=this;for(;!r.isEmpty();){if(!(e<t))return r.head();e+=1,r=r.tail()}}get name(){if(this.isEmpty())return"";let t=this;for(;;){const e=t.tail();if(e.isEmpty())return t.isRelative()?t.head():"";t=e}}withName(t){const e=new Ao;return e.addPath(this.base()),e.addSegment(t),e.bind()}foot(){if(this.isEmpty())return this;let t=this;for(;;){const e=t.tail();if(e.isEmpty())return t;t=e}}isSubpathOf(t){t=Oo.fromAny(t);let e=this;for(;!e.isEmpty()&&!t.isEmpty();){if(e.head()!==t.head())return!1;e=e.tail(),t=t.tail()}return t.isEmpty()}appended(...t){if(arguments.length>0){const e=new Ao;return e.addPath(this),e.push(...t),e.bind()}return this}appendedSlash(){const t=new Ao;return t.addPath(this),t.addSlash(),t.bind()}appendedSegment(t){const e=new Ao;return e.addPath(this),e.addSegment(t),e.bind()}prepended(...t){if(arguments.length>0){const e=new Ao;return e.push(...t),e.addPath(this),e.bind()}return this}prependedSlash(){return new Eo(this)}prependedSegment(t){return this.isEmpty()||this.isAbsolute()?Oo.segment(t,this):Oo.segment(t,this.prependedSlash())}resolve(t){return t.isEmpty()?this:t.isAbsolute()||this.isEmpty()?t.removeDotSegments():this.merge(t).removeDotSegments()}removeDotSegments(){let t=this;const e=new Ao;for(;!t.isEmpty();){const r=t.head();if("."===r||".."===r)t=t.tail(),t.isEmpty()||(t=t.tail());else if(t.isAbsolute()){const i=t.tail();if(i.isEmpty())e.push(t.head()),t=t.tail();else{const n=i.head();"."===n?(t=i.tail(),t.isEmpty()&&(t=Oo.slash())):".."===n?(t=i.tail(),t.isEmpty()&&(t=Oo.slash()),e.isEmpty()||e.pop().isAbsolute()||e.isEmpty()||e.pop()):(e.push(r,n),t=i.tail())}}else e.push(t.head()),t=t.tail()}return e.bind()}merge(t){if(this.isEmpty())return t;{const e=new Ao;let r=this;for(;;){const t=r.tail();if(t.isEmpty()){r.isAbsolute()&&e.addSlash();break}r.isAbsolute()?e.addSlash():e.addSegment(r.head()),r=t}return e.addPath(t),e.bind()}}unmerge(t,e=t){let r=this;for(;;){if(r.isEmpty())return t.isEmpty()||t.tail().isEmpty()?t:t.tail();if(r.isRelative())return t;if(t.isRelative())return t.prependedSlash();{let i=r.tail(),n=t.tail();if(!i.isEmpty()&&n.isEmpty())return Oo.slash();if(i.isEmpty()||n.isEmpty()||i.head()!==n.head())return n;if(i=i.tail(),n=n.tail(),!i.isEmpty()&&n.isEmpty())return e;r=i,t=n}}}toAny(){const t=[];let e=this;for(;!e.isEmpty();)t.push(e.head()),e=e.tail();return t}compareTo(t){return t instanceof Oo?this.toString().localeCompare(t.toString()):NaN}equals(t){return this===t||t instanceof Oo&&this.toString()===t.toString()}hashCode(){return l.hash(this.toString())}display(t){let e=this;for(;!e.isEmpty();)t=e.isAbsolute()?t.write(47):po.writePathSegment(t,e.head()),e=e.tail();return t}static empty(){return new ko}static slash(){return new Eo(Oo.empty())}static segment(t,e){return void 0===e&&(e=Oo.empty()),t=this.cacheSegment(t),new So(t,e)}static of(...t){const e=new Ao;return e.push(...t),e.bind()}static fromAny(t){if(null==t)return Oo.empty();if(t instanceof Oo)return t;if(Array.isArray(t))return Oo.of(...t);if("string"==typeof t)return Oo.parse(t);throw new TypeError(""+t)}static parse(t){return po.standardParser.parsePathString(t)}static builder(){return new Ao}static pathForm(){return new Mo(Oo.empty())}static get segmentCache(){return new et(64)}static cacheSegment(t){return t.length<=32?this.segmentCache.put(t):t}}e([s],Oo,"empty",null),e([s],Oo,"slash",null),e([s],Oo,"pathForm",null),e([s],Oo,"segmentCache",null);class So extends Oo{constructor(t,e){super(),this.segment=t,this.rest=e,this.stringValue=void 0}isDefined(){return!0}isAbsolute(){return!1}isRelative(){return!0}isEmpty(){return!1}head(){return this.segment}tail(){return this.rest}setTail(t){if(t instanceof So)throw new Error("adjacent path segments");this.rest=t}dealias(){return new So(this.segment,this.rest)}parent(){const t=this.rest;if(t.isEmpty())return Oo.empty();return t.tail().isEmpty()?Oo.empty():new So(this.segment,t.parent())}base(){const t=this.rest;return t.isEmpty()?Oo.empty():new So(this.segment,t.base())}prependedSegment(t){return Oo.segment(t,this.prependedSlash())}debug(t){return t=t.write("UriPath").write(46).write("parse").write(40).write(34).display(this).write(34).write(41)}display(t){const e=this.stringValue;return t=void 0!==e?t.write(e):super.display(t)}toString(){let t=this.stringValue;return void 0===t&&(t=Ot.display(this),this.stringValue=t),t}}class Eo extends Oo{constructor(t){super(),this.rest=t,this.stringValue=void 0}isDefined(){return!0}isAbsolute(){return!0}isRelative(){return!1}isEmpty(){return!1}head(){return"/"}tail(){return this.rest}setTail(t){this.rest=t}dealias(){return new Eo(this.rest)}parent(){const t=this.rest;if(t.isEmpty())return Oo.empty();return t.tail().isEmpty()?Oo.slash():new Eo(t.parent())}base(){const t=this.rest;return t.isEmpty()?this:new Eo(t.base())}prependedSegment(t){return Oo.segment(t,this)}debug(t){return t=t.write("UriPath").write(46).write("parse").write(40).write(34).display(this).write(34).write(41)}display(t){const e=this.stringValue;return t=void 0!==e?t.write(e):super.display(t)}toString(){let t=this.stringValue;return void 0===t&&(t=Ot.display(this),this.stringValue=t),t}}class ko extends Oo{constructor(){super()}isDefined(){return!1}isAbsolute(){return!1}isRelative(){return!0}isEmpty(){return!0}head(){throw new Error("empty path")}tail(){throw new Error("empty path")}setTail(t){throw new Error("empty path")}dealias(){return this}parent(){return this}base(){return this}appended(...t){return Oo.of(...t)}appendedSlash(){return Oo.slash()}appendedSegment(t){return Oo.segment(t)}prepended(...t){return Oo.of(...t)}prependedSlash(){return Oo.slash()}prependedSegment(t){return Oo.segment(t)}merge(t){return t}debug(t){return t=t.write("UriPath").write(46).write("empty").write(40).write(41)}display(t){return t}toString(){return""}}class Ao{constructor(){this.first=Oo.empty(),this.last=null,this.size=0,this.aliased=0}isEmpty(){return 0===this.size}push(...t){for(let e=0;e<t.length;e+=1){const r=t[e];r instanceof Oo?this.addPath(r):Array.isArray(r)?this.push(...r):"/"===r?this.addSlash():this.addSegment(r)}}bind(){return this.aliased=0,this.first}addSlash(){const t=Oo.slash().dealias(),e=this.size;0===e?this.first=t:this.dealias(e-1).setTail(t),this.last=t,this.size=e+1,this.aliased+=1}addSegment(t){const e=Oo.segment(t,Oo.empty());let r=this.size;if(0===r)this.first=e;else{const t=this.dealias(r-1);t.isAbsolute()?t.setTail(e):(t.setTail(e.prependedSlash()),r+=1,this.aliased+=1)}this.last=e,this.size=r+1,this.aliased+=1}addPath(t){if(!t.isEmpty()){let e=this.size;if(0===e)this.first=t;else{const r=this.dealias(e-1);r.isAbsolute()||t.isAbsolute()?r.setTail(t):(r.setTail(t.prependedSlash()),e+=1,this.aliased+=1)}for(e+=1;;){const r=t.tail();if(r.isEmpty())break;t=r,e+=1}this.last=t,this.size=e}}pop(){const t=this.size,e=this.aliased;if(0===t)throw new Error("Empty UriPath");if(1===t){const r=this.first;return this.first=r.tail(),r.tail().isEmpty()&&(this.last=null),this.size=t-1,e>0&&(this.aliased=e-1),r}{const r=this.dealias(t-2);return r.setTail(Oo.empty()),this.last=r,this.size=t-1,this.aliased=e-1,r.tail()}}dealias(t){let e=0,r=null,i=this.first;if(this.aliased<=t){for(;e<this.aliased;)r=i,i=i.tail(),e+=1;for(;e<=t;){const t=i.dealias();0===e?this.first=t:r.setTail(t),r=t,i=i.tail(),e+=1}e===this.size&&(this.last=r),this.aliased=e}else if(0===t)r=this.first;else if(t===this.size-1)r=this.last;else for(;e<=t;)r=i,i=i.tail(),e+=1;return r}}class Mo extends ki{constructor(t){super(),Object.defineProperty(this,"unit",{value:t,enumerable:!0})}withUnit(t){return t!==this.unit?new Mo(t):this}mold(t,e){return t=Oo.fromAny(t),void 0===e?Sr.from(t.toString()):e.concat(Sr.from(t.toString()))}cast(t,e){const r=t.target;try{const t=r.stringValue();if("string"==typeof t)return Oo.parse(t)}catch(t){}}}class Do{get length(){let t=0,e=this;for(;!e.isEmpty();)t+=1,e=e.tail();return t}has(t){let e=this;for(;!e.isEmpty();){if(t===e.key)return!0;e=e.tail()}return!1}get(t){let e=this;for(;!e.isEmpty();){if(t===e.key)return e.value;e=e.tail()}}updated(t,e){let r=this;const i=new To;let n=!1;for(;!r.isEmpty();)t===r.key?(i.addParam(t,e),n=!0):i.addParam(r.key,r.value),r=r.tail();return n||i.addParam(t,e),i.bind()}removed(t){let e=this;const r=new To;let i=!1;for(;!e.isEmpty();)t===e.key?i=!0:r.addParam(e.key,e.value),e=e.tail();return i?r.bind():this}appended(t,e){const r=new To;return r.addQuery(this),r.add(t,e),r.bind()}prepended(t,e){const r=new To;return r.add(t,e),r.addQuery(this),r.bind()}toAny(t){if(this.isDefined()){t=t||{};let e=this,r=0;for(;!e.isEmpty();){const i=e.key;void 0!==i?t[i]=e.value:t["$"+r]=e.value,e=e.tail(),r+=1}}return t}compareTo(t){return t instanceof Do?this.toString().localeCompare(t.toString()):NaN}equals(t){return this===t||t instanceof Do&&this.toString()===t.toString()}hashCode(){return l.hash(this.toString())}display(t){let e=this,r=!0;for(;!e.isEmpty();){r?r=!1:t=t.write(38);const i=e.key;void 0!==i&&(t=(t=po.writeParam(t,i)).write(61)),t=po.writeQuery(t,e.value),e=e.tail()}return t}static undefined(){return new Po}static param(t,e,r){return void 0===r?(r=e,e=t,t=void 0):void 0!==t&&(t=this.cacheKey(t)),void 0===r&&(r=Do.undefined()),new Io(t,e,r)}static fromAny(t){if(null==t)return Do.undefined();if(t instanceof Do)return t;if("object"==typeof t){const e=new To;return e.add(t),e.bind()}if("string"==typeof t)return Do.parse(t);throw new TypeError(""+t)}static parse(t){return po.standardParser.parseQueryString(t)}static builder(){return new To}static get keyCache(){return new et(64)}static cacheKey(t){return t.length<=32?Do.keyCache.put(t):t}}e([s],Do,"undefined",null),e([s],Do,"keyCache",null);class Io extends Do{constructor(t,e,r){super(),this.key=t,this.value=e,this.rest=r,this.stringValue=void 0}isDefined(){return!0}isEmpty(){return!1}head(){return[this.key,this.value]}tail(){return this.rest}setTail(t){this.rest=t}dealias(){return new Io(this.key,this.value,this.rest)}debug(t){return t=t.write("UriQuery").write(46).write("parse").write(40).write(34).display(this).write(34).write(41)}display(t){const e=this.stringValue;return t=void 0!==e?t.write(e):super.display(t)}toString(){let t=this.stringValue;return void 0===t&&(t=Ot.display(this),this.stringValue=t),t}}class Po extends Do{isDefined(){return!1}isEmpty(){return!0}head(){throw new Error("undefined query")}get key(){throw new Error("undefined query")}get value(){throw new Error("undefined query")}tail(){throw new Error("undefined query")}setTail(t){throw new Error("undefined query")}dealias(){return this}updated(t,e){return Do.param(t,e,this)}removed(t){return this}appended(t,e){const r=new To;return r.add(t,e),r.bind()}prepended(t,e){const r=new To;return r.add(t,e),r.bind()}debug(t){return t=t.write("UriQuery").write(46).write("undefined").write(40).write(41)}display(t){return t}toString(){return""}}class To{constructor(){this.first=Do.undefined(),this.last=null,this.size=0,this.aliased=0}isEmpty(){return 0===this.size}add(t,e){if(void 0!==e)this.addParam(t,e);else if("string"==typeof t)this.addParam(void 0,t);else if(t instanceof Do)this.addQuery(t);else{const e=t;for(const t in e){let r=t;const i=e[t];36===t.charCodeAt(0)&&(r=void 0),this.addParam(r,i)}}}bind(){return this.aliased=0,this.first}addParam(t,e){void 0===e&&(e=t,t=void 0);const r=Do.param(t,e,Do.undefined()),i=this.size;0===i?this.first=r:this.dealias(i-1).setTail(r),this.last=r,this.size=i+1,this.aliased+=1}addQuery(t){if(!t.isEmpty()){let e=this.size;for(0===e?this.first=t:this.dealias(e-1).setTail(t),e+=1;;){const r=t.tail();if(r.isEmpty())break;t=r,e+=1}this.last=t,this.size=e}}dealias(t){let e=0,r=null,i=this.first;if(this.aliased<=t){for(;e<this.aliased;)r=i,i=i.tail(),e+=1;for(;e<=t;){const t=i.dealias();0===e?this.first=t:r.setTail(t),r=t,i=i.tail(),e+=1}e===this.size&&(this.last=r),this.aliased=e}else if(0===t)r=this.first;else if(t===this.size-1)r=this.last;else for(;e<=t;)r=i,i=i.tail(),e+=1;return r}}class Vo{constructor(t){this.identifier=t,this.stringValue=void 0}isDefined(){return void 0!==this.identifier}toAny(){return this.identifier}compareTo(t){return t instanceof Vo?this.toString().localeCompare(t.toString()):NaN}equals(t){return this===t||t instanceof Vo&&this.identifier===t.identifier}hashCode(){return l.hash(this.identifier)}debug(t){return t=t.write("UriFragment").write(46),t=this.isDefined()?t.write("parse").write(40).write(34).display(this).write(34).write(41):t.write("undefined").write(40).write(41)}display(t){const e=this.stringValue;return void 0!==e?t=t.write(e):void 0!==this.identifier&&(t=po.writeFragment(t,this.identifier)),t}toString(){let t=this.stringValue;return void 0===t&&(t=Ot.display(this),this.stringValue=t),t}static undefined(){return new Vo(void 0)}static create(t){if(void 0!==t){const e=Vo.cache,r=e.get(t);return void 0!==r?r:e.put(t,new Vo(t))}return Vo.undefined()}static fromAny(t){if(null==t)return Vo.undefined();if(t instanceof Vo)return t;if("string"==typeof t)return Vo.parse(t);throw new TypeError(""+t)}static parse(t){return po.standardParser.parseFragmentString(t)}static get cache(){return new $(32)}}e([s],Vo,"undefined",null),e([s],Vo,"cache",null);class Fo extends ki{constructor(t){super(),Object.defineProperty(this,"unit",{value:t,enumerable:!0})}withUnit(t){return t!==this.unit?new Fo(t):this}mold(t,e){return t=po.fromAny(t),void 0===e?Sr.from(t.toString()):e.concat(Sr.from(t.toString()))}cast(t,e){const r=t.target;try{const t=r.stringValue();if("string"==typeof t)return po.parse(t)}catch(t){}}}class qo{constructor(t,e=32){this.base=t,this.resolveCache=new $(e),this.unresolveCache=new $(e)}resolve(t){t=po.fromAny(t);let e=this.resolveCache.get(t);return void 0===e&&(e=this.base.resolve(t),this.resolveCache.put(t,e)),e}unresolve(t){t=po.fromAny(t);let e=this.unresolveCache.get(t);return void 0===e&&(e=this.base.unresolve(t),this.unresolveCache.put(t,e)),e}}class Uo{absolute(t,e,r,i,n){return po.create(t,e,r,i,n)}scheme(t){return fo.create(t)}authority(t,e,r){return yo.create(t,e,r)}user(t,e){return mo.create(t,e)}hostName(t){return wo.hostname(t)}hostIPv4(t){return wo.ipv4(t)}hostIPv6(t){return wo.ipv6(t)}port(t){return Co.create(t)}pathEmpty(){return Oo.empty()}pathBuilder(){return new Ao}queryBuilder(){return new To}fragment(t){return Vo.create(t)}absoluteParser(){return new Ro(this)}parseAbsolute(t){return Ro.parse(t,this)}parseAbsoluteString(t){const e=Ct.stringInput(t);let r=this.parseAbsolute(e);return e.isCont()&&!r.isError()&&(r=jt.error(Et.unexpected(e))),r.bind()}schemeParser(){return new No(this)}parseScheme(t){return No.parse(t,this)}parseSchemeString(t){const e=Ct.stringInput(t);let r=this.parseScheme(e);return e.isCont()&&!r.isError()&&(r=jt.error(Et.unexpected(e))),r.bind()}authorityParser(){return new zo(this)}parseAuthority(t){return zo.parse(t,this)}parseAuthorityString(t){const e=Ct.stringInput(t);let r=this.parseAuthority(e);return e.isCont()&&!r.isError()&&(r=jt.error(Et.unexpected(e))),r.bind()}userParser(){return new jo(this)}parseUser(t){return jo.parse(t,this)}parseUserString(t){const e=Ct.stringInput(t);let r=this.parseUser(e);return e.isCont()&&!r.isError()&&(r=jt.error(Et.unexpected(e))),r.bind()}hostParser(){return new Lo(this)}parseHost(t){return Lo.parse(t,this)}parseHostString(t){const e=Ct.stringInput(t);let r=this.parseHost(e);return e.isCont()&&!r.isError()&&(r=jt.error(Et.unexpected(e))),r.bind()}hostAddressParser(){return new Ko(this)}parseHostAddress(t){return Ko.parse(t,this)}hostLiteralParser(){return new Bo(this)}parseHostLiteral(t){return Bo.parse(t,this)}portParser(){return new Wo(this)}parsePort(t){return Wo.parse(t,this)}parsePortString(t){const e=Ct.stringInput(t);let r=this.parsePort(e);return e.isCont()&&!r.isError()&&(r=jt.error(Et.unexpected(e))),r.bind()}pathParser(t){return new Ho(this,t)}parsePath(t,e){return Ho.parse(t,this,e)}parsePathString(t){const e=Ct.stringInput(t);let r=this.parsePath(e);return e.isCont()&&!r.isError()&&(r=jt.error(Et.unexpected(e))),r.bind()}queryParser(t){return new Xo(this,t)}parseQuery(t,e){return Xo.parse(t,this,e)}parseQueryString(t){const e=Ct.stringInput(t);let r=this.parseQuery(e);return e.isCont()&&!r.isError()&&(r=jt.error(Et.unexpected(e))),r.bind()}fragmentParser(){return new Yo(this)}parseFragment(t){return Yo.parse(t,this)}parseFragmentString(t){const e=Ct.stringInput(t);let r=this.parseFragment(e);return e.isCont()&&!r.isError()&&(r=jt.error(Et.unexpected(e))),r.bind()}}class Ro extends jt{constructor(t,e,r,i,n,s,o){super(),this.uri=t,this.schemeParser=e,this.authorityParser=r,this.pathParser=i,this.queryParser=n,this.fragmentParser=s,this.step=o}feed(t){return Ro.parse(t,this.uri,this.schemeParser,this.authorityParser,this.pathParser,this.queryParser,this.fragmentParser,this.step)}static parse(t,e,r,i,n,s,o,a=1){let u=0;if(1===a)if(t.isCont()){const e=t.clone();for(;e.isCont()&&(u=e.head(),po.isSchemeChar(u));)e.step();a=e.isCont()&&58===u?2:3}else t.isDone()&&(a=3);if(2===a)if((r=void 0===r?e.parseScheme(t):r.feed(t)).isDone()){if(t.isCont()&&58===t.head())t=t.step(),a=3;else if(!t.isEmpty())return jt.error(Et.expected(58,t))}else if(r.isError())return r.asError();if(3===a)if(t.isCont())u=t.head(),47===u?(t=t.step(),a=4):63===u?(t=t.step(),a=7):35===u?(t=t.step(),a=8):a=6;else if(t.isDone())return jt.done(e.absolute(void 0!==r?r.bind():void 0));if(4===a)if(t.isCont()&&47===t.head())t=t.step(),a=5;else if(t.isCont()){const r=e.pathBuilder();r.addSlash(),n=e.parsePath(t,r),a=6}else if(t.isDone())return jt.done(e.absolute(void 0!==r?r.bind():void 0,void 0,Oo.slash()));if(5===a)if((i=void 0===i?e.parseAuthority(t):i.feed(t)).isDone()){if(t.isCont())u=t.head(),63===u?(t=t.step(),a=7):35===u?(t=t.step(),a=8):a=6;else if(t.isDone())return jt.done(e.absolute(void 0!==r?r.bind():void 0,void 0!==i?i.bind():void 0))}else if(i.isError())return i.asError();if(6===a)if((n=void 0===n?e.parsePath(t):n.feed(t)).isDone()){if(t.isCont()&&63===t.head())t=t.step(),a=7;else if(t.isCont()&&35===t.head())t=t.step(),a=8;else if(!t.isEmpty())return jt.done(e.absolute(void 0!==r?r.bind():void 0,void 0!==i?i.bind():void 0,n.bind()))}else if(n.isError())return n.asError();if(7===a)if((s=void 0===s?e.parseQuery(t):s.feed(t)).isDone()){if(t.isCont()&&35===t.head())t=t.step(),a=8;else if(!t.isEmpty())return jt.done(e.absolute(void 0!==r?r.bind():void 0,void 0!==i?i.bind():void 0,void 0!==n?n.bind():void 0,s.bind()))}else if(s.isError())return s.asError();if(8===a){if((o=void 0===o?e.parseFragment(t):o.feed(t)).isDone())return jt.done(e.absolute(void 0!==r?r.bind():void 0,void 0!==i?i.bind():void 0,void 0!==n?n.bind():void 0,void 0!==s?s.bind():void 0,o.bind()));if(o.isError())return o.asError()}return new Ro(e,r,i,n,s,o,a)}}class No extends jt{constructor(t,e,r){super(),this.uri=t,this.output=e,this.step=r}feed(t){return No.parse(t,this.uri,this.output,this.step)}static parse(t,e,r,i=1){let n=0;if(1===i)if(t.isCont()&&(n=t.head(),po.isAlpha(n)))t=t.step(),r=(r=r||ie.decodedString()).write(po.toLowerCase(n)),i=2;else if(!t.isEmpty())return jt.error(Et.expected("scheme",t));if(2===i){for(;t.isCont()&&(n=t.head(),po.isSchemeChar(n));)t=t.step(),r.write(po.toLowerCase(n));if(!t.isEmpty())return jt.done(e.scheme(r.bind()))}return new No(e,r,i)}}class zo extends jt{constructor(t,e,r,i,n){super(),this.uri=t,this.userParser=e,this.hostParser=r,this.portParser=i,this.step=n}feed(t){return zo.parse(t,this.uri,this.userParser,this.hostParser,this.portParser,this.step)}static parse(t,e,r,i,n,s=1){let o=0;if(1===s)if(t.isCont()){const e=t.clone();for(;e.isCont()&&(o=e.head(),64!==o&&47!==o);)e.step();s=e.isCont()&&64===o?2:3}else t.isDone()&&(s=3);if(2===s)if((r=void 0===r?e.parseUser(t):r.feed(t)).isDone()){if(t.isCont()&&64===t.head())t=t.step(),s=3;else if(!t.isEmpty())return jt.error(Et.expected(64,t))}else if(r.isError())return r.asError();if(3===s)if((i=void 0===i?e.parseHost(t):i.feed(t)).isDone()){if(t.isCont()&&58===t.head())t=t.step(),s=4;else if(!t.isEmpty())return jt.done(e.authority(void 0!==r?r.bind():void 0,i.bind()))}else if(i.isError())return i.asError();if(4===s){if((n=void 0===n?e.parsePort(t):n.feed(t)).isDone())return jt.done(e.authority(void 0!==r?r.bind():void 0,i.bind(),n.bind()));if(n.isError())return n.asError()}return new zo(e,r,i,n,s)}}class jo extends jt{constructor(t,e,r,i,n){super(),this.uri=t,this.usernameOutput=e,this.passwordOutput=r,this.c1=i,this.step=n}feed(t){return jo.parse(t,this.uri,this.usernameOutput,this.passwordOutput,this.c1,this.step)}static parse(t,e,r,i,n=0,s=1){let o=0;for(;;){if(1===s){for(r=r||ie.decodedString();t.isCont()&&(o=t.head(),po.isUserChar(o));)t=t.step(),r.write(o);if(t.isCont()&&58===o)t=t.step(),s=4;else if(t.isCont()&&37===o)t=t.step(),s=2;else if(!t.isEmpty())return jt.done(e.user(r.bind()))}if(2===s)if(t.isCont()&&(o=t.head(),te.isDigit(o)))t=t.step(),n=o,s=3;else if(!t.isEmpty())return jt.error(Et.expected("hex digit",t));if(3===s){if(t.isCont()&&(o=t.head(),te.isDigit(o))){t=t.step(),r.write(te.decodeDigit(n)<<4|te.decodeDigit(o)),n=0,s=1;continue}if(!t.isEmpty())return jt.error(Et.expected("hex digit",t))}if(4===s){for(i=i||ie.decodedString();t.isCont()&&(o=t.head(),po.isUserInfoChar(o));)t=t.step(),i.write(o);if(t.isCont()&&37===o)t=t.step(),s=5;else if(!t.isEmpty())return jt.done(e.user(r.bind(),i.bind()))}if(5===s)if(t.isCont()&&(o=t.head(),te.isDigit(o)))t=t.step(),n=o,s=6;else if(!t.isEmpty())return jt.error(Et.expected("hex digit",t));if(6===s){if(t.isCont()&&(o=t.head(),te.isDigit(o))){t=t.step(),i.write(te.decodeDigit(n)<<4|te.decodeDigit(o)),n=0,s=4;continue}if(!t.isEmpty())return jt.error(Et.expected("hex digit",t))}break}return new jo(e,r,i,n,s)}}class Lo extends jt{constructor(t){super(),this.uri=t}feed(t){return Lo.parse(t,this.uri)}static parse(t,e){if(t.isCont()){return 91===t.head()?e.parseHostLiteral(t):e.parseHostAddress(t)}return t.isDone()?jt.done(e.hostName("")):new Lo(e)}}class Ko extends jt{constructor(t,e,r,i,n){super(),this.uri=t,this.output=e,this.c1=r,this.x=i,this.step=n}feed(t){return Ko.parse(t,this.uri,this.output,this.c1,this.x,this.step)}static parse(t,e,r,i=0,n=0,s=1){let o=0;for(r=r||ie.decodedString();s<=4;){for(;t.isCont()&&(o=t.head(),St.isDigit(o));)t=t.step(),r=r.write(o),n=10*n+St.decodeDigit(o);if(!t.isCont()){if(t.isEmpty())break;return 4===s&&n<=255?jt.done(e.hostIPv4(r.bind())):jt.done(e.hostName(r.bind()))}if(!(46===o&&s<4&&n<=255)){if(!po.isHostChar(o)&&37!==o&&4===s&&n<=255)return jt.done(e.hostIPv4(r.bind()));n=0,s=5;break}t=t.step(),r=r.write(o),n=0,s+=1}for(;;){if(5===s){for(;t.isCont()&&(o=t.head(),po.isHostChar(o));)t=t.step(),r.write(po.toLowerCase(o));if(t.isCont()&&37===o)t=t.step(),s=6;else if(!t.isEmpty())return jt.done(e.hostName(r.bind()))}if(6===s)if(t.isCont()&&(o=t.head(),te.isDigit(o)))t=t.step(),i=o,s=7;else if(!t.isEmpty())return jt.error(Et.expected("hex digit",t));if(7===s){if(t.isCont()&&(o=t.head(),te.isDigit(o))){t=t.step(),r.write(te.decodeDigit(i)<<4|te.decodeDigit(o)),i=0,s=5;continue}if(!t.isEmpty())return jt.error(Et.expected("hex digit",t))}break}return new Ko(e,r,i,n,s)}}class Bo extends jt{constructor(t,e,r){super(),this.uri=t,this.output=e,this.step=r}feed(t){return Bo.parse(t,this.uri,this.output,this.step)}static parse(t,e,r,i=1){let n=0;if(1===i)if(t.isCont()&&91===t.head())t=t.step(),i=2;else if(!t.isEmpty())return jt.error(Et.expected(91,t));if(2===i){for(r=r||ie.decodedString();t.isCont()&&(n=t.head(),po.isHostChar(n)||58===n);)t=t.step(),r=r.write(po.toLowerCase(n));if(t.isCont()&&93===n)return t=t.step(),jt.done(e.hostIPv6(r.bind()));if(!t.isEmpty())return jt.error(Et.expected(93,t))}return new Bo(e,r,i)}}class Wo extends jt{constructor(t,e){super(),this.uri=t,this.number=e}feed(t){return Wo.parse(t,this.uri,this.number)}static parse(t,e,r=0){let i=0;for(;t.isCont()&&(i=t.head(),St.isDigit(i));)t=t.step(),r=10*r+St.decodeDigit(i);return t.isEmpty()?new Wo(e,r):jt.done(e.port(r))}}class Ho extends jt{constructor(t,e,r,i,n){super(),this.uri=t,this.builder=e,this.output=r,this.c1=i,this.step=n}feed(t){return Ho.parse(t,this.uri,this.builder,this.output,this.c1,this.step)}static parse(t,e,r,i,n=0,s=1){let o=0;for(;;){if(1===s){for(;t.isCont()&&(o=t.head(),po.isPathChar(o));)i=i||ie.decodedString(),t=t.step(),i=i.write(o);if(t.isCont()&&47===o){t=t.step(),r=r||e.pathBuilder(),void 0!==i&&(r.addSegment(i.bind()),i=void 0),r.addSlash();continue}if(t.isCont()&&37===o)t=t.step(),s=2;else if(!t.isEmpty())return void 0!==i&&(r=r||e.pathBuilder()).addSegment(i.bind()),void 0!==r?jt.done(r.bind()):jt.done(e.pathEmpty())}if(2===s)if(t.isCont()&&(o=t.head(),te.isDigit(o)))t=t.step(),n=o,s=3;else if(!t.isEmpty())return jt.error(Et.expected("hex digit",t));if(3===s){if(t.isCont()&&(o=t.head(),te.isDigit(o))){i=i||ie.decodedString(),t=t.step(),i=i.write(te.decodeDigit(n)<<4|te.decodeDigit(o)),n=0,s=1;continue}if(!t.isEmpty())return jt.error(Et.expected("hex digit",t))}break}return new Ho(e,r,i,n,s)}}class Xo extends jt{constructor(t,e,r,i,n,s){super(),this.uri=t,this.builder=e,this.keyOutput=r,this.valueOutput=i,this.c1=n,this.step=s}feed(t){return Xo.parse(t,this.uri,this.builder,this.keyOutput,this.valueOutput,this.c1,this.step)}static parse(t,e,r,i,n,s=0,o=1){let a=0;for(;;){if(1===o){for(i=i||ie.decodedString();t.isCont()&&(a=t.head(),po.isParamChar(a));)t=t.step(),i.write(a);if(t.isCont()&&61===a)t=t.step(),o=4;else{if(t.isCont()&&38===a){t=t.step(),(r=r||e.queryBuilder()).addParam(i.bind()),i=void 0;continue}if(t.isCont()&&37===a)t=t.step(),o=2;else if(!t.isEmpty())return(r=r||e.queryBuilder()).addParam(i.bind()),jt.done(r.bind())}}if(2===o)if(t.isCont()&&(a=t.head(),te.isDigit(a)))t=t.step(),s=a,o=3;else if(!t.isEmpty())return jt.error(Et.expected("hex digit",t));if(3===o){if(t.isCont()&&(a=t.head(),te.isDigit(a))){t=t.step(),i.write(te.decodeDigit(s)<<4|te.decodeDigit(a)),s=0,o=1;continue}if(!t.isEmpty())return jt.error(Et.expected("hex digit",t))}if(4===o){for(n=n||ie.decodedString();t.isCont()&&(a=t.head(),po.isParamChar(a)||61===a);)t=t.step(),n.write(a);if(t.isCont()&&38===a){t=t.step(),(r=r||e.queryBuilder()).addParam(i.bind(),n.bind()),i=void 0,n=void 0,o=1;continue}if(t.isCont()&&37===a)t=t.step(),o=5;else if(!t.isEmpty())return(r=r||e.queryBuilder()).addParam(i.bind(),n.bind()),jt.done(r.bind())}if(5===o)if(t.isCont()&&(a=t.head(),te.isDigit(a)))t=t.step(),s=a,o=6;else if(!t.isEmpty())return jt.error(Et.expected("hex digit",t));if(6===o){if(t.isCont()&&(a=t.head(),te.isDigit(a))){t=t.step(),n.write(te.decodeDigit(s)<<4|te.decodeDigit(a)),s=0,o=4;continue}if(!t.isEmpty())return jt.error(Et.expected("hex digit",t))}break}return new Xo(e,r,i,n,s,o)}}class Yo extends jt{constructor(t,e,r,i){super(),this.uri=t,this.output=e,this.c1=r,this.step=i}feed(t){return Yo.parse(t,this.uri,this.output,this.c1,this.step)}static parse(t,e,r,i=0,n=1){let s=0;for(r=r||ie.decodedString();;){if(1===n){for(;t.isCont()&&(s=t.head(),po.isFragmentChar(s));)t=t.step(),r=r.write(s);if(t.isCont()&&37===s)t=t.step(),n=2;else if(!t.isEmpty())return jt.done(e.fragment(r.bind()))}if(2===n)if(t.isCont()&&(s=t.head(),te.isDigit(s)))t=t.step(),i=s,n=3;else if(!t.isEmpty())return jt.error(Et.expected("hex digit",t));if(3===n){if(t.isCont()&&(s=t.head(),te.isDigit(s))){t=t.step(),r=r.write(te.decodeDigit(i)<<4|te.decodeDigit(s)),i=0,n=1;continue}if(!t.isEmpty())return jt.error(Et.expected("hex digit",t))}break}return new Yo(e,r,i,n)}}class Go extends Error{constructor(t){super(t),Object.setPrototypeOf(this,Go.prototype)}}class _o{isDefined(){return isFinite(this.value)}plus(t,e=this.units,r){return t=_o.fromAny(t),_o.create(this.toValue(e,r)+t.toValue(e,r),e)}negative(t=this.units,e){return _o.create(-this.toValue(t,e),t)}minus(t,e=this.units,r){return t=_o.fromAny(t),_o.create(this.toValue(e,r)-t.toValue(e,r),e)}times(t,e=this.units,r){return _o.create(this.toValue(e,r)*t,e)}divide(t,e=this.units,r){return _o.create(this.toValue(e,r)/t,e)}combine(t,e=1,r=this.units,i){return t=_o.fromAny(t),_o.create(this.toValue(r,i)+t.toValue(r,i)*e,r)}emValue(t){return 0!==this.value?this.pxValue(t)/_o.emUnit(t):0}remValue(t){return 0!==this.value?this.pxValue(t)/_o.remUnit(t):0}pctValue(t){return 0!==this.value?this.pxValue(t)/_o.pctUnit(t):0}px(t){return _o.px(this.pxValue(t))}em(t){return _o.em(this.emValue(t))}rem(t){return _o.rem(this.remValue(t))}pct(t){return _o.pct(this.pctValue(t))}toValue(t,e){if(void 0===t)return Sr.from(this.toString());switch(t){case"px":return this.pxValue(e);case"em":return this.emValue(e);case"rem":return this.remValue(e);case"%":return this.pctValue(e);default:throw new Go("unknown length units: "+t)}}to(t,e){switch(t){case"px":return this.px(e);case"em":return this.em(e);case"rem":return this.rem(e);case"%":return this.pct(e);default:throw new Go("unknown length units: "+t)}}interpolateTo(t){return t instanceof _o?ea(this,t):null}static zero(t){switch(t){case void 0:case"px":return Qo.zero();case"em":return Zo.zero();case"rem":return Jo.zero();case"%":return $o.zero();case"":return ta.zero();default:throw new Go("unknown length units: "+t)}}static px(t){return new Qo(t)}static em(t){return new Zo(t)}static rem(t){return new Jo(t)}static pct(t){return new $o(t)}static unitless(t){return new ta(t)}static create(t,e){switch(e){case void 0:case"px":return _o.px(t);case"em":return _o.em(t);case"rem":return _o.rem(t);case"%":return _o.pct(t);case"":return _o.unitless(t);default:throw new Go("unknown length units: "+e)}}static fromCssValue(t){if(t instanceof CSSUnitValue)return _o.create(t.value,t.unit);throw new TypeError(""+t)}static fromAny(t,e){if(null==t||t instanceof _o)return t;if("number"==typeof t)return _o.create(t,e);if("string"==typeof t)return _o.parse(t,e);throw new TypeError(""+t)}static fromValue(t){if(2===t.length){const e=t.getItem(0).numberValue(void 0),r=t.getItem(1);if(void 0!==e&&isFinite(e)&&r instanceof dr&&r.value===yr.extant())switch(r.key.value){case"px":return _o.px(e);case"em":return _o.em(e);case"rem":return _o.rem(e);case"pct":return _o.pct(e)}}return null}static parse(t,e){let r=Ct.stringInput(t);for(;r.isCont()&&Ct.isWhitespace(r.head());)r=r.step();let i=ia.parse(r,e);if(i.isDone())for(;r.isCont()&&Ct.isWhitespace(r.head());)r=r.step();return r.isCont()&&!i.isError()&&(i=jt.error(Et.unexpected(r))),i.bind()}static form(){return new ra(void 0,_o.zero())}static isAny(t){return t instanceof _o||"number"==typeof t||"string"==typeof t}static emUnit(t){if("object"==typeof t&&"number"==typeof t.emUnit)return t.emUnit;if("object"==typeof t&&t.emUnit instanceof Node){let e=t.emUnit;for(;null!==e;){if(e instanceof Element){const t=getComputedStyle(e).fontSize;if("string"==typeof t)return parseFloat(t)}e=e.parentNode}}throw new Go("unknown em unit")}static remUnit(t){if("object"==typeof t&&"number"==typeof t.remUnit)return t.remUnit;{const t=getComputedStyle(document.documentElement).fontSize;if("string"==typeof t)return parseFloat(t)}throw new Go("unknown rem unit")}static pctUnit(t){if("number"==typeof t)return t;if("object"==typeof t&&"number"==typeof t.pctUnit)return t.pctUnit;throw new Go("unknown percentage unit")}}e([s],_o,"form",null);class Qo extends _o{constructor(t){super(),this.value=t}get units(){return"px"}pxValue(t){return this.value}px(t){return this}toCssValue(){return"undefined"!=typeof CSSUnitValue?new CSSUnitValue(this.value,"px"):null}compareTo(t){if(t instanceof _o){const e=this.value,r=t.pxValue();return e<r?-1:e>r?1:isNaN(r)?isNaN(e)?0:-1:isNaN(e)?1:0}return NaN}equivalentTo(t,e){return t instanceof _o&&h.equivalent(this.value,t.pxValue())}equals(t){return t instanceof Qo&&this.value===t.value}hashCode(){return n.mash(n.mix(p.hash(Qo),h.hash(this.value)))}debug(t){return t=t.write("Length").write(46).write("px").write(40).debug(this.value).write(41)}toString(){return this.value+"px"}static zero(){return new Qo(0)}}e([s],Qo,"zero",null);class Zo extends _o{constructor(t){super(),this.value=t}get units(){return"em"}pxValue(t){return 0!==this.value?this.value*_o.emUnit(t):0}emValue(t){return this.value}em(t){return this}toCssValue(){return"undefined"!=typeof CSSUnitValue?new CSSUnitValue(this.value,"em"):null}compareTo(t){if(t instanceof _o){const e=this.value,r=t.emValue();return e<r?-1:e>r?1:isNaN(r)?isNaN(e)?0:-1:isNaN(e)?1:0}return NaN}equivalentTo(t,e){return t instanceof _o&&h.equivalent(this.value,t.emValue())}equals(t){return t instanceof Zo&&this.value===t.value}hashCode(){return n.mash(n.mix(p.hash(Zo),h.hash(this.value)))}debug(t){return t=t.write("Length").write(46).write("em").write(40).debug(this.value).write(41)}toString(){return this.value+"em"}static zero(){return new Zo(0)}}e([s],Zo,"zero",null);class Jo extends _o{constructor(t){super(),this.value=t}get units(){return"rem"}pxValue(t){return 0!==this.value?this.value*_o.remUnit(t):0}remValue(t){return this.value}rem(t){return this}toCssValue(){return"undefined"!=typeof CSSUnitValue?new CSSUnitValue(this.value,"rem"):null}compareTo(t){if(t instanceof Jo){const e=this.value,r=t.remValue();return e<r?-1:e>r?1:isNaN(r)?isNaN(e)?0:-1:isNaN(e)?1:0}return NaN}equivalentTo(t,e){return t instanceof Jo&&h.equivalent(this.value,t.remValue())}equals(t){return t instanceof Jo&&this.value===t.value}hashCode(){return n.mash(n.mix(p.hash(Jo),h.hash(this.value)))}debug(t){return t=t.write("Length").write(46).write("rem").write(40).debug(this.value).write(41)}toString(){return this.value+"rem"}static zero(){return new Jo(0)}}e([s],Jo,"zero",null);class $o extends _o{constructor(t){super(),this.value=t}get units(){return"%"}pxValue(t){return 0!==this.value?this.value*_o.pctUnit(t)/100:0}pctValue(t){return this.value}pct(t){return this}toCssValue(){return"undefined"!=typeof CSSUnitValue?new CSSUnitValue(this.value,"percent"):null}compareTo(t){if(t instanceof _o){const e=this.value,r=t.pctValue();return e<r?-1:e>r?1:isNaN(r)?isNaN(e)?0:-1:isNaN(e)?1:0}return NaN}equivalentTo(t,e){return t instanceof _o&&h.equivalent(this.value,t.pctValue())}equals(t){return t instanceof $o&&this.value===t.value}hashCode(){return n.mash(n.mix(p.hash($o),h.hash(this.value)))}debug(t){return t=t.write("Length").write(46).write("pct").write(40).debug(this.value).write(41)}toString(){return this.value+"%"}static zero(){return new $o(0)}}e([s],$o,"zero",null);class ta extends _o{constructor(t){super(),this.value=t}get units(){return""}pxValue(t){throw new Go("unitless length")}toCssValue(){return null}compareTo(t){if(t instanceof _o){const e=this.value,r=t.value;return e<r?-1:e>r?1:isNaN(r)?isNaN(e)?0:-1:isNaN(e)?1:0}return NaN}equivalentTo(t,e){return t instanceof _o&&h.equivalent(this.value,t.value)}equals(t){return t instanceof ta&&this.value===t.value}hashCode(){return n.mash(n.mix(p.hash(ta),h.hash(this.value)))}debug(t){return t=t.write("Length").write(46).write("unitless").write(40).debug(this.value).write(41)}toString(){return this.value+""}static zero(){return new ta(0)}}e([s],ta,"zero",null);const ea=function(t){const e=function(t,r){const i=function(t){const e=i[0],r=i[1];return _o.create(e.value+t*(r.value-e.value),r.units)};return Object.setPrototypeOf(i,e.prototype),i[0]=t.to(r.units),i[1]=r,i};return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e}(k);class ra extends ki{constructor(t,e){super(),this.defaultUnits=t,Object.defineProperty(this,"unit",{value:e,enumerable:!0})}withUnit(t){return t!==this.unit?new ra(this.defaultUnits,t):this}mold(t){return t=_o.fromAny(t,this.defaultUnits),Sr.from(t.toString())}cast(t){const e=t.toValue();let r=null;try{if(r=_o.fromValue(e),void 0!==r){const t=e.stringValue(void 0);void 0!==t&&(r=_o.parse(t,this.defaultUnits))}}catch(t){}return null!==r?r:void 0}}class ia extends jt{constructor(t,e,r,i){super(),this.defaultUnits=t,this.valueParser=e,this.unitsOutput=r,this.step=i}feed(t){return ia.parse(t,this.defaultUnits,this.valueParser,this.unitsOutput,this.step)}static parse(t,e,r,i,n=1){let s=0;if(1===n)if((r=void 0===r?St.parseDecimal(t):r.feed(t)).isDone())n=2;else if(r.isError())return r.asError();if(2===n){for(i=i||Ct.stringOutput();t.isCont()&&(s=t.head(),Ct.isAlpha(s)||37===s);)t=t.step(),i.push(s);if(!t.isEmpty()){const n=r.bind(),s=i.bind()||e;switch(s){case"px":return jt.done(_o.px(n));case"em":return jt.done(_o.em(n));case"rem":return jt.done(_o.rem(n));case"%":return jt.done(_o.pct(n));case"":case void 0:return jt.done(_o.unitless(n));default:return jt.error(Et.message("unknown length units: "+s,t))}}}return new ia(e,r,i,n)}}class na{isDefined(){return isFinite(this.value)}plus(t,e=this.units){return t=na.fromAny(t),na.create(this.toValue(e)+t.toValue(e),e)}negative(t=this.units){return na.create(-this.toValue(t),t)}minus(t,e=this.units){return t=na.fromAny(t),na.create(this.toValue(e)-t.toValue(e),e)}times(t,e=this.units){return na.create(this.toValue(e)*t,e)}divide(t,e=this.units){return na.create(this.toValue(e)/t,e)}combine(t,e=1,r=this.units){return t=na.fromAny(t),na.create(this.toValue(r)+t.toValue(r)*e,r)}norm(t,e=this.units){return t=na.fromAny(t),na.create(this.toValue(e)/t.toValue(e),e)}deg(){return na.deg(this.degValue())}rad(){return na.rad(this.radValue())}grad(){return na.grad(this.gradValue())}turn(){return na.turn(this.turnValue())}toValue(t){if(void 0===t)return Sr.from(this.toString());switch(t){case"deg":return this.degValue();case"rad":return this.radValue();case"grad":return this.gradValue();case"turn":return this.turnValue();default:throw new Error("unknown angle units: "+t)}}to(t){switch(t){case"deg":return this.deg();case"rad":return this.rad();case"grad":return this.grad();case"turn":return this.turn();default:throw new Error("unknown angle units: "+t)}}interpolateTo(t){return t instanceof na?ha(this,t):null}static zero(t){switch(t){case"deg":return sa.zero();case void 0:case"rad":return oa.zero();case"grad":return aa.zero();case"turn":return ua.zero();default:throw new Error("unknown angle units: "+t)}}static deg(t){return new sa(t)}static rad(t){return new oa(t)}static grad(t){return new aa(t)}static turn(t){return new ua(t)}static create(t,e){switch(e){case"deg":return na.deg(t);case void 0:case"rad":return na.rad(t);case"grad":return na.grad(t);case"turn":return na.turn(t);default:throw new Error("unknown angle units: "+e)}}static fromCssValue(t){if(t instanceof CSSUnitValue)return na.create(t.value,t.unit);throw new TypeError(""+t)}static fromAny(t,e){if(null==t||t instanceof na)return t;if("number"==typeof t)return na.create(t,e);if("string"==typeof t)return na.parse(t,e);throw new TypeError(""+t)}static fromValue(t){if(2===t.length){const e=t.getItem(0).numberValue(),r=t.getItem(1);if(void 0!==e&&isFinite(e)&&r instanceof dr&&r.toValue()===yr.extant())switch(r.key.value){case"deg":return na.deg(e);case"rad":return na.rad(e);case"grad":return na.grad(e);case"turn":return na.turn(e)}}return null}static parse(t,e){let r=Ct.stringInput(t);for(;r.isCont()&&Ct.isWhitespace(r.head());)r=r.step();let i=ca.parse(r,e);if(i.isDone())for(;r.isCont()&&Ct.isWhitespace(r.head());)r=r.step();return r.isCont()&&!i.isError()&&(i=jt.error(Et.unexpected(r))),i.bind()}static form(){return new la(void 0,na.zero())}static isAny(t){return t instanceof na||"number"==typeof t||"string"==typeof t}}e([s],na,"form",null);class sa extends na{constructor(t){super(),this.value=t}get units(){return"deg"}degValue(){return this.value}gradValue(){return 10*this.value/9}radValue(){return this.value*Math.PI/180}turnValue(){return this.value/360}deg(){return this}toCssValue(){return"undefined"!=typeof CSSUnitValue?new CSSUnitValue(this.value,"deg"):null}compareTo(t){if(t instanceof na){const e=this.value,r=t.degValue();return e<r?-1:e>r?1:isNaN(r)?isNaN(e)?0:-1:isNaN(e)?1:0}return NaN}equivalentTo(t,e){return t instanceof na&&h.equivalent(this.value,t.degValue())}equals(t){return t instanceof sa&&this.value===t.value}hashCode(){return n.mash(n.mix(p.hash(sa),h.hash(this.value)))}debug(t){return t=t.write("Angle").write(46).write("deg").write(40).debug(this.value).write(41)}toString(){return this.value+"deg"}static zero(){return new sa(0)}}e([s],sa,"zero",null);class oa extends na{constructor(t){super(),this.value=t}get units(){return"rad"}degValue(){return 180*this.value/Math.PI}gradValue(){return 200*this.value/Math.PI}radValue(){return this.value}turnValue(){return this.value/(2*Math.PI)}rad(){return this}toCssValue(){return"undefined"!=typeof CSSUnitValue?new CSSUnitValue(this.value,"rad"):null}compareTo(t){if(t instanceof na){const e=this.value,r=t.radValue();return e<r?-1:e>r?1:isNaN(r)?isNaN(e)?0:-1:isNaN(e)?1:0}return NaN}equivalentTo(t,e){return t instanceof na&&h.equivalent(this.value,t.radValue())}equals(t){return t instanceof oa&&this.value===t.value}hashCode(){return n.mash(n.mix(p.hash(oa),h.hash(this.value)))}debug(t){return t=t.write("Angle").write(46).write("rad").write(40).debug(this.value).write(41)}toString(){return this.value+"rad"}static zero(){return new oa(0)}}e([s],oa,"zero",null);class aa extends na{constructor(t){super(),this.value=t}get units(){return"grad"}degValue(){return.9*this.value}gradValue(){return this.value}radValue(){return this.value*Math.PI/200}turnValue(){return this.value/400}grad(){return this}toCssValue(){return"undefined"!=typeof CSSUnitValue?new CSSUnitValue(this.value,"grad"):null}compareTo(t){if(t instanceof na){const e=this.value,r=t.gradValue();return e<r?-1:e>r?1:isNaN(r)?isNaN(e)?0:-1:isNaN(e)?1:0}return NaN}equivalentTo(t,e){return t instanceof na&&h.equivalent(this.value,t.gradValue())}equals(t){return t instanceof aa&&this.value===t.value}hashCode(){return n.mash(n.mix(p.hash(aa),h.hash(this.value)))}debug(t){return t=t.write("Angle").write(46).write("grad").write(40).debug(this.value).write(41)}toString(){return this.value+"grad"}static zero(){return new aa(0)}}e([s],aa,"zero",null);class ua extends na{constructor(t){super(),this.value=t}get units(){return"turn"}degValue(){return 360*this.value}gradValue(){return 400*this.value}radValue(){return this.value*(2*Math.PI)}turnValue(){return this.value}turn(){return this}toCssValue(){return"undefined"!=typeof CSSUnitValue?new CSSUnitValue(this.value,"turn"):null}compareTo(t){if(t instanceof na){const e=this.value,r=t.turnValue();return e<r?-1:e>r?1:isNaN(r)?isNaN(e)?0:-1:isNaN(e)?1:0}return NaN}equivalentTo(t,e){return t instanceof na&&h.equivalent(this.value,t.turnValue())}equals(t){return t instanceof ua&&this.value===t.value}hashCode(){return n.mash(n.mix(p.hash(ua),h.hash(this.value)))}debug(t){return t=t.write("Angle").write(46).write("turn").write(40).debug(this.value).write(41)}toString(){return this.value+"turn"}static zero(){return new ua(0)}}e([s],ua,"zero",null);const ha=function(t){const e=function(t,r){const i=function(t){const e=i[0],r=i[1];return na.create(e.value+t*(r.value-e.value),r.units)};return Object.setPrototypeOf(i,e.prototype),i[0]=t.to(r.units),i[1]=r,i};return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e}(k);class la extends ki{constructor(t,e){super(),this.defaultUnits=t,Object.defineProperty(this,"unit",{value:e,enumerable:!0})}withUnit(t){return t!==this.unit?new la(this.defaultUnits,t):this}mold(t){return t=na.fromAny(t,this.defaultUnits),Sr.from(t.toString())}cast(t){const e=t.toValue();let r=null;try{if(r=na.fromValue(e),void 0===r){const t=e.stringValue(void 0);void 0!==t&&(r=na.parse(t,this.defaultUnits))}}catch(t){}return null!==r?r:void 0}}class ca extends jt{constructor(t,e,r,i){super(),this.defaultUnits=t,this.valueParser=e,this.unitsOutput=r,this.step=i}feed(t){return ca.parse(t,this.defaultUnits,this.valueParser,this.unitsOutput,this.step)}static parse(t,e,r,i,n=1){let s=0;if(1===n)if((r=void 0===r?St.parseDecimal(t):r.feed(t)).isDone())n=2;else if(r.isError())return r.asError();if(2===n){for(i=i||Ct.stringOutput();t.isCont()&&(s=t.head(),Ct.isAlpha(s));)t=t.step(),i.push(s);if(!t.isEmpty()){const n=r.bind(),s=i.bind()||e;switch(s){case"deg":return jt.done(na.deg(n));case"":case"rad":return jt.done(na.rad(n));case"grad":return jt.done(na.grad(n));case"turn":return jt.done(na.turn(n));default:return jt.error(Et.message("unknown units: "+s,t))}}}return new ca(e,r,i,n)}}class da{constructor(t,e){this.x=t,this.y=e}isDefined(){return isFinite(this.x)&&isFinite(this.y)}plus(t){return new da(this.x+t.x,this.y+t.y)}negative(){return new da(-this.x,-this.y)}minus(t){return new da(this.x-t.x,this.y-t.y)}times(t){return new da(this.x*t,this.y*t)}toAny(){return{x:this.x,y:this.y}}interpolateTo(t){return t instanceof da?pa(this,t):null}equivalentTo(t,e){return this===t||t instanceof da&&(h.equivalent(this.x,t.x,e)&&h.equivalent(this.y,t.y,e))}equals(t){return this===t||t instanceof da&&(this.x===t.x&&this.y===t.y)}hashCode(){return n.mash(n.mix(n.mix(p.hash(da),h.hash(this.x)),h.hash(this.y)))}debug(t){return t=t.write("R2Vector").write(46).write("of").write(40).debug(this.x).write(", ").debug(this.y).write(41)}toString(){return Ot.debug(this)}static zero(){return new da(0,0)}static of(t,e){return new da(t,e)}static fromInit(t){return new da(t.x,t.y)}static fromAny(t){if(null==t||t instanceof da)return t;if(da.isInit(t))return da.fromInit(t);throw new TypeError(""+t)}static isInit(t){if("object"==typeof t&&null!==t){const e=t;return"number"==typeof e.x&&"number"==typeof e.y}return!1}static isAny(t){return t instanceof da||da.isInit(t)}}e([s],da,"zero",null);const pa=function(t){const e=function(t,r){const i=function(t){const e=i[0],r=i[1],n=e.x+t*(r.x-e.x),s=e.y+t*(r.y-e.y);return new da(n,s)};return Object.setPrototypeOf(i,e.prototype),i[0]=t,i[1]=r,i};return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e}(k);class fa{union(t){return t=fa.fromAny(t),new Ua(Math.min(this.xMin,t.xMin),Math.min(this.yMin,t.yMin),Math.max(this.xMax,t.xMax),Math.max(this.yMax,t.yMax))}get bounds(){return new Ua(this.xMin,this.yMin,this.xMax,this.yMax)}static fromAny(t){if(null==t||t instanceof fa)return t;if(ya.isInit(t))return ya.fromInit(t);if(ya.isTuple(t))return ya.fromTuple(t);if(ba.isInit(t))return ba.fromInit(t);if(Ua.isInit(t))return Ua.fromInit(t);if(qa.isInit(t))return qa.fromInit(t);throw new TypeError(""+t)}static isAny(t){return t instanceof fa||ya.isInit(t)||ya.isTuple(t)||ba.isInit(t)||Ua.isInit(t)||qa.isInit(t)}}class ya extends fa{constructor(t,e){super(),this.x=t,this.y=e}isDefined(){return isFinite(this.x)&&isFinite(this.y)}get xMin(){return this.x}get yMin(){return this.y}get xMax(){return this.x}get yMax(){return this.y}plus(t){return new ya(this.x+t.x,this.y+t.y)}minus(t){return t instanceof da?new ya(this.x-t.x,this.y-t.y):new da(this.x-t.x,this.y-t.y)}contains(t,e){return"number"==typeof t?this.x===t&&this.y===e:(t=fa.fromAny(t))instanceof ya?this.x===t.x&&this.y===t.y:t instanceof fa&&(this.x<=t.xMin&&t.xMax<=this.x&&this.y<=t.yMin&&t.yMax<=this.y)}intersects(t){return(t=fa.fromAny(t)).intersects(this)}transform(t){return new ya(t.transformX(this.x,this.y),t.transformY(this.x,this.y))}toAny(){return{x:this.x,y:this.y}}interpolateTo(t){return t instanceof ya?ma(this,t):null}equivalentTo(t,e){return this===t||t instanceof ya&&(h.equivalent(this.x,t.x,e)&&h.equivalent(this.y,t.y,e))}equals(t){return this===t||t instanceof ya&&(this.x===t.x&&this.y===t.y)}hashCode(){return n.mash(n.mix(n.mix(p.hash(ya),h.hash(this.x)),h.hash(this.y)))}debug(t){return t=t.write("R2Point").write(46).write("of").write(40).debug(this.x).write(", ").debug(this.y).write(41)}toString(){return Ot.debug(this)}static origin(){return new ya(0,0)}static undefined(){return new ya(NaN,NaN)}static of(t,e){return new ya(t,e)}static fromInit(t){return new ya(t.x,t.y)}static fromTuple(t){return new ya(t[0],t[1])}static fromAny(t){if(null==t||t instanceof ya)return t;if(ya.isInit(t))return ya.fromInit(t);if(ya.isTuple(t))return ya.fromTuple(t);throw new TypeError(""+t)}static isInit(t){if("object"==typeof t&&null!==t){const e=t;return"number"==typeof e.x&&"number"==typeof e.y}return!1}static isTuple(t){return Array.isArray(t)&&2===t.length&&"number"==typeof t[0]&&"number"==typeof t[1]}static isAny(t){return t instanceof ya||ya.isInit(t)||ya.isTuple(t)}}e([s],ya,"origin",null),e([s],ya,"undefined",null);const ma=function(t){const e=function(t,r){const i=function(t){const e=i[0],r=i[1],n=e.x+t*(r.x-e.x),s=e.y+t*(r.y-e.y);return new ya(n,s)};return Object.setPrototypeOf(i,e.prototype),i[0]=t,i[1]=r,i};return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e}(k);class wa extends fa{draw(t){this.drawMove(t),this.drawRest(t)}transformDraw(t,e){this.transformDrawMove(t,e),this.transformDrawRest(t,e)}writePath(t){return t=this.writeMove(t),t=this.writeRest(t)}toPathString(t){let e=Ct.stringOutput(t);return e=this.writePath(e),e.toString()}static linear(t,e,r,i){return new ba(t,e,r,i)}static quadratic(t,e,r,i,n,s){return new Oa(t,e,r,i,n,s)}static cubic(t,e,r,i,n,s,o,a){return new Ea(t,e,r,i,n,s,o,a)}static elliptic(t,e,r,i,n,s,o){return new Aa(t,e,r,i,n,s,o)}static parse(t){let e=Ct.stringInput(t);for(;e.isCont()&&Ct.isWhitespace(e.head());)e=e.step();let r=ga.parse(e);if(r.isDone())for(;e.isCont()&&Ct.isWhitespace(e.head());)e=e.step();return e.isCont()&&!r.isError()&&(r=jt.error(Et.unexpected(e))),r.bind()}}class ga extends jt{constructor(t,e,r,i){super(),this.x0Parser=t,this.y0Parser=e,this.command=r,this.step=i}feed(t){return ga.parse(t,this.x0Parser,this.y0Parser,this.command,this.step)}static parse(t,e,r,i,n=1){let s=0;if(1===n){for(;t.isCont()&&(s=t.head(),Ct.isSpace(s));)t=t.step();if(t.isCont()){if(77!==s&&109!==s)return jt.error(Et.expected("moveto",t));t=t.step(),i=s,n=2}else if(!t.isEmpty())return jt.error(Et.unexpected(t))}if(2===n){if(void 0===e){for(;t.isCont()&&Ct.isSpace(t.head());)t=t.step();t.isEmpty()||(e=St.parseDecimal(t))}else e=e.feed(t);if(void 0!==e)if(e.isDone())n=3;else if(e.isError())return e.asError()}if(3===n){for(;t.isCont()&&(s=t.head(),Ct.isSpace(s));)t=t.step();t.isCont()?(44===s&&(t=t.step()),n=4):t.isEmpty()||(n=4)}if(4===n){if(void 0===r){for(;t.isCont()&&Ct.isSpace(t.head());)t=t.step();t.isEmpty()||(r=St.parseDecimal(t))}else r=r.feed(t);if(void 0!==r)if(r.isDone())n=5;else if(r.isError())return r.asError()}if(5===n){for(;t.isCont()&&(s=t.head(),Ct.isSpace(s));)t=t.step();if(t.isCont())switch(s){case 76:case 108:case 72:case 104:case 86:case 118:return Ca.parse(t,e,r);case 81:case 113:return Sa.parse(t,e,r);case 84:return Sa.parse(t,e,r,e,r);case 116:return Sa.parse(t,e,r,jt.done(0),jt.done(0));case 67:case 99:return ka.parse(t,e,r);case 83:return ka.parse(t,e,r,e,r);case 115:return ka.parse(t,e,r,jt.done(0),jt.done(0));case 65:case 97:return Ma.parse(t,e,r);case 44:t=t.step();case 43:case 45:case 46:case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:switch(i){case 77:case 109:return Ca.parseRest(t,i,e,r)}default:return jt.error(Et.expected("draw command",t))}else if(!t.isEmpty())return jt.error(Et.unexpected(t))}return new ga(e,r,i,n)}}class va extends wa{}class ba extends va{constructor(t,e,r,i){super(),this.x0=t,this.y0=e,this.x1=r,this.y1=i}isDefined(){return isFinite(this.x0)&&isFinite(this.y0)&&isFinite(this.x1)&&isFinite(this.y1)}get xMin(){return Math.min(this.x0,this.x1)}get yMin(){return Math.min(this.y0,this.y1)}get xMax(){return Math.max(this.x0,this.x1)}get yMax(){return Math.max(this.y0,this.y1)}interpolateX(t){return(1-t)*this.x0+t*this.x1}interpolateY(t){return(1-t)*this.y0+t*this.y1}interpolate(t){const e=1-t,r=e*this.x0+t*this.x1,i=e*this.y0+t*this.y1;return new ya(r,i)}contains(t,e){return"number"==typeof t?ba.contains(this.x0,this.y0,this.x1,this.y1,t,e):(t=fa.fromAny(t))instanceof ya?this.containsPoint(t):t instanceof ba&&this.containsSegment(t)}containsPoint(t){return ba.contains(this.x0,this.y0,this.x1,this.y1,t.x,t.y)}containsSegment(t){return ba.contains(this.x0,this.y0,this.x1,this.y1,t.x0,t.y0)&&ba.contains(this.x0,this.y0,this.x1,this.y1,t.x1,t.y1)}static contains(t,e,r,i,n,s){return(t<=n&&n<=r||r<=n&&n<=t)&&(e<=s&&s<=i||i<=s&&s<=e)&&(r-t)*(s-e)==(n-t)*(i-e)}intersects(t){return(t=fa.fromAny(t))instanceof ya?this.intersectsPoint(t):t instanceof ba?this.intersectsSegment(t):t.intersects(this)}intersectsPoint(t){return ba.contains(this.x0,this.y0,this.x1,this.y1,t.x,t.y)}intersectsSegment(t){return ba.intersects(this.x0,this.y0,this.x1-this.x0,this.y1-this.y0,t.x0,t.y0,t.x1-t.x0,t.y1-t.y0)}static intersects(t,e,r,i,n,s,o,a){const u=n-t,h=s-e,l=u*i-h*r,c=r*a-i*o;if(0===l&&0===c){const t=r*r+i*i,e=o*r+a*i,n=(u*r+h*i)/t,s=n+e/t;return e>=0?0<s&&n<1:0<n&&s<1}if(0===c)return!1;{const t=(u*a-h*o)/c,e=l/c;return 0<=t&&t<=1&&0<=e&&e<=1}}split(t){const e=1-t,r=e*this.x0+t*this.x1,i=e*this.y0+t*this.y1;return[new ba(this.x0,this.y0,r,i),new ba(r,i,this.x1,this.y1)]}transform(t){return new ba(t.transformX(this.x0,this.y0),t.transformY(this.x0,this.y0),t.transformX(this.x1,this.y1),t.transformY(this.x1,this.y1))}toAny(){return{x0:this.x0,y0:this.y0,x1:this.x1,y1:this.y1}}drawMove(t){t.moveTo(this.x0,this.y0)}drawRest(t){t.lineTo(this.x1,this.y1)}transformDrawMove(t,e){t.moveTo(e.transformX(this.x0,this.y0),e.transformY(this.x0,this.y0))}transformDrawRest(t,e){t.lineTo(e.transformX(this.x1,this.y1),e.transformY(this.x1,this.y1))}writeMove(t){return t=t.write(77),t=(t=Ot.displayNumber(t,this.x0)).write(44),t=Ot.displayNumber(t,this.y0)}writeRest(t){return t=t.write(76),t=(t=Ot.displayNumber(t,this.x1)).write(44),t=Ot.displayNumber(t,this.y1)}interpolateTo(t){return t instanceof ba?xa(this,t):null}equivalentTo(t,e){return this===t||t instanceof ba&&(h.equivalent(this.x0,t.x0,e)&&h.equivalent(this.y0,t.y0,e)&&h.equivalent(this.x1,t.x1,e)&&h.equivalent(this.y1,t.y1,e))}equals(t){return this===t||t instanceof ba&&(this.x0===t.x0&&this.y0===t.y0&&this.x1===t.x1&&this.y1===t.y1)}hashCode(){return n.mash(n.mix(n.mix(n.mix(n.mix(p.hash(ba),h.hash(this.x0)),h.hash(this.y0)),h.hash(this.x1)),h.hash(this.y1)))}debug(t){return t=t.write("R2Segment").write(46).write("of").write(40).debug(this.x0).write(", ").debug(this.y0).write(", ").debug(this.x1).write(", ").debug(this.y1).write(41)}toString(){return Ot.debug(this)}static of(t,e,r,i){return new ba(t,e,r,i)}static fromInit(t){return new ba(t.x0,t.y0,t.x1,t.y1)}static fromAny(t){if(null==t||t instanceof ba)return t;if(ba.isInit(t))return ba.fromInit(t);throw new TypeError(""+t)}static isInit(t){if("object"==typeof t&&null!==t){const e=t;return"number"==typeof e.x0&&"number"==typeof e.y0&&"number"==typeof e.x1&&"number"==typeof e.y1}return!1}static isAny(t){return t instanceof ba||ba.isInit(t)}}const xa=function(t){const e=function(t,r){const i=function(t){const e=i[0],r=i[1],n=e.x0+t*(r.x0-e.x0),s=e.y0+t*(r.y0-e.y0),o=e.x1+t*(r.x1-e.x1),a=e.y1+t*(r.y1-e.y1);return new ba(n,s,o,a)};return Object.setPrototypeOf(i,e.prototype),i[0]=t,i[1]=r,i};return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e}(k);class Ca extends jt{constructor(t,e,r,i,n,s){super(),this.x0Parser=t,this.y0Parser=e,this.x1Parser=r,this.y1Parser=i,this.command=n,this.step=s}feed(t){return Ca.parse(t,this.x0Parser,this.y0Parser,this.x1Parser,this.y1Parser,this.command,this.step)}static parse(t,e,r,i,n,s,o=1){let a=0;if(1===o){for(;t.isCont()&&(a=t.head(),Ct.isSpace(a));)t=t.step();if(t.isCont())switch(a){case 77:case 109:case 76:case 108:t=t.step(),s=a,o=2;break;case 72:t=t.step(),n=r,s=a,o=2;break;case 104:t=t.step(),n=jt.done(0),s=a,o=2;break;case 86:t=t.step(),i=e,s=a,o=4;break;case 118:t=t.step(),i=jt.done(0),s=a,o=4;break;default:return jt.error(Et.expected("lineto",t))}else if(!t.isEmpty())return jt.error(Et.unexpected(t))}if(2===o){if(void 0===i){for(;t.isCont()&&Ct.isSpace(t.head());)t=t.step();t.isEmpty()||(i=St.parseDecimal(t))}else i=i.feed(t);if(void 0!==i)if(i.isDone())o=void 0!==n&&n.isDone()?4:3;else if(i.isError())return i.asError()}if(3===o){for(;t.isCont()&&(a=t.head(),Ct.isSpace(a));)t=t.step();t.isCont()?(44===a&&(t=t.step()),o=4):t.isEmpty()||(o=4)}if(4===o){if(void 0===n){for(;t.isCont()&&Ct.isSpace(t.head());)t=t.step();t.isEmpty()||(n=St.parseDecimal(t))}else n=n.feed(t);if(void 0!==n){if(n.isDone()){const t=e.bind(),o=r.bind();let a=i.bind(),u=n.bind();return 109!==s&&108!==s&&104!==s&&118!==s||(a+=t,u+=o),jt.done(new ba(t,o,a,u))}if(n.isError())return n.asError()}}return new Ca(e,r,i,n,s,o)}static parseRest(t,e,r,i){let n,s,o;switch(e){case 72:s=i,o=2;break;case 104:s=jt.done(0),o=2;break;case 86:n=r,o=4;break;case 118:n=jt.done(0),o=4;break;default:o=2}return this.parse(t,r,i,n,s,e,o)}}class Oa extends va{constructor(t,e,r,i,n,s){super(),this.x0=t,this.y0=e,this.x1=r,this.y1=i,this.x2=n,this.y2=s}isDefined(){return isFinite(this.x0)&&isFinite(this.y0)&&isFinite(this.x1)&&isFinite(this.y1)&&isFinite(this.x2)&&isFinite(this.y2)}get xMin(){return Math.min(this.x0,this.x1,this.x2)}get yMin(){return Math.min(this.y0,this.y1,this.y2)}get xMax(){return Math.max(this.x0,this.x1,this.x2)}get yMax(){return Math.max(this.y0,this.y1,this.y2)}interpolateX(t){const e=1-t;return e*(e*this.x0+t*this.x1)+t*(e*this.x1+t*this.x2)}interpolateY(t){const e=1-t;return e*(e*this.y0+t*this.y1)+t*(e*this.y1+t*this.y2)}interpolate(t){const e=1-t,r=e*this.x0+t*this.x1,i=e*this.y0+t*this.y1,n=e*this.x1+t*this.x2,s=e*this.y1+t*this.y2;return new ya(e*r+t*n,e*i+t*s)}contains(t,e){return!1}intersects(t){return!1}split(t){const e=1-t,r=e*this.x0+t*this.x1,i=e*this.y0+t*this.y1,n=e*this.x1+t*this.x2,s=e*this.y1+t*this.y2,o=e*r+t*n,a=e*i+t*s;return[new Oa(this.x0,this.y0,r,i,o,a),new Oa(o,a,n,s,this.x2,this.y2)]}transform(t){return new Oa(t.transformX(this.x0,this.y0),t.transformY(this.x0,this.y0),t.transformX(this.x1,this.y1),t.transformY(this.x1,this.y1),t.transformX(this.x2,this.y2),t.transformY(this.x2,this.y2))}drawMove(t){t.moveTo(this.x0,this.y0)}drawRest(t){t.quadraticCurveTo(this.x1,this.y1,this.x2,this.y2)}transformDrawMove(t,e){t.moveTo(e.transformX(this.x0,this.y0),e.transformY(this.x0,this.y0))}transformDrawRest(t,e){t.quadraticCurveTo(e.transformX(this.x1,this.y1),e.transformY(this.x1,this.y1),e.transformX(this.x2,this.y2),e.transformY(this.x2,this.y2))}writeMove(t){return t=t.write(77),t=(t=Ot.displayNumber(t,this.x0)).write(44),t=Ot.displayNumber(t,this.y0)}writeRest(t){return t=t.write(81),t=(t=Ot.displayNumber(t,this.x1)).write(44),t=(t=Ot.displayNumber(t,this.y1)).write(44),t=(t=Ot.displayNumber(t,this.x2)).write(44),t=Ot.displayNumber(t,this.y2)}equivalentTo(t,e){return this===t||t instanceof Oa&&(h.equivalent(this.x0,t.x0,e)&&h.equivalent(this.y0,t.y0,e)&&h.equivalent(this.x1,t.x1,e)&&h.equivalent(this.y1,t.y1,e)&&h.equivalent(this.x2,t.x2,e)&&h.equivalent(this.y2,t.y2,e))}equals(t){return this===t||t instanceof Oa&&(this.x0===t.x0&&this.y0===t.y0&&this.x1===t.x1&&this.y1===t.y1&&this.x2===t.x2&&this.y2===t.y2)}debug(t){return t=t.write("R2Curve").write(46).write("quadratic").write(40).debug(this.x0).write(", ").debug(this.y0).write(", ").debug(this.x1).write(", ").debug(this.y1).write(", ").debug(this.x2).write(", ").debug(this.y2).write(41)}toString(){return Ot.debug(this)}}class Sa extends jt{constructor(t,e,r,i,n,s,o,a){super(),this.x0Parser=t,this.y0Parser=e,this.x1Parser=r,this.y1Parser=i,this.x2Parser=n,this.y2Parser=s,this.command=o,this.step=a}feed(t){return Sa.parse(t,this.x0Parser,this.y0Parser,this.x1Parser,this.y1Parser,this.x2Parser,this.y2Parser,this.command,this.step)}static parse(t,e,r,i,n,s,o,a,u=1){let h=0;if(1===u){for(;t.isCont()&&(h=t.head(),Ct.isSpace(h));)t=t.step();if(t.isCont())switch(h){case 81:case 113:t=t.step(),a=h,u=2;break;case 84:case 116:t=t.step(),a=h,u=6;break;default:return jt.error(Et.expected("curveto",t))}else if(!t.isEmpty())return jt.error(Et.unexpected(t))}if(2===u){if(void 0===i){for(;t.isCont()&&Ct.isSpace(t.head());)t=t.step();t.isEmpty()||(i=St.parseDecimal(t))}else i=i.feed(t);if(void 0!==i)if(i.isDone())u=3;else if(i.isError())return i.asError()}if(3===u){for(;t.isCont()&&(h=t.head(),Ct.isSpace(h));)t=t.step();t.isCont()?(44===h&&(t=t.step()),u=4):t.isEmpty()||(u=4)}if(4===u){if(void 0===n){for(;t.isCont()&&Ct.isSpace(t.head());)t=t.step();t.isEmpty()||(n=St.parseDecimal(t))}else n=n.feed(t);if(void 0!==n)if(n.isDone())u=5;else if(n.isError())return n.asError()}if(5===u){for(;t.isCont()&&(h=t.head(),Ct.isSpace(h));)t=t.step();t.isCont()?(44===h&&(t=t.step()),u=6):t.isEmpty()||(u=6)}if(6===u){if(void 0===s){for(;t.isCont()&&Ct.isSpace(t.head());)t=t.step();t.isEmpty()||(s=St.parseDecimal(t))}else s=s.feed(t);if(void 0!==s)if(s.isDone())u=7;else if(s.isError())return s.asError()}if(7===u){for(;t.isCont()&&(h=t.head(),Ct.isSpace(h));)t=t.step();t.isCont()?(44===h&&(t=t.step()),u=8):t.isEmpty()||(u=8)}if(8===u){if(void 0===o){for(;t.isCont()&&Ct.isSpace(t.head());)t=t.step();t.isEmpty()||(o=St.parseDecimal(t))}else o=o.feed(t);if(void 0!==o){if(o.isDone()){const t=e.bind(),u=r.bind();let h=i.bind(),l=n.bind(),c=s.bind(),d=o.bind();return 113!==a&&116!==a||(h+=t,l+=u,c+=t,d+=u),jt.done(new Oa(t,u,h,l,c,d))}if(o.isError())return o.asError()}}return new Sa(e,r,i,n,s,o,a,u)}static parseRest(t,e,r,i,n,s){const o=84===e||116===e?6:2;return Sa.parse(t,r,i,n,s,void 0,void 0,e,o)}}class Ea extends va{constructor(t,e,r,i,n,s,o,a){super(),this.x0=t,this.y0=e,this.x1=r,this.y1=i,this.x2=n,this.y2=s,this.x3=o,this.y3=a}isDefined(){return isFinite(this.x0)&&isFinite(this.y0)&&isFinite(this.x1)&&isFinite(this.y1)&&isFinite(this.x2)&&isFinite(this.y2)&&isFinite(this.x3)&&isFinite(this.y3)}get xMin(){return Math.min(this.x0,this.x1,this.x2,this.x3)}get yMin(){return Math.min(this.y0,this.y1,this.y2,this.y3)}get xMax(){return Math.max(this.x0,this.x1,this.x2,this.x3)}get yMax(){return Math.max(this.y0,this.y1,this.y2,this.y3)}interpolateX(t){const e=1-t,r=e*this.x0+t*this.x1,i=e*this.x1+t*this.x2;return e*(e*r+t*i)+t*(e*i+t*(e*this.x2+t*this.x3))}interpolateY(t){const e=1-t,r=e*this.y0+t*this.y1,i=e*this.y1+t*this.y2;return e*(e*r+t*i)+t*(e*i+t*(e*this.y2+t*this.y3))}interpolate(t){const e=1-t,r=e*this.x0+t*this.x1,i=e*this.y0+t*this.y1,n=e*this.x1+t*this.x2,s=e*this.y1+t*this.y2,o=e*this.x2+t*this.x3,a=e*this.y2+t*this.y3;return new ya(e*(e*r+t*n)+t*(e*n+t*o),e*(e*i+t*s)+t*(e*s+t*a))}contains(t,e){return!1}intersects(t){return!1}split(t){const e=1-t,r=e*this.x0+t*this.x1,i=e*this.y0+t*this.y1,n=e*this.x1+t*this.x2,s=e*this.y1+t*this.y2,o=e*this.x2+t*this.x3,a=e*this.y2+t*this.y3,u=e*r+t*n,h=e*i+t*s,l=e*n+t*o,c=e*s+t*a,d=e*u+t*l,p=e*h+t*c;return[new Ea(this.x0,this.y0,r,i,u,h,d,p),new Ea(d,p,l,c,o,a,this.x3,this.y3)]}transform(t){return new Ea(t.transformX(this.x0,this.y0),t.transformY(this.x0,this.y0),t.transformX(this.x1,this.y1),t.transformY(this.x1,this.y1),t.transformX(this.x2,this.y2),t.transformY(this.x2,this.y2),t.transformX(this.x3,this.y3),t.transformY(this.x3,this.y3))}drawMove(t){t.moveTo(this.x0,this.y0)}drawRest(t){t.bezierCurveTo(this.x1,this.y1,this.x2,this.y2,this.x3,this.y3)}transformDrawMove(t,e){t.moveTo(e.transformX(this.x0,this.y0),e.transformY(this.x0,this.y0))}transformDrawRest(t,e){t.bezierCurveTo(e.transformX(this.x1,this.y1),e.transformY(this.x1,this.y1),e.transformX(this.x2,this.y2),e.transformY(this.x2,this.y2),e.transformX(this.x3,this.y3),e.transformY(this.x3,this.y3))}writeMove(t){return t=t.write(77),t=(t=Ot.displayNumber(t,this.x0)).write(44),t=Ot.displayNumber(t,this.y0)}writeRest(t){return t=t.write(67),t=(t=Ot.displayNumber(t,this.x1)).write(44),t=(t=Ot.displayNumber(t,this.y1)).write(44),t=(t=Ot.displayNumber(t,this.x2)).write(44),t=(t=Ot.displayNumber(t,this.y2)).write(44),t=(t=Ot.displayNumber(t,this.x3)).write(44),t=Ot.displayNumber(t,this.y3)}equivalentTo(t,e){return this===t||t instanceof Ea&&(h.equivalent(this.x0,t.x0,e)&&h.equivalent(this.y0,t.y0,e)&&h.equivalent(this.x1,t.x1,e)&&h.equivalent(this.y1,t.y1,e)&&h.equivalent(this.x2,t.x2,e)&&h.equivalent(this.y2,t.y2,e)&&h.equivalent(this.x3,t.x3,e)&&h.equivalent(this.y3,t.y3,e))}equals(t){return this===t||t instanceof Ea&&(this.x0===t.x0&&this.y0===t.y0&&this.x1===t.x1&&this.y1===t.y1&&this.x2===t.x2&&this.y2===t.y2&&this.x3===t.x3&&this.y3===t.y3)}debug(t){return t=t.write("R2Curve").write(46).write("cubic").write(40).debug(this.x0).write(", ").debug(this.y0).write(", ").debug(this.x1).write(", ").debug(this.y1).write(", ").debug(this.x2).write(", ").debug(this.y2).write(", ").debug(this.x3).write(", ").debug(this.y3).write(41)}toString(){return Ot.debug(this)}}class ka extends jt{constructor(t,e,r,i,n,s,o,a,u,h){super(),this.x0Parser=t,this.y0Parser=e,this.x1Parser=r,this.y1Parser=i,this.x2Parser=n,this.y2Parser=s,this.x3Parser=o,this.y3Parser=a,this.command=u,this.step=h}feed(t){return ka.parse(t,this.x0Parser,this.y0Parser,this.x1Parser,this.y1Parser,this.x2Parser,this.y2Parser,this.x3Parser,this.y3Parser,this.command,this.step)}static parse(t,e,r,i,n,s,o,a,u,h,l=1){let c=0;if(1===l){for(;t.isCont()&&(c=t.head(),Ct.isSpace(c));)t=t.step();if(t.isCont())switch(c){case 67:case 99:t=t.step(),h=c,l=2;break;case 83:case 115:t=t.step(),h=c,l=6;break;default:return jt.error(Et.expected("curveto",t))}else if(!t.isEmpty())return jt.error(Et.unexpected(t))}if(2===l){if(void 0===i){for(;t.isCont()&&Ct.isSpace(t.head());)t=t.step();t.isEmpty()||(i=St.parseDecimal(t))}else i=i.feed(t);if(void 0!==i)if(i.isDone())l=3;else if(i.isError())return i.asError()}if(3===l){for(;t.isCont()&&(c=t.head(),Ct.isSpace(c));)t=t.step();t.isCont()?(44===c&&(t=t.step()),l=4):t.isEmpty()||(l=4)}if(4===l){if(void 0===n){for(;t.isCont()&&Ct.isSpace(t.head());)t=t.step();t.isEmpty()||(n=St.parseDecimal(t))}else n=n.feed(t);if(void 0!==n)if(n.isDone())l=5;else if(n.isError())return n.asError()}if(5===l){for(;t.isCont()&&(c=t.head(),Ct.isSpace(c));)t=t.step();t.isCont()?(44===c&&(t=t.step()),l=6):t.isEmpty()||(l=6)}if(6===l){if(void 0===s){for(;t.isCont()&&Ct.isSpace(t.head());)t=t.step();t.isEmpty()||(s=St.parseDecimal(t))}else s=s.feed(t);if(void 0!==s)if(s.isDone())l=7;else if(s.isError())return s.asError()}if(7===l){for(;t.isCont()&&(c=t.head(),Ct.isSpace(c));)t=t.step();t.isCont()?(44===c&&(t=t.step()),l=8):t.isEmpty()||(l=8)}if(8===l){if(void 0===o){for(;t.isCont()&&Ct.isSpace(t.head());)t=t.step();t.isEmpty()||(o=St.parseDecimal(t))}else o=o.feed(t);if(void 0!==o)if(o.isDone())l=9;else if(o.isError())return o.asError()}if(9===l){for(;t.isCont()&&(c=t.head(),Ct.isSpace(c));)t=t.step();t.isCont()?(44===c&&(t=t.step()),l=10):t.isEmpty()||(l=10)}if(10===l){if(void 0===a){for(;t.isCont()&&Ct.isSpace(t.head());)t=t.step();t.isEmpty()||(a=St.parseDecimal(t))}else a=a.feed(t);if(void 0!==a)if(a.isDone())l=11;else if(a.isError())return a.asError()}if(11===l){for(;t.isCont()&&(c=t.head(),Ct.isSpace(c));)t=t.step();t.isCont()?(44===c&&(t=t.step()),l=12):t.isEmpty()||(l=12)}if(12===l){if(void 0===u){for(;t.isCont()&&Ct.isSpace(t.head());)t=t.step();t.isEmpty()||(u=St.parseDecimal(t))}else u=u.feed(t);if(void 0!==u){if(u.isDone()){const t=e.bind(),l=r.bind();let c=i.bind(),d=n.bind(),p=s.bind(),f=o.bind(),y=a.bind(),m=u.bind();return 99!==h&&115!==h||(c+=t,d+=l,p+=t,f+=l,y+=t,m+=l),jt.done(new Ea(t,l,c,d,p,f,y,m))}if(u.isError())return u.asError()}}return new ka(e,r,i,n,s,o,a,u,h,l)}static parseRest(t,e,r,i,n,s){const o=83===e||115===e?6:2;return ka.parse(t,r,i,n,s,void 0,void 0,void 0,void 0,e,o)}}class Aa extends wa{constructor(t,e,r,i,n,s,o){super(),this.cx=t,this.cy=e,this.rx=r,this.ry=i,this.phi=n,this.a0=s,this.da=o}get xMin(){return this.cx-Math.max(this.rx,this.ry)}get yMin(){return this.cy-Math.max(this.rx,this.ry)}get xMax(){return this.cx+Math.max(this.rx,this.ry)}get yMax(){return this.cy+Math.max(this.rx,this.ry)}interpolateX(t){const e=this.a0+t*this.da,r=this.rx*Math.cos(e),i=this.ry*Math.sin(e),n=this.phi;return 0===n?this.cx+r:this.cx+r*Math.cos(n)-i*Math.sin(n)}interpolateY(t){const e=this.a0+t*this.da,r=this.rx*Math.cos(e),i=this.ry*Math.sin(e),n=this.phi;return 0===n?this.cy+i:this.cy+r*Math.sin(n)+i*Math.cos(n)}interpolate(t){const e=this.a0+t*this.da,r=this.rx*Math.cos(e),i=this.ry*Math.sin(e),n=this.phi;return 0===n?new ya(this.cx+r,this.cy+i):new ya(this.cx+r*Math.cos(n)-i*Math.sin(n),this.cy+r*Math.sin(n)+i*Math.cos(n))}contains(t,e){return!1}intersects(t){return!1}split(t){const e=this.a0,r=this.da,i=e+t*r;return[new Aa(this.cx,this.cy,this.rx,this.ry,this.phi,e,i-e),new Aa(this.cx,this.cy,this.rx,this.ry,this.phi,i,e+r-i)]}transform(t){const e=t.transformX(this.cx,this.cy),r=t.transformY(this.cx,this.cy),i=t.transformX(this.cx+this.rx,this.cy+this.ry)-e,n=t.transformY(this.cx+this.rx,this.cy+this.ry)-r,s=this.a0,o=this.da,a=s+o,u=Math.cos(s),h=Math.sin(s),l=Math.cos(a),c=Math.sin(a),d=t.transformX(this.cx+u,this.cy-h)-e,p=t.transformY(this.cx+u,this.cy-h)-r,f=t.transformX(this.cx+l,this.cy-c)-e,y=t.transformY(this.cx+l,this.cy-c)-r,m=Math.atan2(p,d);let w=Math.atan2(y,f);Math.abs(o)>Math.PI&&(w>0?w=-2*Math.PI+w:w<0&&(w=2*Math.PI-w));const g=w-m;return new Aa(e,r,i,n,this.phi,m,g)}drawMove(t){const{x0:e,y0:r}=this.toEndpoints();t.moveTo(e,r)}drawRest(t){t.ellipse(this.cx,this.cy,this.rx,this.ry,this.phi,this.a0,this.a0+this.da,this.da<0)}transformDrawMove(t,e){const{x0:r,y0:i}=this.toEndpoints();t.moveTo(e.transformX(r,i),e.transformY(r,i))}transformDrawRest(t,e){const r=e.transformX(this.cx,this.cy),i=e.transformY(this.cx,this.cy),n=e.transformX(this.cx+this.rx,this.cy+this.ry)-r,s=e.transformY(this.cx+this.rx,this.cy+this.ry)-i,o=this.a0,a=this.da,u=o+a,h=Math.cos(o),l=Math.sin(o),c=Math.cos(u),d=Math.sin(u),p=e.transformX(this.cx+h,this.cy-l)-r,f=e.transformY(this.cx+h,this.cy-l)-i,y=e.transformX(this.cx+c,this.cy-d)-r,m=e.transformY(this.cx+c,this.cy-d)-i,w=Math.atan2(f,p);let g=Math.atan2(m,y);Math.abs(a)>Math.PI&&(g>0?g=-2*Math.PI+g:g<0&&(g=2*Math.PI-g));const v=g<w;t.ellipse(r,i,n,s,this.phi,w,g,v)}writeMove(t){const{x0:e,y0:r}=this.toEndpoints();return t=t.write(77),t=(t=Ot.displayNumber(t,e)).write(44),t=Ot.displayNumber(t,r)}writeRest(t){const{rx:e,ry:r,phi:i,large:n,sweep:s,x1:o,y1:a}=this.toEndpoints();return t=t.write(65),t=(t=Ot.displayNumber(t,e)).write(44),t=(t=Ot.displayNumber(t,r)).write(32),t=(t=(t=(t=(t=(t=Ot.displayNumber(t,i)).write(32)).write(n?49:48)).write(44)).write(s?49:48)).write(32),t=(t=Ot.displayNumber(t,o)).write(44),t=Ot.displayNumber(t,a)}toEndpoints(){const t=this.cx,e=this.cy,r=this.rx,i=this.ry,n=this.phi,s=this.a0,o=this.da,a=s+o,u=Math.cos(n),h=Math.sin(n),l=Math.cos(s),c=Math.sin(s),d=Math.cos(a),p=Math.sin(a),f=u*r*d-h*i*p+t,y=h*r*d+u*i*p+e;return{x0:u*r*l-h*i*c+t,y0:h*r*l+u*i*c+e,rx:r,ry:i,phi:n,large:Math.abs(o)>Math.PI,sweep:o>0,x1:f,y1:y}}equivalentTo(t,e){return this===t||t instanceof Aa&&(h.equivalent(this.cx,t.cx,e)&&h.equivalent(this.cy,t.cy,e)&&h.equivalent(this.rx,t.rx,e)&&h.equivalent(this.ry,t.ry,e)&&h.equivalent(this.phi,t.phi,e)&&h.equivalent(this.a0,t.a0,e)&&h.equivalent(this.da,t.da,e))}equals(t){return this===t||t instanceof Aa&&(this.cx===t.cx&&this.cy===t.cy&&this.rx===t.rx&&this.ry===t.ry&&this.phi===t.phi&&this.a0===t.a0&&this.da===t.da)}debug(t){return t=t.write("R2Curve").write(46).write("elliptic").write(40).debug(this.cx).write(", ").debug(this.cy).write(", ").debug(this.rx).write(", ").debug(this.ry).write(", ").debug(this.phi).write(", ").debug(this.a0).write(", ").debug(this.da).write(41)}toString(){return Ot.debug(this)}static fromEndpoints(t,e,r,i,n,s,o,a,u){const h=Math.cos(n),l=Math.sin(n),c=h*((t-a)/2)+l*((e-u)/2),d=(t-a)/2*-l+h*((e-u)/2),p=r*r,f=i*i,y=c*c,m=d*d;let w=Math.sqrt((p*f-p*m-f*y)/(p*m+f*y));s===o&&(w=-w);const g=w*r*d/i,v=-w*i*c/r,b=h*g-l*v+(t+a)/2,x=l*g+h*v+(e+u)/2;function C(t,e,r,i){const n=t*r+e*i,s=t*t+e*e,o=r*r+i*i;let a=Math.acos(n/(Math.sqrt(s)*Math.sqrt(o)));return t*i-e*r<0&&(a=-a),a}const O=C(1,0,(c-g)/r,(d-v)/i);let S=C((c-g)/r,(d-v)/i,(-c-g)/r,(-d-v)/i)%(2*Math.PI);return o&&S<0?S+=2*Math.PI:!o&&S>0&&(S-=2*Math.PI),new Aa(b,x,r,i,n,O,S)}}class Ma extends jt{constructor(t,e,r,i,n,s,o,a,u,h,l){super(),this.x0Parser=t,this.y0Parser=e,this.rxParser=r,this.ryParser=i,this.phiParser=n,this.large=s,this.sweep=o,this.x1Parser=a,this.y1Parser=u,this.command=h,this.step=l}feed(t){return Ma.parse(t,this.x0Parser,this.y0Parser,this.rxParser,this.ryParser,this.phiParser,this.large,this.sweep,this.x1Parser,this.y1Parser,this.command,this.step)}static parse(t,e,r,i,n,s,o,a,u,h,l,c=1){let d=0;if(1===c){for(;t.isCont()&&(d=t.head(),Ct.isSpace(d));)t=t.step();if(t.isCont())switch(d){case 65:case 97:t=t.step(),l=d,c=2;break;default:return jt.error(Et.expected("arcto",t))}else if(!t.isEmpty())return jt.error(Et.unexpected(t))}if(2===c){if(void 0===i){for(;t.isCont()&&Ct.isSpace(t.head());)t=t.step();t.isEmpty()||(i=St.parseDecimal(t))}else i=i.feed(t);if(void 0!==i)if(i.isDone())c=3;else if(i.isError())return i.asError()}if(3===c){for(;t.isCont()&&(d=t.head(),Ct.isSpace(d));)t=t.step();t.isCont()?(44===d&&(t=t.step()),c=4):t.isEmpty()||(c=4)}if(4===c){if(void 0===n){for(;t.isCont()&&Ct.isSpace(t.head());)t=t.step();t.isEmpty()||(n=St.parseDecimal(t))}else n=n.feed(t);if(void 0!==n)if(n.isDone())c=5;else if(n.isError())return n.asError()}if(5===c){for(;t.isCont()&&(d=t.head(),Ct.isSpace(d));)t=t.step();t.isCont()?(44===d&&(t=t.step()),c=6):t.isEmpty()||(c=6)}if(6===c){if(void 0===s){for(;t.isCont()&&Ct.isSpace(t.head());)t=t.step();t.isEmpty()||(s=St.parseDecimal(t))}else s=s.feed(t);if(void 0!==s)if(s.isDone())c=7;else if(s.isError())return s.asError()}if(7===c){for(;t.isCont()&&(d=t.head(),Ct.isSpace(d));)t=t.step();t.isCont()?(44===d&&(t=t.step()),c=8):t.isEmpty()||(c=8)}if(8===c){for(;t.isCont()&&(d=t.head(),Ct.isSpace(d));)t=t.step();if(t.isCont())if(48===d)t=t.step(),o=!1,c=9;else{if(49!==d)return jt.error(Et.expected("flag",t));t=t.step(),o=!0,c=9}else if(!t.isEmpty())return jt.error(Et.unexpected(t))}if(9===c){for(;t.isCont()&&(d=t.head(),Ct.isSpace(d));)t=t.step();t.isCont()?(44===d&&(t=t.step()),c=10):t.isEmpty()||(c=10)}if(10===c){for(;t.isCont()&&(d=t.head(),Ct.isSpace(d));)t=t.step();if(t.isCont())if(48===d)t=t.step(),a=!1,c=11;else{if(49!==d)return jt.error(Et.expected("flag",t));t=t.step(),a=!0,c=11}else if(!t.isEmpty())return jt.error(Et.unexpected(t))}if(11===c){for(;t.isCont()&&(d=t.head(),Ct.isSpace(d));)t=t.step();t.isCont()?(44===d&&(t=t.step()),c=12):t.isEmpty()||(c=12)}if(12===c){if(void 0===u){for(;t.isCont()&&Ct.isSpace(t.head());)t=t.step();t.isEmpty()||(u=St.parseDecimal(t))}else u=u.feed(t);if(void 0!==u)if(u.isDone())c=13;else if(u.isError())return u.asError()}if(13===c){for(;t.isCont()&&(d=t.head(),Ct.isSpace(d));)t=t.step();t.isCont()?(44===d&&(t=t.step()),c=14):t.isEmpty()||(c=14)}if(14===c){if(void 0===h){for(;t.isCont()&&Ct.isSpace(t.head());)t=t.step();t.isEmpty()||(h=St.parseDecimal(t))}else h=h.feed(t);if(void 0!==h){if(h.isDone()){const t=e.bind(),c=r.bind(),d=i.bind(),p=n.bind(),f=s.bind()*Math.PI/180;let y=u.bind(),m=h.bind();return 97===l&&(y+=t,m+=c),jt.done(Aa.fromEndpoints(t,c,d,p,f,o,a,y,m))}if(h.isError())return h.asError()}}return new Ma(e,r,i,n,s,o,a,u,h,l,c)}static parseRest(t,e,r,i){return Ma.parse(t,r,i,void 0,void 0,void 0,void 0,void 0,void 0,void 0,e,2)}}class Da extends wa{constructor(t,e){super(),this.curves=t,this.closed=e,this.boundingBox=null,this.pathString=void 0}isDefined(){return 0!==this.curves.length}isClosed(){return this.closed}get xMin(){return this.bounds.xMin}get yMin(){return this.bounds.yMin}get xMax(){return this.bounds.xMax}get yMax(){return this.bounds.yMax}interpolateX(t){const e=this.curves,r=e.length;if(r>0){const i=1/r,n=Math.min(Math.max(0,Math.floor(t/i)),r-1),s=r*(t-n*i);return e[n].interpolateX(s)}return NaN}interpolateY(t){const e=this.curves,r=e.length;if(r>0){const i=1/r,n=Math.min(Math.max(0,Math.floor(t/i)),r-1),s=r*(t-n*i);return e[n].interpolateY(s)}return NaN}interpolate(t){const e=this.curves,r=e.length;if(r>0){const i=1/r,n=Math.min(Math.max(0,Math.floor(t/i)),r-1),s=r*(t-n*i);return e[n].interpolate(s)}return new ya(NaN,NaN)}contains(t,e){return!1}intersects(t){return!1}split(t){const e=this.curves,r=e.length;if(r>0){const i=1/r,n=Math.min(Math.max(0,Math.floor(t/i)),r-1),s=r*(t-n*i),[o,a]=e[n].split(s),u=new Array(n+1),h=new Array(r-n);for(let t=0;t<n;t+=1)u[t]=e[t];u[n]=o,h[0]=a;for(let t=n+1;t<r;t+=1)h[t-n]=e[t];return[new Da(u,!1),new Da(h,!1)]}return[Da.empty(),Da.empty()]}subdivide(t){const e=this.curves,r=e.length;if(r>0){const i=1/r,n=Math.min(Math.max(0,Math.floor(t/i)),r-1),s=r*(t-n*i),[o,a]=e[n].split(s),u=new Array(r+1);for(let t=0;t<n;t+=1)u[t]=e[t];u[n]=o,u[n+1]=a;for(let t=n+1;t<r;t+=1)u[t+1]=e[t];return new Da(u,this.closed)}return Da.empty()}transform(t){const e=this.curves,r=e.length;if(r>0){const i=new Array(r);for(let n=0;n<r;n+=1)i[n]=e[n].transform(t);return new Da(i,this.closed)}return Da.empty()}get bounds(){let t=this.boundingBox;if(null===t){let e=1/0,r=1/0,i=-1/0,n=-1/0;const s=this.curves;for(let t=0,o=s.length;t<o;t+=1){const o=s[t];e=Math.min(e,o.xMin),r=Math.min(r,o.yMin),i=Math.max(o.xMax,i),n=Math.max(o.yMax,n)}t=new Ua(e,r,i,n),this.boundingBox=t}return t}drawMove(t){const e=this.curves;0!==e.length&&e[0].drawMove(t)}drawRest(t){const e=this.curves,r=this.closed,i=e.length-(r&&void 0!==t.closePath?1:0);for(let r=0;r<i;r+=1)e[r].drawRest(t);r&&void 0!==t.closePath&&t.closePath()}transformDrawMove(t,e){const r=this.curves;0!==r.length&&r[0].transformDrawMove(t,e)}transformDrawRest(t,e){const r=this.curves,i=this.closed,n=r.length-(i&&void 0!==t.closePath?1:0);for(let i=0;i<n;i+=1)r[i].transformDrawRest(t,e);i&&void 0!==t.closePath&&t.closePath()}writeMove(t){const e=this.curves;return 0!==e.length&&(t=e[0].writeMove(t)),t}writeRest(t){const e=this.curves,r=this.closed,i=e.length-(r?1:0);for(let r=0;r<i;r+=1)t=e[r].writeRest(t);return r&&(t=t.write(90)),t}toPathString(t){let e;if(void 0!==t||(e=this.pathString,void 0===e)){const r=Ct.stringOutput(t);this.writePath(r),e=r.bind(),void 0===t&&(this.pathString=e)}return e}equivalentTo(t,e){return this===t||t instanceof Da&&(v.equivalent(this.curves,t.curves,e)&&this.closed===t.closed)}equals(t){return this===t||t instanceof Da&&(v.equal(this.curves,t.curves)&&this.closed===t.closed)}debug(t){const e=this.curves,r=e.length;if(t=t.write("R2Spline").write(46),0===r)t=t.write("empty").write(40);else if(0!==r){t=(t=t.write(this.closed?"closed":"open").write(40)).debug(e[0]);for(let i=1;i<r;i+=1)t=t.write(", ").debug(e[i])}return t=t.write(41)}toString(){return Ot.debug(this)}static empty(){return new Da([],!1)}static open(...t){return new Da(t,!1)}static closed(...t){return new Da(t,!0)}static builder(){return new Ia}static parse(t){let e=Ct.stringInput(t);for(;e.isCont()&&Ct.isWhitespace(e.head());)e=e.step();let r=Pa.parse(e);if(r.isDone())for(;e.isCont()&&Ct.isWhitespace(e.head());)e=e.step();return e.isCont()&&!r.isError()&&(r=jt.error(Et.unexpected(e))),r.bind()}}class Ia{constructor(){this.curves=[],this.closed=!1,this.aliased=!1,this.x0=0,this.y0=0,this.x=0,this.y=0}dealias(){this.aliased&&(this.curves=this.curves.slice(0),this.aliased=!1)}moveTo(t,e){this.aliased?(this.curves=[],this.aliased=!1):this.curves.length=0,this.closed=!1,this.x0=t,this.y0=e,this.x=t,this.y=e}closePath(){this.dealias(),this.curves.push(new ba(this.x,this.y,this.x0,this.y0)),this.closed=!0,this.x=this.x0,this.y=this.y0}lineTo(t,e){this.dealias(),this.curves.push(new ba(this.x,this.y,t,e)),this.x=t,this.y=e}quadraticCurveTo(t,e,r,i){this.dealias(),this.curves.push(new Oa(this.x,this.y,t,e,r,i)),this.x=r,this.y=i}bezierCurveTo(t,e,r,i,n,s){this.dealias(),this.curves.push(new Ea(this.x,this.y,t,e,r,i,n,s)),this.x=n,this.y=s}arcTo(t,e,r,i,n){this.dealias();const s=this.x,o=this.y,a=t-s,u=e-o,h=r-t,l=i-e,c=Math.atan2(u,a)-Math.PI/2,d=Math.atan2(l,h)-Math.PI/2,p=d-c,f=Math.cos(c),y=Math.sin(c),m=Math.cos(d),w=Math.sin(d),g=s-f,v=o-y,b=t-f,x=e-y,C=t-m,O=e-w,S=r-m,E=i-w,k=Ia.intersection(g,v,b-g,x-v,C,O,S-C,E-O),A=g+k*(b-g),M=v+k*(x-v);this.curves.push(new Aa(A,M,n,n,0,c,p)),this.x=r,this.y=i}static intersection(t,e,r,i,n,s,o,a){const u=n-t,h=s-e,l=u*i-h*r,c=r*a-i*o;if(0===l&&0===c){const t=r*r+i*i,e=o*r+a*i,n=(u*r+h*i)/t,s=n+e/t;return(e>=0?0<s&&n<1:0<n&&s<1)?n:NaN}if(0===c)return NaN;{const t=(u*a-h*o)/c,e=l/c;return 0<=t&&t<=1&&0<=e&&e<=1?t:NaN}}arc(t,e,r,i,n,s=!1){this.dealias();let o=n-i;!0===s&&o>0?o-=2*Math.PI:!1===s&&o<0&&(o+=2*Math.PI);const a=new Aa(t,e,r,r,0,i,o);this.curves.push(a);const{x:u,y:h}=a.interpolate(1);this.x=u,this.y=h}ellipse(t,e,r,i,n,s,o,a){this.dealias();let u=o-s;!0===a&&u>0?u-=2*Math.PI:!1===a&&u<0&&(u+=2*Math.PI);const h=new Aa(t,e,r,i,n,s,u);this.curves.push(h);const{x:l,y:c}=h.interpolate(1);this.x=l,this.y=c}rect(t,e,r,i){this.dealias(),this.curves.push(new ba(t,e,t+r,e),new ba(t+r,e,t+r,e+i),new ba(t+r,e+i,t,e+i),new ba(t,e+i,t,e)),this.x=t,this.y=e}bind(){return this.aliased=!0,new Da(this.curves,this.closed)}}class Pa extends jt{constructor(t,e,r,i,n,s,o,a){super(),this.xParser=t,this.yParser=e,this.x0Parser=r,this.y0Parser=i,this.curveParser=n,this.curves=s,this.command=o,this.step=a}feed(t){return Pa.parse(t,this.xParser,this.yParser,this.x0Parser,this.y0Parser,this.curveParser,this.curves,this.command,this.step)}static parse(t,e,r,i,n,s,o,a,u=1){let h=0;if(1===u){for(;t.isCont()&&(h=t.head(),Ct.isSpace(h));)t=t.step();if(t.isCont()){if(77!==h&&109!==h)return jt.error(Et.expected("moveto",t));t=t.step(),a=h,u=2}else if(!t.isEmpty())return jt.error(Et.unexpected(t))}if(2===u){if(void 0===i){for(;t.isCont()&&Ct.isSpace(t.head());)t=t.step();t.isEmpty()||(i=St.parseDecimal(t))}else i=i.feed(t);if(void 0!==i)if(i.isDone())109===a&&void 0!==e&&(i=jt.done(e.bind()+i.bind())),e=i,u=3;else if(i.isError())return i.asError()}if(3===u){for(;t.isCont()&&(h=t.head(),Ct.isSpace(h));)t=t.step();t.isCont()?(44===h&&(t=t.step()),u=4):t.isEmpty()||(u=4)}if(4===u){if(void 0===n){for(;t.isCont()&&Ct.isSpace(t.head());)t=t.step();t.isEmpty()||(n=St.parseDecimal(t))}else n=n.feed(t);if(void 0!==n)if(n.isDone())109===a&&void 0!==r&&(n=jt.done(r.bind()+n.bind())),r=n,u=5;else if(n.isError())return n.asError()}for(;;){if(5===u){if(void 0===s){for(;t.isCont()&&(h=t.head(),Ct.isSpace(h));)t=t.step();if(t.isCont()){const u=void 0!==o&&0!==o.length?o[o.length-1]:null;switch(h){case 76:case 108:case 72:case 104:case 86:case 118:s=Ca.parse(t,e,r),a=h;break;case 81:case 113:s=Sa.parse(t,e,r),a=h;break;case 84:if(u instanceof Oa){const i=u.x2-u.x1,n=u.y2-u.y1,o=e.bind()+i,a=r.bind()+n;s=Sa.parse(t,e,r,jt.done(o),jt.done(a))}else s=Sa.parse(t,e,r,e,r);a=h;break;case 116:if(u instanceof Oa){const i=u.x2-u.x1,n=u.y2-u.y1;s=Sa.parse(t,e,r,jt.done(i),jt.done(n))}else s=Sa.parse(t,e,r,jt.done(0),jt.done(0));a=h;break;case 67:case 99:s=ka.parse(t,e,r),a=h;break;case 83:if(u instanceof Ea){const i=u.x3-u.x2,n=u.y3-u.y2,o=e.bind()+i,a=r.bind()+n;s=ka.parse(t,e,r,jt.done(o),jt.done(a))}else s=ka.parse(t,e,r,e,r);a=h;break;case 115:if(u instanceof Ea){const i=u.x3-u.x2,n=u.y3-u.y2;s=ka.parse(t,e,r,jt.done(i),jt.done(n))}else s=ka.parse(t,e,r,jt.done(0),jt.done(0));a=h;break;case 65:case 97:s=Ma.parse(t,e,r),a=h;break;case 90:case 122:return t=t.step(),void 0===o&&(o=[]),o.push(new ba(e.bind(),r.bind(),i.bind(),n.bind())),jt.done(new Da(o,!0));case 44:t=t.step();case 43:case 45:case 46:case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:switch(a){case 77:case 109:case 76:case 108:case 72:case 104:case 86:case 118:s=Ca.parseRest(t,a,e,r);break;case 81:case 113:s=Sa.parseRest(t,a,e,r);break;case 84:if(u instanceof Oa){const i=u.x2-u.x1,n=u.y2-u.y1,o=e.bind()+i,h=r.bind()+n;s=Sa.parseRest(t,a,e,r,jt.done(o),jt.done(h))}else s=Sa.parseRest(t,a,e,r,e,r);break;case 116:if(u instanceof Oa){const i=u.x2-u.x1,n=u.y2-u.y1;s=Sa.parseRest(t,a,e,r,jt.done(i),jt.done(n))}else s=Sa.parseRest(t,a,e,r,jt.done(0),jt.done(0));break;case 67:case 99:s=ka.parseRest(t,a,e,r);break;case 83:if(u instanceof Ea){const i=u.x3-u.x2,n=u.y3-u.y2,o=e.bind()+i,h=r.bind()+n;s=ka.parseRest(t,a,e,r,jt.done(o),jt.done(h))}else s=ka.parseRest(t,a,e,r,e,r);break;case 115:if(u instanceof Ea){const i=u.x3-u.x2,n=u.y3-u.y2;s=ka.parseRest(t,a,e,r,jt.done(i),jt.done(n))}else s=ka.parseRest(t,a,e,r,jt.done(0),jt.done(0));break;case 65:case 97:s=Ma.parseRest(t,a,e,r);break;default:return void 0!==o?jt.done(new Da(o,!1)):jt.done(Da.empty())}break;default:return void 0!==o?jt.done(new Da(o,!1)):jt.done(Da.empty())}}else if(!t.isEmpty())return void 0!==o?jt.done(new Da(o,!1)):jt.done(Da.empty())}else s=s.feed(t);if(void 0!==s){if(s.isDone()){const t=s.bind();s=void 0,void 0===o&&(o=[]),o.push(t),e=jt.done(t.interpolateX(1)),r=jt.done(t.interpolateY(1));continue}if(s.isError())return s.asError()}}break}return new Pa(e,r,i,n,s,o,a,u)}}class Ta extends fa{constructor(t){super(),this.splines=t,this.boundingBox=null,this.pathString=void 0}isDefined(){return 0!==this.splines.length}get xMin(){return this.bounds.xMin}get yMin(){return this.bounds.yMin}get xMax(){return this.bounds.xMax}get yMax(){return this.bounds.yMax}interpolateX(t){const e=this.splines,r=e.length;if(r>0){const i=1/r,n=Math.min(Math.max(0,Math.floor(t/i)),r),s=t*r-n*i;return e[n].interpolateX(s)}return NaN}interpolateY(t){const e=this.splines,r=e.length;if(r>0){const i=1/r,n=Math.min(Math.max(0,Math.floor(t/i)),r),s=t*r-n*i;return e[n].interpolateY(s)}return NaN}interpolate(t){const e=this.splines,r=e.length;if(r>0){const i=1/r,n=Math.min(Math.max(0,Math.floor(t/i)),r),s=t*r-n*i;return e[n].interpolate(s)}return new ya(NaN,NaN)}contains(t,e){return!1}intersects(t){return!1}split(t){const e=this.splines,r=e.length;if(r>0){const i=1/r,n=Math.min(Math.max(0,Math.floor(t/i)),r),s=t*r-n*i,[o,a]=e[n].split(s),u=new Array(n+1),h=new Array(r-n);for(let t=0;t<n;t+=1)u[t]=e[t];u[n]=o,h[0]=a;for(let t=n+1;t<r;t+=1)h[t-n]=e[t];return[new Ta(u),new Ta(h)]}return[Ta.empty(),Ta.empty()]}subdivide(t){const e=this.splines,r=e.length;if(r>0){const i=1/r,n=Math.min(Math.max(0,Math.floor(t/i)),r),s=t*r-n*i,o=new Array(r);for(let t=0;t<n;t+=1)o[t]=e[t];o[n]=e[n].subdivide(s);for(let t=n+1;t<r;t+=1)o[t]=e[t];return new Ta(o)}return Ta.empty()}transform(t){const e=this.splines,r=e.length;if(r>0){const i=new Array(r);for(let n=0;n<r;n+=1)i[n]=e[n].transform(t);return new Ta(i)}return Ta.empty()}get bounds(){let t=this.boundingBox;if(null===t){let e=1/0,r=1/0,i=-1/0,n=-1/0;const s=this.splines;for(let t=0,o=s.length;t<o;t+=1){const o=s[t];e=Math.min(e,o.xMin),r=Math.min(r,o.yMin),i=Math.max(o.xMax,i),n=Math.max(o.yMax,n)}t=new Ua(e,r,i,n),this.boundingBox=t}return t}draw(t){const e=this.splines;for(let r=0,i=e.length;r<i;r+=1)e[r].draw(t)}transformDraw(t,e){const r=this.splines;for(let i=0,n=r.length;i<n;i+=1)r[i].transformDraw(t,e)}writePath(t){const e=this.splines,r=e.length;if(t.settings===lt.standard())for(let i=0;i<r;i+=1)t=t.write(e[i].toPathString());else for(let i=0;i<r;i+=1)t=e[i].writePath(t);return t}toPathString(t){let e;if(void 0!==t||(e=this.pathString,void 0===e)){const r=Ct.stringOutput(t);this.writePath(r),e=r.bind(),void 0===t&&(this.pathString=e)}return e}equivalentTo(t,e){return this===t||t instanceof Ta&&v.equivalent(this.splines,t.splines,e)}equals(t){return this===t||t instanceof Ta&&v.equal(this.splines,t.splines)}debug(t){const e=this.splines,r=e.length;if(t=t.write("R2Path").write(46),0===r)t=t.write("empty").write(40);else if(1===r){const r=e[0];t=t.write(r.closed?"closed":"open").write(40);const i=r.curves,n=i.length;if(0!==n){t=t.debug(i[0]);for(let e=1;e<n;e+=1)t=t.write(", ").debug(i[e])}}else{t=(t=t.write("of").write(40)).debug(e[0]);for(let i=1;i<r;i+=1)t=t.write(", ").debug(e[i])}return t=t.write(41)}toAttributeString(){return this.toPathString()}toString(){return Ot.debug(this)}static empty(){return new Ta([])}static of(...t){return new Ta(t)}static open(...t){return new Ta([new Da(t,!1)])}static closed(...t){return new Ta([new Da(t,!0)])}static fromAny(t){if(null==t||t instanceof Ta)return t;if("string"==typeof t)return Ta.parse(t);throw new TypeError(""+t)}static builder(){return new Va}static parse(t){let e=Ct.stringInput(t);for(;e.isCont()&&Ct.isWhitespace(e.head());)e=e.step();let r=Fa.parse(e);if(r.isDone())for(;e.isCont()&&Ct.isWhitespace(e.head());)e=e.step();return e.isCont()&&!r.isError()&&(r=jt.error(Et.unexpected(e))),r.bind()}}class Va{constructor(){this.splines=[],this.builder=null}moveTo(t,e){let r=this.builder;if(null!==r){const t=r.bind();t.isDefined()&&this.splines.push(t)}r=new Ia,this.builder=r,r.moveTo(t,e)}closePath(){const t=this.builder;if(null===t)throw new Error;t.closePath()}lineTo(t,e){const r=this.builder;if(null===r)throw new Error;r.lineTo(t,e)}quadraticCurveTo(t,e,r,i){const n=this.builder;if(null===n)throw new Error;n.quadraticCurveTo(t,e,r,i)}bezierCurveTo(t,e,r,i,n,s){const o=this.builder;if(null===o)throw new Error;o.bezierCurveTo(t,e,r,i,n,s)}arcTo(t,e,r,i,n){const s=this.builder;if(null===s)throw new Error;s.arcTo(t,e,r,i,n)}arc(t,e,r,i,n,s){const o=this.builder;if(null===o)throw new Error;o.arc(t,e,r,i,n,s)}ellipse(t,e,r,i,n,s,o,a){const u=this.builder;if(null===u)throw new Error;u.ellipse(t,e,r,i,n,s,o,a)}rect(t,e,r,i){const n=this.builder;if(null===n)throw new Error;n.rect(t,e,r,i)}bind(){const t=this.splines.slice(0),e=this.builder;if(null!==e){const r=e.bind();r.isDefined()&&t.push(r)}return new Ta(t)}}class Fa extends jt{constructor(t,e,r){super(),this.splineParser=t,this.splines=e,this.step=r}feed(t){return Fa.parse(t,this.splineParser,this.splines,this.step)}static parse(t,e,r,i=1){let n=0;for(;;){if(1===i){if(void 0===e){for(;t.isCont()&&(n=t.head(),Ct.isSpace(n));)t=t.step();if(t.isCont())switch(n){case 77:e=Pa.parse(t);break;case 109:{let i,n;if(void 0!==r&&0!==r.length){const t=r[r.length-1];i=jt.done(t.interpolateX(1)),n=jt.done(t.interpolateY(1))}e=Pa.parse(t,i,n);break}case 110:i=2;break;default:return void 0!==r?jt.done(new Ta(r)):jt.done(Ta.empty())}else if(!t.isEmpty())return void 0!==r?jt.done(new Ta(r)):jt.done(Ta.empty())}else e=e.feed(t);if(void 0!==e){if(e.isDone()){const t=e.bind();e=void 0,t.isDefined()&&(void 0===r&&(r=[]),r.push(t));continue}if(e.isError())return e.asError()}}break}if(i>=2&&i<=5)for(;;){if(t.isCont()){if(t.head()==="none".charCodeAt(i-2)){if(t=t.step(),i<5){i+=1;continue}return jt.done(Ta.empty())}return jt.error(Et.expected("none",t))}if(!t.isEmpty())return jt.error(Et.unexpected(t));break}return new Fa(e,r,i)}}class qa extends fa{constructor(t,e,r){super(),this.cx=t,this.cy=e,this.r=r}isDefined(){return isFinite(this.cx)&&isFinite(this.cy)&&isFinite(this.r)}get xMin(){return this.cx-this.r}get yMin(){return this.cy-this.r}get xMax(){return this.cx+this.r}get yMax(){return this.cy+this.r}contains(t,e){if("number"==typeof t){const r=t-this.cx,i=e-this.cy;return r*r+i*i<=this.r*this.r}return(t=fa.fromAny(t))instanceof ya?this.containsPoint(t):t instanceof ba?this.containsSegment(t):t instanceof Ua?this.containsBox(t):t instanceof qa&&this.containsCircle(t)}containsPoint(t){const e=t.x-this.cx,r=t.y-this.cy;return e*e+r*r<=this.r*this.r}containsSegment(t){const e=t.x0-this.cx,r=t.y0-this.cy,i=t.x1-this.cx,n=t.y1-this.cy,s=this.r*this.r;return e*e+r*r<=s&&i*i+n*n<=s}containsBox(t){const e=t.xMin-this.cx,r=t.yMin-this.cy,i=t.xMax-this.cx,n=t.yMax-this.cy,s=this.r*this.r;return e*e+r*r<=s&&e*e+n*n<=s&&i*i+r*r<=s&&i*i+n*n<=s}containsCircle(t){const e=t.cx-this.cx,r=t.cy-this.cy;return e*e+r*r+t.r*t.r<=this.r*this.r}intersects(t){return(t=fa.fromAny(t))instanceof ya?this.intersectsPoint(t):t instanceof ba?this.intersectsSegment(t):t instanceof Ua?this.intersectsBox(t):t instanceof qa?this.intersectsCircle(t):t.intersects(this)}intersectsPoint(t){const e=t.x-this.cx,r=t.y-this.cy;return e*e+r*r<=this.r*this.r}intersectsSegment(t){const e=this.cx,r=this.cy,i=this.r,n=t.x0,s=t.y0,o=t.x1,a=t.y1,u=o-n,h=a-s,l=Math.sqrt(u*u+h*h),c=u/l,d=h/l,p=(e-n)*d-(r-s)*c;if(p<-i||i<p)return!1;{const t=n-e,u=s-r,h=o-e,l=a-r,p=i*i;if(t*t+u*u<=p||h*h+l*l<=p)return!0;{const t=c*e+d*r,i=c*n+d*s,u=c*o+d*a;return i<t&&t<=u||u<t&&t<=i}}}intersectsBox(t){const e=(this.cx<t.xMin?t.xMin:t.xMax<this.cx?t.xMax:this.cx)-this.cx,r=(this.cy<t.yMin?t.yMin:t.yMax<this.cy?t.yMax:this.cy)-this.cy;return e*e+r*r<=this.r*this.r}intersectsCircle(t){const e=t.cx-this.cx,r=t.cy-this.cy,i=this.r+t.r;return e*e+r*r<=i*i}transform(t){const e=t.transformX(this.cx,this.cy),r=t.transformY(this.cx,this.cy),i=t.transformX(this.cx+this.r,this.cy)-e,n=t.transformY(this.cx+this.r,this.cy)-r,s=Math.sqrt(i*i+n*n);return new qa(e,r,s)}toAny(){return{cx:this.cx,cy:this.cy,r:this.r}}interpolateTo(t){return t instanceof qa?Na(this,t):null}equivalentTo(t,e){return this===t||t instanceof qa&&(h.equivalent(this.cx,t.cx,e)&&h.equivalent(this.cy,t.cy,e)&&h.equivalent(this.r,t.r,e))}equals(t){return this===t||t instanceof qa&&(this.cx===t.cx&&this.cy===t.cy&&this.r===t.r)}hashCode(){return n.mash(n.mix(n.mix(n.mix(p.hash(qa),h.hash(this.cx)),h.hash(this.cy)),h.hash(this.r)))}debug(t){return t=t.write("R2Circle").write(46).write("of").write(40).debug(this.cx).write(", ").debug(this.cy).write(", ").debug(this.r).write(41)}toString(){return Ot.debug(this)}static of(t,e,r){return new qa(t,e,r)}static fromInit(t){return new qa(t.cx,t.cy,t.r)}static fromAny(t){if(null==t||t instanceof qa)return t;if(qa.isInit(t))return qa.fromInit(t);throw new TypeError(""+t)}static isInit(t){if("object"==typeof t&&null!==t){const e=t;return"number"==typeof e.cx&&"number"==typeof e.cy&&"number"==typeof e.r}return!1}static isAny(t){return t instanceof qa||qa.isInit(t)}}class Ua extends fa{constructor(t,e,r,i){super(),this.xMin=t,this.yMin=e,this.xMax=r,this.yMax=i}isDefined(){return isFinite(this.xMin)&&isFinite(this.yMin)&&isFinite(this.xMax)&&isFinite(this.yMax)}get x(){return this.xMin}get y(){return this.yMin}get width(){return this.xMax-this.xMin}get height(){return this.yMax-this.yMin}get top(){return this.yMin}get right(){return this.xMax}get bottom(){return this.yMax}get left(){return this.xMin}get center(){return new ya((this.xMin+this.xMax)/2,(this.yMin+this.yMax)/2)}contains(t,e){return"number"==typeof t?this.xMin<=t&&t<=this.xMax&&this.yMin<=e&&e<=this.yMax:(t=fa.fromAny(t))instanceof fa&&(t instanceof ya?this.containsPoint(t):t instanceof ba?this.containsSegment(t):t instanceof Ua?this.containsBox(t):t instanceof qa?this.containsCircle(t):this.xMin<=t.xMin&&t.xMax<=this.xMax&&this.yMin<=t.yMin&&t.yMax<=this.yMax)}containsPoint(t){return this.xMin<=t.x&&t.x<=this.xMax&&this.yMin<=t.y&&t.y<=this.yMax}containsSegment(t){return this.xMin<=t.x0&&t.x0<=this.xMax&&this.yMin<=t.y0&&t.y0<=this.yMax&&this.xMin<=t.x1&&t.x1<=this.xMax&&this.yMin<=t.y1&&t.y1<=this.yMax}containsBox(t){return this.xMin<=t.xMin&&t.xMax<=this.xMax&&this.yMin<=t.yMin&&t.yMax<=this.yMax}containsCircle(t){return this.xMin<=t.cx-t.r&&t.cx+t.r<=this.xMax&&this.yMin<=t.cy-t.r&&t.cy+t.r<=this.yMax}intersects(t){return(t=fa.fromAny(t))instanceof ya?this.intersectsPoint(t):t instanceof ba?this.intersectsSegment(t):t instanceof Ua?this.intersectsBox(t):t instanceof qa?this.intersectsCircle(t):t.intersects(this)}intersectsPoint(t){return this.xMin<=t.x&&t.x<=this.xMax&&this.yMin<=t.y&&t.y<=this.yMax}intersectsSegment(t){const e=this.xMin,r=this.yMin,i=this.xMax,n=this.yMax,s=t.x0,o=t.y0,a=t.x1,u=t.y1;return!(s<e&&a<e||s>i&&a>i||o<r&&u<r||o>n&&u>n)&&(s>e&&s<i&&o>r&&o<n||!!(Ua.intersectsSegment(s-e,a-e,s,o,a,u)&&Ua.hitY>r&&Ua.hitY<n||Ua.intersectsSegment(o-r,u-r,s,o,a,u)&&Ua.hitX>e&&Ua.hitX<i||Ua.intersectsSegment(s-i,a-i,s,o,a,u)&&Ua.hitY>r&&Ua.hitY<n||Ua.intersectsSegment(o-n,u-n,s,o,a,u)&&Ua.hitX>e&&Ua.hitX<i))}static intersectsSegment(t,e,r,i,n,s){if(t!==e||t*e<0){const o=-t/(e-t);return Ua.hitX=r+(n-r)*o,Ua.hitY=i+(s-i)*o,!0}return!1}intersectsBox(t){return this.xMin<=t.xMax&&t.xMin<=this.xMax&&this.yMin<=t.yMax&&t.yMin<=this.yMax}intersectsCircle(t){const e=(t.cx<this.xMin?this.xMin:this.xMax<t.cx?this.xMax:t.cx)-t.cx,r=(t.cy<this.yMin?this.yMin:this.yMax<t.cy?this.yMax:t.cy)-t.cy;return e*e+r*r<=t.r*t.r}union(t){return super.union(t)}transform(t){return new Ua(t.transformX(this.xMin,this.yMin),t.transformY(this.xMin,this.yMin),t.transformX(this.xMax,this.yMax),t.transformY(this.xMax,this.yMax))}get bounds(){return this}toAny(){return{xMin:this.xMin,yMin:this.yMin,xMax:this.xMax,yMax:this.yMax}}interpolateTo(t){return t instanceof Ua?Ra(this,t):null}equivalentTo(t,e){return this===t||t instanceof Ua&&(h.equivalent(this.xMin,t.xMin,e)&&h.equivalent(this.yMin,t.yMin,e)&&h.equivalent(this.xMax,t.xMax,e)&&h.equivalent(this.yMax,t.yMax,e))}equals(t){return this===t||t instanceof Ua&&(this.xMin===t.xMin&&this.yMin===t.yMin&&this.xMax===t.xMax&&this.yMax===t.yMax)}hashCode(){return n.mash(n.mix(n.mix(n.mix(n.mix(p.hash(Ua),h.hash(this.xMin)),h.hash(this.yMin)),h.hash(this.xMax)),h.hash(this.yMax)))}debug(t){return t=t.write("R2Box").write(46).write("of").write(40).debug(this.xMin).write(", ").debug(this.yMin).write(", ").debug(this.xMax).write(", ").debug(this.yMax).write(41)}toString(){return Ot.debug(this)}static undefined(){return new Ua(1/0,1/0,-1/0,-1/0)}static of(t,e,r,i){return void 0===r&&(r=t),void 0===i&&(i=e),new Ua(t,e,r,i)}static fromInit(t){return new Ua(t.xMin,t.yMin,t.xMax,t.yMax)}static fromAny(t){if(null==t||t instanceof Ua)return t;if(Ua.isInit(t))return Ua.fromInit(t);throw new TypeError(""+t)}static isInit(t){if("object"==typeof t&&null!==t){const e=t;return"number"==typeof e.xMin&&"number"==typeof e.yMin&&"number"==typeof e.xMax&&"number"==typeof e.yMax}return!1}static isAny(t){return t instanceof Ua||Ua.isInit(t)}}Ua.hitX=0,Ua.hitY=0,e([s],Ua,"undefined",null);const Ra=function(t){const e=function(t,r){const i=function(t){const e=i[0],r=i[1],n=e.xMin+t*(r.xMin-e.xMin),s=e.yMin+t*(r.yMin-e.yMin),o=e.xMax+t*(r.xMax-e.xMax),a=e.yMax+t*(r.yMax-e.yMax);return new Ua(n,s,o,a)};return Object.setPrototypeOf(i,e.prototype),i[0]=t,i[1]=r,i};return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e}(k),Na=function(t){const e=function(t,r){const i=function(t){const e=i[0],r=i[1],n=e.cx+t*(r.cx-e.cx),s=e.cy+t*(r.cy-e.cy),o=e.r+t*(r.r-e.r);return new qa(n,s,o)};return Object.setPrototypeOf(i,e.prototype),i[0]=t,i[1]=r,i};return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e}(k);class za extends fa{constructor(t){super(),this.shapes=t,this.boundingBox=null}isDefined(){return 0!==this.shapes.length}get xMin(){return this.bounds.xMin}get yMin(){return this.bounds.yMin}get xMax(){return this.bounds.xMax}get yMax(){return this.bounds.yMax}contains(t,e){return!1}intersects(t){return!1}transform(t){const e=this.shapes,r=e.length;if(r>0){const i=new Array(r);for(let n=0;n<r;n+=1)i[n]=e[n].transform(t);return new za(i)}return za.empty()}get bounds(){let t=this.boundingBox;if(null===t){let e=1/0,r=1/0,i=-1/0,n=-1/0;const s=this.shapes;for(let t=0,o=s.length;t<o;t+=1){const o=s[t];e=Math.min(e,o.xMin),r=Math.min(r,o.yMin),i=Math.max(o.xMax,i),n=Math.max(o.yMax,n)}t=new Ua(e,r,i,n),this.boundingBox=t}return t}equivalentTo(t,e){return this===t||t instanceof za&&v.equivalent(this.shapes,t.shapes,e)}equals(t){return this===t||t instanceof za&&v.equal(this.shapes,t.shapes)}debug(t){const e=this.shapes,r=e.length;if(t=t.write("R2Group").write(46),0===r)t=t.write("empty").write(40);else{t=(t=t.write("of").write(40)).debug(e[0]);for(let i=1;i<r;i+=1)t=t.write(", ").debug(e[i])}return t=t.write(41)}toString(){return Ot.debug(this)}static empty(){return new za(v.empty)}static of(...t){return new za(t)}}e([s],za,"empty",null);class ja{translate(t,e){return this.transform(ja.translate(t,e))}translateX(t){return this.transform(ja.translateX(t))}translateY(t){return this.transform(ja.translateY(t))}scale(t,e){return this.transform(ja.scale(t,e))}scaleX(t){return this.transform(ja.scaleX(t))}scaleY(t){return this.transform(ja.scaleY(t))}rotate(t){return this.transform(ja.rotate(t))}skew(t,e){return this.transform(ja.skew(t,e))}skewX(t){return this.transform(ja.skewX(t))}skewY(t){return this.transform(ja.skewY(t))}toMatrix(){return this.toAffine().toMatrix()}toCssTransformComponent(){return null}toCssValue(){if("undefined"!=typeof CSSTransformValue){const t=this.toCssTransformComponent();if(null!==t)return new CSSTransformValue([t])}return null}interpolateTo(t){return t instanceof ja?iu(this.toAffine(),t.toAffine()):null}toAttributeString(){return this.toString()}static identity(){return new Ba}static translate(t,e){return t=_o.fromAny(t),e=_o.fromAny(e),new Wa(t,e)}static translateX(t){return t=_o.fromAny(t),new Wa(t,Qo.zero())}static translateY(t){return t=_o.fromAny(t),new Wa(Qo.zero(),t)}static scale(t,e){return new Ya(t,e)}static scaleX(t){return new Ya(t,1)}static scaleY(t){return new Ya(1,t)}static rotate(t){return t=na.fromAny(t,"deg"),new Qa(t)}static skew(t,e){return t=na.fromAny(t,"deg"),e=na.fromAny(e,"deg"),new $a(t,e)}static skewX(t){return t=na.fromAny(t,"deg"),new $a(t,sa.zero())}static skewY(t){return t=na.fromAny(t,"deg"),new $a(sa.zero(),t)}static affine(t=1,e=0,r=0,i=1,n=0,s=0){return new ru(t,e,r,i,n,s)}static list(...t){const e=[];for(let r=0;r<t.length;r+=1){const i=ja.fromAny(t[r]);i instanceof su?e.push(...i.transforms):i instanceof Ba||e.push(i)}return new su(e)}static fromCssValue(t){if(t instanceof CSSTransformValue)return ja.fromCssTransform(t);throw new TypeError(""+t)}static fromCssTransform(t){const e=t.length;if(1===e)return ja.fromCssTransformComponent(t[0]);{const r=new Array(e);for(let i=0;i<e;i+=1)r[i]=ja.fromCssTransformComponent(t[i]);return new su(r)}}static fromCssTransformComponent(t){if(t instanceof CSSTranslate)return Wa.fromCssTransformComponent(t);if(t instanceof CSSRotate)return Qa.fromCssTransformComponent(t);if(t instanceof CSSScale)return Ya.fromCssTransformComponent(t);if(t instanceof CSSSkew)return $a.fromCssTransformComponent(t);if(t instanceof CSSMatrixComponent)return ru.fromCssTransformComponent(t);throw new TypeError(""+t)}static fromAny(t){if(null==t||t instanceof ja)return t;if("string"==typeof t)return ja.parse(t);throw new TypeError(""+t)}static fromValue(t){switch(t.tag){case"identity":return Ba.fromValue(t);case"translate":return Wa.fromValue(t);case"scale":return Ya.fromValue(t);case"rotate":return Qa.fromValue(t);case"skew":return $a.fromValue(t);case"matrix":return ru.fromValue(t);default:return su.fromValue(t)}}static parse(t){let e=Ct.stringInput(t);for(;e.isCont()&&Ct.isWhitespace(e.head());)e=e.step();let r=au.parse(e);if(r.isDone())for(;e.isCont()&&Ct.isWhitespace(e.head());)e=e.step();return e.isCont()&&!r.isError()&&(r=jt.error(Et.unexpected(e))),r.bind()}static form(){return new La(ja.identity())}static isAny(t){return t instanceof ja||"string"==typeof t}}e([s],ja,"identity",null),e([s],ja,"form",null);class La extends ki{constructor(t){super(),Object.defineProperty(this,"unit",{value:t,enumerable:!0})}withUnit(t){return t!==this.unit?new La(t):this}mold(t){return(t=ja.fromAny(t)).toValue()}cast(t){const e=t.toValue();try{if(e instanceof mr){const t=ja.fromValue(e);return null!==t?t:void 0}{const t=e.stringValue(void 0);if(void 0!==t)return ja.parse(t)}}catch(t){}}}class Ka extends jt{constructor(t){super(),this.identOutput=t}feed(t){return Ka.parse(t,this.identOutput)}static parse(t,e){let r=0;for(e=e||Ct.stringOutput();t.isCont()&&(r=t.head(),Ct.isAlpha(r)||Ct.isDigit(r)||45===r);)t=t.step(),e.write(r);if(!t.isEmpty()){const r=e.bind();switch(r){case"translate3d":case"translateX":case"translateY":case"translate":return Xa.parseRest(t,e);case"scaleX":case"scaleY":case"scale":return _a.parseRest(t,e);case"rotate":return Ja.parseRest(t,e);case"skewX":case"skewY":case"skew":return eu.parseRest(t,e);case"matrix":return nu.parseRest(t,e);case"none":return jt.done(ja.identity());default:return jt.error(Et.message("unknown transform function: "+r,t))}}return new Ka(e)}}class Ba extends ja{transform(t,e){return 1===arguments.length?t:new ya(t,e)}transformX(t,e){return t}transformY(t,e){return e}inverse(){return this}toAffine(){return new ru(1,0,0,1,0,0)}toCssValue(){return new CSSKeywordValue("identity")}toValue(){return mr.create(1).attr("identity")}interpolateTo(t){return t instanceof Ba?M(this):super.interpolateTo(t)}conformsTo(t){return t instanceof Ba}equivalentTo(t,e){return t instanceof Ba}equals(t){return t instanceof Ba}hashCode(){return p.hash(Ba)}debug(t){return t=t.write("Transform").write(46).write("identity").write(40).write(41)}toString(){return"none"}static fromValue(t){return"identity"===t.tag?ja.identity():null}}class Wa extends ja{constructor(t,e){super(),this.x=t,this.y=e,this.stringValue=void 0}transform(t,e){return 1===arguments.length?t instanceof Ba?this:t instanceof Wa?new Wa(this.x.plus(t.x),this.y.plus(t.y)):ja.list(this,t):new ya(this.x.pxValue()+t,this.y.pxValue()+e)}transformX(t,e){return this.x.pxValue()+t}transformY(t,e){return this.y.pxValue()+e}inverse(){return new Wa(this.x.negative(),this.y.negative())}toAffine(){return new ru(1,0,0,1,this.x.pxValue(),this.y.pxValue())}toCssTransformComponent(){if("undefined"!=typeof CSSTranslate){const t=this.x.toCssValue(),e=this.y.toCssValue();return new CSSTranslate(t,e)}return null}toValue(){return mr.create(1).attr("translate",mr.create(2).slot("x",this.x.toValue()).slot("y",this.y.toValue()))}interpolateTo(t){return t instanceof Wa?Ha(this,t):super.interpolateTo(t)}conformsTo(t){return t instanceof Wa}equivalentTo(t,e){return t instanceof Wa&&(this.x.equivalentTo(t.x,e)&&this.y.equivalentTo(t.y,e))}equals(t){return t instanceof Wa&&(this.x.equals(t.x)&&this.y.equals(t.y))}hashCode(){return n.mash(n.mix(n.mix(p.hash(Wa),this.x.hashCode()),this.y.hashCode()))}debug(t){return t=t.write("Transform").write(46).write("translate"),t=(t=this.x.isDefined()&&!this.y.isDefined()?t.write("X").write(40).debug(this.x):!this.x.isDefined()&&this.y.isDefined()?t.write("Y").write(40).debug(this.y):t.write(40).debug(this.x).write(", ").debug(this.y)).write(41)}toString(){let t=this.stringValue;return void 0===t&&(t=this.x.isDefined()&&!this.y.isDefined()?"translate("+this.x+",0)":!this.x.isDefined()&&this.y.isDefined()?"translate(0,"+this.y+")":"translate("+this.x+","+this.y+")",this.stringValue=t),t}toAttributeString(){return this.x.isDefined()&&!this.y.isDefined()?"translate("+this.x.pxValue()+",0)":!this.x.isDefined()&&this.y.isDefined()?"translate(0,"+this.y.pxValue()+")":"translate("+this.x.pxValue()+","+this.y.pxValue()+")"}static fromCssTransformComponent(t){const e="number"==typeof t.x?_o.px(t.x):_o.fromCssValue(t.x),r="number"==typeof t.y?_o.px(t.y):_o.fromCssValue(t.y);return new Wa(e,r)}static fromAny(t){if(null==t||t instanceof Wa)return t;if("string"==typeof t)return Wa.parse(t);throw new TypeError(""+t)}static fromValue(t){const e=t.header("translate");if(e.isDefined()){let t=_o.zero(),r=_o.zero();return e.forEach((function(e,i){const n=e.key.stringValue();void 0!==n?"x"===n?t=e.toValue().cast(_o.form(),t):"y"===n&&(r=e.toValue().cast(_o.form(),r)):e instanceof yr&&(0===i?t=e.cast(_o.form(),t):1===i&&(r=e.cast(_o.form(),r)))}),this),new Wa(t,r)}return null}static parse(t){let e=Ct.stringInput(t);for(;e.isCont()&&Ct.isWhitespace(e.head());)e=e.step();let r=Xa.parse(e);if(r.isDone())for(;e.isCont()&&Ct.isWhitespace(e.head());)e=e.step();return e.isCont()&&!r.isError()&&(r=jt.error(Et.unexpected(e))),r.bind()}}const Ha=function(t){const e=function(t,r){const i=function(t){const e=i[0],r=i[1],n=_o.create(e.x.value+t*(r.x.value-e.x.value),r.x.units),s=_o.create(e.y.value+t*(r.y.value-e.y.value),r.y.units);return new Wa(n,s)};return Object.setPrototypeOf(i,e.prototype),i[0]=t.x.units===r.x.units&&t.y.units===r.y.units?t:new Wa(t.x.to(r.x.units),t.y.to(r.y.units)),i[1]=r,i};return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e}(k);class Xa extends jt{constructor(t,e,r,i,n){super(),this.identOutput=t,this.xParser=e,this.yParser=r,this.zParser=i,this.step=n}feed(t){return Xa.parse(t,this.identOutput,this.xParser,this.yParser,this.zParser,this.step)}static parse(t,e,r,i,n,s=1){let o=0;if(1===s){for(e=e||Ct.stringOutput();t.isCont()&&(o=t.head(),Ct.isAlpha(o)||Ct.isDigit(o)||45===o);)t=t.step(),e.write(o);if(!t.isEmpty()){const r=e.bind();switch(r){case"translate3d":case"translateX":case"translateY":case"translate":s=2;break;default:return jt.error(Et.message("unknown transform function: "+r,t))}}}if(2===s){for(;t.isCont()&&(o=t.head(),Ct.isSpace(o));)t=t.step();if(t.isCont()&&40===o)t.step(),s=3;else if(!t.isEmpty())return jt.error(Et.expected("(",t))}if(3===s){if(void 0===r){for(;t.isCont()&&Ct.isSpace(t.head());)t.step();t.isEmpty()||(r=ia.parse(t,"px"))}else r=r.feed(t);if(void 0!==r)if(r.isDone())s=4;else if(r.isError())return r.asError()}if(4===s){for(;t.isCont()&&Ct.isSpace(t.head());)t.step();if(t.isCont())if(o=t.head(),41===o){t.step();const i=e.bind();switch(i){case"translateX":return jt.done(new Wa(r.bind(),Qo.zero()));case"translateY":return jt.done(new Wa(Qo.zero(),r.bind()));default:return jt.error(Et.message("unknown transform function: "+i,t))}}else{if(44!==o)return jt.error(Et.expected(",",t));t.step(),s=5}else if(t.isDone())return jt.error(Et.unexpected(t))}if(5===s){if(void 0===i){for(;t.isCont()&&Ct.isSpace(t.head());)t.step();t.isEmpty()||(i=ia.parse(t,"px"))}else i=i.feed(t);if(void 0!==i)if(i.isDone())s=6;else if(i.isError())return i.asError()}if(6===s){for(;t.isCont()&&Ct.isSpace(t.head());)t.step();if(t.isCont()){if(o=t.head(),41===o){t.step();const n=e.bind();return"translate"===n?jt.done(new Wa(r.bind(),i.bind())):jt.error(Et.message("unknown transform function: "+n,t))}if(44!==o)return jt.error(Et.expected(",",t));t.step(),s=7}else if(t.isDone())return jt.error(Et.unexpected(t))}if(7===s){if(void 0===n){for(;t.isCont()&&Ct.isSpace(t.head());)t.step();t.isEmpty()||(n=ia.parse(t,"px"))}else n=n.feed(t);if(void 0!==n)if(n.isDone())s=8;else if(n.isError())return n.asError()}if(8===s){for(;t.isCont()&&Ct.isSpace(t.head());)t.step();if(t.isCont()&&41===t.head()){t.step();const s=e.bind();return"translate3d"===s&&0===n.bind().value?jt.done(new Wa(r.bind(),i.bind())):jt.error(Et.message("unknown transform function: "+s,t))}if(!t.isEmpty())return jt.error(Et.expected(")",t))}return new Xa(e,r,i,n,s)}static parseRest(t,e){return Xa.parse(t,e,void 0,void 0,void 0,2)}}class Ya extends ja{constructor(t,e){super(),this.x=t,this.y=e,this.stringValue=void 0}transform(t,e){return 1===arguments.length?t instanceof Ba?this:ja.list(this,t):new ya(this.x*t,this.y*e)}transformX(t,e){return this.x*t}transformY(t,e){return this.y*e}inverse(){return new Ya(1/(this.x||1),1/(this.y||1))}toAffine(){return new ru(this.x,0,0,this.y,0,0)}toCssTransformComponent(){return"undefined"!=typeof CSSTranslate?new CSSScale(this.x,this.y):null}toValue(){return mr.create(1).attr("scale",mr.create(2).slot("x",this.x).slot("y",this.y))}interpolateTo(t){return t instanceof Ya?Ga(this,t):super.interpolateTo(t)}conformsTo(t){return t instanceof Ya}equivalentTo(t,e){return t instanceof Ya&&(h.equivalent(this.x,t.x,e)&&h.equivalent(this.y,t.y,e))}equals(t){return t instanceof Ya&&(this.x===t.x&&this.y===t.y)}hashCode(){return n.mash(n.mix(n.mix(p.hash(Ya),h.hash(this.x)),h.hash(this.y)))}debug(t){return t=t.write("Transform").write(46).write("scale"),t=(t=0!==this.x&&0===this.y?t.write("X").write(40).debug(this.x):0===this.x&&0!==this.y?t.write("Y").write(40).debug(this.y):t.write(40).debug(this.x).write(", ").debug(this.y)).write(41)}toString(){let t=this.stringValue;return void 0===t&&(t=0!==this.x&&0===this.y?"scaleX("+this.x+")":0===this.x&&0!==this.y?"scaleY("+this.y+")":"scale("+this.x+","+this.y+")",this.stringValue=t),t}static fromCssTransformComponent(t){const e="number"==typeof t.x?t.x:t.x.to("number").value,r="number"==typeof t.y?t.y:t.y.to("number").value;return new Ya(e,r)}static fromAny(t){if(null==t||t instanceof Ya)return t;if("string"==typeof t)return Ya.parse(t);throw new TypeError(""+t)}static fromValue(t){const e=t.header("scale");if(e.isDefined()){let t=0,r=0;return e.forEach((function(e,i){const n=e.key.stringValue();void 0!==n?"x"===n?t=e.toValue().numberValue(t):"y"===n&&(r=e.toValue().numberValue(r)):e instanceof yr&&(0===i?t=e.numberValue(t):1===i&&(r=e.numberValue(r)))}),this),new Ya(t,r)}return null}static parse(t){let e=Ct.stringInput(t);for(;e.isCont()&&Ct.isWhitespace(e.head());)e=e.step();let r=_a.parse(e);if(r.isDone())for(;e.isCont()&&Ct.isWhitespace(e.head());)e=e.step();return e.isCont()&&!r.isError()&&(r=jt.error(Et.unexpected(e))),r.bind()}}const Ga=function(t){const e=function(t,r){const i=function(t){const e=i[0],r=i[1],n=e.x+t*(r.x-e.x),s=e.y+t*(r.y-e.y);return new Ya(n,s)};return Object.setPrototypeOf(i,e.prototype),i[0]=t,i[1]=r,i};return e.prototype=Object.create(t.prototype),e.prototype.constructor=k,e}(k);class _a extends jt{constructor(t,e,r,i){super(),this.identOutput=t,this.xParser=e,this.yParser=r,this.step=i}feed(t){return _a.parse(t,this.identOutput,this.xParser,this.yParser,this.step)}static parse(t,e,r,i,n=1){let s=0;if(1===n){for(e=e||Ct.stringOutput();t.isCont()&&(s=t.head(),Ct.isAlpha(s));)t=t.step(),e.write(s);if(!t.isEmpty()){const r=e.bind();switch(r){case"scaleX":case"scaleY":case"scale":n=2;break;default:return jt.error(Et.message("unknown transform function: "+r,t))}}}if(2===n){for(;t.isCont()&&(s=t.head(),Ct.isSpace(s));)t=t.step();if(t.isCont()&&40===s)t.step(),n=3;else if(!t.isEmpty())return jt.error(Et.expected("(",t))}if(3===n){if(void 0===r){for(;t.isCont()&&Ct.isSpace(t.head());)t.step();t.isEmpty()||(r=St.parseNumber(t))}else r=r.feed(t);if(void 0!==r)if(r.isDone())n=4;else if(r.isError())return r.asError()}if(4===n){for(;t.isCont()&&Ct.isSpace(t.head());)t.step();if(t.isCont())if(s=t.head(),41===s){t.step();const i=e.bind();switch(i){case"scaleX":return jt.done(new Ya(r.bind(),1));case"scaleY":return jt.done(new Ya(1,r.bind()));default:return jt.error(Et.message("unknown transform function: "+i,t))}}else{if(44!==s)return jt.error(Et.expected(",",t));t.step(),n=5}else if(t.isDone())return jt.error(Et.unexpected(t))}if(5===n){if(void 0===i){for(;t.isCont()&&Ct.isSpace(t.head());)t.step();t.isEmpty()||(i=St.parseNumber(t))}else i=i.feed(t);if(void 0!==i)if(i.isDone())n=6;else if(i.isError())return i.asError()}if(6===n){for(;t.isCont()&&Ct.isSpace(t.head());)t.step();if(t.isCont()&&41===t.head()){t.step();const n=e.bind();return"scale"===n?jt.done(new Ya(r.bind(),i.bind())):jt.error(Et.message("unknown transform function: "+n,t))}if(!t.isEmpty())return jt.error(Et.expected(")",t))}return new _a(e,r,i,n)}static parseRest(t,e){return _a.parse(t,e,void 0,void 0,2)}}class Qa extends ja{constructor(t){super(),this.angle=t,this.stringValue=void 0}transform(t,e){if(1===arguments.length)return t instanceof Ba?this:ja.list(this,t);{const r=this.angle.radValue(),i=Math.cos(r),n=Math.sin(r);return new ya(t*i-e*n,t*n+e*i)}}transformX(t,e){const r=this.angle.radValue();return t*Math.cos(r)-e*Math.sin(r)}transformY(t,e){const r=this.angle.radValue();return t*Math.sin(r)+e*Math.cos(r)}inverse(){return new Qa(this.angle.negative())}toAffine(){const t=this.angle.radValue();return new ru(Math.cos(t),Math.sin(t),-Math.sin(t),Math.cos(t),0,0)}toCssTransformComponent(){if("undefined"!=typeof CSSTranslate){const t=this.angle.toCssValue();return new CSSRotate(t)}return null}toValue(){return mr.create(1).attr("rotate",this.angle.toString())}interpolateTo(t){return t instanceof Qa?Za(this,t):super.interpolateTo(t)}conformsTo(t){return t instanceof Qa}equivalentTo(t,e){return t instanceof Qa&&this.angle.equivalentTo(t.angle,e)}equals(t){return t instanceof Qa&&this.angle.equals(t.angle)}hashCode(){return n.mash(n.mix(p.hash(Qa),this.angle.hashCode()))}debug(t){return t=t.write("Transform").write(46).write("rotate").write(40).debug(this.angle).write(41)}toString(){let t=this.stringValue;return void 0===t&&(t="rotate("+this.angle+")",this.stringValue=t),t}toAttributeString(){return"rotate("+this.angle.degValue()+")"}static fromCssTransformComponent(t){const e=na.fromCssValue(t.angle);return new Qa(e)}static fromAny(t){if(null==t||t instanceof Qa)return t;if("string"==typeof t)return Qa.parse(t);throw new TypeError(""+t)}static fromValue(t){const e=t.header("rotate");if(e.isDefined()){let t=na.zero();return e.forEach((function(e,r){"angle"===e.key.stringValue()?t=e.toValue().cast(na.form(),t):e instanceof yr&&0===r&&(t=e.cast(na.form(),t))}),this),new Qa(t)}return null}static parse(t){let e=Ct.stringInput(t);for(;e.isCont()&&Ct.isWhitespace(e.head());)e=e.step();let r=Ja.parse(e);if(r.isDone())for(;e.isCont()&&Ct.isWhitespace(e.head());)e=e.step();return e.isCont()&&!r.isError()&&(r=jt.error(Et.unexpected(e))),r.bind()}}const Za=function(t){const e=function(t,r){const i=function(t){const e=i[0],r=i[1],n=na.create(e.angle.value+t*(r.angle.value-e.angle.value),r.angle.units);return new Qa(n)};return Object.setPrototypeOf(i,e.prototype),i[0]=t.angle.units===r.angle.units?t:new Qa(t.angle.to(r.angle.units)),i[1]=r,i};return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e}(k);class Ja extends jt{constructor(t,e,r){super(),this.identOutput=t,this.angleParser=e,this.step=r}feed(t){return Ja.parse(t,this.identOutput,this.angleParser,this.step)}static parse(t,e,r,i=1){let n=0;if(1===i){for(e=e||Ct.stringOutput();t.isCont()&&(n=t.head(),Ct.isAlpha(n));)t=t.step(),e.write(n);if(!t.isEmpty()){const r=e.bind();if("rotate"!==r)return jt.error(Et.message("unknown transform function: "+r,t));i=2}}if(2===i){for(;t.isCont()&&(n=t.head(),Ct.isSpace(n));)t=t.step();if(t.isCont()&&40===n)t.step(),i=3;else if(!t.isEmpty())return jt.error(Et.expected("(",t))}if(3===i){if(void 0===r){for(;t.isCont()&&Ct.isSpace(t.head());)t.step();t.isEmpty()||(r=ca.parse(t,"deg"))}else r=r.feed(t);if(void 0!==r)if(r.isDone())i=4;else if(r.isError())return r.asError()}if(4===i){for(;t.isCont()&&Ct.isSpace(t.head());)t.step();if(t.isCont()&&41===t.head()){t.step();const i=e.bind();return"rotate"===i?jt.done(new Qa(r.bind())):jt.error(Et.message("unknown transform function: "+i,t))}if(!t.isEmpty())return jt.error(Et.expected(")",t))}return new Ja(e,r,i)}static parseRest(t,e){return Ja.parse(t,e,void 0,2)}}class $a extends ja{constructor(t,e){super(),this.x=t,this.y=e,this.stringValue=void 0}transform(t,e){return 1===arguments.length?t instanceof Ba?this:ja.list(this,t):new ya(Math.tan(this.x.radValue())*e+t,Math.tan(this.y.radValue())*t+e)}transformX(t,e){return Math.tan(this.x.radValue())*e+t}transformY(t,e){return Math.tan(this.y.radValue())*t+e}inverse(){return new $a(this.x.negative(),this.y.negative())}toAffine(){const t=this.x.radValue(),e=this.y.radValue();return new ru(1,Math.tan(e),Math.tan(t),1,0,0)}toCssTransformComponent(){if("undefined"!=typeof CSSTranslate){const t=this.x.toCssValue(),e=this.y.toCssValue();return new CSSSkew(t,e)}return null}toValue(){return mr.create(1).attr("skew",mr.create(2).slot("x",this.x.toValue()).slot("y",this.y.toValue()))}interpolateTo(t){return t instanceof $a?tu(this,t):super.interpolateTo(t)}conformsTo(t){return t instanceof $a}equivalentTo(t,e){return t instanceof $a&&(this.x.equivalentTo(t.x,e)&&this.y.equivalentTo(t.y,e))}equals(t){return t instanceof $a&&(this.x.equals(t.x)&&this.y.equals(t.y))}hashCode(){return n.mash(n.mix(n.mix(p.hash($a),this.x.hashCode()),this.y.hashCode()))}debug(t){return t=t.write("Transform").write(46).write("skew"),t=(t=this.x.isDefined()&&!this.y.isDefined()?t.write("X").write(40).debug(this.x):!this.x.isDefined()&&this.y.isDefined()?t.write("Y").write(40).debug(this.y):t.write(40).debug(this.x).write(", ").debug(this.y)).write(41)}toString(){let t=this.stringValue;return void 0===t&&(t=this.x.isDefined()&&!this.y.isDefined()?"skewX("+this.x+")":!this.x.isDefined()&&this.y.isDefined()?"skewY("+this.y+")":"skew("+this.x+","+this.y+")",this.stringValue=t),t}toAttributeString(){return this.x.isDefined()&&!this.y.isDefined()?"skewX("+this.x.degValue()+")":!this.x.isDefined()&&this.y.isDefined()?"skewY("+this.y.degValue()+")":"skew("+this.x.degValue()+","+this.y.degValue()+")"}static fromCssTransformComponent(t){const e="number"==typeof t.ax?na.rad(t.ax):na.fromCssValue(t.ax),r="number"==typeof t.ay?na.rad(t.ay):na.fromCssValue(t.ay);return new $a(e,r)}static fromAny(t){if(null==t||t instanceof $a)return t;if("string"==typeof t)return $a.parse(t);throw new TypeError(""+t)}static fromValue(t){const e=t.header("skew");if(e.isDefined()){let t=na.zero(),r=na.zero();return e.forEach((function(e,i){const n=e.key.stringValue();void 0!==n?"x"===n?t=e.toValue().cast(na.form(),t):"y"===n&&(r=e.toValue().cast(na.form(),r)):e instanceof yr&&(0===i?t=e.cast(na.form(),t):1===i&&(r=e.cast(na.form(),r)))}),this),new $a(t,r)}return null}static parse(t){let e=Ct.stringInput(t);for(;e.isCont()&&Ct.isWhitespace(e.head());)e=e.step();let r=eu.parse(e);if(r.isDone())for(;e.isCont()&&Ct.isWhitespace(e.head());)e=e.step();return e.isCont()&&!r.isError()&&(r=jt.error(Et.unexpected(e))),r.bind()}}const tu=function(t){const e=function(t,r){const i=function(t){const e=i[0],r=i[1],n=na.create(e.x.value+t*(r.x.value-e.x.value),r.x.units),s=na.create(e.y.value+t*(r.y.value-e.y.value),r.y.units);return new $a(n,s)};return Object.setPrototypeOf(i,e.prototype),i[0]=t.x.units===r.x.units&&t.y.units===r.y.units?t:new $a(t.x.to(r.x.units),t.y.to(r.y.units)),i[1]=r,i};return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e}(k);class eu extends jt{constructor(t,e,r,i){super(),this.identOutput=t,this.xParser=e,this.yParser=r,this.step=i}feed(t){return eu.parse(t,this.identOutput,this.xParser,this.yParser,this.step)}static parse(t,e,r,i,n=1){let s=0;if(1===n){for(e=e||Ct.stringOutput();t.isCont()&&(s=t.head(),Ct.isAlpha(s));)t=t.step(),e.write(s);if(!t.isEmpty()){const r=e.bind();switch(r){case"skewX":case"skewY":case"skew":n=2;break;default:return jt.error(Et.message("unknown transform function: "+r,t))}}}if(2===n){for(;t.isCont()&&(s=t.head(),Ct.isSpace(s));)t=t.step();if(t.isCont()&&40===s)t.step(),n=3;else if(!t.isEmpty())return jt.error(Et.expected("(",t))}if(3===n){if(void 0===r){for(;t.isCont()&&Ct.isSpace(t.head());)t.step();t.isEmpty()||(r=ca.parse(t,"deg"))}else r=r.feed(t);if(void 0!==r)if(r.isDone())n=4;else if(r.isError())return r.asError()}if(4===n){for(;t.isCont()&&Ct.isSpace(t.head());)t.step();if(t.isCont())if(s=t.head(),41===s){t.step();const i=e.bind();switch(i){case"skewX":return jt.done(new $a(r.bind(),sa.zero()));case"skewY":return jt.done(new $a(sa.zero(),r.bind()));default:return jt.error(Et.message("unknown transform function: "+i,t))}}else{if(44!==s)return jt.error(Et.expected(",",t));t.step(),n=5}else if(t.isDone())return jt.error(Et.unexpected(t))}if(5===n){if(void 0===i){for(;t.isCont()&&Ct.isSpace(t.head());)t.step();t.isEmpty()||(i=ca.parse(t,"deg"))}else i=i.feed(t);if(void 0!==i)if(i.isDone())n=6;else if(i.isError())return i.asError()}if(6===n){for(;t.isCont()&&Ct.isSpace(t.head());)t.step();if(t.isCont()&&41===t.head()){t.step();const n=e.bind();return"skew"===n?jt.done(new $a(r.bind(),i.bind())):jt.error(Et.message("unknown transform function: "+n,t))}if(!t.isEmpty())return jt.error(Et.expected(")",t))}return new eu(e,r,i,n)}static parseRest(t,e){return eu.parse(t,e,void 0,void 0,2)}}class ru extends ja{constructor(t,e,r,i,n,s){super(),this.x0=t,this.y0=e,this.x1=r,this.y1=i,this.tx=n,this.ty=s,this.stringValue=void 0}transform(t,e){return 1===arguments.length?t instanceof Ba?this:this.multiply(t.toAffine()):new ya(this.x0*t+this.x1*e+this.tx,this.y0*t+this.y1*e+this.ty)}transformX(t,e){return this.x0*t+this.x1*e+this.tx}transformY(t,e){return this.y0*t+this.y1*e+this.ty}inverse(){const t=this.x0,e=this.y0,r=this.x1,i=this.y1,n=this.tx,s=this.ty,o=t*i-r*e;if(Math.abs(o)>=Number.MIN_VALUE)return new ru(i/o,-e/o,-r/o,t/o,(r*s-i*n)/o,(e*n-t*s)/o);throw new Error("non-invertible affine transform with determinant "+o)}multiply(t){const e=this.x0*t.x0+this.x1*t.y0,r=this.y0*t.x0+this.y1*t.y0,i=this.x0*t.x1+this.x1*t.y1,n=this.y0*t.x1+this.y1*t.y1,s=this.x0*t.tx+this.x1*t.ty,o=this.y0*t.tx+this.y1*t.ty;return new ru(e,r,i,n,s,o)}toAffine(){return this}toMatrix(){return new DOMMatrix([this.x0,this.y0,this.x1,this.y1,this.tx,this.ty])}toCssTransformComponent(){return"undefined"!=typeof CSSTranslate?new CSSMatrixComponent(this.toMatrix()):null}toValue(){return mr.create(1).attr("matrix",mr.create(6).item(this.x0).item(this.y0).item(this.x1).item(this.y1).item(this.tx).item(this.ty))}interpolateTo(t){return t instanceof ru?iu(this,t):super.interpolateTo(t)}conformsTo(t){return t instanceof ru}equivalentTo(t,e){return t instanceof ru&&(h.equivalent(this.x0,t.x0,e)&&h.equivalent(this.y0,t.y0,e)&&h.equivalent(this.x1,t.x1,e)&&h.equivalent(this.y1,t.y1,e)&&h.equivalent(this.tx,t.tx,e)&&h.equivalent(this.ty,t.ty,e))}equals(t){return t instanceof ru&&(this.x0===t.x0&&this.y0===t.y0&&this.x1===t.x1&&this.y1===t.y1&&this.tx===t.tx&&this.ty===t.ty)}hashCode(){return n.mash(n.mix(n.mix(n.mix(n.mix(n.mix(n.mix(p.hash(ru),h.hash(this.x0)),h.hash(this.y0)),h.hash(this.x1)),h.hash(this.y1)),h.hash(this.tx)),h.hash(this.ty)))}debug(t){return t=t.write("Transform").write(46).write("affine").write(40).debug(this.x0).write(", ").debug(this.y0).write(", ").debug(this.x1).write(", ").debug(this.y1).write(", ").debug(this.tx).write(", ").debug(this.ty).write(41)}toString(){let t=this.stringValue;return void 0===t&&(t="matrix("+this.x0+","+this.y0+","+this.x1+","+this.y1+","+this.tx+","+this.ty+")",this.stringValue=t),t}static identity(){return new ru(1,0,0,1,0,0)}static fromAny(t){if(null==t||t instanceof ru)return t;if("string"==typeof t)return ru.parse(t);throw new TypeError(""+t)}static fromMatrix(t){return new ru(t.a,t.b,t.c,t.d,t.e,t.f)}static fromCssTransformComponent(t){return ru.fromMatrix(t.matrix)}static fromValue(t){const e=t.header("matrix");if(e.isDefined()){let t=0,r=0,i=0,n=0,s=0,o=0;return e.forEach((function(e,a){const u=e.key.stringValue();if(void 0!==u)"x0"===u?t=e.toValue().numberValue(t):"y0"===u?r=e.toValue().numberValue(r):"x1"===u?i=e.toValue().numberValue(i):"y1"===u?n=e.toValue().numberValue(n):"tx"===u?s=e.toValue().numberValue(s):"ty"===u&&(o=e.toValue().numberValue(o));else if(e instanceof yr)switch(a){case 0:t=e.numberValue(t);break;case 1:r=e.numberValue(r);break;case 2:i=e.numberValue(i);break;case 3:n=e.numberValue(n);break;case 4:s=e.numberValue(s);break;case 5:o=e.numberValue(o)}}),this),new ru(t,r,i,n,s,o)}return null}static parse(t){let e=Ct.stringInput(t);for(;e.isCont()&&Ct.isWhitespace(e.head());)e=e.step();let r=nu.parse(e);if(r.isDone())for(;e.isCont()&&Ct.isWhitespace(e.head());)e=e.step();return e.isCont()&&!r.isError()&&(r=jt.error(Et.unexpected(e))),r.bind()}}e([s],ru,"identity",null);const iu=function(t){const e=function(t,r){const i=function(t){const e=i[0],r=i[1],n=e.x0+t*(r.x0-e.x0),s=e.y0+t*(r.y0-e.y0),o=e.x1+t*(r.x1-e.x1),a=e.y1+t*(r.y1-e.y1),u=e.tx+t*(r.tx-e.tx),h=e.ty+t*(r.ty-e.ty);return new ru(n,s,o,a,u,h)};return Object.setPrototypeOf(i,e.prototype),i[0]=t,i[1]=r,i};return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e}(k);class nu extends jt{constructor(t,e,r,i){super(),this.identOutput=t,this.entries=e,this.entryParser=r,this.step=i}feed(t){return nu.parse(t,this.identOutput,this.entries,this.entryParser,this.step)}static parse(t,e,r=[],i,n=1){let s=0;if(1===n){for(e=e||Ct.stringOutput();t.isCont()&&(s=t.head(),Ct.isAlpha(s));)t=t.step(),e.write(s);if(!t.isEmpty()){const r=e.bind();if("matrix"!==r)return jt.error(Et.message("unknown transform function: "+r,t));n=2}}if(2===n){for(;t.isCont()&&(s=t.head(),Ct.isSpace(s));)t=t.step();if(t.isCont()&&40===s)t.step(),n=3;else if(!t.isEmpty())return jt.error(Et.expected("(",t))}for(;;){if(3===n){if(void 0===i){for(;t.isCont()&&Ct.isSpace(t.head());)t.step();t.isEmpty()||(i=St.parseNumber(t))}else i=i.feed(t);if(void 0!==i)if(i.isDone())r.push(i.bind()),i=void 0,n=4;else if(i.isError())return i.asError()}if(4===n){for(;t.isCont()&&Ct.isSpace(t.head());)t.step();if(t.isCont()){if(s=t.head(),41===s){t.step();const i=e.bind();return"matrix"===i?jt.done(ja.affine(...r)):jt.error(Et.message("unknown transform function: "+i,t))}if(r.length>=6)return jt.error(Et.expected(")",t));if(44===s){t.step(),n=3;continue}return jt.error(Et.expected(",",t))}if(t.isDone())return jt.error(Et.unexpected(t))}break}return new nu(e,r,i,n)}static parseRest(t,e){return nu.parse(t,e,void 0,void 0,2)}}class su extends ja{constructor(t){super(),this.transforms=t,this.stringValue=void 0}transform(t,e){if(1===arguments.length)return t instanceof Ba?this:ja.list(this,t);{const r=this.transforms;for(let i=0,n=r.length;i<n;i+=1){const n=r[i],s=n.transformX(t,e),o=n.transformY(t,e);t=s,e=o}return new ya(t,e)}}transformX(t,e){const r=this.transforms;for(let i=0,n=r.length;i<n;i+=1){const n=r[i],s=n.transformX(t,e),o=n.transformY(t,e);t=s,e=o}return t}transformY(t,e){const r=this.transforms;for(let i=0,n=r.length;i<n;i+=1){const n=r[i],s=n.transformX(t,e),o=n.transformY(t,e);t=s,e=o}return e}inverse(){const t=this.transforms,e=t.length,r=new Array(e);for(let i=0;i<e;i+=1)r[i]=t[e-i-1].inverse();return new su(r)}toAffine(){let t=ru.identity();const e=this.transforms;for(let r=0,i=e.length;r<i;r+=1)t=t.multiply(e[r].toAffine());return t}toCssTransformComponent(){return"undefined"!=typeof CSSTranslate?new CSSMatrixComponent(this.toMatrix()):null}toCssValue(){if("undefined"!=typeof CSSTransformValue){const t=this.transforms,e=t.length,r=new Array(e);for(let e=0,i=t.length;e<i;e+=1){const i=t[e].toCssTransformComponent();if(null===i)return null;r[e]=i}return new CSSTransformValue(r)}return null}toValue(){const t=this.transforms,e=t.length,r=mr.create(e);for(let i=0;i<e;i+=1)r.push(t[i].toValue());return r}interpolateTo(t){return t instanceof su?ou(this,t):super.interpolateTo(t)}conformsTo(t){if(t instanceof su){const e=this.transforms.length;if(e===t.transforms.length){for(let r=0;r<e;r+=1)if(!this.transforms[r].conformsTo(t.transforms[r]))return!1;return!0}}return!1}equivalentTo(t,e){if(t instanceof su){const r=this.transforms.length;if(r===t.transforms.length){for(let i=0;i<r;i+=1)if(!this.transforms[i].equivalentTo(t.transforms[i],e))return!1;return!0}}return!1}equals(t){if(t instanceof su){const e=this.transforms.length;if(e===t.transforms.length){for(let r=0;r<e;r+=1)if(!this.transforms[r].equals(t.transforms[r]))return!1;return!0}}return!1}hashCode(){let t=p.hash(su);const e=this.transforms;for(let r=0,i=e.length;r<i;r+=1)t=n.mix(t,e[r].hashCode());return n.mash(t)}debug(t){t=t.write("Transform").write(46).write("list").write(40);const e=this.transforms,r=e.length;if(r>0){t=t.debug(e[0]);for(let i=1;i<r;i+=1)t=t.write(", ").debug(e[i])}return t=t.write(41)}toString(){let t=this.stringValue;if(void 0===t){const e=this.transforms,r=e.length;if(r>0){t=e[0].toString();for(let i=1;i<r;i+=1)t+=" ",t+=e[i].toString()}else t="none";this.stringValue=t}return t}toAttributeString(){const t=this.transforms,e=t.length;if(e>0){let r=t[0].toAttributeString();for(let i=1;i<e;i+=1)r+=" ",r+=t[i].toAttributeString();return r}return""}static fromAny(t){if(null==t||t instanceof su)return t;if("string"==typeof t)return su.parse(t);throw new TypeError(""+t)}static fromValue(t){const e=[];return t.forEach((function(t){const r=ja.fromValue(t.toValue());null!==r&&e.push(r)}),this),0!==e.length?new su(e):null}static parse(t){const e=ja.parse(t);return e instanceof su?e:new su([e])}}const ou=function(t){const e=function(t,r){const i=function(t){const e=i.interpolators,r=e.length,n=new Array(r);for(let i=0;i<r;i+=1)n[i]=e[i](t);return new su(n)};Object.setPrototypeOf(i,e.prototype);const n=t.transforms,s=r.transforms,o=Math.min(n.length,s.length),a=new Array(o);for(let t=0;t<o;t+=1)a[t]=n[t].interpolateTo(s[t]);return i.interpolators=a,i};return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,Object.defineProperty(e.prototype,0,{get(){const t=this.interpolators,e=t.length,r=new Array(e);for(let i=0;i<e;i+=1)r[i]=t[i][0];return new su(r)},configurable:!0}),Object.defineProperty(e.prototype,1,{get(){const t=this.interpolators,e=t.length,r=new Array(e);for(let i=0;i<e;i+=1)r[i]=t[i][1];return new su(r)},configurable:!0}),e.prototype.equals=function(t){if(this===t)return!0;if(t instanceof e){const e=this.interpolators.length;if(e===t.interpolators.length){for(let r=0;r<e;r+=1)if(!this.interpolators[r].equals(t.interpolators[r]))return!1;return!0}}return!1},e}(k);class au extends jt{constructor(t,e){super(),this.transform=t,this.transformParser=e}feed(t){return au.parse(t,this.transform,this.transformParser)}static parse(t,e=ja.identity(),r){for(;;){if(void 0===r){for(;t.isCont()&&Ct.isSpace(t.head());)t.step();if(t.isCont())r=Ka.parse(t);else if(t.isDone())return jt.done(e)}if(void 0!==r){if((r=r.feed(t)).isDone()){e=e.transform(r.bind()),r=void 0;continue}if(r.isError())return r.asError()}break}return new au(e,r)}}const uu=function(){const t={is:function(t){if(null!=t){const e=t;return"function"==typeof e.project&&"function"==typeof e.unproject}return!1}};return t}();class hu{union(t){return t=hu.fromAny(t),new vu(Math.min(this.lngMin,t.lngMin),Math.min(this.latMin,t.latMin),Math.max(this.lngMax,t.lngMax),Math.max(this.latMax,t.latMax))}get bounds(){return new vu(this.lngMin,this.latMin,this.lngMax,this.latMax)}static fromAny(t){if(null==t||t instanceof hu)return t;if(lu.isInit(t))return lu.fromInit(t);if(lu.isTuple(t))return lu.fromTuple(t);if(pu.isInit(t))return pu.fromInit(t);if(bu.isInit(t))return bu.fromInit(t);if(bu.isTuple(t))return bu.fromTuple(t);if(vu.isInit(t))return vu.fromInit(t);throw new TypeError(""+t)}static isAny(t){return t instanceof hu||lu.isInit(t)||lu.isTuple(t)||pu.isInit(t)||bu.isInit(t)||vu.isInit(t)}}class lu extends hu{constructor(t,e){super(),this.lng=t,this.lat=e}isDefined(){return isFinite(this.lng)&&isFinite(this.lat)}get lngMin(){return this.lng}get latMin(){return this.lat}get lngMax(){return this.lng}get latMax(){return this.lat}contains(t,e){return"number"==typeof t?this.lng===t&&this.lat===e:(t=hu.fromAny(t))instanceof lu?this.lng===t.lng&&this.lat===t.lat:t instanceof hu&&(this.lng<=t.lngMin&&t.lngMax<=this.lng&&this.lat<=t.latMin&&t.latMax<=this.lat)}intersects(t){return(t=hu.fromAny(t)).intersects(this)}project(t){return t.project(this)}normalized(){const t=this.lng,e=this.lat,r=lu.normalizeLng(t),i=lu.normalizeLat(e);return t===r&&e===i?this:new lu(r,i)}toAny(){return{lng:this.lng,lat:this.lat}}interpolateTo(t){return t instanceof lu?cu(this,t):null}equivalentTo(t,e){return this===t||t instanceof lu&&(h.equivalent(this.lng,t.lng,e)&&h.equivalent(this.lat,t.lat,e))}equals(t){return this===t||t instanceof lu&&(this.lng===t.lng&&this.lat===t.lat)}hashCode(){return n.mash(n.mix(n.mix(p.hash(lu),h.hash(this.lng)),h.hash(this.lat)))}debug(t){return t=t.write("GeoPoint").write(46).write("of").write(40).debug(this.lng).write(", ").debug(this.lat).write(41)}toString(){return Ot.debug(this)}static origin(){return new lu(0,0)}static undefined(){return new lu(NaN,NaN)}static of(t,e){return new lu(t,e)}static fromInit(t){return new lu(t.lng,t.lat)}static fromTuple(t){return new lu(t[0],t[1])}static fromAny(t){if(null==t||t instanceof lu)return t;if(lu.isInit(t))return lu.fromInit(t);if(lu.isTuple(t))return lu.fromTuple(t);throw new TypeError(""+t)}static normalized(t,e){return t=lu.normalizeLng(t),e=lu.normalizeLat(e),new lu(t,e)}static normalizeLng(t){return t<-180?t=180-(180-t)%360:t>180&&(t=(t-180)%360-180),t}static normalizeLat(t){return t=Math.min(Math.max(-90+u.Epsilon,t),90-u.Epsilon)}static isInit(t){if("object"==typeof t&&null!==t){const e=t;return"number"==typeof e.lng&&"number"==typeof e.lat}return!1}static isTuple(t){return Array.isArray(t)&&2===t.length&&"number"==typeof t[0]&&"number"==typeof t[1]}static isAny(t){return t instanceof lu||lu.isInit(t)||lu.isTuple(t)}}e([s],lu,"origin",null),e([s],lu,"undefined",null);const cu=function(t){const e=function(t,r){const i=function(t){const e=i[0],r=e.lng,n=e.lat,s=i[1],o=s.lng,a=s.lat;let u;if(r>0&&o<0&&r-o>180){const e=180-r,i=180+o,n=e/(e+i);if(t<n)u=r+t/n*e;else{u=(t-n)/(1-n)*i-180}}else if(r<0&&o>0&&o-r>180){const e=180+r,i=180-o,n=e/(e+i);if(t<n)u=r-t/n*e;else{u=180-(t-n)/(1-n)*i}}else u=r+t*(o-r);return new lu(u,n+t*(a-n))};return Object.setPrototypeOf(i,e.prototype),i[0]=t.normalized(),i[1]=r.normalized(),i};return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e}(k);class du extends hu{}class pu extends du{constructor(t,e,r,i){super(),this.lng0=t,this.lat0=e,this.lng1=r,this.lat1=i}isDefined(){return isFinite(this.lng0)&&isFinite(this.lat0)&&isFinite(this.lng1)&&isFinite(this.lat1)}get lngMin(){return Math.min(this.lng0,this.lng1)}get latMin(){return Math.min(this.lat0,this.lat1)}get lngMax(){return Math.max(this.lng0,this.lng1)}get latMax(){return Math.max(this.lat0,this.lat1)}interpolateLng(t){return(1-t)*this.lng0+t*this.lng1}interpolateLat(t){return(1-t)*this.lat0+t*this.lat1}interpolate(t){const e=1-t,r=e*this.lng0+t*this.lng1,i=e*this.lat0+t*this.lat1;return new lu(r,i)}contains(t,e){return"number"==typeof t?ba.contains(this.lng0,this.lat0,this.lng1,this.lat1,t,e):(t=hu.fromAny(t))instanceof lu?this.containsPoint(t):t instanceof pu&&this.containsSegment(t)}containsPoint(t){return ba.contains(this.lng0,this.lat0,this.lng1,this.lat1,t.lng,t.lat)}containsSegment(t){return ba.contains(this.lng0,this.lat0,this.lng1,this.lat1,t.lng0,t.lat0)&&ba.contains(this.lng0,this.lat0,this.lng1,this.lat1,t.lng1,t.lat1)}intersects(t){return(t=hu.fromAny(t))instanceof lu?this.intersectsPoint(t):t instanceof pu?this.intersectsSegment(t):t.intersects(this)}intersectsPoint(t){return ba.contains(this.lng0,this.lat0,this.lng1,this.lat1,t.lng,t.lat)}intersectsSegment(t){return ba.intersects(this.lng0,this.lat0,this.lng1-this.lat0,this.lng1-this.lat0,t.lng0,t.lat0,t.lng1-t.lat0,t.lng1-t.lat0)}split(t){const e=1-t,r=e*this.lng0+t*this.lng1,i=e*this.lat0+t*this.lat1;return[new pu(this.lng0,this.lat0,r,i),new pu(r,i,this.lng1,this.lat1)]}project(t){const e=t.project(this.lng0,this.lat0),r=t.project(this.lng1,this.lat1);return new ba(e.x,e.y,r.x,r.y)}forEachCoord(t,e){let r;return r=t.call(e,this.lng0,this.lat0),void 0!==r?r:(r=t.call(e,this.lng1,this.lat1),void 0!==r?r:void 0)}forEachCoordRest(t,e){const r=t.call(e,this.lng1,this.lat1);if(void 0!==r)return r}toAny(){return{lng0:this.lng0,lat0:this.lat0,lng1:this.lng1,lat1:this.lat1}}interpolateTo(t){return t instanceof pu?fu(this,t):null}equivalentTo(t,e){return this===t||t instanceof pu&&(h.equivalent(this.lng0,t.lng0,e)&&h.equivalent(this.lat0,t.lat0,e)&&h.equivalent(this.lng1,t.lng1,e)&&h.equivalent(this.lat1,t.lat1,e))}equals(t){return this===t||t instanceof pu&&(this.lng0===t.lng0&&this.lat0===t.lat0&&this.lng1===t.lng1&&this.lat1===t.lat1)}hashCode(){return n.mash(n.mix(n.mix(n.mix(n.mix(p.hash(pu),h.hash(this.lng0)),h.hash(this.lat0)),h.hash(this.lng1)),h.hash(this.lat1)))}debug(t){return t=t.write("GeoSegment").write(46).write("of").write(40).debug(this.lng0).write(", ").debug(this.lat0).write(", ").debug(this.lng1).write(", ").debug(this.lat1).write(41)}toString(){return Ot.debug(this)}static of(t,e,r,i){return new pu(t,e,r,i)}static fromInit(t){return new pu(t.lng0,t.lat0,t.lng1,t.lat1)}static fromAny(t){if(null==t||t instanceof pu)return t;if(pu.isInit(t))return pu.fromInit(t);throw new TypeError(""+t)}static isInit(t){if("object"==typeof t&&null!==t){const e=t;return"number"==typeof e.lng0&&"number"==typeof e.lat0&&"number"==typeof e.lng1&&"number"==typeof e.lat1}return!1}static isAny(t){return t instanceof pu||pu.isInit(t)}}const fu=function(t){const e=function(t,r){const i=function(t){const e=i[0],r=i[1],n=e.lng0+t*(r.lng0-e.lng0),s=e.lat0+t*(r.lat0-e.lat0),o=e.lng1+t*(r.lng1-e.lng1),a=e.lat1+t*(r.lat1-e.lat1);return new pu(n,s,o,a)};return Object.setPrototypeOf(i,e.prototype),i[0]=t,i[1]=r,i};return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e}(k);class yu extends du{constructor(t,e){super(),this.curves=t,this.closed=e,this.boundingBox=null}isDefined(){return 0!==this.curves.length}isClosed(){return this.closed}get lngMin(){return this.bounds.lngMin}get latMin(){return this.bounds.latMin}get lngMax(){return this.bounds.lngMax}get latMax(){return this.bounds.latMax}interpolateLng(t){const e=this.curves,r=e.length;if(r>0){const i=1/r,n=Math.min(Math.max(0,Math.floor(t/i)),r),s=t*r-n*i;return e[n].interpolateLng(s)}return NaN}interpolateLat(t){const e=this.curves,r=e.length;if(r>0){const i=1/r,n=Math.min(Math.max(0,Math.floor(t/i)),r),s=t*r-n*i;return e[n].interpolateLat(s)}return NaN}interpolate(t){const e=this.curves,r=e.length;if(r>0){const i=1/r,n=Math.min(Math.max(0,Math.floor(t/i)),r),s=t*r-n*i;return e[n].interpolate(s)}return new lu(NaN,NaN)}contains(t,e){return!1}intersects(t){return!1}split(t){const e=this.curves,r=e.length;if(r>0){const i=1/r,n=Math.min(Math.max(0,Math.floor(t/i)),r),s=t*r-n*i,[o,a]=e[n].split(s),u=new Array(n+1),h=new Array(r-n);for(let t=0;t<n;t+=1)u[t]=e[t];u[n]=o,h[0]=a;for(let t=n+1;t<r;t+=1)h[t-n]=e[t];return[new yu(u,!1),new yu(h,!1)]}return[yu.empty(),yu.empty()]}subdivide(t){const e=this.curves,r=e.length;if(r>0){const i=1/r,n=Math.min(Math.max(0,Math.floor(t/i)),r),s=t*r-n*i,[o,a]=e[n].split(s),u=new Array(r+1);for(let t=0;t<n;t+=1)u[t]=e[t];u[n]=o,u[n+1]=a;for(let t=n+1;t<r;t+=1)u[t+1]=e[t];return new yu(u,this.closed)}return yu.empty()}project(t){const e=this.curves,r=e.length;if(r>0){let i=0;const n=new Array(r);let s=e[0];if(s instanceof pu){let o=t.project(s.lng0,s.lat0);for(;i<r&&(s=e[i],s instanceof pu);){const e=t.project(s.lng1,s.lat1);n[i]=new ba(o.x,o.y,e.x,e.y),o=e,i+=1}}for(;i<r;)s=e[i],n[i]=s.project(t),i+=1;return new Da(n,this.closed)}return Da.empty()}get bounds(){let t=this.boundingBox;if(null===t){let e=1/0,r=1/0,i=-1/0,n=-1/0;const s=this.curves;for(let t=0,o=s.length;t<o;t+=1){const o=s[t];e=Math.min(e,o.lngMin),r=Math.min(r,o.latMin),i=Math.max(o.lngMax,i),n=Math.max(o.latMax,n)}t=new vu(e,r,i,n),this.boundingBox=t}return t}forEachCoord(t,e){const r=this.curves,i=r.length;if(i>0){let n=r[0],s=n.forEachCoord(t,e);if(void 0!==s)return s;for(let o=1;o<i;o+=1)if(n=r[o],s=n.forEachCoordRest(t,e),void 0!==s)return s}}forEachCoordRest(t,e){const r=this.curves;for(let i=0,n=r.length;i<n;i+=1){const n=r[i].forEachCoordRest(t,e);if(void 0!==n)return n}}equivalentTo(t,e){return this===t||t instanceof yu&&(v.equivalent(this.curves,t.curves,e)&&this.closed===t.closed)}equals(t){return this===t||t instanceof yu&&(v.equal(this.curves,t.curves)&&this.closed===t.closed)}debug(t){const e=this.curves,r=e.length;if(t=t.write("GeoSpline").write(46),0===r)t=t.write("empty").write(40);else if(0!==r){t=(t=t.write(this.closed?"closed":"open").write(40)).debug(e[0]);for(let i=1;i<r;i+=1)t=t.write(", ").debug(e[i])}return t=t.write(41)}toString(){return Ot.debug(this)}static empty(){return new yu([],!1)}static open(...t){return new yu(t,!1)}static closed(...t){return new yu(t,!0)}static fromPoints(t){const e=t.length;if(e>1){const r=new Array(e-1),i=lu.fromAny(t[0]);let n=i;for(let i=1;i<e;i+=1){const e=lu.fromAny(t[i]);r[i-1]=new pu(n.lng,n.lat,e.lng,e.lat),n=e}const s=i.equals(n);return new yu(r,s)}return yu.empty()}static fromAny(t){return null==t||t instanceof yu?t:yu.isPoints(t)?yu.fromPoints(t):hu.fromAny(t)}static builder(){return new mu}static isPoints(t){return Array.isArray(t)&&t.length>=2&&lu.isAny(t[0])}static isAnySpline(t){return t instanceof yu||yu.isPoints(t)}}class mu{constructor(){this.curves=[],this.closed=!1,this.aliased=!1,this.lng0=0,this.lat0=0,this.lng=0,this.lat=0}dealias(){this.aliased&&(this.curves=this.curves.slice(0),this.aliased=!1)}moveTo(t,e){this.aliased?(this.curves=[],this.aliased=!1):this.curves.length=0,this.closed=!1,this.lng0=t,this.lat0=e,this.lng=t,this.lat=e}closePath(){this.dealias(),this.curves.push(new pu(this.lng,this.lat,this.lng0,this.lat0)),this.closed=!0,this.lng=this.lng0,this.lat=this.lat0}lineTo(t,e){this.dealias(),this.curves.push(new pu(this.lng,this.lat,t,e)),this.lng=t,this.lat=e}bind(){return this.aliased=!0,new yu(this.curves,this.closed)}}class wu extends hu{constructor(t){super(),this.splines=t,this.boundingBox=null}isDefined(){return 0!==this.splines.length}get lngMin(){return this.bounds.lngMin}get latMin(){return this.bounds.latMin}get lngMax(){return this.bounds.lngMax}get latMax(){return this.bounds.latMax}interpolateLng(t){const e=this.splines,r=e.length;if(r>0){const i=1/r,n=Math.min(Math.max(0,Math.floor(t/i)),r),s=t*r-n*i;return e[n].interpolateLng(s)}return NaN}interpolateLat(t){const e=this.splines,r=e.length;if(r>0){const i=1/r,n=Math.min(Math.max(0,Math.floor(t/i)),r),s=t*r-n*i;return e[n].interpolateLat(s)}return NaN}interpolate(t){const e=this.splines,r=e.length;if(r>0){const i=1/r,n=Math.min(Math.max(0,Math.floor(t/i)),r),s=t*r-n*i;return e[n].interpolate(s)}return new lu(NaN,NaN)}contains(t,e){return!1}intersects(t){return!1}split(t){const e=this.splines,r=e.length;if(r>0){const i=1/r,n=Math.min(Math.max(0,Math.floor(t/i)),r),s=t*r-n*i,[o,a]=e[n].split(s),u=new Array(n+1),h=new Array(r-n);for(let t=0;t<n;t+=1)u[t]=e[t];u[n]=o,h[0]=a;for(let t=n+1;t<r;t+=1)h[t-n]=e[t];return[new wu(u),new wu(h)]}return[wu.empty(),wu.empty()]}subdivide(t){const e=this.splines,r=e.length;if(r>0){const i=1/r,n=Math.min(Math.max(0,Math.floor(t/i)),r),s=t*r-n*i,o=new Array(r);for(let t=0;t<n;t+=1)o[t]=e[t];o[n]=e[n].subdivide(s);for(let t=n+1;t<r;t+=1)o[t]=e[t];return new wu(o)}return wu.empty()}project(t){const e=this.splines,r=e.length;if(r>0){const i=new Array(r);for(let n=0;n<r;n+=1)i[n]=e[n].project(t);return new Ta(i)}return Ta.empty()}get bounds(){let t=this.boundingBox;if(null===t){let e=1/0,r=1/0,i=-1/0,n=-1/0;const s=this.splines;for(let t=0,o=s.length;t<o;t+=1){const o=s[t];e=Math.min(e,o.lngMin),r=Math.min(r,o.latMin),i=Math.max(o.lngMax,i),n=Math.max(o.latMax,n)}t=new vu(e,r,i,n),this.boundingBox=t}return t}centroid(){let t=0,e=0,r=0;return this.forEachCoord((function(i,n){t+=i,e+=n,r+=1}),this),0!==r?new lu(t/r,e/r):lu.undefined()}forEachCoord(t,e){const r=this.splines;for(let i=0,n=r.length;i<n;i+=1){const n=r[i].forEachCoord(t,e);if(void 0!==n)return n}}equivalentTo(t,e){return this===t||t instanceof wu&&v.equivalent(this.splines,t.splines,e)}equals(t){return this===t||t instanceof wu&&v.equal(this.splines,t.splines)}debug(t){const e=this.splines,r=e.length;if(t=t.write("GeoPath").write(46),0===r)t=t.write("empty").write(40);else if(1===r){const r=e[0];t=t.write(r.closed?"closed":"open").write(40);const i=r.curves,n=i.length;if(0!==n){t=t.debug(i[0]);for(let e=1;e<n;e+=1)t=t.write(", ").debug(i[e])}}else{t=(t=t.write("of").write(40)).debug(e[0]);for(let i=1;i<r;i+=1)t=t.write(", ").debug(e[i])}return t=t.write(41)}toString(){return Ot.debug(this)}static empty(){return new wu([])}static of(...t){return new wu(t)}static open(...t){return new wu([new yu(t,!1)])}static closed(...t){return new wu([new yu(t,!0)])}static fromPoints(t){return new wu([yu.fromPoints(t)])}static fromSplines(t){const e=t.length,r=new Array(e);for(let i=0;i<e;i+=1)r[i]=yu.fromAny(t[i]);return new wu(r)}static fromAny(t){return null==t||t instanceof wu?t:wu.isSplines(t)?wu.fromSplines(t):yu.isAnySpline(t)?wu.of(yu.fromAny(t)):hu.fromAny(t)}static builder(){return new gu}static isSplines(t){return Array.isArray(t)&&t.length>0&&yu.isAnySpline(t[0])}static isAnyPath(t){return t instanceof wu||wu.isSplines(t)}}class gu{constructor(){this.splines=[],this.builder=null}moveTo(t,e){let r=this.builder;if(null!==r){const t=r.bind();t.isDefined()&&this.splines.push(t)}r=new mu,this.builder=r,r.moveTo(t,e)}closePath(){const t=this.builder;if(null===t)throw new Error;t.closePath()}lineTo(t,e){const r=this.builder;if(null===r)throw new Error;r.lineTo(t,e)}bind(){const t=this.splines.slice(0),e=this.builder;if(null!==e){const r=e.bind();r.isDefined()&&t.push(r)}return new wu(t)}}class vu extends hu{constructor(t,e,r,i){super(),this.lngMin=t,this.latMin=e,this.lngMax=r,this.latMax=i}isDefined(){return isFinite(this.lngMin)&&isFinite(this.latMin)&&isFinite(this.lngMax)&&isFinite(this.latMax)}get west(){return this.lngMin}get south(){return this.latMin}get east(){return this.lngMax}get north(){return this.latMax}get southWest(){return new lu(this.lngMin,this.latMin)}get northWest(){return new lu(this.lngMin,this.latMax)}get southEast(){return new lu(this.lngMax,this.latMin)}get northEast(){return new lu(this.lngMax,this.latMax)}get center(){return new lu((this.lngMin+this.lngMax)/2,(this.latMin+this.latMax)/2)}contains(t,e){if("number"==typeof t)return this.lngMin<=t&&t<=this.lngMax&&this.latMin<=e&&e<=this.latMax;if(lu.isAny(t))return this.containsPoint(lu.fromAny(t));if(pu.isAny(t))return this.containsSegment(pu.fromAny(t));if(bu.isAny(t))return this.containsTile(bu.fromAny(t));if(vu.isAny(t))return this.containsBox(vu.fromAny(t));throw new TypeError(""+t)}containsPoint(t){return this.lngMin<=t.lng&&t.lng<=this.lngMax&&this.latMin<=t.lat&&t.lat<=this.latMax}containsSegment(t){return this.lngMin<=t.lng0&&t.lng0<=this.lngMax&&this.latMin<=t.lat0&&t.lat0<=this.latMax&&this.lngMin<=t.lng1&&t.lng1<=this.lngMax&&this.latMin<=t.lat1&&t.lat1<=this.latMax}containsTile(t){return this.lngMin<=t.lngMin&&t.lngMax<=this.lngMax&&this.latMin<=t.latMin&&t.latMax<=this.latMax}containsBox(t){return this.lngMin<=t.lngMin&&t.lngMax<=this.lngMax&&this.latMin<=t.latMin&&t.latMax<=this.latMax}intersects(t){if(lu.isAny(t))return this.intersectsPoint(lu.fromAny(t));if(pu.isAny(t))return this.intersectsSegment(pu.fromAny(t));if(bu.isAny(t))return this.intersectsTile(bu.fromAny(t));if(vu.isAny(t))return this.intersectsBox(vu.fromAny(t));throw new TypeError(""+t)}intersectsPoint(t){return this.lngMin<=t.lng&&t.lng<=this.lngMax&&this.latMin<=t.lat&&t.lat<=this.latMax}intersectsSegment(t){const e=this.lngMin,r=this.latMin,i=this.lngMax,n=this.latMax,s=t.lng0,o=t.lat0,a=t.lng1,u=t.lat1;return!(s<e&&a<e||s>i&&a>i||o<r&&u<r||o>n&&u>n)&&(s>e&&s<i&&o>r&&o<n||!!(Ua.intersectsSegment(s-e,a-e,s,o,a,u)&&Ua.hitY>r&&Ua.hitY<n||Ua.intersectsSegment(o-r,u-r,s,o,a,u)&&Ua.hitX>e&&Ua.hitX<i||Ua.intersectsSegment(s-i,a-i,s,o,a,u)&&Ua.hitY>r&&Ua.hitY<n||Ua.intersectsSegment(o-n,u-n,s,o,a,u)&&Ua.hitX>e&&Ua.hitX<i))}intersectsTile(t){return this.lngMin<=t.lngMax&&t.lngMin<=this.lngMax&&this.latMin<=t.latMax&&t.latMin<=this.latMax}intersectsBox(t){return this.lngMin<=t.lngMax&&t.lngMin<=this.lngMax&&this.latMin<=t.latMax&&t.latMin<=this.latMax}union(t){return super.union(t)}project(t){const e=t.project(this.lngMin,this.latMin),r=t.project(this.lngMax,this.latMax);let i=e.x,n=e.y,s=r.x,o=r.y;if(i>s){const t=i;i=s,s=t}if(n>o){const t=n;n=o,o=t}return isFinite(i)||(i=-1/0),isFinite(n)||(n=-1/0),isFinite(s)||(s=1/0),isFinite(o)||(o=1/0),new Ua(i,n,s,o)}get bounds(){return this}toAny(){return{lngMin:this.lngMin,latMin:this.latMin,lngMax:this.lngMax,latMax:this.latMax}}interpolateTo(t){return t instanceof vu?xu(this,t):null}equivalentTo(t,e){return this===t||t instanceof vu&&(h.equivalent(this.lngMin,t.lngMin,e)&&h.equivalent(this.latMin,t.latMin,e)&&h.equivalent(this.lngMax,t.lngMax,e)&&h.equivalent(this.latMax,t.latMax,e))}equals(t){return this===t||t instanceof vu&&(this.lngMin===t.lngMin&&this.latMin===t.latMin&&this.lngMax===t.lngMax&&this.latMax===t.latMax)}hashCode(){return n.mash(n.mix(n.mix(n.mix(n.mix(p.hash(vu),h.hash(this.lngMin)),h.hash(this.latMin)),h.hash(this.lngMax)),h.hash(this.latMax)))}debug(t){return t=t.write("GeoBox").write(46).write("of").write(40).debug(this.lngMin).write(", ").debug(this.latMin).write(", ").debug(this.lngMax).write(", ").debug(this.latMax).write(41)}toString(){return Ot.debug(this)}static undefined(){return new vu(1/0,1/0,-1/0,-1/0)}static globe(){return new vu(-180,-90,180,90)}static of(t,e,r,i){return void 0===r&&(r=t),void 0===i&&(i=e),new vu(t,e,r,i)}static fromInit(t){return new vu(t.lngMin,t.latMin,t.lngMax,t.latMax)}static fromAny(t){if(null==t||t instanceof vu)return t;if(vu.isInit(t))return vu.fromInit(t);throw new TypeError(""+t)}static isInit(t){if("object"==typeof t&&null!==t){const e=t;return"number"==typeof e.lngMin&&"number"==typeof e.latMin&&"number"==typeof e.lngMax&&"number"==typeof e.latMax}return!1}static isAny(t){return t instanceof vu||vu.isInit(t)}}e([s],vu,"undefined",null),e([s],vu,"globe",null);class bu extends hu{constructor(t,e,r){super(),this.x=t,this.y=e,this.z=r}get lngMin(){return bu.unprojectX(this.x/(1<<this.z))}get latMin(){return bu.unprojectY(this.y/(1<<this.z))}get lngMax(){return bu.unprojectX((this.x+1)/(1<<this.z))}get latMax(){return bu.unprojectY((this.y+1)/(1<<this.z))}get west(){return this.lngMin}get south(){return this.latMin}get east(){return this.lngMax}get north(){return this.latMax}get southWest(){return new lu(this.lngMin,this.latMin)}get northWest(){return new lu(this.lngMin,this.latMax)}get southEast(){return new lu(this.lngMax,this.latMin)}get northEast(){return new lu(this.lngMax,this.latMax)}get center(){return new lu((this.lngMin+this.lngMax)/2,(this.latMin+this.latMax)/2)}get southWestTile(){return new bu(2*this.x,2*this.y,this.z+1)}get northWestTile(){return new bu(2*this.x,2*this.y+1,this.z+1)}get southEastTile(){return new bu(2*this.x+1,2*this.y,this.z+1)}get northEastTile(){return new bu(2*this.x+1,2*this.y+1,this.z+1)}get parentTile(){return new bu(this.x>>1,this.y>>1,this.z-1)}contains(t,e){if("number"==typeof t)return this.lngMin<=t&&t<=this.lngMax&&this.latMin<=e&&e<=this.latMax;if(lu.isAny(t))return this.containsPoint(lu.fromAny(t));if(pu.isAny(t))return this.containsSegment(pu.fromAny(t));if(bu.isAny(t))return this.containsTile(bu.fromAny(t));if(vu.isAny(t))return this.containsBox(vu.fromAny(t));throw new TypeError(""+t)}containsPoint(t){return this.lngMin<=t.lng&&t.lng<=this.lngMax&&this.latMin<=t.lat&&t.lat<=this.latMax}containsSegment(t){return this.lngMin<=t.lng0&&t.lng0<=this.lngMax&&this.latMin<=t.lat0&&t.lat0<=this.latMax&&this.lngMin<=t.lng1&&t.lng1<=this.lngMax&&this.latMin<=t.lat1&&t.lat1<=this.latMax}containsTile(t){return this.lngMin<=t.lngMin&&t.lngMax<=this.lngMax&&this.latMin<=t.latMin&&t.latMax<=this.latMax}containsBox(t){return this.lngMin<=t.lngMin&&t.lngMax<=this.lngMax&&this.latMin<=t.latMin&&t.latMax<=this.latMax}intersects(t){if(lu.isAny(t))return this.intersectsPoint(lu.fromAny(t));if(pu.isAny(t))return this.intersectsSegment(pu.fromAny(t));if(bu.isAny(t))return this.intersectsTile(bu.fromAny(t));if(vu.isAny(t))return this.intersectsBox(vu.fromAny(t));throw new TypeError(""+t)}intersectsPoint(t){return this.lngMin<=t.lng&&t.lng<=this.lngMax&&this.latMin<=t.lat&&t.lat<=this.latMax}intersectsSegment(t){const e=this.lngMin,r=this.latMin,i=this.lngMax,n=this.latMax,s=t.lng0,o=t.lat0,a=t.lng1,u=t.lat1;return!(s<e&&a<e||s>i&&a>i||o<r&&u<r||o>n&&u>n)&&(s>e&&s<i&&o>r&&o<n||!!(Ua.intersectsSegment(s-e,a-e,s,o,a,u)&&Ua.hitY>r&&Ua.hitY<n||Ua.intersectsSegment(o-r,u-r,s,o,a,u)&&Ua.hitX>e&&Ua.hitX<i||Ua.intersectsSegment(s-i,a-i,s,o,a,u)&&Ua.hitY>r&&Ua.hitY<n||Ua.intersectsSegment(o-n,u-n,s,o,a,u)&&Ua.hitX>e&&Ua.hitX<i))}intersectsTile(t){return this.lngMin<=t.lngMax&&t.lngMin<=this.lngMax&&this.latMin<=t.latMax&&t.latMin<=this.latMax}intersectsBox(t){return this.lngMin<=t.lngMax&&t.lngMin<=this.lngMax&&this.latMin<=t.latMax&&t.latMin<=this.latMax}project(t){const e=t.project(this.lngMin,this.latMin),r=t.project(this.lngMax,this.latMax);let i=e.x,n=e.y,s=r.x,o=r.y;if(i>s){const t=i;i=s,s=t}if(n>o){const t=n;n=o,o=t}return isFinite(i)||(i=-1/0),isFinite(n)||(n=-1/0),isFinite(s)||(s=1/0),isFinite(o)||(o=1/0),new Ua(i,n,s,o)}toAny(){return{x:this.x,y:this.y,z:this.z}}equivalentTo(t,e){return this===t||t instanceof bu&&(h.equivalent(this.x,t.x,e)&&h.equivalent(this.y,t.y,e)&&h.equivalent(this.z,t.z,e))}equals(t){return this===t||t instanceof bu&&(this.x===t.x&&this.y===t.y&&this.z===t.z)}hashCode(){return n.mash(n.mix(n.mix(n.mix(p.hash(bu),h.hash(this.x)),h.hash(this.y)),h.hash(this.z)))}debug(t){return t=t.write("GeoTile").write(46).write("of").write(40).debug(this.x).write(", ").debug(this.y).write(", ").debug(this.z).write(41)}toString(){return Ot.debug(this)}static root(){return new bu(0,0,0)}static of(t,e,r){return new bu(t,e,r)}static fromInit(t){return new bu(t.x,t.y,t.z)}static fromTuple(t){return new bu(t[0],t[1],t[2])}static fromAny(t){if(null==t||t instanceof bu)return t;if(bu.isInit(t))return bu.fromInit(t);if(bu.isTuple(t))return bu.fromTuple(t);throw new TypeError(""+t)}static isInit(t){if("object"==typeof t&&null!==t){const e=t;return"number"==typeof e.x&&"number"==typeof e.y&&"number"==typeof e.z}return!1}static isTuple(t){return Array.isArray(t)&&3===t.length&&"number"==typeof t[0]&&"number"==typeof t[1]&&"number"==typeof t[2]}static isAny(t){return t instanceof bu||bu.isInit(t)||bu.isTuple(t)}static unprojectX(t){return(t*Math.PI*2-Math.PI)*(180/Math.PI)}static unprojectY(t){return(2*Math.atan(Math.exp(t*Math.PI*2-Math.PI))-Math.PI/2)*(180/Math.PI)}}e([s],bu,"root",null);const xu=function(t){const e=function(t,r){const i=function(t){const e=i[0],r=i[1],n=e.lngMin+t*(r.lngMin-e.lngMin),s=e.latMin+t*(r.latMin-e.latMin),o=e.lngMax+t*(r.lngMax-e.lngMax),a=e.latMax+t*(r.latMax-e.latMax);return new vu(n,s,o,a)};return Object.setPrototypeOf(i,e.prototype),i[0]=t,i[1]=r,i};return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e}(k);class Cu extends hu{constructor(t){super(),this.shapes=t,this.boundingBox=null}isDefined(){return 0!==this.shapes.length}get lngMin(){return this.bounds.lngMin}get latMin(){return this.bounds.latMin}get lngMax(){return this.bounds.lngMax}get latMax(){return this.bounds.latMax}contains(t,e){return!1}intersects(t){return!1}project(t){const e=this.shapes,r=e.length;if(r>0){const i=new Array(r);for(let n=0;n<r;n+=1)i[n]=e[n].project(t);return new za(i)}return za.empty()}get bounds(){let t=this.boundingBox;if(null===t){let e=1/0,r=1/0,i=-1/0,n=-1/0;const s=this.shapes;for(let t=0,o=s.length;t<o;t+=1){const o=s[t];e=Math.min(e,o.lngMin),r=Math.min(r,o.latMin),i=Math.max(o.lngMax,i),n=Math.max(o.latMax,n)}t=new vu(e,r,i,n),this.boundingBox=t}return t}equivalentTo(t,e){return this===t||t instanceof Cu&&v.equivalent(this.shapes,t.shapes,e)}equals(t){return this===t||t instanceof Cu&&v.equal(this.shapes,t.shapes)}debug(t){const e=this.shapes,r=e.length;if(t=t.write("GeoGroup").write(46),0===r)t=t.write("empty").write(40);else{t=(t=t.write("of").write(40)).debug(e[0]);for(let i=1;i<r;i+=1)t=t.write(", ").debug(e[i])}return t=t.write(41)}toString(){return Ot.debug(this)}static empty(){return new Cu(v.empty)}static of(...t){return new Cu(t)}}e([s],Cu,"empty",null);const Ou=function(){const t={is:function(t){return Su.is(t)||Tu.is(t)||Vu.is(t)},toShape:function(t){return"Feature"===t.type?Tu.toShape(t):"FeatureCollection"===t.type?Vu.toShapes(t):Su.toShape(t)}};return t}(),Su=function(){const t={is:function(t){if("object"==typeof t&&null!==t){const e=t;return("Point"===e.type||"MultiPoint"===e.type||"LineString"===e.type||"MultiLineString"===e.type||"Polygon"===e.type||"MultiPolygon"===e.type)&&Array.isArray(e.coordinates)||"GeometryCollection"===e.type&&Array.isArray(e.geometries)}return!1},toShape:function(t){if("Point"===t.type)return Eu.toShape(t);if("MultiPoint"===t.type)return ku.toShape(t);if("LineString"===t.type)return Au.toShape(t);if("MultiLineString"===t.type)return Mu.toShape(t);if("Polygon"===t.type)return Du.toShape(t);if("MultiPolygon"===t.type)return Iu.toShape(t);if("GeometryCollection"===t.type)return Pu.toShape(t);throw new TypeError(""+t)}};return t}(),Eu=function(){const t={is:function(t){if("object"==typeof t&&null!==t){const e=t;return"Point"===e.type&&Array.isArray(e.coordinates)}return!1},toShape:function(t){const e=t.coordinates;return new lu(e[0],e[1])}};return t}(),ku=function(){const t={is:function(t){if("object"==typeof t&&null!==t){const e=t;return"MultiPoint"===e.type&&Array.isArray(e.coordinates)}return!1},toShape:function(t){const e=t.coordinates,r=e.length,i=new Array(r);for(let t=0;t<r;t+=1){const r=e[t];i[t]=new lu(r[0],r[1])}return new Cu(i)}};return t}(),Au=function(){const t={is:function(t){if("object"==typeof t&&null!==t){const e=t;return"LineString"===e.type&&Array.isArray(e.coordinates)}return!1},toShape:function(t){const e=t.coordinates,r=e.length;if(r>0){const t=new Array(r-1);let i=e[0],n=i[0],s=i[1];for(let o=1;o<r;o+=1)i=e[o],t[o-1]=new pu(n,s,(n=i[0],n),(s=i[1],s));return new yu(t,!1)}return yu.empty()}};return t}(),Mu=function(){const t={is:function(t){if("object"==typeof t&&null!==t){const e=t;return"MultiLineString"===e.type&&Array.isArray(e.coordinates)}return!1},toShape:function(t){const e=t.coordinates,r=e.length,i=new Array(r);for(let t=0;t<r;t+=1){const r=e[t],n=r.length;if(n>0){const e=new Array(n-1);let s=r[0],o=s[0],a=s[1];for(let t=1;t<n;t+=1)s=r[t],e[t-1]=new pu(o,a,(o=s[0],o),(a=s[1],a));i[t]=new yu(e,!1)}else i[t]=yu.empty()}return new Cu(i)}};return t}(),Du=function(){const t={is:function(t){if("object"==typeof t&&null!==t){const e=t;return"Polygon"===e.type&&Array.isArray(e.coordinates)}return!1},toShape:function(t){const e=t.coordinates,r=e.length,i=new Array(r);for(let t=0;t<r;t+=1){const r=e[t],n=r.length;if(n>0){const e=new Array(n-1);let s=r[0],o=s[0],a=s[1];for(let t=1;t<n;t+=1)s=r[t],e[t-1]=new pu(o,a,(o=s[0],o),(a=s[1],a));i[t]=new yu(e,!0)}else i[t]=yu.empty()}return new wu(i)}};return t}(),Iu=function(){const t={is:function(t){if("object"==typeof t&&null!==t){const e=t;return"MultiPolygon"===e.type&&Array.isArray(e.coordinates)}return!1},toShape:function(t){const e=t.coordinates,r=e.length,i=new Array(r);for(let t=0;t<r;t+=1){const r=e[t],n=r.length,s=new Array(n);for(let t=0;t<n;t+=1){const e=r[t],i=e.length;if(i>0){const r=new Array(i-1);let n=e[0],o=n[0],a=n[1];for(let t=1;t<i;t+=1)n=e[t],r[t-1]=new pu(o,a,(o=n[0],o),(a=n[1],a));s[t]=new yu(r,!0)}else s[t]=yu.empty()}i[t]=new wu(s)}return new Cu(i)}};return t}(),Pu=function(){const t={is:function(t){if("object"==typeof t&&null!==t){const e=t;return"GeometryCollection"===e.type&&Array.isArray(e.geometries)}return!1},toShape:function(t){const e=t.geometries,r=e.length,i=new Array(r);for(let t=0;t<r;t+=1)i[t]=Su.toShape(e[t]);return new Cu(i)}};return t}(),Tu=function(){const t={is:function(t){if("object"==typeof t&&null!==t){const e=t;return"Feature"===e.type&&Su.is(e.geometry)&&"object"==typeof e.properties}return!1},toShape:function(t){const e=t.geometry;return null!==e?Su.toShape(e):null}};return t}(),Vu=function(){const t={is:function(t){if("object"==typeof t&&null!==t){const e=t;return"FeatureCollection"===e.type&&Array.isArray(e.features)}return!1},toShapes:function(t){const e=t.features,r=e.length,i=new Array(r);for(let t=0;t<r;t+=1)i[t]=Tu.toShape(e[t]);return i}};return t}();class Fu{constructor(t,e){this.name=t,this.offset=e}isUTC(){return 0===this.offset}isLocal(){return this.offset===-(new Date).getTimezoneOffset()}equals(t){return this===t||t instanceof Fu&&this.offset===t.offset}hashCode(){return n.mash(n.mix(p.hash(Fu),h.hash(this.offset)))}debug(t){return t=t.write("TimeZone").write(46),t=(t="UTC"===this.name&&0===this.offset?t.write("utc").write(40):void 0===this.name?t.write("forOffset").write(40).debug(this.offset):t.write("create").write(40).debug(this.name).write(", ").debug(this.offset)).write(41)}toString(){return Ot.debug(this)}static get utc(){return new Fu("UTC",0)}static get local(){return Fu.forOffset(-(new Date).getTimezoneOffset())}static create(t,e){return"UTC"===t&&0===e?Fu.utc:new Fu(t,e)}static forName(t){return"UTC"===t?Fu.utc:null}static forOffset(t){return 0===t?Fu.utc:new Fu(void 0,t)}static fromAny(t){if(null==t||t instanceof Fu)return t;if("string"==typeof t){const e=Fu.forName(t);if(null!==e)return e}else if("number"==typeof t)return Fu.forOffset(t);throw new TypeError(""+t)}static fromValue(t){const e=t.stringValue(void 0);if(void 0!==e)return Fu.forName(e);const r=t.numberValue(void 0);return void 0!==r?Fu.forOffset(r):null}static isAny(t){return t instanceof Fu||"string"==typeof t||"number"==typeof t}static form(){return new qu(Fu.utc)}}e([s],Fu,"utc",null),e([s],Fu,"local",null),e([s],Fu,"form",null);class qu extends ki{constructor(t){super(),Object.defineProperty(this,"unit",{value:t,enumerable:!0})}withUnit(t){return t!==this.unit?new qu(t):this}mold(t){const e=(t=Fu.fromAny(t)).name;return void 0!==e?Sr.from(e):kr.from(t.offset)}cast(t){const e=t.toValue(),r=Fu.fromValue(e);return null!==r?r:void 0}}class Uu{constructor(t,e=Fu.utc){this.time=t,this.zone=e}isDefined(){return isFinite(new Date(this.time).getTime())}get year(){return this.toUTCLocalDate().getUTCFullYear()}withYear(t,e,r,i,n,s,o){const a=this.toUTCLocalDate();return a.setUTCFullYear(t),void 0!==e&&a.setUTCMonth(e),void 0!==r&&a.setUTCDate(r),void 0!==i&&a.setUTCHours(i),void 0!==n&&a.setUTCMinutes(n),void 0!==s&&a.setUTCSeconds(s),void 0!==o&&a.setUTCMilliseconds(o),Uu.fromUTCLocalDate(a,this.zone)}get month(){return this.toUTCLocalDate().getUTCMonth()}withMonth(t,e,r,i,n,s){const o=this.toUTCLocalDate();return o.setUTCMonth(t),void 0!==e&&o.setUTCDate(e),void 0!==r&&o.setUTCHours(r),void 0!==i&&o.setUTCMinutes(i),void 0!==n&&o.setUTCSeconds(n),void 0!==s&&o.setUTCMilliseconds(s),Uu.fromUTCLocalDate(o,this.zone)}get day(){return this.toUTCLocalDate().getUTCDate()}withDay(t,e,r,i,n){const s=this.toUTCLocalDate();return s.setUTCDate(t),void 0!==e&&s.setUTCHours(e),void 0!==r&&s.setUTCMinutes(r),void 0!==i&&s.setUTCSeconds(i),void 0!==n&&s.setUTCMilliseconds(n),Uu.fromUTCLocalDate(s,this.zone)}get hour(){return this.toUTCLocalDate().getUTCHours()}withHour(t,e,r,i){const n=this.toUTCLocalDate();return n.setUTCHours(t),void 0!==e&&n.setUTCMinutes(e),void 0!==r&&n.setUTCSeconds(r),void 0!==i&&n.setUTCMilliseconds(i),Uu.fromUTCLocalDate(n,this.zone)}get minute(){return this.toUTCLocalDate().getUTCMinutes()}withMinute(t,e,r){const i=this.toUTCLocalDate();return i.setUTCMinutes(t),void 0!==e&&i.setUTCSeconds(e),void 0!==r&&i.setUTCMilliseconds(r),Uu.fromUTCLocalDate(i,this.zone)}get second(){return this.toUTCLocalDate().getUTCSeconds()}withSecond(t,e){const r=this.toUTCLocalDate();return r.setUTCSeconds(t),void 0!==e&&r.setUTCMilliseconds(e),Uu.fromUTCLocalDate(r,this.zone)}get millisecond(){return this.toUTCLocalDate().getUTCMilliseconds()}withMillisecond(t){const e=this.toUTCLocalDate();return e.setUTCMilliseconds(t),Uu.fromUTCLocalDate(e,this.zone)}get weekday(){return this.toUTCLocalDate().getUTCDay()}toUTCLocalDate(){return new Date(this.time+6e4*this.zone.offset)}toDate(){return new Date(this.time)}valueOf(){return this.time}interpolateTo(t){return t instanceof Uu?Ru(this,t):null}compareTo(t){if(t instanceof Uu){const e=this.time,r=t.time;return e<r?-1:e>r?1:e===r?0:NaN}return NaN}equivalentTo(t,e){return this===t||t instanceof Uu&&h.equivalent(this.time,t.time,e)}equals(t){return this===t||t instanceof Uu&&(this.time===t.time&&this.zone.equals(t.zone))}hashCode(){return n.mash(n.mix(n.mix(p.hash(Uu),h.hash(this.time)),this.zone.hashCode()))}display(t,e=Ku.iso8601){return t=e.writeDate(t,this)}toString(t=Ku.iso8601){return t.format(this)}static current(t){return t=void 0!==t?Fu.fromAny(t):Fu.local,new Uu(Date.now(),t)}static fromUTCLocalDate(t,e){return new Uu(t.getTime()-6e4*e.offset,e)}static fromInit(t,e){let r=Date.UTC(void 0!==t.year?t.year:1970,void 0!==t.month?t.month:0,void 0!==t.day?t.day:1,void 0!==t.hour?t.hour:0,void 0!==t.minute?t.minute:0,void 0!==t.second?t.second:0,void 0!==t.millisecond?t.millisecond:0);return void 0!==t.zone&&(e=Fu.fromAny(t.zone)),void 0!==e?r+=6e4*(e=Fu.fromAny(e)).offset:e=Fu.utc,new Uu(r,e)}static fromAny(t,e){if(null==t||t instanceof Uu)return t;if(t instanceof Date)return e=void 0!==e?Fu.fromAny(e):Fu.utc,new Uu(t.getTime(),e);if("number"==typeof t)return e=void 0!==e?Fu.fromAny(e):Fu.utc,new Uu(t,e);if("string"==typeof t)return Uu.parse(t,e);if(Uu.isInit(t))return Uu.fromInit(t,e);throw new TypeError(""+t)}static fromValue(t){let e;const r=t.header("date");r.isDefined()?(t=r,e=!0):e=!1;const i={};return t.forEach((function(t,r){const n=t.key.stringValue(void 0);void 0!==n?"year"===n?i.year=t.toValue().numberValue(i.year):"month"===n?i.month=t.toValue().numberValue(i.month):"day"===n?i.day=t.toValue().numberValue(i.day):"hour"===n?i.hour=t.toValue().numberValue(i.hour):"minute"===n?i.minute=t.toValue().numberValue(i.minute):"second"===n?i.second=t.toValue().numberValue(i.second):"millisecond"===n?i.millisecond=t.toValue().numberValue(i.millisecond):"zone"===n&&(i.zone=t.toValue().cast(Fu.form(),i.zone)):t instanceof yr&&e&&(0===r?i.year=t.numberValue(i.year):1===r?i.month=t.numberValue(i.month):2===r?i.day=t.numberValue(i.day):3===r?i.hour=t.numberValue(i.hour):4===r?i.minute=t.numberValue(i.minute):5===r?i.second=t.numberValue(i.second):6===r?i.millisecond=t.numberValue(i.millisecond):7===r&&(i.zone=t.cast(Fu.form(),i.zone)))})),Uu.isInit(i)?Uu.fromInit(i):null}static parse(t,e){return Ku.iso8601.parse(t)}static time(t){if(t instanceof Uu)return t.time;if(t instanceof Date)return t.getTime();if("number"==typeof t)return t;if("string"==typeof t)return Uu.parse(t).time;if(Uu.isInit(t))return Uu.fromInit(t).time;throw new TypeError(""+t)}static zone(t){return t instanceof Uu?t.zone:Fu.utc}static isInit(t){if("object"==typeof t&&null!==t){const e=t;return(void 0===e.year||"number"==typeof e.year)&&(void 0===e.month||"number"==typeof e.month)&&(void 0===e.day||"number"==typeof e.day)&&(void 0===e.hour||"number"==typeof e.hour)&&(void 0===e.minute||"number"==typeof e.minute)&&(void 0===e.second||"number"==typeof e.second)&&(void 0===e.millisecond||"number"==typeof e.millisecond)&&(void 0===e.zone||Fu.isAny(e.zone))&&("number"==typeof e.year||"number"==typeof e.month||"number"==typeof e.day||"number"==typeof e.hour||"number"==typeof e.minute||"number"==typeof e.second||"number"==typeof e.millisecond)}return!1}static isAny(t){return t instanceof Uu||t instanceof Date||"number"==typeof t||"string"==typeof t||Uu.isInit(t)}static form(){return new Nu(new Uu(0))}}e([s],Uu,"form",null);const Ru=function(t){const e=function(t,r){const i=function(t){const e=i[0],r=i[1];return new Uu(e.time+t*(r.time-e.time),r.zone)};return Object.setPrototypeOf(i,e.prototype),i[0]=t,i[1]=r,i};return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e}(k);class Nu extends ki{constructor(t){super(),Object.defineProperty(this,"unit",{value:t,enumerable:!0})}withUnit(t){return t!==this.unit?new Nu(t):this}mold(t){return t=Uu.fromAny(t),Sr.from(t.toString())}cast(t){let e=null;try{if(e=Uu.fromValue(t),void 0===e){const r=t.numberValue(void 0);if(void 0!==r)e=new Uu(r);else{const r=t.stringValue(void 0);void 0!==r&&(e=Uu.parse(r))}}}catch(t){}return null!==e?e:void 0}}class zu extends jt{constructor(t){super(),this.dateParser=t}feed(t){return zu.parse(t,this.dateParser)}static parse(t,e){return(e=e.feed(t)).isDone()?jt.done(Uu.fromAny(e.bind())):e.isError()?e.asError():new zu(e)}}class ju{constructor(t=ju.Periods,e=ju.Weekdays,r=ju.ShortWeekdays,i=ju.Months,n=ju.ShortMonths){this.periods=t,this.weekdays=e,this.shortWeekdays=r,this.months=i,this.shortMonths=n}static standard(){return new ju}}ju.Periods=["AM","PM"],ju.Weekdays=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],ju.ShortWeekdays=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],ju.Months=["January","February","March","April","May","June","July","August","September","October","November","December"],ju.ShortMonths=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],e([s],ju,"standard",null);const Lu=function(){const t={};let e=null;return t.standard=function(t){let r=null;return void 0===t&&(t=ju.standard()),t===ju.standard()&&(r=e),null===r&&(r={Y:Ku.year,m:Ku.monthOfYear,B:Ku.month.withLocale(t),b:Ku.shortMonth.withLocale(t),d:Ku.dayOfMonth,A:Ku.weekday.withLocale(t),a:Ku.shortWeekday.withLocale(t),H:Ku.hour24,I:Ku.hour12,p:Ku.period.withLocale(t),M:Ku.minute,S:Ku.second,L:Ku.millisecond},t===ju.standard()&&(e=r)),r},t}();class Ku{withLocale(t){return this}format(t){t=Uu.fromAny(t);let e=Ct.stringOutput();return e=this.writeDate(e,t),e.bind()}parse(t){for("string"==typeof t&&(t=Ct.stringInput(t));t.isCont()&&Ct.isSpace(t.head());)t=t.step();let e=this.parseDate(t,{});if(e.isDone())for(;t.isCont()&&Ct.isSpace(t.head());)t=t.step();return t.isCont()&&!e.isError()&&(e=jt.error(Et.unexpected(t))),e.bind()}parseDate(t,e){const r=this.parseDateTime(t,e);return r.isDone()?jt.done(Uu.fromAny(r.bind())):r.isError()?r.asError():new zu(r)}static get year(){return new Bu}static get monthOfYear(){return new Wu}static get month(){return new Hu(ju.standard())}static get shortMonth(){return new Xu(ju.standard())}static get dayOfMonth(){return new Yu}static get weekday(){return new Gu(ju.standard())}static get shortWeekday(){return new _u(ju.standard())}static get hour24(){return new Qu}static get hour12(){return new Zu}static get period(){return new Ju(ju.standard())}static get minute(){return new $u}static get second(){return new th}static get millisecond(){return new eh}static pattern(t,e){return(void 0===e||e instanceof ju)&&(e=Lu.standard(e)),new rh(t,e)}static get iso8601(){return new rh("%Y-%m-%dT%H:%M:%S.%LZ",Lu.standard())}static parseDateNumber(t,e,r,i,n,s,o=0,a=0){let u=0;for(;a<n&&t.isCont()&&(u=t.head(),St.isDigit(u));)t.step(),o=10*o+St.decodeDigit(u),a+=1;return t.isEmpty()?e.cont(void 0!==s?s:{},o,a,t):a>=i?e.term(o,s||{},t):jt.error(Et.expected(r,t))}static parseDateString(t,e,r,i,n){let s=0;for(n=void 0!==n?n:Ct.stringOutput();;){if(!t.isCont()||(s=t.head(),!Ct.isAlpha(s))){if(!t.isEmpty())return e.term(r,n.bind(),void 0!==i?i:{},t);break}t.step(),n.write(s)}return e.cont(r,void 0!==i?i:{},n,t)}static writeDateNumber2(t,e){const r=48+e%10,i=48+(e/=10)%10;return t=t.write(i).write(r)}static writeDateNumber3(t,e){const r=48+e%10,i=48+(e/=10)%10,n=48+(e/=10)%10;return t=t.write(n).write(i).write(r)}static writeDateNumber4(t,e){const r=48+e%10,i=48+(e/=10)%10,n=48+(e/=10)%10,s=48+(e/=10)%10;return t=t.write(s).write(n).write(i).write(r)}}e([s],Ku,"year",null),e([s],Ku,"monthOfYear",null),e([s],Ku,"month",null),e([s],Ku,"shortMonth",null),e([s],Ku,"dayOfMonth",null),e([s],Ku,"weekday",null),e([s],Ku,"shortWeekday",null),e([s],Ku,"hour24",null),e([s],Ku,"hour12",null),e([s],Ku,"period",null),e([s],Ku,"minute",null),e([s],Ku,"second",null),e([s],Ku,"millisecond",null),e([s],Ku,"iso8601",null);class Bu extends Ku{writeDate(t,e){return t=Ku.writeDateNumber4(t,e.year)}parseDateTime(t,e){return ih.parse(t,e)}}class Wu extends Ku{writeDate(t,e){return t=Ku.writeDateNumber2(t,e.month+1)}parseDateTime(t,e){return nh.parse(t,e)}}class Hu extends Ku{constructor(t){super(),this.locale=t}withLocale(t){return t!==this.locale?new Hu(t):this}writeDate(t,e){return t=t.write(this.locale.months[e.month])}parseDateTime(t,e){return sh.parse(t,this.locale,e)}}class Xu extends Ku{constructor(t){super(),this.locale=t}withLocale(t){return t!==this.locale?new Xu(t):this}writeDate(t,e){return t=t.write(this.locale.shortMonths[e.month])}parseDateTime(t,e){return oh.parse(t,this.locale,e)}}class Yu extends Ku{writeDate(t,e){return t=Ku.writeDateNumber2(t,e.day)}parseDateTime(t,e){return ah.parse(t,e)}}class Gu extends Ku{constructor(t){super(),this.locale=t}withLocale(t){return t!==this.locale?new Gu(t):this}writeDate(t,e){return t=t.write(this.locale.weekdays[e.weekday])}parseDateTime(t,e){return uh.parse(t,this.locale,e)}}class _u extends Ku{constructor(t){super(),this.locale=t}withLocale(t){return t!==this.locale?new _u(t):this}writeDate(t,e){return t=t.write(this.locale.shortWeekdays[e.weekday])}parseDateTime(t,e){return hh.parse(t,this.locale,e)}}class Qu extends Ku{writeDate(t,e){return t=Ku.writeDateNumber2(t,e.hour)}parseDateTime(t,e){return lh.parse(t,e)}}class Zu extends Ku{writeDate(t,e){let r=e.hour%12;return 0===r&&(r=12),t=Ku.writeDateNumber2(t,r)}parseDateTime(t,e){return ch.parse(t,e)}}class Ju extends Ku{constructor(t){super(),this.locale=t}withLocale(t){return t!==this.locale?new Ju(t):this}writeDate(t,e){return t=t.write(this.locale.periods[e.hour>=12?1:0])}parseDateTime(t,e){return dh.parse(t,this.locale,e)}}class $u extends Ku{writeDate(t,e){return t=Ku.writeDateNumber2(t,e.minute)}parseDateTime(t,e){return ph.parse(t,e)}}class th extends Ku{writeDate(t,e){return t=Ku.writeDateNumber2(t,e.second)}parseDateTime(t,e){return fh.parse(t,e)}}class eh extends Ku{writeDate(t,e){return t=Ku.writeDateNumber3(t,e.millisecond)}parseDateTime(t,e){return yh.parse(t,e)}}class rh extends Ku{constructor(t,e){super(),this.pattern=t,this.specifiers=e}writeDate(t,e){const r=this.pattern,i=this.specifiers;let n=0,s=0;const o=r.length;for(;s<o;)if(37===r.charCodeAt(s)){n!==s&&(t=t.write(r.slice(n,s)));const o=i[r.charAt(s+1)];void 0!==o&&(t=o.writeDate(t,e)),s+=2,n=s}else s+=1;return n!==s&&(t=t.write(r.slice(n,s))),t}parseDateTime(t,e){return mh.parse(t,this.pattern,this.specifiers,e)}}class ih extends jt{constructor(t,e,r){super(),this.date=t,this.year=e,this.step=r}feed(t){return ih.parse(t,this.date,this.year,this.step)}static parse(t,e,r,i){return Ku.parseDateNumber(t,ih,"full year",4,4,e,r,i)}static term(t,e){return e.year=t,jt.done(e)}static cont(t,e,r){return new ih(t,e,r)}}class nh extends jt{constructor(t,e,r){super(),this.date=t,this.month=e,this.step=r}feed(t){return nh.parse(t,this.date,this.month,this.step)}static parse(t,e,r,i){return Ku.parseDateNumber(t,nh,"month number",2,2,e,r,i)}static term(t,e){return e.month=t-1,jt.done(e)}static cont(t,e,r){return new nh(t,e,r)}}class sh extends jt{constructor(t,e,r){super(),this.locale=t,this.date=e,this.output=r}feed(t){return sh.parse(t,this.locale,this.date,this.output)}static parse(t,e,r,i){return Ku.parseDateString(t,sh,e,r,i)}static term(t,e,r,i){const n=t.months.indexOf(e);return n>=0?(r.month=n,jt.done(r)):jt.error(Et.message("expected month, but found "+e,i))}static cont(t,e,r){return new sh(t,e,r)}}class oh extends jt{constructor(t,e,r){super(),this.locale=t,this.date=e,this.output=r}feed(t){return oh.parse(t,this.locale,this.date,this.output)}static parse(t,e,r,i){return Ku.parseDateString(t,oh,e,r,i)}static term(t,e,r,i){const n=t.shortMonths.indexOf(e);return n>=0?(r.month=n,jt.done(r)):jt.error(Et.message("expected short month, but found "+e,i))}static cont(t,e,r){return new oh(t,e,r)}}class ah extends jt{constructor(t,e,r){super(),this.date=t,this.day=e,this.step=r}feed(t){return ah.parse(t,this.date,this.day,this.step)}static parse(t,e,r,i){return Ku.parseDateNumber(t,ah,"day of month",2,2,e,r,i)}static term(t,e){return e.day=t,jt.done(e)}static cont(t,e,r){return new ah(t,e,r)}}class uh extends jt{constructor(t,e,r){super(),this.locale=t,this.date=e,this.output=r}feed(t){return uh.parse(t,this.locale,this.date,this.output)}static parse(t,e,r,i){return Ku.parseDateString(t,uh,e,r,i)}static term(t,e,r,i){return t.weekdays.indexOf(e)>=0?jt.done(r):jt.error(Et.message("expected weekday, but found "+e,i))}static cont(t,e,r){return new uh(t,e,r)}}class hh extends jt{constructor(t,e,r){super(),this.locale=t,this.date=e,this.output=r}feed(t){return hh.parse(t,this.locale,this.date,this.output)}static parse(t,e,r,i){return Ku.parseDateString(t,hh,e,r,i)}static term(t,e,r,i){return t.shortWeekdays.indexOf(e)>=0?jt.done(r):jt.error(Et.message("expected short weekday, but found "+e,i))}static cont(t,e,r){return new hh(t,e,r)}}class lh extends jt{constructor(t,e,r){super(),this.date=t,this.hour=e,this.step=r}feed(t){return lh.parse(t,this.date,this.hour,this.step)}static parse(t,e,r,i){return Ku.parseDateNumber(t,lh,"hour (24)",2,2,e,r,i)}static term(t,e){return e.hour=t,jt.done(e)}static cont(t,e,r){return new lh(t,e,r)}}class ch extends jt{constructor(t,e,r){super(),this.date=t,this.hour=e,this.step=r}feed(t){return ch.parse(t,this.date,this.hour,this.step)}static parse(t,e,r,i){return Ku.parseDateNumber(t,ch,"hour (12)",2,2,e,r,i)}static term(t,e){return e.hour=(void 0!==e.hour?e.hour:0)+t,jt.done(e)}static cont(t,e,r){return new ch(t,e,r)}}class dh extends jt{constructor(t,e,r){super(),this.locale=t,this.date=e,this.output=r}feed(t){return dh.parse(t,this.locale,this.date,this.output)}static parse(t,e,r,i){return Ku.parseDateString(t,dh,e,r,i)}static term(t,e,r,i){const n=t.months.indexOf(e);return n>=0?(r.hour=(r.hour||0)+12*n,jt.done(r)):jt.error(Et.message("expected period of day, but found "+e,i))}static cont(t,e,r){return new dh(t,e,r)}}class ph extends jt{constructor(t,e,r){super(),this.date=t,this.minute=e,this.step=r}feed(t){return ph.parse(t,this.date,this.minute,this.step)}static parse(t,e,r,i){return Ku.parseDateNumber(t,ph,"minute",2,2,e,r,i)}static term(t,e){return e.minute=t,jt.done(e)}static cont(t,e,r){return new ph(t,e,r)}}class fh extends jt{constructor(t,e,r){super(),this.date=t,this.second=e,this.step=r}feed(t){return fh.parse(t,this.date,this.second,this.step)}static parse(t,e,r,i){return Ku.parseDateNumber(t,fh,"second",2,2,e,r,i)}static term(t,e){return e.second=t,jt.done(e)}static cont(t,e,r){return new fh(t,e,r)}}class yh extends jt{constructor(t,e,r){super(),this.date=t,this.millisecond=e,this.step=r}feed(t){return yh.parse(t,this.date,this.millisecond,this.step)}static parse(t,e,r,i){return Ku.parseDateNumber(t,yh,"millisecond",1,3,e,r,i)}static term(t,e){return e.millisecond=t,jt.done(e)}static cont(t,e,r){return new yh(t,e,r)}}class mh extends jt{constructor(t,e,r,i,n){super(),this.pattern=t,this.specifiers=e,this.date=r,this.dateParser=i,this.step=n}feed(t){return mh.parse(t,this.pattern,this.specifiers,this.date,this.dateParser,this.step)}static parse(t,e,r,i={},n,s=0){let o=0;const a=e.length;for(;s<a;){const a=e.charCodeAt(s);if(37===a){if(void 0===n){const o=e.charAt(s+1),a=r[o];if(void 0===a)return jt.error(Et.message("unknown format specifier: "+o,t));n=a.parseDateTime(t,i)}else n=n.feed(t);if(n.isDone()){i=n.bind(),n=void 0,s+=2;continue}if(n.isError())return n.asError()}else{if(t.isCont()){if(o=t.head(),o===a){t.step(),s+=1;continue}return jt.error(Et.expected(a,t))}if(!t.isEmpty())return jt.error(Et.unexpected(t))}break}return s===a?jt.done(i):new mh(e,r,i,n,s)}}class wh{next(t,e){return this.floor(this.offset(t,e))}ceil(t){return t=t instanceof Uu?new Uu(t.time-1,t.zone):Uu.time(t)-1,this.next(this.floor(t),1)}round(t){const e=Uu.fromAny(t),r=this.floor(e),i=this.ceil(e);return e.time-r.time<i.time-e.time?r:i}range(t,e,r){let i=this.ceil(t);const n=Uu.time(e),s=[];if((r="number"==typeof r?Math.floor(r):1)>0)for(;i.isDefined()&&i.time<n;)s.push(i),i=this.next(i,r);return s}filter(t){return new vh(this,t)}static get year(){return new bh}static get month(){return new Ch}static get week(){return new Oh}static get day(){return new Sh}static get hour(){return new Eh}static get minute(){return new kh}static get second(){return new Ah}static get millisecond(){return new Mh}static years(t,e,r){return wh.year.range(t,e,r)}static months(t,e,r){return wh.month.range(t,e,r)}static weeks(t,e,r){return wh.week.range(t,e,r)}static days(t,e,r){return wh.day.range(t,e,r)}static hours(t,e,r){return wh.hour.range(t,e,r)}static minutes(t,e,r){return wh.minute.range(t,e,r)}static seconds(t,e,r){return wh.second.range(t,e,r)}static milliseconds(t,e,r){return wh.millisecond.range(t,e,r)}}wh.MillisPerSecond=1e3,wh.MillisPerMinute=60*wh.MillisPerSecond,wh.MillisPerHour=60*wh.MillisPerMinute,e([s],wh,"year",null),e([s],wh,"month",null),e([s],wh,"week",null),e([s],wh,"day",null),e([s],wh,"hour",null),e([s],wh,"minute",null),e([s],wh,"second",null),e([s],wh,"millisecond",null);class gh extends wh{}class vh extends wh{constructor(t,e){super(),this.unit=t,this.predicate=e}offset(t,e){let r=Uu.fromAny(t);for(e=Math.max(1,"number"==typeof e?Math.floor(e):1);e<0;){do{r=this.unit.offset(r,-1)}while(r.isDefined()&&!this.predicate(r));e+=1}for(;e>0;){do{r=this.unit.offset(r,1)}while(r.isDefined()&&!this.predicate(r));e-=1}return r}floor(t){let e=Uu.fromAny(t);for(;e=this.unit.floor(e),e.isDefined()&&!this.predicate(e);)e=new Uu(e.time-1,e.zone);return e}}class bh extends gh{offset(t,e){let r=Uu.fromAny(t);return e=Math.max(1,"number"==typeof e?Math.floor(e):1),r=r.withYear(r.year+e),r}next(t,e){const r=Uu.fromAny(t);return e=Math.max(1,"number"==typeof e?Math.floor(e):1),r.withYear(r.year+e).withMonth(0,1).withHour(0,0,0,0)}floor(t){return Uu.fromAny(t).withMonth(0,1).withHour(0,0,0,0)}ceil(t){let e=Uu.fromAny(t);return e=new Uu(e.time-1,e.zone),e=e.withMonth(0,1).withHour(0,0,0,0),e=e.withYear(e.year+1),e.withMonth(0,1).withHour(0,0,0,0)}every(t){if(1===t)return this;if(isFinite(t)&&t>=1)return new xh(t);throw new Error(""+t)}}class xh extends wh{constructor(t){super(),this.stride=t}offset(t,e){const r=Uu.fromAny(t);return e=Math.max(1,"number"==typeof e?Math.floor(e):1),r.withYear(r.year+e*this.stride)}next(t,e){let r=Uu.fromAny(t);return e=Math.max(1,"number"==typeof e?Math.floor(e):1),r=r.withYear(Math.floor((r.year+e*this.stride)/this.stride)*this.stride),r.withMonth(0,1).withHour(0,0,0,0)}floor(t){let e=Uu.fromAny(t);return e=e.withYear(Math.floor(e.year/this.stride)*this.stride),e.withMonth(0,1).withHour(0,0,0,0)}ceil(t){let e=Uu.fromAny(t);return e=new Uu(e.time-1,e.zone),e=e.withYear(Math.floor(e.year/this.stride)*this.stride),e=e.withMonth(0,1).withHour(0,0,0,0),e=e.withYear(Math.floor((e.year+this.stride)/this.stride)*this.stride),e.withMonth(0,1).withHour(0,0,0,0)}}class Ch extends gh{offset(t,e){const r=Uu.fromAny(t);return e=Math.max(1,"number"==typeof e?Math.floor(e):1),r.withMonth(r.month+e)}next(t,e){let r=Uu.fromAny(t);return e=Math.max(1,"number"==typeof e?Math.floor(e):1),r=r.withMonth(r.month+e),r.withDay(1).withHour(0,0,0,0)}floor(t){return Uu.fromAny(t).withDay(1).withHour(0,0,0,0)}ceil(t){let e=Uu.fromAny(t);return e=new Uu(e.time-1,e.zone),e=e.withDay(1).withHour(0,0,0,0),e=e.withMonth(e.month+1),e.withDay(1).withHour(0,0,0,0)}every(t){if(1===t)return this;if(isFinite(t)&&t>=1)return new vh(this,Ch.modulo.bind(void 0,t));throw new Error(""+t)}static modulo(t,e){const r=e.month;return isFinite(r)&&r%t==0}}class Oh extends wh{constructor(t=0){super(),this.day=t}offset(t,e){const r=Uu.fromAny(t);return e=Math.max(1,"number"==typeof e?Math.floor(e):1),r.withDay(r.day+7*e)}next(t,e){let r=Uu.fromAny(t);return e=Math.max(1,"number"==typeof e?Math.floor(e):1),r=r.withDay(r.day+7*e),r=r.withDay(r.day-(r.weekday+7-this.day)%7),r.withHour(0,0,0,0)}floor(t){let e=Uu.fromAny(t);return e=e.withDay(e.day-(e.weekday+7-this.day)%7),e.withHour(0,0,0,0)}ceil(t){let e=Uu.fromAny(t);return e=new Uu(e.time-1,e.zone),e=e.withDay(e.day-(e.weekday+7-this.day)%7),e=e.withHour(0,0,0,0),e=e.withDay(e.day+7),e.withHour(0,0,0,0)}}class Sh extends gh{offset(t,e){const r=Uu.fromAny(t);return e=Math.max(1,"number"==typeof e?Math.floor(e):1),r.withDay(r.day+e)}next(t,e){let r=Uu.fromAny(t);return e=Math.max(1,"number"==typeof e?Math.floor(e):1),r=r.withDay(r.day+e),r.withHour(0,0,0,0)}floor(t){return Uu.fromAny(t).withHour(0,0,0,0)}ceil(t){let e=Uu.fromAny(t);return e=new Uu(e.time-1,e.zone),e=e.withHour(0,0,0,0),e=e.withDay(e.day+1),e.withHour(0,0,0,0)}every(t){if(1===t)return this;if(isFinite(t)&&t>=1)return new vh(this,Sh.modulo.bind(void 0,t));throw new Error(""+t)}static modulo(t,e){const r=e.day;return isFinite(r)&&r%t==0}}class Eh extends gh{offset(t,e){const r=Uu.zone(t);return t=Uu.time(t),t+=(e=Math.max(1,"number"==typeof e?Math.floor(e):1))*wh.MillisPerHour,new Uu(t,r)}next(t,e){const r=Uu.zone(t);t=Uu.time(t),t+=(e=Math.max(1,"number"==typeof e?Math.floor(e):1))*wh.MillisPerHour;let i=r.offset*wh.MillisPerMinute%wh.MillisPerHour;return i<0&&(i+=wh.MillisPerHour),t=Math.floor((t-i)/wh.MillisPerHour)*wh.MillisPerHour+i,new Uu(t,r)}floor(t){const e=Uu.zone(t);t=Uu.time(t);let r=e.offset*wh.MillisPerMinute%wh.MillisPerHour;return r<0&&(r+=wh.MillisPerHour),t=Math.floor((t-r)/wh.MillisPerHour)*wh.MillisPerHour+r,new Uu(t,e)}ceil(t){const e=Uu.zone(t);t=Uu.time(t),t-=1;let r=e.offset*wh.MillisPerMinute%wh.MillisPerHour;return r<0&&(r+=wh.MillisPerHour),t=Math.floor((t-r)/wh.MillisPerHour)*wh.MillisPerHour+r+wh.MillisPerHour,t=Math.floor((t-r)/wh.MillisPerHour)*wh.MillisPerHour+r,new Uu(t,e)}every(t){if(1===t)return this;if(isFinite(t)&&t>=1)return new vh(this,Eh.modulo.bind(void 0,t));throw new Error(""+t)}static modulo(t,e){const r=e.hour;return isFinite(r)&&r%t==0}}class kh extends gh{offset(t,e){const r=Uu.zone(t);return t=Uu.time(t),t+=(e=Math.max(1,"number"==typeof e?Math.floor(e):1))*wh.MillisPerMinute,new Uu(t,r)}next(t,e){const r=Uu.zone(t);return t=Uu.time(t),e=Math.max(1,"number"==typeof e?Math.floor(e):1),t=Math.floor((t+e*wh.MillisPerMinute)/wh.MillisPerMinute)*wh.MillisPerMinute,new Uu(t,r)}floor(t){const e=Uu.zone(t);return t=Uu.time(t),t=Math.floor(t/wh.MillisPerMinute)*wh.MillisPerMinute,new Uu(t,e)}ceil(t){const e=Uu.zone(t);return t=Uu.time(t),t=Math.floor((Math.floor((t-1)/wh.MillisPerMinute)*wh.MillisPerMinute+wh.MillisPerMinute)/wh.MillisPerMinute)*wh.MillisPerMinute,new Uu(t,e)}every(t){if(1===t)return this;if(isFinite(t)&&t>=1)return new vh(this,kh.modulo.bind(void 0,t));throw new Error(""+t)}static modulo(t,e){const r=e.minute;return isFinite(r)&&r%t==0}}class Ah extends gh{offset(t,e){const r=Uu.zone(t);return t=Uu.time(t),t+=(e=Math.max(1,"number"==typeof e?Math.floor(e):1))*wh.MillisPerSecond,new Uu(t,r)}next(t,e){const r=Uu.zone(t);return t=Uu.time(t),t+=(e=Math.max(1,"number"==typeof e?Math.floor(e):1))*wh.MillisPerSecond,t=Math.floor(t/wh.MillisPerSecond)*wh.MillisPerSecond,new Uu(t,r)}floor(t){const e=Uu.zone(t);return t=Uu.time(t),t=Math.floor(t/wh.MillisPerSecond)*wh.MillisPerSecond,new Uu(t,e)}ceil(t){const e=Uu.zone(t);return t=Uu.time(t),t=Math.floor((Math.floor((t-1)/wh.MillisPerSecond)*wh.MillisPerSecond+wh.MillisPerSecond)/wh.MillisPerSecond)*wh.MillisPerSecond,new Uu(t,e)}every(t){if(1===t)return this;if(isFinite(t)&&t>=1)return new vh(this,Ah.modulo.bind(void 0,t));throw new Error(""+t)}static modulo(t,e){const r=e.second;return isFinite(r)&&r%t==0}}class Mh extends gh{offset(t,e){const r=Uu.zone(t);return t=Uu.time(t),e=Math.max(1,"number"==typeof e?Math.floor(e):1),new Uu(t+=e,r)}next(t,e){const r=Uu.zone(t);return t=Uu.time(t),e=Math.max(1,"number"==typeof e?Math.floor(e):1),new Uu(t+=e,r)}floor(t){return Uu.fromAny(t)}ceil(t){return Uu.fromAny(t)}every(t){if(1===t)return this;if(isFinite(t)&&t>=1)return new Dh(t);throw new Error(""+t)}}class Dh extends wh{constructor(t){super(),isFinite(t)||(t=1),this.stride=t}offset(t,e){const r=Uu.zone(t);return t=Uu.time(t),t+=(e=Math.max(1,"number"==typeof e?Math.floor(e):1))*this.stride,new Uu(t,r)}next(t,e){const r=Uu.zone(t);t=Uu.time(t),e=Math.max(1,"number"==typeof e?Math.floor(e):1);const i=this.stride;return t=Math.floor((t+e*i)/i)*i,new Uu(t,r)}floor(t){const e=Uu.zone(t);t=Uu.time(t);const r=this.stride;return t=Math.floor(t/r)*r,new Uu(t,e)}ceil(t){const e=Uu.zone(t);t=Uu.time(t);const r=this.stride;return t=Math.floor((Math.floor((t-1)/r)*r+r)/r)*r,new Uu(t,e)}}const Ih=function(t){const e=function(t,r){const i=function(t){const e=i[0].time,r=i[1].time-e;return 0!==r?(t.time-e)/r:0};return Object.setPrototypeOf(i,e.prototype),i[0]=t,i[1]=r,i};return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,Object.defineProperty(e.prototype,"inverse",{get(){return Th(this[0],this[1])},configurable:!0}),e.prototype.contains=function(t){return t=Uu.time(t),this[0].time<=t&&t<=this[1].time},e.prototype.interpolateTo=function(t){return t instanceof e?Ph(this,t):null},e.prototype.canEqual=function(t){return t instanceof e},e.prototype.equals=function(t){return this===t||t instanceof e&&(t.canEqual(this)&&this[0].equals(t[0])&&this[1].equals(t[1]))},e.prototype.toString=function(){return"TimeDomain("+this[0]+", "+this[1]+")"},e}(O),Ph=function(t){const e=function(t,r){const i=function(t){const e=i[0],r=e[0],n=e[1],s=i[1],o=s[0],a=s[1];return Ih(new Uu(r.time+t*(o.time-r.time),0===t?r.zone:o.zone),new Uu(n.time+t*(a.time-n.time),0===t?n.zone:a.zone))};return Object.setPrototypeOf(i,e.prototype),i[0]=t,i[1]=r,i};return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e}(k),Th=function(t){const e=function(t,r){const i=function(t){const e=i[0].time,r=i[1].time;return new Uu(e+t*(r-e),0===t?i[0].zone:i[1].zone)};return Object.setPrototypeOf(i,e.prototype),i[0]=t,i[1]=r,i};return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,Object.defineProperty(e.prototype,"inverse",{get(){return Ih(this[0],this[1])},configurable:!0}),e.prototype.interpolateTo=function(t){return t instanceof e?Vh(this,t):null},e.prototype.canEqual=function(t){return t instanceof e},e.prototype.equals=function(t){return this===t||t instanceof e&&(t.canEqual(this)&&this[0].equals(t[0])&&this[1].equals(t[1]))},e.prototype.toString=function(){return"TimeRange("+this[0]+", "+this[1]+")"},e}(S),Vh=function(t){const e=function(t,r){const i=function(t){const e=i[0],r=e[0],n=e[1],s=i[1],o=s[0],a=s[1];return Th(new Uu(r.time+t*(o.time-r.time),0===t?r.zone:o.zone),new Uu(n.time+t*(a.time-n.time),0===t?n.zone:a.zone))};return Object.setPrototypeOf(i,e.prototype),i[0]=t,i[1]=r,i};return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e}(k),Fh=function(t){const e=function(t,r){const i=function(t){return i.range(i.domain(t))};return Object.setPrototypeOf(i,e.prototype),i.domain=t,i.range=r,i};return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,Object.defineProperty(e.prototype,"inverse",{get(){return C(this.range.inverse,this.domain.inverse)},configurable:!0}),e.prototype.withDomain=function(t,r){let i;return 1===arguments.length?i=t:(t=Uu.fromAny(t),r=Uu.fromAny(r),i=Ih(t,r)),e(i,this.range)},e.prototype.overRange=function(t,r){let i;return i=1===arguments.length?t:N(t,r),e(this.domain,i)},e.prototype.clampDomain=function(t,r,i,n,s){void 0===s&&(s=u.Epsilon);const o=this.domain[0],a=this.domain[1];let h=o.time,l=a.time;const c=void 0!==t?t.time:void 0,d=void 0!==r?r.time:void 0;void 0!==c&&void 0!==d&&Math.abs(l-h)>d-c?h<l?(h=c,l=d):(l=c,h=d):(void 0!==c&&(h<l&&h<c?(l+=c-h,h=c):l<h&&l<c&&(h+=c-l,l=c)),void 0!==d&&(h<l&&l>d?(h-=l-d,l=d):l<h&&h>d&&(l-=h-d,h=d)));const p=this(o),f=this(a),y=p<f?f-p:p-f,m=Math.abs(y/(l-h));if(void 0!==i&&m<1/i){const t=y*i,e=h+l;h=(e-t)/2,l=(e+t)/2}else if(void 0!==n&&m>1/n){const t=y*n,e=h+l;h=(e-t)/2,l=(e+t)/2}return Math.abs(h-o.time)<s&&Math.abs(l-a.time)<s?this:e(Ih(new Uu(h,o.zone),new Uu(l,a.zone)),this.range)},e.prototype.solveDomain=function(t,r,i,n,s,o){void 0===o&&(o=u.Epsilon);const a=this.domain[1].time-this.domain[0].time,h=this.range[0],l=this.range[1],c=t.time,d=void 0!==i?i.time:void 0;let p;void 0===d||void 0===n||Math.abs(d-c)<o||Math.abs(n-r)<o?p=(l-h)/(0!==a?a:o):(p=(n-r)/(d-c),void 0!==s&&s||p<0==(l-h)/a<0||(p=-p));const f=r-p*c,y=(h-f)/p,m=(l-f)/p;return Math.abs(y-this.domain[0].time)<o&&Math.abs(m-this.domain[1].time)<o?this:e(Ih(new Uu(y,this.domain[0].zone),new Uu(m,this.domain[1].zone)),this.range)},e.prototype.interpolateTo=function(t){return t instanceof e?qh(this,t):null},e.prototype.canEqual=function(t){return t instanceof e},e.prototype.equals=function(t){return this===t||t instanceof e&&(this.domain.equals(t.domain)&&this.range.equals(t.range))},e.prototype.toString=function(){return"TimeScale("+this.domain+", "+this.range+")"},e}(L),qh=function(t){const e=function(t,r){const i=function(t){const e=i[0],r=i[1],n=e.domain,s=n[0].time,o=n[1].time,a=r.domain,u=a[0].time,h=a[1].time,l=Ih(new Uu(s+t*(u-s),0===t?n[0].zone:a[0].zone),new Uu(o+t*(h-o),0===t?n[1].zone:a[1].zone)),c=e.range,d=c[0],p=c[1],f=r.range,y=f[0],m=f[1],w=N(d+t*(y-d),p+t*(m-p));return Fh(l,w)};return Object.setPrototypeOf(i,e.prototype),i[0]=t,i[1]=r,i};return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e}(k);class Uh{get tag(){return this.constructor.tag}withPrio(t){return this}withRate(t){return this}toRecon(){return hs.toString(this.toValue())}toString(){return Ot.debug(this)}static fromValue(t){switch(t.tag){case"event":return jh.fromValue(t);case"command":return Lh.fromValue(t);case"link":return Kh.fromValue(t);case"linked":return Bh.fromValue(t);case"sync":return Wh.fromValue(t);case"synced":return Hh.fromValue(t);case"unlink":return Xh.fromValue(t);case"unlinked":return Yh.fromValue(t);case"auth":return Gh.fromValue(t);case"authed":return _h.fromValue(t);case"deauth":return Qh.fromValue(t);case"deauthed":return Zh.fromValue(t);default:return null}}static parseRecon(t){return Uh.fromValue(hs.parse(t))}}Object.defineProperty(Uh.prototype,"prio",{get:()=>0,configurable:!0}),Object.defineProperty(Uh.prototype,"rate",{get:()=>0,configurable:!0});class Rh extends Uh{constructor(t){super(),this.body=t}get node(){return po.empty()}withNode(t){return this}get lane(){return po.empty()}withLane(t){return this}withBody(t){return t=yr.fromAny(t),this.copy(t)}equals(t){return this===t||t instanceof Rh&&(this.constructor===t.constructor&&this.body.equals(t.body))}hashCode(){return n.mash(n.mix(p.hash(this.constructor),this.body.hashCode()))}debug(t){return t=t.write(this.constructor.name).write(46).write("create").write(40),this.body.isDefined()&&(t=t.debug(this.body)),t=t.write(41)}toValue(){return dr.of(this.tag).concat(this.body)}static fromValue(t){if(t.header(this.tag).isDefined()){return new this(t.body())}return null}}class Nh extends Uh{constructor(t,e,r){super(),this.node=t,this.lane=e,this.body=r}withNode(t){return t=po.fromAny(t),this.copy(t,this.lane,this.body)}withLane(t){return t=po.fromAny(t),this.copy(this.node,t,this.body)}withBody(t){return t=yr.fromAny(t),this.copy(this.node,this.lane,t)}equals(t){return this===t||t instanceof Nh&&(this.constructor===t.constructor&&this.node.equals(t.node)&&this.lane.equals(t.lane)&&this.body.equals(t.body))}hashCode(){return n.mash(n.mix(n.mix(n.mix(p.hash(this.constructor),this.node.hashCode()),this.lane.hashCode()),this.body.hashCode()))}debug(t){return t=t.write(this.constructor.name).write(46).write("create").write(40).debug(this.node.toString()).write(", ").debug(this.lane.toString()),this.body.isDefined()&&(t=t.write(", ").debug(this.body)),t=t.write(41)}toValue(){const t=mr.create(2).slot("node",this.node.toString()).slot("lane",this.lane.toString());return dr.of(this.tag,t).concat(this.body)}static fromValue(t){let e,r;if(t.header(this.tag).forEach((function(t,i){const n=t.key.stringValue(void 0);void 0!==n?"node"===n?e=po.parse(t.toValue().stringValue("")):"lane"===n&&(r=po.parse(t.toValue().stringValue(""))):t instanceof yr&&(0===i?e=po.parse(t.stringValue("")):1===i&&(r=po.parse(t.stringValue(""))))})),void 0!==e&&void 0!==r){const i=t.body();return new this(e,r,i)}return null}}class zh extends Uh{constructor(t,e,r,i,n){super(),this.node=t,this.lane=e,Object.defineProperty(this,"prio",{value:r,writable:!0,enumerable:!0,configurable:!0}),Object.defineProperty(this,"rate",{value:i,writable:!0,enumerable:!0,configurable:!0}),this.body=n}withNode(t){return t=po.fromAny(t),this.copy(t,this.lane,this.prio,this.rate,this.body)}withLane(t){return t=po.fromAny(t),this.copy(this.node,t,this.prio,this.rate,this.body)}withPrio(t){return this.copy(this.node,this.lane,t,this.rate,this.body)}withRate(t){return this.copy(this.node,this.lane,this.prio,t,this.body)}withBody(t){return t=yr.fromAny(t),this.copy(this.node,this.lane,this.prio,this.rate,t)}equals(t){return this===t||t instanceof zh&&(this.constructor===t.constructor&&this.node.equals(t.node)&&this.lane.equals(t.lane)&&this.prio===t.prio&&this.rate===t.rate&&this.body.equals(t.body))}hashCode(){return n.mash(n.mix(n.mix(n.mix(n.mix(n.mix(p.hash(this.constructor),this.node.hashCode()),this.lane.hashCode()),h.hash(this.prio)),h.hash(this.rate)),this.body.hashCode()))}debug(t){return t=t.write(this.constructor.name).write(46).write("create").write(40).debug(this.node.toString()).write(", ").debug(this.lane.toString()),0===this.prio&&0===this.rate||(t=t.write(", ").debug(this.prio).write(", ").debug(this.rate)),this.body.isDefined()&&(t=t.write(", ").debug(this.body)),t=t.write(41)}toValue(){const t=mr.create(4).slot("node",this.node.toString()).slot("lane",this.lane.toString());return 0!==this.prio&&t.slot("prio",this.prio),0!==this.rate&&t.slot("rate",this.rate),dr.of(this.tag,t).concat(this.body)}static fromValue(t){let e,r,i=0,n=0;if(t.header(this.tag).forEach((function(t,s){const o=t.key.stringValue(void 0);void 0!==o?"node"===o?e=po.parse(t.toValue().stringValue("")):"lane"===o?r=po.parse(t.toValue().stringValue("")):"prio"===o?i=t.numberValue(i):"rate"===o&&(n=t.numberValue(n)):t instanceof yr&&(0===s?e=po.parse(t.stringValue("")):1===s&&(r=po.parse(t.stringValue(""))))})),void 0!==e&&void 0!==r){const s=t.body();return new this(e,r,i,n,s)}return null}}class jh extends Nh{constructor(t,e,r){super(t,e,r)}copy(t,e,r){return new jh(t,e,r)}static get tag(){return"event"}static create(t,e,r=yr.absent()){return t=po.fromAny(t),e=po.fromAny(e),r=yr.fromAny(r),new jh(t,e,r)}}class Lh extends Nh{constructor(t,e,r){super(t,e,r)}copy(t,e,r){return new Lh(t,e,r)}static get tag(){return"command"}static create(t,e,r=yr.absent()){return t=po.fromAny(t),e=po.fromAny(e),r=yr.fromAny(r),new Lh(t,e,r)}}class Kh extends zh{constructor(t,e,r,i,n){super(t,e,r,i,n)}copy(t,e,r,i,n){return new Kh(t,e,r,i,n)}static get tag(){return"link"}static create(t,e,r=0,i=0,n=yr.absent()){return t=po.fromAny(t),e=po.fromAny(e),n=yr.fromAny(n),new Kh(t,e,r,i,n)}}class Bh extends zh{constructor(t,e,r,i,n){super(t,e,r,i,n)}copy(t,e,r,i,n){return new Bh(t,e,r,i,n)}static get tag(){return"linked"}static create(t,e,r=0,i=0,n=yr.absent()){return t=po.fromAny(t),e=po.fromAny(e),n=yr.fromAny(n),new Bh(t,e,r,i,n)}}class Wh extends zh{constructor(t,e,r,i,n){super(t,e,r,i,n)}copy(t,e,r,i,n){return new Wh(t,e,r,i,n)}static get tag(){return"sync"}static create(t,e,r=0,i=0,n=yr.absent()){return t=po.fromAny(t),e=po.fromAny(e),n=yr.fromAny(n),new Wh(t,e,r,i,n)}}class Hh extends Nh{constructor(t,e,r){super(t,e,r)}copy(t,e,r){return new Hh(t,e,r)}static get tag(){return"synced"}static create(t,e,r=yr.absent()){return t=po.fromAny(t),e=po.fromAny(e),r=yr.fromAny(r),new Hh(t,e,r)}}class Xh extends Nh{constructor(t,e,r){super(t,e,r)}copy(t,e,r){return new Xh(t,e,r)}static get tag(){return"unlink"}static create(t,e,r=yr.absent()){return t=po.fromAny(t),e=po.fromAny(e),r=yr.fromAny(r),new Xh(t,e,r)}}class Yh extends Nh{constructor(t,e,r){super(t,e,r)}copy(t,e,r){return new Yh(t,e,r)}static get tag(){return"unlinked"}static create(t,e,r=yr.absent()){return t=po.fromAny(t),e=po.fromAny(e),r=yr.fromAny(r),new Yh(t,e,r)}}class Gh extends Rh{constructor(t){super(t)}copy(t){return new Gh(t)}static get tag(){return"auth"}static create(t=yr.absent()){return t=yr.fromAny(t),new Gh(t)}}class _h extends Rh{constructor(t){super(t)}copy(t){return new _h(t)}static get tag(){return"authed"}static create(t=yr.absent()){return t=yr.fromAny(t),new _h(t)}}class Qh extends Rh{constructor(t){super(t)}copy(t){return new Qh(t)}static get tag(){return"deauth"}static create(t=yr.absent()){return t=yr.fromAny(t),new Qh(t)}}class Zh extends Rh{constructor(t){super(t)}copy(t){return new Zh(t)}static get tag(){return"deauthed"}static create(t=yr.absent()){return t=yr.fromAny(t),new Zh(t)}}class Jh{}class $h extends Jh{constructor(t,e,r={}){super(),this.context=t,this.hostUri=e,this.options=r,this.authenticated=!1,this.session=yr.absent(),this.sendBuffer=[],this.downlinks=new Te,this.downlinkCount=0,this.uriCache=new qo(e),this.reconnectTimer=0,this.reconnectTimeout=0,this.idleTimer=0}get credentials(){var t;return null!==(t=this.options.credentials)&&void 0!==t?t:yr.absent()}get unlinkDelay(){var t;return null!==(t=this.options.unlinkDelay)&&void 0!==t?t:$h.UnlinkDelay}get maxReconnectTimeout(){var t;return null!==(t=this.options.maxReconnectTimeout)&&void 0!==t?t:$h.MaxReconnectTimeout}get idleTimeout(){var t;return null!==(t=this.options.idleTimeout)&&void 0!==t?t:$h.IdleTimeout}get sendBufferSize(){var t;return null!==(t=this.options.sendBufferSize)&&void 0!==t?t:$h.SendBufferSize}isAuthenticated(){return this.authenticated}isIdle(){return 0===this.sendBuffer.length&&0===this.downlinkCount}resolve(t){return this.uriCache.resolve(t)}unresolve(t){return this.uriCache.unresolve(t)}authenticate(t){if(!(t=yr.fromAny(t)).equals(this.options.credentials))if(this.options.credentials=t,this.isConnected()){const e=new Gh(t);this.push(e)}else this.open()}openDownlink(t){this.clearIdle();const e=this.resolve(t.nodeUri),r=t.laneUri;0===this.downlinkCount&&this.open();let i=this.downlinks.get(e);if(void 0===i&&(i=new Te,this.downlinks.set(e,i)),void 0!==i.get(r))throw new Error("duplicate downlink");i.set(r,t),this.downlinkCount+=1,t.openUp(this),this.isConnected()&&t.hostDidConnect(this)}unlinkDownlink(t){const e=this.resolve(t.nodeUri),r=t.laneUri,i=this.downlinks.get(e);if(void 0!==i&&i.get(r)&&this.isConnected()){const i=new Xh(this.unresolve(e),r,yr.absent());t.onUnlinkRequest(i,this),this.push(i)}}closeDownlink(t){const e=this.resolve(t.nodeUri),r=t.laneUri,i=this.downlinks.get(e);void 0!==i&&i.get(r)&&(this.downlinkCount-=1,i.delete(r),i.isEmpty()&&this.downlinks.delete(e),0===this.downlinkCount&&this.watchIdle(),t.closeUp(this))}command(t,e,r){t=po.fromAny(t),t=this.resolve(t),e=po.fromAny(e),r=yr.fromAny(r);const i=new Lh(this.unresolve(t),e,r);this.push(i)}onEnvelope(t){t instanceof jh?this.onEventMessage(t):t instanceof Lh?this.onCommandMessage(t):t instanceof Kh?this.onLinkRequest(t):t instanceof Bh?this.onLinkedResponse(t):t instanceof Wh?this.onSyncRequest(t):t instanceof Hh?this.onSyncedResponse(t):t instanceof Xh?this.onUnlinkRequest(t):t instanceof Yh?this.onUnlinkedResponse(t):t instanceof Gh?this.onAuthRequest(t):t instanceof _h?this.onAuthedResponse(t):t instanceof Qh?this.onDeauthRequest(t):t instanceof Zh?this.onDeauthedResponse(t):this.onUnknownEnvelope(t)}onEventMessage(t){const e=this.resolve(t.node),r=t.lane,i=this.downlinks.get(e);if(void 0!==i){const n=i.get(r);if(void 0!==n){const r=t.withNode(e);n.onEventMessage(r,this)}}}onCommandMessage(t){}onLinkRequest(t){}onLinkedResponse(t){const e=this.resolve(t.node),r=t.lane,i=this.downlinks.get(e);if(void 0!==i){const n=i.get(r);if(void 0!==n){const r=t.withNode(e);n.onLinkedResponse(r,this)}}}onSyncRequest(t){}onSyncedResponse(t){const e=this.resolve(t.node),r=t.lane,i=this.downlinks.get(e);if(void 0!==i){const n=i.get(r);if(void 0!==n){const r=t.withNode(e);n.onSyncedResponse(r,this)}}}onUnlinkRequest(t){}onUnlinkedResponse(t){const e=this.resolve(t.node),r=t.lane,i=this.downlinks.get(e);if(void 0!==i){const n=i.get(r);if(void 0!==n){const r=t.withNode(e);n.onUnlinkedResponse(r,this)}}}onAuthRequest(t){}onAuthedResponse(t){this.authenticated=!0,this.session=t.body,this.context.hostDidAuthenticate(t.body,this)}onDeauthRequest(t){}onDeauthedResponse(t){this.authenticated=!1,this.session=yr.absent(),this.context.hostDidDeauthenticate(t.body,this)}onUnknownEnvelope(t){}onConnect(){this.reconnectTimeout=0,this.context.hostDidConnect(this),this.downlinks.forEach((function(t,e){e.forEach((function(t,e){e.hostDidConnect(this)}),this)}),this)}onDisconnect(){this.authenticated=!1,this.session=yr.absent(),this.context.hostDidDisconnect(this),this.downlinks.forEach((function(t,e){e.forEach((function(t,e){e.hostDidDisconnect(this)}),this)}),this)}onError(t){this.context.hostDidFail(t,this),this.downlinks.forEach((function(e,r){r.forEach((function(e,r){r.hostDidFail(t,this)}),this)}),this)}reconnect(){0===this.reconnectTimer&&(0===this.reconnectTimeout?this.reconnectTimeout=Math.floor(500+1e3*Math.random()):this.reconnectTimeout=Math.min(Math.floor(1.8*this.reconnectTimeout),this.maxReconnectTimeout),this.reconnectTimer=setTimeout(this.open.bind(this),this.reconnectTimeout))}clearReconnect(){0!==this.reconnectTimer&&(clearTimeout(this.reconnectTimer),this.reconnectTimer=0)}watchIdle(){0===this.idleTimer&&this.isConnected()&&this.isIdle()&&(this.idleTimer=setTimeout(this.checkIdle.bind(this),this.idleTimeout))}clearIdle(){0!==this.idleTimer&&(clearTimeout(this.idleTimer),this.idleTimer=0)}checkIdle(){this.isConnected()&&this.isIdle()&&this.close()}close(){this.context.closeHost(this)}closeUp(){this.downlinks.forEach((function(t,e){e.forEach((function(t,e){e.closeUp(this)}),this)}),this)}}$h.UnlinkDelay=0,$h.MaxReconnectTimeout=3e4,$h.IdleTimeout=1e3,$h.SendBufferSize=1024;class tl extends $h{constructor(t,e,r={}){super(t,e,r),this.socket=null}isConnected(){return null!==this.socket&&this.socket.readyState===this.socket.OPEN}open(){this.clearReconnect();let t=this.socket;if(null===t){let e;if(void 0!==this.options.WebSocket)e=this.options.WebSocket;else if("undefined"!=typeof WebSocket)e=WebSocket;else{if(null===tl.WebSocket)throw new Error("Missing WebSocket implementation");e=tl.WebSocket}let r=this.hostUri;const i=r.schemeName;"warp"===i||"swim"===i?r=r.withSchemeName("ws"):"warps"!==i&&"swims"!==i||(r=r.withSchemeName("wss")),t=void 0!==this.options.protocols?new e(r.toString(),this.options.protocols):new e(r.toString()),this.socket=t,t.onopen=this.onWebSocketOpen.bind(this),t.onmessage=this.onWebSocketMessage.bind(this),t.onclose=this.onWebSocketClose.bind(this),t.onerror=this.onWebSocketError.bind(this)}}close(){this.clearReconnect(),this.clearIdle(),null!==this.socket?(this.socket.close(),this.context.isOnline()||this.onWebSocketClose()):super.close()}push(t){if(this.isConnected()){this.clearIdle();const e=t.toRecon();this.socket.send(e),this.watchIdle()}else if(t instanceof Lh){if(!(this.sendBuffer.length<this.sendBufferSize))throw new Error("send buffer overflow");this.sendBuffer.push(t),this.open()}}onWebSocketOpen(){if(this.isConnected()){const t=this.credentials;if(t.isDefined()){const e=new Gh(t);this.push(e)}let e;for(this.onConnect();(e=this.sendBuffer.shift())&&this.isConnected();)this.push(e);this.watchIdle()}else this.close()}onWebSocketMessage(t){const e=t.data;if("string"==typeof e){const t=Uh.parseRecon(e);null!==t?this.onEnvelope(t):this.onUnknownEnvelope(e)}}onWebSocketClose(){const t=this.socket;null!==t&&(t.onopen=null,t.onmessage=null,t.onclose=null,t.onerror=null,this.socket=null),this.onDisconnect(),this.clearIdle(),this.isIdle()?this.close():this.context.isOnline()&&this.reconnect()}onWebSocketError(){null!==this.socket&&(this.socket.close(),this.context.isOnline()?this.onError():this.onWebSocketClose())}}tl.WebSocket=null,function(){if("function"==typeof require)try{return Promise.resolve(require("ws"))}catch(t){}return Promise.reject(void 0)}().then((t=>{tl.WebSocket=t.WebSocket}),(t=>{}));class el{constructor(t,e,r,i,n=0,s=0,o=yr.absent()){this.context=t,this.hostUri=e,this.nodeUri=r,this.laneUri=i,this.prio=n,this.rate=s,this.body=o,this.views=v.empty,this.host=null,this.status=0}keepLinked(){const t=this.views;for(let e=0,r=t.length;e<r;e+=1)if(t[e].keepLinked())return!0;return!1}keepSynced(){for(let t=0,e=this.views.length;t<e;t+=1)if(this.views[t].keepSynced())return!0;return!1}get unlinkDelay(){const t=this.host;return null!==t?t.unlinkDelay:0}isConnected(){const t=this.host;return null!==t&&t.isConnected()}isAuthenticated(){const t=this.host;return null!==t&&t.isAuthenticated()}isLinked(){return 0!=(this.status&el.Linked)}isSynced(){return 0!=(this.status&el.Synced)}get session(){const t=this.host;return null!==t?t.session:yr.absent()}addDownlink(t){this.views=v.inserted(t,this.views)}removeDownlink(t){const e=this.views,r=v.removed(t,e);if(e!==r&&(this.views=r,t.closeUp(),0===r.length)){const t=this.unlinkDelay;t<0?this.unlink():setTimeout(this.doUnlink.bind(this),t)}}onEventMessage(t,e){const r=this.views;for(let e=0,i=r.length;e<i;e+=1)r[e].onEventMessage(t)}onCommandMessage(t){const e=this.views;for(let r=0,i=e.length;r<i;r+=1)e[r].onCommandMessage(t)}onLinkRequest(t){this.status|=el.Linking;const e=this.views;for(let r=0,i=e.length;r<i;r+=1)e[r].onLinkRequest(t)}onLinkedResponse(t,e){this.status=this.status&~el.Linking|el.Linked;const r=this.views;for(let e=0,i=r.length;e<i;e+=1)r[e].onLinkedResponse(t)}onSyncRequest(t){this.status|=el.Syncing;const e=this.views;for(let r=0,i=e.length;r<i;r+=1)e[r].onSyncRequest(t)}onSyncedResponse(t,e){this.status=this.status&~el.Syncing|el.Synced;const r=this.views;for(let e=0,i=r.length;e<i;e+=1)r[e].onSyncedResponse(t)}onUnlinkRequest(t,e){this.status=this.status&~(el.Linking|el.Syncing)|el.Unlinking;const r=this.views;for(let e=0,i=r.length;e<i;e+=1)r[e].onUnlinkRequest(t)}onUnlinkedResponse(t,e){this.status&=~el.Unlinking;const r=this.views;if(0===r.length||0!==this.status){for(let e=0,i=r.length;e<i;e+=1)r[e].onUnlinkedResponse(t);this.close()}else this.keepSynced()?this.sync():this.link()}hostDidConnect(t){const e=this.views;for(let t=0,r=e.length;t<r;t+=1)e[t].hostDidConnect();this.keepSynced()?this.sync():this.link()}hostDidDisconnect(t){this.status=0;let e=!1;const r=this.views;for(let t=0,i=r.length;t<i;t+=1){const i=r[t];i.hostDidDisconnect(),e=e||i.keepLinked()}e||this.close()}hostDidFail(t,e){const r=this.views;for(let e=0,i=r.length;e<i;e+=1)r[e].hostDidFail(t)}command(t){t=yr.fromAny(t),this.onCommandMessage(t),this.host.command(this.nodeUri,this.laneUri,t)}sync(){const t=this.host.unresolve(this.nodeUri),e=new Wh(t,this.laneUri,this.prio,this.rate,this.body);this.onSyncRequest(e),this.host.push(e)}link(){const t=this.host.unresolve(this.nodeUri),e=new Kh(t,this.laneUri,this.prio,this.rate,this.body);this.onLinkRequest(e),this.host.push(e)}unlink(){this.status=el.Unlinking,this.context.unlinkDownlink(this)}doUnlink(){0===this.views.length&&this.unlink()}close(){this.context.closeDownlink(this)}openUp(t){this.host=t;for(let e=0,r=this.views.length;e<r;e+=1)this.views[e].openUp(t)}closeUp(){const t=this.views;this.views=v.empty;for(let e=0,r=t.length;e<r;e+=1)t[e].closeUp()}}var rl;el.Linking=1,el.Linked=2,el.Syncing=4,el.Synced=8,el.Unlinking=16,t.DownlinkFlags=void 0,(rl=t.DownlinkFlags||(t.DownlinkFlags={}))[rl.KeepLinked=1]="KeepLinked",rl[rl.KeepSynced=2]="KeepSynced",rl[rl.KeepLinkedSynced=3]="KeepLinkedSynced";class il{constructor(t,e,r,i=po.empty(),n=po.empty(),s=po.empty(),o=0,a=0,u=yr.absent(),h=0,l){var c,d,p,f,y,m,w,g,b,x,C,O;let S;void 0===l?l=v.empty:Array.isArray(l)||(S=l,l=[S]),void 0!==r&&(i=void 0!==r.hostUri?po.fromAny(r.hostUri):i,n=void 0!==r.nodeUri?po.fromAny(r.nodeUri):n,s=void 0!==r.laneUri?po.fromAny(r.laneUri):s,o=void 0!==r.prio?r.prio:o,a=void 0!==r.rate?r.rate:a,u=void 0!==r.body?yr.fromAny(r.body):u,S=null!=S?S:{},l=v.inserted(S,l),S.onEvent=null!==(c=r.onEvent)&&void 0!==c?c:S.onEvent,S.onCommand=null!==(d=r.onCommand)&&void 0!==d?d:S.onCommand,S.willLink=null!==(p=r.willLink)&&void 0!==p?p:S.willLink,S.didLink=null!==(f=r.didLink)&&void 0!==f?f:S.didLink,S.willSync=null!==(y=r.willSync)&&void 0!==y?y:S.willSync,S.didSync=null!==(m=r.didSync)&&void 0!==m?m:S.didSync,S.willUnlink=null!==(w=r.willUnlink)&&void 0!==w?w:S.willUnlink,S.didUnlink=null!==(g=r.didUnlink)&&void 0!==g?g:S.didUnlink,S.didConnect=null!==(b=r.didConnect)&&void 0!==b?b:S.didConnect,S.didDisconnect=null!==(x=r.didDisconnect)&&void 0!==x?x:S.didDisconnect,S.didClose=null!==(C=r.didClose)&&void 0!==C?C:S.didClose,S.didFail=null!==(O=r.didFail)&&void 0!==O?O:S.didFail),this.context=t,this.owner=e,this.ownHostUri=i,this.ownNodeUri=n,this.ownLaneUri=s,this.ownPrio=o,this.ownRate=a,this.ownBody=u,this.flags=h,this.model=null,this.observers=l}hostUri(t){return void 0===t?this.ownHostUri:(t=po.fromAny(t),this.copy(this.context,this.owner,t,this.ownNodeUri,this.ownLaneUri,this.ownPrio,this.ownRate,this.ownBody,this.flags,this.observers))}nodeUri(t){return void 0===t?this.ownNodeUri:(t=po.fromAny(t),this.copy(this.context,this.owner,this.ownHostUri,t,this.ownLaneUri,this.ownPrio,this.ownRate,this.ownBody,this.flags,this.observers))}laneUri(t){return void 0===t?this.ownLaneUri:(t=po.fromAny(t),this.copy(this.context,this.owner,this.ownHostUri,this.ownNodeUri,t,this.ownPrio,this.ownRate,this.ownBody,this.flags,this.observers))}prio(t){return void 0===t?this.ownPrio:this.copy(this.context,this.owner,this.ownHostUri,this.ownNodeUri,this.ownLaneUri,t,this.ownRate,this.ownBody,this.flags,this.observers)}rate(t){return void 0===t?this.ownRate:this.copy(this.context,this.owner,this.ownHostUri,this.ownNodeUri,this.ownLaneUri,this.ownPrio,t,this.ownBody,this.flags,this.observers)}body(t){return void 0===t?this.ownBody:(t=yr.fromAny(t),this.copy(this.context,this.owner,this.ownHostUri,this.ownNodeUri,this.ownLaneUri,this.ownPrio,this.ownRate,t,this.flags,this.observers))}keepLinked(t){if(void 0===t)return 0!=(1&this.flags);{const e=t?1|this.flags:-2&this.flags;return this.copy(this.context,this.owner,this.ownHostUri,this.ownNodeUri,this.ownLaneUri,this.ownPrio,this.ownRate,this.ownBody,e,this.observers)}}keepSynced(t){if(void 0===t)return 0!=(2&this.flags);{const e=t?2|this.flags:-3&this.flags;return this.copy(this.context,this.owner,this.ownHostUri,this.ownNodeUri,this.ownLaneUri,this.ownPrio,this.ownRate,this.ownBody,e,this.observers)}}observe(t){return this.observers=v.inserted(t,this.observers),this}unobserve(t){const e=this.observers,r=e.length;for(let i=0;i<r;i+=1){const n=e[i];let s=n===t;if(!s)for(const e in n)if(n[e]===t){s=!0;break}if(s){if(r>1){const t=new Array(r-1);for(let r=0;r<i;r+=1)t[r]=e[r];for(let n=i+1;n<r;n+=1)t[n-1]=e[n];this.observers=t}else this.observers=v.empty;break}}return this}onEvent(t){return this.observe({onEvent:t})}onCommand(t){return this.observe({onCommand:t})}willLink(t){return this.observe({willLink:t})}didLink(t){return this.observe({didLink:t})}willSync(t){return this.observe({willSync:t})}didSync(t){return this.observe({didSync:t})}willUnlink(t){return this.observe({willUnlink:t})}didUnlink(t){return this.observe({didUnlink:t})}didConnect(t){return this.observe({didConnect:t})}didDisconnect(t){return this.observe({didDisconnect:t})}didClose(t){return this.observe({didClose:t})}didFail(t){return this.observe({didFail:t})}isConnected(){const t=this.model;return null!==t&&t.isConnected()}isAuthenticated(){const t=this.model;return null!==t&&t.isAuthenticated()}isLinked(){const t=this.model;return null!==t&&t.isLinked()}isSynced(){const t=this.model;return null!==t&&t.isSynced()}get session(){const t=this.model;return null!==t?t.session:yr.absent()}onEventMessage(t){const e=this.observers;for(let r=0,i=e.length;r<i;r+=1){const i=e[r];void 0!==i.onEvent&&i.onEvent(t.body,this)}}onCommandMessage(t){const e=this.observers;for(let r=0,i=e.length;r<i;r+=1){const i=e[r];void 0!==i.onCommand&&i.onCommand(t,this)}}onLinkRequest(t){const e=this.observers;for(let t=0,r=e.length;t<r;t+=1){const r=e[t];void 0!==r.willLink&&r.willLink(this)}}onLinkedResponse(t){const e=this.observers;for(let t=0,r=e.length;t<r;t+=1){const r=e[t];void 0!==r.didLink&&r.didLink(this)}}onSyncRequest(t){const e=this.observers;for(let t=0,r=e.length;t<r;t+=1){const r=e[t];void 0!==r.willSync&&r.willSync(this)}}onSyncedResponse(t){const e=this.observers;for(let t=0,r=e.length;t<r;t+=1){const r=e[t];void 0!==r.didSync&&r.didSync(this)}}onUnlinkRequest(t){const e=this.observers;for(let t=0,r=e.length;t<r;t+=1){const r=e[t];void 0!==r.willUnlink&&r.willUnlink(this)}}onUnlinkedResponse(t){const e=this.observers;for(let t=0,r=e.length;t<r;t+=1){const r=e[t];void 0!==r.didUnlink&&r.didUnlink(this)}}hostDidConnect(){const t=this.observers;for(let e=0,r=t.length;e<r;e+=1){const r=t[e];void 0!==r.didConnect&&r.didConnect(this)}}hostDidDisconnect(){const t=this.observers;for(let e=0,r=t.length;e<r;e+=1){const r=t[e];void 0!==r.didDisconnect&&r.didDisconnect(this)}}hostDidFail(t){const e=this.observers;for(let r=0,i=e.length;r<i;r+=1){const i=e[r];void 0!==i.didFail&&i.didFail(t,this)}}command(t){this.model.command(t)}close(){const t=this.owner;null!==t&&t.removeDownlink(this);const e=this.model;null!==e&&e.removeDownlink(this)}openUp(t){}closeUp(){const t=this.observers;for(let e=0,r=t.length;e<r;e+=1){const r=t[e];void 0!==r.didClose&&r.didClose(this)}}static initForm(){return new nl}}e([s],il,"initForm",null);class nl extends ki{mold(t){if(void 0!==t){const e=mr.create();return void 0!==t.hostUri&&e.slot("host",po.fromAny(t.hostUri).toString()),void 0!==t.nodeUri&&e.slot("node",po.fromAny(t.nodeUri).toString()),void 0!==t.laneUri&&e.slot("lane",po.fromAny(t.laneUri).toString()),void 0!==t.prio&&e.slot("prio",t.prio),void 0!==t.rate&&e.slot("rate",t.rate),void 0!==t.body&&e.slot("body",t.body),void 0!==t.type&&e.slot("type",t.type),mr.of(dr.of("link",e))}return ar.extant()}cast(t){const e=t.toValue().get("link");if(e.isDefined()){const t={},r=e.get("host");r.isDefined()&&(t.hostUri=r.cast(po.form()));const i=e.get("node");i.isDefined()&&(t.nodeUri=i.cast(po.form()));const n=e.get("lane");n.isDefined()&&(t.laneUri=n.cast(po.form()));const s=e.get("prio");s.isDefined()&&(t.prio=s.numberValue());const o=e.get("rate");o.isDefined()&&(t.rate=o.numberValue());const a=e.get("body");a.isDefined()&&(t.body=a);const u=e.get("type");return u.isDefined()&&(t.type=u.stringValue()),t}}}Object.defineProperty(nl.prototype,"tag",{get:()=>"link",configurable:!0});class sl extends el{constructor(t,e,r,i,n,s,o){super(t,e,r,i,n,s,o)}get type(){return"event"}}class ol extends il{constructor(t,e,r,i,n,s,o,a,u,h=1,l){super(t,e,r,i,n,s,o,a,u,h,l)}get type(){return"event"}copy(t,e,r,i,n,s,o,a,u,h){return new ol(t,e,void 0,r,i,n,s,o,a,u,h)}observe(t){return super.observe(t)}open(){const t=this.ownLaneUri;if(t.isEmpty())throw new Error("no lane");let e=this.ownNodeUri;if(e.isEmpty())throw new Error("no node");let r=this.ownHostUri;r.isEmpty()&&(r=e.endpoint(),e=r.unresolve(e));let i=this.context.getDownlink(r,e,t);if(void 0!==i){if(!(i instanceof sl))throw new Error("downlink type mismatch");i.addDownlink(this)}else i=new sl(this.context,r,e,t,this.ownPrio,this.ownRate,this.ownBody),i.addDownlink(this),this.context.openDownlink(i);return this.model=i,null!==this.owner&&this.owner.addDownlink(this),this}}class al extends el{constructor(t,e,r,i,n,s,o,a=new Ne){super(t,e,r,i,n,s,o),this.state=a}get type(){return"list"}get length(){return this.state.length}isEmpty(){return this.state.isEmpty()}get(t,e){return this.state.get(t,e)||yr.absent()}getEntry(t,e){return this.state.getEntry(t,e)}set(t,e,r){if(void 0!==r&&(t=this.state.lookup(r,t))<0)throw new RangeError(""+r);if(t<0||t>=this.state.length)throw new RangeError(""+t);e=this.listWillUpdate(t,e);const i=this.state.getEntry(t);this.state.set(t,e),this.listDidUpdate(t,e,i[1]);const n=mr.create(2).slot("key",i[0]).slot("index",t);return this.command(dr.of("update",n).concat(e)),this}insert(t,e,r){if(t<0||t>this.state.length)throw new RangeError(""+t);e=this.listWillUpdate(t,e),this.state.insert(t,e,r);const i=this.state.getEntry(t);this.listDidUpdate(t,e,yr.absent());const n=mr.create(2).slot("key",i[0]).slot("index",t);return this.command(dr.of("update",n).concat(e)),this}remove(t,e){if(void 0!==e&&(t=this.state.lookup(e,t))<0)throw new RangeError(""+e);if(t<0||t>this.state.length)throw new RangeError(""+t);this.listWillRemove(t);const r=this.state.getEntry(t);this.state.remove(t),this.listDidRemove(t,r[1]);const i=mr.create(2).slot("key",r[0]).slot("index",t);return this.command(mr.create(1).attr("remove",i)),this}push(...t){for(let e=0;e<t.length;e+=1){const r=this.state.length+e,i=this.listWillUpdate(r,t[e]);this.state.insert(r,i);const n=this.state.getEntry(r);this.listDidUpdate(r,i,yr.absent());const s=mr.create(2).slot("key",n[0]).slot("index",r);this.command(dr.of("update",s).concat(i))}return this.state.length}pop(){const t=this.state.length-1;if(t>=0){this.listWillRemove(t);const e=this.state.getEntry(t);this.state.remove(t),this.listDidRemove(t,e[1]);const r=mr.create(2).slot("key",e[0]).slot("index",t);return this.command(mr.create(1).attr("remove",r)),e[1]}return yr.absent()}unshift(...t){for(let e=t.length-1;e>=0;e-=1){const r=this.listWillUpdate(0,t[e]);this.state.insert(0,r);const i=this.state.getEntry(0);this.listDidUpdate(0,r,yr.absent());const n=mr.create(2).slot("key",i[0]).slot("index",0);this.command(dr.of("update",n).concat(r))}return this.state.length}shift(){if(this.state.length>0){this.listWillRemove(0);const t=this.state.getEntry(0);this.state.remove(0),this.listDidRemove(0,t[1]);const e=mr.create(2).slot("key",t[0]).slot("index",0);return this.command(mr.create(1).attr("remove",e)),t[1]}return yr.absent()}move(t,e,r){if(void 0!==r&&(t=this.state.lookup(r,t))<0)throw new RangeError(""+r);if(t<0||t>=this.state.length)throw new RangeError(""+t);if(e<0||e>=this.state.length)throw new RangeError(""+e);if(t!==e){const r=this.state.getEntry(t);this.listWillMove(t,e,r[1]),this.state.remove(t).insert(e,r[1],r[0]),this.listDidMove(t,e,r[1]);const i=mr.create(2).slot("key",r[0]).slot("from",t).slot("to",e);this.command(mr.create(1).attr("move",i))}return this}splice(t,e,...r){t<0&&(t=this.state.length+t),t=Math.min(Math.max(0,t),this.state.length),void 0===e&&(e=this.state.length-t);const i=[];for(let r=t,n=t+e;r<n;r+=1){this.listWillRemove(t);const e=this.state.getEntry(t);i.push(e[1]),this.state.remove(t),this.listDidRemove(t,e[1]);const r=mr.create(2).slot("key",e[0]).slot("index",t);this.command(mr.create(1).attr("remove",r))}for(let e=0;e<r.length;e+=1){const i=t+e,n=this.listWillUpdate(i,r[e]);this.state.insert(i,n);const s=this.state.getEntry(i);this.listDidUpdate(i,n,yr.absent());const o=mr.create(2).slot("key",s[0]).slot("index",i);this.command(dr.of("update",o).concat(n))}return i}clear(){this.listWillClear(),this.state.clear(),this.listDidClear(),this.command(mr.create(1).attr("clear"))}forEach(t,e){return this.state.forEach(t,e)}values(){return this.state.values()}keys(){return this.state.keys()}entries(){return this.state.entries()}snapshot(){return this.state.clone()}setState(t){this.state=t}onEventMessage(t,e){super.onEventMessage(t,e);const r=t.body,i=r.tag;if("update"===i){const t=r.head().toValue(),e=this.state.lookup(t.get("key"),t.get("index").numberValue());e>=0?this.onUpdateEvent(e,r.body(),t.get("key")):this.onInsertEvent(t.get("index").numberValue(0),r.body(),t.get("key"))}else if("move"===i){const t=r.head().toValue(),e=this.state.lookup(t.get("key"),t.get("from").numberValue());e>=0&&this.onMoveEvent(e,t.get("to").numberValue(0),t.get("key"))}else if("remove"===i){const t=r.head().toValue(),e=this.state.lookup(t.get("key"),t.get("index").numberValue());e>=0&&this.onRemoveEvent(e,t.get("key"))}else if("drop"===i){const t=r.head();this.onDropEvent(t.numberValue(0))}else if("take"===i){const t=r.head();this.onTakeEvent(t.numberValue(0))}else"clear"===i&&this.onClearEvent()}onInsertEvent(t,e,r){e=this.listWillUpdate(t,e),this.state.insert(t,e,r),this.listDidUpdate(t,e,yr.absent())}onUpdateEvent(t,e,r){e=this.listWillUpdate(t,e);const i=this.state.get(t)||yr.absent();this.state.set(t,e),this.listDidUpdate(t,e,i)}onMoveEvent(t,e,r){if(t!==(e=Math.min(Math.max(0,e),this.state.length))){const i=this.state.get(t)||yr.absent();this.listWillMove(t,e,i),this.state.remove(t).insert(e,i,r),this.listDidMove(t,e,i)}}onRemoveEvent(t,e){this.listWillRemove(t);const r=this.state.get(t)||yr.absent();this.state.remove(t),this.listDidRemove(t,r)}onDropEvent(t){this.listWillDrop(t),this.state.drop(t),this.listDidDrop(t)}onTakeEvent(t){this.listWillTake(t),this.state.take(t),this.listDidTake(t)}onClearEvent(){this.listWillClear(),this.state.clear(),this.listDidClear()}listWillUpdate(t,e){const r=this.views;for(let i=0,n=r.length;i<n;i+=1)e=r[i].listWillUpdate(t,e);return e}listDidUpdate(t,e,r){const i=this.views;for(let n=0,s=i.length;n<s;n+=1)i[n].listDidUpdate(t,e,r)}listWillMove(t,e,r){const i=this.views;for(let n=0,s=i.length;n<s;n+=1)i[n].listWillMove(t,e,r)}listDidMove(t,e,r){const i=this.views;for(let n=0,s=i.length;n<s;n+=1)i[n].listDidMove(t,e,r)}listWillRemove(t){const e=this.views;for(let r=0,i=e.length;r<i;r+=1)e[r].listWillRemove(t)}listDidRemove(t,e){const r=this.views;for(let i=0,n=r.length;i<n;i+=1)r[i].listDidRemove(t,e)}listWillDrop(t){const e=this.views;for(let r=0,i=e.length;r<i;r+=1)e[r].listWillDrop(t)}listDidDrop(t){const e=this.views;for(let r=0,i=e.length;r<i;r+=1)e[r].listDidDrop(t)}listWillTake(t){const e=this.views;for(let r=0,i=e.length;r<i;r+=1)e[r].listWillTake(t)}listDidTake(t){const e=this.views;for(let r=0,i=e.length;r<i;r+=1)e[r].listDidTake(t)}listWillClear(){const t=this.views;for(let e=0,r=t.length;e<r;e+=1)t[e].listWillClear()}listDidClear(){const t=this.views;for(let e=0,r=t.length;e<r;e+=1)t[e].listDidClear()}}class ul extends il{constructor(t,e,r,i,n,s,o,a,u,h=3,l,c,d=null){var p,f,y,m,w,g,v,b,x,C,O,S;if(super(t,e,r,i,n,s,o,a,u,h,l),void 0!==r){const t=this.observers[this.observers.length-1];t.willUpdate=null!==(p=r.willUpdate)&&void 0!==p?p:t.willUpdate,t.didUpdate=null!==(f=r.didUpdate)&&void 0!==f?f:t.didUpdate,t.willMove=null!==(y=r.willMove)&&void 0!==y?y:t.willMove,t.didMove=null!==(m=r.didMove)&&void 0!==m?m:t.didMove,t.willRemove=null!==(w=r.willRemove)&&void 0!==w?w:t.willRemove,t.didRemove=null!==(g=r.didRemove)&&void 0!==g?g:t.didRemove,t.willDrop=null!==(v=r.willDrop)&&void 0!==v?v:t.willDrop,t.didDrop=null!==(b=r.didDrop)&&void 0!==b?b:t.didDrop,t.willTake=null!==(x=r.willTake)&&void 0!==x?x:t.willTake,t.didTake=null!==(C=r.didTake)&&void 0!==C?C:t.didTake,t.willClear=null!==(O=r.willClear)&&void 0!==O?O:t.willClear,t.didClear=null!==(S=r.didClear)&&void 0!==S?S:t.didClear,c=void 0!==r.valueForm?r.valueForm:c}this.ownValueForm=void 0!==c?c:ki.forValue(),this.state0=d}get type(){return"list"}copy(t,e,r,i,n,s,o,a,u,h,l,c){return 10===arguments.length&&(l=this.ownValueForm,c=this.state0),new ul(t,e,void 0,r,i,n,s,o,a,u,h,l,c)}valueForm(t){return void 0===t?this.ownValueForm:this.copy(this.context,this.owner,this.ownHostUri,this.ownNodeUri,this.ownLaneUri,this.ownPrio,this.ownRate,this.ownBody,this.flags,this.observers,t,this.state0)}get length(){return this.model.length}isEmpty(){return this.model.isEmpty()}get(t,e){return this.model.get(t,e).coerce(this.ownValueForm)}getEntry(t,e){const r=this.model.getEntry(t,e);if(void 0!==r)return[r[0].coerce(this.ownValueForm),r[1]]}set(t,e,r){const i=this.ownValueForm.mold(e);return this.model.set(t,i,r),this}insert(t,e,r){const i=this.ownValueForm.mold(e);return this.model.insert(t,i,r),this}remove(t,e){return this.model.remove(t,e),this}push(...t){const e=new Array(t.length);for(let r=0;r<t.length;r+=1)e[r]=this.ownValueForm.mold(t[r]);return this.model.push.apply(this.model,e)}pop(){return this.model.pop().coerce(this.ownValueForm)}unshift(...t){const e=new Array(t.length);for(let r=0;r<t.length;r+=1)e[r]=this.ownValueForm.mold(t[r]);return this.model.unshift.apply(this.model,e)}shift(){return this.model.shift().coerce(this.ownValueForm)}move(t,e,r){return this.model.move(t,e,r),this}splice(t,e,...r){const i=new Array(r.length);for(let t=0;t<r.length;t+=1)i[t]=this.ownValueForm.mold(r[t]);const n=this.model.splice(t,e,...i),s=new Array(n.length);for(let t=0;t<n.length;t+=1)s[t]=n[t].coerce(this.ownValueForm);return s}clear(){this.model.clear()}forEach(t,e){return this.ownValueForm===ki.forValue()?this.model.state.forEach(t,e):this.model.state.forEach((function(r,i,n){const s=r.coerce(this.ownValueForm);return t.call(e,s,i,n)}),this)}values(){const t=this.model.values();return this.ownValueForm===ki.forValue()?t:new qi(t,this.ownValueForm)}keys(){return this.model.keys()}entries(){const t=this.model.entries();return this.ownValueForm===ki.forValue()?t:new Ui(t,ki.forValue(),this.ownValueForm)}snapshot(){return this.model.snapshot()}setState(t){this.model.setState(t)}observe(t){return super.observe(t)}willUpdate(t){return this.observe({willUpdate:t})}didUpdate(t){return this.observe({didUpdate:t})}willMove(t){return this.observe({willMove:t})}didMove(t){return this.observe({didMove:t})}willRemove(t){return this.observe({willRemove:t})}didRemove(t){return this.observe({didRemove:t})}willDrop(t){return this.observe({willDrop:t})}didDrop(t){return this.observe({didDrop:t})}willTake(t){return this.observe({willTake:t})}didTake(t){return this.observe({didTake:t})}willClear(t){return this.observe({willClear:t})}didClear(t){return this.observe({didClear:t})}listWillUpdate(t,e){let r;const i=this.observers;for(let n=0,s=i.length;n<s;n+=1){const s=i[n];if(void 0!==s.willUpdate){void 0===r&&(r=e.coerce(this.ownValueForm));const i=s.willUpdate(t,r,this);void 0!==i&&(r=i,e=this.ownValueForm.mold(r))}}return e}listDidUpdate(t,e,r){let i,n;const s=this.observers;for(let o=0,a=s.length;o<a;o+=1){const a=s[o];void 0!==a.didUpdate&&(void 0===i&&(i=e.coerce(this.ownValueForm)),void 0===n&&(n=r.coerce(this.ownValueForm)),a.didUpdate(t,i,n,this))}}listWillMove(t,e,r){let i;const n=this.observers;for(let s=0,o=n.length;s<o;s+=1){const o=n[s];void 0!==o.willMove&&(void 0===i&&(i=r.coerce(this.ownValueForm)),o.willMove(t,e,i,this))}}listDidMove(t,e,r){let i;const n=this.observers;for(let s=0,o=n.length;s<o;s+=1){const o=n[s];void 0!==o.didMove&&(void 0===i&&(i=r.coerce(this.ownValueForm)),o.didMove(t,e,i,this))}}listWillRemove(t){const e=this.observers;for(let r=0,i=e.length;r<i;r+=1){const i=e[r];void 0!==i.willRemove&&i.willRemove(t,this)}}listDidRemove(t,e){let r;const i=this.observers;for(let n=0,s=i.length;n<s;n+=1){const s=i[n];void 0!==s.didRemove&&(void 0===r&&(r=e.coerce(this.ownValueForm)),s.didRemove(t,r,this))}}listWillDrop(t){const e=this.observers;for(let r=0,i=e.length;r<i;r+=1){const i=e[r];void 0!==i.willDrop&&i.willDrop(t,this)}}listDidDrop(t){const e=this.observers;for(let r=0,i=e.length;r<i;r+=1){const i=e[r];void 0!==i.didDrop&&i.didDrop(t,this)}}listWillTake(t){const e=this.observers;for(let r=0,i=e.length;r<i;r+=1){const i=e[r];void 0!==i.willTake&&i.willTake(t,this)}}listDidTake(t){const e=this.observers;for(let r=0,i=e.length;r<i;r+=1){const i=e[r];void 0!==i.didTake&&i.didTake(t,this)}}listWillClear(){const t=this.observers;for(let e=0,r=t.length;e<r;e+=1){const r=t[e];void 0!==r.willClear&&r.willClear(this)}}listDidClear(){const t=this.observers;for(let e=0,r=t.length;e<r;e+=1){const r=t[e];void 0!==r.didClear&&r.didClear(this)}}initialState(t){return void 0===t?this.state0:this.copy(this.context,this.owner,this.ownHostUri,this.ownNodeUri,this.ownLaneUri,this.ownPrio,this.ownRate,this.ownBody,this.flags,this.observers,this.ownValueForm,t)}didAliasModel(){this.onLinkedResponse(),this.model.state.forEach((function(t,e){this.listDidUpdate(e,t,yr.absent())}),this),this.onSyncedResponse()}open(){var t;const e=this.ownLaneUri;if(e.isEmpty())throw new Error("no lane");let r=this.ownNodeUri;if(r.isEmpty())throw new Error("no node");let i=this.ownHostUri;i.isEmpty()&&(i=r.endpoint(),r=i.unresolve(r));let n=this.context.getDownlink(i,r,e);if(void 0!==n){if(!(n instanceof al))throw new Error("downlink type mismatch");n.addDownlink(this),this.model=n,setTimeout(this.didAliasModel.bind(this))}else n=new al(this.context,i,r,e,this.ownPrio,this.ownRate,this.ownBody,null!==(t=this.state0)&&void 0!==t?t:void 0),n.addDownlink(this),this.context.openDownlink(n),this.model=n;return null!==this.owner&&this.owner.addDownlink(this),this}}class hl extends el{constructor(t,e,r,i,n,s,o,a=new Te){super(t,e,r,i,n,s,o),this.state=a}get type(){return"map"}get size(){return this.state.size}isEmpty(){return this.state.isEmpty()}has(t){return this.state.has(t)}get(t){var e;return null!==(e=this.state.get(t))&&void 0!==e?e:yr.absent()}getEntry(t){return this.state.getEntry(t)}set(t,e){var r;e=this.mapWillUpdate(t,e);const i=null!==(r=this.state.get(t))&&void 0!==r?r:yr.absent();this.state.set(t,e),this.mapDidUpdate(t,e,i);const n=mr.create(1).slot("key",t);return this.command(dr.of("update",n).concat(e)),this}delete(t){var e;if(this.state.has(t)){this.mapWillRemove(t);const r=null!==(e=this.state.get(t))&&void 0!==e?e:yr.absent();this.state.delete(t),this.mapDidRemove(t,r);const i=mr.create(1).slot("key",t);return this.command(mr.create(1).attr("remove",i)),!0}return!1}drop(t){return this.mapWillDrop(t),this.state.drop(t),this.mapDidDrop(t),this.command(mr.create(1).attr("drop",t)),this}take(t){return this.mapWillTake(t),this.state.take(t),this.mapDidTake(t),this.command(mr.create(1).attr("take",t)),this}clear(){this.mapWillClear(),this.state.clear(),this.mapDidClear(),this.command(mr.create(1).attr("clear"))}forEach(t,e){return this.state.forEach(t,e)}keys(){return this.state.keys()}values(){return this.state.values()}entries(){return this.state.entries()}snapshot(){return this.state.clone()}setState(t){this.state=t}onEventMessage(t,e){super.onEventMessage(t,e);const r=t.body,i=r.tag;if("update"===i){const t=r.head().toValue();this.onUpdateEvent(t.get("key"),r.body())}else if("remove"===i){const t=r.head().toValue();this.onRemoveEvent(t.get("key"))}else if("drop"===i){const t=r.head().toValue();this.onDropEvent(t.numberValue(0))}else if("take"===i){const t=r.head().toValue();this.onTakeEvent(t.numberValue(0))}else"clear"===i&&this.onClearEvent()}onUpdateEvent(t,e){var r;e=this.mapWillUpdate(t,e);const i=null!==(r=this.state.get(t))&&void 0!==r?r:yr.absent();this.state.set(t,e),this.mapDidUpdate(t,e,i)}onRemoveEvent(t){var e;this.mapWillRemove(t);const r=null!==(e=this.state.get(t))&&void 0!==e?e:yr.absent();this.state.delete(t),this.mapDidRemove(t,r)}onDropEvent(t){this.mapWillDrop(t),this.state.drop(t),this.mapDidDrop(t)}onTakeEvent(t){this.mapWillTake(t),this.state.take(t),this.mapDidTake(t)}onClearEvent(){this.mapWillClear(),this.state.clear(),this.mapDidClear()}mapWillUpdate(t,e){const r=this.views;for(let i=0,n=r.length;i<n;i+=1)e=r[i].mapWillUpdate(t,e);return e}mapDidUpdate(t,e,r){const i=this.views;for(let n=0,s=i.length;n<s;n+=1)i[n].mapDidUpdate(t,e,r)}mapWillRemove(t){const e=this.views;for(let r=0,i=e.length;r<i;r+=1)e[r].mapWillRemove(t)}mapDidRemove(t,e){const r=this.views;for(let i=0,n=r.length;i<n;i+=1)r[i].mapDidRemove(t,e)}mapWillDrop(t){const e=this.views;for(let r=0,i=e.length;r<i;r+=1)e[r].mapWillDrop(t)}mapDidDrop(t){const e=this.views;for(let r=0,i=e.length;r<i;r+=1)e[r].mapDidDrop(t)}mapWillTake(t){const e=this.views;for(let r=0,i=e.length;r<i;r+=1)e[r].mapWillTake(t)}mapDidTake(t){const e=this.views;for(let r=0,i=e.length;r<i;r+=1)e[r].mapDidTake(t)}mapWillClear(){const t=this.views;for(let e=0,r=t.length;e<r;e+=1)t[e].mapWillClear()}mapDidClear(){const t=this.views;for(let e=0,r=t.length;e<r;e+=1)t[e].mapDidClear()}}class ll extends il{constructor(t,e,r,i,n,s,o,a,u,h=3,l,c,d,p=null){var f,y,m,w,g,b,x,C,O,S;if(super(t,e,r,i,n,s,o,a,u,h,l),void 0!==r){const t=this.observers[this.observers.length-1];t.willUpdate=null!==(f=r.willUpdate)&&void 0!==f?f:t.willUpdate,t.didUpdate=null!==(y=r.didUpdate)&&void 0!==y?y:t.didUpdate,t.willRemove=null!==(m=r.willRemove)&&void 0!==m?m:t.willRemove,t.didRemove=null!==(w=r.didRemove)&&void 0!==w?w:t.didRemove,t.willDrop=null!==(g=r.willDrop)&&void 0!==g?g:t.willDrop,t.didDrop=null!==(b=r.didDrop)&&void 0!==b?b:t.didDrop,t.willTake=null!==(x=r.willTake)&&void 0!==x?x:t.willTake,t.didTake=null!==(C=r.didTake)&&void 0!==C?C:t.didTake,t.willClear=null!==(O=r.willClear)&&void 0!==O?O:t.willClear,t.didClear=null!==(S=r.didClear)&&void 0!==S?S:t.didClear,c=void 0!==r.keyForm?r.keyForm:c,d=void 0!==r.valueForm?r.valueForm:d}this.ownKeyForm=void 0!==c?c:ki.forValue(),this.ownValueForm=void 0!==d?d:ki.forValue(),this.state0=p,this.input=null,this.effects=new Te,this.outlets=new Te,this.outputs=v.empty,this.version=-1}get type(){return"map"}copy(t,e,r,i,n,s,o,a,u,h,l,c,d){return 10===arguments.length&&(d=this.state0,l=this.ownKeyForm,c=this.ownValueForm),new ll(t,e,void 0,r,i,n,s,o,a,u,h,l,c,d)}keyForm(t){return void 0===t?this.ownKeyForm:this.copy(this.context,this.owner,this.ownHostUri,this.ownNodeUri,this.ownLaneUri,this.ownPrio,this.ownRate,this.ownBody,this.flags,this.observers,t,this.ownValueForm,this.state0)}valueForm(t){return void 0===t?this.ownValueForm:this.copy(this.context,this.owner,this.ownHostUri,this.ownNodeUri,this.ownLaneUri,this.ownPrio,this.ownRate,this.ownBody,this.flags,this.observers,this.ownKeyForm,t,this.state0)}get size(){return this.model.size}isEmpty(){return this.model.isEmpty()}has(t){const e=this.ownKeyForm.mold(t);return this.model.has(e)}get(t){if(void 0===t)return this;{const e=this.ownKeyForm.mold(t);return this.model.get(e).coerce(this.ownValueForm)}}getEntry(t){const e=this.model.getEntry(t);if(void 0!==e)return[e[0].coerce(this.ownKeyForm),e[1].coerce(this.ownValueForm)]}firstKey(){const t=this.model.state.firstKey();if(void 0!==t){const e=this.ownKeyForm.cast(t);if(void 0!==e)return e}return this.ownKeyForm.unit}firstValue(){const t=this.model.state.firstValue();if(void 0!==t){const e=this.ownValueForm.cast(t);if(void 0!==e)return e}return this.ownValueForm.unit}firstEntry(){const t=this.model.state.firstEntry();if(void 0!==t){return[this.ownKeyForm.cast(t[0]),this.ownValueForm.cast(t[1])]}}lastKey(){const t=this.model.state.lastKey();if(void 0!==t){const e=this.ownKeyForm.cast(t);if(void 0!==e)return e}return this.ownKeyForm.unit}lastValue(){const t=this.model.state.lastValue();if(void 0!==t){const e=this.ownValueForm.cast(t);if(void 0!==e)return e}return this.ownValueForm.unit}lastEntry(){const t=this.model.state.lastEntry();if(void 0!==t){return[this.ownKeyForm.cast(t[0]),this.ownValueForm.cast(t[1])]}}nextKey(t){const e=this.ownKeyForm.mold(t),r=this.model.state.nextKey(e);if(void 0!==r){const t=this.ownKeyForm.cast(r);if(void 0!==t)return t}return this.ownKeyForm.unit}nextValue(t){const e=this.ownKeyForm.mold(t),r=this.model.state.nextValue(e);if(void 0!==r){const t=this.ownValueForm.cast(r);if(void 0!==t)return t}return this.ownValueForm.unit}nextEntry(t){const e=this.ownKeyForm.mold(t),r=this.model.state.nextEntry(e);if(void 0!==r){return[this.ownKeyForm.cast(r[0]),this.ownValueForm.cast(r[1])]}}previousKey(t){const e=this.ownKeyForm.mold(t),r=this.model.state.previousKey(e);if(void 0!==r){const t=this.ownKeyForm.cast(r);if(void 0!==t)return t}return this.ownKeyForm.unit}previousValue(t){const e=this.ownKeyForm.mold(t),r=this.model.state.previousValue(e);if(void 0!==r){const t=this.ownValueForm.cast(r);if(void 0!==t)return t}return this.ownValueForm.unit}previousEntry(t){const e=this.ownKeyForm.mold(t),r=this.model.state.previousEntry(e);if(void 0!==r){return[this.ownKeyForm.cast(r[0]),this.ownValueForm.cast(r[1])]}}set(t,e){const r=this.ownKeyForm.mold(t),i=this.ownValueForm.mold(e);return this.model.set(r,i),this}delete(t){const e=this.ownKeyForm.mold(t);return this.model.delete(e)}drop(t){return this.model.drop(t),this}take(t){return this.model.take(t),this}clear(){this.model.clear()}forEach(t,e){return this.ownKeyForm===ki.forValue()&&this.ownValueForm===ki.forValue()?this.model.state.forEach(t,e):this.model.state.forEach((function(r,i){const n=r.coerce(this.ownKeyForm),s=i.coerce(this.ownValueForm);return t.call(e,n,s)}),this)}keys(){const t=this.model.keys();return this.ownKeyForm===ki.forValue()?t:new qi(t,this.ownKeyForm)}values(){const t=this.model.values();return this.ownValueForm===ki.forValue()?t:new qi(t,this.ownValueForm)}entries(){const t=this.model.entries();return this.ownKeyForm===ki.forValue()&&this.ownValueForm===ki.forValue()?t:new Ui(t,this.ownKeyForm,this.ownValueForm)}snapshot(){return this.model.snapshot()}setState(t){this.model.setState(t)}observe(t){return super.observe(t)}willUpdate(t){return this.observe({willUpdate:t})}didUpdate(t){return this.observe({didUpdate:t})}willRemove(t){return this.observe({willRemove:t})}didRemove(t){return this.observe({didRemove:t})}willDrop(t){return this.observe({willDrop:t})}didDrop(t){return this.observe({didDrop:t})}willTake(t){return this.observe({willTake:t})}didTake(t){return this.observe({didTake:t})}willClear(t){return this.observe({willClear:t})}didClear(t){return this.observe({didClear:t})}mapWillUpdate(t,e){let r,i;const n=this.observers;for(let s=0,o=n.length;s<o;s+=1){const o=n[s];if(void 0!==o.willUpdate){void 0===r&&(r=t.coerce(this.ownKeyForm)),void 0===i&&(i=e.coerce(this.ownValueForm));const n=o.willUpdate(r,i,this);void 0!==n&&(i=n,e=this.ownValueForm.mold(i))}}return e}mapDidUpdate(t,e,r){const i=t.coerce(this.ownKeyForm);let n,s;const o=this.observers;for(let t=0,a=o.length;t<a;t+=1){const a=o[t];void 0!==a.didUpdate&&(void 0===n&&(n=e.coerce(this.ownValueForm)),void 0===s&&(s=r.coerce(this.ownValueForm)),a.didUpdate(i,n,s,this))}this.decohereInputKey(i,0),this.recohereInput(0)}mapWillRemove(t){let e;const r=this.observers;for(let i=0,n=r.length;i<n;i+=1){const n=r[i];void 0!==n.willRemove&&(void 0===e&&(e=t.coerce(this.ownKeyForm)),n.willRemove(e,this))}}mapDidRemove(t,e){const r=t.coerce(this.ownKeyForm);let i;const n=this.observers;for(let t=0,s=n.length;t<s;t+=1){const s=n[t];void 0!==s.didRemove&&(void 0===i&&(i=e.coerce(this.ownValueForm)),s.didRemove(r,i,this))}this.decohereInputKey(r,1),this.recohereInput(0)}mapWillDrop(t){const e=this.observers;for(let r=0,i=e.length;r<i;r+=1){const i=e[r];void 0!==i.willDrop&&i.willDrop(t,this)}}mapDidDrop(t){const e=this.observers;for(let r=0,i=e.length;r<i;r+=1){const i=e[r];void 0!==i.didDrop&&i.didDrop(t,this)}}mapWillTake(t){const e=this.observers;for(let r=0,i=e.length;r<i;r+=1){const i=e[r];void 0!==i.willTake&&i.willTake(t,this)}}mapDidTake(t){const e=this.observers;for(let r=0,i=e.length;r<i;r+=1){const i=e[r];void 0!==i.didTake&&i.didTake(t,this)}}mapWillClear(){const t=this.observers;for(let e=0,r=t.length;e<r;e+=1){const r=t[e];void 0!==r.willClear&&r.willClear(this)}}mapDidClear(){const t=this.observers;for(let e=0,r=t.length;e<r;e+=1){const r=t[e];void 0!==r.didClear&&r.didClear(this)}}initialState(t){return void 0===t?this.state0:this.copy(this.context,this.owner,this.ownHostUri,this.ownNodeUri,this.ownLaneUri,this.ownPrio,this.ownRate,this.ownBody,this.flags,this.observers,this.ownKeyForm,this.ownValueForm,t)}didAliasModel(){this.onLinkedResponse(),this.model.state.forEach((function(t,e){this.mapDidUpdate(t,e,yr.absent())}),this),this.onSyncedResponse()}open(){var t;const e=this.ownLaneUri;if(e.isEmpty())throw new Error("no lane");let r=this.ownNodeUri;if(r.isEmpty())throw new Error("no node");let i=this.ownHostUri;i.isEmpty()&&(i=r.endpoint(),r=i.unresolve(r));let n=this.context.getDownlink(i,r,e);if(void 0!==n){if(!(n instanceof hl))throw new Error("downlink type mismatch");n.addDownlink(this),this.model=n,setTimeout(this.didAliasModel.bind(this))}else n=new hl(this.context,i,r,e,this.ownPrio,this.ownRate,this.ownBody,null!==(t=this.state0)&&void 0!==t?t:void 0),n.addDownlink(this),this.context.openDownlink(n),this.model=n;return null!==this.owner&&this.owner.addDownlink(this),this}keyIterator(){return this.keys()}bindInput(t){if(!Ki.is(t))throw new TypeError(""+t);const e=this.input;e!==t&&(null!==e&&e.unbindOutput(this),this.input=t,null!==t&&t.bindOutput(this))}unbindInput(){const t=this.input;null!==t&&(t.unbindOutput(this),this.input=null)}disconnectInputs(){const t=this.input;null!==t&&(t.unbindOutput(this),this.input=null,t.disconnectInputs())}outlet(t){const e=this.outlets;let r=e.get(t);return void 0===r&&(r=new Qi(this,t),this.outlets=e.updated(t,r)),r}outputIterator(){return _.array(this.outputs)}bindOutput(t){this.outputs=v.inserted(t,this.outputs)}unbindOutput(t){this.outputs=v.removed(t,this.outputs)}unbindOutputs(){const t=this.outlets;t.isEmpty()&&(this.outlets=new Te,t.forEach((function(t,e){e.unbindOutputs()}),this));const e=this.outputs;this.outputs=v.empty;for(let t=0,r=e.length;t<r;t+=1){e[t].unbindInput()}}disconnectOutputs(){const t=this.outlets;t.isEmpty()&&(this.outlets=new Te,t.forEach((function(t,e){e.disconnectOutputs()}),this));const e=this.outputs;this.outputs=v.empty;for(let t=0,r=e.length;t<r;t+=1){const r=e[t];r.unbindInput(),r.disconnectOutputs()}}decohereOutputKey(t,e){this.decohereKey(t,e)}decohereInputKey(t,e){this.decohereKey(t,e)}decohereKey(t,e){const r=this.effects;if(r.get(t)!==e){this.willDecohereKey(t,e),this.effects=r.updated(t,e),this.version=-1,this.onDecohereKey(t,e);const i=this.outputs;for(let r=0,n=i.length;r<n;r+=1){const n=i[r];Li.is(n)?n.decohereOutputKey(t,e):n.decohereOutput()}const n=this.outlets.get(t);void 0!==n&&n.decohereInput(),this.didDecohereKey(t,e)}}decohereOutput(){this.decohere()}decohereInput(){this.decohere()}decohere(){if(this.version>=0){this.willDecohere(),this.version=-1,this.onDecohere();const t=this.outputs;for(let e=0,r=t.length;e<r;e+=1){t[e].decohereOutput()}this.outlets.forEach((function(t,e){e.decohereInput()}),this),this.didDecohere()}}recohereOutputKey(t,e){this.recohereKey(t,e)}recohereInputKey(t,e){this.recohereKey(t,e)}recohereKey(t,e){if(this.version<0){const r=this.effects,i=r.get(t);if(void 0!==i){this.willRecohereKey(t,i,e),this.effects=r.removed(t),null!==this.input&&this.input.recohereInputKey(t,e),this.onRecohereKey(t,i,e);const n=this.outputs;for(let r=0,i=n.length;r<i;r+=1){const i=n[r];Li.is(i)&&i.recohereOutputKey(t,e)}const s=this.outlets.get(t);void 0!==s&&s.recohereInput(e),this.didRecohereKey(t,i,e)}}}recohereOutput(t){this.recohere(t)}recohereInput(t){this.recohere(t)}recohere(t){if(this.version<0){this.willRecohere(t),this.effects.forEach((function(e){this.recohereKey(e,t)}),this),this.version=t,this.onRecohere(t);const e=this.outputs;for(let r=0,i=e.length;r<i;r+=1){e[r].recohereOutput(t)}this.didRecohere(t)}}willDecohereKey(t,e){}onDecohereKey(t,e){}didDecohereKey(t,e){}willDecohere(){}onDecohere(){}didDecohere(){}willRecohereKey(t,e,r){}onRecohereKey(t,e,r){if(0===e){const e=this.input;if(null!==e){const r=e.get(t);void 0!==r?this.set(t,r):this.delete(t)}}else 1===e&&this.delete(t)}didRecohereKey(t,e,r){}willRecohere(t){}onRecohere(t){}didRecohere(t){}}Bi.define(ll.prototype);class cl extends el{constructor(t,e,r,i,n,s,o,a=yr.absent()){super(t,e,r,i,n,s,o),this.state=a}get type(){return"value"}get(){return this.state}set(t){t=this.valueWillSet(t);const e=this.state;this.setState(t),this.valueDidSet(t,e),this.command(t)}setState(t){this.state=t}onEventMessage(t,e){super.onEventMessage(t,e),this.onSetEvent(t.body)}onSetEvent(t){t=this.valueWillSet(t);const e=this.state;this.setState(t),this.valueDidSet(t,e)}valueWillSet(t){const e=this.views;for(let r=0,i=e.length;r<i;r+=1)t=e[r].valueWillSet(t);return t}valueDidSet(t,e){const r=this.views;for(let i=0,n=r.length;i<n;i+=1)r[i].valueDidSet(t,e)}}class dl extends il{constructor(t,e,r,i,n,s,o,a,u,h=3,l,c,d=yr.absent()){var p,f;if(super(t,e,r,i,n,s,o,a,u,h,l),void 0!==r){const t=this.observers[this.observers.length-1];t.willSet=null!==(p=r.willSet)&&void 0!==p?p:t.willSet,t.didSet=null!==(f=r.didSet)&&void 0!==f?f:t.didSet,c=void 0!==r.valueForm?r.valueForm:c}this.ownValueForm=void 0!==c?c:ki.forValue(),this.state0=d,this.input=null,this.outputs=v.empty,this.version=-1}get type(){return"value"}copy(t,e,r,i,n,s,o,a,u,h,l,c){return 10===arguments.length&&(c=this.state0,l=this.ownValueForm),new dl(t,e,void 0,r,i,n,s,o,a,u,h,l,c)}valueForm(t){return void 0===t?this.ownValueForm:this.copy(this.context,this.owner,this.ownHostUri,this.ownNodeUri,this.ownLaneUri,this.ownPrio,this.ownRate,this.ownBody,this.flags,this.observers,t,this.state0)}get(){return this.model.get().coerce(this.ownValueForm)}set(t){const e=this.ownValueForm.mold(t);this.model.set(e)}setState(t){this.model.setState(t)}observe(t){return super.observe(t)}willSet(t){return this.observe({willSet:t})}didSet(t){return this.observe({didSet:t})}valueWillSet(t){let e;const r=this.observers;for(let i=0,n=r.length;i<n;i+=1){const n=r[i];if(void 0!==n.willSet){void 0===e&&(e=t.coerce(this.ownValueForm));const r=n.willSet(e,this);void 0!==r&&(e=r,t=this.ownValueForm.mold(e))}}return t}valueDidSet(t,e){let r,i;const n=this.observers;for(let s=0,o=n.length;s<o;s+=1){const o=n[s];void 0!==o.didSet&&(void 0===r&&(r=t.coerce(this.ownValueForm)),void 0===i&&(i=e.coerce(this.ownValueForm)),o.didSet(r,i,this))}this.decohere(),this.recohere(0)}initialState(t){return void 0===t?this.state0:this.copy(this.context,this.owner,this.ownHostUri,this.ownNodeUri,this.ownLaneUri,this.ownPrio,this.ownRate,this.ownBody,this.flags,this.observers,this.ownValueForm,t)}didAliasModel(){this.onLinkedResponse(),this.valueDidSet(this.model.get(),yr.absent()),this.onSyncedResponse()}open(){const t=this.ownLaneUri;if(t.isEmpty())throw new Error("no lane");let e=this.ownNodeUri;if(e.isEmpty())throw new Error("no node");let r=this.ownHostUri;r.isEmpty()&&(r=e.endpoint(),e=r.unresolve(e));let i=this.context.getDownlink(r,e,t);if(void 0!==i){if(!(i instanceof cl))throw new Error("downlink type mismatch");i.addDownlink(this),this.model=i,setTimeout(this.didAliasModel.bind(this))}else i=new cl(this.context,r,e,t,this.ownPrio,this.ownRate,this.ownBody,this.state0),i.addDownlink(this),this.context.openDownlink(i),this.model=i;return null!==this.owner&&this.owner.addDownlink(this),this}bindInput(t){const e=this.input;e!==t&&(null!==e&&e.unbindOutput(this),this.input=t,null!==t&&t.bindOutput(this))}unbindInput(){const t=this.input;null!==t&&(t.unbindOutput(this),this.input=null)}disconnectInputs(){const t=this.input;null!==t&&(t.unbindOutput(this),this.input=null,t.disconnectInputs())}outputIterator(){return _.array(this.outputs)}bindOutput(t){this.outputs=v.inserted(t,this.outputs)}unbindOutput(t){this.outputs=v.removed(t,this.outputs)}unbindOutputs(){const t=this.outputs;this.outputs=v.empty;for(let e=0,r=t.length;e<r;e+=1){t[e].unbindInput()}}disconnectOutputs(){const t=this.outputs;this.outputs=v.empty;for(let e=0,r=t.length;e<r;e+=1){const r=t[e];r.unbindInput(),r.disconnectOutputs()}}decohereOutput(){this.decohere()}decohereInput(){this.decohere()}decohere(){if(this.version>=0){this.willDecohere(),this.version=-1,this.onDecohere();const t=this.outputs;for(let e=0,r=t.length;e<r;e+=1)t[e].decohereOutput();this.didDecohere()}}recohereOutput(t){this.recohere(t)}recohereInput(t){this.recohere(t)}recohere(t){if(this.version<0){this.willRecohere(t),this.version=t,null!==this.input&&this.input.recohereInput(t),this.onRecohere(t);const e=this.outputs;for(let r=0,i=e.length;r<i;r+=1)e[r].recohereOutput(t);this.didRecohere(t)}}willDecohere(){}onDecohere(){}didDecohere(){}willRecohere(t){}onRecohere(t){const e=this.input;if(null!==e){const t=e.get();void 0!==t&&this.set(t)}}didRecohere(t){}}zi.define(dl.prototype);class pl extends In{}class fl extends pl{constructor(t){super(),this.downlink=t,t.observe(this)}isEmpty(){return this.downlink.isEmpty()}isArray(){return this.downlink.isEmpty()}isObject(){return!0}get length(){return this.downlink.size}has(t){return this.downlink.has(t)}get(t){return void 0===t?this:this.downlink.get(t)}getAttr(t){return yr.absent()}getSlot(t){return this.get(t)}getItem(t){t instanceof kr&&(t=t.value);const e=this.downlink.size;if(t<0&&(t=e+t),(t=Math.min(Math.max(0,t),e-1))>=0){const e=this.downlink.getEntry(t);return lr.of(e[0],e[1])}return ar.absent()}set(t,e){return this.downlink.set(t,e),this}setAttr(t,e){throw new Error("unsupported")}setSlot(t,e){return this.set(t,e)}setItem(t,e){throw new Error("unsupported")}push(...t){throw new Error("unsupported")}splice(t,e,...r){throw new Error("unsupported")}delete(t){t=yr.fromAny(t);const e=this.downlink.get(t);return this.downlink.delete(t)?lr.of(t,e):ar.absent()}clear(){this.downlink.clear()}forEach(t,e){let r=0;return this.downlink.forEach((function(i,n){const s=t.call(e,lr.of(i,n),r);return r+=1,s}))}keyIterator(){return this.downlink.keys()}didUpdate(t,e,r){this.decohereInputKey(t,0),this.recohereInput(0)}didRemove(t,e){this.decohereInputKey(t,1),this.recohereInput(0)}didDrop(t){}didTake(t){}didClear(){}}class yl extends Un{constructor(t=null){super(),this.warp=t}reify(t){return t instanceof hr?this.reifyField(t):this.reifyValue(t)}reifyField(t){const e=t.value,r=this.reifyValue(e);return e!==r?t.updatedValue(r):t}reifyValue(t){return t instanceof Fn?this.reifyModel(t):t}reifyModel(t){if("link"===t.tag){const e=new ml(this.warp,t);return e.compile(),e}return t}}class ml extends Tn{constructor(t=null,e){super(e),this.hostUri=this.inoutlet(),this.nodeUri=this.inoutlet(),this.laneUri=this.inoutlet(),this.prio=this.inoutlet(),this.rate=this.inoutlet(),this.bodyValue=this.inoutlet(),this.type=this.inoutlet(),this.state=this.outlet(),this.warp=t,this.downlink=null,this.downlinkRecord=null,this.inputHostUri=void 0,this.inputNodeUri=void 0,this.inputLaneUri=void 0,this.inputPrio=void 0,this.inputRate=void 0,this.inputBody=void 0,this.inputType=void 0}getOutput(t){if((t=this.outlet(t))===this.state){if(this.downlink instanceof dl)return this.downlink.get();if(null!==this.downlinkRecord)return this.downlinkRecord}}onRecohere(t){var e;const r=this.castInput(this.hostUri,ki.forString()),i=this.castInput(this.nodeUri,ki.forString()),n=this.castInput(this.laneUri,ki.forString()),s=this.castInput(this.prio,ki.forNumber(),0),o=this.castInput(this.rate,ki.forNumber(),0),a=this.getInput(this.bodyValue),u=this.castInput(this.type,ki.forString(),void 0);if(r!==this.inputHostUri||i!==this.inputNodeUri||n!==this.inputLaneUri||s!==this.inputPrio||o!==this.inputRate||(void 0===a?void 0!==this.inputBody:!a.equals(this.inputBody))||u!==this.inputType){null!==this.downlink&&(this.downlink.close(),this.downlink=null,this.downlinkRecord=null),this.inputHostUri=r,this.inputNodeUri=i,this.inputLaneUri=n,this.inputPrio=s,this.inputRate=o,this.inputBody=a,this.inputType=u;const t=null!==(e=this.warp)&&void 0!==e?e:Cl;if("map"===u){let e=t.downlinkMap();void 0!==r&&(e=e.hostUri(r)),void 0!==i&&(e=e.nodeUri(i)),void 0!==n&&(e=e.laneUri(n)),0!==s&&(e=e.prio(s)),0!==o&&(e=e.rate(o)),void 0!==a&&(e=e.body(a)),e=e.open(),this.state=e,this.downlink=e,this.downlinkRecord=new fl(e)}else if("value"===u){let e=t.downlinkValue();void 0!==r&&(e=e.hostUri(r)),void 0!==i&&(e=e.nodeUri(i)),void 0!==n&&(e=e.laneUri(n)),void 0!==s&&(e=e.prio(s)),void 0!==o&&(e=e.rate(o)),void 0!==a&&(e=e.body(a)),e=e.open(),this.state=e,this.downlink=e}}}static reifier(t){return void 0===t?(void 0===ml._reifier&&(ml._reifier=new yl),ml._reifier):new yl(t)}}e([Mn],ml.prototype,"hostUri",void 0),e([Mn],ml.prototype,"nodeUri",void 0),e([Mn],ml.prototype,"laneUri",void 0),e([Mn],ml.prototype,"prio",void 0),e([Mn],ml.prototype,"rate",void 0),e([Mn("body")],ml.prototype,"bodyValue",void 0),e([Mn],ml.prototype,"type",void 0),e([An],ml.prototype,"state",void 0);class wl{constructor(t){this.context=t,this.host=null,this.downlinks=[],this.observers=v.empty}isConnected(){const t=this.host;return null!==t&&t.isConnected()}isAuthenticated(){const t=this.host;return null!==t&&t.isAuthenticated()}get session(){const t=this.host;return null!==t?t.session:yr.absent()}authenticate(t){this.context.authenticate(this.hostUri,t)}addDownlink(t){const e=this.downlinks;0===e.length&&this.open(),e.push(t)}removeDownlink(t){const e=this.downlinks,r=e.indexOf(t);r>=0&&(e.splice(r,1),0===e.length&&this.close())}open(){this.context.openRef(this)}close(){this.context.closeRef(this)}closeUp(){const t=this.downlinks;this.downlinks=[];for(let e=0,r=t.length;e<r;e+=1)t[e].close()}observe(t){return this.observers=v.inserted(t,this.observers),this}unobserve(t){const e=this.observers,r=e.length;for(let i=0;i<r;i+=1){const n=e[i];let s=n===t;if(!s)for(const e in n)if(n[e]===t){s=!0;break}if(s){if(r>1){const t=new Array(r-1);for(let r=0;r<i;r+=1)t[r]=e[r];for(let n=i+1;n<r;n+=1)t[n-1]=e[n];this.observers=t}else this.observers=v.empty;break}}return this}didConnect(t){return this.observe({didConnect:t})}didAuthenticate(t){return this.observe({didAuthenticate:t})}didDeauthenticate(t){return this.observe({didDeauthenticate:t})}didDisconnect(t){return this.observe({didDisconnect:t})}didFail(t){return this.observe({didFail:t})}hostDidConnect(t){this.host=t;const e=this.observers;for(let r=0,i=e.length;r<i;r+=1){const i=e[r];void 0!==i.didConnect&&i.didConnect(t,this)}}hostDidAuthenticate(t,e){const r=this.observers;for(let i=0,n=r.length;i<n;i+=1){const n=r[i];void 0!==n.didAuthenticate&&n.didAuthenticate(t,e,this)}}hostDidDeauthenticate(t,e){const r=this.observers;for(let i=0,n=r.length;i<n;i+=1){const n=r[i];void 0!==n.didDeauthenticate&&n.didDeauthenticate(t,e,this)}}hostDidDisconnect(t){this.host=null;const e=this.observers;for(let r=0,i=e.length;r<i;r+=1){const i=e[r];void 0!==i.didDisconnect&&i.didDisconnect(t,this)}}hostDidFail(t,e){const r=this.observers;for(let i=0,n=r.length;i<n;i+=1){const n=r[i];void 0!==n.didFail&&n.didFail(t,e,this)}}}class gl extends wl{constructor(t,e,r,i){super(t),this.hostUri=e,this.nodeUri=r,this.laneUri=i}hostRef(t){return t=po.fromAny(t),new bl(this.context,t)}nodeRef(t){return t=po.fromAny(t),new vl(this.context,this.hostUri,t)}laneRef(t){return t=po.fromAny(t),new gl(this.context,this.hostUri,this.nodeUri,t)}downlink(t){return new ol(this.context,this,t,this.hostUri,this.nodeUri,this.laneUri)}downlinkList(t){return new ul(this.context,this,t,this.hostUri,this.nodeUri,this.laneUri)}downlinkMap(t){return new ll(this.context,this,t,this.hostUri,this.nodeUri,this.laneUri)}downlinkValue(t){return new dl(this.context,this,t,this.hostUri,this.nodeUri,this.laneUri)}command(t){this.context.command(this.hostUri,this.nodeUri,this.laneUri,t)}}class vl extends wl{constructor(t,e,r){super(t),this.hostUri=e,this.nodeUri=r}hostRef(t){return t=po.fromAny(t),new bl(this.context,t)}nodeRef(t){return t=po.fromAny(t),new vl(this.context,this.hostUri,t)}laneRef(t){return t=po.fromAny(t),new gl(this.context,this.hostUri,this.nodeUri,t)}downlink(t){return new ol(this.context,this,t,this.hostUri,this.nodeUri)}downlinkList(t){return new ul(this.context,this,t,this.hostUri,this.nodeUri)}downlinkMap(t){return new ll(this.context,this,t,this.hostUri,this.nodeUri)}downlinkValue(t){return new dl(this.context,this,t,this.hostUri,this.nodeUri)}command(t,e){this.context.command(this.hostUri,this.nodeUri,t,e)}}class bl extends wl{constructor(t,e){super(t),this.hostUri=e}hostRef(t){return t=po.fromAny(t),new bl(this.context,t)}nodeRef(t){return t=po.fromAny(t),new vl(this.context,this.hostUri,t)}laneRef(t,e){return t=po.fromAny(t),e=po.fromAny(e),new gl(this.context,this.hostUri,t,e)}downlink(t){return new ol(this.context,this,t,this.hostUri)}downlinkList(t){return new ul(this.context,this,t,this.hostUri)}downlinkMap(t){return new ll(this.context,this,t,this.hostUri)}downlinkValue(t){return new dl(this.context,this,t,this.hostUri)}command(t,e,r){this.context.command(this.hostUri,t,e,r)}}class xl{constructor(t={}){void 0===t.keepOnline&&(t.keepOnline=!0),this.options=t,this.hosts=new Te,this.downlinks=new Te,this.downlinkCount=0,this.refs=[],this.online=!0,this.observers=v.empty,this.onOnline=this.onOnline.bind(this),this.onOffline=this.onOffline.bind(this),this.watchOnline(!!t.keepOnline)}isOnline(t){return void 0===t?this.online:(this.online!==t&&(this.online=t,t&&this.hosts.forEach((function(t,e){e.open()}),this)),this)}keepOnline(t){return void 0===t?!!this.options.keepOnline:(this.options.keepOnline!==t&&(this.options.keepOnline=t,this.watchOnline(t)),this)}watchOnline(t){"object"==typeof window&&(t?(window.addEventListener("online",this.onOnline),window.addEventListener("offline",this.onOffline)):(window.removeEventListener("online",this.onOnline),window.removeEventListener("offline",this.onOffline)))}onOnline(t){this.isOnline(!0)}onOffline(t){this.isOnline(!1)}getHost(t){return t=po.fromAny(t),this.hosts.get(t)}openHost(t){t=po.fromAny(t);let e=this.hosts.get(t);return void 0===e&&(e=new tl(this,t,this.options),this.hosts.set(t,e)),e}closeHost(t){void 0!==this.hosts.get(t.hostUri)&&(this.hosts.delete(t.hostUri),t.closeUp())}getDownlink(t,e,r){const i=this.downlinks.get(t);if(void 0!==i){const t=i.get(e);if(void 0!==t)return t.get(r)}}openDownlink(t){const e=t.hostUri,r=t.nodeUri,i=t.laneUri;let n=this.downlinks.get(e);void 0===n&&(n=new Te,this.downlinks.set(e,n));let s=n.get(r);if(void 0===s&&(s=new Te,n.set(r,s)),s.has(i))throw new Error("duplicate downlink");s.set(i,t),this.downlinkCount+=1;this.openHost(e).openDownlink(t)}unlinkDownlink(t){const e=t.hostUri,r=this.getHost(e);void 0!==r&&r.unlinkDownlink(t)}closeDownlink(t){const e=t.hostUri,r=t.nodeUri,i=t.laneUri,n=this.downlinks.get(e);if(void 0!==n){const s=n.get(r);if(void 0!==s&&s.get(i)){this.downlinkCount-=1,s.delete(i),s.isEmpty()&&(n.delete(r),n.isEmpty()&&this.downlinks.delete(e));const o=this.getHost(e);void 0!==o&&o.closeDownlink(t)}}}downlink(t){return new ol(this,null,t)}downlinkList(t){return new ul(this,null,t)}downlinkMap(t){return new ll(this,null,t)}downlinkValue(t){return new dl(this,null,t)}openRef(t){this.refs.push(t)}closeRef(t){const e=this.refs,r=e.indexOf(t);r>=0&&(e.splice(r,1),t.closeUp())}hostRef(t){return t=po.fromAny(t),new bl(this,t)}nodeRef(t,e){return t=po.fromAny(t),void 0===e?(t=(e=t).endpoint(),e=t.unresolve(e)):e=po.fromAny(e),new vl(this,t,e)}laneRef(t,e,r){return t=po.fromAny(t),e=po.fromAny(e),void 0===r?(r=e,t=(e=t).endpoint(),e=t.unresolve(e)):r=po.fromAny(r),new gl(this,t,e,r)}authenticate(t,e){t=po.fromAny(t),e=yr.fromAny(e);this.openHost(t).authenticate(e)}command(t,e,r,i){t=po.fromAny(t),e=po.fromAny(e),3===arguments.length?(i=r,r=e,t=(e=t).endpoint(),e=t.unresolve(e)):r=po.fromAny(r),i=yr.fromAny(i);this.openHost(t).command(e,r,i)}close(){const t=this.refs;this.refs=[];for(let e=0;e<t.length;e+=1)t[e].closeUp();const e=this.downlinks.clone();this.downlinks.clear(),this.downlinkCount=0,e.forEach((function(t,e){e.forEach((function(e,r){r.forEach((function(e,r){r.closeUp();const i=this.getHost(t);void 0!==i&&i.closeDownlink(r)}),this)}),this)}),this);const r=this.hosts.clone();this.hosts.clear(),r.forEach((function(t,e){e.closeUp()}),this)}observe(t){return this.observers=v.inserted(t,this.observers),this}unobserve(t){const e=this.observers,r=e.length;for(let i=0;i<r;i+=1){const n=e[i];let s=n===t;if(!s)for(const e in n)if(n[e]===t){s=!0;break}if(s){if(r>1){const t=new Array(r-1);for(let r=0;r<i;r+=1)t[r]=e[r];for(let n=i+1;n<r;n+=1)t[n-1]=e[n];this.observers=t}else this.observers=v.empty;break}}return this}didConnect(t){return this.observe({didConnect:t})}didAuthenticate(t){return this.observe({didAuthenticate:t})}didDeauthenticate(t){return this.observe({didDeauthenticate:t})}didDisconnect(t){return this.observe({didDisconnect:t})}didFail(t){return this.observe({didFail:t})}hostDidConnect(t){const e=this.observers;for(let r=0,i=e.length;r<i;r+=1){const i=e[r];void 0!==i.didConnect&&i.didConnect(t,this)}const r=this.refs;for(let e=0,i=r.length;e<i;e+=1){const i=r[e];i.hostUri.equals(t.hostUri)&&i.hostDidConnect(t)}}hostDidAuthenticate(t,e){const r=this.observers;for(let i=0,n=r.length;i<n;i+=1){const n=r[i];void 0!==n.didAuthenticate&&n.didAuthenticate(t,e,this)}const i=this.refs;for(let r=0,n=i.length;r<n;r+=1){const n=i[r];n.hostUri.equals(e.hostUri)&&n.hostDidAuthenticate(t,e)}}hostDidDeauthenticate(t,e){const r=this.observers;for(let i=0,n=r.length;i<n;i+=1){const n=r[i];void 0!==n.didDeauthenticate&&n.didDeauthenticate(t,e,this)}const i=this.refs;for(let r=0,n=i.length;r<n;r+=1){const n=i[r];n.hostUri.equals(e.hostUri)&&n.hostDidDeauthenticate(t,e)}}hostDidDisconnect(t){const e=this.observers;for(let r=0,i=e.length;r<i;r+=1){const i=e[r];void 0!==i.didDisconnect&&i.didDisconnect(t,this)}const r=this.refs;for(let e=0,i=r.length;e<i;e+=1){const i=r[e];i.hostUri.equals(t.hostUri)&&i.hostDidDisconnect(t)}}hostDidFail(t,e){const r=this.observers;for(let i=0,n=r.length;i<n;i+=1){const n=r[i];void 0!==n.didFail&&n.didFail(t,e,this)}const i=this.refs;for(let r=0,n=i.length;r<n;r+=1){const n=i[r];n.hostUri.equals(e.hostUri)&&n.hostDidFail(t,e)}}}const Cl=new xl,Ol=Cl.isOnline.bind(Cl),Sl=Cl.keepOnline.bind(Cl),El=Cl.downlink.bind(Cl),kl=Cl.downlinkList.bind(Cl),Al=Cl.downlinkMap.bind(Cl),Ml=Cl.downlinkValue.bind(Cl),Dl=Cl.hostRef.bind(Cl),Il=Cl.nodeRef.bind(Cl),Pl=Cl.laneRef.bind(Cl),Tl=Cl.authenticate.bind(Cl),Vl=Cl.command.bind(Cl);class Fl extends G{constructor(t){super(),this.client=t}static global(){return new Fl(Cl)}}e([s],Fl,"global",null);const ql=function(t){const e=t.extend("WarpProvider");return Object.defineProperty(e.prototype,"client",{get(){let t=this.service;return null==t&&(t=Fl.global()),t.client},configurable:!0}),e.prototype.createService=function(){return Fl.global()},e}(ke),Ul=function(t){const e=t.extend("DownlinkFastener");return Object.defineProperty(e.prototype,"familyType",{get:function(){return e},configurable:!0}),e.prototype.onInherit=function(t){},e.prototype.hostUri=function(t){return void 0===t?null!==this.ownHostUri?this.ownHostUri:(null!==(t=void 0!==this.initHostUri?this.initHostUri():null)&&(t=po.fromAny(t),this.ownHostUri=t),t):(null!==t&&(t=po.fromAny(t)),f(this.ownHostUri,t)||(this.ownHostUri=t,this.relink()),this)},e.prototype.nodeUri=function(t){return void 0===t?null!==this.ownNodeUri?this.ownNodeUri:(null!==(t=void 0!==this.initNodeUri?this.initNodeUri():null)&&(t=po.fromAny(t),this.ownNodeUri=t),t):(null!==t&&(t=po.fromAny(t)),f(this.ownNodeUri,t)||(this.ownNodeUri=t,this.relink()),this)},e.prototype.laneUri=function(t){return void 0===t?null!==this.ownLaneUri?this.ownLaneUri:(null!==(t=void 0!==this.initLaneUri?this.initLaneUri():null)&&(t=po.fromAny(t),this.ownLaneUri=t),t):(null!==t&&(t=po.fromAny(t)),f(this.ownLaneUri,t)||(this.ownLaneUri=t,this.relink()),this)},e.prototype.prio=function(t){return 0===arguments.length?void 0!==this.ownPrio?this.ownPrio:(void 0!==(t=void 0!==this.initPrio?this.initPrio():void 0)&&(this.ownPrio=t),t):(this.ownPrio!==t&&(this.ownPrio=t,this.relink()),this)},e.prototype.rate=function(t){return 0===arguments.length?void 0!==this.ownRate?this.ownRate:(void 0!==(t=void 0!==this.initRate?this.initRate():void 0)&&(this.ownRate=t),t):(this.ownRate!==t&&(this.ownRate=t,this.relink()),this)},e.prototype.body=function(t){return void 0===t?null!==this.ownBody?this.ownBody:(null!==(t=void 0!==this.initBody?this.initBody():null)&&(t=yr.fromAny(t),this.ownBody=t),t):(null!==t&&(t=yr.fromAny(t)),f(this.ownBody,t)||(this.ownBody=t,this.relink()),this)},e.prototype.warp=function(t){return void 0===t?this.ownWarp:(this.ownWarp!==t&&(this.ownWarp=t,this.relink()),this)},e.prototype.link=function(){if(null===this.downlink){let t=this.ownWarp;null===t&&(t=this.owner.warpRef.state),null===t&&(t=this.owner.warpProvider.service.client);let r=this.createDownlink(t);r=this.bindDownlink(r),void 0!==this.initDownlink&&(r=this.initDownlink(r)),r=r.observe(this),this.downlink=r.open(),this.setFlags(this.flags&~e.PendingFlag)}},e.prototype.unlink=function(){const t=this.downlink;null!==t&&(t.close(),this.downlink=null,this.setFlags(this.flags|e.PendingFlag))},e.prototype.relink=function(){this.setFlags(this.flags|e.PendingFlag),0!=(this.flags&e.ConsumingFlag)&&(this.setCoherent(!1),this.decohere())},e.prototype.bindDownlink=function(t){const e=this.hostUri();null!==e&&(t=t.hostUri(e));const r=this.nodeUri();null!==r&&(t=t.nodeUri(r));const i=this.laneUri();null!==i&&(t=t.laneUri(i));const n=this.prio();void 0!==n&&(t=t.prio(n));const s=this.rate();void 0!==s&&(t=t.rate(s));const o=this.body();return null!==o&&(t=t.body(o)),t},e.prototype.recohere=function(t){this.setCoherent(!0),null!==this.downlink&&(this.flags&e.RelinkMask)===e.RelinkMask?(this.unlink(),this.link()):null===this.downlink&&0!=(this.flags&e.ConsumingFlag)?this.link():null!==this.downlink&&0==(this.flags&e.ConsumingFlag)&&this.unlink()},e.prototype.consume=function(t){const e=this.consumers,r=v.inserted(t,e);e!==r&&(this.willConsume(t),this.consumers=r,this.onConsume(t),this.didConsume(t),0===e.length&&this.startConsuming())},e.prototype.willConsume=function(t){},e.prototype.onConsume=function(t){},e.prototype.didConsume=function(t){},e.prototype.unconsume=function(t){const e=this.consumers,r=v.removed(t,e);e!==r&&(this.willUnconsume(t),this.consumers=r,this.onUnconsume(t),this.didUnconsume(t),0===r.length&&this.stopConsuming())},e.prototype.willUnconsume=function(t){},e.prototype.onUnconsume=function(t){},e.prototype.didUnconsume=function(t){},Object.defineProperty(e.prototype,"consuming",{get(){return 0!=(this.flags&e.ConsumingFlag)},configurable:!0}),e.prototype.startConsuming=function(){0==(this.flags&e.ConsumingFlag)&&(this.willStartConsuming(),this.setFlags(this.flags|e.ConsumingFlag),this.onStartConsuming(),this.didStartConsuming())},e.prototype.willStartConsuming=function(){},e.prototype.onStartConsuming=function(){this.setCoherent(!1),this.decohere()},e.prototype.didStartConsuming=function(){},e.prototype.stopConsuming=function(){0!=(this.flags&e.ConsumingFlag)&&(this.willStopConsuming(),this.setFlags(this.flags&~e.ConsumingFlag),this.onStopConsuming(),this.didStopConsuming())},e.prototype.willStopConsuming=function(){},e.prototype.onStopConsuming=function(){this.setCoherent(!1),this.decohere()},e.prototype.didStopConsuming=function(){},e.prototype.onMount=function(){t.prototype.onMount.call(this),0!=(this.flags&e.ConsumingFlag)&&(this.setCoherent(!1),this.decohere())},e.prototype.onUnmount=function(){t.prototype.onUnmount.call(this),this.unlink()},Object.defineProperty(e.prototype,"lazy",{get:function(){return!1},configurable:!0}),Object.defineProperty(e.prototype,"static",{get:function(){return!0},configurable:!0}),e.construct=function(e,r,i){return(r=t.construct(e,r,i)).ownHostUri=null,r.ownNodeUri=null,r.ownLaneUri=null,r.ownPrio=void 0,r.ownRate=void 0,r.ownBody=null,r.ownWarp=null,r.downlink=null,r.consumers=v.empty,r},e.define=function(t,e){let r=e.extends;const i=e.affinity,n=e.inherits;let s=e.hostUri,o=e.nodeUri,a=e.laneUri,u=e.prio,h=e.rate,l=e.body;delete e.extends,delete e.affinity,delete e.inherits,delete e.hostUri,delete e.nodeUri,delete e.laneUri,delete e.prio,delete e.rate,delete e.body,null==r&&(r=this);const c=r.extend(t,e);return c.construct=function(t,e,c){return e=r.construct(t,e,c),void 0!==i&&e.initAffinity(i),void 0!==n&&e.initInherits(n),void 0!==s&&(e.ownHostUri=s),void 0!==o&&(e.ownNodeUri=o),void 0!==a&&(e.ownLaneUri=a),void 0!==u&&(e.ownPrio=u),void 0!==h&&(e.ownRate=h),void 0!==l&&(e.ownBody=l),e},"function"==typeof s?(c.prototype.initHostUri=s,s=void 0):void 0!==s&&(s=po.fromAny(s)),"function"==typeof o?(c.prototype.initNodeUri=o,o=void 0):void 0!==o&&(o=po.fromAny(o)),"function"==typeof a?(c.prototype.initLaneUri=a,a=void 0):void 0!==a&&(a=po.fromAny(a)),"function"==typeof u&&(c.prototype.initPrio=u,u=void 0),"function"==typeof h&&(c.prototype.initRate=h,h=void 0),"function"==typeof l?(c.prototype.initBody=l,l=void 0):void 0!==l&&(l=yr.fromAny(l)),c},e.ConsumingFlag=1<<t.FlagShift+0,e.PendingFlag=1<<t.FlagShift+1,e.RelinkMask=e.ConsumingFlag|e.PendingFlag,e.FlagShift=t.FlagShift+2,e.FlagMask=(1<<e.FlagShift)-1,e}(we),Rl=function(t){const e=t.extend("EventDownlinkFastener");return e.prototype.createDownlink=function(t){return t.downlink()},e.construct=function(e,r,i){return r=t.construct(e,r,i)},e.define=function(t,e){let r=e.extends;const i=e.affinity,n=e.inherits;let s=e.hostUri,o=e.nodeUri,a=e.laneUri,u=e.prio,h=e.rate,l=e.body;delete e.extends,delete e.affinity,delete e.inherits,delete e.hostUri,delete e.nodeUri,delete e.laneUri,delete e.prio,delete e.rate,delete e.body,null==r&&(r=this);const c=r.extend(t,e);return c.construct=function(t,e,c){return e=r.construct(t,e,c),void 0!==i&&e.initAffinity(i),void 0!==n&&e.initInherits(n),void 0!==s&&(e.ownHostUri=s),void 0!==o&&(e.ownNodeUri=o),void 0!==a&&(e.ownLaneUri=a),void 0!==u&&(e.ownPrio=u),void 0!==h&&(e.ownRate=h),void 0!==l&&(e.ownBody=l),e},"function"==typeof s?(c.prototype.initHostUri=s,s=void 0):void 0!==s&&(s=po.fromAny(s)),"function"==typeof o?(c.prototype.initNodeUri=o,o=void 0):void 0!==o&&(o=po.fromAny(o)),"function"==typeof a?(c.prototype.initLaneUri=a,a=void 0):void 0!==a&&(a=po.fromAny(a)),"function"==typeof u&&(c.prototype.initPrio=u,u=void 0),"function"==typeof h&&(c.prototype.initRate=h,h=void 0),"function"==typeof l?(c.prototype.initBody=l,l=void 0):void 0!==l&&(l=yr.fromAny(l)),c},e}(Ul),Nl=function(t){const e=t.extend("ListDownlinkFastener");return e.prototype.valueForm=function(t){return void 0===t?this.ownValueForm:(this.ownValueForm!==t&&(this.ownValueForm=t,this.relink()),this)},Object.defineProperty(e.prototype,"length",{get:function(){const t=this.downlink;return null!==t?t.length:0},configurable:!0}),e.prototype.isEmpty=function(){const t=this.downlink;return null===t||t.isEmpty()},e.prototype.get=function(t,e){const r=this.downlink;return null!==r?r.get(t,e):void 0},e.prototype.getEntry=function(t,e){const r=this.downlink;return null!==r?r.getEntry(t,e):void 0},e.prototype.set=function(t,e,r){const i=this.downlink;return null!=i&&i.set(t,e,r),this},e.prototype.insert=function(t,e,r){const i=this.downlink;return null!=i&&i.insert(t,e,r),this},e.prototype.remove=function(t,e){const r=this.downlink;return null!=r&&r.remove(t,e),this},e.prototype.push=function(...t){const e=this.downlink;return null!==e?e.push(...t):0},e.prototype.pop=function(){const t=this.downlink;return null!==t?t.pop():void 0},e.prototype.unshift=function(...t){const e=this.downlink;return null!==e?e.unshift(...t):0},e.prototype.shift=function(){const t=this.downlink;return null!==t?t.shift():void 0},e.prototype.move=function(t,e,r){const i=this.downlink;return null!=i&&i.move(t,e,r),this},e.prototype.splice=function(t,e,...r){const i=this.downlink;return null!==i?i.splice(t,e,...r):[]},e.prototype.clear=function(){const t=this.downlink;null!=t&&t.clear()},e.prototype.forEach=function(t,e){const r=this.downlink;return null!==r?r.forEach(t,e):void 0},e.prototype.values=function(){const t=this.downlink;return null!==t?t.values():_.empty()},e.prototype.keys=function(){const t=this.downlink;return null!==t?t.keys():_.empty()},e.prototype.entries=function(){const t=this.downlink;return null!==t?t.entries():_.empty()},e.prototype.createDownlink=function(t){let e=t.downlinkList();return null!==this.ownValueForm&&(e=e.valueForm(this.ownValueForm)),e},e.construct=function(e,r,i){return null===r&&(r=function(t,e){return 0===arguments.length?r.get(t):(r.set(t,e),r.owner)},delete r.name,Object.setPrototypeOf(r,e.prototype)),(r=t.construct(e,r,i)).ownValueForm=null,r},e.define=function(t,e){let r=e.extends;const i=e.affinity,n=e.inherits,s=e.valueForm;let o=e.hostUri,a=e.nodeUri,u=e.laneUri,h=e.prio,l=e.rate,c=e.body;delete e.extends,delete e.affinity,delete e.inherits,delete e.valueForm,delete e.hostUri,delete e.nodeUri,delete e.laneUri,delete e.prio,delete e.rate,delete e.body,null==r&&(r=this);const d=r.extend(t,e);return d.construct=function(t,e,d){return e=r.construct(t,e,d),void 0!==i&&e.initAffinity(i),void 0!==n&&e.initInherits(n),void 0!==o&&(e.ownHostUri=o),void 0!==a&&(e.ownNodeUri=a),void 0!==u&&(e.ownLaneUri=u),void 0!==h&&(e.ownPrio=h),void 0!==l&&(e.ownRate=l),void 0!==c&&(e.ownBody=c),void 0!==s&&(e.ownValueForm=s),e},"function"==typeof o?(d.prototype.initHostUri=o,o=void 0):void 0!==o&&(o=po.fromAny(o)),"function"==typeof a?(d.prototype.initNodeUri=a,a=void 0):void 0!==a&&(a=po.fromAny(a)),"function"==typeof u?(d.prototype.initLaneUri=u,u=void 0):void 0!==u&&(u=po.fromAny(u)),"function"==typeof h&&(d.prototype.initPrio=h,h=void 0),"function"==typeof l&&(d.prototype.initRate=l,l=void 0),"function"==typeof c?(d.prototype.initBody=c,c=void 0):void 0!==c&&(c=yr.fromAny(c)),d},e}(Ul),zl=function(t){const e=t.extend("MapDownlinkFastener");return e.prototype.keyForm=function(t){return void 0===t?this.ownKeyForm:(this.ownKeyForm!==t&&(this.ownKeyForm=t,this.relink()),this)},e.prototype.valueForm=function(t){return void 0===t?this.ownValueForm:(this.ownValueForm!==t&&(this.ownValueForm=t,this.relink()),this)},Object.defineProperty(e.prototype,"size",{get:function(){const t=this.downlink;return null!==t?t.size:0},configurable:!0}),e.prototype.isEmpty=function(){const t=this.downlink;return null===t||t.isEmpty()},e.prototype.has=function(t){const e=this.downlink;return null!==e&&e.has(t)},e.prototype.get=function(t){const e=this.downlink;let r;return null!==e&&(r=e.get(t)),void 0===r&&null!==this.ownValueForm&&(r=this.ownValueForm.unit),r},e.prototype.getEntry=function(t){const e=this.downlink;return null!==e?e.getEntry(t):void 0},e.prototype.firstKey=function(){const t=this.downlink;return null!==t?t.firstKey():void 0},e.prototype.firstValue=function(){const t=this.downlink;return null!==t?t.firstValue():void 0},e.prototype.firstEntry=function(){const t=this.downlink;return null!==t?t.firstEntry():void 0},e.prototype.lastKey=function(){const t=this.downlink;return null!==t?t.lastKey():void 0},e.prototype.lastValue=function(){const t=this.downlink;return null!==t?t.lastValue():void 0},e.prototype.lastEntry=function(){const t=this.downlink;return null!==t?t.lastEntry():void 0},e.prototype.nextKey=function(t){const e=this.downlink;return null!==e?e.nextKey(t):void 0},e.prototype.nextValue=function(t){const e=this.downlink;return null!==e?e.nextValue(t):void 0},e.prototype.nextEntry=function(t){const e=this.downlink;return null!==e?e.nextEntry(t):void 0},e.prototype.previousKey=function(t){const e=this.downlink;return null!==e?e.previousKey(t):void 0},e.prototype.previousValue=function(t){const e=this.downlink;return null!==e?e.previousValue(t):void 0},e.prototype.previousEntry=function(t){const e=this.downlink;return null!==e?e.previousEntry(t):void 0},e.prototype.set=function(t,e){const r=this.downlink;return null!==r&&r.set(t,e),this},e.prototype.delete=function(t){const e=this.downlink;return null!==e&&e.delete(t)},e.prototype.drop=function(t){const e=this.downlink;return null!==e&&e.drop(t),this},e.prototype.take=function(t){const e=this.downlink;return null!==e&&e.take(t),this},e.prototype.clear=function(){const t=this.downlink;null!==t&&t.clear()},e.prototype.forEach=function(t,e){const r=this.downlink;return null!==r?r.forEach(t,e):void 0},e.prototype.keys=function(){const t=this.downlink;return null!==t?t.keys():_.empty()},e.prototype.values=function(){const t=this.downlink;return null!==t?t.values():_.empty()},e.prototype.entries=function(){const t=this.downlink;return null!==t?t.entries():_.empty()},e.prototype.createDownlink=function(t){let e=t.downlinkMap();return null!==this.ownKeyForm&&(e=e.keyForm(this.ownKeyForm)),null!==this.ownValueForm&&(e=e.valueForm(this.ownValueForm)),e},e.construct=function(e,r,i){return null===r&&(r=function(t,e){return 1===arguments.length?r.get(t):(r.set(t,e),r.owner)},delete r.name,Object.setPrototypeOf(r,e.prototype)),(r=t.construct(e,r,i)).ownKeyForm=null,r.ownValueForm=null,r},e.define=function(t,e){let r=e.extends;const i=e.affinity,n=e.inherits,s=e.keyForm,o=e.valueForm;let a=e.hostUri,u=e.nodeUri,h=e.laneUri,l=e.prio,c=e.rate,d=e.body;delete e.extends,delete e.affinity,delete e.inherits,delete e.keyForm,delete e.valueForm,delete e.hostUri,delete e.nodeUri,delete e.laneUri,delete e.prio,delete e.rate,delete e.body,null==r&&(r=this);const p=r.extend(t,e);return p.construct=function(t,e,p){return e=r.construct(t,e,p),void 0!==i&&e.initAffinity(i),void 0!==n&&e.initInherits(n),void 0!==a&&(e.ownHostUri=a),void 0!==u&&(e.ownNodeUri=u),void 0!==h&&(e.ownLaneUri=h),void 0!==l&&(e.ownPrio=l),void 0!==c&&(e.ownRate=c),void 0!==d&&(e.ownBody=d),void 0!==s&&(e.ownKeyForm=s),void 0!==o&&(e.ownValueForm=o),e},"function"==typeof a?(p.prototype.initHostUri=a,a=void 0):void 0!==a&&(a=po.fromAny(a)),"function"==typeof u?(p.prototype.initNodeUri=u,u=void 0):void 0!==u&&(u=po.fromAny(u)),"function"==typeof h?(p.prototype.initLaneUri=h,h=void 0):void 0!==h&&(h=po.fromAny(h)),"function"==typeof l&&(p.prototype.initPrio=l,l=void 0),"function"==typeof c&&(p.prototype.initRate=c,c=void 0),"function"==typeof d?(p.prototype.initBody=d,d=void 0):void 0!==d&&(d=yr.fromAny(d)),p},e}(Ul),jl=function(t){const e=t.extend("ValueDownlinkFastener");return e.prototype.valueForm=function(t){return void 0===t?this.ownValueForm:(this.ownValueForm!==t&&(this.ownValueForm=t,this.relink()),this)},e.prototype.get=function(){const t=this.downlink;return null!==t?t.get():void 0},e.prototype.set=function(t){const e=this.downlink;null!==e&&e.set(t)},e.prototype.createDownlink=function(t){let e=t.downlinkValue();return null!==this.ownValueForm&&(e=e.valueForm(this.ownValueForm)),e},e.construct=function(e,r,i){return null===r&&(r=function(t){return 0===arguments.length?r.get():(r.set(t),r.owner)},delete r.name,Object.setPrototypeOf(r,e.prototype)),(r=t.construct(e,r,i)).ownValueForm=null,r},e.define=function(t,e){let r=e.extends;const i=e.affinity,n=e.inherits,s=e.valueForm;let o=e.hostUri,a=e.nodeUri,u=e.laneUri,h=e.prio,l=e.rate,c=e.body;delete e.extends,delete e.affinity,delete e.inherits,delete e.valueForm,delete e.hostUri,delete e.nodeUri,delete e.laneUri,delete e.prio,delete e.rate,delete e.body,null==r&&(r=this);const d=r.extend(t,e);return d.construct=function(t,e,d){return e=r.construct(t,e,d),void 0!==i&&e.initAffinity(i),void 0!==n&&e.initInherits(n),void 0!==o&&(e.ownHostUri=o),void 0!==a&&(e.ownNodeUri=a),void 0!==u&&(e.ownLaneUri=u),void 0!==h&&(e.ownPrio=h),void 0!==l&&(e.ownRate=l),void 0!==c&&(e.ownBody=c),void 0!==s&&(e.ownValueForm=s),e},"function"==typeof o?(d.prototype.initHostUri=o,o=void 0):void 0!==o&&(o=po.fromAny(o)),"function"==typeof a?(d.prototype.initNodeUri=a,a=void 0):void 0!==a&&(a=po.fromAny(a)),"function"==typeof u?(d.prototype.initLaneUri=u,u=void 0):void 0!==u&&(u=po.fromAny(u)),"function"==typeof h&&(d.prototype.initPrio=h,h=void 0),"function"==typeof l&&(d.prototype.initRate=l,l=void 0),"function"==typeof c?(d.prototype.initBody=c,c=void 0):void 0!==c&&(c=yr.fromAny(c)),d},e}(Ul);t.Absent=Ir,t.AbstractInlet=Yi,t.AbstractInoutlet=_i,t.AbstractMapInlet=Zi,t.AbstractMapInletMapOutlet=en,t.AbstractMapInletOutlet=tn,t.AbstractMapInoutlet=$i,t.AbstractMapOutlet=Ji,t.AbstractOutlet=Gi,t.AbstractRecordOutlet=In,t.AbstractRecordStreamlet=Tn,t.AbstractStreamlet=kn,t.AffineTransform=ru,t.AffineTransformInterpolator=iu,t.AffineTransformParser=nu,t.Affinity=ye,t.AndOperator=Br,t.AndOutlet=Kn,t.Angle=na,t.AngleForm=la,t.AngleInterpolator=ha,t.AngleParser=ca,t.Animator=Ce,t.AnyForm=Ti,t.ArrayInterpolator=P,t.Arrays=v,t.AssertException=it,t.Attr=dr,t.AttrInterpolator=pr,t.AuthRequest=Gh,t.AuthedResponse=_h,t.BTree=Te,t.BTreeContext=Pe,t.BTreeLeaf=Fe,t.BTreeNode=qe,t.BTreeNodeCursor=Ue,t.BTreePage=Ve,t.Base10=St,t.Base10IntegerWriter=oe,t.Base10NumberParser=ne,t.Base16=te,t.Base16IntegerWriter=he,t.Base16Parser=ae,t.Base16Writer=ue,t.Base64=le,t.Base64Parser=pe,t.Base64Writer=fe,t.BaseRef=wl,t.Binary=Qt,t.BinaryOperator=Vr,t.BinaryOperatorInterpolator=Fr,t.BinaryOutlet=Nn,t.BitwiseAndOperator=Xr,t.BitwiseAndOutlet=Hn,t.BitwiseNotOperator=si,t.BitwiseNotOutlet=ns,t.BitwiseOrOperator=Wr,t.BitwiseOrOutlet=Bn,t.BitwiseXorOperator=Hr,t.BitwiseXorOutlet=Wn,t.Bool=Mr,t.BooleanAnimator=Ee,t.BooleanForm=Pi,t.BooleanProperty=xe,t.Booleans=a,t.BridgeFunc=Oi,t.ByteOrder=i,t.ByteOutput=Yt,t.ByteOutputBuffer=_t,t.ByteOutputUint8Array=Gt,t.ChildrenSelector=wi,t.CommandMessage=Lh,t.Compare=m,t.ConditionalOperator=Rr,t.ConditionalOperatorInterpolator=Nr,t.ConditionalOutlet=jn,t.Constraint=nr,t.ConstraintAnimator=rr,t.ConstraintConstant=tr,t.ConstraintDummy=Ye,t.ConstraintError=Ge,t.ConstraintExpression=Qe,t.ConstraintGroup=class{constructor(t){this.scope=t,this.constraints=[],this.constrained=!1}constraint(t,e,r,i){t=Qe.fromAny(t),void 0!==r&&(r=Qe.fromAny(r));const n=void 0!==r?t.minus(r):t;i=void 0===i?ir.Required:ir.fromAny(i);const s=new nr(this.scope,n,e,i);return this.addConstraint(s),s}hasConstraint(t){return this.constraints.indexOf(t)>=0}addConstraint(t){const e=this.constraints;e.indexOf(t)<0&&(e.push(t),t.constrain(this.constrained))}removeConstraint(t){const e=this.constraints;if(void 0!==e){const r=e.indexOf(t);r>=0&&(e.splice(r,1),t.constrain(!1))}}enableConstraints(){const t=this.constraints;for(let e=0,r=t.length;e<r;e+=1)t[e].constrain(!0)}disableConstraints(){const t=this.constraints;for(let e=0,r=t.length;e<r;e+=1)t[e].constrain(!1)}isConstrained(){return this.constrained}constrain(t=!0){return t&&!this.constrained?(this.constrained=!0,this.enableConstraints()):!t&&this.constrained&&(this.constrained=!1,this.disableConstraints()),this}},t.ConstraintId=Be,t.ConstraintInvalid=_e,t.ConstraintMap=We,t.ConstraintProduct=$e,t.ConstraintProperty=er,t.ConstraintRow=or,t.ConstraintScope=sr,t.ConstraintSlack=Xe,t.ConstraintSolver=class{constructor(){this.constraints=new We,this.constraintVariables=new We,this.rows=new We,this.infeasible=[],this.objective=new or(this,null,new We,0),this.artificial=null,this.invalidated=new We}constraint(t,e,r,i){t=Qe.fromAny(t),void 0!==r&&(r=Qe.fromAny(r));const n=void 0!==r?t.minus(r):t;i=void 0===i?ir.Required:ir.fromAny(i);const s=new nr(this,n,e,i);return this.addConstraint(s),s}hasConstraint(t){return this.constraints.has(t)}addConstraint(t){if(this.constraints.has(t))return;const e=t.expression.terms;for(let r=0,i=e.size;r<i;r+=1){e.getEntry(r)[0].addConstraintCondition(t,this)}const{row:r,tag:i}=this.createRow(t);this.addConstraintRow(t,r,i)}addConstraintRow(t,e,r){this.willAddConstraint(t);let i=this.chooseSubject(e,r);if(i.isInvalid()&&e.isDummy()){if(!(Math.abs(e.constant)<u.Epsilon))throw new Error("unsatisfiable constraint");i=r.marker}if(i.isInvalid()){if(!this.addWithArtificialVariable(e))throw new Error("unsatisfiable constraint")}else e.setSymbol(i),e.solveFor(i),this.substitute(i,e),this.rows.set(i,e);this.constraints.set(t,r),this.optimize(this.objective),this.didAddConstraint(t),this.updateSolution()}willAddConstraint(t){}didAddConstraint(t){}removeConstraint(t){if(void 0===this.constraints.get(t))return;this.removeConstraintRow(t);const e=t.expression.terms;for(let r=0,i=e.size;r<i;r+=1){e.getEntry(r)[0].removeConstraintCondition(t,this)}}removeConstraintRow(t){const e=this.constraints.get(t);if(void 0===e)return;this.willRemoveConstraint(t),this.constraints.remove(t),this.removeConstraintEffects(t,e);const r=e.marker;if(void 0===this.rows.remove(r)){const t=this.getMarkerLeavingSymbol(r);if(t.isInvalid())throw new Error("failed to find leaving row");const e=this.rows.remove(t);e.solveForEx(t,r),this.substitute(r,e)}this.optimize(this.objective),this.didRemoveConstraint(t),this.updateSolution()}willRemoveConstraint(t){}didRemoveConstraint(t){}constraintVariable(t,e,r){void 0===e&&(e=0),r=void 0!==r?ir.fromAny(r):ir.Strong;const i=er.create(this);return Object.defineProperty(i,"name",{value:t,configurable:!0}),void 0!==e&&i.setState(e),i.setStrength(r),i.mount(),i}hasConstraintVariable(t){return this.constraintVariables.has(t)}addConstraintVariable(t){if(this.constraintVariables.has(t))return;const e=ir.clip(t.strength);if(e===ir.Required)throw new Error("invalid variable strength");this.willAddConstraintVariable(t);const r=new nr(this,t,"eq",e),{row:i,tag:n}=this.createRow(r);this.constraintVariables.set(t,{constraint:r,tag:n,state:0}),this.addConstraintRow(r,i,n),this.didAddConstraintVariable(t)}willAddConstraintVariable(t){}didAddConstraintVariable(t){}removeConstraintVariable(t){const e=this.constraintVariables.get(t);void 0!==e&&(this.willRemoveConstraintVariable(t),this.constraintVariables.remove(t),this.removeConstraintRow(e.constraint),this.didRemoveConstraintVariable(t))}willRemoveConstraintVariable(t){}didRemoveConstraintVariable(t){}setConstraintVariable(t,e){const r=this.constraintVariables.get(t);if(void 0===r)throw new Error("unbound variable");const i=r.state;if(i!==e){r.state=e;const n=e-i;this.willSetConstraintVariable(t,e,i);const s=r.tag.marker;let o=this.rows.get(s);if(void 0!==o)return o.add(-n)<0&&this.infeasible.push(s),void this.dualOptimize();const a=r.tag.other;if(o=this.rows.get(a),void 0!==o)return o.add(n)<0&&this.infeasible.push(a),void this.dualOptimize();for(let t=0,e=this.rows.size;t<e;t+=1){const[e,r]=this.rows.getEntry(t),i=r.coefficientFor(s);0!==i&&r.add(n*i)<0&&!e.isExternal()&&this.infeasible.push(e)}this.dualOptimize(),this.didSetConstraintVariable(t,e,i),this.updateSolution()}}willSetConstraintVariable(t,e,r){}didSetConstraintVariable(t,e,r){}invalidate(t,e=null){t.isExternal()&&this.invalidated.set(t,e)}updateSolution(){const t=this.invalidated;if(!t.isEmpty()){this.invalidated=new We;for(let e=0,r=t.size;e<r;e+=1){const r=t.getEntry(e)[0],i=this.rows.get(r);void 0!==i&&r.updateConstraintSolution(i.constant)}}}createRow(t){const e=t.expression,r=new or(this,null,new We,e.constant),i=e.terms;for(let t=0,e=i.size;t<e;t+=1){const[e,n]=i.getEntry(t);if(Math.abs(n)>=u.Epsilon){const t=this.rows.get(e);void 0!==t?r.insertRow(t,n):r.insertSymbol(e,n)}}const n=this.objective,s=t.relation,o=t.strength,a={marker:He.invalid,other:He.invalid};if("le"===s||"ge"===s){const t="le"===s?1:-1,e=new Xe;if(a.marker=e,r.insertSymbol(e,t),o<ir.Required){const e=new Ge;a.other=e,r.insertSymbol(e,-t),n.insertSymbol(e,o)}}else if(o<ir.Required){const t=new Ge,e=new Ge;a.marker=t,a.other=e,r.insertSymbol(t,-1),r.insertSymbol(e,1),n.insertSymbol(t,o),n.insertSymbol(e,o)}else{const t=new Ye;a.marker=t,r.insertSymbol(t)}return r.constant<0&&r.negate(),{row:r,tag:a}}chooseSubject(t,e){for(let e=0,r=t.cells.size;e<r;e+=1){const r=t.cells.getEntry(e)[0];if(r.isExternal())return r}return(e.marker instanceof Xe||e.marker instanceof Ge)&&t.coefficientFor(e.marker)<0?e.marker:(e.other instanceof Xe||e.other instanceof Ge)&&t.coefficientFor(e.other)<0?e.other:He.invalid}addWithArtificialVariable(t){const e=new Xe;this.rows.set(e,t.clone()),this.artificial=t.clone(),this.optimize(this.artificial);const r=Math.abs(this.artificial.constant)<u.Epsilon;this.artificial=null;const i=this.rows.remove(e);if(void 0!==i){if(i.isConstant())return r;const t=this.anyPivotableSymbol(i);if(t.isInvalid())return!1;i.setSymbol(t),i.solveForEx(e,t),this.substitute(t,i),this.rows.set(t,i)}for(let t=0,r=this.rows.size;t<r;t+=1)this.rows.getEntry(t)[1].removeSymbol(e);return this.objective.removeSymbol(e),r}substitute(t,e){for(let r=0,i=this.rows.size;r<i;r+=1){const[i,n]=this.rows.getEntry(r);n.substitute(t,e),n.constant<0&&!i.isExternal()&&this.infeasible.push(i)}this.objective.substitute(t,e),null!==this.artificial&&this.artificial.substitute(t,e)}optimize(t){for(;;){const e=this.getEnteringSymbol(t);if(e.isInvalid())return;const r=this.getLeavingSymbol(e);if(r.isInvalid())throw new Error("objective is unbounded");const i=this.rows.remove(r);i.setSymbol(e),i.solveForEx(r,e),this.substitute(e,i),this.rows.set(e,i)}}dualOptimize(){let t;for(;t=this.infeasible.pop(),void 0!==t;){const e=this.rows.get(t);if(void 0!==e&&e.constant<0){const r=this.getDualEnteringSymbol(e);if(r.isInvalid())throw new Error("dual optimize failed");this.rows.remove(t),e.setSymbol(r),e.solveForEx(t,r),this.substitute(r,e),this.rows.set(r,e)}}}getEnteringSymbol(t){for(let e=0,r=t.cells.size;e<r;e+=1){const[r,i]=t.cells.getEntry(e);if(i<0&&!r.isDummy())return r}return He.invalid}getDualEnteringSymbol(t){let e=Number.MAX_VALUE,r=He.invalid;for(let i=0,n=t.cells.size;i<n;i+=1){const[n,s]=t.cells.getEntry(i);if(s>0&&!n.isDummy()){const t=this.objective.coefficientFor(n)/s;t<e&&(e=t,r=n)}}return r}getLeavingSymbol(t){let e=Number.MAX_VALUE,r=He.invalid;for(let i=0,n=this.rows.size;i<n;i+=1){const[n,s]=this.rows.getEntry(i);if(!n.isExternal()){const i=s.coefficientFor(t);if(i<0){const t=-s.constant/i;t<e&&(e=t,r=n)}}}return r}getMarkerLeavingSymbol(t){let e=Number.MAX_VALUE,r=Number.MAX_VALUE,i=He.invalid,n=He.invalid,s=He.invalid;for(let o=0,a=this.rows.size;o<a;o+=1){const[a,u]=this.rows.getEntry(o),h=u.coefficientFor(t);if(0!==h)if(a.isExternal())s=a;else if(h<0){const t=-u.constant/h;t<e&&(e=t,i=a)}else{const t=u.constant/h;t<r&&(r=t,n=a)}}return i.isInvalid()?n.isInvalid()?s:n:i}removeConstraintEffects(t,e){e.marker instanceof Ge&&this.removeMarkerEffects(e.marker,t.strength),e.other instanceof Ge&&this.removeMarkerEffects(e.other,t.strength)}removeMarkerEffects(t,e){const r=this.rows.get(t);void 0!==r?this.objective.insertRow(r,-e):this.objective.insertSymbol(t,-e)}anyPivotableSymbol(t){for(let e=0,r=t.cells.size;e<r;e+=1){const r=t.cells.getEntry(e)[0];if(r instanceof Xe||r instanceof Ge)return r}return He.invalid}},t.ConstraintStrength=ir,t.ConstraintSum=Ze,t.ConstraintSymbol=He,t.ConstraintTerm=Je,t.Constructors=p,t.Consumable=Y,t.ContinuousScale=L,t.Creatable=W,t.Cursor=_,t.CursorArray=J,t.CursorEmpty=Q,t.CursorUnary=Z,t.Data=Cr,t.DataOutput=Or,t.Dataflow=us,t.DateTime=Uu,t.DateTimeForm=Nu,t.DateTimeFormat=Ku,t.DateTimeInterpolator=Ru,t.DateTimeLocale=ju,t.DateTimeParser=zu,t.DateTimeSpecifiers=Lu,t.DayInterval=Sh,t.DayOfMonthFormat=Yu,t.DayOfMonthParser=ah,t.DeauthRequest=Qh,t.DeauthedResponse=Zh,t.DegAngle=sa,t.DescendantsSelector=gi,t.Diagnostic=Et,t.DivideOperator=ri,t.DivideOutlet=es,t.Domain=O,t.Downlink=il,t.DownlinkFastener=Ul,t.DownlinkModel=el,t.DownlinkRecord=pl,t.DownlinkReifier=yl,t.DownlinkStreamlet=ml,t.Easing=F,t.EmLength=Zo,t.Envelope=Uh,t.EqOperator=_r,t.EqOutlet=Gn,t.Equals=f,t.Equivalent=u,t.EventDownlink=ol,t.EventDownlinkFastener=Rl,t.EventDownlinkModel=sl,t.EventMessage=jh,t.Expression=Pr,t.Extant=Dr,t.Fastener=we,t.FastenerContext=me,t.Field=hr,t.FieldInterpolator=cr,t.FilterFieldsCombinator=hn,t.FilterFieldsOperator=un,t.FilterSelector=vi,t.FilterTimeInterval=vh,t.Form=ki,t.FormException=Ei,t.Format=Ot,t.FromAny=b,t.Func=xi,t.Functions=d,t.GeOperator=Zr,t.GeOutlet=Qn,t.GenericHierarchy=class extends Ae{constructor(){super(),this.parent=null,this.children=[],this.childMap=null}attachParent(t){this.willAttachParent(t),this.parent=t,t.mounted&&this.cascadeMount(),this.onAttachParent(t),this.didAttachParent(t)}detachParent(t){this.willDetachParent(t),this.mounted&&this.cascadeUnmount(),this.onDetachParent(t),this.parent=null,this.didDetachParent(t)}get childCount(){return this.children.length}firstChild(){const t=this.children;return 0!==t.length?t[0]:null}lastChild(){const t=this.children,e=t.length;return 0!==e?t[e-1]:null}nextChild(t){const e=this.children,r=e.indexOf(t);return r>=0&&r+1<e.length?e[r+1]:null}previousChild(t){const e=this.children,r=e.indexOf(t);return r-1>=0?e[r-1]:null}forEachChild(t,e){let r;const i=this.children;let n=0;for(;n<i.length;){const s=i[n];if(r=t.call(e,s),void 0!==r)break;i[n]===s&&(n+=1)}return r}insertChildMap(t){const e=t.key;if(void 0!==e){let r=this.childMap;null===r&&(r={},this.childMap=r),r[e]=t}}removeChildMap(t){const e=t.key;if(void 0!==e){const t=this.childMap;null!==t&&delete t[e]}}replaceChildMap(t,e){const r=e.key;if(void 0!==r){let e=this.childMap;null===e&&(e={},this.childMap=e),e[r]=t}}getChild(t,e){const r=this.childMap;if(null!==r){const i=r[t];if(void 0!==i&&(void 0===e||i instanceof e))return i}return null}setChild(t,e){const r=this.getChild(t),i=this.children;let n=-1,s=null;return null!==r&&null!==e&&r!==e?(e.remove(),n=i.indexOf(r),s=n+1<i.length?i[n+1]:null,e.setKey(r.key),this.willRemoveChild(r),this.willInsertChild(e,s),r.detachParent(this),i[n]=e,this.replaceChildMap(e,r),e.attachParent(this),this.onRemoveChild(r),this.onInsertChild(e,s),this.didRemoveChild(r),this.didInsertChild(e,s),r.setKey(void 0),e.cascadeInsert()):(e!==r||null!==e&&e.key!==t)&&(null!==r&&(this.willRemoveChild(r),r.detachParent(this),this.removeChildMap(r),n=i.indexOf(r),i.splice(n,1),this.onRemoveChild(r),this.didRemoveChild(r),r.setKey(void 0),n<i.length&&(s=i[n])),null!==e&&(e.remove(),e.setKey(t),this.willInsertChild(e,s),n>=0?i.splice(n,0,e):i.push(e),this.insertChildMap(e),e.attachParent(this),this.onInsertChild(e,s),this.didInsertChild(e,s),e.cascadeInsert())),r}appendChild(t,e){return t.remove(),void 0!==e&&(this.removeChild(e),t.setKey(e)),this.willInsertChild(t,null),this.children.push(t),this.insertChildMap(t),t.attachParent(this),this.onInsertChild(t,null),this.didInsertChild(t,null),t.cascadeInsert(),t}prependChild(t,e){t.remove(),void 0!==e&&(this.removeChild(e),t.setKey(e));const r=this.children,i=0!==r.length?r[0]:null;return this.willInsertChild(t,i),r.unshift(t),this.insertChildMap(t),t.attachParent(this),this.onInsertChild(t,i),this.didInsertChild(t,i),t.cascadeInsert(),t}insertChild(t,e,r){if(null!==e&&e.parent!==this)throw new TypeError(""+e);t.remove(),void 0!==r&&(this.removeChild(r),t.setKey(r)),this.willInsertChild(t,e);const i=this.children,n=null!==e?i.indexOf(e):-1;return n>=0?i.splice(n,0,t):i.push(t),this.insertChildMap(t),t.attachParent(this),this.onInsertChild(t,e),this.didInsertChild(t,e),t.cascadeInsert(),t}replaceChild(t,e){const r=this.children;if(e.parent!==this)throw new TypeError(""+e);if(t!==e){t.remove();const i=r.indexOf(e),n=i+1<r.length?r[i+1]:null;t.setKey(e.key),this.willRemoveChild(e),this.willInsertChild(t,n),e.detachParent(this),r[i]=t,this.replaceChildMap(t,e),t.attachParent(this),this.onRemoveChild(e),this.onInsertChild(t,n),this.didRemoveChild(e),this.didInsertChild(t,n),e.setKey(void 0),t.cascadeInsert()}return e}removeChild(t){let e;if("string"==typeof t){if(e=this.getChild(t),null===e)return null}else if(e=t,e.parent!==this)throw new Error("not a child");this.willRemoveChild(e),e.detachParent(this),this.removeChildMap(e);const r=this.children,i=r.indexOf(e);return r.splice(i,1),this.onRemoveChild(e),this.didRemoveChild(e),e.setKey(void 0),e}removeChildren(){const t=this.children;let e;for(;e=t.length,0!==e;){const r=t[e-1];this.willRemoveChild(r),r.detachParent(this),this.removeChildMap(r),t.pop(),this.onRemoveChild(r),this.didRemoveChild(r),r.setKey(void 0)}}mount(){this.mounted||null!==this.parent||(this.cascadeMount(),this.cascadeInsert())}mountChildren(){const t=this.children;let e=0;for(;e<t.length;){const r=t[e];r.cascadeMount(),0==(r.flags&Ae.RemovingFlag)?e+=1:(r.setFlags(r.flags&~Ae.RemovingFlag),this.removeChild(r))}}unmount(){this.mounted&&null===this.parent&&this.cascadeUnmount()}unmountChildren(){const t=this.children;let e=0;for(;e<t.length;){const r=t[e];r.cascadeUnmount(),0==(r.flags&Ae.RemovingFlag)?e+=1:(r.setFlags(r.flags&~Ae.RemovingFlag),this.removeChild(r))}}},t.GeoBox=vu,t.GeoBoxInterpolator=xu,t.GeoCurve=du,t.GeoGroup=Cu,t.GeoJson=Ou,t.GeoJsonFeature=Tu,t.GeoJsonFeatureCollection=Vu,t.GeoJsonGeometry=Su,t.GeoJsonGeometryCollection=Pu,t.GeoJsonLineString=Au,t.GeoJsonMultiLineString=Mu,t.GeoJsonMultiPoint=ku,t.GeoJsonMultiPolygon=Iu,t.GeoJsonPoint=Eu,t.GeoJsonPolygon=Du,t.GeoPath=wu,t.GeoPathBuilder=gu,t.GeoPoint=lu,t.GeoPointInterpolator=cu,t.GeoProjection=uu,t.GeoSegment=pu,t.GeoSegmentInterpolator=fu,t.GeoShape=hu,t.GeoSpline=yu,t.GeoSplineBuilder=mu,t.GeoTile=bu,t.GetAttrSelector=pi,t.GetItemSelector=fi,t.GetOutlet=Rn,t.GetSelector=di,t.GradAngle=aa,t.GtOperator=Jr,t.GtOutlet=Zn,t.HashCode=y,t.HashGenCacheMap=$,t.HashGenCacheMapBucket=tt,t.HashGenCacheSet=et,t.HashGenCacheSetBucket=rt,t.Hierarchy=Ae,t.Host=Jh,t.HostAddressed=Rh,t.HostRef=bl,t.Hour12Format=Zu,t.Hour12Parser=ch,t.Hour24Format=Qu,t.Hour24Parser=lh,t.HourInterval=Eh,t.Identifiers=c,t.Identity=o,t.IdentityInterpolator=M,t.IdentitySelector=ci,t.IdentityTransform=Ba,t.In=function(t,e){if(1===arguments.length)return"string"==typeof t&&(t={name:t}),kn.decorateInlet.bind(void 0,t);kn.decorateInlet({},t,e)},t.Initable=H,t.Inlet=Ri,t.InletDescriptor=On,t.Inout=Mn,t.InoutletDescriptor=En,t.Input=pt,t.InputBuffer=Mt,t.InputBufferDone=It,t.InputBufferEmpty=Dt,t.InputBufferError=Pt,t.InputDone=At,t.InputEmpty=kt,t.InputError=ft,t.InputException=ct,t.InputSettings=dt,t.Interpolate=E,t.Interpolator=k,t.InterpolatorInterpolator=T,t.InterpolatorMap=A,t.Interpreter=Lr,t.InterpreterException=zr,t.InterpreterSettings=jr,t.InvokeOperator=ui,t.InvokeOperatorInterpolator=hi,t.InvokeOutlet=as,t.Item=ar,t.ItemForm=Vi,t.ItemInterpolator=ur,t.KeyOutlet=Qi,t.KeysCursor=Me,t.KeysSelector=yi,t.LambdaFunc=Ci,t.LaneAddressed=Nh,t.LaneRef=gl,t.Lazy=s,t.LeOperator=Gr,t.LeOutlet=Yn,t.Length=_o,t.LengthException=Go,t.LengthForm=ra,t.LengthInterpolator=ea,t.LengthParser=ia,t.LinearDomain=U,t.LinearDomainInterpolator=R,t.LinearRange=N,t.LinearRangeInterpolator=z,t.LinearScale=K,t.LinearScaleInterpolator=B,t.LinkAddressed=zh,t.LinkRequest=Kh,t.LinkedResponse=Bh,t.ListDownlink=ul,t.ListDownlinkFastener=Nl,t.ListDownlinkModel=al,t.ListDownlinkRecord=class extends pl{constructor(t){super(),this.downlink=t}isEmpty(){return this.downlink.isEmpty()}isArray(){return!0}isObject(){return this.downlink.isEmpty()}get length(){return this.downlink.length}has(t){return!1}get(t){return void 0===t?this:yr.absent()}getAttr(t){return yr.absent()}getSlot(t){return yr.absent()}getItem(t){t instanceof kr&&(t=t.value);const e=this.downlink.length;return t<0&&(t=e+t),(t=Math.min(Math.max(0,t),e-1))>=0?this.downlink.get(t):ar.absent()}set(t,e){throw new Error("unsupported")}setAttr(t,e){throw new Error("unsupported")}setSlot(t,e){throw new Error("unsupported")}setItem(t,e){t instanceof kr&&(t=t.value);const r=this.downlink.length;return t<0&&(t=r+t),(t=Math.min(Math.max(0,t),r-1))>=0&&this.downlink.set(t,yr.fromAny(e)),this}push(...t){return this.downlink.push(...t)}splice(t,e,...r){return this.downlink.splice(t,e,...r)}delete(t){return ar.absent()}clear(){this.downlink.clear()}forEach(t,e){return this.downlink.forEach(t,e)}keyIterator(){return _.empty()}},t.LiteralSelector=bi,t.LtOperator=Yr,t.LtOutlet=Xn,t.MapDownlink=ll,t.MapDownlinkFastener=zl,t.MapDownlinkModel=hl,t.MapDownlinkRecord=fl,t.MapFieldValuesCombinator=pn,t.MapFieldValuesOperator=dn,t.MapInlet=Li,t.MapInput=class extends Ji{constructor(t){super(),void 0===t&&(t=new Te),this.state=t;let e=this.effects;t.forEach((function(t){e=e.updated(t,0)}),this),this.effects=e}has(t){return this.state.has(t)}get(t){return void 0===t?this.state:this.state.get(t)}set(t,e){const r=this.state,i=r.get(t);return i!==e&&(this.state=r.updated(t,e),this.decohereInputKey(t,0)),i}delete(t){const e=this.state,r=e.removed(t);return e!==r&&(this.state=r,this.decohereInputKey(t,1)),this}keyIterator(){return this.state.keys()}},t.MapOutlet=Ki,t.MapOutletCombinators=Bi,t.MapOutput=class extends Zi{constructor(){super(),this.state=new Te}get(){return this.state}onRecohereOutputKey(t,e,r){if(0===e){const e=this.input;if(null!==e){const r=e.get(t);this.state=void 0!==r?this.state.updated(t,r):this.state.removed(t)}}else 1===e&&(this.state=this.state.removed(t))}},t.MapValueCombinator=cn,t.MapValueOperator=ln,t.Mapping=C,t.Mark=at,t.MathModule=Si,t.MemoizeMapCombinator=an,t.MemoizeValueCombinator=on,t.MillisecondFormat=eh,t.MillisecondInterval=Mh,t.MillisecondParser=yh,t.MillisecondsInterval=Dh,t.MinusOperator=ti,t.MinusOutlet=$n,t.MinuteFormat=$u,t.MinuteInterval=kh,t.MinuteParser=ph,t.ModuloOperator=ii,t.ModuloOutlet=rs,t.MonthFormat=Hu,t.MonthInterval=Ch,t.MonthOfYearFormat=Wu,t.MonthOfYearParser=nh,t.MonthParser=sh,t.Murmur3=n,t.NeOperator=Qr,t.NeOutlet=_n,t.NegativeOperator=oi,t.NegativeOutlet=ss,t.NodeCursor=Ie,t.NodeRef=vl,t.NotOperator=ni,t.NotOutlet=is,t.Num=kr,t.NumInterpolator=Ar,t.NumberAnimator=Se,t.NumberForm=Ii,t.NumberInterpolator=I,t.NumberProperty=be,t.Numbers=h,t.Objects=w,t.Observable=X,t.Operator=Tr,t.OrOperator=Kr,t.OrOutlet=Ln,t.Out=An,t.Outlet=Ni,t.OutletCombinators=zi,t.OutletDescriptor=Sn,t.OutletInlet=rn,t.OutletMapInlet=nn,t.Output=wt,t.OutputBuffer=qt,t.OutputBufferDone=Rt,t.OutputBufferError=Nt,t.OutputBufferFull=Ut,t.OutputDone=Vt,t.OutputError=Ft,t.OutputException=mt,t.OutputFull=Tt,t.OutputSettings=lt,t.OutputStyle=ht,t.Parser=jt,t.ParserDone=Lt,t.ParserError=Kt,t.ParserException=zt,t.PatternFormat=rh,t.PatternParser=mh,t.PctLength=$o,t.PeriodFormat=Ju,t.PeriodParser=dh,t.PlusOperator=$r,t.PlusOutlet=Jn,t.PositiveOperator=ai,t.PositiveOutlet=os,t.Property=ge,t.Provider=ke,t.PxLength=Qo,t.R2BezierCurve=va,t.R2Box=Ua,t.R2BoxInterpolator=Ra,t.R2Circle=qa,t.R2CircleInterpolator=Na,t.R2CubicCurve=Ea,t.R2CubicCurveParser=ka,t.R2Curve=wa,t.R2CurveParser=ga,t.R2EllipticCurve=Aa,t.R2EllipticCurveParser=Ma,t.R2Group=za,t.R2Path=Ta,t.R2PathBuilder=Va,t.R2PathParser=Fa,t.R2Point=ya,t.R2PointInterpolator=ma,t.R2QuadraticCurve=Oa,t.R2QuadraticCurveParser=Sa,t.R2Segment=ba,t.R2SegmentInterpolator=xa,t.R2SegmentParser=Ca,t.R2Shape=fa,t.R2Spline=Da,t.R2SplineBuilder=Ia,t.R2SplineParser=Pa,t.R2Vector=da,t.R2VectorInterpolator=pa,t.RadAngle=oa,t.Random=r,t.Range=S,t.Recon=hs,t.ReconParser=zs,t.ReconStructureParser=js,t.ReconStructureWriter=lo,t.ReconWriter=ho,t.Record=mr,t.RecordCursor=vr,t.RecordFieldUpdater=Vn,t.RecordInterpolator=gr,t.RecordMap=br,t.RecordMapView=xr,t.RecordModel=Fn,t.RecordOutlet=Dn,t.RecordScope=qn,t.RecordStreamlet=Pn,t.ReduceFieldsCombinator=yn,t.ReduceFieldsOperator=fn,t.Reifier=Un,t.RemLength=Jo,t.RemoteHost=$h,t.RotateTransform=Qa,t.RotateTransformInterpolator=Za,t.RotateTransformParser=Ja,t.STree=Ne,t.STreeContext=Re,t.STreeLeaf=je,t.STreeNode=Le,t.STreeNodeCursor=Ke,t.STreePage=ze,t.Scale=j,t.ScaleTransform=Ya,t.ScaleTransformInterpolator=Ga,t.ScaleTransformParser=_a,t.SecondFormat=th,t.SecondInterval=Ah,t.SecondParser=fh,t.Selector=li,t.Service=G,t.Severity=st,t.ShortMonthFormat=Xu,t.ShortMonthParser=oh,t.ShortWeekdayFormat=_u,t.ShortWeekdayParser=hh,t.SkewTransform=$a,t.SkewTransformInterpolator=tu,t.SkewTransformParser=eu,t.Slot=lr,t.SlotInterpolator=fr,t.Span=ut,t.StepInterpolator=D,t.Streamlet=Xi,t.StreamletException=Wi,t.StreamletInlet=bn,t.StreamletInoutlet=Cn,t.StreamletOutlet=xn,t.StreamletScope=Hi,t.StringAnimator=Oe,t.StringForm=Di,t.StringInput=yt,t.StringOutput=gt,t.StringProperty=ve,t.StringWriter=xt,t.Strings=l,t.SyncRequest=Wh,t.SyncedResponse=Hh,t.Tag=ot,t.TagForm=Ai,t.Text=Sr,t.TextOutput=Er,t.TimeDomain=Ih,t.TimeDomainInterpolator=Ph,t.TimeInterval=wh,t.TimeRange=Th,t.TimeRangeInterpolator=Vh,t.TimeScale=Fh,t.TimeScaleInterpolator=qh,t.TimeZone=Fu,t.TimeZoneForm=qu,t.TimesOperator=ei,t.TimesOutlet=ts,t.Timing=V,t.ToAny=x,t.Transform=ja,t.TransformForm=La,t.TransformList=su,t.TransformListInterpolator=ou,t.TransformListParser=au,t.TransformParser=Ka,t.TranslateTransform=Wa,t.TranslateTransformInterpolator=Ha,t.TranslateTransformParser=Xa,t.TurnAngle=ua,t.Tweening=q,t.UnaryOperator=qr,t.UnaryOperatorInterpolator=Ur,t.UnaryOutlet=zn,t.Unicode=Ct,t.UnitForm=Mi,t.UnitTimeInterval=gh,t.UnitlessLength=ta,t.UnlinkRequest=Xh,t.UnlinkedResponse=Yh,t.Uri=po,t.UriAbsoluteParser=Ro,t.UriAuthority=yo,t.UriAuthorityParser=zo,t.UriCache=qo,t.UriException=co,t.UriForm=Fo,t.UriFragment=Vo,t.UriFragmentParser=Yo,t.UriHost=wo,t.UriHostAddressParser=Ko,t.UriHostIPv4=vo,t.UriHostIPv6=bo,t.UriHostLiteralParser=Bo,t.UriHostName=go,t.UriHostParser=Lo,t.UriHostUndefined=xo,t.UriParser=Uo,t.UriPath=Oo,t.UriPathBuilder=Ao,t.UriPathEmpty=ko,t.UriPathForm=Mo,t.UriPathParser=Ho,t.UriPathSegment=So,t.UriPathSlash=Eo,t.UriPort=Co,t.UriPortParser=Wo,t.UriQuery=Do,t.UriQueryBuilder=To,t.UriQueryParam=Io,t.UriQueryParser=Xo,t.UriQueryUndefined=Po,t.UriScheme=fo,t.UriSchemeParser=No,t.UriUser=mo,t.UriUserParser=jo,t.Utf8=ie,t.Utf8DecodedOutput=ee,t.Utf8EncodedOutput=re,t.UtfErrorMode=Zt,t.UtfErrorModeFatal=Jt,t.UtfErrorModeReplacement=$t,t.Value=yr,t.ValueBuilder=wr,t.ValueCursor=qi,t.ValueDownlink=dl,t.ValueDownlinkFastener=jl,t.ValueDownlinkModel=cl,t.ValueDownlinkRecord=class extends pl{constructor(t){super(),this.downlink=t,t.observe(this)}isEmpty(){const t=this.downlink.get();return t instanceof mr?t.isEmpty():!t.isDefined()}isArray(){const t=this.downlink.get();return!(t instanceof mr)||t.isArray()}isObject(){const t=this.downlink.get();return t instanceof mr?t.isObject():!t.isDefined()}get length(){const t=this.downlink.get();return t instanceof mr?t.length:t.isDefined()?1:0}has(t){const e=this.downlink.get();return e instanceof mr&&e.has(t)}get(t){if(void 0===t)return this;{const e=this.downlink.get();return e instanceof mr?e.get(t):yr.absent()}}getAttr(t){const e=this.downlink.get();return e instanceof mr?e.getAttr(t):yr.absent()}getSlot(t){const e=this.downlink.get();return e instanceof mr?e.getSlot(t):yr.absent()}getField(t){const e=this.downlink.get();return e instanceof mr?e.getField(t):void 0}getItem(t){const e=this.downlink.get();return e instanceof mr?e.getItem(t):e}set(t,e){const r=this.downlink.get();if(!(r instanceof mr))throw new Error("unsupported");return r.set(t,e),this}setAttr(t,e){const r=this.downlink.get();if(!(r instanceof mr))throw new Error("unsupported");return r.setAttr(t,e),this}setSlot(t,e){const r=this.downlink.get();if(!(r instanceof mr))throw new Error("unsupported");return r.setSlot(t,e),this}setItem(t,e){const r=this.downlink.get();return r instanceof mr?r.setItem(t,e):this.downlink.set(ar.fromAny(e).toValue()),this}push(...t){const e=this.downlink.get();if(e instanceof mr)return e.push(...t);throw new Error("unsupported")}splice(t,e,...r){const i=this.downlink.get();if(i instanceof mr)return i.splice(t,e,...r);throw new Error("unsupported")}delete(t){const e=this.downlink.get();return e instanceof mr?e.delete(t):yr.absent()}clear(){const t=this.downlink.get();if(!(t instanceof mr))throw new Error("unsupported");t.clear()}forEach(t,e){return this.downlink.get().forEach(t,e)}keyIterator(){if(this.downlink.get()instanceof mr)throw new Error;return _.empty()}didSet(t,e){this.decohereInput(),this.recohereInput(0)}},t.ValueEntryCursor=Ui,t.ValueForm=Fi,t.ValueInput=sn,t.ValueOutput=class extends Yi{constructor(t){super(),this.state=t}get(){return this.state}onRecohereOutput(t){const e=this.input;null!==e&&(this.state=e.get())}},t.Values=g,t.ValuesCursor=De,t.ValuesSelector=mi,t.WarpClient=xl,t.WarpProvider=ql,t.WarpService=Fl,t.WatchFieldsCombinator=vn,t.WatchFieldsOperator=gn,t.WatchValueCombinator=wn,t.WatchValueOperator=mn,t.WebSocketHost=tl,t.WeekInterval=Oh,t.WeekdayFormat=Gu,t.WeekdayParser=uh,t.Writer=bt,t.WriterDone=Wt,t.WriterEnd=Bt,t.WriterError=Ht,t.WriterException=vt,t.WriterSequence=Xt,t.YearFormat=Bu,t.YearInterval=bh,t.YearParser=ih,t.YearsInterval=xh,t.assert=nt,t.authenticate=Tl,t.client=Cl,t.command=Vl,t.downlink=El,t.downlinkList=kl,t.downlinkMap=Al,t.downlinkValue=Ml,t.hostRef=Dl,t.isOnline=Ol,t.keepOnline=Sl,t.laneRef=Pl,t.nodeRef=Il,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=swim-runtime.min.js.map